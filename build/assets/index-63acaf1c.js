import{M as he,N as me,O as ue,r as U,X as ge,K as fe,P as se,j as e,Y as xe,Z as je,B as be,am as ne,F as L,g as T,y as G,w as ie,s as $,t as we,E as _e,b6 as Ee}from"./index-fab10bb0.js";import{L as z}from"./index-a151a639.js";import{C as V}from"./ClipLoader-0a81d32f.js";import{B as H}from"./index-1a0d0c27.js";import{M as X,b as Q,a as O,T as a,c as Z}from"./TableRow-8aa2780d.js";import"./SourcesTableIcon-27de4552.js";import"./CheckIcon-d15a4d0e.js";import"./DeleteNodeIcon-b444f3b4.js";import"./SoundIcon-204702fb.js";import"./SucessFeedBackIcon-5380d4b6.js";function Te(t){return he("MuiTableContainer",t)}me("MuiTableContainer",["root"]);const ye=["className","component"],ve=t=>{const{classes:p}=t;return je({root:["root"]},Te,p)},Ne=ue("div",{name:"MuiTableContainer",slot:"Root",overridesResolver:(t,p)=>p.root})({width:"100%",overflowX:"auto"}),Se=U.forwardRef(function(p,v){const y=ge({props:p,name:"MuiTableContainer"}),{className:S,component:b="div"}=y,N=fe(y,ye),f=se({},y,{component:b}),x=ve(f);return e.jsx(Ne,se({ref:v,as:b,className:xe(x.root,S),ownerState:f},N))}),q=Se,J=({data:t,filename:p="data.csv"})=>{const v=S=>{if(S.length===0)return"";const b=Object.keys(S[0]),N=(x,C)=>typeof C=="string"?`"${C.replace(/"/g,'""')}"`:C!=null?String(C):"",f=S.map(x=>b.map(C=>N(C,x[C])).join(","));return[b.join(","),...f].join(`
`)},y=()=>{const S=v(t),b=new Blob([S],{type:"text/csv;charset=utf-8;"}),N=URL.createObjectURL(b),f=document.createElement("a");f.href=N,f.download=p,f.style.display="none",document.body.appendChild(f),f.click(),document.body.removeChild(f),URL.revokeObjectURL(N)};return e.jsx(be,{onClick:y,type:"button",children:"Download CSV"})},Ce=async t=>await ne.get(`/mindset/tweet/engagement/${t}`),Ue=async t=>await ne.get(`/mindset/tweet/followers/${t}`),oe=({sortBy:t,idsToAnalyze:p})=>{const[v,y]=U.useState([]),[S,b]=U.useState([]),[N,f]=U.useState(!0),[x,C]=U.useState("");U.useEffect(()=>{(async()=>{if(p.length!==0){f(!0);try{const d=await Promise.all(p.map(l=>t==="followers"?Ce(l):Ue(l))),n=[],m=[],c=[];d.forEach((l,_)=>{const o=l.nodes.find(u=>u.ref_id===p[_]);if(o&&n.push(o),t===M.ENGAGEMENT.value){const R=[...l.nodes.filter(g=>{var i,h,w,j;return g.node_type==="Tweet"&&((i=g.properties)==null?void 0:i.author)!==((h=o==null?void 0:o.properties)==null?void 0:h.author)&&((w=g.properties)==null?void 0:w.twitter_handle)!==((j=o==null?void 0:o.properties)==null?void 0:j.twitter_handle)}).map(g=>{var j,F,Y,k,D,A,B;const i=l.nodes.find(I=>{var P,W;return I.node_type==="User"&&((P=I.properties)==null?void 0:P.author_id)===((W=g.properties)==null?void 0:W.author)}),h=(j=g.properties)!=null&&j.impression_count?((F=g.properties)==null?void 0:F.impression_count).split(",").at(-1):0,w=(Y=o==null?void 0:o.properties)!=null&&Y.impression_count?((k=o.properties)==null?void 0:k.impression_count).split(",").at(-1):1;return i?{...g,properties:{...g.properties,twitter_handle:(D=i.properties)==null?void 0:D.twitter_handle,followers:(A=i.properties)==null?void 0:A.followers,image_url:(B=i.properties)==null?void 0:B.image_url,impression_percentage:(Number(h)/Number(w)*100).toFixed(2)}}:g})].sort((g,i)=>{var j,F;const h=Number((j=g.properties)==null?void 0:j.impression_percentage)||0;return(Number((F=i.properties)==null?void 0:F.impression_percentage)||0)-h}).slice(0,20);R&&m.push(...R)}if(t===M.FOLLOWERS.value){const u=l.nodes.filter(i=>{var h,w,j,F;return i.node_type==="User"&&((h=i.properties)==null?void 0:h.author_id)!==((w=o==null?void 0:o.properties)==null?void 0:w.author)&&((j=i.properties)==null?void 0:j.twitter_handle)!==((F=o==null?void 0:o.properties)==null?void 0:F.twitter_handle)}).sort((i,h)=>{var w,j;return Number((w=h.properties)==null?void 0:w.followers)-Number((j=i.properties)==null?void 0:j.followers)}).slice(0,20),g=u.map(i=>{const h=l.edges.find(j=>j.source===i.ref_id),w=l.edges.find(j=>j.target===i.ref_id);return h?h.target:w?w.source:null}).map((i,h)=>{var k,D,A,B,I,P;if(!i)return null;const w=((D=(k=u[h])==null?void 0:k.properties)==null?void 0:D.followers)||0,j=((B=(A=u[h])==null?void 0:A.properties)==null?void 0:B.twitter_handle)||"",F=((P=(I=u[h])==null?void 0:I.properties)==null?void 0:P.image_url)||"",Y=l.nodes.find(W=>W.ref_id===i);return{...Y,properties:{...(Y==null?void 0:Y.properties)||{},followers:w,twitter_handle:j,image_url:F}}}).filter(i=>i!==null);g&&c.push(...g)}}),y(m.sort((l,_)=>{var o,u;return Number((o=_.properties)==null?void 0:o.impression_percentage)-Number((u=l.properties)==null?void 0:u.impression_percentage)}).slice(0,20)),b(c.sort((l,_)=>{var o,u;return Number((o=_.properties)==null?void 0:o.followers)-Number((u=l.properties)==null?void 0:u.followers)}).slice(0,20)),f(!1)}catch(d){console.error("Error fetching tweets:",d),f(!1),C("Error fetching tweets")}finally{f(!1)}}})()},[t,p]);const s=t===M.ENGAGEMENT.value?v:S;if(x)return e.jsx("div",{style:{padding:24,color:"#FF4D4F"},children:x});if(!v.length&&!S.length)return N?e.jsxs(L,{align:"center",grow:1,justify:"center",children:[e.jsx(V,{color:T.white}),e.jsx("div",{style:{padding:24,fontSize:16,textAlign:"center",color:T.white},children:"Loading engagement data..."})]}):e.jsx("div",{style:{padding:24,textAlign:"center"},children:"No engagement data available"});const E=t===M.ENGAGEMENT.value?s.map(r=>{var d,n,m,c,l,_,o;return{"User profile":(d=r.properties)!=null&&d.twitter_handle?(n=r.properties)==null?void 0:n.twitter_handle:"",Date:(m=r.properties)!=null&&m.date?G.unix(r.properties.date).format("YYYY-MM-DD"):"",Tweet:((c=r.properties)==null?void 0:c.text)||"",Engagement:((l=r.properties)==null?void 0:l.impression_percentage)||"","Impression count":((_=r.properties)==null?void 0:_.impression_count)||"","Tweet ID":((o=r.properties)==null?void 0:o.tweet_id)||""}}):s.map(r=>{var d,n,m,c,l,_;return{"User profile":(d=r.properties)!=null&&d.twitter_handle?(n=r.properties)==null?void 0:n.twitter_handle:"",Date:(m=r.properties)!=null&&m.date?G.unix(r.properties.date).format("YYYY-MM-DD"):"",Tweet:((c=r.properties)==null?void 0:c.text)||"",Followers:((l=r.properties)==null?void 0:l.followers)||"","Tweet ID":((_=r.properties)==null?void 0:_.tweet_id)||""}});return e.jsx(q,{component:H,children:e.jsxs(X,{"aria-label":"a dense table",size:"small",sx:{minWidth:650},children:[e.jsx(Q,{children:e.jsxs(O,{children:[e.jsx(a,{align:"left",children:"Rank"}),e.jsx(a,{align:"left",children:"User Profile"}),e.jsx(a,{align:"left",children:"Tweet"}),t===M.ENGAGEMENT.value&&e.jsx(a,{align:"left",children:"Engagement"}),e.jsx(a,{align:"left",children:"Followers"}),e.jsx(a,{align:"left",children:e.jsx(J,{data:E,filename:`${t}-${G().format("YYYY-MM-DD")}.csv`})})]})}),e.jsx(Z,{children:s.map((r,d)=>{var n,m,c,l,_,o,u,R,g,i,h,w;return e.jsxs(O,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(a,{children:d+1}),e.jsxs(a,{children:[e.jsx(K,{imageUrl:(n=r.properties)==null?void 0:n.image_url}),e.jsx(ee,{children:((m=r==null?void 0:r.properties)==null?void 0:m.twitter_handle)&&e.jsx(re,{children:r.properties.twitter_handle})})]}),e.jsxs(a,{children:[((c=r.properties)==null?void 0:c.text)||"",e.jsxs(L,{align:"center",direction:"row",justify:"flex-start",mt:16,children:[((l=r==null?void 0:r.properties)==null?void 0:l.date)&&e.jsx(de,{"aria-label":"Time since tweet",children:G.unix(r.properties.date).fromNow()}),e.jsx(te,{"aria-label":"View tweet on Twitter",href:`https://twitter.com/${(_=r==null?void 0:r.properties)==null?void 0:_.twitter_handle}/status/${(o=r==null?void 0:r.properties)==null?void 0:o.tweet_id}?open=system`,rel:"noopener noreferrer",target:"_blank",children:e.jsx(z,{})})]})]}),t===M.ENGAGEMENT.value&&e.jsxs(e.Fragment,{children:[e.jsxs(a,{children:[(u=r.properties)==null?void 0:u.impression_percentage," %",((R=r.properties)==null?void 0:R.impression_count)!==void 0&&!!((g=r.properties)!=null&&g.impression_count)&&e.jsx(Le,{children:e.jsx(Ye,{percentage:Number((i=r.properties)==null?void 0:i.impression_percentage)})})]}),e.jsx(a,{align:"right",children:Number((h=r.properties)==null?void 0:h.followers).toLocaleString()})]}),t===M.FOLLOWERS.value&&e.jsx(a,{align:"right",children:Number((w=r.properties)==null?void 0:w.followers).toLocaleString()})]},r.ref_id)})})]})})},Re=({sortBy:t,idsToAnalyze:p})=>{const[v,y]=U.useState([]),[S,b]=U.useState(!0),[N,f]=U.useState("");U.useEffect(()=>{(async()=>{if(p.length!==0){b(!0);try{const E=await Promise.all(p.map(n=>ie(n,["User"],["RETWEETED_BY>"],"",!0,0,1,20))),r=[];E.forEach(n=>{n.nodes&&r.push(...n.nodes)});const d=r.filter(n=>n.node_type==="User").sort((n,m)=>{var c,l;return Number((c=m.properties)==null?void 0:c.followers)-Number((l=n.properties)==null?void 0:l.followers)}).slice(0,20);y(d),b(!1)}catch(E){console.error("Error fetching tweets:",E),b(!1),f("Error fetching tweets")}finally{b(!1)}}})()},[t,p]);const x=v;if(N)return e.jsx("div",{style:{padding:24,color:"#FF4D4F"},children:N});if(!v.length)return S?e.jsxs(L,{align:"center",grow:1,justify:"center",children:[e.jsx(V,{color:T.white}),e.jsx("div",{style:{padding:24,fontSize:16,textAlign:"center",color:T.white},children:"Loading engagement data..."})]}):e.jsx("div",{style:{padding:24,textAlign:"center"},children:"No engagement data available"});const C=x.map(s=>{var E,r,d;return{"User profile":(E=s.properties)!=null&&E.twitter_handle?(r=s.properties)==null?void 0:r.twitter_handle:"",Followers:((d=s.properties)==null?void 0:d.followers)||""}});return e.jsx(q,{component:H,children:e.jsxs(X,{"aria-label":"a dense table",size:"small",sx:{minWidth:650},children:[e.jsx(Q,{children:e.jsxs(O,{children:[e.jsx(a,{align:"left",children:"Rank"}),e.jsx(a,{align:"left",children:"User Profile"}),e.jsx(a,{align:"left",children:"Followers"}),e.jsx(a,{align:"left",children:e.jsx(J,{data:C,filename:`${t}-${G().format("YYYY-MM-DD")}.csv`})})]})}),e.jsx(Z,{children:x.map((s,E)=>{var r,d,n,m;return e.jsxs(O,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(a,{children:E+1}),e.jsxs(a,{children:[e.jsx(K,{imageUrl:(r=s.properties)==null?void 0:r.image_url}),e.jsxs(L,{align:"center",direction:"row",justify:"flex-start",mt:16,children:[e.jsx(ee,{children:((d=s==null?void 0:s.properties)==null?void 0:d.twitter_handle)&&e.jsx(re,{children:s.properties.twitter_handle})}),e.jsx(te,{"aria-label":"View tweet on Twitter",href:`https://twitter.com/${(n=s==null?void 0:s.properties)==null?void 0:n.twitter_handle}?open=system`,rel:"noopener noreferrer",target:"_blank",children:e.jsx(z,{})})]})]}),e.jsx(a,{children:((m=s.properties)==null?void 0:m.followers)||""})," "]},s.ref_id)})})]})})},Me=({sortBy:t,idsToAnalyze:p})=>{const[v,y]=U.useState([]),[S,b]=U.useState(!0),[N,f]=U.useState("");U.useEffect(()=>{(async()=>{if(p.length!==0){b(!0);try{const E=await Promise.all(p.map(n=>ie(n,[],["HAS_REPLY>","HAS_QUOTE>","THREAD_NEXT>","<POSTED"],"sentiment",!0,0,10,800))),r=[],d=[];E.forEach((n,m)=>{const c=n.nodes.find(o=>o.ref_id===p[m]);c&&r.push(c);const _=[...n.nodes.filter(o=>{var u,R,g,i;return o.node_type==="Tweet"&&((u=o.properties)==null?void 0:u.author)!==((R=c==null?void 0:c.properties)==null?void 0:R.author)&&((g=o.properties)==null?void 0:g.twitter_handle)!==((i=c==null?void 0:c.properties)==null?void 0:i.twitter_handle)}).map(o=>{var R,g,i;const u=n.nodes.find(h=>{var w,j;return h.node_type==="User"&&((w=h.properties)==null?void 0:w.author_id)===((j=o.properties)==null?void 0:j.author)});return u?{...o,properties:{...o.properties,twitter_handle:(R=u.properties)==null?void 0:R.twitter_handle,image_url:(g=u.properties)==null?void 0:g.image_url,followers:(i=u.properties)==null?void 0:i.followers}}:o})].sort((o,u)=>{var i,h;const R=Number((i=o.properties)==null?void 0:i.sentiment)||0;return(Number((h=u.properties)==null?void 0:h.sentiment)||0)-R}).slice(0,20);_&&d.push(..._)}),y(d.sort((n,m)=>{var c,l;return Number((c=m.properties)==null?void 0:c.sentiment)-Number((l=n.properties)==null?void 0:l.sentiment)}).slice(0,20)),b(!1)}catch(E){console.error("Error fetching tweets:",E),b(!1),f("Error fetching tweets")}finally{b(!1)}}})()},[t,p]);const x=v;if(N)return e.jsx("div",{style:{padding:24,color:"#FF4D4F"},children:N});if(!v.length)return S?e.jsxs(L,{align:"center",grow:1,justify:"center",children:[e.jsx(V,{color:T.white}),e.jsx("div",{style:{padding:24,fontSize:16,textAlign:"center",color:T.white},children:"Loading engagement data..."})]}):e.jsx("div",{style:{padding:24,textAlign:"center"},children:"No engagement data available"});const C=x.map(s=>{var E,r,d,n,m;return{"User profile":(E=s.properties)!=null&&E.twitter_handle?(r=s.properties)==null?void 0:r.twitter_handle:"",Tweet:((d=s.properties)==null?void 0:d.text)||"",Sentiment:((n=s.properties)==null?void 0:n.sentiment)||"",Followers:((m=s.properties)==null?void 0:m.followers)||""}});return e.jsx(q,{component:H,children:e.jsxs(X,{"aria-label":"a dense table",size:"small",sx:{minWidth:650},children:[e.jsx(Q,{children:e.jsxs(O,{children:[e.jsx(a,{align:"left",children:"Rank"}),e.jsx(a,{align:"left",children:"User Profile"}),e.jsx(a,{align:"left",children:"Tweet"}),e.jsx(a,{align:"left",children:"Sentiment"}),e.jsx(a,{align:"left",children:"Followers"}),e.jsx(a,{align:"left",children:e.jsx(J,{data:C,filename:`${t}-${G().format("YYYY-MM-DD")}.csv`})})]})}),e.jsx(Z,{children:x.map((s,E)=>{var r,d,n,m,c,l,_,o;return e.jsxs(O,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(a,{children:E+1}),e.jsxs(a,{children:[e.jsx(K,{imageUrl:(r=s.properties)==null?void 0:r.image_url}),e.jsx(ee,{children:((d=s==null?void 0:s.properties)==null?void 0:d.twitter_handle)&&e.jsx(re,{children:s.properties.twitter_handle})})]}),e.jsxs(a,{children:[((n=s.properties)==null?void 0:n.text)||"",e.jsxs(L,{align:"center",direction:"row",justify:"flex-start",mt:16,children:[((m=s==null?void 0:s.properties)==null?void 0:m.date)&&e.jsx(de,{"aria-label":"Time since tweet",children:G.unix(s.properties.date).fromNow()}),e.jsx(te,{"aria-label":"View tweet on Twitter",href:`https://twitter.com/${(c=s==null?void 0:s.properties)==null?void 0:c.twitter_handle}/status/${(l=s==null?void 0:s.properties)==null?void 0:l.tweet_id}?open=system`,rel:"noopener noreferrer",target:"_blank",children:e.jsx(z,{})})]})]}),e.jsx(a,{align:"right",children:(_=s.properties)==null?void 0:_.sentiment}),e.jsx(a,{align:"right",children:(o=s.properties)==null?void 0:o.followers})]},s.ref_id)})})]})})},le="ENGAGEMENT",ae="FOLLOWERS",pe="TOP_REPOSTERS",ce="SENTIMENT",Fe={[le]:oe,[ae]:oe,[pe]:Re,[ce]:Me},$e=$.button`
  background: ${({active:t})=>t?T.primaryBlue:"transparent"};
  border: 1px solid ${({active:t})=>t?T.primaryGreen:T.GRAY9};
  color: ${({active:t})=>t?T.white:T.GRAY6};
  padding: 6px 12px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 14px;
  display: flex;
  align-items: center;
  gap: 6px;
  &:hover {
    border-color: ${({active:t})=>t?T.primaryGreen:T.GRAY6};
  }
`,K=$.div`
  width: 32px;
  height: 32px;
  border-radius: 50%;
  background-color: ${T.BG1};
  ${({imageUrl:t})=>t&&`background-image: url(${t});`}
  background-size: cover;
`,ee=$.div`
  display: flex;
  flex-direction: column;
`,re=$.span`
  font-size: 14px;
`,de=$.div`
  color: ${T.GRAY7};
  font-size: 12px;
`,te=$.a`
  color: ${T.SOURCE_TABLE_LINK};
  cursor: pointer;
  font-size: 16px;
  height: 16px;
  margin-left: 8px;
`,Le=$.div`
  display: flex;
  align-items: center;
  gap: 8px;
`,Ye=$.div`
  width: 100px;
  height: 4px;
  background-color: ${T.BG1};
  border-radius: 2px;
  position: relative;
  &::after {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    height: 100%;
    width: ${t=>t.percentage}%;
    background-color: ${T.primaryGreen};
    border-radius: 2px;
  }
`,Ge=$.h2`
  font-size: 24px;
  font-weight: 600;
  margin-bottom: 16px;
  color: ${T.white};
`,M={[le]:{label:"Engagement",value:"impression_count"},[ae]:{label:"Followers",value:"followers"},[pe]:{label:"Top Reposters",value:"top_reposters"},[ce]:{label:"Sentiment",value:"sentiment"}},Oe=({tweetId:t})=>{var f;const[p,v]=U.useState(M.ENGAGEMENT.value),{tweetId:y}=we(),S=U.useMemo(()=>{const x=(y==null?void 0:y.split("&"))||[];return t==="summary"?x:x.filter(C=>C===t)},[y,t]),b=(f=Object.entries(M).find(([,x])=>x.value===p))==null?void 0:f[0],N=b?Fe[b]:null;return e.jsxs(ke,{children:[e.jsxs(L,{p:24,children:[e.jsx(Ge,{children:"Engagement Report"}),e.jsx(L,{direction:"row",children:Object.keys(M).map(x=>e.jsx($e,{active:p===M[x].value,onClick:()=>v(M[x].value),children:M[x].label},x))})]}),N&&e.jsx(N,{idsToAnalyze:S,sortBy:p})]})},ke=$(L)`
  display: flex;
  flex: 1;
  min-height: 572px;
  overflow: auto;

  @media (max-width: 1024px) {
    width: 100%;
    min-height: 400px;
    max-height: 400px;
  }

  @media (max-width: 768px) {
    width: 100%;
    min-height: 300px;
    max-height: 300px;
  }

  @media (max-width: 480px) {
    width: 100%;
    min-height: 250px;
    max-height: 250px;
  }
`,Qe=({tweetId:t})=>{const{close:p,visible:v}=_e("tweetAnalyze"),y=()=>{p()};return e.jsx(Ee,{"data-testid":"tweet-analyze-modal",id:"tweetAnalyze",kind:"full",noWrap:!0,onClose:y,preventOutsideClose:!0,children:v&&e.jsx(Oe,{tweetId:t})})};export{Qe as TweetAnalyze};
