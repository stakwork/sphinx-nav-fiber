import{g as Re,a as Ie,s as ae,_ as L,a9 as Ft,r as m,b as ze,j as r,d as Be,c as ie,e as Fe,u as wt,aM as Vt,b4 as Pe,b5 as Ve,a7 as rt,b6 as Yt,b7 as Ut,a0 as Gt,f as W,F as P,h as R,D as Ae,a_ as Wt,T as ne,B as vt,N as Ee,aY as ue,a$ as Ht,b8 as Zt,b9 as Kt,ba as Xt,Z as D,bb as le,bc as de,ap as it,bd as we,be as ve,bf as at,bg as Z,bh as qt,ar as Qt,bi as ct,bj as lt,bk as dt,bl as ut,bm as Jt,am as eo,W as to,bn as pt}from"./index-1f32104b.js";import{B as oo}from"./index-e9915fcc.js";import{q as no,r as so,i as ro,C as ke,I as io,B as Ye,c as ao,b as co,F as lo,s as uo}from"./react-toastify.esm-778eaf5b.js";import{e as po,A as Ne}from"./index-a43ddeb1.js";import{T as Le}from"./index-dd3c818a.js";import{c as ft,d as fo}from"./index-b1b6a206.js";import{D as ho,P as mo}from"./PlusIcon-9f16296c.js";import{p as go,c as bo}from"./index-30d16895.js";import{u as xo}from"./Popover-9aa0b185.js";import{u as yo}from"./index-aa5d4f0e.js";import{L as wo,m as vo,u as ee,b as Ce,T as jo,C as Eo}from"./constant-08126cb0.js";import{f as ko,P as Po,L as Co}from"./constants-ee232938.js";import{A as To}from"./AddContentIcon-862d9d48.js";import"./useSlotProps-f66c36b0.js";import"./Popper-388cba6e.js";import"./index.esm-b5bec20a.js";import"./InfoIcon-651502b1.js";import"./generateCategoricalChart-a5e66e71.js";import"./NoFilterResultIcon-46c15fc2.js";import"./index-fa5ded45.js";import"./index-c834de04.js";import"./CheckIcon-b6ba1038.js";function Oo(t){return Re("PrivateSwitchBase",t)}Ie("PrivateSwitchBase",["root","checked","disabled","input","edgeStart","edgeEnd"]);const Mo=["autoFocus","checked","checkedIcon","className","defaultChecked","disabled","disableFocusRipple","edge","icon","id","inputProps","inputRef","name","onBlur","onChange","onFocus","readOnly","required","tabIndex","type","value"],$o=t=>{const{classes:s,checked:n,disabled:e,edge:a}=t,c={root:["root",n&&"checked",e&&"disabled",a&&`edge${ie(a)}`],input:["input"]};return Fe(c,Oo,s)},So=ae(no)(({ownerState:t})=>L({padding:9,borderRadius:"50%"},t.edge==="start"&&{marginLeft:t.size==="small"?-3:-12},t.edge==="end"&&{marginRight:t.size==="small"?-3:-12})),Do=ae("input",{shouldForwardProp:Ft})({cursor:"inherit",position:"absolute",opacity:0,width:"100%",height:"100%",top:0,left:0,margin:0,padding:0,zIndex:1}),_o=m.forwardRef(function(s,n){const{autoFocus:e,checked:a,checkedIcon:c,className:p,defaultChecked:i,disabled:d,disableFocusRipple:x=!1,edge:l=!1,icon:f,id:h,inputProps:v,inputRef:C,name:$,onBlur:S,onChange:T,onFocus:g,readOnly:j,required:w=!1,tabIndex:k,type:_,value:I}=s,A=ze(s,Mo),[G,E]=yo({controlled:a,default:!!i,name:"SwitchBase",state:"checked"}),z=xo(),fe=B=>{g&&g(B),z&&z.onFocus&&z.onFocus(B)},te=B=>{S&&S(B),z&&z.onBlur&&z.onBlur(B)},U=B=>{if(B.nativeEvent.defaultPrevented)return;const O=B.target.checked;E(O),T&&T(B,O)};let K=d;z&&typeof K>"u"&&(K=z.disabled);const ce=_==="checkbox"||_==="radio",X=L({},s,{checked:G,disabled:K,disableFocusRipple:x,edge:l}),H=$o(X);return r.jsxs(So,L({component:"span",className:Be(H.root,p),centerRipple:!0,focusRipple:!x,disabled:K,tabIndex:null,role:void 0,onFocus:fe,onBlur:te,ownerState:X,ref:n},A,{children:[r.jsx(Do,L({autoFocus:e,checked:a,defaultChecked:i,className:H.input,disabled:K,id:ce?h:void 0,name:$,onChange:U,readOnly:j,ref:C,required:w,ownerState:X,tabIndex:k,type:_},_==="checkbox"&&I===void 0?{}:{value:I},v)),G?c:f]}))}),Ao=_o,No=m.createContext(),ht=No;function Lo(t){return Re("MuiGrid",t)}const Ro=[0,1,2,3,4,5,6,7,8,9,10],Io=["column-reverse","column","row-reverse","row"],zo=["nowrap","wrap-reverse","wrap"],ge=["auto",!0,1,2,3,4,5,6,7,8,9,10,11,12],Bo=Ie("MuiGrid",["root","container","item","zeroMinWidth",...Ro.map(t=>`spacing-xs-${t}`),...Io.map(t=>`direction-xs-${t}`),...zo.map(t=>`wrap-xs-${t}`),...ge.map(t=>`grid-xs-${t}`),...ge.map(t=>`grid-sm-${t}`),...ge.map(t=>`grid-md-${t}`),...ge.map(t=>`grid-lg-${t}`),...ge.map(t=>`grid-xl-${t}`)]),be=Bo,Fo=["className","columns","columnSpacing","component","container","direction","item","rowSpacing","spacing","wrap","zeroMinWidth"];function pe(t){const s=parseFloat(t);return`${s}${String(t).replace(String(s),"")||"px"}`}function Vo({theme:t,ownerState:s}){let n;return t.breakpoints.keys.reduce((e,a)=>{let c={};if(s[a]&&(n=s[a]),!n)return e;if(n===!0)c={flexBasis:0,flexGrow:1,maxWidth:"100%"};else if(n==="auto")c={flexBasis:"auto",flexGrow:0,flexShrink:0,maxWidth:"none",width:"auto"};else{const p=Pe({values:s.columns,breakpoints:t.breakpoints.values}),i=typeof p=="object"?p[a]:p;if(i==null)return e;const d=`${Math.round(n/i*1e8)/1e6}%`;let x={};if(s.container&&s.item&&s.columnSpacing!==0){const l=t.spacing(s.columnSpacing);if(l!=="0px"){const f=`calc(${d} + ${pe(l)})`;x={flexBasis:f,maxWidth:f}}}c=L({flexBasis:d,flexGrow:0,maxWidth:d},x)}return t.breakpoints.values[a]===0?Object.assign(e,c):e[t.breakpoints.up(a)]=c,e},{})}function Yo({theme:t,ownerState:s}){const n=Pe({values:s.direction,breakpoints:t.breakpoints.values});return Ve({theme:t},n,e=>{const a={flexDirection:e};return e.indexOf("column")===0&&(a[`& > .${be.item}`]={maxWidth:"none"}),a})}function jt({breakpoints:t,values:s}){let n="";Object.keys(s).forEach(a=>{n===""&&s[a]!==0&&(n=a)});const e=Object.keys(t).sort((a,c)=>t[a]-t[c]);return e.slice(0,e.indexOf(n))}function Uo({theme:t,ownerState:s}){const{container:n,rowSpacing:e}=s;let a={};if(n&&e!==0){const c=Pe({values:e,breakpoints:t.breakpoints.values});let p;typeof c=="object"&&(p=jt({breakpoints:t.breakpoints.values,values:c})),a=Ve({theme:t},c,(i,d)=>{var x;const l=t.spacing(i);return l!=="0px"?{marginTop:`-${pe(l)}`,[`& > .${be.item}`]:{paddingTop:pe(l)}}:(x=p)!=null&&x.includes(d)?{}:{marginTop:0,[`& > .${be.item}`]:{paddingTop:0}}})}return a}function Go({theme:t,ownerState:s}){const{container:n,columnSpacing:e}=s;let a={};if(n&&e!==0){const c=Pe({values:e,breakpoints:t.breakpoints.values});let p;typeof c=="object"&&(p=jt({breakpoints:t.breakpoints.values,values:c})),a=Ve({theme:t},c,(i,d)=>{var x;const l=t.spacing(i);return l!=="0px"?{width:`calc(100% + ${pe(l)})`,marginLeft:`-${pe(l)}`,[`& > .${be.item}`]:{paddingLeft:pe(l)}}:(x=p)!=null&&x.includes(d)?{}:{width:"100%",marginLeft:0,[`& > .${be.item}`]:{paddingLeft:0}}})}return a}function Wo(t,s,n={}){if(!t||t<=0)return[];if(typeof t=="string"&&!Number.isNaN(Number(t))||typeof t=="number")return[n[`spacing-xs-${String(t)}`]];const e=[];return s.forEach(a=>{const c=t[a];Number(c)>0&&e.push(n[`spacing-${a}-${String(c)}`])}),e}const Ho=ae("div",{name:"MuiGrid",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:n}=t,{container:e,direction:a,item:c,spacing:p,wrap:i,zeroMinWidth:d,breakpoints:x}=n;let l=[];e&&(l=Wo(p,x,s));const f=[];return x.forEach(h=>{const v=n[h];v&&f.push(s[`grid-${h}-${String(v)}`])}),[s.root,e&&s.container,c&&s.item,d&&s.zeroMinWidth,...l,a!=="row"&&s[`direction-xs-${String(a)}`],i!=="wrap"&&s[`wrap-xs-${String(i)}`],...f]}})(({ownerState:t})=>L({boxSizing:"border-box"},t.container&&{display:"flex",flexWrap:"wrap",width:"100%"},t.item&&{margin:0},t.zeroMinWidth&&{minWidth:0},t.wrap!=="wrap"&&{flexWrap:t.wrap}),Yo,Uo,Go,Vo);function Zo(t,s){if(!t||t<=0)return[];if(typeof t=="string"&&!Number.isNaN(Number(t))||typeof t=="number")return[`spacing-xs-${String(t)}`];const n=[];return s.forEach(e=>{const a=t[e];if(Number(a)>0){const c=`spacing-${e}-${String(a)}`;n.push(c)}}),n}const Ko=t=>{const{classes:s,container:n,direction:e,item:a,spacing:c,wrap:p,zeroMinWidth:i,breakpoints:d}=t;let x=[];n&&(x=Zo(c,d));const l=[];d.forEach(h=>{const v=t[h];v&&l.push(`grid-${h}-${String(v)}`)});const f={root:["root",n&&"container",a&&"item",i&&"zeroMinWidth",...x,e!=="row"&&`direction-xs-${String(e)}`,p!=="wrap"&&`wrap-xs-${String(p)}`,...l]};return Fe(f,Lo,s)},Xo=m.forwardRef(function(s,n){const e=wt({props:s,name:"MuiGrid"}),{breakpoints:a}=Vt(),c=po(e),{className:p,columns:i,columnSpacing:d,component:x="div",container:l=!1,direction:f="row",item:h=!1,rowSpacing:v,spacing:C=0,wrap:$="wrap",zeroMinWidth:S=!1}=c,T=ze(c,Fo),g=v||C,j=d||C,w=m.useContext(ht),k=l?i||12:w,_={},I=L({},T);a.keys.forEach(E=>{T[E]!=null&&(_[E]=T[E],delete I[E])});const A=L({},c,{columns:k,container:l,direction:f,item:h,rowSpacing:g,columnSpacing:j,wrap:$,zeroMinWidth:S,spacing:C},_,{breakpoints:a.keys}),G=Ko(A);return r.jsx(ht.Provider,{value:k,children:r.jsx(Ho,L({ownerState:A,className:Be(G.root,p),as:x,ref:n},I))})}),se=Xo;function qo(t){return Re("MuiSwitch",t)}const Qo=Ie("MuiSwitch",["root","edgeStart","edgeEnd","switchBase","colorPrimary","colorSecondary","sizeSmall","sizeMedium","checked","disabled","input","thumb","track"]),V=Qo,Jo=["className","color","edge","size","sx"],en=t=>{const{classes:s,edge:n,size:e,color:a,checked:c,disabled:p}=t,i={root:["root",n&&`edge${ie(n)}`,`size${ie(e)}`],switchBase:["switchBase",`color${ie(a)}`,c&&"checked",p&&"disabled"],thumb:["thumb"],track:["track"],input:["input"]},d=Fe(i,qo,s);return L({},s,d)},tn=ae("span",{name:"MuiSwitch",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:n}=t;return[s.root,n.edge&&s[`edge${ie(n.edge)}`],s[`size${ie(n.size)}`]]}})(({ownerState:t})=>L({display:"inline-flex",width:34+12*2,height:14+12*2,overflow:"hidden",padding:12,boxSizing:"border-box",position:"relative",flexShrink:0,zIndex:0,verticalAlign:"middle","@media print":{colorAdjust:"exact"}},t.edge==="start"&&{marginLeft:-8},t.edge==="end"&&{marginRight:-8},t.size==="small"&&{width:40,height:24,padding:7,[`& .${V.thumb}`]:{width:16,height:16},[`& .${V.switchBase}`]:{padding:4,[`&.${V.checked}`]:{transform:"translateX(16px)"}}})),on=ae(Ao,{name:"MuiSwitch",slot:"SwitchBase",overridesResolver:(t,s)=>{const{ownerState:n}=t;return[s.switchBase,{[`& .${V.input}`]:s.input},n.color!=="default"&&s[`color${ie(n.color)}`]]}})(({theme:t})=>({position:"absolute",top:0,left:0,zIndex:1,color:t.vars?t.vars.palette.Switch.defaultColor:`${t.palette.mode==="light"?t.palette.common.white:t.palette.grey[300]}`,transition:t.transitions.create(["left","transform"],{duration:t.transitions.duration.shortest}),[`&.${V.checked}`]:{transform:"translateX(20px)"},[`&.${V.disabled}`]:{color:t.vars?t.vars.palette.Switch.defaultDisabledColor:`${t.palette.mode==="light"?t.palette.grey[100]:t.palette.grey[600]}`},[`&.${V.checked} + .${V.track}`]:{opacity:.5},[`&.${V.disabled} + .${V.track}`]:{opacity:t.vars?t.vars.opacity.switchTrackDisabled:`${t.palette.mode==="light"?.12:.2}`},[`& .${V.input}`]:{left:"-100%",width:"300%"}}),({theme:t,ownerState:s})=>L({"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette.action.activeChannel} / ${t.vars.palette.action.hoverOpacity})`:rt(t.palette.action.active,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},s.color!=="default"&&{[`&.${V.checked}`]:{color:(t.vars||t).palette[s.color].main,"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette[s.color].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:rt(t.palette[s.color].main,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${V.disabled}`]:{color:t.vars?t.vars.palette.Switch[`${s.color}DisabledColor`]:`${t.palette.mode==="light"?Yt(t.palette[s.color].main,.62):Ut(t.palette[s.color].main,.55)}`}},[`&.${V.checked} + .${V.track}`]:{backgroundColor:(t.vars||t).palette[s.color].main}})),nn=ae("span",{name:"MuiSwitch",slot:"Track",overridesResolver:(t,s)=>s.track})(({theme:t})=>({height:"100%",width:"100%",borderRadius:14/2,zIndex:-1,transition:t.transitions.create(["opacity","background-color"],{duration:t.transitions.duration.shortest}),backgroundColor:t.vars?t.vars.palette.common.onBackground:`${t.palette.mode==="light"?t.palette.common.black:t.palette.common.white}`,opacity:t.vars?t.vars.opacity.switchTrack:`${t.palette.mode==="light"?.38:.3}`})),sn=ae("span",{name:"MuiSwitch",slot:"Thumb",overridesResolver:(t,s)=>s.thumb})(({theme:t})=>({boxShadow:(t.vars||t).shadows[1],backgroundColor:"currentColor",width:20,height:20,borderRadius:"50%"})),rn=m.forwardRef(function(s,n){const e=wt({props:s,name:"MuiSwitch"}),{className:a,color:c="primary",edge:p=!1,size:i="medium",sx:d}=e,x=ze(e,Jo),l=L({},e,{color:c,edge:p,size:i}),f=en(l),h=r.jsx(sn,{className:f.thumb,ownerState:l});return r.jsxs(tn,{className:Be(f.root,a),sx:d,ownerState:l,children:[r.jsx(on,L({type:"checkbox",icon:h,checkedIcon:h,ref:n,ownerState:l},x,{classes:L({},f,{root:f.switchBase})})),r.jsx(nn,{className:f.track,ownerState:l})]})}),an=rn,cn={schemas:[],links:[]},Et=Gt(t=>({...cn,setSchemas:s=>{t({schemas:s})},setSchemaLinks:s=>{t({links:s})}})),ln=/^[a-z0-9_]+$/,dn=({parentParam:t})=>{const[s,n]=m.useState(!1),[e,a]=m.useState([]),{fields:c,append:p,replace:i,remove:d}=so({name:"attributes"}),{setValue:x,watch:l}=ro();return m.useEffect(()=>{const f=async()=>{try{let h=[{required:!1,type:"string",key:""}];if(t!==fo.value.toLowerCase()){n(!0);const v=await Wt(t);h=go(v)}h=h.filter(v=>v.key!=="node_key"),i(h),a(h)}catch(h){console.warn(h)}finally{n(!1)}};e.length===0&&f()},[t,x,i,e.length]),r.jsxs(r.Fragment,{children:[s?r.jsx(P,{align:"center",children:r.jsx(ke,{color:R.SECONDARY_BLUE,size:"30"})}):r.jsx(un,{py:8,children:r.jsx(se,{container:!0,spacing:2,children:c.map((f,h)=>{const v=l(`attributes[${h}].type`),C=l(`attributes[${h}].required`),$=f.isNew||!1,S=["name"].includes(l(`attributes[${h}].key`));return r.jsxs(m.Fragment,{children:[r.jsx(se,{item:!0,xs:5,children:r.jsx(Le,{autoComplete:"off",className:"text-input",disabled:!$,id:"cy-item-name",maxLength:50,name:`attributes.${h}.key`,placeholder:"Enter value",rules:{...Ae,pattern:{message:"Please avoid special characters, spaces and uppercase",value:ln}}})}),r.jsx(se,{item:!0,xs:4,children:r.jsx(Ne,{disabled:S,onSelect:T=>x(`attributes[${h}].type`,T==null?void 0:T.value),options:ft,selectedValue:ft.find(T=>T.value===v)})}),r.jsxs(se,{item:!0,xs:3,children:[r.jsx(an,{checked:C,disabled:S,name:`attributes.${h}.required`,onChange:T=>x(`attributes[${h}].required`,T.target.checked),size:"small"}),!S&&r.jsx(io,{onClick:()=>d(h),children:r.jsx(ho,{})})]})]},f.id)})})}),r.jsx(P,{align:"flex-start",py:12,children:r.jsx(Ye,{onClick:()=>p({key:"",type:"string",required:!0,isNew:!0}),size:"medium",startIcon:r.jsx(mo,{}),variant:"contained",children:"Add Attribute"})})]})},un=W(P)`
  overflow-y: auto;
  width: calc(100% + 20px);
  max-height: calc(80vh - 300px);
`,pn=({parent:t})=>{const s=t;return r.jsxs(P,{children:[r.jsx(P,{direction:"row",mb:10,children:r.jsxs(se,{container:!0,spacing:2,children:[r.jsx(se,{item:!0,xs:5,children:r.jsx(Se,{style:{marginRight:180},children:"Attributes"})}),r.jsx(se,{item:!0,xs:4,children:r.jsx(Se,{style:{marginRight:130},children:"Type"})}),r.jsx(se,{item:!0,xs:3,children:r.jsx(Se,{children:"Required"})})]})}),s&&r.jsx(dn,{parentParam:s},s)]})},Se=W(ne)`
  font-size: 15px;
  color: gray;
`,fn={type:"",parent:""},hn=async(t,s=!1)=>{try{const{attributes:n,...e}=t,a={...e,attributes:bo(n)};let c;if(s?c=await Ee.put("/schema",JSON.stringify(a),{}):c=await Ee.post("/schema",JSON.stringify({...a,node_key:"name"}),{}),c.status!=="success")throw new Error("error");return c==null?void 0:c.ref_id}catch(n){let e=ue;if(n.status===400){const a=await n.json();e=a.errorCode||(a==null?void 0:a.status)||ue}else n instanceof Error&&(e=n.message);throw new Error(e)}},mn=t=>t.charAt(0).toUpperCase()+t.slice(1),mt=async(t,s)=>{try{const c=((await Ht()).schemas||[]).filter(p=>!p.is_deleted&&p.type&&(!s||s(p))).map(p=>p.type==="thing"?{label:"No Parent",value:p.type}:{label:mn(p.type),value:p.type});t(c)}catch(n){console.warn(n)}},gn=({graphLoading:t,onSchemaCreate:s,selectedSchema:n,onDelete:e,setSelectedSchemaId:a,setGraphLoading:c,setIsCreateNew:p,onSchemaUpdate:i})=>{const{close:d,visible:x}=vt("addType"),l=ao({mode:"onChange",defaultValues:n?{type:n.type,parent:n.parent}:fn}),{watch:f,setValue:h,reset:v,getValues:C}=l,[$,S]=m.useState(!1),[T,g]=m.useState(!1),[j,w]=m.useState(null),[k,_]=m.useState(!1),[I,A]=m.useState(null),[G,E]=m.useState(""),[z,fe]=m.useState(null);m.useEffect(()=>()=>{v()},[x,v]);const te=()=>{p(!1),a("")};m.useEffect(()=>{n||(g(!0),mt(w).finally(()=>g(!1)))},[n]),m.useEffect(()=>{n&&(h("type",n==null?void 0:n.type),h("parent",n.parent),mt(A,O=>O.type!==n.type&&O.type!==n.parent))},[n,h]);const U=f("parent"),K=()=>{d()},ce=async()=>{if(n!=null&&n.type)try{await Ee.delete(`/schema/${n.ref_id}`),e(n.type),d()}catch(O){let F=ue;if((O==null?void 0:O.status)===400){const Y=await O.json();F=Y.errorCode||(Y==null?void 0:Y.status)||ue}else O instanceof Error&&(F=O.message);fe(F)}finally{p(!1)}},X=l.handleSubmit(async O=>{if(!U){_(!0);return}S(!0);try{if(O.type!==(n==null?void 0:n.type)||C().parent!==(n==null?void 0:n.parent)){const Y=C().parent??(n==null?void 0:n.parent);c(!0),await Ee.put(`/schema/${n==null?void 0:n.ref_id}`,JSON.stringify({type:O.type,parent:Y})),await i()}const F=await hn({...O,...n?{ref_id:n==null?void 0:n.ref_id}:{}},!!n);s({type:O.type,parent:U||"",ref_id:(n==null?void 0:n.ref_id)||F||"new"}),K()}catch(F){let Y=ue;if((F==null?void 0:F.status)===400){const re=await F.json();Y=re.errorCode||(re==null?void 0:re.status)||ue}else F instanceof Error&&(Y=F.message);E(Y)}finally{S(!1),c(!1),p(!1)}}),H=()=>j==null?void 0:j.find(O=>O.value===U),B=()=>I==null?void 0:I.find(O=>O.value===U);return r.jsxs(P,{children:[r.jsx(P,{direction:"row",justify:"flex-end",children:r.jsx(xn,{"data-testid":"close-sidebar-sub-view",onClick:te,children:r.jsx(co,{})})}),r.jsx(P,{children:r.jsx(lo,{...l,children:r.jsxs("form",{id:"add-type-form",onSubmit:X,children:[r.jsx(P,{children:n?r.jsxs(r.Fragment,{children:[r.jsxs(P,{mb:12,children:[r.jsx(P,{mb:12,children:r.jsx(ne,{children:"Name"})}),r.jsx(P,{mb:12,children:r.jsx(Le,{defaultValue:n==null?void 0:n.type,id:"cy-item-name",maxLength:250,name:"type",placeholder:"Enter type name",rules:{...Ae},value:U})})]}),r.jsxs(P,{mb:12,children:[r.jsx(P,{mb:12,children:r.jsx(ne,{children:"Parent"})}),r.jsx(Ne,{isLoading:T||t,onSelect:O=>{h("parent",(O==null?void 0:O.value)||""),_(!1)},options:I||[],selectedValue:B()}),G&&r.jsx(De,{children:G})]})]}):r.jsxs(r.Fragment,{children:[r.jsxs(P,{mb:12,children:[r.jsx(P,{mb:12,children:r.jsx(ne,{children:"Select Parent"})}),r.jsx(Ne,{isLoading:T,onSelect:O=>{h("parent",(O==null?void 0:O.value)||""),_(!1)},options:j,selectedValue:H()}),k&&r.jsx(De,{children:"A parent type must be selected"})]}),r.jsxs(P,{children:[r.jsx(P,{mb:12,children:r.jsx(ne,{children:"Type name"})}),r.jsx(P,{mb:12,children:r.jsx(Le,{id:"cy-item-name",maxLength:250,name:"type",placeholder:"Enter type name",rules:{...Ae},value:U})})]})]})}),r.jsx(pn,{parent:n?n.type:U}),r.jsxs(P,{direction:"row",justify:"space-between",mt:20,children:[n?r.jsxs(P,{direction:"column",children:[r.jsx(bn,{color:"secondary",onClick:ce,size:"large",style:{marginRight:20},variant:"contained",children:"Delete"}),z&&r.jsx(De,{children:z})]}):null,r.jsx(Ye,{color:"secondary",disabled:$||k,onClick:X,size:"large",startIcon:$?r.jsx(ke,{color:R.white,size:10}):null,variant:"contained",children:"Save"})]})]})})})]})},bn=W(Ye)`
  && {
    color: ${R.primaryRed};
    background-color: rgba(237, 116, 116, 0.1);

    &:hover,
    &:active,
    &:focus {
      color: ${R.primaryRed};
      background-color: rgba(237, 116, 116, 0.2);
    }
  }
`,xn=W(P)`
  font-size: 32px;
  color: ${R.white};
  cursor: pointer;
`,De=W(P)`
  font-size: 13px;
  font-family: Barlow;
  color: #ff8f80;
  line-height: 0.2px;
  margin-top: 12px;
  padding-top: 20px;
`;var yn=Object.defineProperty,wn=(t,s,n)=>s in t?yn(t,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[s]=n,b=(t,s,n)=>(wn(t,typeof s!="symbol"?s+"":s,n),n);const je=new Zt,gt=new Kt,vn=Math.cos(70*(Math.PI/180)),bt=(t,s)=>(t%s+s)%s;let jn=class extends Xt{constructor(s,n){super(),b(this,"object"),b(this,"domElement"),b(this,"enabled",!0),b(this,"target",new D),b(this,"minDistance",0),b(this,"maxDistance",1/0),b(this,"minZoom",0),b(this,"maxZoom",1/0),b(this,"minPolarAngle",0),b(this,"maxPolarAngle",Math.PI),b(this,"minAzimuthAngle",-1/0),b(this,"maxAzimuthAngle",1/0),b(this,"enableDamping",!1),b(this,"dampingFactor",.05),b(this,"enableZoom",!0),b(this,"zoomSpeed",1),b(this,"enableRotate",!0),b(this,"rotateSpeed",1),b(this,"enablePan",!0),b(this,"panSpeed",1),b(this,"screenSpacePanning",!0),b(this,"keyPanSpeed",7),b(this,"zoomToCursor",!1),b(this,"autoRotate",!1),b(this,"autoRotateSpeed",2),b(this,"reverseOrbit",!1),b(this,"reverseHorizontalOrbit",!1),b(this,"reverseVerticalOrbit",!1),b(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),b(this,"mouseButtons",{LEFT:le.ROTATE,MIDDLE:le.DOLLY,RIGHT:le.PAN}),b(this,"touches",{ONE:de.ROTATE,TWO:de.DOLLY_PAN}),b(this,"target0"),b(this,"position0"),b(this,"zoom0"),b(this,"_domElementKeyEvents",null),b(this,"getPolarAngle"),b(this,"getAzimuthalAngle"),b(this,"setPolarAngle"),b(this,"setAzimuthalAngle"),b(this,"getDistance"),b(this,"listenToKeyEvents"),b(this,"stopListenToKeyEvents"),b(this,"saveState"),b(this,"reset"),b(this,"update"),b(this,"connect"),b(this,"dispose"),this.object=s,this.domElement=n,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>l.phi,this.getAzimuthalAngle=()=>l.theta,this.setPolarAngle=o=>{let u=bt(o,2*Math.PI),y=l.phi;y<0&&(y+=2*Math.PI),u<0&&(u+=2*Math.PI);let M=Math.abs(u-y);2*Math.PI-M<M&&(u<y?u+=2*Math.PI:y+=2*Math.PI),f.phi=u-y,e.update()},this.setAzimuthalAngle=o=>{let u=bt(o,2*Math.PI),y=l.theta;y<0&&(y+=2*Math.PI),u<0&&(u+=2*Math.PI);let M=Math.abs(u-y);2*Math.PI-M<M&&(u<y?u+=2*Math.PI:y+=2*Math.PI),f.theta=u-y,e.update()},this.getDistance=()=>e.object.position.distanceTo(e.target),this.listenToKeyEvents=o=>{o.addEventListener("keydown",Me),this._domElementKeyEvents=o},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",Me),this._domElementKeyEvents=null},this.saveState=()=>{e.target0.copy(e.target),e.position0.copy(e.object.position),e.zoom0=e.object.zoom},this.reset=()=>{e.target.copy(e.target0),e.object.position.copy(e.position0),e.object.zoom=e.zoom0,e.object.updateProjectionMatrix(),e.dispatchEvent(a),e.update(),d=i.NONE},this.update=(()=>{const o=new D,u=new D(0,1,0),y=new it().setFromUnitVectors(s.up,u),M=y.clone().invert(),N=new D,q=new it,oe=2*Math.PI;return function(){const st=e.object.position;y.setFromUnitVectors(s.up,u),M.copy(y).invert(),o.copy(st).sub(e.target),o.applyQuaternion(y),l.setFromVector3(o),e.autoRotate&&d===i.NONE&&U(fe()),e.enableDamping?(l.theta+=f.theta*e.dampingFactor,l.phi+=f.phi*e.dampingFactor):(l.theta+=f.theta,l.phi+=f.phi);let Q=e.minAzimuthAngle,J=e.maxAzimuthAngle;isFinite(Q)&&isFinite(J)&&(Q<-Math.PI?Q+=oe:Q>Math.PI&&(Q-=oe),J<-Math.PI?J+=oe:J>Math.PI&&(J-=oe),Q<=J?l.theta=Math.max(Q,Math.min(J,l.theta)):l.theta=l.theta>(Q+J)/2?Math.max(Q,l.theta):Math.min(J,l.theta)),l.phi=Math.max(e.minPolarAngle,Math.min(e.maxPolarAngle,l.phi)),l.makeSafe(),e.enableDamping===!0?e.target.addScaledVector(v,e.dampingFactor):e.target.add(v),e.zoomToCursor&&G||e.object.isOrthographicCamera?l.radius=Y(l.radius):l.radius=Y(l.radius*h),o.setFromSpherical(l),o.applyQuaternion(M),st.copy(e.target).add(o),e.object.matrixAutoUpdate||e.object.updateMatrix(),e.object.lookAt(e.target),e.enableDamping===!0?(f.theta*=1-e.dampingFactor,f.phi*=1-e.dampingFactor,v.multiplyScalar(1-e.dampingFactor)):(f.set(0,0,0),v.set(0,0,0));let xe=!1;if(e.zoomToCursor&&G){let he=null;if(e.object instanceof we&&e.object.isPerspectiveCamera){const me=o.length();he=Y(me*h);const ye=me-he;e.object.position.addScaledVector(I,ye),e.object.updateMatrixWorld()}else if(e.object.isOrthographicCamera){const me=new D(A.x,A.y,0);me.unproject(e.object),e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/h)),e.object.updateProjectionMatrix(),xe=!0;const ye=new D(A.x,A.y,0);ye.unproject(e.object),e.object.position.sub(ye).add(me),e.object.updateMatrixWorld(),he=o.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),e.zoomToCursor=!1;he!==null&&(e.screenSpacePanning?e.target.set(0,0,-1).transformDirection(e.object.matrix).multiplyScalar(he).add(e.object.position):(je.origin.copy(e.object.position),je.direction.set(0,0,-1).transformDirection(e.object.matrix),Math.abs(e.object.up.dot(je.direction))<vn?s.lookAt(e.target):(gt.setFromNormalAndCoplanarPoint(e.object.up,e.target),je.intersectPlane(gt,e.target))))}else e.object instanceof ve&&e.object.isOrthographicCamera&&(e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/h)),e.object.updateProjectionMatrix(),xe=!0);return h=1,G=!1,xe||N.distanceToSquared(e.object.position)>x||8*(1-q.dot(e.object.quaternion))>x?(e.dispatchEvent(a),N.copy(e.object.position),q.copy(e.object.quaternion),xe=!1,!0):!1}})(),this.connect=o=>{o===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),e.domElement=o,e.domElement.style.touchAction="none",e.domElement.addEventListener("contextmenu",tt),e.domElement.addEventListener("pointerdown",Qe),e.domElement.addEventListener("pointercancel",Je),e.domElement.addEventListener("wheel",et)},this.dispose=()=>{var o,u,y,M,N,q;(o=e.domElement)==null||o.removeEventListener("contextmenu",tt),(u=e.domElement)==null||u.removeEventListener("pointerdown",Qe),(y=e.domElement)==null||y.removeEventListener("pointercancel",Je),(M=e.domElement)==null||M.removeEventListener("wheel",et),(N=e.domElement)==null||N.ownerDocument.removeEventListener("pointermove",Te),(q=e.domElement)==null||q.ownerDocument.removeEventListener("pointerup",Oe),e._domElementKeyEvents!==null&&e._domElementKeyEvents.removeEventListener("keydown",Me)};const e=this,a={type:"change"},c={type:"start"},p={type:"end"},i={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let d=i.NONE;const x=1e-6,l=new at,f=new at;let h=1;const v=new D,C=new Z,$=new Z,S=new Z,T=new Z,g=new Z,j=new Z,w=new Z,k=new Z,_=new Z,I=new D,A=new Z;let G=!1;const E=[],z={};function fe(){return 2*Math.PI/60/60*e.autoRotateSpeed}function te(){return Math.pow(.95,e.zoomSpeed)}function U(o){e.reverseOrbit||e.reverseHorizontalOrbit?f.theta+=o:f.theta-=o}function K(o){e.reverseOrbit||e.reverseVerticalOrbit?f.phi+=o:f.phi-=o}const ce=(()=>{const o=new D;return function(y,M){o.setFromMatrixColumn(M,0),o.multiplyScalar(-y),v.add(o)}})(),X=(()=>{const o=new D;return function(y,M){e.screenSpacePanning===!0?o.setFromMatrixColumn(M,1):(o.setFromMatrixColumn(M,0),o.crossVectors(e.object.up,o)),o.multiplyScalar(y),v.add(o)}})(),H=(()=>{const o=new D;return function(y,M){const N=e.domElement;if(N&&e.object instanceof we&&e.object.isPerspectiveCamera){const q=e.object.position;o.copy(q).sub(e.target);let oe=o.length();oe*=Math.tan(e.object.fov/2*Math.PI/180),ce(2*y*oe/N.clientHeight,e.object.matrix),X(2*M*oe/N.clientHeight,e.object.matrix)}else N&&e.object instanceof ve&&e.object.isOrthographicCamera?(ce(y*(e.object.right-e.object.left)/e.object.zoom/N.clientWidth,e.object.matrix),X(M*(e.object.top-e.object.bottom)/e.object.zoom/N.clientHeight,e.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),e.enablePan=!1)}})();function B(o){e.object instanceof we&&e.object.isPerspectiveCamera||e.object instanceof ve&&e.object.isOrthographicCamera?h/=o:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function O(o){e.object instanceof we&&e.object.isPerspectiveCamera||e.object instanceof ve&&e.object.isOrthographicCamera?h*=o:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function F(o){if(!e.zoomToCursor||!e.domElement)return;G=!0;const u=e.domElement.getBoundingClientRect(),y=o.clientX-u.left,M=o.clientY-u.top,N=u.width,q=u.height;A.x=y/N*2-1,A.y=-(M/q)*2+1,I.set(A.x,A.y,1).unproject(e.object).sub(e.object.position).normalize()}function Y(o){return Math.max(e.minDistance,Math.min(e.maxDistance,o))}function re(o){C.set(o.clientX,o.clientY)}function Ct(o){F(o),w.set(o.clientX,o.clientY)}function Ge(o){T.set(o.clientX,o.clientY)}function Tt(o){$.set(o.clientX,o.clientY),S.subVectors($,C).multiplyScalar(e.rotateSpeed);const u=e.domElement;u&&(U(2*Math.PI*S.x/u.clientHeight),K(2*Math.PI*S.y/u.clientHeight)),C.copy($),e.update()}function Ot(o){k.set(o.clientX,o.clientY),_.subVectors(k,w),_.y>0?B(te()):_.y<0&&O(te()),w.copy(k),e.update()}function Mt(o){g.set(o.clientX,o.clientY),j.subVectors(g,T).multiplyScalar(e.panSpeed),H(j.x,j.y),T.copy(g),e.update()}function $t(o){F(o),o.deltaY<0?O(te()):o.deltaY>0&&B(te()),e.update()}function St(o){let u=!1;switch(o.code){case e.keys.UP:H(0,e.keyPanSpeed),u=!0;break;case e.keys.BOTTOM:H(0,-e.keyPanSpeed),u=!0;break;case e.keys.LEFT:H(e.keyPanSpeed,0),u=!0;break;case e.keys.RIGHT:H(-e.keyPanSpeed,0),u=!0;break}u&&(o.preventDefault(),e.update())}function We(){if(E.length==1)C.set(E[0].pageX,E[0].pageY);else{const o=.5*(E[0].pageX+E[1].pageX),u=.5*(E[0].pageY+E[1].pageY);C.set(o,u)}}function He(){if(E.length==1)T.set(E[0].pageX,E[0].pageY);else{const o=.5*(E[0].pageX+E[1].pageX),u=.5*(E[0].pageY+E[1].pageY);T.set(o,u)}}function Ze(){const o=E[0].pageX-E[1].pageX,u=E[0].pageY-E[1].pageY,y=Math.sqrt(o*o+u*u);w.set(0,y)}function Dt(){e.enableZoom&&Ze(),e.enablePan&&He()}function _t(){e.enableZoom&&Ze(),e.enableRotate&&We()}function Ke(o){if(E.length==1)$.set(o.pageX,o.pageY);else{const y=$e(o),M=.5*(o.pageX+y.x),N=.5*(o.pageY+y.y);$.set(M,N)}S.subVectors($,C).multiplyScalar(e.rotateSpeed);const u=e.domElement;u&&(U(2*Math.PI*S.x/u.clientHeight),K(2*Math.PI*S.y/u.clientHeight)),C.copy($)}function Xe(o){if(E.length==1)g.set(o.pageX,o.pageY);else{const u=$e(o),y=.5*(o.pageX+u.x),M=.5*(o.pageY+u.y);g.set(y,M)}j.subVectors(g,T).multiplyScalar(e.panSpeed),H(j.x,j.y),T.copy(g)}function qe(o){const u=$e(o),y=o.pageX-u.x,M=o.pageY-u.y,N=Math.sqrt(y*y+M*M);k.set(0,N),_.set(0,Math.pow(k.y/w.y,e.zoomSpeed)),B(_.y),w.copy(k)}function At(o){e.enableZoom&&qe(o),e.enablePan&&Xe(o)}function Nt(o){e.enableZoom&&qe(o),e.enableRotate&&Ke(o)}function Qe(o){var u,y;e.enabled!==!1&&(E.length===0&&((u=e.domElement)==null||u.ownerDocument.addEventListener("pointermove",Te),(y=e.domElement)==null||y.ownerDocument.addEventListener("pointerup",Oe)),Bt(o),o.pointerType==="touch"?It(o):Lt(o))}function Te(o){e.enabled!==!1&&(o.pointerType==="touch"?zt(o):Rt(o))}function Oe(o){var u,y,M;ot(o),E.length===0&&((u=e.domElement)==null||u.releasePointerCapture(o.pointerId),(y=e.domElement)==null||y.ownerDocument.removeEventListener("pointermove",Te),(M=e.domElement)==null||M.ownerDocument.removeEventListener("pointerup",Oe)),e.dispatchEvent(p),d=i.NONE}function Je(o){ot(o)}function Lt(o){let u;switch(o.button){case 0:u=e.mouseButtons.LEFT;break;case 1:u=e.mouseButtons.MIDDLE;break;case 2:u=e.mouseButtons.RIGHT;break;default:u=-1}switch(u){case le.DOLLY:if(e.enableZoom===!1)return;Ct(o),d=i.DOLLY;break;case le.ROTATE:if(o.ctrlKey||o.metaKey||o.shiftKey){if(e.enablePan===!1)return;Ge(o),d=i.PAN}else{if(e.enableRotate===!1)return;re(o),d=i.ROTATE}break;case le.PAN:if(o.ctrlKey||o.metaKey||o.shiftKey){if(e.enableRotate===!1)return;re(o),d=i.ROTATE}else{if(e.enablePan===!1)return;Ge(o),d=i.PAN}break;default:d=i.NONE}d!==i.NONE&&e.dispatchEvent(c)}function Rt(o){if(e.enabled!==!1)switch(d){case i.ROTATE:if(e.enableRotate===!1)return;Tt(o);break;case i.DOLLY:if(e.enableZoom===!1)return;Ot(o);break;case i.PAN:if(e.enablePan===!1)return;Mt(o);break}}function et(o){e.enabled===!1||e.enableZoom===!1||d!==i.NONE&&d!==i.ROTATE||(o.preventDefault(),e.dispatchEvent(c),$t(o),e.dispatchEvent(p))}function Me(o){e.enabled===!1||e.enablePan===!1||St(o)}function It(o){switch(nt(o),E.length){case 1:switch(e.touches.ONE){case de.ROTATE:if(e.enableRotate===!1)return;We(),d=i.TOUCH_ROTATE;break;case de.PAN:if(e.enablePan===!1)return;He(),d=i.TOUCH_PAN;break;default:d=i.NONE}break;case 2:switch(e.touches.TWO){case de.DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;Dt(),d=i.TOUCH_DOLLY_PAN;break;case de.DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;_t(),d=i.TOUCH_DOLLY_ROTATE;break;default:d=i.NONE}break;default:d=i.NONE}d!==i.NONE&&e.dispatchEvent(c)}function zt(o){switch(nt(o),d){case i.TOUCH_ROTATE:if(e.enableRotate===!1)return;Ke(o),e.update();break;case i.TOUCH_PAN:if(e.enablePan===!1)return;Xe(o),e.update();break;case i.TOUCH_DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;At(o),e.update();break;case i.TOUCH_DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;Nt(o),e.update();break;default:d=i.NONE}}function tt(o){e.enabled!==!1&&o.preventDefault()}function Bt(o){E.push(o)}function ot(o){delete z[o.pointerId];for(let u=0;u<E.length;u++)if(E[u].pointerId==o.pointerId){E.splice(u,1);return}}function nt(o){let u=z[o.pointerId];u===void 0&&(u=new Z,z[o.pointerId]=u),u.set(o.pageX,o.pageY)}function $e(o){const u=o.pointerId===E[0].pointerId?E[1]:E[0];return z[u.pointerId]}n!==void 0&&this.connect(n),this.update()}};const En=new D,kn=m.forwardRef(function({start:s=[0,0,0],end:n=[0,0,0],mid:e,segments:a=20,...c},p){const i=m.useRef(null),[d]=m.useState(()=>new qt(void 0,void 0,void 0)),x=m.useCallback((f,h,v,C=20)=>(f instanceof D?d.v0.copy(f):d.v0.set(...f),h instanceof D?d.v2.copy(h):d.v2.set(...h),v instanceof D?d.v1.copy(v):d.v1.copy(d.v0.clone().add(d.v2.clone().sub(d.v0)).add(En.set(0,d.v0.y-d.v2.y,0))),d.getPoints(C)),[]);m.useLayoutEffect(()=>{i.current.setPoints=(f,h,v)=>{const C=x(f,h,v);i.current.geometry&&i.current.geometry.setPositions(C.map($=>$.toArray()).flat())}},[]);const l=m.useMemo(()=>x(s,n,e,a),[s,n,e,a]);return m.createElement(wo,L({ref:vo([i,p]),points:l},c))}),Pn=m.forwardRef(({makeDefault:t,camera:s,regress:n,domElement:e,enableDamping:a=!0,onChange:c,onStart:p,onEnd:i,...d},x)=>{const l=ee(k=>k.invalidate),f=ee(k=>k.camera),h=ee(k=>k.gl),v=ee(k=>k.events),C=ee(k=>k.setEvents),$=ee(k=>k.set),S=ee(k=>k.get),T=ee(k=>k.performance),g=s||f,j=e||v.connected||h.domElement,w=m.useMemo(()=>new jn(g),[g]);return Ce(()=>{w.enabled&&w.update()},-1),m.useEffect(()=>(w.connect(j),()=>void w.dispose()),[j,n,w,l]),m.useEffect(()=>{const k=A=>{l(),n&&T.regress(),c&&c(A)},_=A=>{p&&p(A)},I=A=>{i&&i(A)};return w.addEventListener("change",k),w.addEventListener("start",_),w.addEventListener("end",I),()=>{w.removeEventListener("start",_),w.removeEventListener("end",I),w.removeEventListener("change",k)}},[c,p,i,w,l,C]),m.useEffect(()=>{if(t){const k=S().controls;return $({controls:w}),()=>$({controls:k})}},[t,w]),m.createElement("primitive",L({ref:x,object:w,enableDamping:a},d))});function Cn(t){const s=t+"Geometry";return m.forwardRef(({args:n,children:e,...a},c)=>m.createElement("mesh",L({ref:c},a),m.createElement(s,{attach:"geometry",args:n}),e))}const Tn=Cn("circle"),xt=t=>{const s=m.useRef();return m.useEffect(()=>{s.current=t}),s.current},Ue=10,On=2,yt=2,Mn=(t,s,n)=>{const c=new D().subVectors(s,t).normalize().multiplyScalar(n);return new D().addVectors(t,c)},kt=({links:t,nodes:s})=>{const n=m.useRef(null);return Ce(()=>{n.current&&s&&n.current.children.forEach((e,a)=>{var $;const c=t[a];if(!c)return;const p=s.find(S=>S.ref_id===c.source),i=s.find(S=>S.ref_id===c.target),d=new D((i==null?void 0:i.x)||0,(i==null?void 0:i.y)||0,(i==null?void 0:i.z)||0),x=new D((p==null?void 0:p.x)||0,(p==null?void 0:p.y)||0,(p==null?void 0:p.z)||0),l=Mn(x,d,Ue+yt),f=d.clone(),h=new D().lerpVectors(f,l,0),v=e.children[0],C=e.children[1];C.position.set(l.x,l.y,l.z),C.lookAt(f),C.rotateX(-Math.PI/2),($=v.setPoints)==null||$.call(v,f,l,h)})}),r.jsx("group",{ref:n,children:t.map(e=>r.jsxs("group",{children:[r.jsx(kn,{color:"white",end:[0,0,0],lineWidth:2,start:[0,0,0]}),r.jsxs("mesh",{position:new D(0,0,0),children:[r.jsx("coneGeometry",{args:[On,yt,32]}),r.jsx("meshBasicMaterial",{color:"white"})]})]},e.ref_id))})};kt.displayName="Lines";const $n=["#ff13c9","#5af0ff","#3233ff","#c2f0c2","#ff6666","#99ccff","#ffb3b3"];new Qt(2,2,2);const Pt=m.memo(({node:t,setSelectedNode:s,onSimulationUpdate:n,isSelected:e})=>{var l;const a=m.useRef(null);console.log(e);const{size:c,camera:p}=ee(),i=uo(f=>{const{xy:[h,v],down:C,dragging:$,first:S,elapsedTime:T}=f;if(!(!$||S||T<100)&&C&&a.current){n();const g=(h-c.left)/window.innerWidth*c.width,j=(v-c.top)/window.innerHeight*c.height,_=new D(g/c.width*2-1,-j/c.height*2+1,0).unproject(p).multiply(new D(1,1,0)).clone();t.fx=_.x,t.fy=_.y}});Ce(()=>{a.current&&a.current.position.set(t.x||0,t.y||0,0)});const d=$n[(l=t==null?void 0:t.children)==null?void 0:l.length]||"red",x=f=>{f.stopPropagation(),s()};return r.jsxs("mesh",{ref:a,onClick:x,...i(),position:new D(t.x,t.y,0),children:[r.jsx(Tn,{args:[Ue,30,20],children:r.jsx("meshStandardMaterial",{attach:"material",color:d})}),r.jsx(jo,{...ko,color:"#000",fontSize:2,children:t.type})]})});Pt.displayName="Node";const Sn=({simulation:t,setSelectedSchemaId:s,selectedId:n})=>{const[e]=Et(c=>[c.schemas]),a=()=>{t&&(t.alpha(.05),t.restart())};return r.jsx(r.Fragment,{children:e.map((c,p)=>{const i=t.nodes()[p];return i?r.jsx(Pt,{isSelected:i.ref_id===n,node:i,onSimulationUpdate:a,setSelectedNode:()=>s(i.ref_id)},i.ref_id):null})})},Dn=({schemasWithPositions:t,filteredLinks:s,setSelectedSchemaId:n,selectedSchemaId:e})=>{const[a,c]=m.useState(null),p=xt(t),i=xt(s);return m.useEffect(()=>{if(!t.length||!s.length)return;const d=structuredClone(t),x=structuredClone(s);if(a){p&&p.length!==t.length&&i&&i.length!==s.length&&(a.nodes(d).force("link",ct(x).id(f=>f.ref_id)).force("charge",lt()).force("center",dt()).force("collide",ut(Ue+1)).alpha(.5).restart(),c({...a}));return}const l=Jt(d).force("link",ct(x).id(f=>f.ref_id)).force("charge",lt()).force("center",dt()).force("collide",ut(0));c(l)},[t,a,s,p,i]),Ce(()=>{}),a?r.jsxs(r.Fragment,{children:[r.jsx(kt,{links:s,nodes:a.nodes()}),r.jsx(Sn,{selectedId:e,setSelectedSchemaId:n,simulation:a})]}):null},_e=new eo(0),_n=({selectedSchemaId:t,links:s,schemasWithPositions:n,setSelectedSchemaId:e})=>r.jsxs(Eo,{camera:{zoom:1,position:[0,0,200]},id:"schema-canvas",linear:!0,orthographic:!0,children:[r.jsx("color",{args:[_e.r,_e.g,_e.b],attach:"background"}),to&&r.jsx(Po,{position:"right-bottom"}),r.jsx(Pn,{enableRotate:!1,enableZoom:!0}),r.jsx(Co,{}),r.jsx(Dn,{filteredLinks:s,schemasWithPositions:n,selectedSchemaId:t,setSelectedSchemaId:e})]}),An=({onCreateNew:t})=>r.jsxs(Nn,{children:[r.jsx(Rn,{children:"BLUEPRINT"}),r.jsxs(Ln,{"data-testid":"add-schema-type",onClick:t,children:[r.jsx(In,{children:r.jsx(To,{})}),r.jsx(ne,{children:"Add Type"})]})]}),Nn=W(P).attrs({align:"flex-start",direction:"column",justify:"flex-start"})`
  flex: 1 1 auto;
  z-index: 31;
  transition: opacity 1s;
  background: ${R.BG2};
  overflow: hidden;
  max-height: 100vh;

  @media (max-width: 1440px) {
    max-height: 95.2vh;
  }

  @media (max-width: 1024px) {
    max-height: 74.8vh;
  }

  @media (max-width: 924px) {
    max-height: 73.1vh;
  }
`,Ln=W(P).attrs({align:"center",justify:"center",p:0})`
  position: relative;
  width: 64px;
  height: 58px;
  padding: 0;
  flex-direction: row;
  color: ${R.GRAY6};
  cursor: pointer;
  transition: ${({theme:t})=>t.transitions.create(["opacity","box-shadow","background-color"])};

  &:before {
    content: '';
    position: absolute;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    width: 4px; /* Initial width */
    height: 32px; /* Initial height on hover */
    background-color: transparent;
    transition: height 0.3s, width 0.3s, background-color 0.3s;
  }

  ${ne} {
    display: none;
    opacity: 0;
    width: 0;
    padding: 4px 10px;
    border-radius: 4px;
    background: #000;
    box-shadow: 0px 4px 8px 0px rgba(0, 0, 0, 0.25);
    position: absolute;
    left: 90%;
    z-index: 99;
    white-space: nowrap;
    visibility: visible;
    font-size: 11px;
    font-style: normal;
    font-weight: 400;
    transition: ${({theme:t})=>t.transitions.create(["opacity","visually"])};
  }

  &:hover {
    color: ${R.white};

    &:before {
      width: 3px;
      height: 32px;
      background-color: ${R.primaryBlue};
    }

    ${ne} {
      display: block;
      width: min-content;
      opacity: 1;
      visibility: visible;
    }
  }

  &:active {
    color: ${R.white};
    background: ${R.black};
    &:before {
      width: 3px;
      height: 100%;
      background-color: ${R.primaryBlue};
    }
  }

  &.root {
    border-radius: 50%;
    padding: 0;
    align-items: center;
    justify-content: center;
    border: none;
  }
`,Rn=W(P)`
  background: blue;
  align-items: center;
  justify-content: center;
  background: ${R.primaryBlue};
  width: 64px;
  height: 64px;
  cursor: pointer;
  font-size: 10px;
  font-weight: 600;
  color: ${R.white};
`,In=W(P)`
  justify-content: center;
  align-items: center;
  font-size: 24px;
`,zn=()=>{const[t,s]=m.useState(""),[n,e]=m.useState(!1),[a,c]=m.useState(!1),[p,i]=m.useState(!1),[d,x,l,f]=Et(g=>[g.schemas,g.links,g.setSchemas,g.setSchemaLinks]);m.useEffect(()=>{(async()=>{c(!0);try{const j=await pt();l(j.schemas.filter(w=>w.ref_id&&!w.is_deleted&&w.ref_id)),f(j.edges),c(!1)}catch(j){console.error("Error fetching data:",j),c(!1)}})()},[l,f]);const h=g=>{if(d.some(w=>w.ref_id===g.ref_id))l(d.map(w=>w.ref_id===g.ref_id?{...g,children:[]}:w));else{l([...d,{...g,children:[]}]);const w=d.find(k=>g.parent===k.type);f([...x,{ref_id:`new-link-${x.length}`,edge_type:"CHILD_OF",source:g.ref_id||"new",target:(w==null?void 0:w.ref_id)||"new"}])}},v=async()=>{const g=await pt();l(g.schemas.filter(j=>j.ref_id&&!j.is_deleted&&j.ref_id)),f(g.edges)},C=g=>{l(d.filter(j=>j.type!==g))},$=d.map(g=>({...g,children:d.filter(j=>j.parent===g.type).map(j=>j.ref_id||"")})),S=x.filter(g=>g.edge_type==="CHILD_OF"&&$.some(j=>j.ref_id===g.source)&&$.some(j=>j.ref_id===g.target)),T=d.find(g=>g.ref_id===t)||null;return a?r.jsx(P,{align:"center",basis:"100%",grow:1,justify:"center",shrink:1,children:r.jsx(ke,{color:R.white})}):r.jsx(r.Fragment,{children:r.jsxs(P,{align:"stretch",direction:"row",grow:1,children:[r.jsx(P,{ml:-20,my:-20,children:r.jsx(An,{onCreateNew:()=>{e(!0),s("")}})}),r.jsx(P,{children:T||n?r.jsx(Fn,{children:r.jsx(gn,{graphLoading:p,onDelete:C,onSchemaCreate:h,onSchemaUpdate:v,selectedSchema:T,setGraphLoading:i,setIsCreateNew:e,setSelectedSchemaId:s})}):null}),r.jsx(Bn,{direction:"row",grow:1,children:r.jsx(Vn,{children:p?r.jsx(P,{align:"center",basis:"100%",grow:1,justify:"center",shrink:1,children:r.jsx(ke,{color:R.white})}):r.jsx(_n,{links:S,schemasWithPositions:$,selectedSchemaId:t,setSelectedSchemaId:s})})})]})})},Bn=W(P)`
  flex: 1 1 auto;
  justify-content: center;
  position: relative;
  overflow: hidden;
  padding: 10px;
  max-height: 80vh;

  @media (max-width: 1440px) {
    max-height: 85vh;
  }

  @media (max-width: 1024px) {
    max-height: 70vh;
  }
`,Fn=W(P)`
  width: 100%;
  max-width: 400px;
  background: ${R.BG1};
  padding: 16px;
  border-top-right-radius: 16px;
  border-bottom-right-radius: 16px;
  flex-grow: 1;
  flex-shrink: 1;
  min-width: 300px;
  overflow: auto;
  max-height: calc(100vh - 20px);

  @media (max-width: 1440px) {
    max-height: calc(95vh - 20px);
  }

  @media (max-width: 1024px) {
    max-height: calc(70vh - 20px);
  }

  @media (max-width: 924px) {
    max-height: calc(70vh - 20px);
  }
`,Vn=W(P)`
  flex: 1 1 100%;
`,Yn=()=>{const{close:t}=vt("blueprintGraph"),s=()=>{t()};return r.jsx(oo,{background:"black",id:"blueprintGraph",kind:"full",onClose:s,preventOutsideClose:!0,children:r.jsx(zn,{})})},hs=m.memo(Yn);export{hs as BlueprintModal};
