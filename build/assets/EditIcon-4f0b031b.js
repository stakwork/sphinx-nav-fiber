import{r as P,bB as ar,bC as $h,Z as Ue,bg as Re,_ as xa,bD as Qh,am as Ss,bE as Kh,bF as Jh,j as is,ba as wa,bG as _t,bH as In,bI as ed,bJ as Xn,bK as as,bL as td,bM as sd,bN as nd,bO as id,bP as rd,bQ as cr,aI as lr,bR as Yt,bS as od,bT as X,bU as ad,bV as fs,bW as jo,bd as bl,bX as Sa,bt as xc,aq as cd,bY as Ar,bZ as ld,an as Cl,bv as El,b_ as Ol,b$ as Al,c0 as wc,c1 as ud,c2 as hd,aJ as ur,H as Yo,c3 as dd,a0 as fd}from"./index-50ecd99b.js";import{u as we,e as ba,b as Ca,h as pd,i as md,j as _d,m as gd,k as vd}from"./constant-458df969.js";import{_ as Pe,w as Ft}from"./react-toastify.esm-fd33ffdd.js";function yd(n){let e;const t=new Set,s=(l,u)=>{const h=typeof l=="function"?l(e):l;if(h!==e){const d=e;e=u?h:Object.assign({},e,h),t.forEach(f=>f(e,d))}},i=()=>e,r=(l,u=i,h=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let d=u(e);function f(){const m=u(e);if(!h(d,m)){const p=d;l(d=m,p)}}return t.add(f),()=>t.delete(f)},c={setState:s,getState:i,subscribe:(l,u,h)=>u||h?r(l,u,h):(t.add(l),()=>t.delete(l)),destroy:()=>t.clear()};return e=n(s,i,c),c}const Td=typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),Sc=Td?P.useEffect:P.useLayoutEffect;function xd(n){const e=typeof n=="function"?yd(n):n,t=(s=e.getState,i=Object.is)=>{const[,r]=P.useReducer(_=>_+1,0),o=e.getState(),a=P.useRef(o),c=P.useRef(s),l=P.useRef(i),u=P.useRef(!1),h=P.useRef();h.current===void 0&&(h.current=s(o));let d,f=!1;(a.current!==o||c.current!==s||l.current!==i||u.current)&&(d=s(o),f=!i(h.current,d)),Sc(()=>{f&&(h.current=d),a.current=o,c.current=s,l.current=i,u.current=!1});const m=P.useRef(o);Sc(()=>{const _=()=>{try{const S=e.getState(),b=c.current(S);l.current(h.current,b)||(a.current=S,h.current=b,r())}catch{u.current=!0,r()}},y=e.subscribe(_);return e.getState()!==m.current&&_(),y},[]);const p=f?d:h.current;return P.useDebugValue(p),p};return Object.assign(t,e),t[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const s=[t,e];return{next(){const i=s.length<=0;return{value:s.shift(),done:i}}}},t}let si=0;const wd=xd(n=>(ar.onStart=(e,t,s)=>{n({active:!0,item:e,loaded:t,total:s,progress:(t-si)/(s-si)*100})},ar.onLoad=()=>{n({active:!1})},ar.onError=e=>n(t=>({errors:[...t.errors,e]})),ar.onProgress=(e,t,s)=>{t===s&&(si=s),n({active:!0,item:e,loaded:t,total:s,progress:(t-si)/(s-si)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0})),Sd=n=>`Loading ${n.toFixed(2)}%`;function AT({containerStyles:n,innerStyles:e,barStyles:t,dataStyles:s,dataInterpolation:i=Sd,initialState:r=o=>o}){const{active:o,progress:a}=wd(),c=P.useRef(0),l=P.useRef(0),u=P.useRef(null),[h,d]=P.useState(r(o));P.useEffect(()=>{let m;return o!==h&&(m=setTimeout(()=>d(o),300)),()=>clearTimeout(m)},[h,o]);const f=P.useCallback(()=>{u.current&&(c.current+=(a-c.current)/2,(c.current>.95*a||a===100)&&(c.current=a),u.current.innerText=i(c.current),c.current<a&&(l.current=requestAnimationFrame(f)))},[i,a]);return P.useEffect(()=>(f(),()=>cancelAnimationFrame(l.current)),[f]),h?P.createElement("div",{style:{...hr.container,opacity:o?1:0,...n}},P.createElement("div",null,P.createElement("div",{style:{...hr.inner,...e}},P.createElement("div",{style:{...hr.bar,transform:`scaleX(${a/100})`,...t}}),P.createElement("span",{ref:u,style:{...hr.data,...s}})))):null}const hr={container:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:"#171717",display:"flex",alignItems:"center",justifyContent:"center",transition:"opacity 300ms ease",zIndex:1e3},inner:{width:100,height:3,background:"#272727",textAlign:"center"},bar:{height:3,width:"100%",background:"white",transition:"transform 200ms",transformOrigin:"left center"},data:{display:"inline-block",position:"relative",fontVariantNumeric:"tabular-nums",marginTop:"0.8em",color:"#f0f0f0",fontSize:"0.6em",fontFamily:'-apple-system, BlinkMacSystemFont, "Inter", "Segoe UI", "Helvetica Neue", Helvetica, Arial, Roboto, Ubuntu, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',whiteSpace:"nowrap"}};let ni;function bd(){var n;if(ni!==void 0)return ni;try{let e;const t=document.createElement("canvas");return ni=!!(window.WebGL2RenderingContext&&(e=t.getContext("webgl2"))),e&&((n=e.getExtension("WEBGL_lose_context"))==null||n.loseContext()),ni}catch{return ni=!1}}const bo=new $h,Co=new Ue,gn=new Ue,At=new Ue,Qt=new Ue,Bt=new Ue,Kt=new Ue,Jt=new Ue,ii=new Ue,ri=new Ue,oi=new Ue,dr=new Ue,ai=new Ue,ci=new Ue,li=new Ue;class Cd{constructor(e,t,s){this.camera=e,this.scene=t,this.startPoint=new Ue,this.endPoint=new Ue,this.collection=[],this.deep=s||Number.MAX_VALUE}select(e,t){return this.startPoint=e||this.startPoint,this.endPoint=t||this.endPoint,this.collection=[],this.updateFrustum(this.startPoint,this.endPoint),this.searchChildInFrustum(bo,this.scene),this.collection}updateFrustum(e,t){if(e=e||this.startPoint,t=t||this.endPoint,e.x===t.x&&(t.x+=Number.EPSILON),e.y===t.y&&(t.y+=Number.EPSILON),this.camera.updateProjectionMatrix(),this.camera.updateMatrixWorld(),this.camera.isPerspectiveCamera){gn.copy(e),gn.x=Math.min(e.x,t.x),gn.y=Math.max(e.y,t.y),t.x=Math.max(e.x,t.x),t.y=Math.min(e.y,t.y),At.setFromMatrixPosition(this.camera.matrixWorld),Qt.copy(gn),Bt.set(t.x,gn.y,0),Kt.copy(t),Jt.set(gn.x,t.y,0),Qt.unproject(this.camera),Bt.unproject(this.camera),Kt.unproject(this.camera),Jt.unproject(this.camera),ai.copy(Qt).sub(At),ci.copy(Bt).sub(At),li.copy(Kt).sub(At),ai.normalize(),ci.normalize(),li.normalize(),ai.multiplyScalar(this.deep),ci.multiplyScalar(this.deep),li.multiplyScalar(this.deep),ai.add(At),ci.add(At),li.add(At);var s=bo.planes;s[0].setFromCoplanarPoints(At,Qt,Bt),s[1].setFromCoplanarPoints(At,Bt,Kt),s[2].setFromCoplanarPoints(Kt,Jt,At),s[3].setFromCoplanarPoints(Jt,Qt,At),s[4].setFromCoplanarPoints(Bt,Kt,Jt),s[5].setFromCoplanarPoints(li,ci,ai),s[5].normal.multiplyScalar(-1)}else if(this.camera.isOrthographicCamera){const i=Math.min(e.x,t.x),r=Math.max(e.y,t.y),o=Math.max(e.x,t.x),a=Math.min(e.y,t.y);Qt.set(i,r,-1),Bt.set(o,r,-1),Kt.set(o,a,-1),Jt.set(i,a,-1),ii.set(i,r,1),ri.set(o,r,1),oi.set(o,a,1),dr.set(i,a,1),Qt.unproject(this.camera),Bt.unproject(this.camera),Kt.unproject(this.camera),Jt.unproject(this.camera),ii.unproject(this.camera),ri.unproject(this.camera),oi.unproject(this.camera),dr.unproject(this.camera);var s=bo.planes;s[0].setFromCoplanarPoints(Qt,ii,ri),s[1].setFromCoplanarPoints(Bt,ri,oi),s[2].setFromCoplanarPoints(oi,dr,Jt),s[3].setFromCoplanarPoints(dr,ii,Qt),s[4].setFromCoplanarPoints(Bt,Kt,Jt),s[5].setFromCoplanarPoints(oi,ri,ii),s[5].normal.multiplyScalar(-1)}else console.error("THREE.SelectionBox: Unsupported camera type.")}searchChildInFrustum(e,t){if((t.isMesh||t.isLine||t.isPoints)&&t.material!==void 0&&(t.geometry.boundingSphere===null&&t.geometry.computeBoundingSphere(),Co.copy(t.geometry.boundingSphere.center),Co.applyMatrix4(t.matrixWorld),e.containsPoint(Co)&&this.collection.push(t)),t.children.length>0)for(let s=0;s<t.children.length;s++)this.searchChildInFrustum(e,t.children[s])}}function Ed(n,e){if(Object.is(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;const t=Object.keys(n);if(t.length!==Object.keys(e).length)return!1;for(let s=0;s<t.length;s++)if(!Object.prototype.hasOwnProperty.call(e,t[s])||!Object.is(n[t[s]],e[t[s]]))return!1;return!0}const Od=P.createContext([]);function MT({box:n,multiple:e,children:t,onChange:s,border:i="1px solid #55aaff",backgroundColor:r="rgba(75, 160, 255, 0.1)",filter:o=c=>c,...a}){const{setEvents:c,camera:l,raycaster:u,gl:h,controls:d,size:f,get:m}=we(),[p,_]=P.useState(!1),[y,S]=P.useReducer((x,{object:T,shift:w})=>T===void 0?[]:Array.isArray(T)?T:w?x.includes(T)?x.filter(C=>C!==T):[T,...x]:x[0]===T?[]:[T],[]);P.useEffect(()=>void(s==null?void 0:s(y)),[y]);const b=P.useCallback(x=>{x.stopPropagation(),S({object:o([x.object])[0],shift:e&&x.shiftKey})},[]),v=P.useCallback(x=>!p&&S({}),[p]),g=P.useRef(null);return P.useEffect(()=>{if(!n||!e)return;const x=new Cd(l,g.current),T=document.createElement("div");T.style.pointerEvents="none",T.style.border=i,T.style.backgroundColor=r,T.style.position="fixed";const w=new Re,C=new Re,E=new Re,O=m().events.enabled,A=d==null?void 0:d.enabled;let D=!1;function R(L,ve){const{offsetX:re,offsetY:Z}=L,{width:fe,height:We}=f;ve.set(re/fe*2-1,-(Z/We)*2+1)}function I(L){var ve;d&&(d.enabled=!1),c({enabled:!1}),D=!0,(ve=h.domElement.parentElement)==null||ve.appendChild(T),T.style.left=`${L.clientX}px`,T.style.top=`${L.clientY}px`,T.style.width="0px",T.style.height="0px",w.x=L.clientX,w.y=L.clientY}function N(L){E.x=Math.max(w.x,L.clientX),E.y=Math.max(w.y,L.clientY),C.x=Math.min(w.x,L.clientX),C.y=Math.min(w.y,L.clientY),T.style.left=`${C.x}px`,T.style.top=`${C.y}px`,T.style.width=`${E.x-C.x}px`,T.style.height=`${E.y-C.y}px`}function F(){if(D){var L;d&&(d.enabled=A),c({enabled:O}),D=!1,(L=T.parentElement)==null||L.removeChild(T)}}function z(L){L.shiftKey&&(I(L),R(L,x.startPoint))}let B=[];function q(L){if(D){N(L),R(L,x.endPoint);const ve=x.select().sort(re=>re.uuid).filter(re=>re.isMesh);Ed(ve,B)||(B=ve,S({object:o(ve)}))}}function V(L){D&&F()}return document.addEventListener("pointerdown",z,{passive:!0}),document.addEventListener("pointermove",q,{passive:!0,capture:!0}),document.addEventListener("pointerup",V,{passive:!0}),()=>{document.removeEventListener("pointerdown",z),document.removeEventListener("pointermove",q),document.removeEventListener("pointerup",V)}},[f.width,f.height,u,l,d,h]),P.createElement("group",xa({ref:g,onClick:b,onPointerOver:()=>_(!0),onPointerOut:()=>_(!1),onPointerMissed:v},a),P.createElement(Od.Provider,{value:y},t))}/*!
 * camera-controls
 * https://github.com/yomotsu/camera-controls
 * (c) 2017 @yomotsu
 * Released under the MIT License.
 */const Y={LEFT:1,RIGHT:2,MIDDLE:4},M=Object.freeze({NONE:0,ROTATE:1,TRUCK:2,OFFSET:4,DOLLY:8,ZOOM:16,TOUCH_ROTATE:32,TOUCH_TRUCK:64,TOUCH_OFFSET:128,TOUCH_DOLLY:256,TOUCH_ZOOM:512,TOUCH_DOLLY_TRUCK:1024,TOUCH_DOLLY_OFFSET:2048,TOUCH_DOLLY_ROTATE:4096,TOUCH_ZOOM_TRUCK:8192,TOUCH_ZOOM_OFFSET:16384,TOUCH_ZOOM_ROTATE:32768}),vn={NONE:0,IN:1,OUT:-1};function qs(n){return n.isPerspectiveCamera}function xs(n){return n.isOrthographicCamera}const yn=Math.PI*2,bc=Math.PI/2,Ml=1e-5,ui=Math.PI/180;function Mt(n,e,t){return Math.max(e,Math.min(t,n))}function pe(n,e=Ml){return Math.abs(n)<e}function ie(n,e,t=Ml){return pe(n-e,t)}function Cc(n,e){return Math.round(n/e)*e}function hi(n){return isFinite(n)?n:n<0?-Number.MAX_VALUE:Number.MAX_VALUE}function di(n){return Math.abs(n)<Number.MAX_VALUE?n:n*(1/0)}function fr(n,e,t,s,i=1/0,r){s=Math.max(1e-4,s);const o=2/s,a=o*r,c=1/(1+a+.48*a*a+.235*a*a*a);let l=n-e;const u=e,h=i*s;l=Mt(l,-h,h),e=n-l;const d=(t.value+o*l)*r;t.value=(t.value-o*d)*c;let f=e+(l+d)*c;return u-n>0==f>u&&(f=u,t.value=(f-u)/r),f}function Ec(n,e,t,s,i=1/0,r,o){s=Math.max(1e-4,s);const a=2/s,c=a*r,l=1/(1+c+.48*c*c+.235*c*c*c);let u=e.x,h=e.y,d=e.z,f=n.x-u,m=n.y-h,p=n.z-d;const _=u,y=h,S=d,b=i*s,v=b*b,g=f*f+m*m+p*p;if(g>v){const I=Math.sqrt(g);f=f/I*b,m=m/I*b,p=p/I*b}u=n.x-f,h=n.y-m,d=n.z-p;const x=(t.x+a*f)*r,T=(t.y+a*m)*r,w=(t.z+a*p)*r;t.x=(t.x-a*x)*l,t.y=(t.y-a*T)*l,t.z=(t.z-a*w)*l,o.x=u+(f+x)*l,o.y=h+(m+T)*l,o.z=d+(p+w)*l;const C=_-n.x,E=y-n.y,O=S-n.z,A=o.x-_,D=o.y-y,R=o.z-S;return C*A+E*D+O*R>0&&(o.x=_,o.y=y,o.z=S,t.x=(o.x-_)/r,t.y=(o.y-y)/r,t.z=(o.z-S)/r),o}function Eo(n,e){e.set(0,0),n.forEach(t=>{e.x+=t.clientX,e.y+=t.clientY}),e.x/=n.length,e.y/=n.length}function Oo(n,e){return xs(n)?(console.warn(`${e} is not supported in OrthographicCamera`),!0):!1}class Ad{constructor(){this._listeners={}}addEventListener(e,t){const s=this._listeners;s[e]===void 0&&(s[e]=[]),s[e].indexOf(t)===-1&&s[e].push(t)}hasEventListener(e,t){const s=this._listeners;return s[e]!==void 0&&s[e].indexOf(t)!==-1}removeEventListener(e,t){const i=this._listeners[e];if(i!==void 0){const r=i.indexOf(t);r!==-1&&i.splice(r,1)}}removeAllEventListeners(e){if(!e){this._listeners={};return}Array.isArray(this._listeners[e])&&(this._listeners[e].length=0)}dispatchEvent(e){const s=this._listeners[e.type];if(s!==void 0){e.target=this;const i=s.slice(0);for(let r=0,o=i.length;r<o;r++)i[r].call(this,e)}}}const Md="2.7.3",pr=1/8,Dl=typeof window<"u",Dd=Dl&&/Mac/.test(navigator.platform),kd=!(Dl&&"PointerEvent"in window);let G,Oc,mr,Ao,st,Q,te,Tn,fi,zt,Vt,Ws,Ac,Mc,yt,pi,xn,Dc,Mo,kc,Do,ko,_r,Ro=class Zo extends Ad{static install(e){G=e.THREE,Oc=Object.freeze(new G.Vector3(0,0,0)),mr=Object.freeze(new G.Vector3(0,1,0)),Ao=Object.freeze(new G.Vector3(0,0,1)),st=new G.Vector2,Q=new G.Vector3,te=new G.Vector3,Tn=new G.Vector3,fi=new G.Vector3,zt=new G.Vector3,Vt=new G.Vector3,Ws=new G.Vector3,Ac=new G.Vector3,Mc=new G.Vector3,yt=new G.Spherical,pi=new G.Spherical,xn=new G.Box3,Dc=new G.Box3,Mo=new G.Sphere,kc=new G.Quaternion,Do=new G.Quaternion,ko=new G.Matrix4,_r=new G.Raycaster}static get ACTION(){return M}constructor(e,t){super(),this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.minDistance=Number.EPSILON,this.maxDistance=1/0,this.infinityDolly=!1,this.minZoom=.01,this.maxZoom=1/0,this.smoothTime=.25,this.draggingSmoothTime=.125,this.maxSpeed=1/0,this.azimuthRotateSpeed=1,this.polarRotateSpeed=1,this.dollySpeed=1,this.dollyDragInverted=!1,this.truckSpeed=2,this.dollyToCursor=!1,this.dragToOffset=!1,this.verticalDragToForward=!1,this.boundaryFriction=0,this.restThreshold=.01,this.colliderMeshes=[],this.cancel=()=>{},this._enabled=!0,this._state=M.NONE,this._viewport=null,this._changedDolly=0,this._changedZoom=0,this._hasRested=!0,this._boundaryEnclosesCamera=!1,this._needsUpdate=!0,this._updatedLastTime=!1,this._elementRect=new DOMRect,this._isDragging=!1,this._dragNeedsUpdate=!0,this._activePointers=[],this._lockedPointer=null,this._interactiveArea=new DOMRect(0,0,1,1),this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._isUserControllingOffset=!1,this._isUserControllingZoom=!1,this._lastDollyDirection=vn.NONE,this._thetaVelocity={value:0},this._phiVelocity={value:0},this._radiusVelocity={value:0},this._targetVelocity=new G.Vector3,this._focalOffsetVelocity=new G.Vector3,this._zoomVelocity={value:0},this._truckInternal=(v,g,x)=>{let T,w;if(qs(this._camera)){const C=Q.copy(this._camera.position).sub(this._target),E=this._camera.getEffectiveFOV()*ui,O=C.length()*Math.tan(E*.5);T=this.truckSpeed*v*O/this._elementRect.height,w=this.truckSpeed*g*O/this._elementRect.height}else if(xs(this._camera)){const C=this._camera;T=v*(C.right-C.left)/C.zoom/this._elementRect.width,w=g*(C.top-C.bottom)/C.zoom/this._elementRect.height}else return;this.verticalDragToForward?(x?this.setFocalOffset(this._focalOffsetEnd.x+T,this._focalOffsetEnd.y,this._focalOffsetEnd.z,!0):this.truck(T,0,!0),this.forward(-w,!0)):x?this.setFocalOffset(this._focalOffsetEnd.x+T,this._focalOffsetEnd.y+w,this._focalOffsetEnd.z,!0):this.truck(T,w,!0)},this._rotateInternal=(v,g)=>{const x=yn*this.azimuthRotateSpeed*v/this._elementRect.height,T=yn*this.polarRotateSpeed*g/this._elementRect.height;this.rotate(x,T,!0)},this._dollyInternal=(v,g,x)=>{const T=Math.pow(.95,-v*this.dollySpeed),w=this._sphericalEnd.radius,C=this._sphericalEnd.radius*T,E=Mt(C,this.minDistance,this.maxDistance),O=E-C;this.infinityDolly&&this.dollyToCursor?this._dollyToNoClamp(C,!0):this.infinityDolly&&!this.dollyToCursor?(this.dollyInFixed(O,!0),this._dollyToNoClamp(E,!0)):this._dollyToNoClamp(E,!0),this.dollyToCursor&&(this._changedDolly+=(this.infinityDolly?C:E)-w,this._dollyControlCoord.set(g,x)),this._lastDollyDirection=Math.sign(-v)},this._zoomInternal=(v,g,x)=>{const T=Math.pow(.95,v*this.dollySpeed),w=this._zoom,C=this._zoom*T;this.zoomTo(C,!0),this.dollyToCursor&&(this._changedZoom+=C-w,this._dollyControlCoord.set(g,x))},typeof G>"u"&&console.error("camera-controls: `THREE` is undefined. You must first run `CameraControls.install( { THREE: THREE } )`. Check the docs for further information."),this._camera=e,this._yAxisUpSpace=new G.Quaternion().setFromUnitVectors(this._camera.up,mr),this._yAxisUpSpaceInverse=this._yAxisUpSpace.clone().invert(),this._state=M.NONE,this._target=new G.Vector3,this._targetEnd=this._target.clone(),this._focalOffset=new G.Vector3,this._focalOffsetEnd=this._focalOffset.clone(),this._spherical=new G.Spherical().setFromVector3(Q.copy(this._camera.position).applyQuaternion(this._yAxisUpSpace)),this._sphericalEnd=this._spherical.clone(),this._lastDistance=this._spherical.radius,this._zoom=this._camera.zoom,this._zoomEnd=this._zoom,this._lastZoom=this._zoom,this._nearPlaneCorners=[new G.Vector3,new G.Vector3,new G.Vector3,new G.Vector3],this._updateNearPlaneCorners(),this._boundary=new G.Box3(new G.Vector3(-1/0,-1/0,-1/0),new G.Vector3(1/0,1/0,1/0)),this._cameraUp0=this._camera.up.clone(),this._target0=this._target.clone(),this._position0=this._camera.position.clone(),this._zoom0=this._zoom,this._focalOffset0=this._focalOffset.clone(),this._dollyControlCoord=new G.Vector2,this.mouseButtons={left:M.ROTATE,middle:M.DOLLY,right:M.TRUCK,wheel:qs(this._camera)?M.DOLLY:xs(this._camera)?M.ZOOM:M.NONE},this.touches={one:M.TOUCH_ROTATE,two:qs(this._camera)?M.TOUCH_DOLLY_TRUCK:xs(this._camera)?M.TOUCH_ZOOM_TRUCK:M.NONE,three:M.TOUCH_TRUCK};const s=new G.Vector2,i=new G.Vector2,r=new G.Vector2,o=v=>{if(!this._enabled||!this._domElement)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const T=this._domElement.getBoundingClientRect(),w=v.clientX/T.width,C=v.clientY/T.height;if(w<this._interactiveArea.left||w>this._interactiveArea.right||C<this._interactiveArea.top||C>this._interactiveArea.bottom)return}const g=v.pointerType!=="mouse"?null:(v.buttons&Y.LEFT)===Y.LEFT?Y.LEFT:(v.buttons&Y.MIDDLE)===Y.MIDDLE?Y.MIDDLE:(v.buttons&Y.RIGHT)===Y.RIGHT?Y.RIGHT:null;if(g!==null){const T=this._findPointerByMouseButton(g);T&&this._disposePointer(T)}if((v.buttons&Y.LEFT)===Y.LEFT&&this._lockedPointer)return;const x={pointerId:v.pointerId,clientX:v.clientX,clientY:v.clientY,deltaX:0,deltaY:0,mouseButton:g};this._activePointers.push(x),this._domElement.ownerDocument.removeEventListener("pointermove",c,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",u),this._domElement.ownerDocument.addEventListener("pointermove",c,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",u),this._isDragging=!0,p(v)},a=v=>{if(!this._enabled||!this._domElement||this._lockedPointer)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const T=this._domElement.getBoundingClientRect(),w=v.clientX/T.width,C=v.clientY/T.height;if(w<this._interactiveArea.left||w>this._interactiveArea.right||C<this._interactiveArea.top||C>this._interactiveArea.bottom)return}const g=(v.buttons&Y.LEFT)===Y.LEFT?Y.LEFT:(v.buttons&Y.MIDDLE)===Y.MIDDLE?Y.MIDDLE:(v.buttons&Y.RIGHT)===Y.RIGHT?Y.RIGHT:null;if(g!==null){const T=this._findPointerByMouseButton(g);T&&this._disposePointer(T)}const x={pointerId:1,clientX:v.clientX,clientY:v.clientY,deltaX:0,deltaY:0,mouseButton:(v.buttons&Y.LEFT)===Y.LEFT?Y.LEFT:(v.buttons&Y.MIDDLE)===Y.LEFT?Y.MIDDLE:(v.buttons&Y.RIGHT)===Y.LEFT?Y.RIGHT:null};this._activePointers.push(x),this._domElement.ownerDocument.removeEventListener("mousemove",l),this._domElement.ownerDocument.removeEventListener("mouseup",h),this._domElement.ownerDocument.addEventListener("mousemove",l),this._domElement.ownerDocument.addEventListener("mouseup",h),this._isDragging=!0,p(v)},c=v=>{v.cancelable&&v.preventDefault();const g=v.pointerId,x=this._lockedPointer||this._findPointerById(g);if(x){if(x.clientX=v.clientX,x.clientY=v.clientY,x.deltaX=v.movementX,x.deltaY=v.movementY,this._state=0,v.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else(!this._isDragging&&this._lockedPointer||this._isDragging&&(v.buttons&Y.LEFT)===Y.LEFT)&&(this._state=this._state|this.mouseButtons.left),this._isDragging&&(v.buttons&Y.MIDDLE)===Y.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),this._isDragging&&(v.buttons&Y.RIGHT)===Y.RIGHT&&(this._state=this._state|this.mouseButtons.right);_()}},l=v=>{const g=this._lockedPointer||this._findPointerById(1);g&&(g.clientX=v.clientX,g.clientY=v.clientY,g.deltaX=v.movementX,g.deltaY=v.movementY,this._state=0,(this._lockedPointer||(v.buttons&Y.LEFT)===Y.LEFT)&&(this._state=this._state|this.mouseButtons.left),(v.buttons&Y.MIDDLE)===Y.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(v.buttons&Y.RIGHT)===Y.RIGHT&&(this._state=this._state|this.mouseButtons.right),_())},u=v=>{const g=this._findPointerById(v.pointerId);if(!(g&&g===this._lockedPointer)){if(g&&this._disposePointer(g),v.pointerType==="touch")switch(this._activePointers.length){case 0:this._state=M.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else this._state=M.NONE;y()}},h=()=>{const v=this._findPointerById(1);v&&v===this._lockedPointer||(v&&this._disposePointer(v),this._state=M.NONE,y())};let d=-1;const f=v=>{if(!this._domElement||!this._enabled||this.mouseButtons.wheel===M.NONE)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const C=this._domElement.getBoundingClientRect(),E=v.clientX/C.width,O=v.clientY/C.height;if(E<this._interactiveArea.left||E>this._interactiveArea.right||O<this._interactiveArea.top||O>this._interactiveArea.bottom)return}if(v.preventDefault(),this.dollyToCursor||this.mouseButtons.wheel===M.ROTATE||this.mouseButtons.wheel===M.TRUCK){const C=performance.now();d-C<1e3&&this._getClientRect(this._elementRect),d=C}const g=Dd?-1:-3,x=v.deltaMode===1?v.deltaY/g:v.deltaY/(g*10),T=this.dollyToCursor?(v.clientX-this._elementRect.x)/this._elementRect.width*2-1:0,w=this.dollyToCursor?(v.clientY-this._elementRect.y)/this._elementRect.height*-2+1:0;switch(this.mouseButtons.wheel){case M.ROTATE:{this._rotateInternal(v.deltaX,v.deltaY),this._isUserControllingRotate=!0;break}case M.TRUCK:{this._truckInternal(v.deltaX,v.deltaY,!1),this._isUserControllingTruck=!0;break}case M.OFFSET:{this._truckInternal(v.deltaX,v.deltaY,!0),this._isUserControllingOffset=!0;break}case M.DOLLY:{this._dollyInternal(-x,T,w),this._isUserControllingDolly=!0;break}case M.ZOOM:{this._zoomInternal(-x,T,w),this._isUserControllingZoom=!0;break}}this.dispatchEvent({type:"control"})},m=v=>{if(!(!this._domElement||!this._enabled)){if(this.mouseButtons.right===Zo.ACTION.NONE){const g=v instanceof PointerEvent?v.pointerId:(v instanceof MouseEvent,0),x=this._findPointerById(g);x&&this._disposePointer(x),this._domElement.ownerDocument.removeEventListener("pointermove",c,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",u),this._domElement.ownerDocument.removeEventListener("mousemove",l),this._domElement.ownerDocument.removeEventListener("mouseup",h);return}v.preventDefault()}},p=v=>{if(!this._enabled)return;if(Eo(this._activePointers,st),this._getClientRect(this._elementRect),s.copy(st),i.copy(st),this._activePointers.length>=2){const x=st.x-this._activePointers[1].clientX,T=st.y-this._activePointers[1].clientY,w=Math.sqrt(x*x+T*T);r.set(0,w);const C=(this._activePointers[0].clientX+this._activePointers[1].clientX)*.5,E=(this._activePointers[0].clientY+this._activePointers[1].clientY)*.5;i.set(C,E)}if(this._state=0,!v)this._lockedPointer&&(this._state=this._state|this.mouseButtons.left);else if("pointerType"in v&&v.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else!this._lockedPointer&&(v.buttons&Y.LEFT)===Y.LEFT&&(this._state=this._state|this.mouseButtons.left),(v.buttons&Y.MIDDLE)===Y.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(v.buttons&Y.RIGHT)===Y.RIGHT&&(this._state=this._state|this.mouseButtons.right);((this._state&M.ROTATE)===M.ROTATE||(this._state&M.TOUCH_ROTATE)===M.TOUCH_ROTATE||(this._state&M.TOUCH_DOLLY_ROTATE)===M.TOUCH_DOLLY_ROTATE||(this._state&M.TOUCH_ZOOM_ROTATE)===M.TOUCH_ZOOM_ROTATE)&&(this._sphericalEnd.theta=this._spherical.theta,this._sphericalEnd.phi=this._spherical.phi,this._thetaVelocity.value=0,this._phiVelocity.value=0),((this._state&M.TRUCK)===M.TRUCK||(this._state&M.TOUCH_TRUCK)===M.TOUCH_TRUCK||(this._state&M.TOUCH_DOLLY_TRUCK)===M.TOUCH_DOLLY_TRUCK||(this._state&M.TOUCH_ZOOM_TRUCK)===M.TOUCH_ZOOM_TRUCK)&&(this._targetEnd.copy(this._target),this._targetVelocity.set(0,0,0)),((this._state&M.DOLLY)===M.DOLLY||(this._state&M.TOUCH_DOLLY)===M.TOUCH_DOLLY||(this._state&M.TOUCH_DOLLY_TRUCK)===M.TOUCH_DOLLY_TRUCK||(this._state&M.TOUCH_DOLLY_OFFSET)===M.TOUCH_DOLLY_OFFSET||(this._state&M.TOUCH_DOLLY_ROTATE)===M.TOUCH_DOLLY_ROTATE)&&(this._sphericalEnd.radius=this._spherical.radius,this._radiusVelocity.value=0),((this._state&M.ZOOM)===M.ZOOM||(this._state&M.TOUCH_ZOOM)===M.TOUCH_ZOOM||(this._state&M.TOUCH_ZOOM_TRUCK)===M.TOUCH_ZOOM_TRUCK||(this._state&M.TOUCH_ZOOM_OFFSET)===M.TOUCH_ZOOM_OFFSET||(this._state&M.TOUCH_ZOOM_ROTATE)===M.TOUCH_ZOOM_ROTATE)&&(this._zoomEnd=this._zoom,this._zoomVelocity.value=0),((this._state&M.OFFSET)===M.OFFSET||(this._state&M.TOUCH_OFFSET)===M.TOUCH_OFFSET||(this._state&M.TOUCH_DOLLY_OFFSET)===M.TOUCH_DOLLY_OFFSET||(this._state&M.TOUCH_ZOOM_OFFSET)===M.TOUCH_ZOOM_OFFSET)&&(this._focalOffsetEnd.copy(this._focalOffset),this._focalOffsetVelocity.set(0,0,0)),this.dispatchEvent({type:"controlstart"})},_=()=>{if(!this._enabled||!this._dragNeedsUpdate)return;this._dragNeedsUpdate=!1,Eo(this._activePointers,st);const g=this._domElement&&document.pointerLockElement===this._domElement?this._lockedPointer||this._activePointers[0]:null,x=g?-g.deltaX:i.x-st.x,T=g?-g.deltaY:i.y-st.y;if(i.copy(st),((this._state&M.ROTATE)===M.ROTATE||(this._state&M.TOUCH_ROTATE)===M.TOUCH_ROTATE||(this._state&M.TOUCH_DOLLY_ROTATE)===M.TOUCH_DOLLY_ROTATE||(this._state&M.TOUCH_ZOOM_ROTATE)===M.TOUCH_ZOOM_ROTATE)&&(this._rotateInternal(x,T),this._isUserControllingRotate=!0),(this._state&M.DOLLY)===M.DOLLY||(this._state&M.ZOOM)===M.ZOOM){const w=this.dollyToCursor?(s.x-this._elementRect.x)/this._elementRect.width*2-1:0,C=this.dollyToCursor?(s.y-this._elementRect.y)/this._elementRect.height*-2+1:0,E=this.dollyDragInverted?-1:1;(this._state&M.DOLLY)===M.DOLLY?(this._dollyInternal(E*T*pr,w,C),this._isUserControllingDolly=!0):(this._zoomInternal(E*T*pr,w,C),this._isUserControllingZoom=!0)}if((this._state&M.TOUCH_DOLLY)===M.TOUCH_DOLLY||(this._state&M.TOUCH_ZOOM)===M.TOUCH_ZOOM||(this._state&M.TOUCH_DOLLY_TRUCK)===M.TOUCH_DOLLY_TRUCK||(this._state&M.TOUCH_ZOOM_TRUCK)===M.TOUCH_ZOOM_TRUCK||(this._state&M.TOUCH_DOLLY_OFFSET)===M.TOUCH_DOLLY_OFFSET||(this._state&M.TOUCH_ZOOM_OFFSET)===M.TOUCH_ZOOM_OFFSET||(this._state&M.TOUCH_DOLLY_ROTATE)===M.TOUCH_DOLLY_ROTATE||(this._state&M.TOUCH_ZOOM_ROTATE)===M.TOUCH_ZOOM_ROTATE){const w=st.x-this._activePointers[1].clientX,C=st.y-this._activePointers[1].clientY,E=Math.sqrt(w*w+C*C),O=r.y-E;r.set(0,E);const A=this.dollyToCursor?(i.x-this._elementRect.x)/this._elementRect.width*2-1:0,D=this.dollyToCursor?(i.y-this._elementRect.y)/this._elementRect.height*-2+1:0;(this._state&M.TOUCH_DOLLY)===M.TOUCH_DOLLY||(this._state&M.TOUCH_DOLLY_ROTATE)===M.TOUCH_DOLLY_ROTATE||(this._state&M.TOUCH_DOLLY_TRUCK)===M.TOUCH_DOLLY_TRUCK||(this._state&M.TOUCH_DOLLY_OFFSET)===M.TOUCH_DOLLY_OFFSET?(this._dollyInternal(O*pr,A,D),this._isUserControllingDolly=!0):(this._zoomInternal(O*pr,A,D),this._isUserControllingZoom=!0)}((this._state&M.TRUCK)===M.TRUCK||(this._state&M.TOUCH_TRUCK)===M.TOUCH_TRUCK||(this._state&M.TOUCH_DOLLY_TRUCK)===M.TOUCH_DOLLY_TRUCK||(this._state&M.TOUCH_ZOOM_TRUCK)===M.TOUCH_ZOOM_TRUCK)&&(this._truckInternal(x,T,!1),this._isUserControllingTruck=!0),((this._state&M.OFFSET)===M.OFFSET||(this._state&M.TOUCH_OFFSET)===M.TOUCH_OFFSET||(this._state&M.TOUCH_DOLLY_OFFSET)===M.TOUCH_DOLLY_OFFSET||(this._state&M.TOUCH_ZOOM_OFFSET)===M.TOUCH_ZOOM_OFFSET)&&(this._truckInternal(x,T,!0),this._isUserControllingOffset=!0),this.dispatchEvent({type:"control"})},y=()=>{Eo(this._activePointers,st),i.copy(st),this._dragNeedsUpdate=!1,(this._activePointers.length===0||this._activePointers.length===1&&this._activePointers[0]===this._lockedPointer)&&(this._isDragging=!1),this._activePointers.length===0&&this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointermove",c,{passive:!1}),this._domElement.ownerDocument.removeEventListener("mousemove",l),this._domElement.ownerDocument.removeEventListener("pointerup",u),this._domElement.ownerDocument.removeEventListener("mouseup",h),this.dispatchEvent({type:"controlend"}))};this.lockPointer=()=>{!this._enabled||!this._domElement||(this.cancel(),this._lockedPointer={pointerId:-1,clientX:0,clientY:0,deltaX:0,deltaY:0,mouseButton:null},this._activePointers.push(this._lockedPointer),this._domElement.ownerDocument.removeEventListener("pointermove",c,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",u),this._domElement.requestPointerLock(),this._domElement.ownerDocument.addEventListener("pointerlockchange",S),this._domElement.ownerDocument.addEventListener("pointerlockerror",b),this._domElement.ownerDocument.addEventListener("pointermove",c,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",u),p())},this.unlockPointer=()=>{this._lockedPointer!==null&&(this._disposePointer(this._lockedPointer),this._lockedPointer=null),document.exitPointerLock(),this.cancel(),this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointerlockchange",S),this._domElement.ownerDocument.removeEventListener("pointerlockerror",b))};const S=()=>{this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement||this.unlockPointer()},b=()=>{this.unlockPointer()};this._addAllEventListeners=v=>{this._domElement=v,this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none",this._domElement.addEventListener("pointerdown",o),kd&&this._domElement.addEventListener("mousedown",a),this._domElement.addEventListener("pointercancel",u),this._domElement.addEventListener("wheel",f,{passive:!1}),this._domElement.addEventListener("contextmenu",m)},this._removeAllEventListeners=()=>{this._domElement&&(this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect="",this._domElement.removeEventListener("pointerdown",o),this._domElement.removeEventListener("mousedown",a),this._domElement.removeEventListener("pointercancel",u),this._domElement.removeEventListener("wheel",f,{passive:!1}),this._domElement.removeEventListener("contextmenu",m),this._domElement.ownerDocument.removeEventListener("pointermove",c,{passive:!1}),this._domElement.ownerDocument.removeEventListener("mousemove",l),this._domElement.ownerDocument.removeEventListener("pointerup",u),this._domElement.ownerDocument.removeEventListener("mouseup",h),this._domElement.ownerDocument.removeEventListener("pointerlockchange",S),this._domElement.ownerDocument.removeEventListener("pointerlockerror",b))},this.cancel=()=>{this._state!==M.NONE&&(this._state=M.NONE,this._activePointers.length=0,y())},t&&this.connect(t),this.update(0)}get camera(){return this._camera}set camera(e){this._camera=e,this.updateCameraUp(),this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this._domElement&&(e?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect=""))}get active(){return!this._hasRested}get currentAction(){return this._state}get distance(){return this._spherical.radius}set distance(e){this._spherical.radius===e&&this._sphericalEnd.radius===e||(this._spherical.radius=e,this._sphericalEnd.radius=e,this._needsUpdate=!0)}get azimuthAngle(){return this._spherical.theta}set azimuthAngle(e){this._spherical.theta===e&&this._sphericalEnd.theta===e||(this._spherical.theta=e,this._sphericalEnd.theta=e,this._needsUpdate=!0)}get polarAngle(){return this._spherical.phi}set polarAngle(e){this._spherical.phi===e&&this._sphericalEnd.phi===e||(this._spherical.phi=e,this._sphericalEnd.phi=e,this._needsUpdate=!0)}get boundaryEnclosesCamera(){return this._boundaryEnclosesCamera}set boundaryEnclosesCamera(e){this._boundaryEnclosesCamera=e,this._needsUpdate=!0}set interactiveArea(e){this._interactiveArea.width=Mt(e.width,0,1),this._interactiveArea.height=Mt(e.height,0,1),this._interactiveArea.x=Mt(e.x,0,1-this._interactiveArea.width),this._interactiveArea.y=Mt(e.y,0,1-this._interactiveArea.height)}addEventListener(e,t){super.addEventListener(e,t)}removeEventListener(e,t){super.removeEventListener(e,t)}rotate(e,t,s=!1){return this.rotateTo(this._sphericalEnd.theta+e,this._sphericalEnd.phi+t,s)}rotateAzimuthTo(e,t=!1){return this.rotateTo(e,this._sphericalEnd.phi,t)}rotatePolarTo(e,t=!1){return this.rotateTo(this._sphericalEnd.theta,e,t)}rotateTo(e,t,s=!1){this._isUserControllingRotate=!1;const i=Mt(e,this.minAzimuthAngle,this.maxAzimuthAngle),r=Mt(t,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=i,this._sphericalEnd.phi=r,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,s||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);const o=!s||ie(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&ie(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(o)}dolly(e,t=!1){return this.dollyTo(this._sphericalEnd.radius-e,t)}dollyTo(e,t=!1){return this._isUserControllingDolly=!1,this._lastDollyDirection=vn.NONE,this._changedDolly=0,this._dollyToNoClamp(Mt(e,this.minDistance,this.maxDistance),t)}_dollyToNoClamp(e,t=!1){const s=this._sphericalEnd.radius;if(this.colliderMeshes.length>=1){const o=this._collisionTest(),a=ie(o,this._spherical.radius);if(!(s>e)&&a)return Promise.resolve();this._sphericalEnd.radius=Math.min(e,o)}else this._sphericalEnd.radius=e;this._needsUpdate=!0,t||(this._spherical.radius=this._sphericalEnd.radius);const r=!t||ie(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(r)}dollyInFixed(e,t=!1){this._targetEnd.add(this._getCameraDirection(fi).multiplyScalar(e)),t||this._target.copy(this._targetEnd);const s=!t||ie(this._target.x,this._targetEnd.x,this.restThreshold)&&ie(this._target.y,this._targetEnd.y,this.restThreshold)&&ie(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(s)}zoom(e,t=!1){return this.zoomTo(this._zoomEnd+e,t)}zoomTo(e,t=!1){this._isUserControllingZoom=!1,this._zoomEnd=Mt(e,this.minZoom,this.maxZoom),this._needsUpdate=!0,t||(this._zoom=this._zoomEnd);const s=!t||ie(this._zoom,this._zoomEnd,this.restThreshold);return this._changedZoom=0,this._createOnRestPromise(s)}pan(e,t,s=!1){return console.warn("`pan` has been renamed to `truck`"),this.truck(e,t,s)}truck(e,t,s=!1){this._camera.updateMatrix(),zt.setFromMatrixColumn(this._camera.matrix,0),Vt.setFromMatrixColumn(this._camera.matrix,1),zt.multiplyScalar(e),Vt.multiplyScalar(-t);const i=Q.copy(zt).add(Vt),r=te.copy(this._targetEnd).add(i);return this.moveTo(r.x,r.y,r.z,s)}forward(e,t=!1){Q.setFromMatrixColumn(this._camera.matrix,0),Q.crossVectors(this._camera.up,Q),Q.multiplyScalar(e);const s=te.copy(this._targetEnd).add(Q);return this.moveTo(s.x,s.y,s.z,t)}elevate(e,t=!1){return Q.copy(this._camera.up).multiplyScalar(e),this.moveTo(this._targetEnd.x+Q.x,this._targetEnd.y+Q.y,this._targetEnd.z+Q.z,t)}moveTo(e,t,s,i=!1){this._isUserControllingTruck=!1;const r=Q.set(e,t,s).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,r,this.boundaryFriction),this._needsUpdate=!0,i||this._target.copy(this._targetEnd);const o=!i||ie(this._target.x,this._targetEnd.x,this.restThreshold)&&ie(this._target.y,this._targetEnd.y,this.restThreshold)&&ie(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(o)}lookInDirectionOf(e,t,s,i=!1){const a=Q.set(e,t,s).sub(this._targetEnd).normalize().multiplyScalar(-this._sphericalEnd.radius);return this.setPosition(a.x,a.y,a.z,i)}fitToBox(e,t,{cover:s=!1,paddingLeft:i=0,paddingRight:r=0,paddingBottom:o=0,paddingTop:a=0}={}){const c=[],l=e.isBox3?xn.copy(e):xn.setFromObject(e);l.isEmpty()&&(console.warn("camera-controls: fitTo() cannot be used with an empty box. Aborting"),Promise.resolve());const u=Cc(this._sphericalEnd.theta,bc),h=Cc(this._sphericalEnd.phi,bc);c.push(this.rotateTo(u,h,t));const d=Q.setFromSpherical(this._sphericalEnd).normalize(),f=kc.setFromUnitVectors(d,Ao),m=ie(Math.abs(d.y),1);m&&f.multiply(Do.setFromAxisAngle(mr,u)),f.multiply(this._yAxisUpSpaceInverse);const p=Dc.makeEmpty();te.copy(l.min).applyQuaternion(f),p.expandByPoint(te),te.copy(l.min).setX(l.max.x).applyQuaternion(f),p.expandByPoint(te),te.copy(l.min).setY(l.max.y).applyQuaternion(f),p.expandByPoint(te),te.copy(l.max).setZ(l.min.z).applyQuaternion(f),p.expandByPoint(te),te.copy(l.min).setZ(l.max.z).applyQuaternion(f),p.expandByPoint(te),te.copy(l.max).setY(l.min.y).applyQuaternion(f),p.expandByPoint(te),te.copy(l.max).setX(l.min.x).applyQuaternion(f),p.expandByPoint(te),te.copy(l.max).applyQuaternion(f),p.expandByPoint(te),p.min.x-=i,p.min.y-=o,p.max.x+=r,p.max.y+=a,f.setFromUnitVectors(Ao,d),m&&f.premultiply(Do.invert()),f.premultiply(this._yAxisUpSpace);const _=p.getSize(Q),y=p.getCenter(te).applyQuaternion(f);if(qs(this._camera)){const S=this.getDistanceToFitBox(_.x,_.y,_.z,s);c.push(this.moveTo(y.x,y.y,y.z,t)),c.push(this.dollyTo(S,t)),c.push(this.setFocalOffset(0,0,0,t))}else if(xs(this._camera)){const S=this._camera,b=S.right-S.left,v=S.top-S.bottom,g=s?Math.max(b/_.x,v/_.y):Math.min(b/_.x,v/_.y);c.push(this.moveTo(y.x,y.y,y.z,t)),c.push(this.zoomTo(g,t)),c.push(this.setFocalOffset(0,0,0,t))}return Promise.all(c)}fitToSphere(e,t){const s=[],r=e instanceof G.Sphere?Mo.copy(e):Zo.createBoundingSphere(e,Mo);if(s.push(this.moveTo(r.center.x,r.center.y,r.center.z,t)),qs(this._camera)){const o=this.getDistanceToFitSphere(r.radius);s.push(this.dollyTo(o,t))}else if(xs(this._camera)){const o=this._camera.right-this._camera.left,a=this._camera.top-this._camera.bottom,c=2*r.radius,l=Math.min(o/c,a/c);s.push(this.zoomTo(l,t))}return s.push(this.setFocalOffset(0,0,0,t)),Promise.all(s)}setLookAt(e,t,s,i,r,o,a=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=vn.NONE,this._changedDolly=0;const c=te.set(i,r,o),l=Q.set(e,t,s);this._targetEnd.copy(c),this._sphericalEnd.setFromVector3(l.sub(c).applyQuaternion(this._yAxisUpSpace)),this.normalizeRotations(),this._needsUpdate=!0,a||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const u=!a||ie(this._target.x,this._targetEnd.x,this.restThreshold)&&ie(this._target.y,this._targetEnd.y,this.restThreshold)&&ie(this._target.z,this._targetEnd.z,this.restThreshold)&&ie(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&ie(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&ie(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(u)}lerpLookAt(e,t,s,i,r,o,a,c,l,u,h,d,f,m=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=vn.NONE,this._changedDolly=0;const p=Q.set(i,r,o),_=te.set(e,t,s);yt.setFromVector3(_.sub(p).applyQuaternion(this._yAxisUpSpace));const y=Tn.set(u,h,d),S=te.set(a,c,l);pi.setFromVector3(S.sub(y).applyQuaternion(this._yAxisUpSpace)),this._targetEnd.copy(p.lerp(y,f));const b=pi.theta-yt.theta,v=pi.phi-yt.phi,g=pi.radius-yt.radius;this._sphericalEnd.set(yt.radius+g*f,yt.phi+v*f,yt.theta+b*f),this.normalizeRotations(),this._needsUpdate=!0,m||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const x=!m||ie(this._target.x,this._targetEnd.x,this.restThreshold)&&ie(this._target.y,this._targetEnd.y,this.restThreshold)&&ie(this._target.z,this._targetEnd.z,this.restThreshold)&&ie(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&ie(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&ie(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(x)}setPosition(e,t,s,i=!1){return this.setLookAt(e,t,s,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,i)}setTarget(e,t,s,i=!1){const r=this.getPosition(Q),o=this.setLookAt(r.x,r.y,r.z,e,t,s,i);return this._sphericalEnd.phi=Mt(this._sphericalEnd.phi,this.minPolarAngle,this.maxPolarAngle),o}setFocalOffset(e,t,s,i=!1){this._isUserControllingOffset=!1,this._focalOffsetEnd.set(e,t,s),this._needsUpdate=!0,i||this._focalOffset.copy(this._focalOffsetEnd);const r=!i||ie(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&ie(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&ie(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(r)}setOrbitPoint(e,t,s){this._camera.updateMatrixWorld(),zt.setFromMatrixColumn(this._camera.matrixWorldInverse,0),Vt.setFromMatrixColumn(this._camera.matrixWorldInverse,1),Ws.setFromMatrixColumn(this._camera.matrixWorldInverse,2);const i=Q.set(e,t,s),r=i.distanceTo(this._camera.position),o=i.sub(this._camera.position);zt.multiplyScalar(o.x),Vt.multiplyScalar(o.y),Ws.multiplyScalar(o.z),Q.copy(zt).add(Vt).add(Ws),Q.z=Q.z+r,this.dollyTo(r,!1),this.setFocalOffset(-Q.x,Q.y,-Q.z,!1),this.moveTo(e,t,s,!1)}setBoundary(e){if(!e){this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),this._needsUpdate=!0;return}this._boundary.copy(e),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}setViewport(e,t,s,i){if(e===null){this._viewport=null;return}this._viewport=this._viewport||new G.Vector4,typeof e=="number"?this._viewport.set(e,t,s,i):this._viewport.copy(e)}getDistanceToFitBox(e,t,s,i=!1){if(Oo(this._camera,"getDistanceToFitBox"))return this._spherical.radius;const r=e/t,o=this._camera.getEffectiveFOV()*ui,a=this._camera.aspect;return((i?r>a:r<a)?t:e/a)*.5/Math.tan(o*.5)+s*.5}getDistanceToFitSphere(e){if(Oo(this._camera,"getDistanceToFitSphere"))return this._spherical.radius;const t=this._camera.getEffectiveFOV()*ui,s=Math.atan(Math.tan(t*.5)*this._camera.aspect)*2,i=1<this._camera.aspect?t:s;return e/Math.sin(i*.5)}getTarget(e,t=!0){return(e&&e.isVector3?e:new G.Vector3).copy(t?this._targetEnd:this._target)}getPosition(e,t=!0){return(e&&e.isVector3?e:new G.Vector3).setFromSpherical(t?this._sphericalEnd:this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(t?this._targetEnd:this._target)}getSpherical(e,t=!0){return(e&&e instanceof G.Spherical?e:new G.Spherical).copy(t?this._sphericalEnd:this._spherical)}getFocalOffset(e,t=!0){return(e&&e.isVector3?e:new G.Vector3).copy(t?this._focalOffsetEnd:this._focalOffset)}normalizeRotations(){this._sphericalEnd.theta=this._sphericalEnd.theta%yn,this._sphericalEnd.theta<0&&(this._sphericalEnd.theta+=yn),this._spherical.theta+=yn*Math.round((this._sphericalEnd.theta-this._spherical.theta)/yn)}reset(e=!1){if(!ie(this._camera.up.x,this._cameraUp0.x)||!ie(this._camera.up.y,this._cameraUp0.y)||!ie(this._camera.up.z,this._cameraUp0.z)){this._camera.up.copy(this._cameraUp0);const s=this.getPosition(Q);this.updateCameraUp(),this.setPosition(s.x,s.y,s.z)}const t=[this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,e),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,e),this.zoomTo(this._zoom0,e)];return Promise.all(t)}saveState(){this._cameraUp0.copy(this._camera.up),this.getTarget(this._target0),this.getPosition(this._position0),this._zoom0=this._zoom,this._focalOffset0.copy(this._focalOffset)}updateCameraUp(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,mr),this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace).invert()}applyCameraUp(){const e=Q.subVectors(this._target,this._camera.position).normalize(),t=te.crossVectors(e,this._camera.up);this._camera.up.crossVectors(t,e).normalize(),this._camera.updateMatrixWorld();const s=this.getPosition(Q);this.updateCameraUp(),this.setPosition(s.x,s.y,s.z)}update(e){const t=this._sphericalEnd.theta-this._spherical.theta,s=this._sphericalEnd.phi-this._spherical.phi,i=this._sphericalEnd.radius-this._spherical.radius,r=Ac.subVectors(this._targetEnd,this._target),o=Mc.subVectors(this._focalOffsetEnd,this._focalOffset),a=this._zoomEnd-this._zoom;if(pe(t))this._thetaVelocity.value=0,this._spherical.theta=this._sphericalEnd.theta;else{const h=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.theta=fr(this._spherical.theta,this._sphericalEnd.theta,this._thetaVelocity,h,1/0,e),this._needsUpdate=!0}if(pe(s))this._phiVelocity.value=0,this._spherical.phi=this._sphericalEnd.phi;else{const h=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.phi=fr(this._spherical.phi,this._sphericalEnd.phi,this._phiVelocity,h,1/0,e),this._needsUpdate=!0}if(pe(i))this._radiusVelocity.value=0,this._spherical.radius=this._sphericalEnd.radius;else{const h=this._isUserControllingDolly?this.draggingSmoothTime:this.smoothTime;this._spherical.radius=fr(this._spherical.radius,this._sphericalEnd.radius,this._radiusVelocity,h,this.maxSpeed,e),this._needsUpdate=!0}if(pe(r.x)&&pe(r.y)&&pe(r.z))this._targetVelocity.set(0,0,0),this._target.copy(this._targetEnd);else{const h=this._isUserControllingTruck?this.draggingSmoothTime:this.smoothTime;Ec(this._target,this._targetEnd,this._targetVelocity,h,this.maxSpeed,e,this._target),this._needsUpdate=!0}if(pe(o.x)&&pe(o.y)&&pe(o.z))this._focalOffsetVelocity.set(0,0,0),this._focalOffset.copy(this._focalOffsetEnd);else{const h=this._isUserControllingOffset?this.draggingSmoothTime:this.smoothTime;Ec(this._focalOffset,this._focalOffsetEnd,this._focalOffsetVelocity,h,this.maxSpeed,e,this._focalOffset),this._needsUpdate=!0}if(pe(a))this._zoomVelocity.value=0,this._zoom=this._zoomEnd;else{const h=this._isUserControllingZoom?this.draggingSmoothTime:this.smoothTime;this._zoom=fr(this._zoom,this._zoomEnd,this._zoomVelocity,h,1/0,e)}if(this.dollyToCursor){if(qs(this._camera)&&this._changedDolly!==0){const h=this._spherical.radius-this._lastDistance,d=this._camera,f=this._getCameraDirection(fi),m=Q.copy(f).cross(d.up).normalize();m.lengthSq()===0&&(m.x=1);const p=te.crossVectors(m,f),_=this._sphericalEnd.radius*Math.tan(d.getEffectiveFOV()*ui*.5),S=(this._sphericalEnd.radius-h-this._sphericalEnd.radius)/this._sphericalEnd.radius,b=Tn.copy(this._targetEnd).add(m.multiplyScalar(this._dollyControlCoord.x*_*d.aspect)).add(p.multiplyScalar(this._dollyControlCoord.y*_)),v=Q.copy(this._targetEnd).lerp(b,S),g=this._lastDollyDirection===vn.IN&&this._spherical.radius<=this.minDistance,x=this._lastDollyDirection===vn.OUT&&this.maxDistance<=this._spherical.radius;if(this.infinityDolly&&(g||x)){this._sphericalEnd.radius-=h,this._spherical.radius-=h;const w=te.copy(f).multiplyScalar(-h);v.add(w)}this._boundary.clampPoint(v,v);const T=te.subVectors(v,this._targetEnd);this._targetEnd.copy(v),this._target.add(T),this._changedDolly-=h,pe(this._changedDolly)&&(this._changedDolly=0)}else if(xs(this._camera)&&this._changedZoom!==0){const h=this._zoom-this._lastZoom,d=this._camera,f=Q.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(d.near+d.far)/(d.near-d.far)).unproject(d),m=te.set(0,0,-1).applyQuaternion(d.quaternion),p=Tn.copy(f).add(m.multiplyScalar(-f.dot(d.up))),y=-(this._zoom-h-this._zoom)/this._zoom,S=this._getCameraDirection(fi),b=this._targetEnd.dot(S),v=Q.copy(this._targetEnd).lerp(p,y),g=v.dot(S),x=S.multiplyScalar(g-b);v.sub(x),this._boundary.clampPoint(v,v);const T=te.subVectors(v,this._targetEnd);this._targetEnd.copy(v),this._target.add(T),this._changedZoom-=h,pe(this._changedZoom)&&(this._changedZoom=0)}}this._camera.zoom!==this._zoom&&(this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0),this._dragNeedsUpdate=!0;const c=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,c),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target),(!pe(this._focalOffset.x)||!pe(this._focalOffset.y)||!pe(this._focalOffset.z))&&(this._camera.updateMatrixWorld(),zt.setFromMatrixColumn(this._camera.matrix,0),Vt.setFromMatrixColumn(this._camera.matrix,1),Ws.setFromMatrixColumn(this._camera.matrix,2),zt.multiplyScalar(this._focalOffset.x),Vt.multiplyScalar(-this._focalOffset.y),Ws.multiplyScalar(this._focalOffset.z),Q.copy(zt).add(Vt).add(Ws),this._camera.position.add(Q)),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),Q.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);const u=this._needsUpdate;return u&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):u?(this.dispatchEvent({type:"update"}),pe(t,this.restThreshold)&&pe(s,this.restThreshold)&&pe(i,this.restThreshold)&&pe(r.x,this.restThreshold)&&pe(r.y,this.restThreshold)&&pe(r.z,this.restThreshold)&&pe(o.x,this.restThreshold)&&pe(o.y,this.restThreshold)&&pe(o.z,this.restThreshold)&&pe(a,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!u&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._lastDistance=this._spherical.radius,this._lastZoom=this._zoom,this._updatedLastTime=u,this._needsUpdate=!1,u}toJSON(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:hi(this.maxDistance),minZoom:this.minZoom,maxZoom:hi(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:hi(this.maxPolarAngle),minAzimuthAngle:hi(this.minAzimuthAngle),maxAzimuthAngle:hi(this.maxAzimuthAngle),smoothTime:this.smoothTime,draggingSmoothTime:this.draggingSmoothTime,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,verticalDragToForward:this.verticalDragToForward,target:this._targetEnd.toArray(),position:Q.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}fromJSON(e,t=!1){const s=JSON.parse(e);this.enabled=s.enabled,this.minDistance=s.minDistance,this.maxDistance=di(s.maxDistance),this.minZoom=s.minZoom,this.maxZoom=di(s.maxZoom),this.minPolarAngle=s.minPolarAngle,this.maxPolarAngle=di(s.maxPolarAngle),this.minAzimuthAngle=di(s.minAzimuthAngle),this.maxAzimuthAngle=di(s.maxAzimuthAngle),this.smoothTime=s.smoothTime,this.draggingSmoothTime=s.draggingSmoothTime,this.dollySpeed=s.dollySpeed,this.truckSpeed=s.truckSpeed,this.dollyToCursor=s.dollyToCursor,this.verticalDragToForward=s.verticalDragToForward,this._target0.fromArray(s.target0),this._position0.fromArray(s.position0),this._zoom0=s.zoom0,this._focalOffset0.fromArray(s.focalOffset0),this.moveTo(s.target[0],s.target[1],s.target[2],t),yt.setFromVector3(Q.fromArray(s.position).sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(yt.theta,yt.phi,t),this.dollyTo(yt.radius,t),this.zoomTo(s.zoom,t),this.setFocalOffset(s.focalOffset[0],s.focalOffset[1],s.focalOffset[2],t),this._needsUpdate=!0}connect(e){if(this._domElement){console.warn("camera-controls is already connected.");return}e.setAttribute("data-camera-controls-version",Md),this._addAllEventListeners(e),this._getClientRect(this._elementRect)}disconnect(){this.cancel(),this._removeAllEventListeners(),this._domElement&&(this._domElement.removeAttribute("data-camera-controls-version"),this._domElement=void 0)}dispose(){this.removeAllEventListeners(),this.disconnect()}_getTargetDirection(e){return e.setFromSpherical(this._spherical).divideScalar(this._spherical.radius).applyQuaternion(this._yAxisUpSpaceInverse)}_getCameraDirection(e){return this._getTargetDirection(e).negate()}_findPointerById(e){return this._activePointers.find(t=>t.pointerId===e)}_findPointerByMouseButton(e){return this._activePointers.find(t=>t.mouseButton===e)}_disposePointer(e){this._activePointers.splice(this._activePointers.indexOf(e),1)}_encloseToBoundary(e,t,s){const i=t.lengthSq();if(i===0)return e;const r=te.copy(t).add(e),a=this._boundary.clampPoint(r,Tn).sub(r),c=a.lengthSq();if(c===0)return e.add(t);if(c===i)return e;if(s===0)return e.add(t).add(a);{const l=1+s*c/t.dot(a);return e.add(te.copy(t).multiplyScalar(l)).add(a.multiplyScalar(1-s))}}_updateNearPlaneCorners(){if(qs(this._camera)){const e=this._camera,t=e.near,s=e.getEffectiveFOV()*ui,i=Math.tan(s*.5)*t,r=i*e.aspect;this._nearPlaneCorners[0].set(-r,-i,0),this._nearPlaneCorners[1].set(r,-i,0),this._nearPlaneCorners[2].set(r,i,0),this._nearPlaneCorners[3].set(-r,i,0)}else if(xs(this._camera)){const e=this._camera,t=1/e.zoom,s=e.left*t,i=e.right*t,r=e.top*t,o=e.bottom*t;this._nearPlaneCorners[0].set(s,r,0),this._nearPlaneCorners[1].set(i,r,0),this._nearPlaneCorners[2].set(i,o,0),this._nearPlaneCorners[3].set(s,o,0)}}_collisionTest(){let e=1/0;if(!(this.colliderMeshes.length>=1)||Oo(this._camera,"_collisionTest"))return e;const s=this._getTargetDirection(fi);ko.lookAt(Oc,s,this._camera.up);for(let i=0;i<4;i++){const r=te.copy(this._nearPlaneCorners[i]);r.applyMatrix4(ko);const o=Tn.addVectors(this._target,r);_r.set(o,s),_r.far=this._spherical.radius+1;const a=_r.intersectObjects(this.colliderMeshes);a.length!==0&&a[0].distance<e&&(e=a[0].distance)}return e}_getClientRect(e){if(!this._domElement)return;const t=this._domElement.getBoundingClientRect();return e.x=t.left,e.y=t.top,this._viewport?(e.x+=this._viewport.x,e.y+=t.height-this._viewport.w-this._viewport.y,e.width=this._viewport.z,e.height=this._viewport.w):(e.width=t.width,e.height=t.height),e}_createOnRestPromise(e){return e?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise(t=>{const s=()=>{this.removeEventListener("rest",s),t()};this.addEventListener("rest",s)}))}_addAllEventListeners(e){}_removeAllEventListeners(){}get dampingFactor(){return console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead."),0}set dampingFactor(e){console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead.")}get draggingDampingFactor(){return console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead."),0}set draggingDampingFactor(e){console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead.")}static createBoundingSphere(e,t=new G.Sphere){const s=t,i=s.center;xn.makeEmpty(),e.traverseVisible(o=>{o.isMesh&&xn.expandByObject(o)}),xn.getCenter(i);let r=0;return e.traverseVisible(o=>{if(!o.isMesh)return;const a=o,c=a.geometry.clone();c.applyMatrix4(a.matrixWorld);const u=c.attributes.position;for(let h=0,d=u.count;h<d;h++)Q.fromBufferAttribute(u,h),r=Math.max(r,i.distanceToSquared(Q))}),s.radius=Math.sqrt(r),s}};const DT=P.forwardRef((n,e)=>{P.useMemo(()=>{Ro.install({THREE:Qh}),ba({CameraControlsImpl:Ro})},[]);const{camera:t,domElement:s,makeDefault:i,onStart:r,onEnd:o,onChange:a,regress:c,...l}=n,u=we(g=>g.camera),h=we(g=>g.gl),d=we(g=>g.invalidate),f=we(g=>g.events),m=we(g=>g.setEvents),p=we(g=>g.set),_=we(g=>g.get),y=we(g=>g.performance),S=t||u,b=s||f.connected||h.domElement,v=P.useMemo(()=>new Ro(S),[S]);return Ca((g,x)=>{v.enabled&&v.update(x)},-1),P.useEffect(()=>(v.connect(b),()=>void v.disconnect()),[b,v]),P.useEffect(()=>{const g=w=>{d(),c&&y.regress(),a&&a(w)},x=w=>{r&&r(w)},T=w=>{o&&o(w)};return v.addEventListener("update",g),v.addEventListener("controlstart",x),v.addEventListener("controlend",T),()=>{v.removeEventListener("update",g),v.removeEventListener("controlstart",x),v.removeEventListener("controlend",T)}},[v,r,o,d,m,c,a]),P.useEffect(()=>{if(i){const g=_().controls;return p({controls:v}),()=>p({controls:g})}},[i,v]),P.createElement("primitive",xa({ref:e,object:v},l))}),kl=P.createContext(null),kT=P.forwardRef((n,e)=>{P.useMemo(()=>ba({SegmentObject:Rd}),[]);const{limit:t=1e3,lineWidth:s=1,children:i,...r}=n,[o,a]=P.useState([]),[c]=P.useState(()=>new pd),[l]=P.useState(()=>new md),[u]=P.useState(()=>new _d),[h]=P.useState(()=>new Re(512,512)),[d]=P.useState(()=>Array(t*6).fill(0)),[f]=P.useState(()=>Array(t*6).fill(0)),m=P.useMemo(()=>({subscribe:p=>(a(_=>[..._,p]),()=>a(_=>_.filter(y=>y.current!==p.current)))}),[]);return Ca(()=>{for(let _=0;_<t;_++){var p;const y=(p=o[_])==null?void 0:p.current;y&&(d[_*6+0]=y.start.x,d[_*6+1]=y.start.y,d[_*6+2]=y.start.z,d[_*6+3]=y.end.x,d[_*6+4]=y.end.y,d[_*6+5]=y.end.z,f[_*6+0]=y.color.r,f[_*6+1]=y.color.g,f[_*6+2]=y.color.b,f[_*6+3]=y.color.r,f[_*6+4]=y.color.g,f[_*6+5]=y.color.b)}u.setColors(f),u.setPositions(d),c.computeLineDistances()}),P.createElement("primitive",{object:c,ref:e},P.createElement("primitive",{object:u,attach:"geometry"}),P.createElement("primitive",xa({object:l,attach:"material",vertexColors:!0,resolution:h,linewidth:s},r)),P.createElement(kl.Provider,{value:m},i))});class Rd{constructor(){this.color=new Ss("white"),this.start=new Ue(0,0,0),this.end=new Ue(0,0,0)}}const Rc=n=>n instanceof Ue?n:new Ue(...typeof n=="number"?[n,n,n]:n),RT=P.forwardRef(({color:n,start:e,end:t},s)=>{const i=P.useContext(kl);if(!i)throw"Segment must used inside Segments component.";const r=P.useRef(null);return P.useLayoutEffect(()=>i.subscribe(r),[]),P.createElement("segmentObject",{ref:gd([r,s]),color:n,start:Rc(e),end:Rc(t)})});function PT({all:n,scene:e,camera:t}){const s=we(({gl:o})=>o),i=we(({camera:o})=>o),r=we(({scene:o})=>o);return P.useLayoutEffect(()=>{const o=[];n&&(e||r).traverse(l=>{l.visible===!1&&(o.push(l),l.visible=!0)}),s.compile(e||r,t||i);const a=new Kh(128);new Jh(.01,1e5,a).update(s,e||r),a.dispose(),o.forEach(l=>l.visible=!1)},[]),null}function NT({pixelated:n}){const e=we(o=>o.gl),t=we(o=>o.internal.active),s=we(o=>o.performance.current),i=we(o=>o.viewport.initialDpr),r=we(o=>o.setDpr);return P.useEffect(()=>{const o=e.domElement;return()=>{t&&r(i),n&&o&&(o.style.imageRendering="auto")}},[]),P.useEffect(()=>{r(s*i),n&&e.domElement&&(e.domElement.style.imageRendering=s===1?"auto":"pixelated")},[s]),null}function IT(){const n=we(s=>s.get),e=we(s=>s.setEvents),t=we(s=>s.performance.current);return P.useEffect(()=>{const s=n().events.enabled;return()=>e({enabled:s})},[]),P.useEffect(()=>e({enabled:t===1}),[t]),null}const Ea=P.createContext(null);function FT({children:n,enabled:e=!0}){const[t,s]=P.useState([]),i=P.useMemo(()=>({selected:t,select:s,enabled:e}),[t,s,e]);return is.jsx(Ea.Provider,{value:i,children:n})}function UT({enabled:n=!1,children:e,...t}){const s=P.useRef(null),i=P.useContext(Ea);return P.useEffect(()=>{if(i&&n){let r=!1;const o=[];if(s.current.traverse(a=>{a.type==="Mesh"&&o.push(a),i.selected.indexOf(a)===-1&&(r=!0)}),r)return i.select(a=>[...a,...o]),()=>{i.select(a=>a.filter(c=>!o.includes(c)))}}},[n,e,i]),is.jsx("group",{ref:s,...t,children:e})}/**
 * postprocessing v6.33.4 build Sat Dec 02 2023
 * https://github.com/pmndrs/postprocessing
 * Copyright 2015-2023 Raoul van Rschen
 * @license Zlib
 */var Rl="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",K={SKIP:9,SET:30,ADD:0,ALPHA:1,AVERAGE:2,COLOR:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,DIVIDE:8,DST:9,EXCLUSION:10,HARD_LIGHT:11,HARD_MIX:12,HUE:13,INVERT:14,INVERT_RGB:15,LIGHTEN:16,LINEAR_BURN:17,LINEAR_DODGE:18,LINEAR_LIGHT:19,LUMINOSITY:20,MULTIPLY:21,NEGATION:22,NORMAL:23,OVERLAY:24,PIN_LIGHT:25,REFLECT:26,SATURATION:27,SCREEN:28,SOFT_LIGHT:29,SRC:30,SUBTRACT:31,VIVID_LIGHT:32},Pl="",Ve="srgb",no="srgb-linear",rs={NONE:0,DEPTH:1,CONVOLUTION:2},se={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},io={VERY_SMALL:0,SMALL:1,MEDIUM:2,LARGE:3,VERY_LARGE:4,HUGE:5},gr={DEFAULT:0,ESKIL:1},Nl=Number(Sa.replace(/\D+/g,"")),Il=Nl>=152,Pd=new Map([[Ol,no],[Al,Ve]]),Nd=new Map([[no,Ol],[Ve,Al]]);function Fn(n){return n===null?null:Il?n.outputColorSpace:Pd.get(n.outputEncoding)}function Os(n,e){n!==null&&(Il?n.colorSpace=e:n.encoding=Nd.get(e))}function Xi(n){return Nl<154?n.replace("colorspace_fragment","encodings_fragment"):n}var Id=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;
#include <colorspace_fragment>
}`,Fd="uniform vec4 texelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize.xy*vec2(kernel)+texelSize.zw)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}",Ud=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],Ld=class extends Yt{constructor(n=new wc){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new X(null),texelSize:new X(new wc),scale:new X(1),kernel:new X(0)},blending:fs,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Id,vertexShader:Fd}),this.fragmentShader=Xi(this.fragmentShader),this.setTexelSize(n.x,n.y),this.kernelSize=io.MEDIUM}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.inputBuffer=n}get kernelSequence(){return Ud[this.kernelSize]}get scale(){return this.uniforms.scale.value}set scale(n){this.uniforms.scale.value=n}getScale(){return this.uniforms.scale.value}setScale(n){this.uniforms.scale.value=n}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(n){this.uniforms.kernel.value=n}setKernel(n){this.kernel=n}setTexelSize(n,e){this.uniforms.texelSize.value.set(n,e,n*.5,e*.5)}setSize(n,e){const t=1/n,s=1/e;this.uniforms.texelSize.value.set(t,s,t*.5,s*.5)}},Bd=`#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;
#include <colorspace_fragment>
#include <dithering_fragment>
}`,Fl=class extends Yt{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new X(null),opacity:new X(1)},blending:fs,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Bd,vertexShader:Rl}),this.fragmentShader=Xi(this.fragmentShader)}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}getOpacity(n){return this.uniforms.opacity.value}setOpacity(n){this.uniforms.opacity.value=n}},zd=`#include <packing>
#include <clipping_planes_pars_fragment>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform float cameraNear;uniform float cameraFar;centroid varying float vViewZ;centroid varying vec4 vProjTexCoord;void main(){
#include <clipping_planes_fragment>
vec2 projTexCoord=(vProjTexCoord.xy/vProjTexCoord.w)*0.5+0.5;projTexCoord=clamp(projTexCoord,0.002,0.998);
#if DEPTH_PACKING == 3201
float fragCoordZ=unpackRGBAToDepth(texture2D(depthBuffer,projTexCoord));
#else
float fragCoordZ=texture2D(depthBuffer,projTexCoord).r;
#endif
#ifdef PERSPECTIVE_CAMERA
float viewZ=perspectiveDepthToViewZ(fragCoordZ,cameraNear,cameraFar);
#else
float viewZ=orthographicDepthToViewZ(fragCoordZ,cameraNear,cameraFar);
#endif
float depthTest=(-vViewZ>-viewZ)?1.0:0.0;gl_FragColor.rg=vec2(0.0,depthTest);}`,Vd=`#include <common>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
varying float vViewZ;varying vec4 vProjTexCoord;void main(){
#include <skinbase_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <project_vertex>
vViewZ=mvPosition.z;vProjTexCoord=gl_Position;
#include <clipping_planes_vertex>
}`,Hd=class extends Yt{constructor(n=null,e){super({name:"DepthComparisonMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new X(null),cameraNear:new X(.3),cameraFar:new X(1e3)},blending:fs,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:zd,vertexShader:Vd}),this.depthBuffer=n,this.depthPacking=jo,this.copyCameraSettings(e)}set depthBuffer(n){this.uniforms.depthBuffer.value=n}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,e=jo){this.depthBuffer=n,this.depthPacking=e}adoptCameraSettings(n){this.copyCameraSettings(n)}copyCameraSettings(n){n&&(this.uniforms.cameraNear.value=n.near,this.uniforms.cameraFar.value=n.far,n instanceof bl?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},qd=`#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
#ifdef DOWNSAMPLE_NORMALS
uniform lowp sampler2D normalBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}int findBestDepth(const in float samples[4]){float c=(samples[0]+samples[1]+samples[2]+samples[3])*0.25;float distances[4];distances[0]=abs(c-samples[0]);distances[1]=abs(c-samples[1]);distances[2]=abs(c-samples[2]);distances[3]=abs(c-samples[3]);float maxDistance=max(max(distances[0],distances[1]),max(distances[2],distances[3]));int remaining[3];int rejected[3];int i,j,k;for(i=0,j=0,k=0;i<4;++i){if(distances[i]<maxDistance){remaining[j++]=i;}else{rejected[k++]=i;}}for(;j<3;++j){remaining[j]=rejected[--k];}vec3 s=vec3(samples[remaining[0]],samples[remaining[1]],samples[remaining[2]]);c=(s.x+s.y+s.z)/3.0;distances[0]=abs(c-s.x);distances[1]=abs(c-s.y);distances[2]=abs(c-s.z);float minDistance=min(distances[0],min(distances[1],distances[2]));for(i=0;i<3;++i){if(distances[i]==minDistance){break;}}return remaining[i];}void main(){float d[4];d[0]=readDepth(vUv0);d[1]=readDepth(vUv1);d[2]=readDepth(vUv2);d[3]=readDepth(vUv3);int index=findBestDepth(d);
#ifdef DOWNSAMPLE_NORMALS
vec3 n[4];n[0]=texture2D(normalBuffer,vUv0).rgb;n[1]=texture2D(normalBuffer,vUv1).rgb;n[2]=texture2D(normalBuffer,vUv2).rgb;n[3]=texture2D(normalBuffer,vUv3).rgb;
#else
vec3 n[4];n[0]=vec3(0.0);n[1]=vec3(0.0);n[2]=vec3(0.0);n[3]=vec3(0.0);
#endif
gl_FragColor=vec4(n[index],d[index]);}`,Wd="uniform vec2 texelSize;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vUv0=uv;vUv1=vec2(uv.x,uv.y+texelSize.y);vUv2=vec2(uv.x+texelSize.x,uv.y);vUv3=uv+texelSize;gl_Position=vec4(position.xy,1.0,1.0);}",Gd=class extends Yt{constructor(){super({name:"DepthDownsamplingMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new X(null),normalBuffer:new X(null),texelSize:new X(new Re)},blending:fs,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:qd,vertexShader:Wd})}set depthBuffer(n){this.uniforms.depthBuffer.value=n}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,e=Xn){this.depthBuffer=n,this.depthPacking=e}set normalBuffer(n){this.uniforms.normalBuffer.value=n,n!==null?this.defines.DOWNSAMPLE_NORMALS="1":delete this.defines.DOWNSAMPLE_NORMALS,this.needsUpdate=!0}setNormalBuffer(n){this.normalBuffer=n}setTexelSize(n,e){this.uniforms.texelSize.value.set(n,e)}setSize(n,e){this.uniforms.texelSize.value.set(1/n,1/e)}},jd=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#define WEIGHT_INNER 0.125
#define WEIGHT_OUTER 0.0555555
varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;float clampToBorder(const in vec2 uv){return float(uv.s>=0.0&&uv.s<=1.0&&uv.t>=0.0&&uv.t<=1.0);}void main(){vec4 c=vec4(0.0);vec4 w=WEIGHT_INNER*vec4(clampToBorder(vUv00),clampToBorder(vUv01),clampToBorder(vUv02),clampToBorder(vUv03));c+=w.x*texture2D(inputBuffer,vUv00);c+=w.y*texture2D(inputBuffer,vUv01);c+=w.z*texture2D(inputBuffer,vUv02);c+=w.w*texture2D(inputBuffer,vUv03);w=WEIGHT_OUTER*vec4(clampToBorder(vUv04),clampToBorder(vUv05),clampToBorder(vUv06),clampToBorder(vUv07));c+=w.x*texture2D(inputBuffer,vUv04);c+=w.y*texture2D(inputBuffer,vUv05);c+=w.z*texture2D(inputBuffer,vUv06);c+=w.w*texture2D(inputBuffer,vUv07);w=WEIGHT_OUTER*vec4(clampToBorder(vUv08),clampToBorder(vUv09),clampToBorder(vUv10),clampToBorder(vUv11));c+=w.x*texture2D(inputBuffer,vUv08);c+=w.y*texture2D(inputBuffer,vUv09);c+=w.z*texture2D(inputBuffer,vUv10);c+=w.w*texture2D(inputBuffer,vUv11);c+=WEIGHT_OUTER*texture2D(inputBuffer,vUv);gl_FragColor=c;
#include <colorspace_fragment>
}`,Yd="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;void main(){vUv=position.xy*0.5+0.5;vUv00=vUv+texelSize*vec2(-1.0,1.0);vUv01=vUv+texelSize*vec2(1.0,1.0);vUv02=vUv+texelSize*vec2(-1.0,-1.0);vUv03=vUv+texelSize*vec2(1.0,-1.0);vUv04=vUv+texelSize*vec2(-2.0,2.0);vUv05=vUv+texelSize*vec2(0.0,2.0);vUv06=vUv+texelSize*vec2(2.0,2.0);vUv07=vUv+texelSize*vec2(-2.0,0.0);vUv08=vUv+texelSize*vec2(2.0,0.0);vUv09=vUv+texelSize*vec2(-2.0,-2.0);vUv10=vUv+texelSize*vec2(0.0,-2.0);vUv11=vUv+texelSize*vec2(2.0,-2.0);gl_Position=vec4(position.xy,1.0,1.0);}",Zd=class extends Yt{constructor(){super({name:"DownsamplingMaterial",uniforms:{inputBuffer:new X(null),texelSize:new X(new Re)},blending:fs,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:jd,vertexShader:Yd}),this.fragmentShader=Xi(this.fragmentShader)}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setSize(n,e){this.uniforms.texelSize.value.set(1/n,1/e)}},Xd=`#include <common>
#include <packing>
#include <dithering_pars_fragment>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#if DEPTH_PACKING == 3201
uniform lowp sampler2D depthBuffer;
#elif defined(GL_FRAGMENT_PRECISION_HIGH)
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#if THREE_REVISION >= 137
vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}vec3 RGBToHCV(const in vec3 RGB){vec4 P=mix(vec4(RGB.bg,-1.0,2.0/3.0),vec4(RGB.gb,0.0,-1.0/3.0),step(RGB.b,RGB.g));vec4 Q=mix(vec4(P.xyw,RGB.r),vec4(RGB.r,P.yzx),step(P.x,RGB.r));float C=Q.x-min(Q.w,Q.y);float H=abs((Q.w-Q.y)/(6.0*C+EPSILON)+Q.z);return vec3(H,C,Q.x);}vec3 RGBToHSL(const in vec3 RGB){vec3 HCV=RGBToHCV(RGB);float L=HCV.z-HCV.y*0.5;float S=HCV.y/(1.0-abs(L*2.0-1.0)+EPSILON);return vec3(HCV.x,S,L);}vec3 HueToRGB(const in float H){float R=abs(H*6.0-3.0)-1.0;float G=2.0-abs(H*6.0-2.0);float B=2.0-abs(H*6.0-4.0);return clamp(vec3(R,G,B),0.0,1.0);}vec3 HSLToRGB(const in vec3 HSL){vec3 RGB=HueToRGB(HSL.x);float C=(1.0-abs(2.0*HSL.z-1.0))*HSL.y;return(RGB-0.5)*C+HSL.z;}FRAGMENT_HEAD void main(){FRAGMENT_MAIN_UV vec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGE color0.a=clamp(color0.a,0.0,1.0);gl_FragColor=color0;
#ifdef ENCODE_OUTPUT
#include <colorspace_fragment>
#endif
#include <dithering_fragment>
}`,$d="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEAD void main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORT gl_Position=vec4(position.xy,1.0,1.0);}",Qd=class extends Yt{constructor(n,e,t,s,i=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:Sa.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new X(null),depthBuffer:new X(null),resolution:new X(new Re),texelSize:new X(new Re),cameraNear:new X(.3),cameraFar:new X(1e3),aspect:new X(1),time:new X(0)},blending:fs,toneMapped:!1,depthWrite:!1,depthTest:!1,dithering:i}),n&&this.setShaderParts(n),e&&this.setDefines(e),t&&this.setUniforms(t),this.copyCameraSettings(s)}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(n){this.uniforms.depthBuffer.value=n}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,e=Xn){this.depthBuffer=n,this.depthPacking=e}setShaderData(n){this.setShaderParts(n.shaderParts),this.setDefines(n.defines),this.setUniforms(n.uniforms),this.setExtensions(n.extensions)}setShaderParts(n){return this.fragmentShader=Xd.replace(se.FRAGMENT_HEAD,n.get(se.FRAGMENT_HEAD)||"").replace(se.FRAGMENT_MAIN_UV,n.get(se.FRAGMENT_MAIN_UV)||"").replace(se.FRAGMENT_MAIN_IMAGE,n.get(se.FRAGMENT_MAIN_IMAGE)||""),this.vertexShader=$d.replace(se.VERTEX_HEAD,n.get(se.VERTEX_HEAD)||"").replace(se.VERTEX_MAIN_SUPPORT,n.get(se.VERTEX_MAIN_SUPPORT)||""),this.fragmentShader=Xi(this.fragmentShader),this.needsUpdate=!0,this}setDefines(n){for(const e of n.entries())this.defines[e[0]]=e[1];return this.needsUpdate=!0,this}setUniforms(n){for(const e of n.entries())this.uniforms[e[0]]=e[1];return this}setExtensions(n){this.extensions={};for(const e of n)this.extensions[e]=!0;return this}get encodeOutput(){return this.defines.ENCODE_OUTPUT!==void 0}set encodeOutput(n){this.encodeOutput!==n&&(n?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(n){return this.encodeOutput}setOutputEncodingEnabled(n){this.encodeOutput=n}get time(){return this.uniforms.time.value}set time(n){this.uniforms.time.value=n}setDeltaTime(n){this.uniforms.time.value+=n}adoptCameraSettings(n){this.copyCameraSettings(n)}copyCameraSettings(n){n&&(this.uniforms.cameraNear.value=n.near,this.uniforms.cameraFar.value=n.far,n instanceof bl?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(n,e){const t=this.uniforms;t.resolution.value.set(n,e),t.texelSize.value.set(1/n,1/e),t.aspect.value=n/e}static get Section(){return se}},Kd=`#include <common>
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef RANGE
uniform vec2 range;
#elif defined(THRESHOLD)
uniform float threshold;uniform float smoothing;
#endif
varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);
#ifdef RANGE
float low=step(range.x,l);float high=step(l,range.y);l*=low*high;
#elif defined(THRESHOLD)
l=smoothstep(threshold,threshold+smoothing,l);
#endif
#ifdef COLOR
gl_FragColor=vec4(texel.rgb*l,l);
#else
gl_FragColor=vec4(l);
#endif
}`,Jd=class extends Yt{constructor(n=!1,e=null){super({name:"LuminanceMaterial",defines:{THREE_REVISION:Sa.replace(/\D+/g,"")},uniforms:{inputBuffer:new X(null),threshold:new X(0),smoothing:new X(1),range:new X(null)},blending:fs,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Kd,vertexShader:Rl}),this.colorOutput=n,this.luminanceRange=e}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}get threshold(){return this.uniforms.threshold.value}set threshold(n){this.smoothing>0||n>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=n}getThreshold(){return this.threshold}setThreshold(n){this.threshold=n}get smoothing(){return this.uniforms.smoothing.value}set smoothing(n){this.threshold>0||n>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=n}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(n){this.smoothing=n}get useThreshold(){return this.threshold>0||this.smoothing>0}set useThreshold(n){}get colorOutput(){return this.defines.COLOR!==void 0}set colorOutput(n){n?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(n){return this.colorOutput}setColorOutputEnabled(n){this.colorOutput=n}get useRange(){return this.luminanceRange!==null}set useRange(n){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(n){n!==null?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=n,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(n){this.luminanceRange=n}},ef="uniform lowp sampler2D inputBuffer;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 c0=texture2D(inputBuffer,vUv0).rg;vec2 c1=texture2D(inputBuffer,vUv1).rg;vec2 c2=texture2D(inputBuffer,vUv2).rg;vec2 c3=texture2D(inputBuffer,vUv3).rg;float d0=(c0.x-c1.x)*0.5;float d1=(c2.x-c3.x)*0.5;float d=length(vec2(d0,d1));float a0=min(c0.y,c1.y);float a1=min(c2.y,c3.y);float visibilityFactor=min(a0,a1);gl_FragColor.rg=(1.0-visibilityFactor>0.001)?vec2(d,0.0):vec2(0.0,d);}",tf="uniform vec2 texelSize;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vUv0=vec2(uv.x+texelSize.x,uv.y);vUv1=vec2(uv.x-texelSize.x,uv.y);vUv2=vec2(uv.x,uv.y+texelSize.y);vUv3=vec2(uv.x,uv.y-texelSize.y);gl_Position=vec4(position.xy,1.0,1.0);}",sf=class extends Yt{constructor(n=new Re){super({name:"OutlineMaterial",uniforms:{inputBuffer:new X(null),texelSize:new X(new Re)},blending:fs,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:ef,vertexShader:tf}),this.uniforms.texelSize.value.set(n.x,n.y),this.uniforms.maskTexture=this.uniforms.inputBuffer}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}setTexelSize(n,e){this.uniforms.texelSize.value.set(n,e)}setSize(n,e){this.uniforms.texelSize.value.set(1/n,1/e)}},nf=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;uniform mediump sampler2D supportBuffer;
#else
uniform lowp sampler2D inputBuffer;uniform lowp sampler2D supportBuffer;
#endif
uniform float radius;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vec4 c=vec4(0.0);c+=texture2D(inputBuffer,vUv0)*0.0625;c+=texture2D(inputBuffer,vUv1)*0.125;c+=texture2D(inputBuffer,vUv2)*0.0625;c+=texture2D(inputBuffer,vUv3)*0.125;c+=texture2D(inputBuffer,vUv)*0.25;c+=texture2D(inputBuffer,vUv4)*0.125;c+=texture2D(inputBuffer,vUv5)*0.0625;c+=texture2D(inputBuffer,vUv6)*0.125;c+=texture2D(inputBuffer,vUv7)*0.0625;vec4 baseColor=texture2D(supportBuffer,vUv);gl_FragColor=mix(baseColor,c,radius);
#include <colorspace_fragment>
}`,rf="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,1.0);vUv1=vUv+texelSize*vec2(0.0,1.0);vUv2=vUv+texelSize*vec2(1.0,1.0);vUv3=vUv+texelSize*vec2(-1.0,0.0);vUv4=vUv+texelSize*vec2(1.0,0.0);vUv5=vUv+texelSize*vec2(-1.0,-1.0);vUv6=vUv+texelSize*vec2(0.0,-1.0);vUv7=vUv+texelSize*vec2(1.0,-1.0);gl_Position=vec4(position.xy,1.0,1.0);}",of=class extends Yt{constructor(){super({name:"UpsamplingMaterial",uniforms:{inputBuffer:new X(null),supportBuffer:new X(null),texelSize:new X(new Re),radius:new X(.85)},blending:fs,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:nf,vertexShader:rf}),this.fragmentShader=Xi(this.fragmentShader)}set inputBuffer(n){this.uniforms.inputBuffer.value=n}set supportBuffer(n){this.uniforms.supportBuffer.value=n}get radius(){return this.uniforms.radius.value}set radius(n){this.uniforms.radius.value=n}setSize(n,e){this.uniforms.texelSize.value.set(1/n,1/e)}},af=new ud,vs=null;function cf(){if(vs===null){const n=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),e=new Float32Array([0,0,2,0,0,2]);vs=new hd,vs.setAttribute!==void 0?(vs.setAttribute("position",new ur(n,3)),vs.setAttribute("uv",new ur(e,2))):(vs.addAttribute("position",new ur(n,3)),vs.addAttribute("uv",new ur(e,2)))}return vs}var et=class Ul{constructor(e="Pass",t=new xc,s=af){this.name=e,this.renderer=null,this.scene=t,this.camera=s,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(e){if(this.rtt===e){const t=this.fullscreenMaterial;t!==null&&(t.needsUpdate=!0),this.rtt=!e}}set mainScene(e){}set mainCamera(e){}setRenderer(e){this.renderer=e}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(e){let t=this.screen;t!==null?t.material=e:(t=new cd(cf(),e),t.frustumCulled=!1,this.scene===null&&(this.scene=new xc),this.scene.add(t),this.screen=t)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(e){this.fullscreenMaterial=e}getDepthTexture(){return null}setDepthTexture(e,t=Xn){}render(e,t,s,i,r){throw new Error("Render method not implemented!")}setSize(e,t){}initialize(e,t,s){}dispose(){for(const e of Object.keys(this)){const t=this[e];(t instanceof _t||t instanceof Cl||t instanceof El||t instanceof Ul)&&this[e].dispose()}}},lf=class extends et{constructor(n,e=!0){super("CopyPass"),this.fullscreenMaterial=new Fl,this.needsSwap=!1,this.renderTarget=n,n===void 0&&(this.renderTarget=new _t(1,1,{minFilter:Ar,magFilter:Ar,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=e}get resize(){return this.autoResize}set resize(n){this.autoResize=n}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(n){this.autoResize=n}render(n,e,t,s,i){this.fullscreenMaterial.inputBuffer=e.texture,n.setRenderTarget(this.renderToScreen?null:this.renderTarget),n.render(this.scene,this.camera)}setSize(n,e){this.autoResize&&this.renderTarget.setSize(n,e)}initialize(n,e,t){t!==void 0&&(this.renderTarget.texture.type=t,t!==as?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":Fn(n)===Ve&&Os(this.renderTarget.texture,Ve))}},uf=class extends et{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(n,e,t,s,i){const r=n.state.buffers.stencil;r.setLocked(!1),r.setTest(!1)}},Pc=new Ss,Oa=class extends et{constructor(n=!0,e=!0,t=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=n,this.depth=e,this.stencil=t,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(n,e,t){this.color=n,this.depth=e,this.stencil=t}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(n){this.overrideClearColor=n}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(n){this.overrideClearAlpha=n}render(n,e,t,s,i){const r=this.overrideClearColor,o=this.overrideClearAlpha,a=n.getClearAlpha(),c=r!==null,l=o>=0;c?(n.getClearColor(Pc),n.setClearColor(r,l?o:a)):l&&n.setClearAlpha(o),n.setRenderTarget(this.renderToScreen?null:e),n.clear(this.color,this.depth,this.stencil),c?n.setClearColor(Pc,a):l&&n.setClearAlpha(a)}},ro=class extends et{constructor(n,e,t=null){super("RenderPass",n,e),this.needsSwap=!1,this.clearPass=new Oa,this.overrideMaterialManager=t===null?null:new Ic(t),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}set mainScene(n){this.scene=n}set mainCamera(n){this.camera=n}get renderToScreen(){return super.renderToScreen}set renderToScreen(n){super.renderToScreen=n,this.clearPass.renderToScreen=n}get overrideMaterial(){const n=this.overrideMaterialManager;return n!==null?n.material:null}set overrideMaterial(n){const e=this.overrideMaterialManager;n!==null?e!==null?e.setMaterial(n):this.overrideMaterialManager=new Ic(n):e!==null&&(e.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(n){this.overrideMaterial=n}get clear(){return this.clearPass.enabled}set clear(n){this.clearPass.enabled=n}getSelection(){return this.selection}setSelection(n){this.selection=n}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(n){this.ignoreBackground=n}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(n){this.skipShadowMapUpdate=n}getClearPass(){return this.clearPass}render(n,e,t,s,i){const r=this.scene,o=this.camera,a=this.selection,c=o.layers.mask,l=r.background,u=n.shadowMap.autoUpdate,h=this.renderToScreen?null:e;a!==null&&o.layers.set(a.getLayer()),this.skipShadowMapUpdate&&(n.shadowMap.autoUpdate=!1),(this.ignoreBackground||this.clearPass.overrideClearColor!==null)&&(r.background=null),this.clearPass.enabled&&this.clearPass.render(n,e),n.setRenderTarget(h),this.overrideMaterialManager!==null?this.overrideMaterialManager.render(n,r,o):n.render(r,o),o.layers.mask=c,r.background=l,n.shadowMap.autoUpdate=u}},hf=class extends et{constructor(n,e,{renderTarget:t,resolutionScale:s=1,width:i=Ne.AUTO_SIZE,height:r=Ne.AUTO_SIZE,resolutionX:o=i,resolutionY:a=r}={}){super("DepthPass"),this.needsSwap=!1,this.renderPass=new ro(n,e,new ld({depthPacking:jo}));const c=this.renderPass;c.skipShadowMapUpdate=!0,c.ignoreBackground=!0;const l=c.clearPass;l.overrideClearColor=new Ss(16777215),l.overrideClearAlpha=1,this.renderTarget=t,this.renderTarget===void 0&&(this.renderTarget=new _t(1,1,{minFilter:In,magFilter:In}),this.renderTarget.texture.name="DepthPass.Target");const u=this.resolution=new Ne(this,o,a,s);u.addEventListener("change",h=>this.setSize(u.baseWidth,u.baseHeight))}set mainScene(n){this.renderPass.mainScene=n}set mainCamera(n){this.renderPass.mainCamera=n}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}render(n,e,t,s,i){const r=this.renderToScreen?null:this.renderTarget;this.renderPass.render(n,r)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e),this.renderTarget.setSize(t.width,t.height)}},df=class extends et{constructor({normalBuffer:n=null,resolutionScale:e=.5,width:t=Ne.AUTO_SIZE,height:s=Ne.AUTO_SIZE,resolutionX:i=t,resolutionY:r=s}={}){super("DepthDownsamplingPass");const o=new Gd;o.normalBuffer=n,this.fullscreenMaterial=o,this.needsDepthTexture=!0,this.needsSwap=!1,this.renderTarget=new _t(1,1,{minFilter:In,magFilter:In,depthBuffer:!1,type:ed}),this.renderTarget.texture.name="DepthDownsamplingPass.Target",this.renderTarget.texture.generateMipmaps=!1;const a=this.resolution=new Ne(this,i,r,e);a.addEventListener("change",c=>this.setSize(a.baseWidth,a.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}setDepthTexture(n,e=Xn){this.fullscreenMaterial.depthBuffer=n,this.fullscreenMaterial.depthPacking=e}render(n,e,t,s,i){n.setRenderTarget(this.renderToScreen?null:this.renderTarget),n.render(this.scene,this.camera)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e),this.renderTarget.setSize(t.width,t.height),this.fullscreenMaterial.setSize(n,e)}initialize(n,e,t){const s=n.getContext();if(!(s.getExtension("EXT_color_buffer_float")||s.getExtension("EXT_color_buffer_half_float")))throw new Error("Rendering to float texture is not supported.")}};function Nc(n,e,t){for(const s of e){const i="$1"+n+s.charAt(0).toUpperCase()+s.slice(1),r=new RegExp("([^\\.])(\\b"+s+"\\b)","g");for(const o of t.entries())o[1]!==null&&t.set(o[0],o[1].replace(r,i))}}function ff(n,e,t){let s=e.getFragmentShader(),i=e.getVertexShader();const r=s!==void 0&&/mainImage/.test(s),o=s!==void 0&&/mainUv/.test(s);if(t.attributes|=e.getAttributes(),s===void 0)throw new Error(`Missing fragment shader (${e.name})`);if(o&&t.attributes&rs.CONVOLUTION)throw new Error(`Effects that transform UVs are incompatible with convolution effects (${e.name})`);if(!r&&!o)throw new Error(`Could not find mainImage or mainUv function (${e.name})`);{const a=/\w+\s+(\w+)\([\w\s,]*\)\s*{/g,c=t.shaderParts;let l=c.get(se.FRAGMENT_HEAD)||"",u=c.get(se.FRAGMENT_MAIN_UV)||"",h=c.get(se.FRAGMENT_MAIN_IMAGE)||"",d=c.get(se.VERTEX_HEAD)||"",f=c.get(se.VERTEX_MAIN_SUPPORT)||"";const m=new Set,p=new Set;if(o&&(u+=`	${n}MainUv(UV);
`,t.uvTransformation=!0),i!==null&&/mainSupport/.test(i)){const S=/mainSupport *\([\w\s]*?uv\s*?\)/.test(i);f+=`	${n}MainSupport(`,f+=S?`vUv);
`:`);
`;for(const b of i.matchAll(/(?:varying\s+\w+\s+([\S\s]*?);)/g))for(const v of b[1].split(/\s*,\s*/))t.varyings.add(v),m.add(v),p.add(v);for(const b of i.matchAll(a))p.add(b[1])}for(const S of s.matchAll(a))p.add(S[1]);for(const S of e.defines.keys())p.add(S.replace(/\([\w\s,]*\)/g,""));for(const S of e.uniforms.keys())p.add(S);p.delete("while"),p.delete("for"),p.delete("if"),e.uniforms.forEach((S,b)=>t.uniforms.set(n+b.charAt(0).toUpperCase()+b.slice(1),S)),e.defines.forEach((S,b)=>t.defines.set(n+b.charAt(0).toUpperCase()+b.slice(1),S));const _=new Map([["fragment",s],["vertex",i]]);Nc(n,p,t.defines),Nc(n,p,_),s=_.get("fragment"),i=_.get("vertex");const y=e.blendMode;if(t.blendModes.set(y.blendFunction,y),r){e.inputColorSpace!==null&&e.inputColorSpace!==t.colorSpace&&(h+=e.inputColorSpace===Ve?`color0 = LinearTosRGB(color0);
	`:`color0 = sRGBToLinear(color0);
	`),e.outputColorSpace!==Pl?t.colorSpace=e.outputColorSpace:e.inputColorSpace!==null&&(t.colorSpace=e.inputColorSpace);const S=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/;h+=`${n}MainImage(color0, UV, `,t.attributes&rs.DEPTH&&S.test(s)&&(h+="depth, ",t.readDepth=!0),h+=`color1);
	`;const b=n+"BlendOpacity";t.uniforms.set(b,y.opacity),h+=`color0 = blend${y.blendFunction}(color0, color1, ${b});

	`,l+=`uniform float ${b};

`}if(l+=s+`
`,i!==null&&(d+=i+`
`),c.set(se.FRAGMENT_HEAD,l),c.set(se.FRAGMENT_MAIN_UV,u),c.set(se.FRAGMENT_MAIN_IMAGE,h),c.set(se.VERTEX_HEAD,d),c.set(se.VERTEX_MAIN_SUPPORT,f),e.extensions!==null)for(const S of e.extensions)t.extensions.add(S)}}var pf=class extends et{constructor(n,...e){super("EffectPass"),this.fullscreenMaterial=new Qd(null,null,null,n),this.listener=t=>this.handleEvent(t),this.effects=[],this.setEffects(e),this.skipRendering=!1,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY,this.timeScale=1}set mainScene(n){for(const e of this.effects)e.mainScene=n}set mainCamera(n){this.fullscreenMaterial.copyCameraSettings(n);for(const e of this.effects)e.mainCamera=n}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(n){this.fullscreenMaterial.encodeOutput=n}get dithering(){return this.fullscreenMaterial.dithering}set dithering(n){const e=this.fullscreenMaterial;e.dithering=n,e.needsUpdate=!0}setEffects(n){for(const e of this.effects)e.removeEventListener("change",this.listener);this.effects=n.sort((e,t)=>t.attributes-e.attributes);for(const e of this.effects)e.addEventListener("change",this.listener)}updateMaterial(){const n=new Sf;let e=0;for(const o of this.effects)if(o.blendMode.blendFunction===K.DST)n.attributes|=o.getAttributes()&rs.DEPTH;else{if(n.attributes&o.getAttributes()&rs.CONVOLUTION)throw new Error(`Convolution effects cannot be merged (${o.name})`);ff("e"+e++,o,n)}let t=n.shaderParts.get(se.FRAGMENT_HEAD),s=n.shaderParts.get(se.FRAGMENT_MAIN_IMAGE),i=n.shaderParts.get(se.FRAGMENT_MAIN_UV);const r=/\bblend\b/g;for(const o of n.blendModes.values())t+=o.getShaderCode().replace(r,`blend${o.blendFunction}`)+`
`;n.attributes&rs.DEPTH?(n.readDepth&&(s=`float depth = readDepth(UV);

	`+s),this.needsDepthTexture=this.getDepthTexture()===null):this.needsDepthTexture=!1,n.colorSpace===Ve&&(s+=`color0 = sRGBToLinear(color0);
	`),n.uvTransformation?(i=`vec2 transformedUv = vUv;
`+i,n.defines.set("UV","transformedUv")):n.defines.set("UV","vUv"),n.shaderParts.set(se.FRAGMENT_HEAD,t),n.shaderParts.set(se.FRAGMENT_MAIN_IMAGE,s),n.shaderParts.set(se.FRAGMENT_MAIN_UV,i);for(const[o,a]of n.shaderParts)a!==null&&n.shaderParts.set(o,a.trim().replace(/^#/,`
#`));this.skipRendering=e===0,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderData(n)}recompile(){this.updateMaterial()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(n,e=Xn){this.fullscreenMaterial.depthBuffer=n,this.fullscreenMaterial.depthPacking=e;for(const t of this.effects)t.setDepthTexture(n,e)}render(n,e,t,s,i){for(const r of this.effects)r.update(n,e,s);if(!this.skipRendering||this.renderToScreen){const r=this.fullscreenMaterial;r.inputBuffer=e.texture,r.time+=s*this.timeScale,n.setRenderTarget(this.renderToScreen?null:t),n.render(this.scene,this.camera)}}setSize(n,e){this.fullscreenMaterial.setSize(n,e);for(const t of this.effects)t.setSize(n,e)}initialize(n,e,t){this.renderer=n;for(const s of this.effects)s.initialize(n,e,t);this.updateMaterial(),t!==void 0&&t!==as&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(const n of this.effects)n.removeEventListener("change",this.listener),n.dispose()}handleEvent(n){switch(n.type){case"change":this.recompile();break}}},Ll=class extends et{constructor({kernelSize:n=io.MEDIUM,resolutionScale:e=.5,width:t=Ne.AUTO_SIZE,height:s=Ne.AUTO_SIZE,resolutionX:i=t,resolutionY:r=s}={}){super("KawaseBlurPass"),this.renderTargetA=new _t(1,1,{depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";const o=this.resolution=new Ne(this,i,r,e);o.addEventListener("change",a=>this.setSize(o.baseWidth,o.baseHeight)),this._blurMaterial=new Ld,this._blurMaterial.kernelSize=n,this.copyMaterial=new Fl}getResolution(){return this.resolution}get blurMaterial(){return this._blurMaterial}set blurMaterial(n){this._blurMaterial=n}get dithering(){return this.copyMaterial.dithering}set dithering(n){this.copyMaterial.dithering=n}get kernelSize(){return this.blurMaterial.kernelSize}set kernelSize(n){this.blurMaterial.kernelSize=n}get width(){return this.resolution.width}set width(n){this.resolution.preferredWidth=n}get height(){return this.resolution.height}set height(n){this.resolution.preferredHeight=n}get scale(){return this.blurMaterial.scale}set scale(n){this.blurMaterial.scale=n}getScale(){return this.blurMaterial.scale}setScale(n){this.blurMaterial.scale=n}getKernelSize(){return this.kernelSize}setKernelSize(n){this.kernelSize=n}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}render(n,e,t,s,i){const r=this.scene,o=this.camera,a=this.renderTargetA,c=this.renderTargetB,l=this.blurMaterial,u=l.kernelSequence;let h=e;this.fullscreenMaterial=l;for(let d=0,f=u.length;d<f;++d){const m=d&1?c:a;l.kernel=u[d],l.inputBuffer=h.texture,n.setRenderTarget(m),n.render(r,o),h=m}this.fullscreenMaterial=this.copyMaterial,this.copyMaterial.inputBuffer=h.texture,n.setRenderTarget(this.renderToScreen?null:t),n.render(r,o)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e);const s=t.width,i=t.height;this.renderTargetA.setSize(s,i),this.renderTargetB.setSize(s,i),this.blurMaterial.setSize(n,e)}initialize(n,e,t){t!==void 0&&(this.renderTargetA.texture.type=t,this.renderTargetB.texture.type=t,t!==as?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.copyMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):Fn(n)===Ve&&(Os(this.renderTargetA.texture,Ve),Os(this.renderTargetB.texture,Ve)))}static get AUTO_SIZE(){return Ne.AUTO_SIZE}},mf=class extends et{constructor({renderTarget:n,luminanceRange:e,colorOutput:t,resolutionScale:s=1,width:i=Ne.AUTO_SIZE,height:r=Ne.AUTO_SIZE,resolutionX:o=i,resolutionY:a=r}={}){super("LuminancePass"),this.fullscreenMaterial=new Jd(t,e),this.needsSwap=!1,this.renderTarget=n,this.renderTarget===void 0&&(this.renderTarget=new _t(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target");const c=this.resolution=new Ne(this,o,a,s);c.addEventListener("change",l=>this.setSize(c.baseWidth,c.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(n,e,t,s,i){const r=this.fullscreenMaterial;r.inputBuffer=e.texture,n.setRenderTarget(this.renderToScreen?null:this.renderTarget),n.render(this.scene,this.camera)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e),this.renderTarget.setSize(t.width,t.height)}initialize(n,e,t){t!==void 0&&t!==as&&(this.renderTarget.texture.type=t,this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},_f=class extends et{constructor(n,e){super("MaskPass",n,e),this.needsSwap=!1,this.clearPass=new Oa(!1,!1,!0),this.inverse=!1}set mainScene(n){this.scene=n}set mainCamera(n){this.camera=n}get inverted(){return this.inverse}set inverted(n){this.inverse=n}get clear(){return this.clearPass.enabled}set clear(n){this.clearPass.enabled=n}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(n){this.inverted=n}render(n,e,t,s,i){const r=n.getContext(),o=n.state.buffers,a=this.scene,c=this.camera,l=this.clearPass,u=this.inverted?0:1,h=1-u;o.color.setMask(!1),o.depth.setMask(!1),o.color.setLocked(!0),o.depth.setLocked(!0),o.stencil.setTest(!0),o.stencil.setOp(r.REPLACE,r.REPLACE,r.REPLACE),o.stencil.setFunc(r.ALWAYS,u,4294967295),o.stencil.setClear(h),o.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?l.render(n,null):(l.render(n,e),l.render(n,t))),this.renderToScreen?(n.setRenderTarget(null),n.render(a,c)):(n.setRenderTarget(e),n.render(a,c),n.setRenderTarget(t),n.render(a,c)),o.color.setLocked(!1),o.depth.setLocked(!1),o.stencil.setLocked(!1),o.stencil.setFunc(r.EQUAL,1,4294967295),o.stencil.setOp(r.KEEP,r.KEEP,r.KEEP),o.stencil.setLocked(!0)}},gf=class extends et{constructor(){super("MipmapBlurPass"),this.needsSwap=!1,this.renderTarget=new _t(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Upsampling.Mipmap0",this.downsamplingMipmaps=[],this.upsamplingMipmaps=[],this.downsamplingMaterial=new Zd,this.upsamplingMaterial=new of,this.resolution=new Re}get texture(){return this.renderTarget.texture}get levels(){return this.downsamplingMipmaps.length}set levels(n){if(this.levels!==n){const e=this.renderTarget;this.dispose(),this.downsamplingMipmaps=[],this.upsamplingMipmaps=[];for(let t=0;t<n;++t){const s=e.clone();s.texture.name="Downsampling.Mipmap"+t,this.downsamplingMipmaps.push(s)}this.upsamplingMipmaps.push(e);for(let t=1,s=n-1;t<s;++t){const i=e.clone();i.texture.name="Upsampling.Mipmap"+t,this.upsamplingMipmaps.push(i)}this.setSize(this.resolution.x,this.resolution.y)}}get radius(){return this.upsamplingMaterial.radius}set radius(n){this.upsamplingMaterial.radius=n}render(n,e,t,s,i){const{scene:r,camera:o}=this,{downsamplingMaterial:a,upsamplingMaterial:c}=this,{downsamplingMipmaps:l,upsamplingMipmaps:u}=this;let h=e;this.fullscreenMaterial=a;for(let d=0,f=l.length;d<f;++d){const m=l[d];a.setSize(h.width,h.height),a.inputBuffer=h.texture,n.setRenderTarget(m),n.render(r,o),h=m}this.fullscreenMaterial=c;for(let d=u.length-1;d>=0;--d){const f=u[d];c.setSize(h.width,h.height),c.inputBuffer=h.texture,c.supportBuffer=l[d].texture,n.setRenderTarget(f),n.render(r,o),h=f}}setSize(n,e){const t=this.resolution;t.set(n,e);let s=t.width,i=t.height;for(let r=0,o=this.downsamplingMipmaps.length;r<o;++r)s=Math.round(s*.5),i=Math.round(i*.5),this.downsamplingMipmaps[r].setSize(s,i),r<this.upsamplingMipmaps.length&&this.upsamplingMipmaps[r].setSize(s,i)}initialize(n,e,t){if(t!==void 0){const s=this.downsamplingMipmaps.concat(this.upsamplingMipmaps);for(const i of s)i.texture.type=t;if(t!==as)this.downsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.upsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1";else if(Fn(n)===Ve)for(const i of s)Os(i.texture,Ve)}}dispose(){super.dispose();for(const n of this.downsamplingMipmaps.concat(this.upsamplingMipmaps))n.dispose()}},vf=class extends et{constructor(n,e,{renderTarget:t,resolutionScale:s=1,width:i=Ne.AUTO_SIZE,height:r=Ne.AUTO_SIZE,resolutionX:o=i,resolutionY:a=r}={}){super("NormalPass"),this.needsSwap=!1,this.renderPass=new ro(n,e,new td);const c=this.renderPass;c.ignoreBackground=!0,c.skipShadowMapUpdate=!0;const l=c.getClearPass();l.overrideClearColor=new Ss(7829503),l.overrideClearAlpha=1,this.renderTarget=t,this.renderTarget===void 0&&(this.renderTarget=new _t(1,1,{minFilter:In,magFilter:In}),this.renderTarget.texture.name="NormalPass.Target");const u=this.resolution=new Ne(this,o,a,s);u.addEventListener("change",h=>this.setSize(u.baseWidth,u.baseHeight))}set mainScene(n){this.renderPass.mainScene=n}set mainCamera(n){this.renderPass.mainCamera=n}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}render(n,e,t,s,i){const r=this.renderToScreen?null:this.renderTarget;this.renderPass.render(n,r,r)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e),this.renderTarget.setSize(t.width,t.height)}},yf=class extends et{constructor(n,e="inputBuffer"){super("ShaderPass"),this.fullscreenMaterial=n,this.input=e}setInput(n){this.input=n}render(n,e,t,s,i){const r=this.fullscreenMaterial.uniforms;e!==null&&r!==void 0&&r[this.input]!==void 0&&(r[this.input].value=e.texture),n.setRenderTarget(this.renderToScreen?null:t),n.render(this.scene,this.camera)}initialize(n,e,t){t!==void 0&&t!==as&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},Po=1/1e3,Tf=1e3,xf=class{constructor(){this.startTime=performance.now(),this.previousTime=0,this.currentTime=0,this._delta=0,this._elapsed=0,this._fixedDelta=1e3/60,this.timescale=1,this.useFixedDelta=!1,this._autoReset=!1}get autoReset(){return this._autoReset}set autoReset(n){typeof document<"u"&&document.hidden!==void 0&&(n?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this._autoReset=n)}get delta(){return this._delta*Po}get fixedDelta(){return this._fixedDelta*Po}set fixedDelta(n){this._fixedDelta=n*Tf}get elapsed(){return this._elapsed*Po}update(n){this.useFixedDelta?this._delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=(n!==void 0?n:performance.now())-this.startTime,this._delta=this.currentTime-this.previousTime),this._delta*=this.timescale,this._elapsed+=this._delta}reset(){this._delta=0,this._elapsed=0,this.currentTime=performance.now()-this.startTime}handleEvent(n){document.hidden||(this.currentTime=performance.now()-this.startTime)}dispose(){this.autoReset=!1}},wf=class{constructor(e=null,{depthBuffer:t=!0,stencilBuffer:s=!1,multisampling:i=0,frameBufferType:r}={}){this.renderer=null,this.inputBuffer=this.createBuffer(t,s,r,i),this.outputBuffer=this.inputBuffer.clone(),this.copyPass=new lf,this.depthTexture=null,this.passes=[],this.timer=new xf,this.autoRenderToScreen=!0,this.setRenderer(e)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(e){const t=this.inputBuffer,s=this.multisampling;s>0&&e>0?(this.inputBuffer.samples=e,this.outputBuffer.samples=e,this.inputBuffer.dispose(),this.outputBuffer.dispose()):s!==e&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),this.inputBuffer=this.createBuffer(t.depthBuffer,t.stencilBuffer,t.texture.type,e),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(e){if(this.renderer=e,e!==null){const t=e.getSize(new Re),s=e.getContext().getContextAttributes().alpha,i=this.inputBuffer.texture.type;i===as&&Fn(e)===Ve&&(Os(this.inputBuffer.texture,Ve),Os(this.outputBuffer.texture,Ve),this.inputBuffer.dispose(),this.outputBuffer.dispose()),e.autoClear=!1,this.setSize(t.width,t.height);for(const r of this.passes)r.initialize(e,s,i)}}replaceRenderer(e,t=!0){const s=this.renderer,i=s.domElement.parentNode;return this.setRenderer(e),t&&i!==null&&(i.removeChild(s.domElement),i.appendChild(e.domElement)),s}createDepthTexture(){const e=this.depthTexture=new sd;return this.inputBuffer.depthTexture=e,this.inputBuffer.dispose(),this.inputBuffer.stencilBuffer?(e.format=nd,e.type=id):e.type=rd,e}deleteDepthTexture(){if(this.depthTexture!==null){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(const e of this.passes)e.setDepthTexture(null)}}createBuffer(e,t,s,i){const r=this.renderer,o=r===null?new Re:r.getDrawingBufferSize(new Re),a={minFilter:Ar,magFilter:Ar,stencilBuffer:t,depthBuffer:e,type:s},c=new _t(o.width,o.height,a);return i>0&&(c.ignoreDepthForMultisampleCopy=!1,c.samples=i),s===as&&Fn(r)===Ve&&Os(c.texture,Ve),c.texture.name="EffectComposer.Buffer",c.texture.generateMipmaps=!1,c}setMainScene(e){for(const t of this.passes)t.mainScene=e}setMainCamera(e){for(const t of this.passes)t.mainCamera=e}addPass(e,t){const s=this.passes,i=this.renderer,r=i.getDrawingBufferSize(new Re),o=i.getContext().getContextAttributes().alpha,a=this.inputBuffer.texture.type;if(e.setRenderer(i),e.setSize(r.width,r.height),e.initialize(i,o,a),this.autoRenderToScreen&&(s.length>0&&(s[s.length-1].renderToScreen=!1),e.renderToScreen&&(this.autoRenderToScreen=!1)),t!==void 0?s.splice(t,0,e):s.push(e),this.autoRenderToScreen&&(s[s.length-1].renderToScreen=!0),e.needsDepthTexture||this.depthTexture!==null)if(this.depthTexture===null){const c=this.createDepthTexture();for(e of s)e.setDepthTexture(c)}else e.setDepthTexture(this.depthTexture)}removePass(e){const t=this.passes,s=t.indexOf(e);if(s!==-1&&t.splice(s,1).length>0){if(this.depthTexture!==null){const o=(c,l)=>c||l.needsDepthTexture;t.reduce(o,!1)||(e.getDepthTexture()===this.depthTexture&&e.setDepthTexture(null),this.deleteDepthTexture())}this.autoRenderToScreen&&s===t.length&&(e.renderToScreen=!1,t.length>0&&(t[t.length-1].renderToScreen=!0))}}removeAllPasses(){const e=this.passes;this.deleteDepthTexture(),e.length>0&&(this.autoRenderToScreen&&(e[e.length-1].renderToScreen=!1),this.passes=[])}render(e){const t=this.renderer,s=this.copyPass;let i=this.inputBuffer,r=this.outputBuffer,o=!1,a,c,l;e===void 0&&(this.timer.update(),e=this.timer.delta);for(const u of this.passes)u.enabled&&(u.render(t,i,r,e,o),u.needsSwap&&(o&&(s.renderToScreen=u.renderToScreen,a=t.getContext(),c=t.state.buffers.stencil,c.setFunc(a.NOTEQUAL,1,4294967295),s.render(t,i,r,e,o),c.setFunc(a.EQUAL,1,4294967295)),l=i,i=r,r=l),u instanceof _f?o=!0:u instanceof uf&&(o=!1))}setSize(e,t,s){const i=this.renderer,r=i.getSize(new Re);(e===void 0||t===void 0)&&(e=r.width,t=r.height),(r.width!==e||r.height!==t)&&i.setSize(e,t,s);const o=i.getDrawingBufferSize(new Re);this.inputBuffer.setSize(o.width,o.height),this.outputBuffer.setSize(o.width,o.height);for(const a of this.passes)a.setSize(o.width,o.height)}reset(){const e=this.timer.autoReset;this.dispose(),this.autoRenderToScreen=!0,this.timer.autoReset=e}dispose(){for(const e of this.passes)e.dispose();this.passes=[],this.inputBuffer!==null&&this.inputBuffer.dispose(),this.outputBuffer!==null&&this.outputBuffer.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose()}},Sf=class{constructor(){this.shaderParts=new Map([[se.FRAGMENT_HEAD,null],[se.FRAGMENT_MAIN_UV,null],[se.FRAGMENT_MAIN_IMAGE,null],[se.VERTEX_HEAD,null],[se.VERTEX_MAIN_SUPPORT,null]]),this.defines=new Map,this.uniforms=new Map,this.blendModes=new Map,this.extensions=new Set,this.attributes=rs.NONE,this.varyings=new Set,this.uvTransformation=!1,this.readDepth=!1,this.colorSpace=no}},No=!1,Ic=class{constructor(n=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(n),this.meshCount=0,this.replaceMaterial=e=>{if(e.isMesh){let t;if(e.material.flatShading)switch(e.material.side){case lr:t=this.materialsFlatShadedDoubleSide;break;case cr:t=this.materialsFlatShadedBackSide;break;default:t=this.materialsFlatShaded;break}else switch(e.material.side){case lr:t=this.materialsDoubleSide;break;case cr:t=this.materialsBackSide;break;default:t=this.materials;break}this.originalMaterials.set(e,e.material),e.isSkinnedMesh?e.material=t[2]:e.isInstancedMesh?e.material=t[1]:e.material=t[0],++this.meshCount}}}cloneMaterial(n){if(!(n instanceof Yt))return n.clone();const e=n.uniforms,t=new Map;for(const i in e){const r=e[i].value;r.isRenderTargetTexture&&(e[i].value=null,t.set(i,r))}const s=n.clone();for(const i of t)e[i[0]].value=i[1],s.uniforms[i[0]].value=i[1];return s}setMaterial(n){if(this.disposeMaterials(),this.material=n,n!==null){const e=this.materials=[this.cloneMaterial(n),this.cloneMaterial(n),this.cloneMaterial(n)];for(const t of e)t.uniforms=Object.assign({},n.uniforms),t.side=od;e[2].skinning=!0,this.materialsBackSide=e.map(t=>{const s=this.cloneMaterial(t);return s.uniforms=Object.assign({},n.uniforms),s.side=cr,s}),this.materialsDoubleSide=e.map(t=>{const s=this.cloneMaterial(t);return s.uniforms=Object.assign({},n.uniforms),s.side=lr,s}),this.materialsFlatShaded=e.map(t=>{const s=this.cloneMaterial(t);return s.uniforms=Object.assign({},n.uniforms),s.flatShading=!0,s}),this.materialsFlatShadedBackSide=e.map(t=>{const s=this.cloneMaterial(t);return s.uniforms=Object.assign({},n.uniforms),s.flatShading=!0,s.side=cr,s}),this.materialsFlatShadedDoubleSide=e.map(t=>{const s=this.cloneMaterial(t);return s.uniforms=Object.assign({},n.uniforms),s.flatShading=!0,s.side=lr,s})}}render(n,e,t){const s=n.shadowMap.enabled;if(n.shadowMap.enabled=!1,No){const i=this.originalMaterials;this.meshCount=0,e.traverse(this.replaceMaterial),n.render(e,t);for(const r of i)r[0].material=r[1];this.meshCount!==i.size&&i.clear()}else{const i=e.overrideMaterial;e.overrideMaterial=this.material,n.render(e,t),e.overrideMaterial=i}n.shadowMap.enabled=s}disposeMaterials(){if(this.material!==null){const n=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(const e of n)e.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return No}static set workaroundEnabled(n){No=n}},ys=-1,Ne=class extends wa{constructor(n,e=ys,t=ys,s=1){super(),this.resizable=n,this.baseSize=new Re(1,1),this.preferredSize=new Re(e,t),this.target=this.preferredSize,this.s=s,this.effectiveSize=new Re,this.addEventListener("change",()=>this.updateEffectiveSize()),this.updateEffectiveSize()}updateEffectiveSize(){const n=this.baseSize,e=this.preferredSize,t=this.effectiveSize,s=this.scale;e.width!==ys?t.width=e.width:e.height!==ys?t.width=Math.round(e.height*(n.width/Math.max(n.height,1))):t.width=Math.round(n.width*s),e.height!==ys?t.height=e.height:e.width!==ys?t.height=Math.round(e.width/Math.max(n.width/Math.max(n.height,1),1)):t.height=Math.round(n.height*s)}get width(){return this.effectiveSize.width}set width(n){this.preferredWidth=n}get height(){return this.effectiveSize.height}set height(n){this.preferredHeight=n}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(n){this.s!==n&&(this.s=n,this.preferredSize.setScalar(ys),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getScale(){return this.scale}setScale(n){this.scale=n}get baseWidth(){return this.baseSize.width}set baseWidth(n){this.baseSize.width!==n&&(this.baseSize.width=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseWidth(){return this.baseWidth}setBaseWidth(n){this.baseWidth=n}get baseHeight(){return this.baseSize.height}set baseHeight(n){this.baseSize.height!==n&&(this.baseSize.height=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(n){this.baseHeight=n}setBaseSize(n,e){(this.baseSize.width!==n||this.baseSize.height!==e)&&(this.baseSize.set(n,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}get preferredWidth(){return this.preferredSize.width}set preferredWidth(n){this.preferredSize.width!==n&&(this.preferredSize.width=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(n){this.preferredWidth=n}get preferredHeight(){return this.preferredSize.height}set preferredHeight(n){this.preferredSize.height!==n&&(this.preferredSize.height=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(n){this.preferredHeight=n}setPreferredSize(n,e){(this.preferredSize.width!==n||this.preferredSize.height!==e)&&(this.preferredSize.set(n,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}copy(n){this.s=n.scale,this.baseSize.set(n.baseWidth,n.baseHeight),this.preferredSize.set(n.preferredWidth,n.preferredHeight),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height)}static get AUTO_SIZE(){return ys}},bf=class extends Set{constructor(n,e=10){super(),this.l=e,this.exclusive=!1,n!==void 0&&this.set(n)}get layer(){return this.l}set layer(n){const e=this.l;for(const t of this)t.layers.disable(e),t.layers.enable(n);this.l=n}getLayer(){return this.layer}setLayer(n){this.layer=n}isExclusive(){return this.exclusive}setExclusive(n){this.exclusive=n}clear(){const n=this.layer;for(const e of this)e.layers.disable(n);return super.clear()}set(n){this.clear();for(const e of n)this.add(e);return this}indexOf(n){return this.has(n)?0:-1}add(n){return this.exclusive?n.layers.set(this.layer):n.layers.enable(this.layer),super.add(n)}delete(n){return this.has(n)&&n.layers.disable(this.layer),super.delete(n)}toggle(n){let e;return this.has(n)?(this.delete(n),e=!1):(this.add(n),e=!0),e}setVisible(n){for(const e of this)n?e.layers.enable(0):e.layers.disable(0);return this}},Cf="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y,opacity);}",Ef="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,min(y.a,opacity));}",Of="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y)*0.5,opacity);}",Af="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.rg,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",Mf="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(step(0.0,y)*(1.0-min(vec4(1.0),(1.0-x)/y)),vec4(1.0),step(1.0,x));return mix(x,z,opacity);}",Df="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=step(0.0,x)*mix(min(vec4(1.0),x/max(1.0-y,1e-9)),vec4(1.0),step(1.0,y));return mix(x,z,opacity);}",kf="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x,y),opacity);}",Rf="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,abs(x-y),opacity);}",Pf="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x/max(y,1e-12),opacity);}",Nf="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y-2.0*x*y),opacity);}",If="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 a=min(x,1.0),b=min(y,1.0);vec4 z=mix(2.0*a*b,1.0-2.0*(1.0-a)*(1.0-b),step(0.5,y));return mix(x,z,opacity);}",Ff="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,step(1.0,x+y),opacity);}",Uf="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.r,xHSL.gb));return vec4(mix(x.rgb,z,opacity),y.a);}",Lf="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-y,opacity);}",Bf="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y*(1.0-x),opacity);}",zf="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x,y),opacity);}",Vf="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(y+x-1.0,0.0,1.0),opacity);}",Hf="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x+y,1.0),opacity);}",qf="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(2.0*y+x-1.0,0.0,1.0),opacity);}",Wf="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.rg,yHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",Gf="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x*y,opacity);}",jf="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-abs(1.0-x-y),opacity);}",Yf="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,opacity);}",Zf="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(2.0*y*x,1.0-2.0*(1.0-y)*(1.0-x),step(0.5,x));return mix(x,z,opacity);}",Xf="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 z=mix(mix(y2,x,step(0.5*x,y)),max(vec4(0.0),y2-1.0),step(x,(y2-1.0)));return mix(x,z,opacity);}",$f="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(min(x*x/max(1.0-y,1e-12),1.0),y,step(1.0,y));return mix(x,z,opacity);}",Qf="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.r,yHSL.g,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",Kf="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y-min(x*y,1.0),opacity);}",Jf="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 w=step(0.5,y);vec4 z=mix(x-(1.0-y2)*x*(1.0-x),mix(x+(y2-1.0)*(sqrt(x)-x),x+(y2-1.0)*x*((16.0*x-12.0)*x+3.0),w*(1.0-step(0.25,x))),w);return mix(x,z,opacity);}",ep="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y;}",tp="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x+y-1.0,0.0),opacity);}",sp="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(max(1.0-min((1.0-x)/(2.0*y),1.0),0.0),min(x/(2.0*(1.0-y)),1.0),step(0.5,y));return mix(x,z,opacity);}",np=new Map([[K.ADD,Cf],[K.ALPHA,Ef],[K.AVERAGE,Of],[K.COLOR,Af],[K.COLOR_BURN,Mf],[K.COLOR_DODGE,Df],[K.DARKEN,kf],[K.DIFFERENCE,Rf],[K.DIVIDE,Pf],[K.DST,null],[K.EXCLUSION,Nf],[K.HARD_LIGHT,If],[K.HARD_MIX,Ff],[K.HUE,Uf],[K.INVERT,Lf],[K.INVERT_RGB,Bf],[K.LIGHTEN,zf],[K.LINEAR_BURN,Vf],[K.LINEAR_DODGE,Hf],[K.LINEAR_LIGHT,qf],[K.LUMINOSITY,Wf],[K.MULTIPLY,Gf],[K.NEGATION,jf],[K.NORMAL,Yf],[K.OVERLAY,Zf],[K.PIN_LIGHT,Xf],[K.REFLECT,$f],[K.SATURATION,Qf],[K.SCREEN,Kf],[K.SOFT_LIGHT,Jf],[K.SRC,ep],[K.SUBTRACT,tp],[K.VIVID_LIGHT,sp]]),ip=class extends wa{constructor(n,e=1){super(),this._blendFunction=n,this.opacity=new X(e)}getOpacity(){return this.opacity.value}setOpacity(n){this.opacity.value=n}get blendFunction(){return this._blendFunction}set blendFunction(n){this._blendFunction=n,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(n){this.blendFunction=n}getShaderCode(){return np.get(this.blendFunction)}},wi=class extends wa{constructor(e,t,{attributes:s=rs.NONE,blendFunction:i=K.NORMAL,defines:r=new Map,uniforms:o=new Map,extensions:a=null,vertexShader:c=null}={}){super(),this.name=e,this.renderer=null,this.attributes=s,this.fragmentShader=t,this.vertexShader=c,this.defines=r,this.uniforms=o,this.extensions=a,this.blendMode=new ip(i),this.blendMode.addEventListener("change",l=>this.setChanged()),this._inputColorSpace=no,this._outputColorSpace=Pl}get inputColorSpace(){return this._inputColorSpace}set inputColorSpace(e){this._inputColorSpace=e,this.setChanged()}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e,this.setChanged()}set mainScene(e){}set mainCamera(e){}getName(){return this.name}setRenderer(e){this.renderer=e}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(e){this.attributes=e,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(e){this.fragmentShader=e,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(e){this.vertexShader=e,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(e,t=Xn){}update(e,t,s){}setSize(e,t){}initialize(e,t,s){}dispose(){for(const e of Object.keys(this)){const t=this[e];(t instanceof _t||t instanceof Cl||t instanceof El||t instanceof et)&&this[e].dispose()}}},rp=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 texel=texture2D(map,uv);outputColor=vec4(texel.rgb*intensity,texel.a);}`,op=class extends wi{constructor({blendFunction:n=K.SCREEN,luminanceThreshold:e=.9,luminanceSmoothing:t=.025,mipmapBlur:s=!1,intensity:i=1,radius:r=.85,levels:o=8,kernelSize:a=io.LARGE,resolutionScale:c=.5,width:l=Ne.AUTO_SIZE,height:u=Ne.AUTO_SIZE,resolutionX:h=l,resolutionY:d=u}={}){super("BloomEffect",rp,{blendFunction:n,uniforms:new Map([["map",new X(null)],["intensity",new X(i)]])}),this.renderTarget=new _t(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Bloom.Target",this.blurPass=new Ll({kernelSize:a}),this.luminancePass=new mf({colorOutput:!0}),this.luminanceMaterial.threshold=e,this.luminanceMaterial.smoothing=t,this.mipmapBlurPass=new gf,this.mipmapBlurPass.enabled=s,this.mipmapBlurPass.radius=r,this.mipmapBlurPass.levels=o,this.uniforms.get("map").value=s?this.mipmapBlurPass.texture:this.renderTarget.texture;const f=this.resolution=new Ne(this,h,d,c);f.addEventListener("change",m=>this.setSize(f.baseWidth,f.baseHeight))}get texture(){return this.mipmapBlurPass.enabled?this.mipmapBlurPass.texture:this.renderTarget.texture}getTexture(){return this.texture}getResolution(){return this.resolution}getBlurPass(){return this.blurPass}getLuminancePass(){return this.luminancePass}get luminanceMaterial(){return this.luminancePass.fullscreenMaterial}getLuminanceMaterial(){return this.luminancePass.fullscreenMaterial}get width(){return this.resolution.width}set width(n){this.resolution.preferredWidth=n}get height(){return this.resolution.height}set height(n){this.resolution.preferredHeight=n}get dithering(){return this.blurPass.dithering}set dithering(n){this.blurPass.dithering=n}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(n){this.blurPass.kernelSize=n}get distinction(){return console.warn(this.name,"distinction was removed"),1}set distinction(n){console.warn(this.name,"distinction was removed")}get intensity(){return this.uniforms.get("intensity").value}set intensity(n){this.uniforms.get("intensity").value=n}getIntensity(){return this.intensity}setIntensity(n){this.intensity=n}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}update(n,e,t){const s=this.renderTarget,i=this.luminancePass;i.enabled?(i.render(n,e),this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(n,i.renderTarget):this.blurPass.render(n,i.renderTarget,s)):this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(n,e):this.blurPass.render(n,e,s)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e),this.renderTarget.setSize(t.width,t.height),this.blurPass.resolution.copy(t),this.luminancePass.setSize(n,e),this.mipmapBlurPass.setSize(n,e)}initialize(n,e,t){this.blurPass.initialize(n,e,t),this.luminancePass.initialize(n,e,t),this.mipmapBlurPass.initialize(n,e,t),t!==void 0&&(this.renderTarget.texture.type=t,Fn(n)===Ve&&Os(this.renderTarget.texture,Ve))}},ap=`uniform lowp sampler2D edgeTexture;uniform lowp sampler2D maskTexture;uniform vec3 visibleEdgeColor;uniform vec3 hiddenEdgeColor;uniform float pulse;uniform float edgeStrength;
#ifdef USE_PATTERN
uniform lowp sampler2D patternTexture;varying vec2 vUvPattern;
#endif
void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec2 edge=texture2D(edgeTexture,uv).rg;vec2 mask=texture2D(maskTexture,uv).rg;
#ifndef X_RAY
edge.y=0.0;
#endif
edge*=(edgeStrength*mask.x*pulse);vec3 color=edge.x*visibleEdgeColor+edge.y*hiddenEdgeColor;float visibilityFactor=0.0;
#ifdef USE_PATTERN
vec4 patternColor=texture2D(patternTexture,vUvPattern);
#ifdef X_RAY
float hiddenFactor=0.5;
#else
float hiddenFactor=0.0;
#endif
visibilityFactor=(1.0-mask.y>0.0)?1.0:hiddenFactor;visibilityFactor*=(1.0-mask.x)*patternColor.a;color+=visibilityFactor*patternColor.rgb;
#endif
float alpha=max(max(edge.x,edge.y),visibilityFactor);
#ifdef ALPHA
outputColor=vec4(color,alpha);
#else
outputColor=vec4(color,max(alpha,inputColor.a));
#endif
}`,cp="uniform float patternScale;varying vec2 vUvPattern;void mainSupport(const in vec2 uv){vUvPattern=uv*vec2(aspect,1.0)*patternScale;}",lp=class extends wi{constructor(n,e,{blendFunction:t=K.SCREEN,patternTexture:s=null,patternScale:i=1,edgeStrength:r=1,pulseSpeed:o=0,visibleEdgeColor:a=16777215,hiddenEdgeColor:c=2230538,kernelSize:l=io.VERY_SMALL,blur:u=!1,xRay:h=!0,multisampling:d=0,resolutionScale:f=.5,width:m=Ne.AUTO_SIZE,height:p=Ne.AUTO_SIZE,resolutionX:_=m,resolutionY:y=p}={}){super("OutlineEffect",ap,{uniforms:new Map([["maskTexture",new X(null)],["edgeTexture",new X(null)],["edgeStrength",new X(r)],["visibleEdgeColor",new X(new Ss(a))],["hiddenEdgeColor",new X(new Ss(c))],["pulse",new X(1)],["patternScale",new X(i)],["patternTexture",new X(null)]])}),this.blendMode.addEventListener("change",g=>{this.blendMode.blendFunction===K.ALPHA?this.defines.set("ALPHA","1"):this.defines.delete("ALPHA"),this.setChanged()}),this.blendMode.blendFunction=t,this.patternTexture=s,this.xRay=h,this.scene=n,this.camera=e,this.renderTargetMask=new _t(1,1),this.renderTargetMask.samples=d,this.renderTargetMask.texture.name="Outline.Mask",this.uniforms.get("maskTexture").value=this.renderTargetMask.texture,this.renderTargetOutline=new _t(1,1,{depthBuffer:!1}),this.renderTargetOutline.texture.name="Outline.Edges",this.uniforms.get("edgeTexture").value=this.renderTargetOutline.texture,this.clearPass=new Oa,this.clearPass.overrideClearColor=new Ss(0),this.clearPass.overrideClearAlpha=1,this.depthPass=new hf(n,e),this.maskPass=new ro(n,e,new Hd(this.depthPass.texture,e));const S=this.maskPass.clearPass;S.overrideClearColor=new Ss(16777215),S.overrideClearAlpha=1,this.blurPass=new Ll({resolutionScale:f,resolutionX:_,resolutionY:y,kernelSize:l}),this.blurPass.enabled=u;const b=this.blurPass.resolution;b.addEventListener("change",g=>this.setSize(b.baseWidth,b.baseHeight)),this.outlinePass=new yf(new sf);const v=this.outlinePass.fullscreenMaterial;v.inputBuffer=this.renderTargetMask.texture,this.time=0,this.forceUpdate=!0,this.selection=new bf,this.selection.layer=10,this.pulseSpeed=o}set mainScene(n){this.scene=n,this.depthPass.mainScene=n,this.maskPass.mainScene=n}set mainCamera(n){this.camera=n,this.depthPass.mainCamera=n,this.maskPass.mainCamera=n,this.maskPass.overrideMaterial.copyCameraSettings(n)}get resolution(){return this.blurPass.resolution}getResolution(){return this.blurPass.getResolution()}get multisampling(){return this.renderTargetMask.samples}set multisampling(n){this.renderTargetMask.samples=n,this.renderTargetMask.dispose()}get patternScale(){return this.uniforms.get("patternScale").value}set patternScale(n){this.uniforms.get("patternScale").value=n}get edgeStrength(){return this.uniforms.get("edgeStrength").value}set edgeStrength(n){this.uniforms.get("edgeStrength").value=n}get visibleEdgeColor(){return this.uniforms.get("visibleEdgeColor").value}set visibleEdgeColor(n){this.uniforms.get("visibleEdgeColor").value=n}get hiddenEdgeColor(){return this.uniforms.get("hiddenEdgeColor").value}set hiddenEdgeColor(n){this.uniforms.get("hiddenEdgeColor").value=n}getBlurPass(){return this.blurPass}getSelection(){return this.selection}getPulseSpeed(){return this.pulseSpeed}setPulseSpeed(n){this.pulseSpeed=n}get width(){return this.resolution.width}set width(n){this.resolution.preferredWidth=n}get height(){return this.resolution.height}set height(n){this.resolution.preferredHeight=n}get selectionLayer(){return this.selection.layer}set selectionLayer(n){this.selection.layer=n}get dithering(){return this.blurPass.dithering}set dithering(n){this.blurPass.dithering=n}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(n){this.blurPass.kernelSize=n}get blur(){return this.blurPass.enabled}set blur(n){this.blurPass.enabled=n}get xRay(){return this.defines.has("X_RAY")}set xRay(n){this.xRay!==n&&(n?this.defines.set("X_RAY","1"):this.defines.delete("X_RAY"),this.setChanged())}isXRayEnabled(){return this.xRay}setXRayEnabled(n){this.xRay=n}get patternTexture(){return this.uniforms.get("patternTexture").value}set patternTexture(n){n!==null?(n.wrapS=n.wrapT=ad,this.defines.set("USE_PATTERN","1"),this.setVertexShader(cp)):(this.defines.delete("USE_PATTERN"),this.setVertexShader(null)),this.uniforms.get("patternTexture").value=n,this.setChanged()}setPatternTexture(n){this.patternTexture=n}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}setSelection(n){return this.selection.set(n),this}clearSelection(){return this.selection.clear(),this}selectObject(n){return this.selection.add(n),this}deselectObject(n){return this.selection.delete(n),this}update(n,e,t){const s=this.scene,i=this.camera,r=this.selection,a=this.uniforms.get("pulse"),c=s.background,l=i.layers.mask;(this.forceUpdate||r.size>0)&&(s.background=null,a.value=1,this.pulseSpeed>0&&(a.value=Math.cos(this.time*this.pulseSpeed*10)*.375+.625),this.time+=t,r.setVisible(!1),this.depthPass.render(n),r.setVisible(!0),i.layers.set(r.layer),this.maskPass.render(n,this.renderTargetMask),i.layers.mask=l,s.background=c,this.outlinePass.render(n,null,this.renderTargetOutline),this.blurPass.enabled&&this.blurPass.render(n,this.renderTargetOutline,this.renderTargetOutline)),this.forceUpdate=r.size>0}setSize(n,e){this.blurPass.setSize(n,e),this.renderTargetMask.setSize(n,e);const t=this.resolution;t.setBaseSize(n,e);const s=t.width,i=t.height;this.depthPass.setSize(s,i),this.renderTargetOutline.setSize(s,i),this.outlinePass.fullscreenMaterial.setSize(s,i)}initialize(n,e,t){this.blurPass.initialize(n,e,as),t!==void 0&&(this.depthPass.initialize(n,e,t),this.maskPass.initialize(n,e,t),this.outlinePass.initialize(n,e,t))}},up=`uniform float offset;uniform float darkness;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){const vec2 center=vec2(0.5);vec3 color=inputColor.rgb;
#if VIGNETTE_TECHNIQUE == 0
float d=distance(uv,center);color*=smoothstep(0.8,offset*0.799,d*(darkness+offset));
#else
vec2 coord=(uv-center)*vec2(offset);color=mix(color,vec3(1.0-darkness),dot(coord,coord));
#endif
outputColor=vec4(color,inputColor.a);}`,hp=class extends wi{constructor({blendFunction:n,technique:e=gr.DEFAULT,eskil:t=!1,offset:s=.5,darkness:i=.5}={}){super("VignetteEffect",up,{blendFunction:n,defines:new Map([["VIGNETTE_TECHNIQUE",e.toFixed(0)]]),uniforms:new Map([["offset",new X(s)],["darkness",new X(i)]])})}get technique(){return Number(this.defines.get("VIGNETTE_TECHNIQUE"))}set technique(n){this.technique!==n&&(this.defines.set("VIGNETTE_TECHNIQUE",n.toFixed(0)),this.setChanged())}get eskil(){return this.technique===gr.ESKIL}set eskil(n){this.technique=n?gr.ESKIL:gr.DEFAULT}getTechnique(){return this.technique}setTechnique(n){this.technique=n}get offset(){return this.uniforms.get("offset").value}set offset(n){this.uniforms.get("offset").value=n}getOffset(){return this.offset}setOffset(n){this.offset=n}get darkness(){return this.uniforms.get("darkness").value}set darkness(n){this.uniforms.get("darkness").value=n}getDarkness(){return this.darkness}setDarkness(n){this.darkness=n}};const Bl=P.createContext(null),Fc=n=>(n.getAttributes()&rs.CONVOLUTION)===rs.CONVOLUTION,zT=Yo.memo(P.forwardRef(({children:n,camera:e,scene:t,resolutionScale:s,enabled:i=!0,renderPriority:r=1,autoClear:o=!0,depthBuffer:a,disableNormalPass:c,stencilBuffer:l,multisampling:u=8,frameBufferType:h=dd},d)=>{const{gl:f,scene:m,camera:p,size:_}=we(),y=t||m,S=e||p,[b,v,g]=P.useMemo(()=>{const C=bd(),E=new wf(f,{depthBuffer:a,stencilBuffer:l,multisampling:u>0&&C?u:0,frameBufferType:h});E.addPass(new ro(y,S));let O=null,A=null;return c||(A=new vf(y,S),A.enabled=!1,E.addPass(A),s!==void 0&&C&&(O=new df({normalBuffer:A.texture,resolutionScale:s}),O.enabled=!1,E.addPass(O))),[E,A,O]},[S,f,a,l,u,h,y,c,s]);P.useEffect(()=>b==null?void 0:b.setSize(_.width,_.height),[b,_]),Ca((C,E)=>{if(i){const O=f.autoClear;f.autoClear=o,l&&!o&&f.clearStencil(),b.render(E),f.autoClear=O}},i?r:0);const x=P.useRef(null),T=vd(x);P.useLayoutEffect(()=>{const C=[];if(x.current&&T.current&&b){const E=T.current.objects;for(let O=0;O<E.length;O++){const A=E[O];if(A instanceof wi){const D=[A];if(!Fc(A)){let I=null;for(;(I=E[O+1])instanceof wi&&!Fc(I);)D.push(I),O++}const R=new pf(S,...D);C.push(R)}else A instanceof et&&C.push(A)}for(const O of C)b==null||b.addPass(O);v&&(v.enabled=!0),g&&(g.enabled=!0)}return()=>{for(const E of C)b==null||b.removePass(E);v&&(v.enabled=!1),g&&(g.enabled=!1)}},[b,n,S,v,g,T]);const w=P.useMemo(()=>({composer:b,normalPass:v,downSamplingPass:g,resolutionScale:s,camera:S,scene:y}),[b,v,g,s,S,y]);return P.useImperativeHandle(d,()=>b,[b]),is.jsx(Bl.Provider,{value:w,children:is.jsx("group",{ref:x,children:n})})})),Uc=n=>typeof n=="object"&&n!=null&&"current"in n?n.current:n;let dp=0;const Lc=new WeakMap,zl=(n,e)=>Yo.forwardRef(function({blendFunction:s=e==null?void 0:e.blendFunction,opacity:i=e==null?void 0:e.opacity,...r},o){let a=Lc.get(n);if(!a){const u=`@react-three/postprocessing/${n.name}-${dp++}`;ba({[u]:n}),Lc.set(n,a=u)}const c=we(u=>u.camera),l=Yo.useMemo(()=>{var u,h;return[...(u=e==null?void 0:e.args)!=null?u:[],...(h=r.args)!=null?h:[{...e,...r}]]},[JSON.stringify(r)]);return is.jsx(a,{camera:c,"blendMode-blendFunction":s,"blendMode-opacity-value":i,...r,ref:o,args:l})}),VT=zl(op,{blendFunction:K.ADD}),HT=P.forwardRef(function({selection:e=[],selectionLayer:t=10,blendFunction:s,patternTexture:i,edgeStrength:r,pulseSpeed:o,visibleEdgeColor:a,hiddenEdgeColor:c,width:l,height:u,kernelSize:h,blur:d,xRay:f,...m},p){const _=we(g=>g.invalidate),{scene:y,camera:S}=P.useContext(Bl),b=P.useMemo(()=>new lp(y,S,{blendFunction:s,patternTexture:i,edgeStrength:r,pulseSpeed:o,visibleEdgeColor:a,hiddenEdgeColor:c,width:l,height:u,kernelSize:h,blur:d,xRay:f,...m}),[s,d,S,r,u,c,h,i,o,y,a,l,f]),v=P.useContext(Ea);return P.useEffect(()=>{if(!v&&e)return b.selection.set(Array.isArray(e)?e.map(Uc):[Uc(e)]),_(),()=>{b.selection.clear(),_()}},[b,e,v,_]),P.useEffect(()=>{b.selectionLayer=t,_()},[b,_,t]),P.useRef(),P.useEffect(()=>{var g;if(v&&v.enabled&&(g=v.selected)!=null&&g.length)return b.selection.set(v.selected),_(),()=>{b.selection.clear(),_()}},[v,b.selection,_]),P.useEffect(()=>()=>{b.dispose()},[b]),is.jsx("primitive",{ref:p,object:b})}),qT=zl(hp),fp={isUserDragging:!1,isUserScrolling:!1,userMovedCamera:!1,isUserScrollingOnHtmlPanel:!1},WT=fd(n=>({...fp,setIsUserDragging:e=>n({isUserDragging:e}),setIsUserScrolling:e=>n({isUserScrolling:e}),setUserMovedCamera:e=>n({userMovedCamera:e}),setIsUserScrollingOnHtmlPanel:e=>n({isUserScrollingOnHtmlPanel:e})}));function ts(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function Vl(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.__proto__=e}/*!
 * GSAP 3.12.4
 * https://gsap.com
 *
 * @license Copyright 2008-2023, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license or for
 * Club GSAP members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var pt={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},Un={duration:.5,overwrite:!1,delay:0},Aa,Ye,Ee,wt=1e8,he=1/wt,Xo=Math.PI*2,pp=Xo/4,mp=0,Hl=Math.sqrt,_p=Math.cos,gp=Math.sin,qe=function(e){return typeof e=="string"},Ae=function(e){return typeof e=="function"},cs=function(e){return typeof e=="number"},Ma=function(e){return typeof e>"u"},Gt=function(e){return typeof e=="object"},it=function(e){return e!==!1},Da=function(){return typeof window<"u"},vr=function(e){return Ae(e)||qe(e)},ql=typeof ArrayBuffer=="function"&&ArrayBuffer.isView||function(){},Ze=Array.isArray,$o=/(?:-?\.?\d|\.)+/gi,Wl=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,Cn=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,Io=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,Gl=/[+-]=-?[.\d]+/,jl=/[^,'"\[\]\s]+/gi,vp=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,Se,xt,Qo,ka,gt={},Mr={},Yl,Zl=function(e){return(Mr=nn(e,gt))&&lt},Ra=function(e,t){return console.warn("Invalid property",e,"set to",t,"Missing plugin? gsap.registerPlugin()")},Si=function(e,t){return!t&&console.warn(e)},Xl=function(e,t){return e&&(gt[e]=t)&&Mr&&(Mr[e]=t)||gt},bi=function(){return 0},yp={suppressEvents:!0,isStart:!0,kill:!1},Sr={suppressEvents:!0,kill:!1},Tp={suppressEvents:!0},Pa={},As=[],Ko={},$l,ht={},Fo={},Bc=30,br=[],Na="",Ia=function(e){var t=e[0],s,i;if(Gt(t)||Ae(t)||(e=[e]),!(s=(t._gsap||{}).harness)){for(i=br.length;i--&&!br[i].targetTest(t););s=br[i]}for(i=e.length;i--;)e[i]&&(e[i]._gsap||(e[i]._gsap=new Tu(e[i],s)))||e.splice(i,1);return e},Qs=function(e){return e._gsap||Ia(St(e))[0]._gsap},Ql=function(e,t,s){return(s=e[t])&&Ae(s)?e[t]():Ma(s)&&e.getAttribute&&e.getAttribute(t)||s},rt=function(e,t){return(e=e.split(",")).forEach(t)||e},De=function(e){return Math.round(e*1e5)/1e5||0},ze=function(e){return Math.round(e*1e7)/1e7||0},Dn=function(e,t){var s=t.charAt(0),i=parseFloat(t.substr(2));return e=parseFloat(e),s==="+"?e+i:s==="-"?e-i:s==="*"?e*i:e/i},xp=function(e,t){for(var s=t.length,i=0;e.indexOf(t[i])<0&&++i<s;);return i<s},Dr=function(){var e=As.length,t=As.slice(0),s,i;for(Ko={},As.length=0,s=0;s<e;s++)i=t[s],i&&i._lazy&&(i.render(i._lazy[0],i._lazy[1],!0)._lazy=0)},Kl=function(e,t,s,i){As.length&&!Ye&&Dr(),e.render(t,s,i||Ye&&t<0&&(e._initted||e._startAt)),As.length&&!Ye&&Dr()},Jl=function(e){var t=parseFloat(e);return(t||t===0)&&(e+"").match(jl).length<2?t:qe(e)?e.trim():e},eu=function(e){return e},Et=function(e,t){for(var s in t)s in e||(e[s]=t[s]);return e},wp=function(e){return function(t,s){for(var i in s)i in t||i==="duration"&&e||i==="ease"||(t[i]=s[i])}},nn=function(e,t){for(var s in t)e[s]=t[s];return e},zc=function n(e,t){for(var s in t)s!=="__proto__"&&s!=="constructor"&&s!=="prototype"&&(e[s]=Gt(t[s])?n(e[s]||(e[s]={}),t[s]):t[s]);return e},kr=function(e,t){var s={},i;for(i in e)i in t||(s[i]=e[i]);return s},vi=function(e){var t=e.parent||Se,s=e.keyframes?wp(Ze(e.keyframes)):Et;if(it(e.inherit))for(;t;)s(e,t.vars.defaults),t=t.parent||t._dp;return e},Sp=function(e,t){for(var s=e.length,i=s===t.length;i&&s--&&e[s]===t[s];);return s<0},tu=function(e,t,s,i,r){s===void 0&&(s="_first"),i===void 0&&(i="_last");var o=e[i],a;if(r)for(a=t[r];o&&o[r]>a;)o=o._prev;return o?(t._next=o._next,o._next=t):(t._next=e[s],e[s]=t),t._next?t._next._prev=t:e[i]=t,t._prev=o,t.parent=t._dp=e,t},oo=function(e,t,s,i){s===void 0&&(s="_first"),i===void 0&&(i="_last");var r=t._prev,o=t._next;r?r._next=o:e[s]===t&&(e[s]=o),o?o._prev=r:e[i]===t&&(e[i]=r),t._next=t._prev=t.parent=null},ks=function(e,t){e.parent&&(!t||e.parent.autoRemoveChildren)&&e.parent.remove&&e.parent.remove(e),e._act=0},Ks=function(e,t){if(e&&(!t||t._end>e._dur||t._start<0))for(var s=e;s;)s._dirty=1,s=s.parent;return e},bp=function(e){for(var t=e.parent;t&&t.parent;)t._dirty=1,t.totalDuration(),t=t.parent;return e},Jo=function(e,t,s,i){return e._startAt&&(Ye?e._startAt.revert(Sr):e.vars.immediateRender&&!e.vars.autoRevert||e._startAt.render(t,!0,i))},Cp=function n(e){return!e||e._ts&&n(e.parent)},Vc=function(e){return e._repeat?Ln(e._tTime,e=e.duration()+e._rDelay)*e:0},Ln=function(e,t){var s=Math.floor(e/=t);return e&&s===e?s-1:s},Rr=function(e,t){return(e-t._start)*t._ts+(t._ts>=0?0:t._dirty?t.totalDuration():t._tDur)},ao=function(e){return e._end=ze(e._start+(e._tDur/Math.abs(e._ts||e._rts||he)||0))},co=function(e,t){var s=e._dp;return s&&s.smoothChildTiming&&e._ts&&(e._start=ze(s._time-(e._ts>0?t/e._ts:((e._dirty?e.totalDuration():e._tDur)-t)/-e._ts)),ao(e),s._dirty||Ks(s,e)),e},su=function(e,t){var s;if((t._time||!t._dur&&t._initted||t._start<e._time&&(t._dur||!t.add))&&(s=Rr(e.rawTime(),t),(!t._dur||$i(0,t.totalDuration(),s)-t._tTime>he)&&t.render(s,!0)),Ks(e,t)._dp&&e._initted&&e._time>=e._dur&&e._ts){if(e._dur<e.duration())for(s=e;s._dp;)s.rawTime()>=0&&s.totalTime(s._tTime),s=s._dp;e._zTime=-he}},Ht=function(e,t,s,i){return t.parent&&ks(t),t._start=ze((cs(s)?s:s||e!==Se?Tt(e,s,t):e._time)+t._delay),t._end=ze(t._start+(t.totalDuration()/Math.abs(t.timeScale())||0)),tu(e,t,"_first","_last",e._sort?"_start":0),ea(t)||(e._recent=t),i||su(e,t),e._ts<0&&co(e,e._tTime),e},nu=function(e,t){return(gt.ScrollTrigger||Ra("scrollTrigger",t))&&gt.ScrollTrigger.create(t,e)},iu=function(e,t,s,i,r){if(Ua(e,t,r),!e._initted)return 1;if(!s&&e._pt&&!Ye&&(e._dur&&e.vars.lazy!==!1||!e._dur&&e.vars.lazy)&&$l!==dt.frame)return As.push(e),e._lazy=[r,i],1},Ep=function n(e){var t=e.parent;return t&&t._ts&&t._initted&&!t._lock&&(t.rawTime()<0||n(t))},ea=function(e){var t=e.data;return t==="isFromStart"||t==="isStart"},Op=function(e,t,s,i){var r=e.ratio,o=t<0||!t&&(!e._start&&Ep(e)&&!(!e._initted&&ea(e))||(e._ts<0||e._dp._ts<0)&&!ea(e))?0:1,a=e._rDelay,c=0,l,u,h;if(a&&e._repeat&&(c=$i(0,e._tDur,t),u=Ln(c,a),e._yoyo&&u&1&&(o=1-o),u!==Ln(e._tTime,a)&&(r=1-o,e.vars.repeatRefresh&&e._initted&&e.invalidate())),o!==r||Ye||i||e._zTime===he||!t&&e._zTime){if(!e._initted&&iu(e,t,i,s,c))return;for(h=e._zTime,e._zTime=t||(s?he:0),s||(s=t&&!h),e.ratio=o,e._from&&(o=1-o),e._time=0,e._tTime=c,l=e._pt;l;)l.r(o,l.d),l=l._next;t<0&&Jo(e,t,s,!0),e._onUpdate&&!s&&ft(e,"onUpdate"),c&&e._repeat&&!s&&e.parent&&ft(e,"onRepeat"),(t>=e._tDur||t<0)&&e.ratio===o&&(o&&ks(e,1),!s&&!Ye&&(ft(e,o?"onComplete":"onReverseComplete",!0),e._prom&&e._prom()))}else e._zTime||(e._zTime=t)},Ap=function(e,t,s){var i;if(s>t)for(i=e._first;i&&i._start<=s;){if(i.data==="isPause"&&i._start>t)return i;i=i._next}else for(i=e._last;i&&i._start>=s;){if(i.data==="isPause"&&i._start<t)return i;i=i._prev}},Bn=function(e,t,s,i){var r=e._repeat,o=ze(t)||0,a=e._tTime/e._tDur;return a&&!i&&(e._time*=o/e._dur),e._dur=o,e._tDur=r?r<0?1e10:ze(o*(r+1)+e._rDelay*r):o,a>0&&!i&&co(e,e._tTime=e._tDur*a),e.parent&&ao(e),s||Ks(e.parent,e),e},Hc=function(e){return e instanceof Ke?Ks(e):Bn(e,e._dur)},Mp={_start:0,endTime:bi,totalDuration:bi},Tt=function n(e,t,s){var i=e.labels,r=e._recent||Mp,o=e.duration()>=wt?r.endTime(!1):e._dur,a,c,l;return qe(t)&&(isNaN(t)||t in i)?(c=t.charAt(0),l=t.substr(-1)==="%",a=t.indexOf("="),c==="<"||c===">"?(a>=0&&(t=t.replace(/=/,"")),(c==="<"?r._start:r.endTime(r._repeat>=0))+(parseFloat(t.substr(1))||0)*(l?(a<0?r:s).totalDuration()/100:1)):a<0?(t in i||(i[t]=o),i[t]):(c=parseFloat(t.charAt(a-1)+t.substr(a+1)),l&&s&&(c=c/100*(Ze(s)?s[0]:s).totalDuration()),a>1?n(e,t.substr(0,a-1),s)+c:o+c)):t==null?o:+t},yi=function(e,t,s){var i=cs(t[1]),r=(i?2:1)+(e<2?0:1),o=t[r],a,c;if(i&&(o.duration=t[1]),o.parent=s,e){for(a=o,c=s;c&&!("immediateRender"in a);)a=c.vars.defaults||{},c=it(c.vars.inherit)&&c.parent;o.immediateRender=it(a.immediateRender),e<2?o.runBackwards=1:o.startAt=t[r-1]}return new Fe(t[0],o,t[r+1])},Ls=function(e,t){return e||e===0?t(e):t},$i=function(e,t,s){return s<e?e:s>t?t:s},je=function(e,t){return!qe(e)||!(t=vp.exec(e))?"":t[1]},Dp=function(e,t,s){return Ls(s,function(i){return $i(e,t,i)})},ta=[].slice,ru=function(e,t){return e&&Gt(e)&&"length"in e&&(!t&&!e.length||e.length-1 in e&&Gt(e[0]))&&!e.nodeType&&e!==xt},kp=function(e,t,s){return s===void 0&&(s=[]),e.forEach(function(i){var r;return qe(i)&&!t||ru(i,1)?(r=s).push.apply(r,St(i)):s.push(i)})||s},St=function(e,t,s){return Ee&&!t&&Ee.selector?Ee.selector(e):qe(e)&&!s&&(Qo||!zn())?ta.call((t||ka).querySelectorAll(e),0):Ze(e)?kp(e,s):ru(e)?ta.call(e,0):e?[e]:[]},sa=function(e){return e=St(e)[0]||Si("Invalid scope")||{},function(t){var s=e.current||e.nativeElement||e;return St(t,s.querySelectorAll?s:s===e?Si("Invalid scope")||ka.createElement("div"):e)}},ou=function(e){return e.sort(function(){return .5-Math.random()})},au=function(e){if(Ae(e))return e;var t=Gt(e)?e:{each:e},s=Js(t.ease),i=t.from||0,r=parseFloat(t.base)||0,o={},a=i>0&&i<1,c=isNaN(i)||a,l=t.axis,u=i,h=i;return qe(i)?u=h={center:.5,edges:.5,end:1}[i]||0:!a&&c&&(u=i[0],h=i[1]),function(d,f,m){var p=(m||t).length,_=o[p],y,S,b,v,g,x,T,w,C;if(!_){if(C=t.grid==="auto"?0:(t.grid||[1,wt])[1],!C){for(T=-wt;T<(T=m[C++].getBoundingClientRect().left)&&C<p;);C<p&&C--}for(_=o[p]=[],y=c?Math.min(C,p)*u-.5:i%C,S=C===wt?0:c?p*h/C-.5:i/C|0,T=0,w=wt,x=0;x<p;x++)b=x%C-y,v=S-(x/C|0),_[x]=g=l?Math.abs(l==="y"?v:b):Hl(b*b+v*v),g>T&&(T=g),g<w&&(w=g);i==="random"&&ou(_),_.max=T-w,_.min=w,_.v=p=(parseFloat(t.amount)||parseFloat(t.each)*(C>p?p-1:l?l==="y"?p/C:C:Math.max(C,p/C))||0)*(i==="edges"?-1:1),_.b=p<0?r-p:r,_.u=je(t.amount||t.each)||0,s=s&&p<0?gu(s):s}return p=(_[d]-_.min)/_.max||0,ze(_.b+(s?s(p):p)*_.v)+_.u}},na=function(e){var t=Math.pow(10,((e+"").split(".")[1]||"").length);return function(s){var i=ze(Math.round(parseFloat(s)/e)*e*t);return(i-i%1)/t+(cs(s)?0:je(s))}},cu=function(e,t){var s=Ze(e),i,r;return!s&&Gt(e)&&(i=s=e.radius||wt,e.values?(e=St(e.values),(r=!cs(e[0]))&&(i*=i)):e=na(e.increment)),Ls(t,s?Ae(e)?function(o){return r=e(o),Math.abs(r-o)<=i?r:o}:function(o){for(var a=parseFloat(r?o.x:o),c=parseFloat(r?o.y:0),l=wt,u=0,h=e.length,d,f;h--;)r?(d=e[h].x-a,f=e[h].y-c,d=d*d+f*f):d=Math.abs(e[h]-a),d<l&&(l=d,u=h);return u=!i||l<=i?e[u]:o,r||u===o||cs(o)?u:u+je(o)}:na(e))},lu=function(e,t,s,i){return Ls(Ze(e)?!t:s===!0?!!(s=0):!i,function(){return Ze(e)?e[~~(Math.random()*e.length)]:(s=s||1e-5)&&(i=s<1?Math.pow(10,(s+"").length-2):1)&&Math.floor(Math.round((e-s/2+Math.random()*(t-e+s*.99))/s)*s*i)/i})},Rp=function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return function(i){return t.reduce(function(r,o){return o(r)},i)}},Pp=function(e,t){return function(s){return e(parseFloat(s))+(t||je(s))}},Np=function(e,t,s){return hu(e,t,0,1,s)},uu=function(e,t,s){return Ls(s,function(i){return e[~~t(i)]})},Ip=function n(e,t,s){var i=t-e;return Ze(e)?uu(e,n(0,e.length),t):Ls(s,function(r){return(i+(r-e)%i)%i+e})},Fp=function n(e,t,s){var i=t-e,r=i*2;return Ze(e)?uu(e,n(0,e.length-1),t):Ls(s,function(o){return o=(r+(o-e)%r)%r||0,e+(o>i?r-o:o)})},Ci=function(e){for(var t=0,s="",i,r,o,a;~(i=e.indexOf("random(",t));)o=e.indexOf(")",i),a=e.charAt(i+7)==="[",r=e.substr(i+7,o-i-7).match(a?jl:$o),s+=e.substr(t,i-t)+lu(a?r:+r[0],a?0:+r[1],+r[2]||1e-5),t=o+1;return s+e.substr(t,e.length-t)},hu=function(e,t,s,i,r){var o=t-e,a=i-s;return Ls(r,function(c){return s+((c-e)/o*a||0)})},Up=function n(e,t,s,i){var r=isNaN(e+t)?0:function(f){return(1-f)*e+f*t};if(!r){var o=qe(e),a={},c,l,u,h,d;if(s===!0&&(i=1)&&(s=null),o)e={p:e},t={p:t};else if(Ze(e)&&!Ze(t)){for(u=[],h=e.length,d=h-2,l=1;l<h;l++)u.push(n(e[l-1],e[l]));h--,r=function(m){m*=h;var p=Math.min(d,~~m);return u[p](m-p)},s=t}else i||(e=nn(Ze(e)?[]:{},e));if(!u){for(c in t)Fa.call(a,e,c,"get",t[c]);r=function(m){return za(m,a)||(o?e.p:e)}}}return Ls(s,r)},qc=function(e,t,s){var i=e.labels,r=wt,o,a,c;for(o in i)a=i[o]-t,a<0==!!s&&a&&r>(a=Math.abs(a))&&(c=o,r=a);return c},ft=function(e,t,s){var i=e.vars,r=i[t],o=Ee,a=e._ctx,c,l,u;if(r)return c=i[t+"Params"],l=i.callbackScope||e,s&&As.length&&Dr(),a&&(Ee=a),u=c?r.apply(l,c):r.call(l),Ee=o,u},_i=function(e){return ks(e),e.scrollTrigger&&e.scrollTrigger.kill(!!Ye),e.progress()<1&&ft(e,"onInterrupt"),e},En,du=[],fu=function(e){if(Da()&&e){e=!e.name&&e.default||e;var t=e.name,s=Ae(e),i=t&&!s&&e.init?function(){this._props=[]}:e,r={init:bi,render:za,add:Fa,kill:Jp,modifier:Kp,rawVars:0},o={targetTest:0,get:0,getSetter:Ba,aliases:{},register:0};if(zn(),e!==i){if(ht[t])return;Et(i,Et(kr(e,r),o)),nn(i.prototype,nn(r,kr(e,o))),ht[i.prop=t]=i,e.targetTest&&(br.push(i),Pa[t]=1),t=(t==="css"?"CSS":t.charAt(0).toUpperCase()+t.substr(1))+"Plugin"}Xl(t,i),e.register&&e.register(lt,i,ot)}else e&&du.push(e)},ue=255,gi={aqua:[0,ue,ue],lime:[0,ue,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,ue],navy:[0,0,128],white:[ue,ue,ue],olive:[128,128,0],yellow:[ue,ue,0],orange:[ue,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[ue,0,0],pink:[ue,192,203],cyan:[0,ue,ue],transparent:[ue,ue,ue,0]},Uo=function(e,t,s){return e+=e<0?1:e>1?-1:0,(e*6<1?t+(s-t)*e*6:e<.5?s:e*3<2?t+(s-t)*(2/3-e)*6:t)*ue+.5|0},pu=function(e,t,s){var i=e?cs(e)?[e>>16,e>>8&ue,e&ue]:0:gi.black,r,o,a,c,l,u,h,d,f,m;if(!i){if(e.substr(-1)===","&&(e=e.substr(0,e.length-1)),gi[e])i=gi[e];else if(e.charAt(0)==="#"){if(e.length<6&&(r=e.charAt(1),o=e.charAt(2),a=e.charAt(3),e="#"+r+r+o+o+a+a+(e.length===5?e.charAt(4)+e.charAt(4):"")),e.length===9)return i=parseInt(e.substr(1,6),16),[i>>16,i>>8&ue,i&ue,parseInt(e.substr(7),16)/255];e=parseInt(e.substr(1),16),i=[e>>16,e>>8&ue,e&ue]}else if(e.substr(0,3)==="hsl"){if(i=m=e.match($o),!t)c=+i[0]%360/360,l=+i[1]/100,u=+i[2]/100,o=u<=.5?u*(l+1):u+l-u*l,r=u*2-o,i.length>3&&(i[3]*=1),i[0]=Uo(c+1/3,r,o),i[1]=Uo(c,r,o),i[2]=Uo(c-1/3,r,o);else if(~e.indexOf("="))return i=e.match(Wl),s&&i.length<4&&(i[3]=1),i}else i=e.match($o)||gi.transparent;i=i.map(Number)}return t&&!m&&(r=i[0]/ue,o=i[1]/ue,a=i[2]/ue,h=Math.max(r,o,a),d=Math.min(r,o,a),u=(h+d)/2,h===d?c=l=0:(f=h-d,l=u>.5?f/(2-h-d):f/(h+d),c=h===r?(o-a)/f+(o<a?6:0):h===o?(a-r)/f+2:(r-o)/f+4,c*=60),i[0]=~~(c+.5),i[1]=~~(l*100+.5),i[2]=~~(u*100+.5)),s&&i.length<4&&(i[3]=1),i},mu=function(e){var t=[],s=[],i=-1;return e.split(Ms).forEach(function(r){var o=r.match(Cn)||[];t.push.apply(t,o),s.push(i+=o.length+1)}),t.c=s,t},Wc=function(e,t,s){var i="",r=(e+i).match(Ms),o=t?"hsla(":"rgba(",a=0,c,l,u,h;if(!r)return e;if(r=r.map(function(d){return(d=pu(d,t,1))&&o+(t?d[0]+","+d[1]+"%,"+d[2]+"%,"+d[3]:d.join(","))+")"}),s&&(u=mu(e),c=s.c,c.join(i)!==u.c.join(i)))for(l=e.replace(Ms,"1").split(Cn),h=l.length-1;a<h;a++)i+=l[a]+(~c.indexOf(a)?r.shift()||o+"0,0,0,0)":(u.length?u:r.length?r:s).shift());if(!l)for(l=e.split(Ms),h=l.length-1;a<h;a++)i+=l[a]+r[a];return i+l[h]},Ms=function(){var n="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b",e;for(e in gi)n+="|"+e+"\\b";return new RegExp(n+")","gi")}(),Lp=/hsl[a]?\(/,_u=function(e){var t=e.join(" "),s;if(Ms.lastIndex=0,Ms.test(t))return s=Lp.test(t),e[1]=Wc(e[1],s),e[0]=Wc(e[0],s,mu(e[1])),!0},Ei,dt=function(){var n=Date.now,e=500,t=33,s=n(),i=s,r=1e3/240,o=r,a=[],c,l,u,h,d,f,m=function p(_){var y=n()-i,S=_===!0,b,v,g,x;if(y>e&&(s+=y-t),i+=y,g=i-s,b=g-o,(b>0||S)&&(x=++h.frame,d=g-h.time*1e3,h.time=g=g/1e3,o+=b+(b>=r?4:r-b),v=1),S||(c=l(p)),v)for(f=0;f<a.length;f++)a[f](g,d,x,_)};return h={time:0,frame:0,tick:function(){m(!0)},deltaRatio:function(_){return d/(1e3/(_||60))},wake:function(){Yl&&(!Qo&&Da()&&(xt=Qo=window,ka=xt.document||{},gt.gsap=lt,(xt.gsapVersions||(xt.gsapVersions=[])).push(lt.version),Zl(Mr||xt.GreenSockGlobals||!xt.gsap&&xt||{}),u=xt.requestAnimationFrame,du.forEach(fu)),c&&h.sleep(),l=u||function(_){return setTimeout(_,o-h.time*1e3+1|0)},Ei=1,m(2))},sleep:function(){(u?xt.cancelAnimationFrame:clearTimeout)(c),Ei=0,l=bi},lagSmoothing:function(_,y){e=_||1/0,t=Math.min(y||33,e)},fps:function(_){r=1e3/(_||240),o=h.time*1e3+r},add:function(_,y,S){var b=y?function(v,g,x,T){_(v,g,x,T),h.remove(b)}:_;return h.remove(_),a[S?"unshift":"push"](b),zn(),b},remove:function(_,y){~(y=a.indexOf(_))&&a.splice(y,1)&&f>=y&&f--},_listeners:a},h}(),zn=function(){return!Ei&&dt.wake()},ee={},Bp=/^[\d.\-M][\d.\-,\s]/,zp=/["']/g,Vp=function(e){for(var t={},s=e.substr(1,e.length-3).split(":"),i=s[0],r=1,o=s.length,a,c,l;r<o;r++)c=s[r],a=r!==o-1?c.lastIndexOf(","):c.length,l=c.substr(0,a),t[i]=isNaN(l)?l.replace(zp,"").trim():+l,i=c.substr(a+1).trim();return t},Hp=function(e){var t=e.indexOf("(")+1,s=e.indexOf(")"),i=e.indexOf("(",t);return e.substring(t,~i&&i<s?e.indexOf(")",s+1):s)},qp=function(e){var t=(e+"").split("("),s=ee[t[0]];return s&&t.length>1&&s.config?s.config.apply(null,~e.indexOf("{")?[Vp(t[1])]:Hp(e).split(",").map(Jl)):ee._CE&&Bp.test(e)?ee._CE("",e):s},gu=function(e){return function(t){return 1-e(1-t)}},vu=function n(e,t){for(var s=e._first,i;s;)s instanceof Ke?n(s,t):s.vars.yoyoEase&&(!s._yoyo||!s._repeat)&&s._yoyo!==t&&(s.timeline?n(s.timeline,t):(i=s._ease,s._ease=s._yEase,s._yEase=i,s._yoyo=t)),s=s._next},Js=function(e,t){return e&&(Ae(e)?e:ee[e]||qp(e))||t},hn=function(e,t,s,i){s===void 0&&(s=function(c){return 1-t(1-c)}),i===void 0&&(i=function(c){return c<.5?t(c*2)/2:1-t((1-c)*2)/2});var r={easeIn:t,easeOut:s,easeInOut:i},o;return rt(e,function(a){ee[a]=gt[a]=r,ee[o=a.toLowerCase()]=s;for(var c in r)ee[o+(c==="easeIn"?".in":c==="easeOut"?".out":".inOut")]=ee[a+"."+c]=r[c]}),r},yu=function(e){return function(t){return t<.5?(1-e(1-t*2))/2:.5+e((t-.5)*2)/2}},Lo=function n(e,t,s){var i=t>=1?t:1,r=(s||(e?.3:.45))/(t<1?t:1),o=r/Xo*(Math.asin(1/i)||0),a=function(u){return u===1?1:i*Math.pow(2,-10*u)*gp((u-o)*r)+1},c=e==="out"?a:e==="in"?function(l){return 1-a(1-l)}:yu(a);return r=Xo/r,c.config=function(l,u){return n(e,l,u)},c},Bo=function n(e,t){t===void 0&&(t=1.70158);var s=function(o){return o?--o*o*((t+1)*o+t)+1:0},i=e==="out"?s:e==="in"?function(r){return 1-s(1-r)}:yu(s);return i.config=function(r){return n(e,r)},i};rt("Linear,Quad,Cubic,Quart,Quint,Strong",function(n,e){var t=e<5?e+1:e;hn(n+",Power"+(t-1),e?function(s){return Math.pow(s,t)}:function(s){return s},function(s){return 1-Math.pow(1-s,t)},function(s){return s<.5?Math.pow(s*2,t)/2:1-Math.pow((1-s)*2,t)/2})});ee.Linear.easeNone=ee.none=ee.Linear.easeIn;hn("Elastic",Lo("in"),Lo("out"),Lo());(function(n,e){var t=1/e,s=2*t,i=2.5*t,r=function(a){return a<t?n*a*a:a<s?n*Math.pow(a-1.5/e,2)+.75:a<i?n*(a-=2.25/e)*a+.9375:n*Math.pow(a-2.625/e,2)+.984375};hn("Bounce",function(o){return 1-r(1-o)},r)})(7.5625,2.75);hn("Expo",function(n){return n?Math.pow(2,10*(n-1)):0});hn("Circ",function(n){return-(Hl(1-n*n)-1)});hn("Sine",function(n){return n===1?1:-_p(n*pp)+1});hn("Back",Bo("in"),Bo("out"),Bo());ee.SteppedEase=ee.steps=gt.SteppedEase={config:function(e,t){e===void 0&&(e=1);var s=1/e,i=e+(t?0:1),r=t?1:0,o=1-he;return function(a){return((i*$i(0,o,a)|0)+r)*s}}};Un.ease=ee["quad.out"];rt("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function(n){return Na+=n+","+n+"Params,"});var Tu=function(e,t){this.id=mp++,e._gsap=this,this.target=e,this.harness=t,this.get=t?t.get:Ql,this.set=t?t.getSetter:Ba},Oi=function(){function n(t){this.vars=t,this._delay=+t.delay||0,(this._repeat=t.repeat===1/0?-2:t.repeat||0)&&(this._rDelay=t.repeatDelay||0,this._yoyo=!!t.yoyo||!!t.yoyoEase),this._ts=1,Bn(this,+t.duration,1,1),this.data=t.data,Ee&&(this._ctx=Ee,Ee.data.push(this)),Ei||dt.wake()}var e=n.prototype;return e.delay=function(s){return s||s===0?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+s-this._delay),this._delay=s,this):this._delay},e.duration=function(s){return arguments.length?this.totalDuration(this._repeat>0?s+(s+this._rDelay)*this._repeat:s):this.totalDuration()&&this._dur},e.totalDuration=function(s){return arguments.length?(this._dirty=0,Bn(this,this._repeat<0?s:(s-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},e.totalTime=function(s,i){if(zn(),!arguments.length)return this._tTime;var r=this._dp;if(r&&r.smoothChildTiming&&this._ts){for(co(this,s),!r._dp||r.parent||su(r,this);r&&r.parent;)r.parent._time!==r._start+(r._ts>=0?r._tTime/r._ts:(r.totalDuration()-r._tTime)/-r._ts)&&r.totalTime(r._tTime,!0),r=r.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&s<this._tDur||this._ts<0&&s>0||!this._tDur&&!s)&&Ht(this._dp,this,this._start-this._delay)}return(this._tTime!==s||!this._dur&&!i||this._initted&&Math.abs(this._zTime)===he||!s&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=s),Kl(this,s,i)),this},e.time=function(s,i){return arguments.length?this.totalTime(Math.min(this.totalDuration(),s+Vc(this))%(this._dur+this._rDelay)||(s?this._dur:0),i):this._time},e.totalProgress=function(s,i){return arguments.length?this.totalTime(this.totalDuration()*s,i):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.rawTime()>0?1:0},e.progress=function(s,i){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&!(this.iteration()&1)?1-s:s)+Vc(this),i):this.duration()?Math.min(1,this._time/this._dur):this.rawTime()>0?1:0},e.iteration=function(s,i){var r=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(s-1)*r,i):this._repeat?Ln(this._tTime,r)+1:1},e.timeScale=function(s,i){if(!arguments.length)return this._rts===-he?0:this._rts;if(this._rts===s)return this;var r=this.parent&&this._ts?Rr(this.parent._time,this):this._tTime;return this._rts=+s||0,this._ts=this._ps||s===-he?0:this._rts,this.totalTime($i(-Math.abs(this._delay),this._tDur,r),i!==!1),ao(this),bp(this)},e.paused=function(s){return arguments.length?(this._ps!==s&&(this._ps=s,s?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(zn(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,this.progress()===1&&Math.abs(this._zTime)!==he&&(this._tTime-=he)))),this):this._ps},e.startTime=function(s){if(arguments.length){this._start=s;var i=this.parent||this._dp;return i&&(i._sort||!this.parent)&&Ht(i,this,s-this._delay),this}return this._start},e.endTime=function(s){return this._start+(it(s)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},e.rawTime=function(s){var i=this.parent||this._dp;return i?s&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?Rr(i.rawTime(s),this):this._tTime:this._tTime},e.revert=function(s){s===void 0&&(s=Tp);var i=Ye;return Ye=s,(this._initted||this._startAt)&&(this.timeline&&this.timeline.revert(s),this.totalTime(-.01,s.suppressEvents)),this.data!=="nested"&&s.kill!==!1&&this.kill(),Ye=i,this},e.globalTime=function(s){for(var i=this,r=arguments.length?s:i.rawTime();i;)r=i._start+r/(Math.abs(i._ts)||1),i=i._dp;return!this.parent&&this._sat?this._sat.globalTime(s):r},e.repeat=function(s){return arguments.length?(this._repeat=s===1/0?-2:s,Hc(this)):this._repeat===-2?1/0:this._repeat},e.repeatDelay=function(s){if(arguments.length){var i=this._time;return this._rDelay=s,Hc(this),i?this.time(i):this}return this._rDelay},e.yoyo=function(s){return arguments.length?(this._yoyo=s,this):this._yoyo},e.seek=function(s,i){return this.totalTime(Tt(this,s),it(i))},e.restart=function(s,i){return this.play().totalTime(s?-this._delay:0,it(i))},e.play=function(s,i){return s!=null&&this.seek(s,i),this.reversed(!1).paused(!1)},e.reverse=function(s,i){return s!=null&&this.seek(s||this.totalDuration(),i),this.reversed(!0).paused(!1)},e.pause=function(s,i){return s!=null&&this.seek(s,i),this.paused(!0)},e.resume=function(){return this.paused(!1)},e.reversed=function(s){return arguments.length?(!!s!==this.reversed()&&this.timeScale(-this._rts||(s?-he:0)),this):this._rts<0},e.invalidate=function(){return this._initted=this._act=0,this._zTime=-he,this},e.isActive=function(){var s=this.parent||this._dp,i=this._start,r;return!!(!s||this._ts&&this._initted&&s.isActive()&&(r=s.rawTime(!0))>=i&&r<this.endTime(!0)-he)},e.eventCallback=function(s,i,r){var o=this.vars;return arguments.length>1?(i?(o[s]=i,r&&(o[s+"Params"]=r),s==="onUpdate"&&(this._onUpdate=i)):delete o[s],this):o[s]},e.then=function(s){var i=this;return new Promise(function(r){var o=Ae(s)?s:eu,a=function(){var l=i.then;i.then=null,Ae(o)&&(o=o(i))&&(o.then||o===i)&&(i.then=l),r(o),i.then=l};i._initted&&i.totalProgress()===1&&i._ts>=0||!i._tTime&&i._ts<0?a():i._prom=a})},e.kill=function(){_i(this)},n}();Et(Oi.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-he,_prom:0,_ps:!1,_rts:1});var Ke=function(n){Vl(e,n);function e(s,i){var r;return s===void 0&&(s={}),r=n.call(this,s)||this,r.labels={},r.smoothChildTiming=!!s.smoothChildTiming,r.autoRemoveChildren=!!s.autoRemoveChildren,r._sort=it(s.sortChildren),Se&&Ht(s.parent||Se,ts(r),i),s.reversed&&r.reverse(),s.paused&&r.paused(!0),s.scrollTrigger&&nu(ts(r),s.scrollTrigger),r}var t=e.prototype;return t.to=function(i,r,o){return yi(0,arguments,this),this},t.from=function(i,r,o){return yi(1,arguments,this),this},t.fromTo=function(i,r,o,a){return yi(2,arguments,this),this},t.set=function(i,r,o){return r.duration=0,r.parent=this,vi(r).repeatDelay||(r.repeat=0),r.immediateRender=!!r.immediateRender,new Fe(i,r,Tt(this,o),1),this},t.call=function(i,r,o){return Ht(this,Fe.delayedCall(0,i,r),o)},t.staggerTo=function(i,r,o,a,c,l,u){return o.duration=r,o.stagger=o.stagger||a,o.onComplete=l,o.onCompleteParams=u,o.parent=this,new Fe(i,o,Tt(this,c)),this},t.staggerFrom=function(i,r,o,a,c,l,u){return o.runBackwards=1,vi(o).immediateRender=it(o.immediateRender),this.staggerTo(i,r,o,a,c,l,u)},t.staggerFromTo=function(i,r,o,a,c,l,u,h){return a.startAt=o,vi(a).immediateRender=it(a.immediateRender),this.staggerTo(i,r,a,c,l,u,h)},t.render=function(i,r,o){var a=this._time,c=this._dirty?this.totalDuration():this._tDur,l=this._dur,u=i<=0?0:ze(i),h=this._zTime<0!=i<0&&(this._initted||!l),d,f,m,p,_,y,S,b,v,g,x,T;if(this!==Se&&u>c&&i>=0&&(u=c),u!==this._tTime||o||h){if(a!==this._time&&l&&(u+=this._time-a,i+=this._time-a),d=u,v=this._start,b=this._ts,y=!b,h&&(l||(a=this._zTime),(i||!r)&&(this._zTime=i)),this._repeat){if(x=this._yoyo,_=l+this._rDelay,this._repeat<-1&&i<0)return this.totalTime(_*100+i,r,o);if(d=ze(u%_),u===c?(p=this._repeat,d=l):(p=~~(u/_),p&&p===u/_&&(d=l,p--),d>l&&(d=l)),g=Ln(this._tTime,_),!a&&this._tTime&&g!==p&&this._tTime-g*_-this._dur<=0&&(g=p),x&&p&1&&(d=l-d,T=1),p!==g&&!this._lock){var w=x&&g&1,C=w===(x&&p&1);if(p<g&&(w=!w),a=w?0:u%l?l:u,this._lock=1,this.render(a||(T?0:ze(p*_)),r,!l)._lock=0,this._tTime=u,!r&&this.parent&&ft(this,"onRepeat"),this.vars.repeatRefresh&&!T&&(this.invalidate()._lock=1),a&&a!==this._time||y!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(l=this._dur,c=this._tDur,C&&(this._lock=2,a=w?l:-1e-4,this.render(a,!0),this.vars.repeatRefresh&&!T&&this.invalidate()),this._lock=0,!this._ts&&!y)return this;vu(this,T)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(S=Ap(this,ze(a),ze(d)),S&&(u-=d-(d=S._start))),this._tTime=u,this._time=d,this._act=!b,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=i,a=0),!a&&d&&!r&&!p&&(ft(this,"onStart"),this._tTime!==u))return this;if(d>=a&&i>=0)for(f=this._first;f;){if(m=f._next,(f._act||d>=f._start)&&f._ts&&S!==f){if(f.parent!==this)return this.render(i,r,o);if(f.render(f._ts>0?(d-f._start)*f._ts:(f._dirty?f.totalDuration():f._tDur)+(d-f._start)*f._ts,r,o),d!==this._time||!this._ts&&!y){S=0,m&&(u+=this._zTime=-he);break}}f=m}else{f=this._last;for(var E=i<0?i:d;f;){if(m=f._prev,(f._act||E<=f._end)&&f._ts&&S!==f){if(f.parent!==this)return this.render(i,r,o);if(f.render(f._ts>0?(E-f._start)*f._ts:(f._dirty?f.totalDuration():f._tDur)+(E-f._start)*f._ts,r,o||Ye&&(f._initted||f._startAt)),d!==this._time||!this._ts&&!y){S=0,m&&(u+=this._zTime=E?-he:he);break}}f=m}}if(S&&!r&&(this.pause(),S.render(d>=a?0:-he)._zTime=d>=a?1:-1,this._ts))return this._start=v,ao(this),this.render(i,r,o);this._onUpdate&&!r&&ft(this,"onUpdate",!0),(u===c&&this._tTime>=this.totalDuration()||!u&&a)&&(v===this._start||Math.abs(b)!==Math.abs(this._ts))&&(this._lock||((i||!l)&&(u===c&&this._ts>0||!u&&this._ts<0)&&ks(this,1),!r&&!(i<0&&!a)&&(u||a||!c)&&(ft(this,u===c&&i>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(u<c&&this.timeScale()>0)&&this._prom())))}return this},t.add=function(i,r){var o=this;if(cs(r)||(r=Tt(this,r,i)),!(i instanceof Oi)){if(Ze(i))return i.forEach(function(a){return o.add(a,r)}),this;if(qe(i))return this.addLabel(i,r);if(Ae(i))i=Fe.delayedCall(0,i);else return this}return this!==i?Ht(this,i,r):this},t.getChildren=function(i,r,o,a){i===void 0&&(i=!0),r===void 0&&(r=!0),o===void 0&&(o=!0),a===void 0&&(a=-wt);for(var c=[],l=this._first;l;)l._start>=a&&(l instanceof Fe?r&&c.push(l):(o&&c.push(l),i&&c.push.apply(c,l.getChildren(!0,r,o)))),l=l._next;return c},t.getById=function(i){for(var r=this.getChildren(1,1,1),o=r.length;o--;)if(r[o].vars.id===i)return r[o]},t.remove=function(i){return qe(i)?this.removeLabel(i):Ae(i)?this.killTweensOf(i):(oo(this,i),i===this._recent&&(this._recent=this._last),Ks(this))},t.totalTime=function(i,r){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=ze(dt.time-(this._ts>0?i/this._ts:(this.totalDuration()-i)/-this._ts))),n.prototype.totalTime.call(this,i,r),this._forcing=0,this):this._tTime},t.addLabel=function(i,r){return this.labels[i]=Tt(this,r),this},t.removeLabel=function(i){return delete this.labels[i],this},t.addPause=function(i,r,o){var a=Fe.delayedCall(0,r||bi,o);return a.data="isPause",this._hasPause=1,Ht(this,a,Tt(this,i))},t.removePause=function(i){var r=this._first;for(i=Tt(this,i);r;)r._start===i&&r.data==="isPause"&&ks(r),r=r._next},t.killTweensOf=function(i,r,o){for(var a=this.getTweensOf(i,o),c=a.length;c--;)bs!==a[c]&&a[c].kill(i,r);return this},t.getTweensOf=function(i,r){for(var o=[],a=St(i),c=this._first,l=cs(r),u;c;)c instanceof Fe?xp(c._targets,a)&&(l?(!bs||c._initted&&c._ts)&&c.globalTime(0)<=r&&c.globalTime(c.totalDuration())>r:!r||c.isActive())&&o.push(c):(u=c.getTweensOf(a,r)).length&&o.push.apply(o,u),c=c._next;return o},t.tweenTo=function(i,r){r=r||{};var o=this,a=Tt(o,i),c=r,l=c.startAt,u=c.onStart,h=c.onStartParams,d=c.immediateRender,f,m=Fe.to(o,Et({ease:r.ease||"none",lazy:!1,immediateRender:!1,time:a,overwrite:"auto",duration:r.duration||Math.abs((a-(l&&"time"in l?l.time:o._time))/o.timeScale())||he,onStart:function(){if(o.pause(),!f){var _=r.duration||Math.abs((a-(l&&"time"in l?l.time:o._time))/o.timeScale());m._dur!==_&&Bn(m,_,0,1).render(m._time,!0,!0),f=1}u&&u.apply(m,h||[])}},r));return d?m.render(0):m},t.tweenFromTo=function(i,r,o){return this.tweenTo(r,Et({startAt:{time:Tt(this,i)}},o))},t.recent=function(){return this._recent},t.nextLabel=function(i){return i===void 0&&(i=this._time),qc(this,Tt(this,i))},t.previousLabel=function(i){return i===void 0&&(i=this._time),qc(this,Tt(this,i),1)},t.currentLabel=function(i){return arguments.length?this.seek(i,!0):this.previousLabel(this._time+he)},t.shiftChildren=function(i,r,o){o===void 0&&(o=0);for(var a=this._first,c=this.labels,l;a;)a._start>=o&&(a._start+=i,a._end+=i),a=a._next;if(r)for(l in c)c[l]>=o&&(c[l]+=i);return Ks(this)},t.invalidate=function(i){var r=this._first;for(this._lock=0;r;)r.invalidate(i),r=r._next;return n.prototype.invalidate.call(this,i)},t.clear=function(i){i===void 0&&(i=!0);for(var r=this._first,o;r;)o=r._next,this.remove(r),r=o;return this._dp&&(this._time=this._tTime=this._pTime=0),i&&(this.labels={}),Ks(this)},t.totalDuration=function(i){var r=0,o=this,a=o._last,c=wt,l,u,h;if(arguments.length)return o.timeScale((o._repeat<0?o.duration():o.totalDuration())/(o.reversed()?-i:i));if(o._dirty){for(h=o.parent;a;)l=a._prev,a._dirty&&a.totalDuration(),u=a._start,u>c&&o._sort&&a._ts&&!o._lock?(o._lock=1,Ht(o,a,u-a._delay,1)._lock=0):c=u,u<0&&a._ts&&(r-=u,(!h&&!o._dp||h&&h.smoothChildTiming)&&(o._start+=u/o._ts,o._time-=u,o._tTime-=u),o.shiftChildren(-u,!1,-1/0),c=0),a._end>r&&a._ts&&(r=a._end),a=l;Bn(o,o===Se&&o._time>r?o._time:r,1,1),o._dirty=0}return o._tDur},e.updateRoot=function(i){if(Se._ts&&(Kl(Se,Rr(i,Se)),$l=dt.frame),dt.frame>=Bc){Bc+=pt.autoSleep||120;var r=Se._first;if((!r||!r._ts)&&pt.autoSleep&&dt._listeners.length<2){for(;r&&!r._ts;)r=r._next;r||dt.sleep()}}},e}(Oi);Et(Ke.prototype,{_lock:0,_hasPause:0,_forcing:0});var Wp=function(e,t,s,i,r,o,a){var c=new ot(this._pt,e,t,0,1,Eu,null,r),l=0,u=0,h,d,f,m,p,_,y,S;for(c.b=s,c.e=i,s+="",i+="",(y=~i.indexOf("random("))&&(i=Ci(i)),o&&(S=[s,i],o(S,e,t),s=S[0],i=S[1]),d=s.match(Io)||[];h=Io.exec(i);)m=h[0],p=i.substring(l,h.index),f?f=(f+1)%5:p.substr(-5)==="rgba("&&(f=1),m!==d[u++]&&(_=parseFloat(d[u-1])||0,c._pt={_next:c._pt,p:p||u===1?p:",",s:_,c:m.charAt(1)==="="?Dn(_,m)-_:parseFloat(m)-_,m:f&&f<4?Math.round:0},l=Io.lastIndex);return c.c=l<i.length?i.substring(l,i.length):"",c.fp=a,(Gl.test(i)||y)&&(c.e=0),this._pt=c,c},Fa=function(e,t,s,i,r,o,a,c,l,u){Ae(i)&&(i=i(r||0,e,o));var h=e[t],d=s!=="get"?s:Ae(h)?l?e[t.indexOf("set")||!Ae(e["get"+t.substr(3)])?t:"get"+t.substr(3)](l):e[t]():h,f=Ae(h)?l?Xp:bu:La,m;if(qe(i)&&(~i.indexOf("random(")&&(i=Ci(i)),i.charAt(1)==="="&&(m=Dn(d,i)+(je(d)||0),(m||m===0)&&(i=m))),!u||d!==i||ia)return!isNaN(d*i)&&i!==""?(m=new ot(this._pt,e,t,+d||0,i-(d||0),typeof h=="boolean"?Qp:Cu,0,f),l&&(m.fp=l),a&&m.modifier(a,this,e),this._pt=m):(!h&&!(t in e)&&Ra(t,i),Wp.call(this,e,t,d,i,f,c||pt.stringFilter,l))},Gp=function(e,t,s,i,r){if(Ae(e)&&(e=Ti(e,r,t,s,i)),!Gt(e)||e.style&&e.nodeType||Ze(e)||ql(e))return qe(e)?Ti(e,r,t,s,i):e;var o={},a;for(a in e)o[a]=Ti(e[a],r,t,s,i);return o},xu=function(e,t,s,i,r,o){var a,c,l,u;if(ht[e]&&(a=new ht[e]).init(r,a.rawVars?t[e]:Gp(t[e],i,r,o,s),s,i,o)!==!1&&(s._pt=c=new ot(s._pt,r,e,0,1,a.render,a,0,a.priority),s!==En))for(l=s._ptLookup[s._targets.indexOf(r)],u=a._props.length;u--;)l[a._props[u]]=c;return a},bs,ia,Ua=function n(e,t,s){var i=e.vars,r=i.ease,o=i.startAt,a=i.immediateRender,c=i.lazy,l=i.onUpdate,u=i.runBackwards,h=i.yoyoEase,d=i.keyframes,f=i.autoRevert,m=e._dur,p=e._startAt,_=e._targets,y=e.parent,S=y&&y.data==="nested"?y.vars.targets:_,b=e._overwrite==="auto"&&!Aa,v=e.timeline,g,x,T,w,C,E,O,A,D,R,I,N,F;if(v&&(!d||!r)&&(r="none"),e._ease=Js(r,Un.ease),e._yEase=h?gu(Js(h===!0?r:h,Un.ease)):0,h&&e._yoyo&&!e._repeat&&(h=e._yEase,e._yEase=e._ease,e._ease=h),e._from=!v&&!!i.runBackwards,!v||d&&!i.stagger){if(A=_[0]?Qs(_[0]).harness:0,N=A&&i[A.prop],g=kr(i,Pa),p&&(p._zTime<0&&p.progress(1),t<0&&u&&a&&!f?p.render(-1,!0):p.revert(u&&m?Sr:yp),p._lazy=0),o){if(ks(e._startAt=Fe.set(_,Et({data:"isStart",overwrite:!1,parent:y,immediateRender:!0,lazy:!p&&it(c),startAt:null,delay:0,onUpdate:l&&function(){return ft(e,"onUpdate")},stagger:0},o))),e._startAt._dp=0,e._startAt._sat=e,t<0&&(Ye||!a&&!f)&&e._startAt.revert(Sr),a&&m&&t<=0&&s<=0){t&&(e._zTime=t);return}}else if(u&&m&&!p){if(t&&(a=!1),T=Et({overwrite:!1,data:"isFromStart",lazy:a&&!p&&it(c),immediateRender:a,stagger:0,parent:y},g),N&&(T[A.prop]=N),ks(e._startAt=Fe.set(_,T)),e._startAt._dp=0,e._startAt._sat=e,t<0&&(Ye?e._startAt.revert(Sr):e._startAt.render(-1,!0)),e._zTime=t,!a)n(e._startAt,he,he);else if(!t)return}for(e._pt=e._ptCache=0,c=m&&it(c)||c&&!m,x=0;x<_.length;x++){if(C=_[x],O=C._gsap||Ia(_)[x]._gsap,e._ptLookup[x]=R={},Ko[O.id]&&As.length&&Dr(),I=S===_?x:S.indexOf(C),A&&(D=new A).init(C,N||g,e,I,S)!==!1&&(e._pt=w=new ot(e._pt,C,D.name,0,1,D.render,D,0,D.priority),D._props.forEach(function(z){R[z]=w}),D.priority&&(E=1)),!A||N)for(T in g)ht[T]&&(D=xu(T,g,e,I,C,S))?D.priority&&(E=1):R[T]=w=Fa.call(e,C,T,"get",g[T],I,S,0,i.stringFilter);e._op&&e._op[x]&&e.kill(C,e._op[x]),b&&e._pt&&(bs=e,Se.killTweensOf(C,R,e.globalTime(t)),F=!e.parent,bs=0),e._pt&&c&&(Ko[O.id]=1)}E&&Ou(e),e._onInit&&e._onInit(e)}e._onUpdate=l,e._initted=(!e._op||e._pt)&&!F,d&&t<=0&&v.render(wt,!0,!0)},jp=function(e,t,s,i,r,o,a,c){var l=(e._pt&&e._ptCache||(e._ptCache={}))[t],u,h,d,f;if(!l)for(l=e._ptCache[t]=[],d=e._ptLookup,f=e._targets.length;f--;){if(u=d[f][t],u&&u.d&&u.d._pt)for(u=u.d._pt;u&&u.p!==t&&u.fp!==t;)u=u._next;if(!u)return ia=1,e.vars[t]="+=0",Ua(e,a),ia=0,c?Si(t+" not eligible for reset"):1;l.push(u)}for(f=l.length;f--;)h=l[f],u=h._pt||h,u.s=(i||i===0)&&!r?i:u.s+(i||0)+o*u.c,u.c=s-u.s,h.e&&(h.e=De(s)+je(h.e)),h.b&&(h.b=u.s+je(h.b))},Yp=function(e,t){var s=e[0]?Qs(e[0]).harness:0,i=s&&s.aliases,r,o,a,c;if(!i)return t;r=nn({},t);for(o in i)if(o in r)for(c=i[o].split(","),a=c.length;a--;)r[c[a]]=r[o];return r},Zp=function(e,t,s,i){var r=t.ease||i||"power1.inOut",o,a;if(Ze(t))a=s[e]||(s[e]=[]),t.forEach(function(c,l){return a.push({t:l/(t.length-1)*100,v:c,e:r})});else for(o in t)a=s[o]||(s[o]=[]),o==="ease"||a.push({t:parseFloat(e),v:t[o],e:r})},Ti=function(e,t,s,i,r){return Ae(e)?e.call(t,s,i,r):qe(e)&&~e.indexOf("random(")?Ci(e):e},wu=Na+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",Su={};rt(wu+",id,stagger,delay,duration,paused,scrollTrigger",function(n){return Su[n]=1});var Fe=function(n){Vl(e,n);function e(s,i,r,o){var a;typeof i=="number"&&(r.duration=i,i=r,r=null),a=n.call(this,o?i:vi(i))||this;var c=a.vars,l=c.duration,u=c.delay,h=c.immediateRender,d=c.stagger,f=c.overwrite,m=c.keyframes,p=c.defaults,_=c.scrollTrigger,y=c.yoyoEase,S=i.parent||Se,b=(Ze(s)||ql(s)?cs(s[0]):"length"in i)?[s]:St(s),v,g,x,T,w,C,E,O;if(a._targets=b.length?Ia(b):Si("GSAP target "+s+" not found. https://gsap.com",!pt.nullTargetWarn)||[],a._ptLookup=[],a._overwrite=f,m||d||vr(l)||vr(u)){if(i=a.vars,v=a.timeline=new Ke({data:"nested",defaults:p||{},targets:S&&S.data==="nested"?S.vars.targets:b}),v.kill(),v.parent=v._dp=ts(a),v._start=0,d||vr(l)||vr(u)){if(T=b.length,E=d&&au(d),Gt(d))for(w in d)~wu.indexOf(w)&&(O||(O={}),O[w]=d[w]);for(g=0;g<T;g++)x=kr(i,Su),x.stagger=0,y&&(x.yoyoEase=y),O&&nn(x,O),C=b[g],x.duration=+Ti(l,ts(a),g,C,b),x.delay=(+Ti(u,ts(a),g,C,b)||0)-a._delay,!d&&T===1&&x.delay&&(a._delay=u=x.delay,a._start+=u,x.delay=0),v.to(C,x,E?E(g,C,b):0),v._ease=ee.none;v.duration()?l=u=0:a.timeline=0}else if(m){vi(Et(v.vars.defaults,{ease:"none"})),v._ease=Js(m.ease||i.ease||"none");var A=0,D,R,I;if(Ze(m))m.forEach(function(N){return v.to(b,N,">")}),v.duration();else{x={};for(w in m)w==="ease"||w==="easeEach"||Zp(w,m[w],x,m.easeEach);for(w in x)for(D=x[w].sort(function(N,F){return N.t-F.t}),A=0,g=0;g<D.length;g++)R=D[g],I={ease:R.e,duration:(R.t-(g?D[g-1].t:0))/100*l},I[w]=R.v,v.to(b,I,A),A+=I.duration;v.duration()<l&&v.to({},{duration:l-v.duration()})}}l||a.duration(l=v.duration())}else a.timeline=0;return f===!0&&!Aa&&(bs=ts(a),Se.killTweensOf(b),bs=0),Ht(S,ts(a),r),i.reversed&&a.reverse(),i.paused&&a.paused(!0),(h||!l&&!m&&a._start===ze(S._time)&&it(h)&&Cp(ts(a))&&S.data!=="nested")&&(a._tTime=-he,a.render(Math.max(0,-u)||0)),_&&nu(ts(a),_),a}var t=e.prototype;return t.render=function(i,r,o){var a=this._time,c=this._tDur,l=this._dur,u=i<0,h=i>c-he&&!u?c:i<he?0:i,d,f,m,p,_,y,S,b,v;if(!l)Op(this,i,r,o);else if(h!==this._tTime||!i||o||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==u){if(d=h,b=this.timeline,this._repeat){if(p=l+this._rDelay,this._repeat<-1&&u)return this.totalTime(p*100+i,r,o);if(d=ze(h%p),h===c?(m=this._repeat,d=l):(m=~~(h/p),m&&m===ze(h/p)&&(d=l,m--),d>l&&(d=l)),y=this._yoyo&&m&1,y&&(v=this._yEase,d=l-d),_=Ln(this._tTime,p),d===a&&!o&&this._initted&&m===_)return this._tTime=h,this;m!==_&&(b&&this._yEase&&vu(b,y),this.vars.repeatRefresh&&!y&&!this._lock&&this._time!==l&&this._initted&&(this._lock=o=1,this.render(ze(p*m),!0).invalidate()._lock=0))}if(!this._initted){if(iu(this,u?i:d,o,r,h))return this._tTime=0,this;if(a!==this._time&&!(o&&this.vars.repeatRefresh&&m!==_))return this;if(l!==this._dur)return this.render(i,r,o)}if(this._tTime=h,this._time=d,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=S=(v||this._ease)(d/l),this._from&&(this.ratio=S=1-S),d&&!a&&!r&&!m&&(ft(this,"onStart"),this._tTime!==h))return this;for(f=this._pt;f;)f.r(S,f.d),f=f._next;b&&b.render(i<0?i:!d&&y?-he:b._dur*b._ease(d/this._dur),r,o)||this._startAt&&(this._zTime=i),this._onUpdate&&!r&&(u&&Jo(this,i,r,o),ft(this,"onUpdate")),this._repeat&&m!==_&&this.vars.onRepeat&&!r&&this.parent&&ft(this,"onRepeat"),(h===this._tDur||!h)&&this._tTime===h&&(u&&!this._onUpdate&&Jo(this,i,!0,!0),(i||!l)&&(h===this._tDur&&this._ts>0||!h&&this._ts<0)&&ks(this,1),!r&&!(u&&!a)&&(h||a||y)&&(ft(this,h===c?"onComplete":"onReverseComplete",!0),this._prom&&!(h<c&&this.timeScale()>0)&&this._prom()))}return this},t.targets=function(){return this._targets},t.invalidate=function(i){return(!i||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(i),n.prototype.invalidate.call(this,i)},t.resetTo=function(i,r,o,a,c){Ei||dt.wake(),this._ts||this.play();var l=Math.min(this._dur,(this._dp._time-this._start)*this._ts),u;return this._initted||Ua(this,l),u=this._ease(l/this._dur),jp(this,i,r,o,a,u,l,c)?this.resetTo(i,r,o,a,1):(co(this,0),this.parent||tu(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},t.kill=function(i,r){if(r===void 0&&(r="all"),!i&&(!r||r==="all"))return this._lazy=this._pt=0,this.parent?_i(this):this;if(this.timeline){var o=this.timeline.totalDuration();return this.timeline.killTweensOf(i,r,bs&&bs.vars.overwrite!==!0)._first||_i(this),this.parent&&o!==this.timeline.totalDuration()&&Bn(this,this._dur*this.timeline._tDur/o,0,1),this}var a=this._targets,c=i?St(i):a,l=this._ptLookup,u=this._pt,h,d,f,m,p,_,y;if((!r||r==="all")&&Sp(a,c))return r==="all"&&(this._pt=0),_i(this);for(h=this._op=this._op||[],r!=="all"&&(qe(r)&&(p={},rt(r,function(S){return p[S]=1}),r=p),r=Yp(a,r)),y=a.length;y--;)if(~c.indexOf(a[y])){d=l[y],r==="all"?(h[y]=r,m=d,f={}):(f=h[y]=h[y]||{},m=r);for(p in m)_=d&&d[p],_&&((!("kill"in _.d)||_.d.kill(p)===!0)&&oo(this,_,"_pt"),delete d[p]),f!=="all"&&(f[p]=1)}return this._initted&&!this._pt&&u&&_i(this),this},e.to=function(i,r){return new e(i,r,arguments[2])},e.from=function(i,r){return yi(1,arguments)},e.delayedCall=function(i,r,o,a){return new e(r,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:i,onComplete:r,onReverseComplete:r,onCompleteParams:o,onReverseCompleteParams:o,callbackScope:a})},e.fromTo=function(i,r,o){return yi(2,arguments)},e.set=function(i,r){return r.duration=0,r.repeatDelay||(r.repeat=0),new e(i,r)},e.killTweensOf=function(i,r,o){return Se.killTweensOf(i,r,o)},e}(Oi);Et(Fe.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0});rt("staggerTo,staggerFrom,staggerFromTo",function(n){Fe[n]=function(){var e=new Ke,t=ta.call(arguments,0);return t.splice(n==="staggerFromTo"?5:4,0,0),e[n].apply(e,t)}});var La=function(e,t,s){return e[t]=s},bu=function(e,t,s){return e[t](s)},Xp=function(e,t,s,i){return e[t](i.fp,s)},$p=function(e,t,s){return e.setAttribute(t,s)},Ba=function(e,t){return Ae(e[t])?bu:Ma(e[t])&&e.setAttribute?$p:La},Cu=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e6)/1e6,t)},Qp=function(e,t){return t.set(t.t,t.p,!!(t.s+t.c*e),t)},Eu=function(e,t){var s=t._pt,i="";if(!e&&t.b)i=t.b;else if(e===1&&t.e)i=t.e;else{for(;s;)i=s.p+(s.m?s.m(s.s+s.c*e):Math.round((s.s+s.c*e)*1e4)/1e4)+i,s=s._next;i+=t.c}t.set(t.t,t.p,i,t)},za=function(e,t){for(var s=t._pt;s;)s.r(e,s.d),s=s._next},Kp=function(e,t,s,i){for(var r=this._pt,o;r;)o=r._next,r.p===i&&r.modifier(e,t,s),r=o},Jp=function(e){for(var t=this._pt,s,i;t;)i=t._next,t.p===e&&!t.op||t.op===e?oo(this,t,"_pt"):t.dep||(s=1),t=i;return!s},em=function(e,t,s,i){i.mSet(e,t,i.m.call(i.tween,s,i.mt),i)},Ou=function(e){for(var t=e._pt,s,i,r,o;t;){for(s=t._next,i=r;i&&i.pr>t.pr;)i=i._next;(t._prev=i?i._prev:o)?t._prev._next=t:r=t,(t._next=i)?i._prev=t:o=t,t=s}e._pt=r},ot=function(){function n(t,s,i,r,o,a,c,l,u){this.t=s,this.s=r,this.c=o,this.p=i,this.r=a||Cu,this.d=c||this,this.set=l||La,this.pr=u||0,this._next=t,t&&(t._prev=this)}var e=n.prototype;return e.modifier=function(s,i,r){this.mSet=this.mSet||this.set,this.set=em,this.m=s,this.mt=r,this.tween=i},n}();rt(Na+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",function(n){return Pa[n]=1});gt.TweenMax=gt.TweenLite=Fe;gt.TimelineLite=gt.TimelineMax=Ke;Se=new Ke({sortChildren:!1,defaults:Un,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0});pt.stringFilter=_u;var en=[],Cr={},tm=[],Gc=0,sm=0,zo=function(e){return(Cr[e]||tm).map(function(t){return t()})},ra=function(){var e=Date.now(),t=[];e-Gc>2&&(zo("matchMediaInit"),en.forEach(function(s){var i=s.queries,r=s.conditions,o,a,c,l;for(a in i)o=xt.matchMedia(i[a]).matches,o&&(c=1),o!==r[a]&&(r[a]=o,l=1);l&&(s.revert(),c&&t.push(s))}),zo("matchMediaRevert"),t.forEach(function(s){return s.onMatch(s,function(i){return s.add(null,i)})}),Gc=e,zo("matchMedia"))},Au=function(){function n(t,s){this.selector=s&&sa(s),this.data=[],this._r=[],this.isReverted=!1,this.id=sm++,t&&this.add(t)}var e=n.prototype;return e.add=function(s,i,r){Ae(s)&&(r=i,i=s,s=Ae);var o=this,a=function(){var l=Ee,u=o.selector,h;return l&&l!==o&&l.data.push(o),r&&(o.selector=sa(r)),Ee=o,h=i.apply(o,arguments),Ae(h)&&o._r.push(h),Ee=l,o.selector=u,o.isReverted=!1,h};return o.last=a,s===Ae?a(o,function(c){return o.add(null,c)}):s?o[s]=a:a},e.ignore=function(s){var i=Ee;Ee=null,s(this),Ee=i},e.getTweens=function(){var s=[];return this.data.forEach(function(i){return i instanceof n?s.push.apply(s,i.getTweens()):i instanceof Fe&&!(i.parent&&i.parent.data==="nested")&&s.push(i)}),s},e.clear=function(){this._r.length=this.data.length=0},e.kill=function(s,i){var r=this;if(s?function(){for(var a=r.getTweens(),c=r.data.length,l;c--;)l=r.data[c],l.data==="isFlip"&&(l.revert(),l.getChildren(!0,!0,!1).forEach(function(u){return a.splice(a.indexOf(u),1)}));for(a.map(function(u){return{g:u._dur||u._delay||u._sat&&!u._sat.vars.immediateRender?u.globalTime(0):-1/0,t:u}}).sort(function(u,h){return h.g-u.g||-1/0}).forEach(function(u){return u.t.revert(s)}),c=r.data.length;c--;)l=r.data[c],l instanceof Ke?l.data!=="nested"&&(l.scrollTrigger&&l.scrollTrigger.revert(),l.kill()):!(l instanceof Fe)&&l.revert&&l.revert(s);r._r.forEach(function(u){return u(s,r)}),r.isReverted=!0}():this.data.forEach(function(a){return a.kill&&a.kill()}),this.clear(),i)for(var o=en.length;o--;)en[o].id===this.id&&en.splice(o,1)},e.revert=function(s){this.kill(s||{})},n}(),nm=function(){function n(t){this.contexts=[],this.scope=t}var e=n.prototype;return e.add=function(s,i,r){Gt(s)||(s={matches:s});var o=new Au(0,r||this.scope),a=o.conditions={},c,l,u;Ee&&!o.selector&&(o.selector=Ee.selector),this.contexts.push(o),i=o.add("onMatch",i),o.queries=s;for(l in s)l==="all"?u=1:(c=xt.matchMedia(s[l]),c&&(en.indexOf(o)<0&&en.push(o),(a[l]=c.matches)&&(u=1),c.addListener?c.addListener(ra):c.addEventListener("change",ra)));return u&&i(o,function(h){return o.add(null,h)}),this},e.revert=function(s){this.kill(s||{})},e.kill=function(s){this.contexts.forEach(function(i){return i.kill(s,!0)})},n}(),Pr={registerPlugin:function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];t.forEach(function(i){return fu(i)})},timeline:function(e){return new Ke(e)},getTweensOf:function(e,t){return Se.getTweensOf(e,t)},getProperty:function(e,t,s,i){qe(e)&&(e=St(e)[0]);var r=Qs(e||{}).get,o=s?eu:Jl;return s==="native"&&(s=""),e&&(t?o((ht[t]&&ht[t].get||r)(e,t,s,i)):function(a,c,l){return o((ht[a]&&ht[a].get||r)(e,a,c,l))})},quickSetter:function(e,t,s){if(e=St(e),e.length>1){var i=e.map(function(u){return lt.quickSetter(u,t,s)}),r=i.length;return function(u){for(var h=r;h--;)i[h](u)}}e=e[0]||{};var o=ht[t],a=Qs(e),c=a.harness&&(a.harness.aliases||{})[t]||t,l=o?function(u){var h=new o;En._pt=0,h.init(e,s?u+s:u,En,0,[e]),h.render(1,h),En._pt&&za(1,En)}:a.set(e,c);return o?l:function(u){return l(e,c,s?u+s:u,a,1)}},quickTo:function(e,t,s){var i,r=lt.to(e,nn((i={},i[t]="+=0.1",i.paused=!0,i),s||{})),o=function(c,l,u){return r.resetTo(t,c,l,u)};return o.tween=r,o},isTweening:function(e){return Se.getTweensOf(e,!0).length>0},defaults:function(e){return e&&e.ease&&(e.ease=Js(e.ease,Un.ease)),zc(Un,e||{})},config:function(e){return zc(pt,e||{})},registerEffect:function(e){var t=e.name,s=e.effect,i=e.plugins,r=e.defaults,o=e.extendTimeline;(i||"").split(",").forEach(function(a){return a&&!ht[a]&&!gt[a]&&Si(t+" effect requires "+a+" plugin.")}),Fo[t]=function(a,c,l){return s(St(a),Et(c||{},r),l)},o&&(Ke.prototype[t]=function(a,c,l){return this.add(Fo[t](a,Gt(c)?c:(l=c)&&{},this),l)})},registerEase:function(e,t){ee[e]=Js(t)},parseEase:function(e,t){return arguments.length?Js(e,t):ee},getById:function(e){return Se.getById(e)},exportRoot:function(e,t){e===void 0&&(e={});var s=new Ke(e),i,r;for(s.smoothChildTiming=it(e.smoothChildTiming),Se.remove(s),s._dp=0,s._time=s._tTime=Se._time,i=Se._first;i;)r=i._next,(t||!(!i._dur&&i instanceof Fe&&i.vars.onComplete===i._targets[0]))&&Ht(s,i,i._start-i._delay),i=r;return Ht(Se,s,0),s},context:function(e,t){return e?new Au(e,t):Ee},matchMedia:function(e){return new nm(e)},matchMediaRefresh:function(){return en.forEach(function(e){var t=e.conditions,s,i;for(i in t)t[i]&&(t[i]=!1,s=1);s&&e.revert()})||ra()},addEventListener:function(e,t){var s=Cr[e]||(Cr[e]=[]);~s.indexOf(t)||s.push(t)},removeEventListener:function(e,t){var s=Cr[e],i=s&&s.indexOf(t);i>=0&&s.splice(i,1)},utils:{wrap:Ip,wrapYoyo:Fp,distribute:au,random:lu,snap:cu,normalize:Np,getUnit:je,clamp:Dp,splitColor:pu,toArray:St,selector:sa,mapRange:hu,pipe:Rp,unitize:Pp,interpolate:Up,shuffle:ou},install:Zl,effects:Fo,ticker:dt,updateRoot:Ke.updateRoot,plugins:ht,globalTimeline:Se,core:{PropTween:ot,globals:Xl,Tween:Fe,Timeline:Ke,Animation:Oi,getCache:Qs,_removeLinkedListItem:oo,reverting:function(){return Ye},context:function(e){return e&&Ee&&(Ee.data.push(e),e._ctx=Ee),Ee},suppressOverwrites:function(e){return Aa=e}}};rt("to,from,fromTo,delayedCall,set,killTweensOf",function(n){return Pr[n]=Fe[n]});dt.add(Ke.updateRoot);En=Pr.to({},{duration:0});var im=function(e,t){for(var s=e._pt;s&&s.p!==t&&s.op!==t&&s.fp!==t;)s=s._next;return s},rm=function(e,t){var s=e._targets,i,r,o;for(i in t)for(r=s.length;r--;)o=e._ptLookup[r][i],o&&(o=o.d)&&(o._pt&&(o=im(o,i)),o&&o.modifier&&o.modifier(t[i],e,s[r],i))},Vo=function(e,t){return{name:e,rawVars:1,init:function(i,r,o){o._onInit=function(a){var c,l;if(qe(r)&&(c={},rt(r,function(u){return c[u]=1}),r=c),t){c={};for(l in r)c[l]=t(r[l]);r=c}rm(a,r)}}}},lt=Pr.registerPlugin({name:"attr",init:function(e,t,s,i,r){var o,a,c;this.tween=s;for(o in t)c=e.getAttribute(o)||"",a=this.add(e,"setAttribute",(c||0)+"",t[o],i,r,0,0,o),a.op=o,a.b=c,this._props.push(o)},render:function(e,t){for(var s=t._pt;s;)Ye?s.set(s.t,s.p,s.b,s):s.r(e,s.d),s=s._next}},{name:"endArray",init:function(e,t){for(var s=t.length;s--;)this.add(e,s,e[s]||0,t[s],0,0,0,0,0,1)}},Vo("roundProps",na),Vo("modifiers"),Vo("snap",cu))||Pr;Fe.version=Ke.version=lt.version="3.12.4";Yl=1;Da()&&zn();ee.Power0;ee.Power1;ee.Power2;ee.Power3;ee.Power4;ee.Linear;ee.Quad;ee.Cubic;ee.Quart;ee.Quint;ee.Strong;ee.Elastic;ee.Back;ee.SteppedEase;ee.Bounce;ee.Sine;ee.Expo;ee.Circ;/*!
 * CSSPlugin 3.12.4
 * https://gsap.com
 *
 * Copyright 2008-2023, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license or for
 * Club GSAP members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var jc,Cs,kn,Va,Xs,Yc,Ha,om=function(){return typeof window<"u"},ls={},Ys=180/Math.PI,Rn=Math.PI/180,wn=Math.atan2,Zc=1e8,qa=/([A-Z])/g,am=/(left|right|width|margin|padding|x)/i,cm=/[\s,\(]\S/,qt={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},oa=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},lm=function(e,t){return t.set(t.t,t.p,e===1?t.e:Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},um=function(e,t){return t.set(t.t,t.p,e?Math.round((t.s+t.c*e)*1e4)/1e4+t.u:t.b,t)},hm=function(e,t){var s=t.s+t.c*e;t.set(t.t,t.p,~~(s+(s<0?-.5:.5))+t.u,t)},Mu=function(e,t){return t.set(t.t,t.p,e?t.e:t.b,t)},Du=function(e,t){return t.set(t.t,t.p,e!==1?t.b:t.e,t)},dm=function(e,t,s){return e.style[t]=s},fm=function(e,t,s){return e.style.setProperty(t,s)},pm=function(e,t,s){return e._gsap[t]=s},mm=function(e,t,s){return e._gsap.scaleX=e._gsap.scaleY=s},_m=function(e,t,s,i,r){var o=e._gsap;o.scaleX=o.scaleY=s,o.renderTransform(r,o)},gm=function(e,t,s,i,r){var o=e._gsap;o[t]=s,o.renderTransform(r,o)},be="transform",at=be+"Origin",vm=function n(e,t){var s=this,i=this.target,r=i.style,o=i._gsap;if(e in ls&&r){if(this.tfm=this.tfm||{},e!=="transform")e=qt[e]||e,~e.indexOf(",")?e.split(",").forEach(function(a){return s.tfm[a]=ns(i,a)}):this.tfm[e]=o.x?o[e]:ns(i,e),e===at&&(this.tfm.zOrigin=o.zOrigin);else return qt.transform.split(",").forEach(function(a){return n.call(s,a,t)});if(this.props.indexOf(be)>=0)return;o.svg&&(this.svgo=i.getAttribute("data-svg-origin"),this.props.push(at,t,"")),e=be}(r||t)&&this.props.push(e,t,r[e])},ku=function(e){e.translate&&(e.removeProperty("translate"),e.removeProperty("scale"),e.removeProperty("rotate"))},ym=function(){var e=this.props,t=this.target,s=t.style,i=t._gsap,r,o;for(r=0;r<e.length;r+=3)e[r+1]?t[e[r]]=e[r+2]:e[r+2]?s[e[r]]=e[r+2]:s.removeProperty(e[r].substr(0,2)==="--"?e[r]:e[r].replace(qa,"-$1").toLowerCase());if(this.tfm){for(o in this.tfm)i[o]=this.tfm[o];i.svg&&(i.renderTransform(),t.setAttribute("data-svg-origin",this.svgo||"")),r=Ha(),(!r||!r.isStart)&&!s[be]&&(ku(s),i.zOrigin&&s[at]&&(s[at]+=" "+i.zOrigin+"px",i.zOrigin=0,i.renderTransform()),i.uncache=1)}},Ru=function(e,t){var s={target:e,props:[],revert:ym,save:vm};return e._gsap||lt.core.getCache(e),t&&t.split(",").forEach(function(i){return s.save(i)}),s},Pu,aa=function(e,t){var s=Cs.createElementNS?Cs.createElementNS((t||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),e):Cs.createElement(e);return s&&s.style?s:Cs.createElement(e)},Wt=function n(e,t,s){var i=getComputedStyle(e);return i[t]||i.getPropertyValue(t.replace(qa,"-$1").toLowerCase())||i.getPropertyValue(t)||!s&&n(e,Vn(t)||t,1)||""},Xc="O,Moz,ms,Ms,Webkit".split(","),Vn=function(e,t,s){var i=t||Xs,r=i.style,o=5;if(e in r&&!s)return e;for(e=e.charAt(0).toUpperCase()+e.substr(1);o--&&!(Xc[o]+e in r););return o<0?null:(o===3?"ms":o>=0?Xc[o]:"")+e},ca=function(){om()&&window.document&&(jc=window,Cs=jc.document,kn=Cs.documentElement,Xs=aa("div")||{style:{}},aa("div"),be=Vn(be),at=be+"Origin",Xs.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",Pu=!!Vn("perspective"),Ha=lt.core.reverting,Va=1)},Ho=function n(e){var t=aa("svg",this.ownerSVGElement&&this.ownerSVGElement.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),s=this.parentNode,i=this.nextSibling,r=this.style.cssText,o;if(kn.appendChild(t),t.appendChild(this),this.style.display="block",e)try{o=this.getBBox(),this._gsapBBox=this.getBBox,this.getBBox=n}catch{}else this._gsapBBox&&(o=this._gsapBBox());return s&&(i?s.insertBefore(this,i):s.appendChild(this)),kn.removeChild(t),this.style.cssText=r,o},$c=function(e,t){for(var s=t.length;s--;)if(e.hasAttribute(t[s]))return e.getAttribute(t[s])},Nu=function(e){var t;try{t=e.getBBox()}catch{t=Ho.call(e,!0)}return t&&(t.width||t.height)||e.getBBox===Ho||(t=Ho.call(e,!0)),t&&!t.width&&!t.x&&!t.y?{x:+$c(e,["x","cx","x1"])||0,y:+$c(e,["y","cy","y1"])||0,width:0,height:0}:t},Iu=function(e){return!!(e.getCTM&&(!e.parentNode||e.ownerSVGElement)&&Nu(e))},rn=function(e,t){if(t){var s=e.style,i;t in ls&&t!==at&&(t=be),s.removeProperty?(i=t.substr(0,2),(i==="ms"||t.substr(0,6)==="webkit")&&(t="-"+t),s.removeProperty(i==="--"?t:t.replace(qa,"-$1").toLowerCase())):s.removeAttribute(t)}},Es=function(e,t,s,i,r,o){var a=new ot(e._pt,t,s,0,1,o?Du:Mu);return e._pt=a,a.b=i,a.e=r,e._props.push(s),a},Qc={deg:1,rad:1,turn:1},Tm={grid:1,flex:1},Rs=function n(e,t,s,i){var r=parseFloat(s)||0,o=(s+"").trim().substr((r+"").length)||"px",a=Xs.style,c=am.test(t),l=e.tagName.toLowerCase()==="svg",u=(l?"client":"offset")+(c?"Width":"Height"),h=100,d=i==="px",f=i==="%",m,p,_,y;if(i===o||!r||Qc[i]||Qc[o])return r;if(o!=="px"&&!d&&(r=n(e,t,s,"px")),y=e.getCTM&&Iu(e),(f||o==="%")&&(ls[t]||~t.indexOf("adius")))return m=y?e.getBBox()[c?"width":"height"]:e[u],De(f?r/m*h:r/100*m);if(a[c?"width":"height"]=h+(d?o:i),p=~t.indexOf("adius")||i==="em"&&e.appendChild&&!l?e:e.parentNode,y&&(p=(e.ownerSVGElement||{}).parentNode),(!p||p===Cs||!p.appendChild)&&(p=Cs.body),_=p._gsap,_&&f&&_.width&&c&&_.time===dt.time&&!_.uncache)return De(r/_.width*h);if(f&&(t==="height"||t==="width")){var S=e.style[t];e.style[t]=h+i,m=e[u],S?e.style[t]=S:rn(e,t)}else(f||o==="%")&&!Tm[Wt(p,"display")]&&(a.position=Wt(e,"position")),p===e&&(a.position="static"),p.appendChild(Xs),m=Xs[u],p.removeChild(Xs),a.position="absolute";return c&&f&&(_=Qs(p),_.time=dt.time,_.width=p[u]),De(d?m*r/h:m&&r?h/m*r:0)},ns=function(e,t,s,i){var r;return Va||ca(),t in qt&&t!=="transform"&&(t=qt[t],~t.indexOf(",")&&(t=t.split(",")[0])),ls[t]&&t!=="transform"?(r=Mi(e,i),r=t!=="transformOrigin"?r[t]:r.svg?r.origin:Ir(Wt(e,at))+" "+r.zOrigin+"px"):(r=e.style[t],(!r||r==="auto"||i||~(r+"").indexOf("calc("))&&(r=Nr[t]&&Nr[t](e,t,s)||Wt(e,t)||Ql(e,t)||(t==="opacity"?1:0))),s&&!~(r+"").trim().indexOf(" ")?Rs(e,t,r,s)+s:r},xm=function(e,t,s,i){if(!s||s==="none"){var r=Vn(t,e,1),o=r&&Wt(e,r,1);o&&o!==s?(t=r,s=o):t==="borderColor"&&(s=Wt(e,"borderTopColor"))}var a=new ot(this._pt,e.style,t,0,1,Eu),c=0,l=0,u,h,d,f,m,p,_,y,S,b,v,g;if(a.b=s,a.e=i,s+="",i+="",i==="auto"&&(p=e.style[t],e.style[t]=i,i=Wt(e,t)||i,p?e.style[t]=p:rn(e,t)),u=[s,i],_u(u),s=u[0],i=u[1],d=s.match(Cn)||[],g=i.match(Cn)||[],g.length){for(;h=Cn.exec(i);)_=h[0],S=i.substring(c,h.index),m?m=(m+1)%5:(S.substr(-5)==="rgba("||S.substr(-5)==="hsla(")&&(m=1),_!==(p=d[l++]||"")&&(f=parseFloat(p)||0,v=p.substr((f+"").length),_.charAt(1)==="="&&(_=Dn(f,_)+v),y=parseFloat(_),b=_.substr((y+"").length),c=Cn.lastIndex-b.length,b||(b=b||pt.units[t]||v,c===i.length&&(i+=b,a.e+=b)),v!==b&&(f=Rs(e,t,p,b)||0),a._pt={_next:a._pt,p:S||l===1?S:",",s:f,c:y-f,m:m&&m<4||t==="zIndex"?Math.round:0});a.c=c<i.length?i.substring(c,i.length):""}else a.r=t==="display"&&i==="none"?Du:Mu;return Gl.test(i)&&(a.e=0),this._pt=a,a},Kc={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},wm=function(e){var t=e.split(" "),s=t[0],i=t[1]||"50%";return(s==="top"||s==="bottom"||i==="left"||i==="right")&&(e=s,s=i,i=e),t[0]=Kc[s]||s,t[1]=Kc[i]||i,t.join(" ")},Sm=function(e,t){if(t.tween&&t.tween._time===t.tween._dur){var s=t.t,i=s.style,r=t.u,o=s._gsap,a,c,l;if(r==="all"||r===!0)i.cssText="",c=1;else for(r=r.split(","),l=r.length;--l>-1;)a=r[l],ls[a]&&(c=1,a=a==="transformOrigin"?at:be),rn(s,a);c&&(rn(s,be),o&&(o.svg&&s.removeAttribute("transform"),Mi(s,1),o.uncache=1,ku(i)))}},Nr={clearProps:function(e,t,s,i,r){if(r.data!=="isFromStart"){var o=e._pt=new ot(e._pt,t,s,0,0,Sm);return o.u=i,o.pr=-10,o.tween=r,e._props.push(s),1}}},Ai=[1,0,0,1,0,0],Fu={},Uu=function(e){return e==="matrix(1, 0, 0, 1, 0, 0)"||e==="none"||!e},Jc=function(e){var t=Wt(e,be);return Uu(t)?Ai:t.substr(7).match(Wl).map(De)},Wa=function(e,t){var s=e._gsap||Qs(e),i=e.style,r=Jc(e),o,a,c,l;return s.svg&&e.getAttribute("transform")?(c=e.transform.baseVal.consolidate().matrix,r=[c.a,c.b,c.c,c.d,c.e,c.f],r.join(",")==="1,0,0,1,0,0"?Ai:r):(r===Ai&&!e.offsetParent&&e!==kn&&!s.svg&&(c=i.display,i.display="block",o=e.parentNode,(!o||!e.offsetParent)&&(l=1,a=e.nextElementSibling,kn.appendChild(e)),r=Jc(e),c?i.display=c:rn(e,"display"),l&&(a?o.insertBefore(e,a):o?o.appendChild(e):kn.removeChild(e))),t&&r.length>6?[r[0],r[1],r[4],r[5],r[12],r[13]]:r)},la=function(e,t,s,i,r,o){var a=e._gsap,c=r||Wa(e,!0),l=a.xOrigin||0,u=a.yOrigin||0,h=a.xOffset||0,d=a.yOffset||0,f=c[0],m=c[1],p=c[2],_=c[3],y=c[4],S=c[5],b=t.split(" "),v=parseFloat(b[0])||0,g=parseFloat(b[1])||0,x,T,w,C;s?c!==Ai&&(T=f*_-m*p)&&(w=v*(_/T)+g*(-p/T)+(p*S-_*y)/T,C=v*(-m/T)+g*(f/T)-(f*S-m*y)/T,v=w,g=C):(x=Nu(e),v=x.x+(~b[0].indexOf("%")?v/100*x.width:v),g=x.y+(~(b[1]||b[0]).indexOf("%")?g/100*x.height:g)),i||i!==!1&&a.smooth?(y=v-l,S=g-u,a.xOffset=h+(y*f+S*p)-y,a.yOffset=d+(y*m+S*_)-S):a.xOffset=a.yOffset=0,a.xOrigin=v,a.yOrigin=g,a.smooth=!!i,a.origin=t,a.originIsAbsolute=!!s,e.style[at]="0px 0px",o&&(Es(o,a,"xOrigin",l,v),Es(o,a,"yOrigin",u,g),Es(o,a,"xOffset",h,a.xOffset),Es(o,a,"yOffset",d,a.yOffset)),e.setAttribute("data-svg-origin",v+" "+g)},Mi=function(e,t){var s=e._gsap||new Tu(e);if("x"in s&&!t&&!s.uncache)return s;var i=e.style,r=s.scaleX<0,o="px",a="deg",c=getComputedStyle(e),l=Wt(e,at)||"0",u,h,d,f,m,p,_,y,S,b,v,g,x,T,w,C,E,O,A,D,R,I,N,F,z,B,q,V,L,ve,re,Z;return u=h=d=p=_=y=S=b=v=0,f=m=1,s.svg=!!(e.getCTM&&Iu(e)),c.translate&&((c.translate!=="none"||c.scale!=="none"||c.rotate!=="none")&&(i[be]=(c.translate!=="none"?"translate3d("+(c.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+(c.rotate!=="none"?"rotate("+c.rotate+") ":"")+(c.scale!=="none"?"scale("+c.scale.split(" ").join(",")+") ":"")+(c[be]!=="none"?c[be]:"")),i.scale=i.rotate=i.translate="none"),T=Wa(e,s.svg),s.svg&&(s.uncache?(z=e.getBBox(),l=s.xOrigin-z.x+"px "+(s.yOrigin-z.y)+"px",F=""):F=!t&&e.getAttribute("data-svg-origin"),la(e,F||l,!!F||s.originIsAbsolute,s.smooth!==!1,T)),g=s.xOrigin||0,x=s.yOrigin||0,T!==Ai&&(O=T[0],A=T[1],D=T[2],R=T[3],u=I=T[4],h=N=T[5],T.length===6?(f=Math.sqrt(O*O+A*A),m=Math.sqrt(R*R+D*D),p=O||A?wn(A,O)*Ys:0,S=D||R?wn(D,R)*Ys+p:0,S&&(m*=Math.abs(Math.cos(S*Rn))),s.svg&&(u-=g-(g*O+x*D),h-=x-(g*A+x*R))):(Z=T[6],ve=T[7],q=T[8],V=T[9],L=T[10],re=T[11],u=T[12],h=T[13],d=T[14],w=wn(Z,L),_=w*Ys,w&&(C=Math.cos(-w),E=Math.sin(-w),F=I*C+q*E,z=N*C+V*E,B=Z*C+L*E,q=I*-E+q*C,V=N*-E+V*C,L=Z*-E+L*C,re=ve*-E+re*C,I=F,N=z,Z=B),w=wn(-D,L),y=w*Ys,w&&(C=Math.cos(-w),E=Math.sin(-w),F=O*C-q*E,z=A*C-V*E,B=D*C-L*E,re=R*E+re*C,O=F,A=z,D=B),w=wn(A,O),p=w*Ys,w&&(C=Math.cos(w),E=Math.sin(w),F=O*C+A*E,z=I*C+N*E,A=A*C-O*E,N=N*C-I*E,O=F,I=z),_&&Math.abs(_)+Math.abs(p)>359.9&&(_=p=0,y=180-y),f=De(Math.sqrt(O*O+A*A+D*D)),m=De(Math.sqrt(N*N+Z*Z)),w=wn(I,N),S=Math.abs(w)>2e-4?w*Ys:0,v=re?1/(re<0?-re:re):0),s.svg&&(F=e.getAttribute("transform"),s.forceCSS=e.setAttribute("transform","")||!Uu(Wt(e,be)),F&&e.setAttribute("transform",F))),Math.abs(S)>90&&Math.abs(S)<270&&(r?(f*=-1,S+=p<=0?180:-180,p+=p<=0?180:-180):(m*=-1,S+=S<=0?180:-180)),t=t||s.uncache,s.x=u-((s.xPercent=u&&(!t&&s.xPercent||(Math.round(e.offsetWidth/2)===Math.round(-u)?-50:0)))?e.offsetWidth*s.xPercent/100:0)+o,s.y=h-((s.yPercent=h&&(!t&&s.yPercent||(Math.round(e.offsetHeight/2)===Math.round(-h)?-50:0)))?e.offsetHeight*s.yPercent/100:0)+o,s.z=d+o,s.scaleX=De(f),s.scaleY=De(m),s.rotation=De(p)+a,s.rotationX=De(_)+a,s.rotationY=De(y)+a,s.skewX=S+a,s.skewY=b+a,s.transformPerspective=v+o,(s.zOrigin=parseFloat(l.split(" ")[2])||!t&&s.zOrigin||0)&&(i[at]=Ir(l)),s.xOffset=s.yOffset=0,s.force3D=pt.force3D,s.renderTransform=s.svg?Cm:Pu?Lu:bm,s.uncache=0,s},Ir=function(e){return(e=e.split(" "))[0]+" "+e[1]},qo=function(e,t,s){var i=je(t);return De(parseFloat(t)+parseFloat(Rs(e,"x",s+"px",i)))+i},bm=function(e,t){t.z="0px",t.rotationY=t.rotationX="0deg",t.force3D=0,Lu(e,t)},Gs="0deg",mi="0px",js=") ",Lu=function(e,t){var s=t||this,i=s.xPercent,r=s.yPercent,o=s.x,a=s.y,c=s.z,l=s.rotation,u=s.rotationY,h=s.rotationX,d=s.skewX,f=s.skewY,m=s.scaleX,p=s.scaleY,_=s.transformPerspective,y=s.force3D,S=s.target,b=s.zOrigin,v="",g=y==="auto"&&e&&e!==1||y===!0;if(b&&(h!==Gs||u!==Gs)){var x=parseFloat(u)*Rn,T=Math.sin(x),w=Math.cos(x),C;x=parseFloat(h)*Rn,C=Math.cos(x),o=qo(S,o,T*C*-b),a=qo(S,a,-Math.sin(x)*-b),c=qo(S,c,w*C*-b+b)}_!==mi&&(v+="perspective("+_+js),(i||r)&&(v+="translate("+i+"%, "+r+"%) "),(g||o!==mi||a!==mi||c!==mi)&&(v+=c!==mi||g?"translate3d("+o+", "+a+", "+c+") ":"translate("+o+", "+a+js),l!==Gs&&(v+="rotate("+l+js),u!==Gs&&(v+="rotateY("+u+js),h!==Gs&&(v+="rotateX("+h+js),(d!==Gs||f!==Gs)&&(v+="skew("+d+", "+f+js),(m!==1||p!==1)&&(v+="scale("+m+", "+p+js),S.style[be]=v||"translate(0, 0)"},Cm=function(e,t){var s=t||this,i=s.xPercent,r=s.yPercent,o=s.x,a=s.y,c=s.rotation,l=s.skewX,u=s.skewY,h=s.scaleX,d=s.scaleY,f=s.target,m=s.xOrigin,p=s.yOrigin,_=s.xOffset,y=s.yOffset,S=s.forceCSS,b=parseFloat(o),v=parseFloat(a),g,x,T,w,C;c=parseFloat(c),l=parseFloat(l),u=parseFloat(u),u&&(u=parseFloat(u),l+=u,c+=u),c||l?(c*=Rn,l*=Rn,g=Math.cos(c)*h,x=Math.sin(c)*h,T=Math.sin(c-l)*-d,w=Math.cos(c-l)*d,l&&(u*=Rn,C=Math.tan(l-u),C=Math.sqrt(1+C*C),T*=C,w*=C,u&&(C=Math.tan(u),C=Math.sqrt(1+C*C),g*=C,x*=C)),g=De(g),x=De(x),T=De(T),w=De(w)):(g=h,w=d,x=T=0),(b&&!~(o+"").indexOf("px")||v&&!~(a+"").indexOf("px"))&&(b=Rs(f,"x",o,"px"),v=Rs(f,"y",a,"px")),(m||p||_||y)&&(b=De(b+m-(m*g+p*T)+_),v=De(v+p-(m*x+p*w)+y)),(i||r)&&(C=f.getBBox(),b=De(b+i/100*C.width),v=De(v+r/100*C.height)),C="matrix("+g+","+x+","+T+","+w+","+b+","+v+")",f.setAttribute("transform",C),S&&(f.style[be]=C)},Em=function(e,t,s,i,r){var o=360,a=qe(r),c=parseFloat(r)*(a&&~r.indexOf("rad")?Ys:1),l=c-i,u=i+l+"deg",h,d;return a&&(h=r.split("_")[1],h==="short"&&(l%=o,l!==l%(o/2)&&(l+=l<0?o:-o)),h==="cw"&&l<0?l=(l+o*Zc)%o-~~(l/o)*o:h==="ccw"&&l>0&&(l=(l-o*Zc)%o-~~(l/o)*o)),e._pt=d=new ot(e._pt,t,s,i,l,lm),d.e=u,d.u="deg",e._props.push(s),d},el=function(e,t){for(var s in t)e[s]=t[s];return e},Om=function(e,t,s){var i=el({},s._gsap),r="perspective,force3D,transformOrigin,svgOrigin",o=s.style,a,c,l,u,h,d,f,m;i.svg?(l=s.getAttribute("transform"),s.setAttribute("transform",""),o[be]=t,a=Mi(s,1),rn(s,be),s.setAttribute("transform",l)):(l=getComputedStyle(s)[be],o[be]=t,a=Mi(s,1),o[be]=l);for(c in ls)l=i[c],u=a[c],l!==u&&r.indexOf(c)<0&&(f=je(l),m=je(u),h=f!==m?Rs(s,c,l,m):parseFloat(l),d=parseFloat(u),e._pt=new ot(e._pt,a,c,h,d-h,oa),e._pt.u=m||0,e._props.push(c));el(a,i)};rt("padding,margin,Width,Radius",function(n,e){var t="Top",s="Right",i="Bottom",r="Left",o=(e<3?[t,s,i,r]:[t+r,t+s,i+s,i+r]).map(function(a){return e<2?n+a:"border"+a+n});Nr[e>1?"border"+n:n]=function(a,c,l,u,h){var d,f;if(arguments.length<4)return d=o.map(function(m){return ns(a,m,l)}),f=d.join(" "),f.split(d[0]).length===5?d[0]:f;d=(u+"").split(" "),f={},o.forEach(function(m,p){return f[m]=d[p]=d[p]||d[(p-1)/2|0]}),a.init(c,f,h)}});var Bu={name:"css",register:ca,targetTest:function(e){return e.style&&e.nodeType},init:function(e,t,s,i,r){var o=this._props,a=e.style,c=s.vars.startAt,l,u,h,d,f,m,p,_,y,S,b,v,g,x,T,w;Va||ca(),this.styles=this.styles||Ru(e),w=this.styles.props,this.tween=s;for(p in t)if(p!=="autoRound"&&(u=t[p],!(ht[p]&&xu(p,t,s,i,e,r)))){if(f=typeof u,m=Nr[p],f==="function"&&(u=u.call(s,i,e,r),f=typeof u),f==="string"&&~u.indexOf("random(")&&(u=Ci(u)),m)m(this,e,p,u,s)&&(T=1);else if(p.substr(0,2)==="--")l=(getComputedStyle(e).getPropertyValue(p)+"").trim(),u+="",Ms.lastIndex=0,Ms.test(l)||(_=je(l),y=je(u)),y?_!==y&&(l=Rs(e,p,l,y)+y):_&&(u+=_),this.add(a,"setProperty",l,u,i,r,0,0,p),o.push(p),w.push(p,0,a[p]);else if(f!=="undefined"){if(c&&p in c?(l=typeof c[p]=="function"?c[p].call(s,i,e,r):c[p],qe(l)&&~l.indexOf("random(")&&(l=Ci(l)),je(l+"")||l==="auto"||(l+=pt.units[p]||je(ns(e,p))||""),(l+"").charAt(1)==="="&&(l=ns(e,p))):l=ns(e,p),d=parseFloat(l),S=f==="string"&&u.charAt(1)==="="&&u.substr(0,2),S&&(u=u.substr(2)),h=parseFloat(u),p in qt&&(p==="autoAlpha"&&(d===1&&ns(e,"visibility")==="hidden"&&h&&(d=0),w.push("visibility",0,a.visibility),Es(this,a,"visibility",d?"inherit":"hidden",h?"inherit":"hidden",!h)),p!=="scale"&&p!=="transform"&&(p=qt[p],~p.indexOf(",")&&(p=p.split(",")[0]))),b=p in ls,b){if(this.styles.save(p),v||(g=e._gsap,g.renderTransform&&!t.parseTransform||Mi(e,t.parseTransform),x=t.smoothOrigin!==!1&&g.smooth,v=this._pt=new ot(this._pt,a,be,0,1,g.renderTransform,g,0,-1),v.dep=1),p==="scale")this._pt=new ot(this._pt,g,"scaleY",g.scaleY,(S?Dn(g.scaleY,S+h):h)-g.scaleY||0,oa),this._pt.u=0,o.push("scaleY",p),p+="X";else if(p==="transformOrigin"){w.push(at,0,a[at]),u=wm(u),g.svg?la(e,u,0,x,0,this):(y=parseFloat(u.split(" ")[2])||0,y!==g.zOrigin&&Es(this,g,"zOrigin",g.zOrigin,y),Es(this,a,p,Ir(l),Ir(u)));continue}else if(p==="svgOrigin"){la(e,u,1,x,0,this);continue}else if(p in Fu){Em(this,g,p,d,S?Dn(d,S+u):u);continue}else if(p==="smoothOrigin"){Es(this,g,"smooth",g.smooth,u);continue}else if(p==="force3D"){g[p]=u;continue}else if(p==="transform"){Om(this,u,e);continue}}else p in a||(p=Vn(p)||p);if(b||(h||h===0)&&(d||d===0)&&!cm.test(u)&&p in a)_=(l+"").substr((d+"").length),h||(h=0),y=je(u)||(p in pt.units?pt.units[p]:_),_!==y&&(d=Rs(e,p,l,y)),this._pt=new ot(this._pt,b?g:a,p,d,(S?Dn(d,S+h):h)-d,!b&&(y==="px"||p==="zIndex")&&t.autoRound!==!1?hm:oa),this._pt.u=y||0,_!==y&&y!=="%"&&(this._pt.b=l,this._pt.r=um);else if(p in a)xm.call(this,e,p,l,S?S+u:u);else if(p in e)this.add(e,p,l||e[p],S?S+u:u,i,r);else if(p!=="parseTransform"){Ra(p,u);continue}b||(p in a?w.push(p,0,a[p]):w.push(p,1,l||e[p])),o.push(p)}}T&&Ou(this)},render:function(e,t){if(t.tween._time||!Ha())for(var s=t._pt;s;)s.r(e,s.d),s=s._next;else t.styles.revert()},get:ns,aliases:qt,getSetter:function(e,t,s){var i=qt[t];return i&&i.indexOf(",")<0&&(t=i),t in ls&&t!==at&&(e._gsap.x||ns(e,"x"))?s&&Yc===s?t==="scale"?mm:pm:(Yc=s||{})&&(t==="scale"?_m:gm):e.style&&!Ma(e.style[t])?dm:~t.indexOf("-")?fm:Ba(e,t)},core:{_removeProperty:rn,_getMatrix:Wa}};lt.utils.checkPrefix=Vn;lt.core.getStyleSaver=Ru;(function(n,e,t,s){var i=rt(n+","+e+","+t,function(r){ls[r]=1});rt(e,function(r){pt.units[r]="deg",Fu[r]=1}),qt[i[13]]=n+","+e,rt(s,function(r){var o=r.split(":");qt[o[1]]=i[o[0]]})})("x,y,z,scale,scaleX,scaleY,xPercent,yPercent","rotation,rotationX,rotationY,skewX,skewY","transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective","0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY");rt("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function(n){pt.units[n]="px"});lt.registerPlugin(Bu);var Am=lt.registerPlugin(Bu)||lt;Am.core.Tween;const zu="14.8.49",tl=(n,e,t)=>({endTime:e,insertTime:t,type:"exponentialRampToValue",value:n}),sl=(n,e,t)=>({endTime:e,insertTime:t,type:"linearRampToValue",value:n}),ua=(n,e)=>({startTime:e,type:"setValue",value:n}),Vu=(n,e,t)=>({duration:t,startTime:e,type:"setValueCurve",values:n}),Hu=(n,e,{startTime:t,target:s,timeConstant:i})=>s+(e-s)*Math.exp((t-n)/i),On=n=>n.type==="exponentialRampToValue",Fr=n=>n.type==="linearRampToValue",ws=n=>On(n)||Fr(n),Ga=n=>n.type==="setValue",ss=n=>n.type==="setValueCurve",Ur=(n,e,t,s)=>{const i=n[e];return i===void 0?s:ws(i)||Ga(i)?i.value:ss(i)?i.values[i.values.length-1]:Hu(t,Ur(n,e-1,i.startTime,s),i)},nl=(n,e,t,s,i)=>t===void 0?[s.insertTime,i]:ws(t)?[t.endTime,t.value]:Ga(t)?[t.startTime,t.value]:ss(t)?[t.startTime+t.duration,t.values[t.values.length-1]]:[t.startTime,Ur(n,e-1,t.startTime,i)],ha=n=>n.type==="cancelAndHold",da=n=>n.type==="cancelScheduledValues",Ts=n=>ha(n)||da(n)?n.cancelTime:On(n)||Fr(n)?n.endTime:n.startTime,il=(n,e,t,{endTime:s,value:i})=>t===i?i:0<t&&0<i||t<0&&i<0?t*(i/t)**((n-e)/(s-e)):0,rl=(n,e,t,{endTime:s,value:i})=>t+(n-e)/(s-e)*(i-t),Mm=(n,e)=>{const t=Math.floor(e),s=Math.ceil(e);return t===s?n[t]:(1-(e-t))*n[t]+(1-(s-e))*n[s]},Dm=(n,{duration:e,startTime:t,values:s})=>{const i=(n-t)/e*(s.length-1);return Mm(s,i)},yr=n=>n.type==="setTarget";class km{constructor(e){this._automationEvents=[],this._currenTime=0,this._defaultValue=e}[Symbol.iterator](){return this._automationEvents[Symbol.iterator]()}add(e){const t=Ts(e);if(ha(e)||da(e)){const s=this._automationEvents.findIndex(r=>da(e)&&ss(r)?r.startTime+r.duration>=t:Ts(r)>=t),i=this._automationEvents[s];if(s!==-1&&(this._automationEvents=this._automationEvents.slice(0,s)),ha(e)){const r=this._automationEvents[this._automationEvents.length-1];if(i!==void 0&&ws(i)){if(r!==void 0&&yr(r))throw new Error("The internal list is malformed.");const o=r===void 0?i.insertTime:ss(r)?r.startTime+r.duration:Ts(r),a=r===void 0?this._defaultValue:ss(r)?r.values[r.values.length-1]:r.value,c=On(i)?il(t,o,a,i):rl(t,o,a,i),l=On(i)?tl(c,t,this._currenTime):sl(c,t,this._currenTime);this._automationEvents.push(l)}if(r!==void 0&&yr(r)&&this._automationEvents.push(ua(this.getValue(t),t)),r!==void 0&&ss(r)&&r.startTime+r.duration>t){const o=t-r.startTime,a=(r.values.length-1)/r.duration,c=Math.max(2,1+Math.ceil(o*a)),l=o/(c-1)*a,u=r.values.slice(0,c);if(l<1)for(let h=1;h<c;h+=1){const d=l*h%1;u[h]=r.values[h-1]*(1-d)+r.values[h]*d}this._automationEvents[this._automationEvents.length-1]=Vu(u,r.startTime,o)}}}else{const s=this._automationEvents.findIndex(o=>Ts(o)>t),i=s===-1?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[s-1];if(i!==void 0&&ss(i)&&Ts(i)+i.duration>t)return!1;const r=On(e)?tl(e.value,e.endTime,this._currenTime):Fr(e)?sl(e.value,t,this._currenTime):e;if(s===-1)this._automationEvents.push(r);else{if(ss(e)&&t+e.duration>Ts(this._automationEvents[s]))return!1;this._automationEvents.splice(s,0,r)}}return!0}flush(e){const t=this._automationEvents.findIndex(s=>Ts(s)>e);if(t>1){const s=this._automationEvents.slice(t-1),i=s[0];yr(i)&&s.unshift(ua(Ur(this._automationEvents,t-2,i.startTime,this._defaultValue),i.startTime)),this._automationEvents=s}}getValue(e){if(this._automationEvents.length===0)return this._defaultValue;const t=this._automationEvents.findIndex(o=>Ts(o)>e),s=this._automationEvents[t],i=(t===-1?this._automationEvents.length:t)-1,r=this._automationEvents[i];if(r!==void 0&&yr(r)&&(s===void 0||!ws(s)||s.insertTime>e))return Hu(e,Ur(this._automationEvents,i-1,r.startTime,this._defaultValue),r);if(r!==void 0&&Ga(r)&&(s===void 0||!ws(s)))return r.value;if(r!==void 0&&ss(r)&&(s===void 0||!ws(s)||r.startTime+r.duration>e))return e<r.startTime+r.duration?Dm(e,r):r.values[r.values.length-1];if(r!==void 0&&ws(r)&&(s===void 0||!ws(s)))return r.value;if(s!==void 0&&On(s)){const[o,a]=nl(this._automationEvents,i,r,s,this._defaultValue);return il(e,o,a,s)}if(s!==void 0&&Fr(s)){const[o,a]=nl(this._automationEvents,i,r,s,this._defaultValue);return rl(e,o,a,s)}return this._defaultValue}}const Rm=n=>({cancelTime:n,type:"cancelAndHold"}),Pm=n=>({cancelTime:n,type:"cancelScheduledValues"}),Nm=(n,e)=>({endTime:e,type:"exponentialRampToValue",value:n}),Im=(n,e)=>({endTime:e,type:"linearRampToValue",value:n}),Fm=(n,e,t)=>({startTime:e,target:n,timeConstant:t,type:"setTarget"}),Um=()=>new DOMException("","AbortError"),Lm=n=>(e,t,[s,i,r],o)=>{n(e[i],[t,s,r],a=>a[0]===t&&a[1]===s,o)},Bm=n=>(e,t,s)=>{const i=[];for(let r=0;r<s.numberOfInputs;r+=1)i.push(new Set);n.set(e,{activeInputs:i,outputs:new Set,passiveInputs:new WeakMap,renderer:t})},zm=n=>(e,t)=>{n.set(e,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:t})},Hn=new WeakSet,qu=new WeakMap,ja=new WeakMap,Wu=new WeakMap,Ya=new WeakMap,lo=new WeakMap,Gu=new WeakMap,fa=new WeakMap,pa=new WeakMap,ma=new WeakMap,ju={construct(){return ju}},Vm=n=>{try{const e=new Proxy(n,ju);new e}catch{return!1}return!0},ol=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,al=(n,e)=>{const t=[];let s=n.replace(/^[\s]+/,""),i=s.match(ol);for(;i!==null;){const r=i[1].slice(1,-1),o=i[0].replace(/([\s]+)?;?$/,"").replace(r,new URL(r,e).toString());t.push(o),s=s.slice(i[0].length).replace(/^[\s]+/,""),i=s.match(ol)}return[t.join(";"),s]},cl=n=>{if(n!==void 0&&!Array.isArray(n))throw new TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},ll=n=>{if(!Vm(n))throw new TypeError("The given value for processorCtor should be a constructor.");if(n.prototype===null||typeof n.prototype!="object")throw new TypeError("The given value for processorCtor should have a prototype.")},Hm=(n,e,t,s,i,r,o,a,c,l,u,h,d)=>{let f=0;return(m,p,_={credentials:"omit"})=>{const y=u.get(m);if(y!==void 0&&y.has(p))return Promise.resolve();const S=l.get(m);if(S!==void 0){const g=S.get(p);if(g!==void 0)return g}const b=r(m),v=b.audioWorklet===void 0?i(p).then(([g,x])=>{const[T,w]=al(g,x),C=`${T};((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{${w}
})})(window,'_AWGS')`;return t(C)}).then(()=>{const g=d._AWGS.pop();if(g===void 0)throw new SyntaxError;s(b.currentTime,b.sampleRate,()=>g(class{},void 0,(x,T)=>{if(x.trim()==="")throw e();const w=pa.get(b);if(w!==void 0){if(w.has(x))throw e();ll(T),cl(T.parameterDescriptors),w.set(x,T)}else ll(T),cl(T.parameterDescriptors),pa.set(b,new Map([[x,T]]))},b.sampleRate,void 0,void 0))}):Promise.all([i(p),Promise.resolve(n(h,h))]).then(([[g,x],T])=>{const w=f+1;f=w;const[C,E]=al(g,x),R=`${C};((AudioWorkletProcessor,registerProcessor)=>{${E}
})(${T?"AudioWorkletProcessor":"class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}"},(n,p)=>registerProcessor(n,class extends p{${T?"":"__c = (a) => a.forEach(e=>this.__b.add(e.buffer));"}process(i,o,p){${T?"":"i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));"}return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}));registerProcessor('__sac${w}',class extends AudioWorkletProcessor{process(){return !1}})`,I=new Blob([R],{type:"application/javascript; charset=utf-8"}),N=URL.createObjectURL(I);return b.audioWorklet.addModule(N,_).then(()=>{if(a(b))return b;const F=o(b);return F.audioWorklet.addModule(N,_).then(()=>F)}).then(F=>{if(c===null)throw new SyntaxError;try{new c(F,`__sac${w}`)}catch{throw new SyntaxError}}).finally(()=>URL.revokeObjectURL(N))});return S===void 0?l.set(m,new Map([[p,v]])):S.set(p,v),v.then(()=>{const g=u.get(m);g===void 0?u.set(m,new Set([p])):g.add(p)}).finally(()=>{const g=l.get(m);g!==void 0&&g.delete(p)}),v}},Nt=(n,e)=>{const t=n.get(e);if(t===void 0)throw new Error("A value with the given key could not be found.");return t},uo=(n,e)=>{const t=Array.from(n).filter(e);if(t.length>1)throw Error("More than one element was found.");if(t.length===0)throw Error("No element was found.");const[s]=t;return n.delete(s),s},Yu=(n,e,t,s)=>{const i=Nt(n,e),r=uo(i,o=>o[0]===t&&o[1]===s);return i.size===0&&n.delete(e),r},Qi=n=>Nt(Gu,n),qn=n=>{if(Hn.has(n))throw new Error("The AudioNode is already stored.");Hn.add(n),Qi(n).forEach(e=>e(!0))},Zu=n=>"port"in n,Ki=n=>{if(!Hn.has(n))throw new Error("The AudioNode is not stored.");Hn.delete(n),Qi(n).forEach(e=>e(!1))},_a=(n,e)=>{!Zu(n)&&e.every(t=>t.size===0)&&Ki(n)},qm=(n,e,t,s,i,r,o,a,c,l,u,h,d)=>{const f=new WeakMap;return(m,p,_,y,S)=>{const{activeInputs:b,passiveInputs:v}=r(p),{outputs:g}=r(m),x=a(m),T=w=>{const C=c(p),E=c(m);if(w){const O=Yu(v,m,_,y);n(b,m,O,!1),!S&&!h(m)&&t(E,C,_,y),d(p)&&qn(p)}else{const O=s(b,m,_,y);e(v,y,O,!1),!S&&!h(m)&&i(E,C,_,y);const A=o(p);if(A===0)u(p)&&_a(p,b);else{const D=f.get(p);D!==void 0&&clearTimeout(D),f.set(p,setTimeout(()=>{u(p)&&_a(p,b)},A*1e3))}}};return l(g,[p,_,y],w=>w[0]===p&&w[1]===_&&w[2]===y,!0)?(x.add(T),u(m)?n(b,m,[_,y,T],!0):e(v,y,[m,_,T],!0),!0):!1}},Wm=n=>(e,t,[s,i,r],o)=>{const a=e.get(s);a===void 0?e.set(s,new Set([[i,t,r]])):n(a,[i,t,r],c=>c[0]===i&&c[1]===t,o)},Gm=n=>(e,t)=>{const s=n(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});t.connect(s).connect(e.destination);const i=()=>{t.removeEventListener("ended",i),t.disconnect(s),s.disconnect()};t.addEventListener("ended",i)},jm=n=>(e,t)=>{n(e).add(t)},Ym={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",fftSize:2048,maxDecibels:-30,minDecibels:-100,smoothingTimeConstant:.8},Zm=(n,e,t,s,i,r)=>class extends n{constructor(a,c){const l=i(a),u={...Ym,...c},h=s(l,u),d=r(l)?e():null;super(a,!1,h,d),this._nativeAnalyserNode=h}get fftSize(){return this._nativeAnalyserNode.fftSize}set fftSize(a){this._nativeAnalyserNode.fftSize=a}get frequencyBinCount(){return this._nativeAnalyserNode.frequencyBinCount}get maxDecibels(){return this._nativeAnalyserNode.maxDecibels}set maxDecibels(a){const c=this._nativeAnalyserNode.maxDecibels;if(this._nativeAnalyserNode.maxDecibels=a,!(a>this._nativeAnalyserNode.minDecibels))throw this._nativeAnalyserNode.maxDecibels=c,t()}get minDecibels(){return this._nativeAnalyserNode.minDecibels}set minDecibels(a){const c=this._nativeAnalyserNode.minDecibels;if(this._nativeAnalyserNode.minDecibels=a,!(this._nativeAnalyserNode.maxDecibels>a))throw this._nativeAnalyserNode.minDecibels=c,t()}get smoothingTimeConstant(){return this._nativeAnalyserNode.smoothingTimeConstant}set smoothingTimeConstant(a){this._nativeAnalyserNode.smoothingTimeConstant=a}getByteFrequencyData(a){this._nativeAnalyserNode.getByteFrequencyData(a)}getByteTimeDomainData(a){this._nativeAnalyserNode.getByteTimeDomainData(a)}getFloatFrequencyData(a){this._nativeAnalyserNode.getFloatFrequencyData(a)}getFloatTimeDomainData(a){this._nativeAnalyserNode.getFloatTimeDomainData(a)}},$e=(n,e)=>n.context===e,Xm=(n,e,t)=>()=>{const s=new WeakMap,i=async(r,o)=>{let a=e(r);if(!$e(a,o)){const l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,fftSize:a.fftSize,maxDecibels:a.maxDecibels,minDecibels:a.minDecibels,smoothingTimeConstant:a.smoothingTimeConstant};a=n(o,l)}return s.set(o,a),await t(r,o,a),a};return{render(r,o){const a=s.get(o);return a!==void 0?Promise.resolve(a):i(r,o)}}},Lr=n=>{try{n.copyToChannel(new Float32Array(1),0,-1)}catch{return!1}return!0},Zt=()=>new DOMException("","IndexSizeError"),Za=n=>{n.getChannelData=(e=>t=>{try{return e.call(n,t)}catch(s){throw s.code===12?Zt():s}})(n.getChannelData)},$m={numberOfChannels:1},Qm=(n,e,t,s,i,r,o,a)=>{let c=null;return class Xu{constructor(u){if(i===null)throw new Error("Missing the native OfflineAudioContext constructor.");const{length:h,numberOfChannels:d,sampleRate:f}={...$m,...u};c===null&&(c=new i(1,1,44100));const m=s!==null&&e(r,r)?new s({length:h,numberOfChannels:d,sampleRate:f}):c.createBuffer(d,h,f);if(m.numberOfChannels===0)throw t();return typeof m.copyFromChannel!="function"?(o(m),Za(m)):e(Lr,()=>Lr(m))||a(m),n.add(m),m}static[Symbol.hasInstance](u){return u!==null&&typeof u=="object"&&Object.getPrototypeOf(u)===Xu.prototype||n.has(u)}}},nt=-34028234663852886e22,Qe=-nt,os=n=>Hn.has(n),Km={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},Jm=(n,e,t,s,i,r,o,a)=>class extends n{constructor(l,u){const h=r(l),d={...Km,...u},f=i(h,d),m=o(h),p=m?e():null;super(l,!1,f,p),this._audioBufferSourceNodeRenderer=p,this._isBufferNullified=!1,this._isBufferSet=d.buffer!==null,this._nativeAudioBufferSourceNode=f,this._onended=null,this._playbackRate=t(this,m,f.playbackRate,Qe,nt)}get buffer(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer}set buffer(l){if(this._nativeAudioBufferSourceNode.buffer=l,l!==null){if(this._isBufferSet)throw s();this._isBufferSet=!0}}get loop(){return this._nativeAudioBufferSourceNode.loop}set loop(l){this._nativeAudioBufferSourceNode.loop=l}get loopEnd(){return this._nativeAudioBufferSourceNode.loopEnd}set loopEnd(l){this._nativeAudioBufferSourceNode.loopEnd=l}get loopStart(){return this._nativeAudioBufferSourceNode.loopStart}set loopStart(l){this._nativeAudioBufferSourceNode.loopStart=l}get onended(){return this._onended}set onended(l){const u=typeof l=="function"?a(this,l):null;this._nativeAudioBufferSourceNode.onended=u;const h=this._nativeAudioBufferSourceNode.onended;this._onended=h!==null&&h===u?l:h}get playbackRate(){return this._playbackRate}start(l=0,u=0,h){if(this._nativeAudioBufferSourceNode.start(l,u,h),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.start=h===void 0?[l,u]:[l,u,h]),this.context.state!=="closed"){qn(this);const d=()=>{this._nativeAudioBufferSourceNode.removeEventListener("ended",d),os(this)&&Ki(this)};this._nativeAudioBufferSourceNode.addEventListener("ended",d)}}stop(l=0){this._nativeAudioBufferSourceNode.stop(l),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.stop=l)}},e_=(n,e,t,s,i)=>()=>{const r=new WeakMap;let o=null,a=null;const c=async(l,u)=>{let h=t(l);const d=$e(h,u);if(!d){const f={buffer:h.buffer,channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,loop:h.loop,loopEnd:h.loopEnd,loopStart:h.loopStart,playbackRate:h.playbackRate.value};h=e(u,f),o!==null&&h.start(...o),a!==null&&h.stop(a)}return r.set(u,h),d?await n(u,l.playbackRate,h.playbackRate):await s(u,l.playbackRate,h.playbackRate),await i(l,u,h),h};return{set start(l){o=l},set stop(l){a=l},render(l,u){const h=r.get(u);return h!==void 0?Promise.resolve(h):c(l,u)}}},t_=n=>"playbackRate"in n,s_=n=>"frequency"in n&&"gain"in n,n_=n=>"offset"in n,i_=n=>!("frequency"in n)&&"gain"in n,r_=n=>"detune"in n&&"frequency"in n,o_=n=>"pan"in n,Je=n=>Nt(qu,n),Ji=n=>Nt(Wu,n),ga=(n,e)=>{const{activeInputs:t}=Je(n);t.forEach(i=>i.forEach(([r])=>{e.includes(n)||ga(r,[...e,n])}));const s=t_(n)?[n.playbackRate]:Zu(n)?Array.from(n.parameters.values()):s_(n)?[n.Q,n.detune,n.frequency,n.gain]:n_(n)?[n.offset]:i_(n)?[n.gain]:r_(n)?[n.detune,n.frequency]:o_(n)?[n.pan]:[];for(const i of s){const r=Ji(i);r!==void 0&&r.activeInputs.forEach(([o])=>ga(o,e))}os(n)&&Ki(n)},$u=n=>{ga(n.destination,[])},a_=n=>n===void 0||typeof n=="number"||typeof n=="string"&&(n==="balanced"||n==="interactive"||n==="playback"),c_=(n,e,t,s,i,r,o,a,c)=>class extends n{constructor(u={}){if(c===null)throw new Error("Missing the native AudioContext constructor.");let h;try{h=new c(u)}catch(m){throw m.code===12&&m.message==="sampleRate is not in range"?t():m}if(h===null)throw s();if(!a_(u.latencyHint))throw new TypeError(`The provided value '${u.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(u.sampleRate!==void 0&&h.sampleRate!==u.sampleRate)throw t();super(h,2);const{latencyHint:d}=u,{sampleRate:f}=h;if(this._baseLatency=typeof h.baseLatency=="number"?h.baseLatency:d==="balanced"?512/f:d==="interactive"||d===void 0?256/f:d==="playback"?1024/f:Math.max(2,Math.min(128,Math.round(d*f/128)))*128/f,this._nativeAudioContext=h,c.name==="webkitAudioContext"?(this._nativeGainNode=h.createGain(),this._nativeOscillatorNode=h.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(h.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,h.state==="running"){this._state="suspended";const m=()=>{this._state==="suspended"&&(this._state=null),h.removeEventListener("statechange",m)};h.addEventListener("statechange",m)}}get baseLatency(){return this._baseLatency}get state(){return this._state!==null?this._state:this._nativeAudioContext.state}close(){return this.state==="closed"?this._nativeAudioContext.close().then(()=>{throw e()}):(this._state==="suspended"&&(this._state=null),this._nativeAudioContext.close().then(()=>{this._nativeGainNode!==null&&this._nativeOscillatorNode!==null&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),$u(this)}))}createMediaElementSource(u){return new i(this,{mediaElement:u})}createMediaStreamDestination(){return new r(this)}createMediaStreamSource(u){return new o(this,{mediaStream:u})}createMediaStreamTrackSource(u){return new a(this,{mediaStreamTrack:u})}resume(){return this._state==="suspended"?new Promise((u,h)=>{const d=()=>{this._nativeAudioContext.removeEventListener("statechange",d),this._nativeAudioContext.state==="running"?u():this.resume().then(u,h)};this._nativeAudioContext.addEventListener("statechange",d)}):this._nativeAudioContext.resume().catch(u=>{throw u===void 0||u.code===15?e():u})}suspend(){return this._nativeAudioContext.suspend().catch(u=>{throw u===void 0?e():u})}},l_=(n,e,t,s,i,r,o,a)=>class extends n{constructor(l,u){const h=r(l),d=o(h),f=i(h,u,d),m=d?e(a):null;super(l,!1,f,m),this._isNodeOfNativeOfflineAudioContext=d,this._nativeAudioDestinationNode=f}get channelCount(){return this._nativeAudioDestinationNode.channelCount}set channelCount(l){if(this._isNodeOfNativeOfflineAudioContext)throw s();if(l>this._nativeAudioDestinationNode.maxChannelCount)throw t();this._nativeAudioDestinationNode.channelCount=l}get channelCountMode(){return this._nativeAudioDestinationNode.channelCountMode}set channelCountMode(l){if(this._isNodeOfNativeOfflineAudioContext)throw s();this._nativeAudioDestinationNode.channelCountMode=l}get maxChannelCount(){return this._nativeAudioDestinationNode.maxChannelCount}},u_=n=>{const e=new WeakMap,t=async(s,i)=>{const r=i.destination;return e.set(i,r),await n(s,i,r),r};return{render(s,i){const r=e.get(i);return r!==void 0?Promise.resolve(r):t(s,i)}}},h_=(n,e,t,s,i,r,o,a)=>(c,l)=>{const u=l.listener,h=()=>{const g=new Float32Array(1),x=e(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),T=o(l);let w=!1,C=[0,0,-1,0,1,0],E=[0,0,0];const O=()=>{if(w)return;w=!0;const I=s(l,256,9,0);I.onaudioprocess=({inputBuffer:N})=>{const F=[r(N,g,0),r(N,g,1),r(N,g,2),r(N,g,3),r(N,g,4),r(N,g,5)];F.some((B,q)=>B!==C[q])&&(u.setOrientation(...F),C=F);const z=[r(N,g,6),r(N,g,7),r(N,g,8)];z.some((B,q)=>B!==E[q])&&(u.setPosition(...z),E=z)},x.connect(I)},A=I=>N=>{N!==C[I]&&(C[I]=N,u.setOrientation(...C))},D=I=>N=>{N!==E[I]&&(E[I]=N,u.setPosition(...E))},R=(I,N,F)=>{const z=t(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:N});z.connect(x,0,I),z.start(),Object.defineProperty(z.offset,"defaultValue",{get(){return N}});const B=n({context:c},T,z.offset,Qe,nt);return a(B,"value",q=>()=>q.call(B),q=>V=>{try{q.call(B,V)}catch(L){if(L.code!==9)throw L}O(),T&&F(V)}),B.cancelAndHoldAtTime=(q=>T?()=>{throw i()}:(...V)=>{const L=q.apply(B,V);return O(),L})(B.cancelAndHoldAtTime),B.cancelScheduledValues=(q=>T?()=>{throw i()}:(...V)=>{const L=q.apply(B,V);return O(),L})(B.cancelScheduledValues),B.exponentialRampToValueAtTime=(q=>T?()=>{throw i()}:(...V)=>{const L=q.apply(B,V);return O(),L})(B.exponentialRampToValueAtTime),B.linearRampToValueAtTime=(q=>T?()=>{throw i()}:(...V)=>{const L=q.apply(B,V);return O(),L})(B.linearRampToValueAtTime),B.setTargetAtTime=(q=>T?()=>{throw i()}:(...V)=>{const L=q.apply(B,V);return O(),L})(B.setTargetAtTime),B.setValueAtTime=(q=>T?()=>{throw i()}:(...V)=>{const L=q.apply(B,V);return O(),L})(B.setValueAtTime),B.setValueCurveAtTime=(q=>T?()=>{throw i()}:(...V)=>{const L=q.apply(B,V);return O(),L})(B.setValueCurveAtTime),B};return{forwardX:R(0,0,A(0)),forwardY:R(1,0,A(1)),forwardZ:R(2,-1,A(2)),positionX:R(6,0,D(0)),positionY:R(7,0,D(1)),positionZ:R(8,0,D(2)),upX:R(3,0,A(3)),upY:R(4,1,A(4)),upZ:R(5,0,A(5))}},{forwardX:d,forwardY:f,forwardZ:m,positionX:p,positionY:_,positionZ:y,upX:S,upY:b,upZ:v}=u.forwardX===void 0?h():u;return{get forwardX(){return d},get forwardY(){return f},get forwardZ(){return m},get positionX(){return p},get positionY(){return _},get positionZ(){return y},get upX(){return S},get upY(){return b},get upZ(){return v}}},Br=n=>"context"in n,er=n=>Br(n[0]),dn=(n,e,t,s)=>{for(const i of n)if(t(i)){if(s)return!1;throw Error("The set contains at least one similar element.")}return n.add(e),!0},ul=(n,e,[t,s],i)=>{dn(n,[e,t,s],r=>r[0]===e&&r[1]===t,i)},hl=(n,[e,t,s],i)=>{const r=n.get(e);r===void 0?n.set(e,new Set([[t,s]])):dn(r,[t,s],o=>o[0]===t,i)},$n=n=>"inputs"in n,zr=(n,e,t,s)=>{if($n(e)){const i=e.inputs[s];return n.connect(i,t,0),[i,t,0]}return n.connect(e,t,s),[e,t,s]},Qu=(n,e,t)=>{for(const s of n)if(s[0]===e&&s[1]===t)return n.delete(s),s;return null},d_=(n,e,t)=>uo(n,s=>s[0]===e&&s[1]===t),Ku=(n,e)=>{if(!Qi(n).delete(e))throw new Error("Missing the expected event listener.")},Ju=(n,e,t)=>{const s=Nt(n,e),i=uo(s,r=>r[0]===t);return s.size===0&&n.delete(e),i},Vr=(n,e,t,s)=>{$n(e)?n.disconnect(e.inputs[s],t,0):n.disconnect(e,t,s)},ye=n=>Nt(ja,n),Di=n=>Nt(Ya,n),on=n=>fa.has(n),Er=n=>!Hn.has(n),dl=(n,e)=>new Promise(t=>{if(e!==null)t(!0);else{const s=n.createScriptProcessor(256,1,1),i=n.createGain(),r=n.createBuffer(1,2,44100),o=r.getChannelData(0);o[0]=1,o[1]=1;const a=n.createBufferSource();a.buffer=r,a.loop=!0,a.connect(s).connect(n.destination),a.connect(i),a.disconnect(i),s.onaudioprocess=c=>{const l=c.inputBuffer.getChannelData(0);Array.prototype.some.call(l,u=>u===1)?t(!0):t(!1),a.stop(),s.onaudioprocess=null,a.disconnect(s),s.disconnect(n.destination)},a.start()}}),Wo=(n,e)=>{const t=new Map;for(const s of n)for(const i of s){const r=t.get(i);t.set(i,r===void 0?1:r+1)}t.forEach((s,i)=>e(i,s))},Hr=n=>"context"in n,f_=n=>{const e=new Map;n.connect=(t=>(s,i=0,r=0)=>{const o=Hr(s)?t(s,i,r):t(s,i),a=e.get(s);return a===void 0?e.set(s,[{input:r,output:i}]):a.every(c=>c.input!==r||c.output!==i)&&a.push({input:r,output:i}),o})(n.connect.bind(n)),n.disconnect=(t=>(s,i,r)=>{if(t.apply(n),s===void 0)e.clear();else if(typeof s=="number")for(const[o,a]of e){const c=a.filter(l=>l.output!==s);c.length===0?e.delete(o):e.set(o,c)}else if(e.has(s))if(i===void 0)e.delete(s);else{const o=e.get(s);if(o!==void 0){const a=o.filter(c=>c.output!==i&&(c.input!==r||r===void 0));a.length===0?e.delete(s):e.set(s,a)}}for(const[o,a]of e)a.forEach(c=>{Hr(o)?n.connect(o,c.output,c.input):n.connect(o,c.output)})})(n.disconnect)},p_=(n,e,t,s)=>{const{activeInputs:i,passiveInputs:r}=Ji(e),{outputs:o}=Je(n),a=Qi(n),c=l=>{const u=ye(n),h=Di(e);if(l){const d=Ju(r,n,t);ul(i,n,d,!1),!s&&!on(n)&&u.connect(h,t)}else{const d=d_(i,n,t);hl(r,d,!1),!s&&!on(n)&&u.disconnect(h,t)}};return dn(o,[e,t],l=>l[0]===e&&l[1]===t,!0)?(a.add(c),os(n)?ul(i,n,[t,c],!0):hl(r,[n,t,c],!0),!0):!1},m_=(n,e,t,s)=>{const{activeInputs:i,passiveInputs:r}=Je(e),o=Qu(i[s],n,t);return o===null?[Yu(r,n,t,s)[2],!1]:[o[2],!0]},__=(n,e,t)=>{const{activeInputs:s,passiveInputs:i}=Ji(e),r=Qu(s,n,t);return r===null?[Ju(i,n,t)[1],!1]:[r[2],!0]},Xa=(n,e,t,s,i)=>{const[r,o]=m_(n,t,s,i);if(r!==null&&(Ku(n,r),o&&!e&&!on(n)&&Vr(ye(n),ye(t),s,i)),os(t)){const{activeInputs:a}=Je(t);_a(t,a)}},$a=(n,e,t,s)=>{const[i,r]=__(n,t,s);i!==null&&(Ku(n,i),r&&!e&&!on(n)&&ye(n).disconnect(Di(t),s))},g_=(n,e)=>{const t=Je(n),s=[];for(const i of t.outputs)er(i)?Xa(n,e,...i):$a(n,e,...i),s.push(i[0]);return t.outputs.clear(),s},v_=(n,e,t)=>{const s=Je(n),i=[];for(const r of s.outputs)r[1]===t&&(er(r)?Xa(n,e,...r):$a(n,e,...r),i.push(r[0]),s.outputs.delete(r));return i},y_=(n,e,t,s,i)=>{const r=Je(n);return Array.from(r.outputs).filter(o=>o[0]===t&&(s===void 0||o[1]===s)&&(i===void 0||o[2]===i)).map(o=>(er(o)?Xa(n,e,...o):$a(n,e,...o),r.outputs.delete(o),o[0]))},T_=(n,e,t,s,i,r,o,a,c,l,u,h,d,f,m,p)=>class extends l{constructor(y,S,b,v){super(b),this._context=y,this._nativeAudioNode=b;const g=u(y);h(g)&&t(dl,()=>dl(g,p))!==!0&&f_(b),ja.set(this,b),Gu.set(this,new Set),y.state!=="closed"&&S&&qn(this),n(this,v,b)}get channelCount(){return this._nativeAudioNode.channelCount}set channelCount(y){this._nativeAudioNode.channelCount=y}get channelCountMode(){return this._nativeAudioNode.channelCountMode}set channelCountMode(y){this._nativeAudioNode.channelCountMode=y}get channelInterpretation(){return this._nativeAudioNode.channelInterpretation}set channelInterpretation(y){this._nativeAudioNode.channelInterpretation=y}get context(){return this._context}get numberOfInputs(){return this._nativeAudioNode.numberOfInputs}get numberOfOutputs(){return this._nativeAudioNode.numberOfOutputs}connect(y,S=0,b=0){if(S<0||S>=this._nativeAudioNode.numberOfOutputs)throw i();const v=u(this._context),g=m(v);if(d(y)||f(y))throw r();if(Br(y)){const w=ye(y);try{const E=zr(this._nativeAudioNode,w,S,b),O=Er(this);(g||O)&&this._nativeAudioNode.disconnect(...E),this.context.state!=="closed"&&!O&&Er(y)&&qn(y)}catch(E){throw E.code===12?r():E}if(e(this,y,S,b,g)){const E=c([this],y);Wo(E,s(g))}return y}const x=Di(y);if(x.name==="playbackRate"&&x.maxValue===1024)throw o();try{this._nativeAudioNode.connect(x,S),(g||Er(this))&&this._nativeAudioNode.disconnect(x,S)}catch(w){throw w.code===12?r():w}if(p_(this,y,S,g)){const w=c([this],y);Wo(w,s(g))}}disconnect(y,S,b){let v;const g=u(this._context),x=m(g);if(y===void 0)v=g_(this,x);else if(typeof y=="number"){if(y<0||y>=this.numberOfOutputs)throw i();v=v_(this,x,y)}else{if(S!==void 0&&(S<0||S>=this.numberOfOutputs)||Br(y)&&b!==void 0&&(b<0||b>=y.numberOfInputs))throw i();if(v=y_(this,x,y,S,b),v.length===0)throw r()}for(const T of v){const w=c([this],T);Wo(w,a)}}},x_=(n,e,t,s,i,r,o,a,c,l,u,h,d)=>(f,m,p,_=null,y=null)=>{const S=p.value,b=new km(S),v=m?s(b):null,g={get defaultValue(){return S},get maxValue(){return _===null?p.maxValue:_},get minValue(){return y===null?p.minValue:y},get value(){return p.value},set value(x){p.value=x,g.setValueAtTime(x,f.context.currentTime)},cancelAndHoldAtTime(x){if(typeof p.cancelAndHoldAtTime=="function")v===null&&b.flush(f.context.currentTime),b.add(i(x)),p.cancelAndHoldAtTime(x);else{const T=Array.from(b).pop();v===null&&b.flush(f.context.currentTime),b.add(i(x));const w=Array.from(b).pop();p.cancelScheduledValues(x),T!==w&&w!==void 0&&(w.type==="exponentialRampToValue"?p.exponentialRampToValueAtTime(w.value,w.endTime):w.type==="linearRampToValue"?p.linearRampToValueAtTime(w.value,w.endTime):w.type==="setValue"?p.setValueAtTime(w.value,w.startTime):w.type==="setValueCurve"&&p.setValueCurveAtTime(w.values,w.startTime,w.duration))}return g},cancelScheduledValues(x){return v===null&&b.flush(f.context.currentTime),b.add(r(x)),p.cancelScheduledValues(x),g},exponentialRampToValueAtTime(x,T){if(x===0)throw new RangeError;if(!Number.isFinite(T)||T<0)throw new RangeError;const w=f.context.currentTime;return v===null&&b.flush(w),Array.from(b).length===0&&(b.add(l(S,w)),p.setValueAtTime(S,w)),b.add(o(x,T)),p.exponentialRampToValueAtTime(x,T),g},linearRampToValueAtTime(x,T){const w=f.context.currentTime;return v===null&&b.flush(w),Array.from(b).length===0&&(b.add(l(S,w)),p.setValueAtTime(S,w)),b.add(a(x,T)),p.linearRampToValueAtTime(x,T),g},setTargetAtTime(x,T,w){return v===null&&b.flush(f.context.currentTime),b.add(c(x,T,w)),p.setTargetAtTime(x,T,w),g},setValueAtTime(x,T){return v===null&&b.flush(f.context.currentTime),b.add(l(x,T)),p.setValueAtTime(x,T),g},setValueCurveAtTime(x,T,w){const C=x instanceof Float32Array?x:new Float32Array(x);if(h!==null&&h.name==="webkitAudioContext"){const E=T+w,O=f.context.sampleRate,A=Math.ceil(T*O),D=Math.floor(E*O),R=D-A,I=new Float32Array(R);for(let F=0;F<R;F+=1){const z=(C.length-1)/w*((A+F)/O-T),B=Math.floor(z),q=Math.ceil(z);I[F]=B===q?C[B]:(1-(z-B))*C[B]+(1-(q-z))*C[q]}v===null&&b.flush(f.context.currentTime),b.add(u(I,T,w)),p.setValueCurveAtTime(I,T,w);const N=D/O;N<E&&d(g,I[I.length-1],N),d(g,C[C.length-1],E)}else v===null&&b.flush(f.context.currentTime),b.add(u(C,T,w)),p.setValueCurveAtTime(C,T,w);return g}};return t.set(g,p),e.set(g,f),n(g,v),g},w_=n=>({replay(e){for(const t of n)if(t.type==="exponentialRampToValue"){const{endTime:s,value:i}=t;e.exponentialRampToValueAtTime(i,s)}else if(t.type==="linearRampToValue"){const{endTime:s,value:i}=t;e.linearRampToValueAtTime(i,s)}else if(t.type==="setTarget"){const{startTime:s,target:i,timeConstant:r}=t;e.setTargetAtTime(i,s,r)}else if(t.type==="setValue"){const{startTime:s,value:i}=t;e.setValueAtTime(i,s)}else if(t.type==="setValueCurve"){const{duration:s,startTime:i,values:r}=t;e.setValueCurveAtTime(r,i,s)}else throw new Error("Can't apply an unknown automation.")}});class eh{constructor(e){this._map=new Map(e)}get size(){return this._map.size}entries(){return this._map.entries()}forEach(e,t=null){return this._map.forEach((s,i)=>e.call(t,s,i,this))}get(e){return this._map.get(e)}has(e){return this._map.has(e)}keys(){return this._map.keys()}values(){return this._map.values()}}const S_={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,parameterData:{},processorOptions:{}},b_=(n,e,t,s,i,r,o,a,c,l,u,h,d,f)=>class extends e{constructor(p,_,y){var S;const b=a(p),v=c(b),g=u({...S_,...y});d(g);const x=pa.get(b),T=x==null?void 0:x.get(_),w=v||b.state!=="closed"?b:(S=o(b))!==null&&S!==void 0?S:b,C=i(w,v?null:p.baseLatency,l,_,T,g),E=v?s(_,g,T):null;super(p,!0,C,E);const O=[];C.parameters.forEach((D,R)=>{const I=t(this,v,D);O.push([R,I])}),this._nativeAudioWorkletNode=C,this._onprocessorerror=null,this._parameters=new eh(O),v&&n(b,this);const{activeInputs:A}=r(this);h(C,A)}get onprocessorerror(){return this._onprocessorerror}set onprocessorerror(p){const _=typeof p=="function"?f(this,p):null;this._nativeAudioWorkletNode.onprocessorerror=_;const y=this._nativeAudioWorkletNode.onprocessorerror;this._onprocessorerror=y!==null&&y===_?p:y}get parameters(){return this._parameters===null?this._nativeAudioWorkletNode.parameters:this._parameters}get port(){return this._nativeAudioWorkletNode.port}};function qr(n,e,t,s,i){if(typeof n.copyFromChannel=="function")e[t].byteLength===0&&(e[t]=new Float32Array(128)),n.copyFromChannel(e[t],s,i);else{const r=n.getChannelData(s);if(e[t].byteLength===0)e[t]=r.slice(i,i+128);else{const o=new Float32Array(r.buffer,i*Float32Array.BYTES_PER_ELEMENT,128);e[t].set(o)}}}const th=(n,e,t,s,i)=>{typeof n.copyToChannel=="function"?e[t].byteLength!==0&&n.copyToChannel(e[t],s,i):e[t].byteLength!==0&&n.getChannelData(s).set(e[t],i)},Wr=(n,e)=>{const t=[];for(let s=0;s<n;s+=1){const i=[],r=typeof e=="number"?e:e[s];for(let o=0;o<r;o+=1)i.push(new Float32Array(128));t.push(i)}return t},C_=(n,e)=>{const t=Nt(ma,n),s=ye(e);return Nt(t,s)},E_=async(n,e,t,s,i,r,o)=>{const a=e===null?Math.ceil(n.context.length/128)*128:e.length,c=s.channelCount*s.numberOfInputs,l=i.reduce((_,y)=>_+y,0),u=l===0?null:t.createBuffer(l,a,t.sampleRate);if(r===void 0)throw new Error("Missing the processor constructor.");const h=Je(n),d=await C_(t,n),f=Wr(s.numberOfInputs,s.channelCount),m=Wr(s.numberOfOutputs,i),p=Array.from(n.parameters.keys()).reduce((_,y)=>({..._,[y]:new Float32Array(128)}),{});for(let _=0;_<a;_+=128){if(s.numberOfInputs>0&&e!==null)for(let y=0;y<s.numberOfInputs;y+=1)for(let S=0;S<s.channelCount;S+=1)qr(e,f[y],S,S,_);r.parameterDescriptors!==void 0&&e!==null&&r.parameterDescriptors.forEach(({name:y},S)=>{qr(e,p,y,c+S,_)});for(let y=0;y<s.numberOfInputs;y+=1)for(let S=0;S<i[y];S+=1)m[y][S].byteLength===0&&(m[y][S]=new Float32Array(128));try{const y=f.map((b,v)=>h.activeInputs[v].size===0?[]:b),S=o(_/t.sampleRate,t.sampleRate,()=>d.process(y,m,p));if(u!==null)for(let b=0,v=0;b<s.numberOfOutputs;b+=1){for(let g=0;g<i[b];g+=1)th(u,m[b],g,v+g,_);v+=i[b]}if(!S)break}catch(y){n.dispatchEvent(new ErrorEvent("processorerror",{colno:y.colno,filename:y.filename,lineno:y.lineno,message:y.message}));break}}return u},O_=(n,e,t,s,i,r,o,a,c,l,u,h,d,f,m,p)=>(_,y,S)=>{const b=new WeakMap;let v=null;const g=async(x,T)=>{let w=u(x),C=null;const E=$e(w,T),O=Array.isArray(y.outputChannelCount)?y.outputChannelCount:Array.from(y.outputChannelCount);if(h===null){const A=O.reduce((N,F)=>N+F,0),D=i(T,{channelCount:Math.max(1,A),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,A)}),R=[];for(let N=0;N<x.numberOfOutputs;N+=1)R.push(s(T,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:O[N]}));const I=o(T,{channelCount:y.channelCount,channelCountMode:y.channelCountMode,channelInterpretation:y.channelInterpretation,gain:1});I.connect=e.bind(null,R),I.disconnect=c.bind(null,R),C=[D,R,I]}else E||(w=new h(T,_));if(b.set(T,C===null?w:C[2]),C!==null){if(v===null){if(S===void 0)throw new Error("Missing the processor constructor.");if(d===null)throw new Error("Missing the native OfflineAudioContext constructor.");const F=x.channelCount*x.numberOfInputs,z=S.parameterDescriptors===void 0?0:S.parameterDescriptors.length,B=F+z;v=E_(x,B===0?null:await(async()=>{const V=new d(B,Math.ceil(x.context.length/128)*128,T.sampleRate),L=[],ve=[];for(let fe=0;fe<y.numberOfInputs;fe+=1)L.push(o(V,{channelCount:y.channelCount,channelCountMode:y.channelCountMode,channelInterpretation:y.channelInterpretation,gain:1})),ve.push(i(V,{channelCount:y.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:y.channelCount}));const re=await Promise.all(Array.from(x.parameters.values()).map(async fe=>{const We=r(V,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:fe.value});return await f(V,fe,We.offset),We})),Z=s(V,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,F+z)});for(let fe=0;fe<y.numberOfInputs;fe+=1){L[fe].connect(ve[fe]);for(let We=0;We<y.channelCount;We+=1)ve[fe].connect(Z,We,fe*y.channelCount+We)}for(const[fe,We]of re.entries())We.connect(Z,0,F+fe),We.start(0);return Z.connect(V.destination),await Promise.all(L.map(fe=>m(x,V,fe))),p(V)})(),T,y,O,S,l)}const A=await v,D=t(T,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),[R,I,N]=C;A!==null&&(D.buffer=A,D.start(0)),D.connect(R);for(let F=0,z=0;F<x.numberOfOutputs;F+=1){const B=I[F];for(let q=0;q<O[F];q+=1)R.connect(B,z+q,q);z+=O[F]}return N}if(E)for(const[A,D]of x.parameters.entries())await n(T,D,w.parameters.get(A));else for(const[A,D]of x.parameters.entries())await f(T,D,w.parameters.get(A));return await m(x,T,w),w};return{render(x,T){a(T,x);const w=b.get(T);return w!==void 0?Promise.resolve(w):g(x,T)}}},A_=(n,e,t,s,i,r,o,a,c,l,u,h,d,f,m,p,_,y,S,b)=>class extends m{constructor(g,x){super(g,x),this._nativeContext=g,this._audioWorklet=n===void 0?void 0:{addModule:(T,w)=>n(this,T,w)}}get audioWorklet(){return this._audioWorklet}createAnalyser(){return new e(this)}createBiquadFilter(){return new i(this)}createBuffer(g,x,T){return new t({length:x,numberOfChannels:g,sampleRate:T})}createBufferSource(){return new s(this)}createChannelMerger(g=6){return new r(this,{numberOfInputs:g})}createChannelSplitter(g=6){return new o(this,{numberOfOutputs:g})}createConstantSource(){return new a(this)}createConvolver(){return new c(this)}createDelay(g=1){return new u(this,{maxDelayTime:g})}createDynamicsCompressor(){return new h(this)}createGain(){return new d(this)}createIIRFilter(g,x){return new f(this,{feedback:x,feedforward:g})}createOscillator(){return new p(this)}createPanner(){return new _(this)}createPeriodicWave(g,x,T={disableNormalization:!1}){return new y(this,{...T,imag:x,real:g})}createStereoPanner(){return new S(this)}createWaveShaper(){return new b(this)}decodeAudioData(g,x,T){return l(this._nativeContext,g).then(w=>(typeof x=="function"&&x(w),w),w=>{throw typeof T=="function"&&T(w),w})}},M_={Q:1,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:350,gain:0,type:"lowpass"},D_=(n,e,t,s,i,r,o,a)=>class extends n{constructor(l,u){const h=r(l),d={...M_,...u},f=i(h,d),m=o(h),p=m?t():null;super(l,!1,f,p),this._Q=e(this,m,f.Q,Qe,nt),this._detune=e(this,m,f.detune,1200*Math.log2(Qe),-1200*Math.log2(Qe)),this._frequency=e(this,m,f.frequency,l.sampleRate/2,0),this._gain=e(this,m,f.gain,40*Math.log10(Qe),nt),this._nativeBiquadFilterNode=f,a(this,1)}get detune(){return this._detune}get frequency(){return this._frequency}get gain(){return this._gain}get Q(){return this._Q}get type(){return this._nativeBiquadFilterNode.type}set type(l){this._nativeBiquadFilterNode.type=l}getFrequencyResponse(l,u,h){try{this._nativeBiquadFilterNode.getFrequencyResponse(l,u,h)}catch(d){throw d.code===11?s():d}if(l.length!==u.length||u.length!==h.length)throw s()}},k_=(n,e,t,s,i)=>()=>{const r=new WeakMap,o=async(a,c)=>{let l=t(a);const u=$e(l,c);if(!u){const h={Q:l.Q.value,channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,detune:l.detune.value,frequency:l.frequency.value,gain:l.gain.value,type:l.type};l=e(c,h)}return r.set(c,l),u?(await n(c,a.Q,l.Q),await n(c,a.detune,l.detune),await n(c,a.frequency,l.frequency),await n(c,a.gain,l.gain)):(await s(c,a.Q,l.Q),await s(c,a.detune,l.detune),await s(c,a.frequency,l.frequency),await s(c,a.gain,l.gain)),await i(a,c,l),l};return{render(a,c){const l=r.get(c);return l!==void 0?Promise.resolve(l):o(a,c)}}},R_=(n,e)=>(t,s)=>{const i=e.get(t);if(i!==void 0)return i;const r=n.get(t);if(r!==void 0)return r;try{const o=s();return o instanceof Promise?(n.set(t,o),o.catch(()=>!1).then(a=>(n.delete(t),e.set(t,a),a))):(e.set(t,o),o)}catch{return e.set(t,!1),!1}},P_={channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6},N_=(n,e,t,s,i)=>class extends n{constructor(o,a){const c=s(o),l={...P_,...a},u=t(c,l),h=i(c)?e():null;super(o,!1,u,h)}},I_=(n,e,t)=>()=>{const s=new WeakMap,i=async(r,o)=>{let a=e(r);if(!$e(a,o)){const l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,numberOfInputs:a.numberOfInputs};a=n(o,l)}return s.set(o,a),await t(r,o,a),a};return{render(r,o){const a=s.get(o);return a!==void 0?Promise.resolve(a):i(r,o)}}},F_={channelCount:6,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:6},U_=(n,e,t,s,i,r)=>class extends n{constructor(a,c){const l=s(a),u=r({...F_,...c}),h=t(l,u),d=i(l)?e():null;super(a,!1,h,d)}},L_=(n,e,t)=>()=>{const s=new WeakMap,i=async(r,o)=>{let a=e(r);if(!$e(a,o)){const l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,numberOfOutputs:a.numberOfOutputs};a=n(o,l)}return s.set(o,a),await t(r,o,a),a};return{render(r,o){const a=s.get(o);return a!==void 0?Promise.resolve(a):i(r,o)}}},B_=n=>(e,t,s)=>n(t,e,s),z_=n=>(e,t,s=0,i=0)=>{const r=e[s];if(r===void 0)throw n();return Hr(t)?r.connect(t,0,i):r.connect(t,0)},V_=n=>(e,t)=>{const s=n(e,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),i=e.createBuffer(1,2,44100);return s.buffer=i,s.loop=!0,s.connect(t),s.start(),()=>{s.stop(),s.disconnect(t)}},H_={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",offset:1},q_=(n,e,t,s,i,r,o)=>class extends n{constructor(c,l){const u=i(c),h={...H_,...l},d=s(u,h),f=r(u),m=f?t():null;super(c,!1,d,m),this._constantSourceNodeRenderer=m,this._nativeConstantSourceNode=d,this._offset=e(this,f,d.offset,Qe,nt),this._onended=null}get offset(){return this._offset}get onended(){return this._onended}set onended(c){const l=typeof c=="function"?o(this,c):null;this._nativeConstantSourceNode.onended=l;const u=this._nativeConstantSourceNode.onended;this._onended=u!==null&&u===l?c:u}start(c=0){if(this._nativeConstantSourceNode.start(c),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.start=c),this.context.state!=="closed"){qn(this);const l=()=>{this._nativeConstantSourceNode.removeEventListener("ended",l),os(this)&&Ki(this)};this._nativeConstantSourceNode.addEventListener("ended",l)}}stop(c=0){this._nativeConstantSourceNode.stop(c),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.stop=c)}},W_=(n,e,t,s,i)=>()=>{const r=new WeakMap;let o=null,a=null;const c=async(l,u)=>{let h=t(l);const d=$e(h,u);if(!d){const f={channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,offset:h.offset.value};h=e(u,f),o!==null&&h.start(o),a!==null&&h.stop(a)}return r.set(u,h),d?await n(u,l.offset,h.offset):await s(u,l.offset,h.offset),await i(l,u,h),h};return{set start(l){o=l},set stop(l){a=l},render(l,u){const h=r.get(u);return h!==void 0?Promise.resolve(h):c(l,u)}}},G_=n=>e=>(n[0]=e,n[0]),j_={buffer:null,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",disableNormalization:!1},Y_=(n,e,t,s,i,r)=>class extends n{constructor(a,c){const l=s(a),u={...j_,...c},h=t(l,u),f=i(l)?e():null;super(a,!1,h,f),this._isBufferNullified=!1,this._nativeConvolverNode=h,u.buffer!==null&&r(this,u.buffer.duration)}get buffer(){return this._isBufferNullified?null:this._nativeConvolverNode.buffer}set buffer(a){if(this._nativeConvolverNode.buffer=a,a===null&&this._nativeConvolverNode.buffer!==null){const c=this._nativeConvolverNode.context;this._nativeConvolverNode.buffer=c.createBuffer(1,1,c.sampleRate),this._isBufferNullified=!0,r(this,0)}else this._isBufferNullified=!1,r(this,this._nativeConvolverNode.buffer===null?0:this._nativeConvolverNode.buffer.duration)}get normalize(){return this._nativeConvolverNode.normalize}set normalize(a){this._nativeConvolverNode.normalize=a}},Z_=(n,e,t)=>()=>{const s=new WeakMap,i=async(r,o)=>{let a=e(r);if(!$e(a,o)){const l={buffer:a.buffer,channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,disableNormalization:!a.normalize};a=n(o,l)}return s.set(o,a),$n(a)?await t(r,o,a.inputs[0]):await t(r,o,a),a};return{render(r,o){const a=s.get(o);return a!==void 0?Promise.resolve(a):i(r,o)}}},X_=(n,e)=>(t,s,i)=>{if(e===null)throw new Error("Missing the native OfflineAudioContext constructor.");try{return new e(t,s,i)}catch(r){throw r.name==="SyntaxError"?n():r}},$_=()=>new DOMException("","DataCloneError"),fl=n=>{const{port1:e,port2:t}=new MessageChannel;return new Promise(s=>{const i=()=>{t.onmessage=null,e.close(),t.close(),s()};t.onmessage=()=>i();try{e.postMessage(n,[n])}catch{}finally{i()}})},Q_=(n,e,t,s,i,r,o,a,c,l,u)=>(h,d)=>{const f=o(h)?h:r(h);if(i.has(d)){const m=t();return Promise.reject(m)}try{i.add(d)}catch{}return e(c,()=>c(f))?f.decodeAudioData(d).then(m=>(fl(d).catch(()=>{}),e(a,()=>a(m))||u(m),n.add(m),m)):new Promise((m,p)=>{const _=async()=>{try{await fl(d)}catch{}},y=S=>{p(S),_()};try{f.decodeAudioData(d,S=>{typeof S.copyFromChannel!="function"&&(l(S),Za(S)),n.add(S),_().then(()=>m(S))},S=>{y(S===null?s():S)})}catch(S){y(S)}})},K_=(n,e,t,s,i,r,o,a)=>(c,l)=>{const u=e.get(c);if(u===void 0)throw new Error("Missing the expected cycle count.");const h=r(c.context),d=a(h);if(u===l){if(e.delete(c),!d&&o(c)){const f=s(c),{outputs:m}=t(c);for(const p of m)if(er(p)){const _=s(p[0]);n(f,_,p[1],p[2])}else{const _=i(p[0]);f.connect(_,p[1])}}}else e.set(c,u-l)},J_={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",delayTime:0,maxDelayTime:1},eg=(n,e,t,s,i,r,o)=>class extends n{constructor(c,l){const u=i(c),h={...J_,...l},d=s(u,h),f=r(u),m=f?t(h.maxDelayTime):null;super(c,!1,d,m),this._delayTime=e(this,f,d.delayTime),o(this,h.maxDelayTime)}get delayTime(){return this._delayTime}},tg=(n,e,t,s,i)=>r=>{const o=new WeakMap,a=async(c,l)=>{let u=t(c);const h=$e(u,l);if(!h){const d={channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,delayTime:u.delayTime.value,maxDelayTime:r};u=e(l,d)}return o.set(l,u),h?await n(l,c.delayTime,u.delayTime):await s(l,c.delayTime,u.delayTime),await i(c,l,u),u};return{render(c,l){const u=o.get(l);return u!==void 0?Promise.resolve(u):a(c,l)}}},sg=n=>(e,t,s,i)=>n(e[i],r=>r[0]===t&&r[1]===s),ng=n=>(e,t)=>{n(e).delete(t)},ig=n=>"delayTime"in n,rg=(n,e,t)=>function s(i,r){const o=Br(r)?r:t(n,r);if(ig(o))return[];if(i[0]===o)return[i];if(i.includes(o))return[];const{outputs:a}=e(o);return Array.from(a).map(c=>s([...i,o],c[0])).reduce((c,l)=>c.concat(l),[])},Tr=(n,e,t)=>{const s=e[t];if(s===void 0)throw n();return s},og=n=>(e,t=void 0,s=void 0,i=0)=>t===void 0?e.forEach(r=>r.disconnect()):typeof t=="number"?Tr(n,e,t).disconnect():Hr(t)?s===void 0?e.forEach(r=>r.disconnect(t)):i===void 0?Tr(n,e,s).disconnect(t,0):Tr(n,e,s).disconnect(t,0,i):s===void 0?e.forEach(r=>r.disconnect(t)):Tr(n,e,s).disconnect(t,0),ag={attack:.003,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",knee:30,ratio:12,release:.25,threshold:-24},cg=(n,e,t,s,i,r,o,a)=>class extends n{constructor(l,u){const h=r(l),d={...ag,...u},f=s(h,d),m=o(h),p=m?t():null;super(l,!1,f,p),this._attack=e(this,m,f.attack),this._knee=e(this,m,f.knee),this._nativeDynamicsCompressorNode=f,this._ratio=e(this,m,f.ratio),this._release=e(this,m,f.release),this._threshold=e(this,m,f.threshold),a(this,.006)}get attack(){return this._attack}get channelCount(){return this._nativeDynamicsCompressorNode.channelCount}set channelCount(l){const u=this._nativeDynamicsCompressorNode.channelCount;if(this._nativeDynamicsCompressorNode.channelCount=l,l>2)throw this._nativeDynamicsCompressorNode.channelCount=u,i()}get channelCountMode(){return this._nativeDynamicsCompressorNode.channelCountMode}set channelCountMode(l){const u=this._nativeDynamicsCompressorNode.channelCountMode;if(this._nativeDynamicsCompressorNode.channelCountMode=l,l==="max")throw this._nativeDynamicsCompressorNode.channelCountMode=u,i()}get knee(){return this._knee}get ratio(){return this._ratio}get reduction(){return typeof this._nativeDynamicsCompressorNode.reduction.value=="number"?this._nativeDynamicsCompressorNode.reduction.value:this._nativeDynamicsCompressorNode.reduction}get release(){return this._release}get threshold(){return this._threshold}},lg=(n,e,t,s,i)=>()=>{const r=new WeakMap,o=async(a,c)=>{let l=t(a);const u=$e(l,c);if(!u){const h={attack:l.attack.value,channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,knee:l.knee.value,ratio:l.ratio.value,release:l.release.value,threshold:l.threshold.value};l=e(c,h)}return r.set(c,l),u?(await n(c,a.attack,l.attack),await n(c,a.knee,l.knee),await n(c,a.ratio,l.ratio),await n(c,a.release,l.release),await n(c,a.threshold,l.threshold)):(await s(c,a.attack,l.attack),await s(c,a.knee,l.knee),await s(c,a.ratio,l.ratio),await s(c,a.release,l.release),await s(c,a.threshold,l.threshold)),await i(a,c,l),l};return{render(a,c){const l=r.get(c);return l!==void 0?Promise.resolve(l):o(a,c)}}},ug=()=>new DOMException("","EncodingError"),hg=n=>e=>new Promise((t,s)=>{if(n===null){s(new SyntaxError);return}const i=n.document.head;if(i===null)s(new SyntaxError);else{const r=n.document.createElement("script"),o=new Blob([e],{type:"application/javascript"}),a=URL.createObjectURL(o),c=n.onerror,l=()=>{n.onerror=c,URL.revokeObjectURL(a)};n.onerror=(u,h,d,f,m)=>{if(h===a||h===n.location.href&&d===1&&f===1)return l(),s(m),!1;if(c!==null)return c(u,h,d,f,m)},r.onerror=()=>{l(),s(new SyntaxError)},r.onload=()=>{l(),t()},r.src=a,r.type="module",i.appendChild(r)}}),dg=n=>class{constructor(t){this._nativeEventTarget=t,this._listeners=new WeakMap}addEventListener(t,s,i){if(s!==null){let r=this._listeners.get(s);r===void 0&&(r=n(this,s),typeof s=="function"&&this._listeners.set(s,r)),this._nativeEventTarget.addEventListener(t,r,i)}}dispatchEvent(t){return this._nativeEventTarget.dispatchEvent(t)}removeEventListener(t,s,i){const r=s===null?void 0:this._listeners.get(s);this._nativeEventTarget.removeEventListener(t,r===void 0?null:r,i)}},fg=n=>(e,t,s)=>{Object.defineProperties(n,{currentFrame:{configurable:!0,get(){return Math.round(e*t)}},currentTime:{configurable:!0,get(){return e}}});try{return s()}finally{n!==null&&(delete n.currentFrame,delete n.currentTime)}},pg=n=>async e=>{try{const t=await fetch(e);if(t.ok)return[await t.text(),t.url]}catch{}throw n()},mg={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",gain:1},_g=(n,e,t,s,i,r)=>class extends n{constructor(a,c){const l=i(a),u={...mg,...c},h=s(l,u),d=r(l),f=d?t():null;super(a,!1,h,f),this._gain=e(this,d,h.gain,Qe,nt)}get gain(){return this._gain}},gg=(n,e,t,s,i)=>()=>{const r=new WeakMap,o=async(a,c)=>{let l=t(a);const u=$e(l,c);if(!u){const h={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,gain:l.gain.value};l=e(c,h)}return r.set(c,l),u?await n(c,a.gain,l.gain):await s(c,a.gain,l.gain),await i(a,c,l),l};return{render(a,c){const l=r.get(c);return l!==void 0?Promise.resolve(l):o(a,c)}}},vg=(n,e)=>t=>e(n,t),yg=n=>e=>{const t=n(e);if(t.renderer===null)throw new Error("Missing the renderer of the given AudioNode in the audio graph.");return t.renderer},Tg=n=>e=>{var t;return(t=n.get(e))!==null&&t!==void 0?t:0},xg=n=>e=>{const t=n(e);if(t.renderer===null)throw new Error("Missing the renderer of the given AudioParam in the audio graph.");return t.renderer},wg=n=>e=>n.get(e),He=()=>new DOMException("","InvalidStateError"),Sg=n=>e=>{const t=n.get(e);if(t===void 0)throw He();return t},bg=(n,e)=>t=>{let s=n.get(t);if(s!==void 0)return s;if(e===null)throw new Error("Missing the native OfflineAudioContext constructor.");return s=new e(1,1,44100),n.set(t,s),s},Cg=n=>e=>{const t=n.get(e);if(t===void 0)throw new Error("The context has no set of AudioWorkletNodes.");return t},ho=()=>new DOMException("","InvalidAccessError"),Eg=n=>{n.getFrequencyResponse=(e=>(t,s,i)=>{if(t.length!==s.length||s.length!==i.length)throw ho();return e.call(n,t,s,i)})(n.getFrequencyResponse)},Og={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers"},Ag=(n,e,t,s,i,r)=>class extends n{constructor(a,c){const l=s(a),u=i(l),h={...Og,...c},d=e(l,u?null:a.baseLatency,h),f=u?t(h.feedback,h.feedforward):null;super(a,!1,d,f),Eg(d),this._nativeIIRFilterNode=d,r(this,1)}getFrequencyResponse(a,c,l){return this._nativeIIRFilterNode.getFrequencyResponse(a,c,l)}},sh=(n,e,t,s,i,r,o,a,c,l,u)=>{const h=l.length;let d=a;for(let f=0;f<h;f+=1){let m=t[0]*l[f];for(let p=1;p<i;p+=1){const _=d-p&c-1;m+=t[p]*r[_],m-=n[p]*o[_]}for(let p=i;p<s;p+=1)m+=t[p]*r[d-p&c-1];for(let p=i;p<e;p+=1)m-=n[p]*o[d-p&c-1];r[d]=l[f],o[d]=m,d=d+1&c-1,u[f]=m}return d},Mg=(n,e,t,s)=>{const i=t instanceof Float64Array?t:new Float64Array(t),r=s instanceof Float64Array?s:new Float64Array(s),o=i.length,a=r.length,c=Math.min(o,a);if(i[0]!==1){for(let m=0;m<o;m+=1)r[m]/=i[0];for(let m=1;m<a;m+=1)i[m]/=i[0]}const l=32,u=new Float32Array(l),h=new Float32Array(l),d=e.createBuffer(n.numberOfChannels,n.length,n.sampleRate),f=n.numberOfChannels;for(let m=0;m<f;m+=1){const p=n.getChannelData(m),_=d.getChannelData(m);u.fill(0),h.fill(0),sh(i,o,r,a,c,u,h,0,l,p,_)}return d},Dg=(n,e,t,s,i)=>(r,o)=>{const a=new WeakMap;let c=null;const l=async(u,h)=>{let d=null,f=e(u);const m=$e(f,h);if(h.createIIRFilter===void 0?d=n(h,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}):m||(f=h.createIIRFilter(o,r)),a.set(h,d===null?f:d),d!==null){if(c===null){if(t===null)throw new Error("Missing the native OfflineAudioContext constructor.");const _=new t(u.context.destination.channelCount,u.context.length,h.sampleRate);c=(async()=>{await s(u,_,_.destination);const y=await i(_);return Mg(y,h,r,o)})()}const p=await c;return d.buffer=p,d.start(0),d}return await s(u,h,f),f};return{render(u,h){const d=a.get(h);return d!==void 0?Promise.resolve(d):l(u,h)}}},kg=(n,e,t,s,i,r)=>o=>(a,c)=>{const l=n.get(a);if(l===void 0){if(!o&&r(a)){const u=s(a),{outputs:h}=t(a);for(const d of h)if(er(d)){const f=s(d[0]);e(u,f,d[1],d[2])}else{const f=i(d[0]);u.disconnect(f,d[1])}}n.set(a,c)}else n.set(a,l+c)},Rg=(n,e)=>t=>{const s=n.get(t);return e(s)||e(t)},Pg=(n,e)=>t=>n.has(t)||e(t),Ng=(n,e)=>t=>n.has(t)||e(t),Ig=(n,e)=>t=>{const s=n.get(t);return e(s)||e(t)},Fg=n=>e=>n!==null&&e instanceof n,Ug=n=>e=>n!==null&&typeof n.AudioNode=="function"&&e instanceof n.AudioNode,Lg=n=>e=>n!==null&&typeof n.AudioParam=="function"&&e instanceof n.AudioParam,Bg=(n,e)=>t=>n(t)||e(t),zg=n=>e=>n!==null&&e instanceof n,Vg=n=>n!==null&&n.isSecureContext,Hg=(n,e,t,s)=>class extends n{constructor(r,o){const a=t(r),c=e(a,o);if(s(a))throw TypeError();super(r,!0,c,null),this._nativeMediaElementAudioSourceNode=c}get mediaElement(){return this._nativeMediaElementAudioSourceNode.mediaElement}},qg={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"},Wg=(n,e,t,s)=>class extends n{constructor(r,o){const a=t(r);if(s(a))throw new TypeError;const c={...qg,...o},l=e(a,c);super(r,!1,l,null),this._nativeMediaStreamAudioDestinationNode=l}get stream(){return this._nativeMediaStreamAudioDestinationNode.stream}},Gg=(n,e,t,s)=>class extends n{constructor(r,o){const a=t(r),c=e(a,o);if(s(a))throw new TypeError;super(r,!0,c,null),this._nativeMediaStreamAudioSourceNode=c}get mediaStream(){return this._nativeMediaStreamAudioSourceNode.mediaStream}},jg=(n,e,t)=>class extends n{constructor(i,r){const o=t(i),a=e(o,r);super(i,!0,a,null)}},Yg=(n,e,t,s,i,r)=>class extends t{constructor(a,c){super(a),this._nativeContext=a,lo.set(this,a),s(a)&&i.set(a,new Set),this._destination=new n(this,c),this._listener=e(this,a),this._onstatechange=null}get currentTime(){return this._nativeContext.currentTime}get destination(){return this._destination}get listener(){return this._listener}get onstatechange(){return this._onstatechange}set onstatechange(a){const c=typeof a=="function"?r(this,a):null;this._nativeContext.onstatechange=c;const l=this._nativeContext.onstatechange;this._onstatechange=l!==null&&l===c?a:l}get sampleRate(){return this._nativeContext.sampleRate}get state(){return this._nativeContext.state}},ki=n=>{const e=new Uint32Array([1179011410,40,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,4,0]);try{const t=n.decodeAudioData(e.buffer,()=>{});return t===void 0?!1:(t.catch(()=>{}),!0)}catch{}return!1},Zg=(n,e)=>(t,s,i)=>{const r=new Set;return t.connect=(o=>(a,c=0,l=0)=>{const u=r.size===0;if(e(a))return o.call(t,a,c,l),n(r,[a,c,l],h=>h[0]===a&&h[1]===c&&h[2]===l,!0),u&&s(),a;o.call(t,a,c),n(r,[a,c],h=>h[0]===a&&h[1]===c,!0),u&&s()})(t.connect),t.disconnect=(o=>(a,c,l)=>{const u=r.size>0;if(a===void 0)o.apply(t),r.clear();else if(typeof a=="number"){o.call(t,a);for(const d of r)d[1]===a&&r.delete(d)}else{e(a)?o.call(t,a,c,l):o.call(t,a,c);for(const d of r)d[0]===a&&(c===void 0||d[1]===c)&&(l===void 0||d[2]===l)&&r.delete(d)}const h=r.size===0;u&&h&&i()})(t.disconnect),t},Te=(n,e,t)=>{const s=e[t];s!==void 0&&s!==n[t]&&(n[t]=s)},Be=(n,e)=>{Te(n,e,"channelCount"),Te(n,e,"channelCountMode"),Te(n,e,"channelInterpretation")},pl=n=>typeof n.getFloatTimeDomainData=="function",Xg=n=>{n.getFloatTimeDomainData=e=>{const t=new Uint8Array(e.length);n.getByteTimeDomainData(t);const s=Math.max(t.length,n.fftSize);for(let i=0;i<s;i+=1)e[i]=(t[i]-128)*.0078125;return e}},$g=(n,e)=>(t,s)=>{const i=t.createAnalyser();if(Be(i,s),!(s.maxDecibels>s.minDecibels))throw e();return Te(i,s,"fftSize"),Te(i,s,"maxDecibels"),Te(i,s,"minDecibels"),Te(i,s,"smoothingTimeConstant"),n(pl,()=>pl(i))||Xg(i),i},Qg=n=>n===null?null:n.hasOwnProperty("AudioBuffer")?n.AudioBuffer:null,Oe=(n,e,t)=>{const s=e[t];s!==void 0&&s!==n[t].value&&(n[t].value=s)},Kg=n=>{n.start=(e=>{let t=!1;return(s=0,i=0,r)=>{if(t)throw He();e.call(n,s,i,r),t=!0}})(n.start)},Qa=n=>{n.start=(e=>(t=0,s=0,i)=>{if(typeof i=="number"&&i<0||s<0||t<0)throw new RangeError("The parameters can't be negative.");e.call(n,t,s,i)})(n.start)},Ka=n=>{n.stop=(e=>(t=0)=>{if(t<0)throw new RangeError("The parameter can't be negative.");e.call(n,t)})(n.stop)},Jg=(n,e,t,s,i,r,o,a,c,l,u)=>(h,d)=>{const f=h.createBufferSource();return Be(f,d),Oe(f,d,"playbackRate"),Te(f,d,"buffer"),Te(f,d,"loop"),Te(f,d,"loopEnd"),Te(f,d,"loopStart"),e(t,()=>t(h))||Kg(f),e(s,()=>s(h))||c(f),e(i,()=>i(h))||l(f,h),e(r,()=>r(h))||Qa(f),e(o,()=>o(h))||u(f,h),e(a,()=>a(h))||Ka(f),n(h,f),f},ev=n=>n===null?null:n.hasOwnProperty("AudioContext")?n.AudioContext:n.hasOwnProperty("webkitAudioContext")?n.webkitAudioContext:null,tv=(n,e)=>(t,s,i)=>{const r=t.destination;if(r.channelCount!==s)try{r.channelCount=s}catch{}i&&r.channelCountMode!=="explicit"&&(r.channelCountMode="explicit"),r.maxChannelCount===0&&Object.defineProperty(r,"maxChannelCount",{value:s});const o=n(t,{channelCount:s,channelCountMode:r.channelCountMode,channelInterpretation:r.channelInterpretation,gain:1});return e(o,"channelCount",a=>()=>a.call(o),a=>c=>{a.call(o,c);try{r.channelCount=c}catch(l){if(c>r.maxChannelCount)throw l}}),e(o,"channelCountMode",a=>()=>a.call(o),a=>c=>{a.call(o,c),r.channelCountMode=c}),e(o,"channelInterpretation",a=>()=>a.call(o),a=>c=>{a.call(o,c),r.channelInterpretation=c}),Object.defineProperty(o,"maxChannelCount",{get:()=>r.maxChannelCount}),o.connect(r),o},sv=n=>n===null?null:n.hasOwnProperty("AudioWorkletNode")?n.AudioWorkletNode:null,nv=n=>{const{port1:e}=new MessageChannel;try{e.postMessage(n)}finally{e.close()}},iv=(n,e,t,s,i)=>(r,o,a,c,l,u)=>{if(a!==null)try{const h=new a(r,c,u),d=new Map;let f=null;if(Object.defineProperties(h,{channelCount:{get:()=>u.channelCount,set:()=>{throw n()}},channelCountMode:{get:()=>"explicit",set:()=>{throw n()}},onprocessorerror:{get:()=>f,set:m=>{typeof f=="function"&&h.removeEventListener("processorerror",f),f=typeof m=="function"?m:null,typeof f=="function"&&h.addEventListener("processorerror",f)}}}),h.addEventListener=(m=>(...p)=>{if(p[0]==="processorerror"){const _=typeof p[1]=="function"?p[1]:typeof p[1]=="object"&&p[1]!==null&&typeof p[1].handleEvent=="function"?p[1].handleEvent:null;if(_!==null){const y=d.get(p[1]);y!==void 0?p[1]=y:(p[1]=S=>{S.type==="error"?(Object.defineProperties(S,{type:{value:"processorerror"}}),_(S)):_(new ErrorEvent(p[0],{...S}))},d.set(_,p[1]))}}return m.call(h,"error",p[1],p[2]),m.call(h,...p)})(h.addEventListener),h.removeEventListener=(m=>(...p)=>{if(p[0]==="processorerror"){const _=d.get(p[1]);_!==void 0&&(d.delete(p[1]),p[1]=_)}return m.call(h,"error",p[1],p[2]),m.call(h,p[0],p[1],p[2])})(h.removeEventListener),u.numberOfOutputs!==0){const m=t(r,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return h.connect(m).connect(r.destination),i(h,()=>m.disconnect(),()=>m.connect(r.destination))}return h}catch(h){throw h.code===11?s():h}if(l===void 0)throw s();return nv(u),e(r,o,l,u)},nh=(n,e)=>n===null?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2(n*e))))),rv=n=>new Promise((e,t)=>{const{port1:s,port2:i}=new MessageChannel;s.onmessage=({data:r})=>{s.close(),i.close(),e(r)},s.onmessageerror=({data:r})=>{s.close(),i.close(),t(r)},i.postMessage(n)}),ov=async(n,e)=>{const t=await rv(e);return new n(t)},av=(n,e,t,s)=>{let i=ma.get(n);i===void 0&&(i=new WeakMap,ma.set(n,i));const r=ov(t,s);return i.set(e,r),r},cv=(n,e,t,s,i,r,o,a,c,l,u,h,d)=>(f,m,p,_)=>{if(_.numberOfInputs===0&&_.numberOfOutputs===0)throw c();const y=Array.isArray(_.outputChannelCount)?_.outputChannelCount:Array.from(_.outputChannelCount);if(y.some(U=>U<1))throw c();if(y.length!==_.numberOfOutputs)throw e();if(_.channelCountMode!=="explicit")throw c();const S=_.channelCount*_.numberOfInputs,b=y.reduce((U,j)=>U+j,0),v=p.parameterDescriptors===void 0?0:p.parameterDescriptors.length;if(S+v>6||b>6)throw c();const g=new MessageChannel,x=[],T=[];for(let U=0;U<_.numberOfInputs;U+=1)x.push(o(f,{channelCount:_.channelCount,channelCountMode:_.channelCountMode,channelInterpretation:_.channelInterpretation,gain:1})),T.push(i(f,{channelCount:_.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:_.channelCount}));const w=[];if(p.parameterDescriptors!==void 0)for(const{defaultValue:U,maxValue:j,minValue:Le,name:xe}of p.parameterDescriptors){const ne=r(f,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:_.parameterData[xe]!==void 0?_.parameterData[xe]:U===void 0?0:U});Object.defineProperties(ne.offset,{defaultValue:{get:()=>U===void 0?0:U},maxValue:{get:()=>j===void 0?Qe:j},minValue:{get:()=>Le===void 0?nt:Le}}),w.push(ne)}const C=s(f,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,S+v)}),E=nh(m,f.sampleRate),O=a(f,E,S+v,Math.max(1,b)),A=i(f,{channelCount:Math.max(1,b),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,b)}),D=[];for(let U=0;U<_.numberOfOutputs;U+=1)D.push(s(f,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:y[U]}));for(let U=0;U<_.numberOfInputs;U+=1){x[U].connect(T[U]);for(let j=0;j<_.channelCount;j+=1)T[U].connect(C,j,U*_.channelCount+j)}const R=new eh(p.parameterDescriptors===void 0?[]:p.parameterDescriptors.map(({name:U},j)=>{const Le=w[j];return Le.connect(C,0,S+j),Le.start(0),[U,Le.offset]}));C.connect(O);let I=_.channelInterpretation,N=null;const F=_.numberOfOutputs===0?[O]:D,z={get bufferSize(){return E},get channelCount(){return _.channelCount},set channelCount(U){throw t()},get channelCountMode(){return _.channelCountMode},set channelCountMode(U){throw t()},get channelInterpretation(){return I},set channelInterpretation(U){for(const j of x)j.channelInterpretation=U;I=U},get context(){return O.context},get inputs(){return x},get numberOfInputs(){return _.numberOfInputs},get numberOfOutputs(){return _.numberOfOutputs},get onprocessorerror(){return N},set onprocessorerror(U){typeof N=="function"&&z.removeEventListener("processorerror",N),N=typeof U=="function"?U:null,typeof N=="function"&&z.addEventListener("processorerror",N)},get parameters(){return R},get port(){return g.port2},addEventListener(...U){return O.addEventListener(U[0],U[1],U[2])},connect:n.bind(null,F),disconnect:l.bind(null,F),dispatchEvent(...U){return O.dispatchEvent(U[0])},removeEventListener(...U){return O.removeEventListener(U[0],U[1],U[2])}},B=new Map;g.port1.addEventListener=(U=>(...j)=>{if(j[0]==="message"){const Le=typeof j[1]=="function"?j[1]:typeof j[1]=="object"&&j[1]!==null&&typeof j[1].handleEvent=="function"?j[1].handleEvent:null;if(Le!==null){const xe=B.get(j[1]);xe!==void 0?j[1]=xe:(j[1]=ne=>{u(f.currentTime,f.sampleRate,()=>Le(ne))},B.set(Le,j[1]))}}return U.call(g.port1,j[0],j[1],j[2])})(g.port1.addEventListener),g.port1.removeEventListener=(U=>(...j)=>{if(j[0]==="message"){const Le=B.get(j[1]);Le!==void 0&&(B.delete(j[1]),j[1]=Le)}return U.call(g.port1,j[0],j[1],j[2])})(g.port1.removeEventListener);let q=null;Object.defineProperty(g.port1,"onmessage",{get:()=>q,set:U=>{typeof q=="function"&&g.port1.removeEventListener("message",q),q=typeof U=="function"?U:null,typeof q=="function"&&(g.port1.addEventListener("message",q),g.port1.start())}}),p.prototype.port=g.port1;let V=null;av(f,z,p,_).then(U=>V=U);const ve=Wr(_.numberOfInputs,_.channelCount),re=Wr(_.numberOfOutputs,y),Z=p.parameterDescriptors===void 0?[]:p.parameterDescriptors.reduce((U,{name:j})=>({...U,[j]:new Float32Array(128)}),{});let fe=!0;const We=()=>{_.numberOfOutputs>0&&O.disconnect(A);for(let U=0,j=0;U<_.numberOfOutputs;U+=1){const Le=D[U];for(let xe=0;xe<y[U];xe+=1)A.disconnect(Le,j+xe,xe);j+=y[U]}},H=new Map;O.onaudioprocess=({inputBuffer:U,outputBuffer:j})=>{if(V!==null){const Le=h(z);for(let xe=0;xe<E;xe+=128){for(let ne=0;ne<_.numberOfInputs;ne+=1)for(let Ce=0;Ce<_.channelCount;Ce+=1)qr(U,ve[ne],Ce,Ce,xe);p.parameterDescriptors!==void 0&&p.parameterDescriptors.forEach(({name:ne},Ce)=>{qr(U,Z,ne,S+Ce,xe)});for(let ne=0;ne<_.numberOfInputs;ne+=1)for(let Ce=0;Ce<y[ne];Ce+=1)re[ne][Ce].byteLength===0&&(re[ne][Ce]=new Float32Array(128));try{const ne=ve.map((vt,gs)=>{if(Le[gs].size>0)return H.set(gs,E/128),vt;const So=H.get(gs);return So===void 0?[]:(vt.every(Zh=>Zh.every(Xh=>Xh===0))&&(So===1?H.delete(gs):H.set(gs,So-1)),vt)});fe=u(f.currentTime+xe/f.sampleRate,f.sampleRate,()=>V.process(ne,re,Z));for(let vt=0,gs=0;vt<_.numberOfOutputs;vt+=1){for(let ti=0;ti<y[vt];ti+=1)th(j,re[vt],ti,gs+ti,xe);gs+=y[vt]}}catch(ne){fe=!1,z.dispatchEvent(new ErrorEvent("processorerror",{colno:ne.colno,filename:ne.filename,lineno:ne.lineno,message:ne.message}))}if(!fe){for(let ne=0;ne<_.numberOfInputs;ne+=1){x[ne].disconnect(T[ne]);for(let Ce=0;Ce<_.channelCount;Ce+=1)T[xe].disconnect(C,Ce,ne*_.channelCount+Ce)}if(p.parameterDescriptors!==void 0){const ne=p.parameterDescriptors.length;for(let Ce=0;Ce<ne;Ce+=1){const vt=w[Ce];vt.disconnect(C,0,S+Ce),vt.stop()}}C.disconnect(O),O.onaudioprocess=null,Vs?We():_n();break}}}};let Vs=!1;const Hs=o(f,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),mn=()=>O.connect(Hs).connect(f.destination),_n=()=>{O.disconnect(Hs),Hs.disconnect()},jh=()=>{if(fe){_n(),_.numberOfOutputs>0&&O.connect(A);for(let U=0,j=0;U<_.numberOfOutputs;U+=1){const Le=D[U];for(let xe=0;xe<y[U];xe+=1)A.connect(Le,j+xe,xe);j+=y[U]}}Vs=!0},Yh=()=>{fe&&(mn(),We()),Vs=!1};return mn(),d(z,jh,Yh)},ih=(n,e)=>{const t=n.createBiquadFilter();return Be(t,e),Oe(t,e,"Q"),Oe(t,e,"detune"),Oe(t,e,"frequency"),Oe(t,e,"gain"),Te(t,e,"type"),t},lv=(n,e)=>(t,s)=>{const i=t.createChannelMerger(s.numberOfInputs);return n!==null&&n.name==="webkitAudioContext"&&e(t,i),Be(i,s),i},uv=n=>{const e=n.numberOfOutputs;Object.defineProperty(n,"channelCount",{get:()=>e,set:t=>{if(t!==e)throw He()}}),Object.defineProperty(n,"channelCountMode",{get:()=>"explicit",set:t=>{if(t!=="explicit")throw He()}}),Object.defineProperty(n,"channelInterpretation",{get:()=>"discrete",set:t=>{if(t!=="discrete")throw He()}})},tr=(n,e)=>{const t=n.createChannelSplitter(e.numberOfOutputs);return Be(t,e),uv(t),t},hv=(n,e,t,s,i)=>(r,o)=>{if(r.createConstantSource===void 0)return t(r,o);const a=r.createConstantSource();return Be(a,o),Oe(a,o,"offset"),e(s,()=>s(r))||Qa(a),e(i,()=>i(r))||Ka(a),n(r,a),a},Qn=(n,e)=>(n.connect=e.connect.bind(e),n.disconnect=e.disconnect.bind(e),n),dv=(n,e,t,s)=>(i,{offset:r,...o})=>{const a=i.createBuffer(1,2,44100),c=e(i,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),l=t(i,{...o,gain:r}),u=a.getChannelData(0);u[0]=1,u[1]=1,c.buffer=a,c.loop=!0;const h={get bufferSize(){},get channelCount(){return l.channelCount},set channelCount(m){l.channelCount=m},get channelCountMode(){return l.channelCountMode},set channelCountMode(m){l.channelCountMode=m},get channelInterpretation(){return l.channelInterpretation},set channelInterpretation(m){l.channelInterpretation=m},get context(){return l.context},get inputs(){return[]},get numberOfInputs(){return c.numberOfInputs},get numberOfOutputs(){return l.numberOfOutputs},get offset(){return l.gain},get onended(){return c.onended},set onended(m){c.onended=m},addEventListener(...m){return c.addEventListener(m[0],m[1],m[2])},dispatchEvent(...m){return c.dispatchEvent(m[0])},removeEventListener(...m){return c.removeEventListener(m[0],m[1],m[2])},start(m=0){c.start.call(c,m)},stop(m=0){c.stop.call(c,m)}},d=()=>c.connect(l),f=()=>c.disconnect(l);return n(i,c),s(Qn(h,l),d,f)},fv=(n,e)=>(t,s)=>{const i=t.createConvolver();if(Be(i,s),s.disableNormalization===i.normalize&&(i.normalize=!s.disableNormalization),Te(i,s,"buffer"),s.channelCount>2||(e(i,"channelCount",r=>()=>r.call(i),r=>o=>{if(o>2)throw n();return r.call(i,o)}),s.channelCountMode==="max"))throw n();return e(i,"channelCountMode",r=>()=>r.call(i),r=>o=>{if(o==="max")throw n();return r.call(i,o)}),i},rh=(n,e)=>{const t=n.createDelay(e.maxDelayTime);return Be(t,e),Oe(t,e,"delayTime"),t},pv=n=>(e,t)=>{const s=e.createDynamicsCompressor();if(Be(s,t),t.channelCount>2||t.channelCountMode==="max")throw n();return Oe(s,t,"attack"),Oe(s,t,"knee"),Oe(s,t,"ratio"),Oe(s,t,"release"),Oe(s,t,"threshold"),s},ut=(n,e)=>{const t=n.createGain();return Be(t,e),Oe(t,e,"gain"),t},mv=n=>(e,t,s)=>{if(e.createIIRFilter===void 0)return n(e,t,s);const i=e.createIIRFilter(s.feedforward,s.feedback);return Be(i,s),i};function _v(n,e){const t=e[0]*e[0]+e[1]*e[1];return[(n[0]*e[0]+n[1]*e[1])/t,(n[1]*e[0]-n[0]*e[1])/t]}function gv(n,e){return[n[0]*e[0]-n[1]*e[1],n[0]*e[1]+n[1]*e[0]]}function ml(n,e){let t=[0,0];for(let s=n.length-1;s>=0;s-=1)t=gv(t,e),t[0]+=n[s];return t}const vv=(n,e,t,s)=>(i,r,{channelCount:o,channelCountMode:a,channelInterpretation:c,feedback:l,feedforward:u})=>{const h=nh(r,i.sampleRate),d=l instanceof Float64Array?l:new Float64Array(l),f=u instanceof Float64Array?u:new Float64Array(u),m=d.length,p=f.length,_=Math.min(m,p);if(m===0||m>20)throw s();if(d[0]===0)throw e();if(p===0||p>20)throw s();if(f[0]===0)throw e();if(d[0]!==1){for(let w=0;w<p;w+=1)f[w]/=d[0];for(let w=1;w<m;w+=1)d[w]/=d[0]}const y=t(i,h,o,o);y.channelCount=o,y.channelCountMode=a,y.channelInterpretation=c;const S=32,b=[],v=[],g=[];for(let w=0;w<o;w+=1){b.push(0);const C=new Float32Array(S),E=new Float32Array(S);C.fill(0),E.fill(0),v.push(C),g.push(E)}y.onaudioprocess=w=>{const C=w.inputBuffer,E=w.outputBuffer,O=C.numberOfChannels;for(let A=0;A<O;A+=1){const D=C.getChannelData(A),R=E.getChannelData(A);b[A]=sh(d,m,f,p,_,v[A],g[A],b[A],S,D,R)}};const x=i.sampleRate/2;return Qn({get bufferSize(){return h},get channelCount(){return y.channelCount},set channelCount(w){y.channelCount=w},get channelCountMode(){return y.channelCountMode},set channelCountMode(w){y.channelCountMode=w},get channelInterpretation(){return y.channelInterpretation},set channelInterpretation(w){y.channelInterpretation=w},get context(){return y.context},get inputs(){return[y]},get numberOfInputs(){return y.numberOfInputs},get numberOfOutputs(){return y.numberOfOutputs},addEventListener(...w){return y.addEventListener(w[0],w[1],w[2])},dispatchEvent(...w){return y.dispatchEvent(w[0])},getFrequencyResponse(w,C,E){if(w.length!==C.length||C.length!==E.length)throw n();const O=w.length;for(let A=0;A<O;A+=1){const D=-Math.PI*(w[A]/x),R=[Math.cos(D),Math.sin(D)],I=ml(f,R),N=ml(d,R),F=_v(I,N);C[A]=Math.sqrt(F[0]*F[0]+F[1]*F[1]),E[A]=Math.atan2(F[1],F[0])}},removeEventListener(...w){return y.removeEventListener(w[0],w[1],w[2])}},y)},yv=(n,e)=>n.createMediaElementSource(e.mediaElement),Tv=(n,e)=>{const t=n.createMediaStreamDestination();return Be(t,e),t.numberOfOutputs===1&&Object.defineProperty(t,"numberOfOutputs",{get:()=>0}),t},xv=(n,{mediaStream:e})=>{const t=e.getAudioTracks();t.sort((r,o)=>r.id<o.id?-1:r.id>o.id?1:0);const s=t.slice(0,1),i=n.createMediaStreamSource(new MediaStream(s));return Object.defineProperty(i,"mediaStream",{value:e}),i},wv=(n,e)=>(t,{mediaStreamTrack:s})=>{if(typeof t.createMediaStreamTrackSource=="function")return t.createMediaStreamTrackSource(s);const i=new MediaStream([s]),r=t.createMediaStreamSource(i);if(s.kind!=="audio")throw n();if(e(t))throw new TypeError;return r},Sv=n=>n===null?null:n.hasOwnProperty("OfflineAudioContext")?n.OfflineAudioContext:n.hasOwnProperty("webkitOfflineAudioContext")?n.webkitOfflineAudioContext:null,bv=(n,e,t,s,i,r)=>(o,a)=>{const c=o.createOscillator();return Be(c,a),Oe(c,a,"detune"),Oe(c,a,"frequency"),a.periodicWave!==void 0?c.setPeriodicWave(a.periodicWave):Te(c,a,"type"),e(t,()=>t(o))||Qa(c),e(s,()=>s(o))||r(c,o),e(i,()=>i(o))||Ka(c),n(o,c),c},Cv=n=>(e,t)=>{const s=e.createPanner();return s.orientationX===void 0?n(e,t):(Be(s,t),Oe(s,t,"orientationX"),Oe(s,t,"orientationY"),Oe(s,t,"orientationZ"),Oe(s,t,"positionX"),Oe(s,t,"positionY"),Oe(s,t,"positionZ"),Te(s,t,"coneInnerAngle"),Te(s,t,"coneOuterAngle"),Te(s,t,"coneOuterGain"),Te(s,t,"distanceModel"),Te(s,t,"maxDistance"),Te(s,t,"panningModel"),Te(s,t,"refDistance"),Te(s,t,"rolloffFactor"),s)},Ev=(n,e,t,s,i,r,o,a,c,l)=>(u,{coneInnerAngle:h,coneOuterAngle:d,coneOuterGain:f,distanceModel:m,maxDistance:p,orientationX:_,orientationY:y,orientationZ:S,panningModel:b,positionX:v,positionY:g,positionZ:x,refDistance:T,rolloffFactor:w,...C})=>{const E=u.createPanner();if(C.channelCount>2||C.channelCountMode==="max")throw o();Be(E,C);const O={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},A=t(u,{...O,channelInterpretation:"speakers",numberOfInputs:6}),D=s(u,{...C,gain:1}),R=s(u,{...O,gain:1}),I=s(u,{...O,gain:0}),N=s(u,{...O,gain:0}),F=s(u,{...O,gain:0}),z=s(u,{...O,gain:0}),B=s(u,{...O,gain:0}),q=i(u,256,6,1),V=r(u,{...O,curve:new Float32Array([1,1]),oversample:"none"});let L=[_,y,S],ve=[v,g,x];const re=new Float32Array(1);q.onaudioprocess=({inputBuffer:H})=>{const Vs=[c(H,re,0),c(H,re,1),c(H,re,2)];Vs.some((mn,_n)=>mn!==L[_n])&&(E.setOrientation(...Vs),L=Vs);const Hs=[c(H,re,3),c(H,re,4),c(H,re,5)];Hs.some((mn,_n)=>mn!==ve[_n])&&(E.setPosition(...Hs),ve=Hs)},Object.defineProperty(I.gain,"defaultValue",{get:()=>0}),Object.defineProperty(N.gain,"defaultValue",{get:()=>0}),Object.defineProperty(F.gain,"defaultValue",{get:()=>0}),Object.defineProperty(z.gain,"defaultValue",{get:()=>0}),Object.defineProperty(B.gain,"defaultValue",{get:()=>0});const Z={get bufferSize(){},get channelCount(){return E.channelCount},set channelCount(H){if(H>2)throw o();D.channelCount=H,E.channelCount=H},get channelCountMode(){return E.channelCountMode},set channelCountMode(H){if(H==="max")throw o();D.channelCountMode=H,E.channelCountMode=H},get channelInterpretation(){return E.channelInterpretation},set channelInterpretation(H){D.channelInterpretation=H,E.channelInterpretation=H},get coneInnerAngle(){return E.coneInnerAngle},set coneInnerAngle(H){E.coneInnerAngle=H},get coneOuterAngle(){return E.coneOuterAngle},set coneOuterAngle(H){E.coneOuterAngle=H},get coneOuterGain(){return E.coneOuterGain},set coneOuterGain(H){if(H<0||H>1)throw e();E.coneOuterGain=H},get context(){return E.context},get distanceModel(){return E.distanceModel},set distanceModel(H){E.distanceModel=H},get inputs(){return[D]},get maxDistance(){return E.maxDistance},set maxDistance(H){if(H<0)throw new RangeError;E.maxDistance=H},get numberOfInputs(){return E.numberOfInputs},get numberOfOutputs(){return E.numberOfOutputs},get orientationX(){return R.gain},get orientationY(){return I.gain},get orientationZ(){return N.gain},get panningModel(){return E.panningModel},set panningModel(H){E.panningModel=H},get positionX(){return F.gain},get positionY(){return z.gain},get positionZ(){return B.gain},get refDistance(){return E.refDistance},set refDistance(H){if(H<0)throw new RangeError;E.refDistance=H},get rolloffFactor(){return E.rolloffFactor},set rolloffFactor(H){if(H<0)throw new RangeError;E.rolloffFactor=H},addEventListener(...H){return D.addEventListener(H[0],H[1],H[2])},dispatchEvent(...H){return D.dispatchEvent(H[0])},removeEventListener(...H){return D.removeEventListener(H[0],H[1],H[2])}};h!==Z.coneInnerAngle&&(Z.coneInnerAngle=h),d!==Z.coneOuterAngle&&(Z.coneOuterAngle=d),f!==Z.coneOuterGain&&(Z.coneOuterGain=f),m!==Z.distanceModel&&(Z.distanceModel=m),p!==Z.maxDistance&&(Z.maxDistance=p),_!==Z.orientationX.value&&(Z.orientationX.value=_),y!==Z.orientationY.value&&(Z.orientationY.value=y),S!==Z.orientationZ.value&&(Z.orientationZ.value=S),b!==Z.panningModel&&(Z.panningModel=b),v!==Z.positionX.value&&(Z.positionX.value=v),g!==Z.positionY.value&&(Z.positionY.value=g),x!==Z.positionZ.value&&(Z.positionZ.value=x),T!==Z.refDistance&&(Z.refDistance=T),w!==Z.rolloffFactor&&(Z.rolloffFactor=w),(L[0]!==1||L[1]!==0||L[2]!==0)&&E.setOrientation(...L),(ve[0]!==0||ve[1]!==0||ve[2]!==0)&&E.setPosition(...ve);const fe=()=>{D.connect(E),n(D,V,0,0),V.connect(R).connect(A,0,0),V.connect(I).connect(A,0,1),V.connect(N).connect(A,0,2),V.connect(F).connect(A,0,3),V.connect(z).connect(A,0,4),V.connect(B).connect(A,0,5),A.connect(q).connect(u.destination)},We=()=>{D.disconnect(E),a(D,V,0,0),V.disconnect(R),R.disconnect(A),V.disconnect(I),I.disconnect(A),V.disconnect(N),N.disconnect(A),V.disconnect(F),F.disconnect(A),V.disconnect(z),z.disconnect(A),V.disconnect(B),B.disconnect(A),A.disconnect(q),q.disconnect(u.destination)};return l(Qn(Z,E),fe,We)},Ov=n=>(e,{disableNormalization:t,imag:s,real:i})=>{const r=s instanceof Float32Array?s:new Float32Array(s),o=i instanceof Float32Array?i:new Float32Array(i),a=e.createPeriodicWave(o,r,{disableNormalization:t});if(Array.from(s).length<2)throw n();return a},sr=(n,e,t,s)=>n.createScriptProcessor(e,t,s),Av=(n,e)=>(t,s)=>{const i=s.channelCountMode;if(i==="clamped-max")throw e();if(t.createStereoPanner===void 0)return n(t,s);const r=t.createStereoPanner();return Be(r,s),Oe(r,s,"pan"),Object.defineProperty(r,"channelCountMode",{get:()=>i,set:o=>{if(o!==i)throw e()}}),r},Mv=(n,e,t,s,i,r)=>{const a=new Float32Array([1,1]),c=Math.PI/2,l={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},u={...l,oversample:"none"},h=(m,p,_,y)=>{const S=new Float32Array(16385),b=new Float32Array(16385);for(let C=0;C<16385;C+=1){const E=C/16384*c;S[C]=Math.cos(E),b[C]=Math.sin(E)}const v=t(m,{...l,gain:0}),g=s(m,{...u,curve:S}),x=s(m,{...u,curve:a}),T=t(m,{...l,gain:0}),w=s(m,{...u,curve:b});return{connectGraph(){p.connect(v),p.connect(x.inputs===void 0?x:x.inputs[0]),p.connect(T),x.connect(_),_.connect(g.inputs===void 0?g:g.inputs[0]),_.connect(w.inputs===void 0?w:w.inputs[0]),g.connect(v.gain),w.connect(T.gain),v.connect(y,0,0),T.connect(y,0,1)},disconnectGraph(){p.disconnect(v),p.disconnect(x.inputs===void 0?x:x.inputs[0]),p.disconnect(T),x.disconnect(_),_.disconnect(g.inputs===void 0?g:g.inputs[0]),_.disconnect(w.inputs===void 0?w:w.inputs[0]),g.disconnect(v.gain),w.disconnect(T.gain),v.disconnect(y,0,0),T.disconnect(y,0,1)}}},d=(m,p,_,y)=>{const S=new Float32Array(16385),b=new Float32Array(16385),v=new Float32Array(16385),g=new Float32Array(16385),x=Math.floor(16385/2);for(let F=0;F<16385;F+=1)if(F>x){const z=(F-x)/(16384-x)*c;S[F]=Math.cos(z),b[F]=Math.sin(z),v[F]=0,g[F]=1}else{const z=F/(16384-x)*c;S[F]=1,b[F]=0,v[F]=Math.cos(z),g[F]=Math.sin(z)}const T=e(m,{channelCount:2,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:2}),w=t(m,{...l,gain:0}),C=s(m,{...u,curve:S}),E=t(m,{...l,gain:0}),O=s(m,{...u,curve:b}),A=s(m,{...u,curve:a}),D=t(m,{...l,gain:0}),R=s(m,{...u,curve:v}),I=t(m,{...l,gain:0}),N=s(m,{...u,curve:g});return{connectGraph(){p.connect(T),p.connect(A.inputs===void 0?A:A.inputs[0]),T.connect(w,0),T.connect(E,0),T.connect(D,1),T.connect(I,1),A.connect(_),_.connect(C.inputs===void 0?C:C.inputs[0]),_.connect(O.inputs===void 0?O:O.inputs[0]),_.connect(R.inputs===void 0?R:R.inputs[0]),_.connect(N.inputs===void 0?N:N.inputs[0]),C.connect(w.gain),O.connect(E.gain),R.connect(D.gain),N.connect(I.gain),w.connect(y,0,0),D.connect(y,0,0),E.connect(y,0,1),I.connect(y,0,1)},disconnectGraph(){p.disconnect(T),p.disconnect(A.inputs===void 0?A:A.inputs[0]),T.disconnect(w,0),T.disconnect(E,0),T.disconnect(D,1),T.disconnect(I,1),A.disconnect(_),_.disconnect(C.inputs===void 0?C:C.inputs[0]),_.disconnect(O.inputs===void 0?O:O.inputs[0]),_.disconnect(R.inputs===void 0?R:R.inputs[0]),_.disconnect(N.inputs===void 0?N:N.inputs[0]),C.disconnect(w.gain),O.disconnect(E.gain),R.disconnect(D.gain),N.disconnect(I.gain),w.disconnect(y,0,0),D.disconnect(y,0,0),E.disconnect(y,0,1),I.disconnect(y,0,1)}}},f=(m,p,_,y,S)=>{if(p===1)return h(m,_,y,S);if(p===2)return d(m,_,y,S);throw i()};return(m,{channelCount:p,channelCountMode:_,pan:y,...S})=>{if(_==="max")throw i();const b=n(m,{...S,channelCount:1,channelCountMode:_,numberOfInputs:2}),v=t(m,{...S,channelCount:p,channelCountMode:_,gain:1}),g=t(m,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:y});let{connectGraph:x,disconnectGraph:T}=f(m,p,v,g,b);Object.defineProperty(g.gain,"defaultValue",{get:()=>0}),Object.defineProperty(g.gain,"maxValue",{get:()=>1}),Object.defineProperty(g.gain,"minValue",{get:()=>-1});const w={get bufferSize(){},get channelCount(){return v.channelCount},set channelCount(A){v.channelCount!==A&&(C&&T(),{connectGraph:x,disconnectGraph:T}=f(m,A,v,g,b),C&&x()),v.channelCount=A},get channelCountMode(){return v.channelCountMode},set channelCountMode(A){if(A==="clamped-max"||A==="max")throw i();v.channelCountMode=A},get channelInterpretation(){return v.channelInterpretation},set channelInterpretation(A){v.channelInterpretation=A},get context(){return v.context},get inputs(){return[v]},get numberOfInputs(){return v.numberOfInputs},get numberOfOutputs(){return v.numberOfOutputs},get pan(){return g.gain},addEventListener(...A){return v.addEventListener(A[0],A[1],A[2])},dispatchEvent(...A){return v.dispatchEvent(A[0])},removeEventListener(...A){return v.removeEventListener(A[0],A[1],A[2])}};let C=!1;const E=()=>{x(),C=!0},O=()=>{T(),C=!1};return r(Qn(w,b),E,O)}},Dv=(n,e,t,s,i,r,o)=>(a,c)=>{const l=a.createWaveShaper();if(r!==null&&r.name==="webkitAudioContext"&&a.createGain().gain.automationRate===void 0)return t(a,c);Be(l,c);const u=c.curve===null||c.curve instanceof Float32Array?c.curve:new Float32Array(c.curve);if(u!==null&&u.length<2)throw e();Te(l,{curve:u},"curve"),Te(l,c,"oversample");let h=null,d=!1;return o(l,"curve",p=>()=>p.call(l),p=>_=>(p.call(l,_),d&&(s(_)&&h===null?h=n(a,l):!s(_)&&h!==null&&(h(),h=null)),_)),i(l,()=>{d=!0,s(l.curve)&&(h=n(a,l))},()=>{d=!1,h!==null&&(h(),h=null)})},kv=(n,e,t,s,i)=>(r,{curve:o,oversample:a,...c})=>{const l=r.createWaveShaper(),u=r.createWaveShaper();Be(l,c),Be(u,c);const h=t(r,{...c,gain:1}),d=t(r,{...c,gain:-1}),f=t(r,{...c,gain:1}),m=t(r,{...c,gain:-1});let p=null,_=!1,y=null;const S={get bufferSize(){},get channelCount(){return l.channelCount},set channelCount(g){h.channelCount=g,d.channelCount=g,l.channelCount=g,f.channelCount=g,u.channelCount=g,m.channelCount=g},get channelCountMode(){return l.channelCountMode},set channelCountMode(g){h.channelCountMode=g,d.channelCountMode=g,l.channelCountMode=g,f.channelCountMode=g,u.channelCountMode=g,m.channelCountMode=g},get channelInterpretation(){return l.channelInterpretation},set channelInterpretation(g){h.channelInterpretation=g,d.channelInterpretation=g,l.channelInterpretation=g,f.channelInterpretation=g,u.channelInterpretation=g,m.channelInterpretation=g},get context(){return l.context},get curve(){return y},set curve(g){if(g!==null&&g.length<2)throw e();if(g===null)l.curve=g,u.curve=g;else{const x=g.length,T=new Float32Array(x+2-x%2),w=new Float32Array(x+2-x%2);T[0]=g[0],w[0]=-g[x-1];const C=Math.ceil((x+1)/2),E=(x+1)/2-1;for(let O=1;O<C;O+=1){const A=O/C*E,D=Math.floor(A),R=Math.ceil(A);T[O]=D===R?g[D]:(1-(A-D))*g[D]+(1-(R-A))*g[R],w[O]=D===R?-g[x-1-D]:-((1-(A-D))*g[x-1-D])-(1-(R-A))*g[x-1-R]}T[C]=x%2===1?g[C-1]:(g[C-2]+g[C-1])/2,l.curve=T,u.curve=w}y=g,_&&(s(y)&&p===null?p=n(r,h):p!==null&&(p(),p=null))},get inputs(){return[h]},get numberOfInputs(){return l.numberOfInputs},get numberOfOutputs(){return l.numberOfOutputs},get oversample(){return l.oversample},set oversample(g){l.oversample=g,u.oversample=g},addEventListener(...g){return h.addEventListener(g[0],g[1],g[2])},dispatchEvent(...g){return h.dispatchEvent(g[0])},removeEventListener(...g){return h.removeEventListener(g[0],g[1],g[2])}};o!==null&&(S.curve=o instanceof Float32Array?o:new Float32Array(o)),a!==S.oversample&&(S.oversample=a);const b=()=>{h.connect(l).connect(f),h.connect(d).connect(u).connect(m).connect(f),_=!0,s(y)&&(p=n(r,h))},v=()=>{h.disconnect(l),l.disconnect(f),h.disconnect(d),d.disconnect(u),u.disconnect(m),m.disconnect(f),_=!1,p!==null&&(p(),p=null)};return i(Qn(S,f),b,v)},tt=()=>new DOMException("","NotSupportedError"),Rv={numberOfChannels:1},Pv=(n,e,t,s,i)=>class extends n{constructor(o,a,c){let l;if(typeof o=="number"&&a!==void 0&&c!==void 0)l={length:a,numberOfChannels:o,sampleRate:c};else if(typeof o=="object")l=o;else throw new Error("The given parameters are not valid.");const{length:u,numberOfChannels:h,sampleRate:d}={...Rv,...l},f=s(h,u,d);e(ki,()=>ki(f))||f.addEventListener("statechange",(()=>{let m=0;const p=_=>{this._state==="running"&&(m>0?(f.removeEventListener("statechange",p),_.stopImmediatePropagation(),this._waitForThePromiseToSettle(_)):m+=1)};return p})()),super(f,h),this._length=u,this._nativeOfflineAudioContext=f,this._state=null}get length(){return this._nativeOfflineAudioContext.length===void 0?this._length:this._nativeOfflineAudioContext.length}get state(){return this._state===null?this._nativeOfflineAudioContext.state:this._state}startRendering(){return this._state==="running"?Promise.reject(t()):(this._state="running",i(this.destination,this._nativeOfflineAudioContext).finally(()=>{this._state=null,$u(this)}))}_waitForThePromiseToSettle(o){this._state===null?this._nativeOfflineAudioContext.dispatchEvent(o):setTimeout(()=>this._waitForThePromiseToSettle(o))}},Nv={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:440,periodicWave:void 0,type:"sine"},Iv=(n,e,t,s,i,r,o)=>class extends n{constructor(c,l){const u=i(c),h={...Nv,...l},d=t(u,h),f=r(u),m=f?s():null,p=c.sampleRate/2;super(c,!1,d,m),this._detune=e(this,f,d.detune,153600,-153600),this._frequency=e(this,f,d.frequency,p,-p),this._nativeOscillatorNode=d,this._onended=null,this._oscillatorNodeRenderer=m,this._oscillatorNodeRenderer!==null&&h.periodicWave!==void 0&&(this._oscillatorNodeRenderer.periodicWave=h.periodicWave)}get detune(){return this._detune}get frequency(){return this._frequency}get onended(){return this._onended}set onended(c){const l=typeof c=="function"?o(this,c):null;this._nativeOscillatorNode.onended=l;const u=this._nativeOscillatorNode.onended;this._onended=u!==null&&u===l?c:u}get type(){return this._nativeOscillatorNode.type}set type(c){this._nativeOscillatorNode.type=c,this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=null)}setPeriodicWave(c){this._nativeOscillatorNode.setPeriodicWave(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=c)}start(c=0){if(this._nativeOscillatorNode.start(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.start=c),this.context.state!=="closed"){qn(this);const l=()=>{this._nativeOscillatorNode.removeEventListener("ended",l),os(this)&&Ki(this)};this._nativeOscillatorNode.addEventListener("ended",l)}}stop(c=0){this._nativeOscillatorNode.stop(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.stop=c)}},Fv=(n,e,t,s,i)=>()=>{const r=new WeakMap;let o=null,a=null,c=null;const l=async(u,h)=>{let d=t(u);const f=$e(d,h);if(!f){const m={channelCount:d.channelCount,channelCountMode:d.channelCountMode,channelInterpretation:d.channelInterpretation,detune:d.detune.value,frequency:d.frequency.value,periodicWave:o===null?void 0:o,type:d.type};d=e(h,m),a!==null&&d.start(a),c!==null&&d.stop(c)}return r.set(h,d),f?(await n(h,u.detune,d.detune),await n(h,u.frequency,d.frequency)):(await s(h,u.detune,d.detune),await s(h,u.frequency,d.frequency)),await i(u,h,d),d};return{set periodicWave(u){o=u},set start(u){a=u},set stop(u){c=u},render(u,h){const d=r.get(h);return d!==void 0?Promise.resolve(d):l(u,h)}}},Uv={channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:1,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1},Lv=(n,e,t,s,i,r,o)=>class extends n{constructor(c,l){const u=i(c),h={...Uv,...l},d=t(u,h),f=r(u),m=f?s():null;super(c,!1,d,m),this._nativePannerNode=d,this._orientationX=e(this,f,d.orientationX,Qe,nt),this._orientationY=e(this,f,d.orientationY,Qe,nt),this._orientationZ=e(this,f,d.orientationZ,Qe,nt),this._positionX=e(this,f,d.positionX,Qe,nt),this._positionY=e(this,f,d.positionY,Qe,nt),this._positionZ=e(this,f,d.positionZ,Qe,nt),o(this,1)}get coneInnerAngle(){return this._nativePannerNode.coneInnerAngle}set coneInnerAngle(c){this._nativePannerNode.coneInnerAngle=c}get coneOuterAngle(){return this._nativePannerNode.coneOuterAngle}set coneOuterAngle(c){this._nativePannerNode.coneOuterAngle=c}get coneOuterGain(){return this._nativePannerNode.coneOuterGain}set coneOuterGain(c){this._nativePannerNode.coneOuterGain=c}get distanceModel(){return this._nativePannerNode.distanceModel}set distanceModel(c){this._nativePannerNode.distanceModel=c}get maxDistance(){return this._nativePannerNode.maxDistance}set maxDistance(c){this._nativePannerNode.maxDistance=c}get orientationX(){return this._orientationX}get orientationY(){return this._orientationY}get orientationZ(){return this._orientationZ}get panningModel(){return this._nativePannerNode.panningModel}set panningModel(c){this._nativePannerNode.panningModel=c}get positionX(){return this._positionX}get positionY(){return this._positionY}get positionZ(){return this._positionZ}get refDistance(){return this._nativePannerNode.refDistance}set refDistance(c){this._nativePannerNode.refDistance=c}get rolloffFactor(){return this._nativePannerNode.rolloffFactor}set rolloffFactor(c){this._nativePannerNode.rolloffFactor=c}},Bv=(n,e,t,s,i,r,o,a,c,l)=>()=>{const u=new WeakMap;let h=null;const d=async(f,m)=>{let p=null,_=r(f);const y={channelCount:_.channelCount,channelCountMode:_.channelCountMode,channelInterpretation:_.channelInterpretation},S={...y,coneInnerAngle:_.coneInnerAngle,coneOuterAngle:_.coneOuterAngle,coneOuterGain:_.coneOuterGain,distanceModel:_.distanceModel,maxDistance:_.maxDistance,panningModel:_.panningModel,refDistance:_.refDistance,rolloffFactor:_.rolloffFactor},b=$e(_,m);if("bufferSize"in _)p=s(m,{...y,gain:1});else if(!b){const v={...S,orientationX:_.orientationX.value,orientationY:_.orientationY.value,orientationZ:_.orientationZ.value,positionX:_.positionX.value,positionY:_.positionY.value,positionZ:_.positionZ.value};_=i(m,v)}if(u.set(m,p===null?_:p),p!==null){if(h===null){if(o===null)throw new Error("Missing the native OfflineAudioContext constructor.");const O=new o(6,f.context.length,m.sampleRate),A=e(O,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6});A.connect(O.destination),h=(async()=>{const D=await Promise.all([f.orientationX,f.orientationY,f.orientationZ,f.positionX,f.positionY,f.positionZ].map(async(R,I)=>{const N=t(O,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:I===0?1:0});return await a(O,R,N.offset),N}));for(let R=0;R<6;R+=1)D[R].connect(A,0,R),D[R].start(0);return l(O)})()}const v=await h,g=s(m,{...y,gain:1});await c(f,m,g);const x=[];for(let O=0;O<v.numberOfChannels;O+=1)x.push(v.getChannelData(O));let T=[x[0][0],x[1][0],x[2][0]],w=[x[3][0],x[4][0],x[5][0]],C=s(m,{...y,gain:1}),E=i(m,{...S,orientationX:T[0],orientationY:T[1],orientationZ:T[2],positionX:w[0],positionY:w[1],positionZ:w[2]});g.connect(C).connect(E.inputs[0]),E.connect(p);for(let O=128;O<v.length;O+=128){const A=[x[0][O],x[1][O],x[2][O]],D=[x[3][O],x[4][O],x[5][O]];if(A.some((R,I)=>R!==T[I])||D.some((R,I)=>R!==w[I])){T=A,w=D;const R=O/m.sampleRate;C.gain.setValueAtTime(0,R),C=s(m,{...y,gain:0}),E=i(m,{...S,orientationX:T[0],orientationY:T[1],orientationZ:T[2],positionX:w[0],positionY:w[1],positionZ:w[2]}),C.gain.setValueAtTime(1,R),g.connect(C).connect(E.inputs[0]),E.connect(p)}}return p}return b?(await n(m,f.orientationX,_.orientationX),await n(m,f.orientationY,_.orientationY),await n(m,f.orientationZ,_.orientationZ),await n(m,f.positionX,_.positionX),await n(m,f.positionY,_.positionY),await n(m,f.positionZ,_.positionZ)):(await a(m,f.orientationX,_.orientationX),await a(m,f.orientationY,_.orientationY),await a(m,f.orientationZ,_.orientationZ),await a(m,f.positionX,_.positionX),await a(m,f.positionY,_.positionY),await a(m,f.positionZ,_.positionZ)),$n(_)?await c(f,m,_.inputs[0]):await c(f,m,_),_};return{render(f,m){const p=u.get(m);return p!==void 0?Promise.resolve(p):d(f,m)}}},zv={disableNormalization:!1},Vv=(n,e,t,s)=>class oh{constructor(r,o){const a=e(r),c=s({...zv,...o}),l=n(a,c);return t.add(l),l}static[Symbol.hasInstance](r){return r!==null&&typeof r=="object"&&Object.getPrototypeOf(r)===oh.prototype||t.has(r)}},Hv=(n,e)=>(t,s,i)=>(n(s).replay(i),e(s,t,i)),qv=(n,e,t)=>async(s,i,r)=>{const o=n(s);await Promise.all(o.activeInputs.map((a,c)=>Array.from(a).map(async([l,u])=>{const d=await e(l).render(l,i),f=s.context.destination;!t(l)&&(s!==f||!t(s))&&d.connect(r,u,c)})).reduce((a,c)=>[...a,...c],[]))},Wv=(n,e,t)=>async(s,i,r)=>{const o=e(s);await Promise.all(Array.from(o.activeInputs).map(async([a,c])=>{const u=await n(a).render(a,i);t(a)||u.connect(r,c)}))},Gv=(n,e,t,s)=>i=>n(ki,()=>ki(i))?Promise.resolve(n(s,s)).then(r=>{if(!r){const o=t(i,512,0,1);i.oncomplete=()=>{o.onaudioprocess=null,o.disconnect()},o.onaudioprocess=()=>i.currentTime,o.connect(i.destination)}return i.startRendering()}):new Promise(r=>{const o=e(i,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});i.oncomplete=a=>{o.disconnect(),r(a.renderedBuffer)},o.connect(i.destination),i.startRendering()}),jv=n=>(e,t)=>{n.set(e,t)},Yv=n=>(e,t)=>n.set(e,t),Zv=(n,e,t,s,i,r,o,a)=>(c,l)=>t(c).render(c,l).then(()=>Promise.all(Array.from(s(l)).map(u=>t(u).render(u,l)))).then(()=>i(l)).then(u=>(typeof u.copyFromChannel!="function"?(o(u),Za(u)):e(r,()=>r(u))||a(u),n.add(u),u)),Xv={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",pan:0},$v=(n,e,t,s,i,r)=>class extends n{constructor(a,c){const l=i(a),u={...Xv,...c},h=t(l,u),d=r(l),f=d?s():null;super(a,!1,h,f),this._pan=e(this,d,h.pan)}get pan(){return this._pan}},Qv=(n,e,t,s,i)=>()=>{const r=new WeakMap,o=async(a,c)=>{let l=t(a);const u=$e(l,c);if(!u){const h={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,pan:l.pan.value};l=e(c,h)}return r.set(c,l),u?await n(c,a.pan,l.pan):await s(c,a.pan,l.pan),$n(l)?await i(a,c,l.inputs[0]):await i(a,c,l),l};return{render(a,c){const l=r.get(c);return l!==void 0?Promise.resolve(l):o(a,c)}}},Kv=n=>()=>{if(n===null)return!1;try{new n({length:1,sampleRate:44100})}catch{return!1}return!0},Jv=(n,e)=>async()=>{if(n===null)return!0;if(e===null)return!1;const t=new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),s=new e(1,128,44100),i=URL.createObjectURL(t);let r=!1,o=!1;try{await s.audioWorklet.addModule(i);const a=new n(s,"a",{numberOfOutputs:0}),c=s.createOscillator();a.port.onmessage=()=>r=!0,a.onprocessorerror=()=>o=!0,c.connect(a),c.start(0),await s.startRendering(),await new Promise(l=>setTimeout(l))}catch{}finally{URL.revokeObjectURL(i)}return r&&!o},e0=(n,e)=>()=>{if(e===null)return Promise.resolve(!1);const t=new e(1,1,44100),s=n(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise(i=>{t.oncomplete=()=>{s.disconnect(),i(t.currentTime!==0)},t.startRendering()})},t0=()=>new DOMException("","UnknownError"),s0={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",curve:null,oversample:"none"},n0=(n,e,t,s,i,r,o)=>class extends n{constructor(c,l){const u=i(c),h={...s0,...l},d=t(u,h),m=r(u)?s():null;super(c,!0,d,m),this._isCurveNullified=!1,this._nativeWaveShaperNode=d,o(this,1)}get curve(){return this._isCurveNullified?null:this._nativeWaveShaperNode.curve}set curve(c){if(c===null)this._isCurveNullified=!0,this._nativeWaveShaperNode.curve=new Float32Array([0,0]);else{if(c.length<2)throw e();this._isCurveNullified=!1,this._nativeWaveShaperNode.curve=c}}get oversample(){return this._nativeWaveShaperNode.oversample}set oversample(c){this._nativeWaveShaperNode.oversample=c}},i0=(n,e,t)=>()=>{const s=new WeakMap,i=async(r,o)=>{let a=e(r);if(!$e(a,o)){const l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,curve:a.curve,oversample:a.oversample};a=n(o,l)}return s.set(o,a),$n(a)?await t(r,o,a.inputs[0]):await t(r,o,a),a};return{render(r,o){const a=s.get(o);return a!==void 0?Promise.resolve(a):i(r,o)}}},r0=()=>typeof window>"u"?null:window,o0=(n,e)=>t=>{t.copyFromChannel=(s,i,r=0)=>{const o=n(r),a=n(i);if(a>=t.numberOfChannels)throw e();const c=t.length,l=t.getChannelData(a),u=s.length;for(let h=o<0?-o:0;h+o<c&&h<u;h+=1)s[h]=l[h+o]},t.copyToChannel=(s,i,r=0)=>{const o=n(r),a=n(i);if(a>=t.numberOfChannels)throw e();const c=t.length,l=t.getChannelData(a),u=s.length;for(let h=o<0?-o:0;h+o<c&&h<u;h+=1)l[h+o]=s[h]}},a0=n=>e=>{e.copyFromChannel=(t=>(s,i,r=0)=>{const o=n(r),a=n(i);if(o<e.length)return t.call(e,s,a,o)})(e.copyFromChannel),e.copyToChannel=(t=>(s,i,r=0)=>{const o=n(r),a=n(i);if(o<e.length)return t.call(e,s,a,o)})(e.copyToChannel)},c0=n=>(e,t)=>{const s=t.createBuffer(1,1,44100);e.buffer===null&&(e.buffer=s),n(e,"buffer",i=>()=>{const r=i.call(e);return r===s?null:r},i=>r=>i.call(e,r===null?s:r))},l0=(n,e)=>(t,s)=>{s.channelCount=1,s.channelCountMode="explicit",Object.defineProperty(s,"channelCount",{get:()=>1,set:()=>{throw n()}}),Object.defineProperty(s,"channelCountMode",{get:()=>"explicit",set:()=>{throw n()}});const i=t.createBufferSource();e(s,()=>{const a=s.numberOfInputs;for(let c=0;c<a;c+=1)i.connect(s,0,c)},()=>i.disconnect(s))},ah=(n,e,t)=>n.copyFromChannel===void 0?n.getChannelData(t)[0]:(n.copyFromChannel(e,t),e[0]),ch=n=>{if(n===null)return!1;const e=n.length;return e%2!==0?n[Math.floor(e/2)]!==0:n[e/2-1]+n[e/2]!==0},nr=(n,e,t,s)=>{let i=n;for(;!i.hasOwnProperty(e);)i=Object.getPrototypeOf(i);const{get:r,set:o}=Object.getOwnPropertyDescriptor(i,e);Object.defineProperty(n,e,{get:t(r),set:s(o)})},u0=n=>({...n,outputChannelCount:n.outputChannelCount!==void 0?n.outputChannelCount:n.numberOfInputs===1&&n.numberOfOutputs===1?[n.channelCount]:Array.from({length:n.numberOfOutputs},()=>1)}),h0=n=>({...n,channelCount:n.numberOfOutputs}),d0=n=>{const{imag:e,real:t}=n;return e===void 0?t===void 0?{...n,imag:[0,0],real:[0,0]}:{...n,imag:Array.from(t,()=>0),real:t}:t===void 0?{...n,imag:e,real:Array.from(e,()=>0)}:{...n,imag:e,real:t}},lh=(n,e,t)=>{try{n.setValueAtTime(e,t)}catch(s){if(s.code!==9)throw s;lh(n,e,t+1e-7)}},f0=n=>{const e=n.createBufferSource();e.start();try{e.start()}catch{return!0}return!1},p0=n=>{const e=n.createBufferSource(),t=n.createBuffer(1,1,44100);e.buffer=t;try{e.start(0,1)}catch{return!1}return!0},m0=n=>{const e=n.createBufferSource();e.start();try{e.stop()}catch{return!1}return!0},Ja=n=>{const e=n.createOscillator();try{e.start(-1)}catch(t){return t instanceof RangeError}return!1},uh=n=>{const e=n.createBuffer(1,1,44100),t=n.createBufferSource();t.buffer=e,t.start(),t.stop();try{return t.stop(),!0}catch{return!1}},ec=n=>{const e=n.createOscillator();try{e.stop(-1)}catch(t){return t instanceof RangeError}return!1},_0=n=>{const{port1:e,port2:t}=new MessageChannel;try{e.postMessage(n)}finally{e.close(),t.close()}},g0=n=>{n.start=(e=>(t=0,s=0,i)=>{const r=n.buffer,o=r===null?s:Math.min(r.duration,s);r!==null&&o>r.duration-.5/n.context.sampleRate?e.call(n,t,0,0):e.call(n,t,o,i)})(n.start)},hh=(n,e)=>{const t=e.createGain();n.connect(t);const s=(i=>()=>{i.call(n,t),n.removeEventListener("ended",s)})(n.disconnect);n.addEventListener("ended",s),Qn(n,t),n.stop=(i=>{let r=!1;return(o=0)=>{if(r)try{i.call(n,o)}catch{t.gain.setValueAtTime(0,o)}else i.call(n,o),r=!0}})(n.stop)},Kn=(n,e)=>t=>{const s={value:n};return Object.defineProperties(t,{currentTarget:s,target:s}),typeof e=="function"?e.call(n,t):e.handleEvent.call(n,t)},v0=Lm(dn),y0=Wm(dn),T0=sg(uo),dh=new WeakMap,x0=Tg(dh),Ut=R_(new Map,new WeakMap),jt=r0(),fh=$g(Ut,Zt),tc=yg(Je),Ge=qv(Je,tc,on),w0=Xm(fh,ye,Ge),_e=Sg(lo),ps=Sv(jt),le=zg(ps),ph=new WeakMap,mh=dg(Kn),ir=ev(jt),sc=Fg(ir),nc=Ug(jt),_h=Lg(jt),Ri=sv(jt),Ie=T_(Bm(qu),qm(v0,y0,zr,T0,Vr,Je,x0,Qi,ye,dn,os,on,Er),Ut,kg(fa,Vr,Je,ye,Di,os),Zt,ho,tt,K_(zr,fa,Je,ye,Di,_e,os,le),rg(ph,Je,Nt),mh,_e,sc,nc,_h,le,Ri),S0=Zm(Ie,w0,Zt,fh,_e,le),ic=new WeakSet,_l=Qg(jt),gh=G_(new Uint32Array(1)),rc=o0(gh,Zt),oc=a0(gh),vh=Qm(ic,Ut,tt,_l,ps,Kv(_l),rc,oc),fo=Gm(ut),yh=Wv(tc,Ji,on),Xt=B_(yh),Jn=Jg(fo,Ut,f0,p0,m0,Ja,uh,ec,g0,c0(nr),hh),$t=Hv(xg(Ji),yh),b0=e_(Xt,Jn,ye,$t,Ge),Lt=x_(zm(Wu),ph,Ya,w_,Rm,Pm,Nm,Im,Fm,ua,Vu,ir,lh),C0=Jm(Ie,b0,Lt,He,Jn,_e,le,Kn),E0=l_(Ie,u_,Zt,He,tv(ut,nr),_e,le,Ge),O0=k_(Xt,ih,ye,$t,Ge),fn=Yv(dh),A0=D_(Ie,Lt,O0,ho,ih,_e,le,fn),Bs=Zg(dn,nc),M0=l0(He,Bs),zs=lv(ir,M0),D0=I_(zs,ye,Ge),k0=N_(Ie,D0,zs,_e,le),R0=L_(tr,ye,Ge),P0=U_(Ie,R0,tr,_e,le,h0),N0=dv(fo,Jn,ut,Bs),ei=hv(fo,Ut,N0,Ja,ec),I0=W_(Xt,ei,ye,$t,Ge),F0=q_(Ie,Lt,I0,ei,_e,le,Kn),Th=fv(tt,nr),U0=Z_(Th,ye,Ge),L0=Y_(Ie,U0,Th,_e,le,fn),B0=tg(Xt,rh,ye,$t,Ge),z0=eg(Ie,Lt,B0,rh,_e,le,fn),xh=pv(tt),V0=lg(Xt,xh,ye,$t,Ge),H0=cg(Ie,Lt,V0,xh,tt,_e,le,fn),q0=gg(Xt,ut,ye,$t,Ge),W0=_g(Ie,Lt,q0,ut,_e,le),G0=vv(ho,He,sr,tt),po=Gv(Ut,ut,sr,e0(ut,ps)),j0=Dg(Jn,ye,ps,Ge,po),Y0=mv(G0),Z0=Ag(Ie,Y0,j0,_e,le,fn),X0=h_(Lt,zs,ei,sr,tt,ah,le,nr),wh=new WeakMap,$0=Yg(E0,X0,mh,le,wh,Kn),Sh=bv(fo,Ut,Ja,uh,ec,hh),Q0=Fv(Xt,Sh,ye,$t,Ge),K0=Iv(Ie,Lt,Sh,Q0,_e,le,Kn),bh=V_(Jn),J0=kv(bh,He,ut,ch,Bs),mo=Dv(bh,He,J0,ch,Bs,ir,nr),ey=Ev(zr,He,zs,ut,sr,mo,tt,Vr,ah,Bs),Ch=Cv(ey),ty=Bv(Xt,zs,ei,ut,Ch,ye,ps,$t,Ge,po),sy=Lv(Ie,Lt,Ch,ty,_e,le,fn),ny=Ov(Zt),iy=Vv(ny,_e,new WeakSet,d0),ry=Mv(zs,tr,ut,mo,tt,Bs),Eh=Av(ry,tt),oy=Qv(Xt,Eh,ye,$t,Ge),ay=$v(Ie,Lt,Eh,oy,_e,le),cy=i0(mo,ye,Ge),ly=n0(Ie,He,mo,cy,_e,le,fn),Oh=Vg(jt),ac=fg(jt),Ah=new WeakMap,uy=bg(Ah,ps),hy=Oh?Hm(Ut,tt,hg(jt),ac,pg(Um),_e,uy,le,Ri,new WeakMap,new WeakMap,Jv(Ri,ps),jt):void 0,dy=Bg(sc,le),fy=Q_(ic,Ut,$_,ug,new WeakSet,_e,dy,Lr,ki,rc,oc),Mh=A_(hy,S0,vh,C0,A0,k0,P0,F0,L0,fy,z0,H0,W0,Z0,$0,K0,sy,iy,ay,ly),py=Hg(Ie,yv,_e,le),my=Wg(Ie,Tv,_e,le),_y=Gg(Ie,xv,_e,le),gy=wv(He,le),vy=jg(Ie,gy,_e),yy=c_(Mh,He,tt,t0,py,my,_y,vy,ir),cc=Cg(wh),Ty=jm(cc),Dh=z_(Zt),xy=ng(cc),kh=og(Zt),Rh=new WeakMap,wy=vg(Rh,Nt),Sy=cv(Dh,Zt,He,zs,tr,ei,ut,sr,tt,kh,ac,wy,Bs),by=iv(He,Sy,ut,tt,Bs),Cy=O_(Xt,Dh,Jn,zs,tr,ei,ut,xy,kh,ac,ye,Ri,ps,$t,Ge,po),Ey=wg(Ah),Oy=jv(Rh),gl=Oh?b_(Ty,Ie,Lt,Cy,by,Je,Ey,_e,le,Ri,u0,Oy,_0,Kn):void 0,Ay=X_(tt,ps),My=Zv(ic,Ut,tc,cc,po,Lr,rc,oc),Dy=Pv(Mh,Ut,He,Ay,My),ky=Rg(lo,sc),Ry=Pg(ja,nc),Py=Ng(Ya,_h),Ny=Ig(lo,le);function mt(n){return typeof n>"u"}function J(n){return!mt(n)}function Iy(n){return typeof n=="function"}function Ps(n){return typeof n=="number"}function tn(n){return Object.prototype.toString.call(n)==="[object Object]"&&n.constructor===Object}function Fy(n){return typeof n=="boolean"}function Pt(n){return Array.isArray(n)}function us(n){return typeof n=="string"}function xr(n){return us(n)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(n)}function $(n,e){if(!n)throw new Error(e)}function It(n,e,t=1/0){if(!(e<=n&&n<=t))throw new RangeError(`Value must be within [${e}, ${t}], got: ${n}`)}function Ph(n){!n.isOffline&&n.state!=="running"&&lc('The AudioContext is "suspended". Invoke Tone.start() from a user action to start the audio.')}let Nh=!1,vl=!1;function yl(n){Nh=n}function Uy(n){mt(n)&&Nh&&!vl&&(vl=!0,lc("Events scheduled inside of scheduled callbacks should use the passed in scheduling time. See https://github.com/Tonejs/Tone.js/wiki/Accurate-Timing"))}let Ih=console;function Ly(...n){Ih.log(...n)}function lc(...n){Ih.warn(...n)}function By(n){return new yy(n)}function zy(n,e,t){return new Dy(n,e,t)}const sn=typeof self=="object"?self:null,Vy=sn&&(sn.hasOwnProperty("AudioContext")||sn.hasOwnProperty("webkitAudioContext"));function Hy(n,e,t){return $(J(gl),"This node only works in a secure context (https or localhost)"),new gl(n,e,t)}class qy{constructor(e,t,s,i){this._callback=e,this._type=t,this._minimumUpdateInterval=Math.max(128/(i||44100),.001),this.updateInterval=s,this._createClock()}_createWorker(){const e=new Blob([`
			// the initial timeout time
			let timeoutTime =  ${(this._updateInterval*1e3).toFixed(1)};
			// onmessage callback
			self.onmessage = function(msg){
				timeoutTime = parseInt(msg.data);
			};
			// the tick function which posts a message
			// and schedules a new tick
			function tick(){
				setTimeout(tick, timeoutTime);
				self.postMessage('tick');
			}
			// call tick initially
			tick();
			`],{type:"text/javascript"}),t=URL.createObjectURL(e),s=new Worker(t);s.onmessage=this._callback.bind(this),this._worker=s}_createTimeout(){this._timeout=setTimeout(()=>{this._createTimeout(),this._callback()},this._updateInterval*1e3)}_createClock(){if(this._type==="worker")try{this._createWorker()}catch{this._type="timeout",this._createClock()}else this._type==="timeout"&&this._createTimeout()}_disposeClock(){this._timeout&&clearTimeout(this._timeout),this._worker&&(this._worker.terminate(),this._worker.onmessage=null)}get updateInterval(){return this._updateInterval}set updateInterval(e){var t;this._updateInterval=Math.max(e,this._minimumUpdateInterval),this._type==="worker"&&((t=this._worker)===null||t===void 0||t.postMessage(this._updateInterval*1e3))}get type(){return this._type}set type(e){this._disposeClock(),this._type=e,this._createClock()}dispose(){this._disposeClock()}}function an(n){return Py(n)}function Ds(n){return Ry(n)}function Or(n){return Ny(n)}function bn(n){return ky(n)}function Wy(n){return n instanceof vh}function Gy(n,e){return n==="value"||an(e)||Ds(e)||Wy(e)}function Pn(n,...e){if(!e.length)return n;const t=e.shift();if(tn(n)&&tn(t))for(const s in t)Gy(s,t[s])?n[s]=t[s]:tn(t[s])?(n[s]||Object.assign(n,{[s]:{}}),Pn(n[s],t[s])):Object.assign(n,{[s]:t[s]});return Pn(n,...e)}function jy(n,e){return n.length===e.length&&n.every((t,s)=>e[s]===t)}function k(n,e,t=[],s){const i={},r=Array.from(e);if(tn(r[0])&&s&&!Reflect.has(r[0],s)&&(Object.keys(r[0]).some(a=>Reflect.has(n,a))||(Pn(i,{[s]:r[0]}),t.splice(t.indexOf(s),1),r.shift())),r.length===1&&tn(r[0]))Pn(i,r[0]);else for(let o=0;o<t.length;o++)J(r[o])&&(i[t[o]]=r[o]);return Pn(n,i)}function Yy(n){return n.constructor.getDefaults()}function Nn(n,e){return mt(n)?e:n}function An(n,e){return e.forEach(t=>{Reflect.has(n,t)&&delete n[t]}),n}/**
 * Tone.js
 * @author Yotam Mann
 * @license http://opensource.org/licenses/MIT MIT License
 * @copyright 2014-2019 Yotam Mann
 */class ms{constructor(){this.debug=!1,this._wasDisposed=!1}static getDefaults(){return{}}log(...e){(this.debug||sn&&this.toString()===sn.TONE_DEBUG_CLASS)&&Ly(this,...e)}dispose(){return this._wasDisposed=!0,this}get disposed(){return this._wasDisposed}toString(){return this.name}}ms.version=zu;const uc=1e-6;function Wn(n,e){return n>e+uc}function va(n,e){return Wn(n,e)||Dt(n,e)}function Gr(n,e){return n+uc<e}function Dt(n,e){return Math.abs(n-e)<uc}function Zy(n,e,t){return Math.max(Math.min(n,t),e)}class Ct extends ms{constructor(){super(),this.name="Timeline",this._timeline=[];const e=k(Ct.getDefaults(),arguments,["memory"]);this.memory=e.memory,this.increasing=e.increasing}static getDefaults(){return{memory:1/0,increasing:!1}}get length(){return this._timeline.length}add(e){if($(Reflect.has(e,"time"),"Timeline: events must have a time attribute"),e.time=e.time.valueOf(),this.increasing&&this.length){const t=this._timeline[this.length-1];$(va(e.time,t.time),"The time must be greater than or equal to the last scheduled time"),this._timeline.push(e)}else{const t=this._search(e.time);this._timeline.splice(t+1,0,e)}if(this.length>this.memory){const t=this.length-this.memory;this._timeline.splice(0,t)}return this}remove(e){const t=this._timeline.indexOf(e);return t!==-1&&this._timeline.splice(t,1),this}get(e,t="time"){const s=this._search(e,t);return s!==-1?this._timeline[s]:null}peek(){return this._timeline[0]}shift(){return this._timeline.shift()}getAfter(e,t="time"){const s=this._search(e,t);return s+1<this._timeline.length?this._timeline[s+1]:null}getBefore(e){const t=this._timeline.length;if(t>0&&this._timeline[t-1].time<e)return this._timeline[t-1];const s=this._search(e);return s-1>=0?this._timeline[s-1]:null}cancel(e){if(this._timeline.length>1){let t=this._search(e);if(t>=0)if(Dt(this._timeline[t].time,e)){for(let s=t;s>=0&&Dt(this._timeline[s].time,e);s--)t=s;this._timeline=this._timeline.slice(0,t)}else this._timeline=this._timeline.slice(0,t+1);else this._timeline=[]}else this._timeline.length===1&&va(this._timeline[0].time,e)&&(this._timeline=[]);return this}cancelBefore(e){const t=this._search(e);return t>=0&&(this._timeline=this._timeline.slice(t+1)),this}previousEvent(e){const t=this._timeline.indexOf(e);return t>0?this._timeline[t-1]:null}_search(e,t="time"){if(this._timeline.length===0)return-1;let s=0;const i=this._timeline.length;let r=i;if(i>0&&this._timeline[i-1][t]<=e)return i-1;for(;s<r;){let o=Math.floor(s+(r-s)/2);const a=this._timeline[o],c=this._timeline[o+1];if(Dt(a[t],e)){for(let l=o;l<this._timeline.length;l++){const u=this._timeline[l];if(Dt(u[t],e))o=l;else break}return o}else{if(Gr(a[t],e)&&Wn(c[t],e))return o;Wn(a[t],e)?r=o:s=o+1}}return-1}_iterate(e,t=0,s=this._timeline.length-1){this._timeline.slice(t,s+1).forEach(e)}forEach(e){return this._iterate(e),this}forEachBefore(e,t){const s=this._search(e);return s!==-1&&this._iterate(t,0,s),this}forEachAfter(e,t){const s=this._search(e);return this._iterate(t,s+1),this}forEachBetween(e,t,s){let i=this._search(e),r=this._search(t);return i!==-1&&r!==-1?(this._timeline[i].time!==e&&(i+=1),this._timeline[r].time===t&&(r-=1),this._iterate(s,i,r)):i===-1&&this._iterate(s,0,r),this}forEachFrom(e,t){let s=this._search(e);for(;s>=0&&this._timeline[s].time>=e;)s--;return this._iterate(t,s+1),this}forEachAtTime(e,t){const s=this._search(e);if(s!==-1&&Dt(this._timeline[s].time,e)){let i=s;for(let r=s;r>=0&&Dt(this._timeline[r].time,e);r--)i=r;this._iterate(r=>{t(r)},i,s)}return this}dispose(){return super.dispose(),this._timeline=[],this}}const Fh=[];function _o(n){Fh.push(n)}function Xy(n){Fh.forEach(e=>e(n))}const Uh=[];function go(n){Uh.push(n)}function $y(n){Uh.forEach(e=>e(n))}class rr extends ms{constructor(){super(...arguments),this.name="Emitter"}on(e,t){return e.split(/\W+/).forEach(i=>{mt(this._events)&&(this._events={}),this._events.hasOwnProperty(i)||(this._events[i]=[]),this._events[i].push(t)}),this}once(e,t){const s=(...i)=>{t(...i),this.off(e,s)};return this.on(e,s),this}off(e,t){return e.split(/\W+/).forEach(i=>{if(mt(this._events)&&(this._events={}),this._events.hasOwnProperty(i))if(mt(t))this._events[i]=[];else{const r=this._events[i];for(let o=r.length-1;o>=0;o--)r[o]===t&&r.splice(o,1)}}),this}emit(e,...t){if(this._events&&this._events.hasOwnProperty(e)){const s=this._events[e].slice(0);for(let i=0,r=s.length;i<r;i++)s[i].apply(this,t)}return this}static mixin(e){["on","once","off","emit"].forEach(t=>{const s=Object.getOwnPropertyDescriptor(rr.prototype,t);Object.defineProperty(e.prototype,t,s)})}dispose(){return super.dispose(),this._events=void 0,this}}class Lh extends rr{constructor(){super(...arguments),this.isOffline=!1}toJSON(){return{}}}class or extends Lh{constructor(){var e,t;super(),this.name="Context",this._constants=new Map,this._timeouts=new Ct,this._timeoutIds=0,this._initialized=!1,this._closeStarted=!1,this.isOffline=!1,this._workletPromise=null;const s=k(or.getDefaults(),arguments,["context"]);s.context?(this._context=s.context,this._latencyHint=((e=arguments[0])===null||e===void 0?void 0:e.latencyHint)||""):(this._context=By({latencyHint:s.latencyHint}),this._latencyHint=s.latencyHint),this._ticker=new qy(this.emit.bind(this,"tick"),s.clockSource,s.updateInterval,this._context.sampleRate),this.on("tick",this._timeoutLoop.bind(this)),this._context.onstatechange=()=>{this.emit("statechange",this.state)},this[!((t=arguments[0])===null||t===void 0)&&t.hasOwnProperty("updateInterval")?"_lookAhead":"lookAhead"]=s.lookAhead}static getDefaults(){return{clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.05}}initialize(){return this._initialized||(Xy(this),this._initialized=!0),this}createAnalyser(){return this._context.createAnalyser()}createOscillator(){return this._context.createOscillator()}createBufferSource(){return this._context.createBufferSource()}createBiquadFilter(){return this._context.createBiquadFilter()}createBuffer(e,t,s){return this._context.createBuffer(e,t,s)}createChannelMerger(e){return this._context.createChannelMerger(e)}createChannelSplitter(e){return this._context.createChannelSplitter(e)}createConstantSource(){return this._context.createConstantSource()}createConvolver(){return this._context.createConvolver()}createDelay(e){return this._context.createDelay(e)}createDynamicsCompressor(){return this._context.createDynamicsCompressor()}createGain(){return this._context.createGain()}createIIRFilter(e,t){return this._context.createIIRFilter(e,t)}createPanner(){return this._context.createPanner()}createPeriodicWave(e,t,s){return this._context.createPeriodicWave(e,t,s)}createStereoPanner(){return this._context.createStereoPanner()}createWaveShaper(){return this._context.createWaveShaper()}createMediaStreamSource(e){return $(bn(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamSource(e)}createMediaElementSource(e){return $(bn(this._context),"Not available if OfflineAudioContext"),this._context.createMediaElementSource(e)}createMediaStreamDestination(){return $(bn(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamDestination()}decodeAudioData(e){return this._context.decodeAudioData(e)}get currentTime(){return this._context.currentTime}get state(){return this._context.state}get sampleRate(){return this._context.sampleRate}get listener(){return this.initialize(),this._listener}set listener(e){$(!this._initialized,"The listener cannot be set after initialization."),this._listener=e}get transport(){return this.initialize(),this._transport}set transport(e){$(!this._initialized,"The transport cannot be set after initialization."),this._transport=e}get draw(){return this.initialize(),this._draw}set draw(e){$(!this._initialized,"Draw cannot be set after initialization."),this._draw=e}get destination(){return this.initialize(),this._destination}set destination(e){$(!this._initialized,"The destination cannot be set after initialization."),this._destination=e}createAudioWorkletNode(e,t){return Hy(this.rawContext,e,t)}addAudioWorkletModule(e){return Pe(this,void 0,void 0,function*(){$(J(this.rawContext.audioWorklet),"AudioWorkletNode is only available in a secure context (https or localhost)"),this._workletPromise||(this._workletPromise=this.rawContext.audioWorklet.addModule(e)),yield this._workletPromise})}workletsAreReady(){return Pe(this,void 0,void 0,function*(){(yield this._workletPromise)?this._workletPromise:Promise.resolve()})}get updateInterval(){return this._ticker.updateInterval}set updateInterval(e){this._ticker.updateInterval=e}get clockSource(){return this._ticker.type}set clockSource(e){this._ticker.type=e}get lookAhead(){return this._lookAhead}set lookAhead(e){this._lookAhead=e,this.updateInterval=e?e/2:.01}get latencyHint(){return this._latencyHint}get rawContext(){return this._context}now(){return this._context.currentTime+this._lookAhead}immediate(){return this._context.currentTime}resume(){return bn(this._context)?this._context.resume():Promise.resolve()}close(){return Pe(this,void 0,void 0,function*(){bn(this._context)&&this.state!=="closed"&&!this._closeStarted&&(this._closeStarted=!0,yield this._context.close()),this._initialized&&$y(this)})}getConstant(e){if(this._constants.has(e))return this._constants.get(e);{const t=this._context.createBuffer(1,128,this._context.sampleRate),s=t.getChannelData(0);for(let r=0;r<s.length;r++)s[r]=e;const i=this._context.createBufferSource();return i.channelCount=1,i.channelCountMode="explicit",i.buffer=t,i.loop=!0,i.start(0),this._constants.set(e,i),i}}dispose(){return super.dispose(),this._ticker.dispose(),this._timeouts.dispose(),Object.keys(this._constants).map(e=>this._constants[e].disconnect()),this.close(),this}_timeoutLoop(){const e=this.now();let t=this._timeouts.peek();for(;this._timeouts.length&&t&&t.time<=e;)t.callback(),this._timeouts.shift(),t=this._timeouts.peek()}setTimeout(e,t){this._timeoutIds++;const s=this.now();return this._timeouts.add({callback:e,id:this._timeoutIds,time:s+t}),this._timeoutIds}clearTimeout(e){return this._timeouts.forEach(t=>{t.id===e&&this._timeouts.remove(t)}),this}clearInterval(e){return this.clearTimeout(e)}setInterval(e,t){const s=++this._timeoutIds,i=()=>{const r=this.now();this._timeouts.add({callback:()=>{e(),i()},id:s,time:r+t})};return i(),s}}class Qy extends Lh{constructor(){super(...arguments),this.lookAhead=0,this.latencyHint=0,this.isOffline=!1}createAnalyser(){return{}}createOscillator(){return{}}createBufferSource(){return{}}createBiquadFilter(){return{}}createBuffer(e,t,s){return{}}createChannelMerger(e){return{}}createChannelSplitter(e){return{}}createConstantSource(){return{}}createConvolver(){return{}}createDelay(e){return{}}createDynamicsCompressor(){return{}}createGain(){return{}}createIIRFilter(e,t){return{}}createPanner(){return{}}createPeriodicWave(e,t,s){return{}}createStereoPanner(){return{}}createWaveShaper(){return{}}createMediaStreamSource(e){return{}}createMediaElementSource(e){return{}}createMediaStreamDestination(){return{}}decodeAudioData(e){return Promise.resolve({})}createAudioWorkletNode(e,t){return{}}get rawContext(){return{}}addAudioWorkletModule(e){return Pe(this,void 0,void 0,function*(){return Promise.resolve()})}resume(){return Promise.resolve()}setTimeout(e,t){return 0}clearTimeout(e){return this}setInterval(e,t){return 0}clearInterval(e){return this}getConstant(e){return{}}get currentTime(){return 0}get state(){return{}}get sampleRate(){return 0}get listener(){return{}}get transport(){return{}}get draw(){return{}}set draw(e){}get destination(){return{}}set destination(e){}now(){return 0}immediate(){return 0}}function ge(n,e){Pt(e)?e.forEach(t=>ge(n,t)):Object.defineProperty(n,e,{enumerable:!0,writable:!1})}function hc(n,e){Pt(e)?e.forEach(t=>hc(n,t)):Object.defineProperty(n,e,{writable:!0})}const oe=()=>{};class ae extends ms{constructor(){super(),this.name="ToneAudioBuffer",this.onload=oe;const e=k(ae.getDefaults(),arguments,["url","onload","onerror"]);this.reverse=e.reverse,this.onload=e.onload,us(e.url)?this.load(e.url).catch(e.onerror):e.url&&this.set(e.url)}static getDefaults(){return{onerror:oe,onload:oe,reverse:!1}}get sampleRate(){return this._buffer?this._buffer.sampleRate:kt().sampleRate}set(e){return e instanceof ae?e.loaded?this._buffer=e.get():e.onload=()=>{this.set(e),this.onload(this)}:this._buffer=e,this._reversed&&this._reverse(),this}get(){return this._buffer}load(e){return Pe(this,void 0,void 0,function*(){const t=ae.load(e).then(s=>{this.set(s),this.onload(this)});ae.downloads.push(t);try{yield t}finally{const s=ae.downloads.indexOf(t);ae.downloads.splice(s,1)}return this})}dispose(){return super.dispose(),this._buffer=void 0,this}fromArray(e){const t=Pt(e)&&e[0].length>0,s=t?e.length:1,i=t?e[0].length:e.length,r=kt(),o=r.createBuffer(s,i,r.sampleRate),a=!t&&s===1?[e]:e;for(let c=0;c<s;c++)o.copyToChannel(a[c],c);return this._buffer=o,this}toMono(e){if(Ps(e))this.fromArray(this.toArray(e));else{let t=new Float32Array(this.length);const s=this.numberOfChannels;for(let i=0;i<s;i++){const r=this.toArray(i);for(let o=0;o<r.length;o++)t[o]+=r[o]}t=t.map(i=>i/s),this.fromArray(t)}return this}toArray(e){if(Ps(e))return this.getChannelData(e);if(this.numberOfChannels===1)return this.toArray(0);{const t=[];for(let s=0;s<this.numberOfChannels;s++)t[s]=this.getChannelData(s);return t}}getChannelData(e){return this._buffer?this._buffer.getChannelData(e):new Float32Array(0)}slice(e,t=this.duration){$(this.loaded,"Buffer is not loaded");const s=Math.floor(e*this.sampleRate),i=Math.floor(t*this.sampleRate);$(s<i,"The start time must be less than the end time");const r=i-s,o=kt().createBuffer(this.numberOfChannels,r,this.sampleRate);for(let a=0;a<this.numberOfChannels;a++)o.copyToChannel(this.getChannelData(a).subarray(s,i),a);return new ae(o)}_reverse(){if(this.loaded)for(let e=0;e<this.numberOfChannels;e++)this.getChannelData(e).reverse();return this}get loaded(){return this.length>0}get duration(){return this._buffer?this._buffer.duration:0}get length(){return this._buffer?this._buffer.length:0}get numberOfChannels(){return this._buffer?this._buffer.numberOfChannels:0}get reverse(){return this._reversed}set reverse(e){this._reversed!==e&&(this._reversed=e,this._reverse())}static fromArray(e){return new ae().fromArray(e)}static fromUrl(e){return Pe(this,void 0,void 0,function*(){return yield new ae().load(e)})}static load(e){return Pe(this,void 0,void 0,function*(){const t=e.match(/\[([^\]\[]+\|.+)\]$/);if(t){const c=t[1].split("|");let l=c[0];for(const u of c)if(ae.supportsType(u)){l=u;break}e=e.replace(t[0],l)}const s=ae.baseUrl===""||ae.baseUrl.endsWith("/")?ae.baseUrl:ae.baseUrl+"/",i=document.createElement("a");i.href=s+e,i.pathname=(i.pathname+i.hash).split("/").map(encodeURIComponent).join("/");const r=yield fetch(i.href);if(!r.ok)throw new Error(`could not load url: ${e}`);const o=yield r.arrayBuffer();return yield kt().decodeAudioData(o)})}static supportsType(e){const t=e.split("."),s=t[t.length-1];return document.createElement("audio").canPlayType("audio/"+s)!==""}static loaded(){return Pe(this,void 0,void 0,function*(){for(yield Promise.resolve();ae.downloads.length;)yield ae.downloads[0]})}}ae.baseUrl="";ae.downloads=[];class vo extends or{constructor(){super({clockSource:"offline",context:Or(arguments[0])?arguments[0]:zy(arguments[0],arguments[1]*arguments[2],arguments[2]),lookAhead:0,updateInterval:Or(arguments[0])?128/arguments[0].sampleRate:128/arguments[2]}),this.name="OfflineContext",this._currentTime=0,this.isOffline=!0,this._duration=Or(arguments[0])?arguments[0].length/arguments[0].sampleRate:arguments[1]}now(){return this._currentTime}get currentTime(){return this._currentTime}_renderClock(e){return Pe(this,void 0,void 0,function*(){let t=0;for(;this._duration-this._currentTime>=0;){this.emit("tick"),this._currentTime+=128/this.sampleRate,t++;const s=Math.floor(this.sampleRate/128);e&&t%s===0&&(yield new Promise(i=>setTimeout(i,1)))}})}render(e=!0){return Pe(this,void 0,void 0,function*(){yield this.workletsAreReady(),yield this._renderClock(e);const t=yield this._context.startRendering();return new ae(t)})}close(){return Promise.resolve()}}const Bh=new Qy;let $s=Bh;function kt(){return $s===Bh&&Vy&&Ky(new or),$s}function Ky(n,e=!1){e&&$s.dispose(),bn(n)?$s=new or(n):Or(n)?$s=new vo(n):$s=n}function Jy(){return $s.resume()}if(sn&&!sn.TONE_SILENCE_LOGGING){const e=` * Tone.js v${zu} * `;console.log(`%c${e}`,"background: #000; color: #fff")}function eT(n){return Math.pow(10,n/20)}function tT(n){return 20*(Math.log(n)/Math.LN10)}function zh(n){return Math.pow(2,n/12)}let yo=440;function sT(){return yo}function nT(n){yo=n}function ya(n){return Math.round(Vh(n))}function Vh(n){return 69+12*Math.log2(n/yo)}function iT(n){return yo*Math.pow(2,(n-69)/12)}class dc extends ms{constructor(e,t,s){super(),this.defaultUnits="s",this._val=t,this._units=s,this.context=e,this._expressions=this._getExpressions()}_getExpressions(){return{hz:{method:e=>this._frequencyToUnits(parseFloat(e)),regexp:/^(\d+(?:\.\d+)?)hz$/i},i:{method:e=>this._ticksToUnits(parseInt(e,10)),regexp:/^(\d+)i$/i},m:{method:e=>this._beatsToUnits(parseInt(e,10)*this._getTimeSignature()),regexp:/^(\d+)m$/i},n:{method:(e,t)=>{const s=parseInt(e,10),i=t==="."?1.5:1;return s===1?this._beatsToUnits(this._getTimeSignature())*i:this._beatsToUnits(4/s)*i},regexp:/^(\d+)n(\.?)$/i},number:{method:e=>this._expressions[this.defaultUnits].method.call(this,e),regexp:/^(\d+(?:\.\d+)?)$/},s:{method:e=>this._secondsToUnits(parseFloat(e)),regexp:/^(\d+(?:\.\d+)?)s$/},samples:{method:e=>parseInt(e,10)/this.context.sampleRate,regexp:/^(\d+)samples$/},t:{method:e=>{const t=parseInt(e,10);return this._beatsToUnits(8/(Math.floor(t)*3))},regexp:/^(\d+)t$/i},tr:{method:(e,t,s)=>{let i=0;return e&&e!=="0"&&(i+=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),t&&t!=="0"&&(i+=this._beatsToUnits(parseFloat(t))),s&&s!=="0"&&(i+=this._beatsToUnits(parseFloat(s)/4)),i},regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/}}}valueOf(){if(this._val instanceof dc&&this.fromType(this._val),mt(this._val))return this._noArg();if(us(this._val)&&mt(this._units)){for(const e in this._expressions)if(this._expressions[e].regexp.test(this._val.trim())){this._units=e;break}}else if(tn(this._val)){let e=0;for(const t in this._val)if(J(this._val[t])){const s=this._val[t],i=new this.constructor(this.context,t).valueOf()*s;e+=i}return e}if(J(this._units)){const e=this._expressions[this._units],t=this._val.toString().trim().match(e.regexp);return t?e.method.apply(this,t.slice(1)):e.method.call(this,this._val)}else return us(this._val)?parseFloat(this._val):this._val}_frequencyToUnits(e){return 1/e}_beatsToUnits(e){return 60/this._getBpm()*e}_secondsToUnits(e){return e}_ticksToUnits(e){return e*this._beatsToUnits(1)/this._getPPQ()}_noArg(){return this._now()}_getBpm(){return this.context.transport.bpm.value}_getTimeSignature(){return this.context.transport.timeSignature}_getPPQ(){return this.context.transport.PPQ}fromType(e){switch(this._units=void 0,this.defaultUnits){case"s":this._val=e.toSeconds();break;case"i":this._val=e.toTicks();break;case"hz":this._val=e.toFrequency();break;case"midi":this._val=e.toMidi();break}return this}toFrequency(){return 1/this.toSeconds()}toSamples(){return this.toSeconds()*this.context.sampleRate}toMilliseconds(){return this.toSeconds()*1e3}}class Rt extends dc{constructor(){super(...arguments),this.name="TimeClass"}_getExpressions(){return Object.assign(super._getExpressions(),{now:{method:e=>this._now()+new this.constructor(this.context,e).valueOf(),regexp:/^\+(.+)/},quantize:{method:e=>{const t=new Rt(this.context,e).valueOf();return this._secondsToUnits(this.context.transport.nextSubdivision(t))},regexp:/^@(.+)/}})}quantize(e,t=1){const s=new this.constructor(this.context,e).valueOf(),i=this.valueOf(),a=Math.round(i/s)*s-i;return i+a*t}toNotation(){const e=this.toSeconds(),t=["1m"];for(let r=1;r<9;r++){const o=Math.pow(2,r);t.push(o+"n."),t.push(o+"n"),t.push(o+"t")}t.push("0");let s=t[0],i=new Rt(this.context,t[0]).toSeconds();return t.forEach(r=>{const o=new Rt(this.context,r).toSeconds();Math.abs(o-e)<Math.abs(i-e)&&(s=r,i=o)}),s}toBarsBeatsSixteenths(){const e=this._beatsToUnits(1);let t=this.valueOf()/e;t=parseFloat(t.toFixed(4));const s=Math.floor(t/this._getTimeSignature());let i=t%1*4;t=Math.floor(t)%this._getTimeSignature();const r=i.toString();return r.length>3&&(i=parseFloat(parseFloat(r).toFixed(3))),[s,t,i].join(":")}toTicks(){const e=this._beatsToUnits(1);return this.valueOf()/e*this._getPPQ()}toSeconds(){return this.valueOf()}toMidi(){return ya(this.toFrequency())}_now(){return this.context.now()}}class bt extends Rt{constructor(){super(...arguments),this.name="Frequency",this.defaultUnits="hz"}static get A4(){return sT()}static set A4(e){nT(e)}_getExpressions(){return Object.assign({},super._getExpressions(),{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method(e){return this.defaultUnits==="midi"?e:bt.mtof(e)}},note:{regexp:/^([a-g]{1}(?:b|#|##|x|bb|###|#x|x#|bbb)?)(-?[0-9]+)/i,method(e,t){const i=rT[e.toLowerCase()]+(parseInt(t,10)+1)*12;return this.defaultUnits==="midi"?i:bt.mtof(i)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method(e,t,s){let i=1;return e&&e!=="0"&&(i*=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),t&&t!=="0"&&(i*=this._beatsToUnits(parseFloat(t))),s&&s!=="0"&&(i*=this._beatsToUnits(parseFloat(s)/4)),i}}})}transpose(e){return new bt(this.context,this.valueOf()*zh(e))}harmonize(e){return e.map(t=>this.transpose(t))}toMidi(){return ya(this.valueOf())}toNote(){const e=this.toFrequency(),t=Math.log2(e/bt.A4);let s=Math.round(12*t)+57;const i=Math.floor(s/12);return i<0&&(s+=-12*i),oT[s%12]+i.toString()}toSeconds(){return 1/super.toSeconds()}toTicks(){const e=this._beatsToUnits(1),t=this.valueOf()/e;return Math.floor(t*this._getPPQ())}_noArg(){return 0}_frequencyToUnits(e){return e}_ticksToUnits(e){return 1/(e*60/(this._getBpm()*this._getPPQ()))}_beatsToUnits(e){return 1/super._beatsToUnits(e)}_secondsToUnits(e){return 1/e}static mtof(e){return iT(e)}static ftom(e){return ya(e)}}const rT={cbbb:-3,cbb:-2,cb:-1,c:0,"c#":1,cx:2,"c##":2,"c###":3,"cx#":3,"c#x":3,dbbb:-1,dbb:0,db:1,d:2,"d#":3,dx:4,"d##":4,"d###":5,"dx#":5,"d#x":5,ebbb:1,ebb:2,eb:3,e:4,"e#":5,ex:6,"e##":6,"e###":7,"ex#":7,"e#x":7,fbbb:2,fbb:3,fb:4,f:5,"f#":6,fx:7,"f##":7,"f###":8,"fx#":8,"f#x":8,gbbb:4,gbb:5,gb:6,g:7,"g#":8,gx:9,"g##":9,"g###":10,"gx#":10,"g#x":10,abbb:6,abb:7,ab:8,a:9,"a#":10,ax:11,"a##":11,"a###":12,"ax#":12,"a#x":12,bbbb:8,bbb:9,bb:10,b:11,"b#":12,bx:13,"b##":13,"b###":14,"bx#":14,"b#x":14},oT=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];class xi extends Rt{constructor(){super(...arguments),this.name="TransportTime"}_now(){return this.context.transport.seconds}}class ct extends ms{constructor(){super();const e=k(ct.getDefaults(),arguments,["context"]);this.defaultContext?this.context=this.defaultContext:this.context=e.context}static getDefaults(){return{context:kt()}}now(){return this.context.currentTime+this.context.lookAhead}immediate(){return this.context.currentTime}get sampleTime(){return 1/this.context.sampleRate}get blockTime(){return 128/this.context.sampleRate}toSeconds(e){return Uy(e),new Rt(this.context,e).toSeconds()}toFrequency(e){return new bt(this.context,e).toFrequency()}toTicks(e){return new xi(this.context,e).toTicks()}_getPartialProperties(e){const t=this.get();return Object.keys(t).forEach(s=>{mt(e[s])&&delete t[s]}),t}get(){const e=Yy(this);return Object.keys(e).forEach(t=>{if(Reflect.has(this,t)){const s=this[t];J(s)&&J(s.value)&&J(s.setValueAtTime)?e[t]=s.value:s instanceof ct?e[t]=s._getPartialProperties(e[t]):Pt(s)||Ps(s)||us(s)||Fy(s)?e[t]=s:delete e[t]}}),e}set(e){return Object.keys(e).forEach(t=>{Reflect.has(this,t)&&J(this[t])&&(this[t]&&J(this[t].value)&&J(this[t].setValueAtTime)?this[t].value!==e[t]&&(this[t].value=e[t]):this[t]instanceof ct?this[t].set(e[t]):this[t]=e[t])}),this}}class fc extends Ct{constructor(e="stopped"){super(),this.name="StateTimeline",this._initial=e,this.setStateAtTime(this._initial,0)}getValueAtTime(e){const t=this.get(e);return t!==null?t.state:this._initial}setStateAtTime(e,t,s){return It(t,0),this.add(Object.assign({},s,{state:e,time:t})),this}getLastState(e,t){const s=this._search(t);for(let i=s;i>=0;i--){const r=this._timeline[i];if(r.state===e)return r}}getNextState(e,t){const s=this._search(t);if(s!==-1)for(let i=s;i<this._timeline.length;i++){const r=this._timeline[i];if(r.state===e)return r}}}class ce extends ct{constructor(){super(k(ce.getDefaults(),arguments,["param","units","convert"])),this.name="Param",this.overridden=!1,this._minOutput=1e-7;const e=k(ce.getDefaults(),arguments,["param","units","convert"]);for($(J(e.param)&&(an(e.param)||e.param instanceof ce),"param must be an AudioParam");!an(e.param);)e.param=e.param._param;this._swappable=J(e.swappable)?e.swappable:!1,this._swappable?(this.input=this.context.createGain(),this._param=e.param,this.input.connect(this._param)):this._param=this.input=e.param,this._events=new Ct(1e3),this._initialValue=this._param.defaultValue,this.units=e.units,this.convert=e.convert,this._minValue=e.minValue,this._maxValue=e.maxValue,J(e.value)&&e.value!==this._toType(this._initialValue)&&this.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(ct.getDefaults(),{convert:!0,units:"number"})}get value(){const e=this.now();return this.getValueAtTime(e)}set value(e){this.cancelScheduledValues(this.now()),this.setValueAtTime(e,this.now())}get minValue(){return J(this._minValue)?this._minValue:this.units==="time"||this.units==="frequency"||this.units==="normalRange"||this.units==="positive"||this.units==="transportTime"||this.units==="ticks"||this.units==="bpm"||this.units==="hertz"||this.units==="samples"?0:this.units==="audioRange"?-1:this.units==="decibels"?-1/0:this._param.minValue}get maxValue(){return J(this._maxValue)?this._maxValue:this.units==="normalRange"||this.units==="audioRange"?1:this._param.maxValue}_is(e,t){return this.units===t}_assertRange(e){return J(this.maxValue)&&J(this.minValue)&&It(e,this._fromType(this.minValue),this._fromType(this.maxValue)),e}_fromType(e){return this.convert&&!this.overridden?this._is(e,"time")?this.toSeconds(e):this._is(e,"decibels")?eT(e):this._is(e,"frequency")?this.toFrequency(e):e:this.overridden?0:e}_toType(e){return this.convert&&this.units==="decibels"?tT(e):e}setValueAtTime(e,t){const s=this.toSeconds(t),i=this._fromType(e);return $(isFinite(i)&&isFinite(s),`Invalid argument(s) to setValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._assertRange(i),this.log(this.units,"setValueAtTime",e,s),this._events.add({time:s,type:"setValueAtTime",value:i}),this._param.setValueAtTime(i,s),this}getValueAtTime(e){const t=Math.max(this.toSeconds(e),0),s=this._events.getAfter(t),i=this._events.get(t);let r=this._initialValue;if(i===null)r=this._initialValue;else if(i.type==="setTargetAtTime"&&(s===null||s.type==="setValueAtTime")){const o=this._events.getBefore(i.time);let a;o===null?a=this._initialValue:a=o.value,i.type==="setTargetAtTime"&&(r=this._exponentialApproach(i.time,a,i.value,i.constant,t))}else if(s===null)r=i.value;else if(s.type==="linearRampToValueAtTime"||s.type==="exponentialRampToValueAtTime"){let o=i.value;if(i.type==="setTargetAtTime"){const a=this._events.getBefore(i.time);a===null?o=this._initialValue:o=a.value}s.type==="linearRampToValueAtTime"?r=this._linearInterpolate(i.time,o,s.time,s.value,t):r=this._exponentialInterpolate(i.time,o,s.time,s.value,t)}else r=i.value;return this._toType(r)}setRampPoint(e){e=this.toSeconds(e);let t=this.getValueAtTime(e);return this.cancelAndHoldAtTime(e),this._fromType(t)===0&&(t=this._toType(this._minOutput)),this.setValueAtTime(t,e),this}linearRampToValueAtTime(e,t){const s=this._fromType(e),i=this.toSeconds(t);return $(isFinite(s)&&isFinite(i),`Invalid argument(s) to linearRampToValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._assertRange(s),this._events.add({time:i,type:"linearRampToValueAtTime",value:s}),this.log(this.units,"linearRampToValueAtTime",e,i),this._param.linearRampToValueAtTime(s,i),this}exponentialRampToValueAtTime(e,t){let s=this._fromType(e);s=Dt(s,0)?this._minOutput:s,this._assertRange(s);const i=this.toSeconds(t);return $(isFinite(s)&&isFinite(i),`Invalid argument(s) to exponentialRampToValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._events.add({time:i,type:"exponentialRampToValueAtTime",value:s}),this.log(this.units,"exponentialRampToValueAtTime",e,i),this._param.exponentialRampToValueAtTime(s,i),this}exponentialRampTo(e,t,s){return s=this.toSeconds(s),this.setRampPoint(s),this.exponentialRampToValueAtTime(e,s+this.toSeconds(t)),this}linearRampTo(e,t,s){return s=this.toSeconds(s),this.setRampPoint(s),this.linearRampToValueAtTime(e,s+this.toSeconds(t)),this}targetRampTo(e,t,s){return s=this.toSeconds(s),this.setRampPoint(s),this.exponentialApproachValueAtTime(e,s,t),this}exponentialApproachValueAtTime(e,t,s){t=this.toSeconds(t),s=this.toSeconds(s);const i=Math.log(s+1)/Math.log(200);return this.setTargetAtTime(e,t,i),this.cancelAndHoldAtTime(t+s*.9),this.linearRampToValueAtTime(e,t+s),this}setTargetAtTime(e,t,s){const i=this._fromType(e);$(isFinite(s)&&s>0,"timeConstant must be a number greater than 0");const r=this.toSeconds(t);return this._assertRange(i),$(isFinite(i)&&isFinite(r),`Invalid argument(s) to setTargetAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._events.add({constant:s,time:r,type:"setTargetAtTime",value:i}),this.log(this.units,"setTargetAtTime",e,r,s),this._param.setTargetAtTime(i,r,s),this}setValueCurveAtTime(e,t,s,i=1){s=this.toSeconds(s),t=this.toSeconds(t);const r=this._fromType(e[0])*i;this.setValueAtTime(this._toType(r),t);const o=s/(e.length-1);for(let a=1;a<e.length;a++){const c=this._fromType(e[a])*i;this.linearRampToValueAtTime(this._toType(c),t+a*o)}return this}cancelScheduledValues(e){const t=this.toSeconds(e);return $(isFinite(t),`Invalid argument to cancelScheduledValues: ${JSON.stringify(e)}`),this._events.cancel(t),this._param.cancelScheduledValues(t),this.log(this.units,"cancelScheduledValues",t),this}cancelAndHoldAtTime(e){const t=this.toSeconds(e),s=this._fromType(this.getValueAtTime(t));$(isFinite(t),`Invalid argument to cancelAndHoldAtTime: ${JSON.stringify(e)}`),this.log(this.units,"cancelAndHoldAtTime",t,"value="+s);const i=this._events.get(t),r=this._events.getAfter(t);return i&&Dt(i.time,t)?r?(this._param.cancelScheduledValues(r.time),this._events.cancel(r.time)):(this._param.cancelAndHoldAtTime(t),this._events.cancel(t+this.sampleTime)):r&&(this._param.cancelScheduledValues(r.time),this._events.cancel(r.time),r.type==="linearRampToValueAtTime"?this.linearRampToValueAtTime(this._toType(s),t):r.type==="exponentialRampToValueAtTime"&&this.exponentialRampToValueAtTime(this._toType(s),t)),this._events.add({time:t,type:"setValueAtTime",value:s}),this._param.setValueAtTime(s,t),this}rampTo(e,t=.1,s){return this.units==="frequency"||this.units==="bpm"||this.units==="decibels"?this.exponentialRampTo(e,t,s):this.linearRampTo(e,t,s),this}apply(e){const t=this.context.currentTime;e.setValueAtTime(this.getValueAtTime(t),t);const s=this._events.get(t);if(s&&s.type==="setTargetAtTime"){const i=this._events.getAfter(s.time),r=i?i.time:t+2,o=(r-t)/10;for(let a=t;a<r;a+=o)e.linearRampToValueAtTime(this.getValueAtTime(a),a)}return this._events.forEachAfter(this.context.currentTime,i=>{i.type==="cancelScheduledValues"?e.cancelScheduledValues(i.time):i.type==="setTargetAtTime"?e.setTargetAtTime(i.value,i.time,i.constant):e[i.type](i.value,i.time)}),this}setParam(e){$(this._swappable,"The Param must be assigned as 'swappable' in the constructor");const t=this.input;return t.disconnect(this._param),this.apply(e),this._param=e,t.connect(this._param),this}dispose(){return super.dispose(),this._events.dispose(),this}get defaultValue(){return this._toType(this._param.defaultValue)}_exponentialApproach(e,t,s,i,r){return s+(t-s)*Math.exp(-(r-e)/i)}_linearInterpolate(e,t,s,i,r){return t+(i-t)*((r-e)/(s-e))}_exponentialInterpolate(e,t,s,i,r){return t*Math.pow(i/t,(r-e)/(s-e))}}class W extends ct{constructor(){super(...arguments),this._internalChannels=[]}get numberOfInputs(){return J(this.input)?an(this.input)||this.input instanceof ce?1:this.input.numberOfInputs:0}get numberOfOutputs(){return J(this.output)?this.output.numberOfOutputs:0}_isAudioNode(e){return J(e)&&(e instanceof W||Ds(e))}_getInternalNodes(){const e=this._internalChannels.slice(0);return this._isAudioNode(this.input)&&e.push(this.input),this._isAudioNode(this.output)&&this.input!==this.output&&e.push(this.output),e}_setChannelProperties(e){this._getInternalNodes().forEach(s=>{s.channelCount=e.channelCount,s.channelCountMode=e.channelCountMode,s.channelInterpretation=e.channelInterpretation})}_getChannelProperties(){const e=this._getInternalNodes();$(e.length>0,"ToneAudioNode does not have any internal nodes");const t=e[0];return{channelCount:t.channelCount,channelCountMode:t.channelCountMode,channelInterpretation:t.channelInterpretation}}get channelCount(){return this._getChannelProperties().channelCount}set channelCount(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelCount:e}))}get channelCountMode(){return this._getChannelProperties().channelCountMode}set channelCountMode(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelCountMode:e}))}get channelInterpretation(){return this._getChannelProperties().channelInterpretation}set channelInterpretation(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelInterpretation:e}))}connect(e,t=0,s=0){return Ns(this,e,t,s),this}toDestination(){return this.connect(this.context.destination),this}toMaster(){return lc("toMaster() has been renamed toDestination()"),this.toDestination()}disconnect(e,t=0,s=0){return aT(this,e,t,s),this}chain(...e){return Pi(this,...e),this}fan(...e){return e.forEach(t=>this.connect(t)),this}dispose(){return super.dispose(),J(this.input)&&(this.input instanceof W?this.input.dispose():Ds(this.input)&&this.input.disconnect()),J(this.output)&&(this.output instanceof W?this.output.dispose():Ds(this.output)&&this.output.disconnect()),this._internalChannels=[],this}}function Pi(...n){const e=n.shift();n.reduce((t,s)=>(t instanceof W?t.connect(s):Ds(t)&&Ns(t,s),s),e)}function Ns(n,e,t=0,s=0){for($(J(n),"Cannot connect from undefined node"),$(J(e),"Cannot connect to undefined node"),(e instanceof W||Ds(e))&&$(e.numberOfInputs>0,"Cannot connect to node with no inputs"),$(n.numberOfOutputs>0,"Cannot connect from node with no outputs");e instanceof W||e instanceof ce;)J(e.input)&&(e=e.input);for(;n instanceof W;)J(n.output)&&(n=n.output);an(e)?n.connect(e,t):n.connect(e,t,s)}function aT(n,e,t=0,s=0){if(J(e))for(;e instanceof W;)e=e.input;for(;!Ds(n);)J(n.output)&&(n=n.output);an(e)?n.disconnect(e,t):Ds(e)?n.disconnect(e,t,s):n.disconnect()}class de extends W{constructor(){super(k(de.getDefaults(),arguments,["gain","units"])),this.name="Gain",this._gainNode=this.context.createGain(),this.input=this._gainNode,this.output=this._gainNode;const e=k(de.getDefaults(),arguments,["gain","units"]);this.gain=new ce({context:this.context,convert:e.convert,param:this._gainNode.gain,units:e.units,value:e.gain,minValue:e.minValue,maxValue:e.maxValue}),ge(this,"gain")}static getDefaults(){return Object.assign(W.getDefaults(),{convert:!0,gain:1,units:"gain"})}dispose(){return super.dispose(),this._gainNode.disconnect(),this.gain.dispose(),this}}class Gn extends W{constructor(e){super(e),this.onended=oe,this._startTime=-1,this._stopTime=-1,this._timeout=-1,this.output=new de({context:this.context,gain:0}),this._gainNode=this.output,this.getStateAtTime=function(t){const s=this.toSeconds(t);return this._startTime!==-1&&s>=this._startTime&&(this._stopTime===-1||s<=this._stopTime)?"started":"stopped"},this._fadeIn=e.fadeIn,this._fadeOut=e.fadeOut,this._curve=e.curve,this.onended=e.onended}static getDefaults(){return Object.assign(W.getDefaults(),{curve:"linear",fadeIn:0,fadeOut:0,onended:oe})}_startGain(e,t=1){$(this._startTime===-1,"Source cannot be started more than once");const s=this.toSeconds(this._fadeIn);return this._startTime=e+s,this._startTime=Math.max(this._startTime,this.context.currentTime),s>0?(this._gainNode.gain.setValueAtTime(0,e),this._curve==="linear"?this._gainNode.gain.linearRampToValueAtTime(t,e+s):this._gainNode.gain.exponentialApproachValueAtTime(t,e,s)):this._gainNode.gain.setValueAtTime(t,e),this}stop(e){return this.log("stop",e),this._stopGain(this.toSeconds(e)),this}_stopGain(e){$(this._startTime!==-1,"'start' must be called before 'stop'"),this.cancelStop();const t=this.toSeconds(this._fadeOut);return this._stopTime=this.toSeconds(e)+t,this._stopTime=Math.max(this._stopTime,this.now()),t>0?this._curve==="linear"?this._gainNode.gain.linearRampTo(0,t,e):this._gainNode.gain.targetRampTo(0,t,e):(this._gainNode.gain.cancelAndHoldAtTime(e),this._gainNode.gain.setValueAtTime(0,e)),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout(()=>{const s=this._curve==="exponential"?t*2:0;this._stopSource(this.now()+s),this._onended()},this._stopTime-this.context.currentTime),this}_onended(){if(this.onended!==oe&&(this.onended(this),this.onended=oe,!this.context.isOffline)){const e=()=>this.dispose();typeof window.requestIdleCallback<"u"?window.requestIdleCallback(e):setTimeout(e,1e3)}}get state(){return this.getStateAtTime(this.now())}cancelStop(){return this.log("cancelStop"),$(this._startTime!==-1,"Source is not started"),this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this.context.clearTimeout(this._timeout),this._stopTime=-1,this}dispose(){return super.dispose(),this._gainNode.dispose(),this.onended=oe,this}}class jr extends Gn{constructor(){super(k(jr.getDefaults(),arguments,["offset"])),this.name="ToneConstantSource",this._source=this.context.createConstantSource();const e=k(jr.getDefaults(),arguments,["offset"]);Ns(this._source,this._gainNode),this.offset=new ce({context:this.context,convert:e.convert,param:this._source.offset,units:e.units,value:e.offset,minValue:e.minValue,maxValue:e.maxValue})}static getDefaults(){return Object.assign(Gn.getDefaults(),{convert:!0,offset:1,units:"number"})}start(e){const t=this.toSeconds(e);return this.log("start",t),this._startGain(t),this._source.start(t),this}_stopSource(e){this._source.stop(e)}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._source.disconnect(),this.offset.dispose(),this}}class me extends W{constructor(){super(k(me.getDefaults(),arguments,["value","units"])),this.name="Signal",this.override=!0;const e=k(me.getDefaults(),arguments,["value","units"]);this.output=this._constantSource=new jr({context:this.context,convert:e.convert,offset:e.value,units:e.units,minValue:e.minValue,maxValue:e.maxValue}),this._constantSource.start(0),this.input=this._param=this._constantSource.offset}static getDefaults(){return Object.assign(W.getDefaults(),{convert:!0,units:"number",value:0})}connect(e,t=0,s=0){return pc(this,e,t,s),this}dispose(){return super.dispose(),this._param.dispose(),this._constantSource.dispose(),this}setValueAtTime(e,t){return this._param.setValueAtTime(e,t),this}getValueAtTime(e){return this._param.getValueAtTime(e)}setRampPoint(e){return this._param.setRampPoint(e),this}linearRampToValueAtTime(e,t){return this._param.linearRampToValueAtTime(e,t),this}exponentialRampToValueAtTime(e,t){return this._param.exponentialRampToValueAtTime(e,t),this}exponentialRampTo(e,t,s){return this._param.exponentialRampTo(e,t,s),this}linearRampTo(e,t,s){return this._param.linearRampTo(e,t,s),this}targetRampTo(e,t,s){return this._param.targetRampTo(e,t,s),this}exponentialApproachValueAtTime(e,t,s){return this._param.exponentialApproachValueAtTime(e,t,s),this}setTargetAtTime(e,t,s){return this._param.setTargetAtTime(e,t,s),this}setValueCurveAtTime(e,t,s,i){return this._param.setValueCurveAtTime(e,t,s,i),this}cancelScheduledValues(e){return this._param.cancelScheduledValues(e),this}cancelAndHoldAtTime(e){return this._param.cancelAndHoldAtTime(e),this}rampTo(e,t,s){return this._param.rampTo(e,t,s),this}get value(){return this._param.value}set value(e){this._param.value=e}get convert(){return this._param.convert}set convert(e){this._param.convert=e}get units(){return this._param.units}get overridden(){return this._param.overridden}set overridden(e){this._param.overridden=e}get maxValue(){return this._param.maxValue}get minValue(){return this._param.minValue}apply(e){return this._param.apply(e),this}}function pc(n,e,t,s){(e instanceof ce||an(e)||e instanceof me&&e.override)&&(e.cancelScheduledValues(0),e.setValueAtTime(0,0),e instanceof me&&(e.overridden=!0)),Ns(n,e,t,s)}class Yr extends ce{constructor(){super(k(Yr.getDefaults(),arguments,["value"])),this.name="TickParam",this._events=new Ct(1/0),this._multiplier=1;const e=k(Yr.getDefaults(),arguments,["value"]);this._multiplier=e.multiplier,this._events.cancel(0),this._events.add({ticks:0,time:0,type:"setValueAtTime",value:this._fromType(e.value)}),this.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(ce.getDefaults(),{multiplier:1,units:"hertz",value:1})}setTargetAtTime(e,t,s){t=this.toSeconds(t),this.setRampPoint(t);const i=this._fromType(e),r=this._events.get(t),o=Math.round(Math.max(1/s,1));for(let a=0;a<=o;a++){const c=s*a+t,l=this._exponentialApproach(r.time,r.value,i,s,c);this.linearRampToValueAtTime(this._toType(l),c)}return this}setValueAtTime(e,t){const s=this.toSeconds(t);super.setValueAtTime(e,t);const i=this._events.get(s),r=this._events.previousEvent(i),o=this._getTicksUntilEvent(r,s);return i.ticks=Math.max(o,0),this}linearRampToValueAtTime(e,t){const s=this.toSeconds(t);super.linearRampToValueAtTime(e,t);const i=this._events.get(s),r=this._events.previousEvent(i),o=this._getTicksUntilEvent(r,s);return i.ticks=Math.max(o,0),this}exponentialRampToValueAtTime(e,t){t=this.toSeconds(t);const s=this._fromType(e),i=this._events.get(t),r=Math.round(Math.max((t-i.time)*10,1)),o=(t-i.time)/r;for(let a=0;a<=r;a++){const c=o*a+i.time,l=this._exponentialInterpolate(i.time,i.value,t,s,c);this.linearRampToValueAtTime(this._toType(l),c)}return this}_getTicksUntilEvent(e,t){if(e===null)e={ticks:0,time:0,type:"setValueAtTime",value:0};else if(mt(e.ticks)){const o=this._events.previousEvent(e);e.ticks=this._getTicksUntilEvent(o,e.time)}const s=this._fromType(this.getValueAtTime(e.time));let i=this._fromType(this.getValueAtTime(t));const r=this._events.get(t);return r&&r.time===t&&r.type==="setValueAtTime"&&(i=this._fromType(this.getValueAtTime(t-this.sampleTime))),.5*(t-e.time)*(s+i)+e.ticks}getTicksAtTime(e){const t=this.toSeconds(e),s=this._events.get(t);return Math.max(this._getTicksUntilEvent(s,t),0)}getDurationOfTicks(e,t){const s=this.toSeconds(t),i=this.getTicksAtTime(t);return this.getTimeOfTick(i+e)-s}getTimeOfTick(e){const t=this._events.get(e,"ticks"),s=this._events.getAfter(e,"ticks");if(t&&t.ticks===e)return t.time;if(t&&s&&s.type==="linearRampToValueAtTime"&&t.value!==s.value){const i=this._fromType(this.getValueAtTime(t.time)),o=(this._fromType(this.getValueAtTime(s.time))-i)/(s.time-t.time),a=Math.sqrt(Math.pow(i,2)-2*o*(t.ticks-e)),c=(-i+a)/o,l=(-i-a)/o;return(c>0?c:l)+t.time}else return t?t.value===0?1/0:t.time+(e-t.ticks)/t.value:e/this._initialValue}ticksToTime(e,t){return this.getDurationOfTicks(e,t)}timeToTicks(e,t){const s=this.toSeconds(t),i=this.toSeconds(e),r=this.getTicksAtTime(s);return this.getTicksAtTime(s+i)-r}_fromType(e){return this.units==="bpm"&&this.multiplier?1/(60/e/this.multiplier):super._fromType(e)}_toType(e){return this.units==="bpm"&&this.multiplier?e/this.multiplier*60:super._toType(e)}get multiplier(){return this._multiplier}set multiplier(e){const t=this.value;this._multiplier=e,this.cancelScheduledValues(0),this.setValueAtTime(t,0)}}class Zr extends me{constructor(){super(k(Zr.getDefaults(),arguments,["value"])),this.name="TickSignal";const e=k(Zr.getDefaults(),arguments,["value"]);this.input=this._param=new Yr({context:this.context,convert:e.convert,multiplier:e.multiplier,param:this._constantSource.offset,units:e.units,value:e.value})}static getDefaults(){return Object.assign(me.getDefaults(),{multiplier:1,units:"hertz",value:1})}ticksToTime(e,t){return this._param.ticksToTime(e,t)}timeToTicks(e,t){return this._param.timeToTicks(e,t)}getTimeOfTick(e){return this._param.getTimeOfTick(e)}getDurationOfTicks(e,t){return this._param.getDurationOfTicks(e,t)}getTicksAtTime(e){return this._param.getTicksAtTime(e)}get multiplier(){return this._param.multiplier}set multiplier(e){this._param.multiplier=e}dispose(){return super.dispose(),this._param.dispose(),this}}class Xr extends ct{constructor(){super(k(Xr.getDefaults(),arguments,["frequency"])),this.name="TickSource",this._state=new fc,this._tickOffset=new Ct,this._ticksAtTime=new Ct,this._secondsAtTime=new Ct;const e=k(Xr.getDefaults(),arguments,["frequency"]);this.frequency=new Zr({context:this.context,units:e.units,value:e.frequency}),ge(this,"frequency"),this._state.setStateAtTime("stopped",0),this.setTicksAtTime(0,0)}static getDefaults(){return Object.assign({frequency:1,units:"hertz"},ct.getDefaults())}get state(){return this.getStateAtTime(this.now())}start(e,t){const s=this.toSeconds(e);return this._state.getValueAtTime(s)!=="started"&&(this._state.setStateAtTime("started",s),J(t)&&this.setTicksAtTime(t,s),this._ticksAtTime.cancel(s),this._secondsAtTime.cancel(s)),this}stop(e){const t=this.toSeconds(e);if(this._state.getValueAtTime(t)==="stopped"){const s=this._state.get(t);s&&s.time>0&&(this._tickOffset.cancel(s.time),this._state.cancel(s.time))}return this._state.cancel(t),this._state.setStateAtTime("stopped",t),this.setTicksAtTime(0,t),this._ticksAtTime.cancel(t),this._secondsAtTime.cancel(t),this}pause(e){const t=this.toSeconds(e);return this._state.getValueAtTime(t)==="started"&&(this._state.setStateAtTime("paused",t),this._ticksAtTime.cancel(t),this._secondsAtTime.cancel(t)),this}cancel(e){return e=this.toSeconds(e),this._state.cancel(e),this._tickOffset.cancel(e),this._ticksAtTime.cancel(e),this._secondsAtTime.cancel(e),this}getTicksAtTime(e){const t=this.toSeconds(e),s=this._state.getLastState("stopped",t),i=this._ticksAtTime.get(t),r={state:"paused",time:t};this._state.add(r);let o=i||s,a=i?i.ticks:0,c=null;return this._state.forEachBetween(o.time,t+this.sampleTime,l=>{let u=o.time;const h=this._tickOffset.get(l.time);h&&h.time>=o.time&&(a=h.ticks,u=h.time),o.state==="started"&&l.state!=="started"&&(a+=this.frequency.getTicksAtTime(l.time)-this.frequency.getTicksAtTime(u),l.time!=r.time&&(c={state:l.state,time:l.time,ticks:a})),o=l}),this._state.remove(r),c&&this._ticksAtTime.add(c),a}get ticks(){return this.getTicksAtTime(this.now())}set ticks(e){this.setTicksAtTime(e,this.now())}get seconds(){return this.getSecondsAtTime(this.now())}set seconds(e){const t=this.now(),s=this.frequency.timeToTicks(e,t);this.setTicksAtTime(s,t)}getSecondsAtTime(e){e=this.toSeconds(e);const t=this._state.getLastState("stopped",e),s={state:"paused",time:e};this._state.add(s);const i=this._secondsAtTime.get(e);let r=i||t,o=i?i.seconds:0,a=null;return this._state.forEachBetween(r.time,e+this.sampleTime,c=>{let l=r.time;const u=this._tickOffset.get(c.time);u&&u.time>=r.time&&(o=u.seconds,l=u.time),r.state==="started"&&c.state!=="started"&&(o+=c.time-l,c.time!=s.time&&(a={state:c.state,time:c.time,seconds:o})),r=c}),this._state.remove(s),a&&this._secondsAtTime.add(a),o}setTicksAtTime(e,t){return t=this.toSeconds(t),this._tickOffset.cancel(t),this._tickOffset.add({seconds:this.frequency.getDurationOfTicks(e,t),ticks:e,time:t}),this._ticksAtTime.cancel(t),this._secondsAtTime.cancel(t),this}getStateAtTime(e){return e=this.toSeconds(e),this._state.getValueAtTime(e)}getTimeOfTick(e,t=this.now()){const s=this._tickOffset.get(t),i=this._state.get(t),r=Math.max(s.time,i.time),o=this.frequency.getTicksAtTime(r)+e-s.ticks;return this.frequency.getTimeOfTick(o)}forEachTickBetween(e,t,s){let i=this._state.get(e);this._state.forEachBetween(e,t,o=>{i&&i.state==="started"&&o.state!=="started"&&this.forEachTickBetween(Math.max(i.time,e),o.time-this.sampleTime,s),i=o});let r=null;if(i&&i.state==="started"){const o=Math.max(i.time,e),a=this.frequency.getTicksAtTime(o),c=this.frequency.getTicksAtTime(i.time),l=a-c;let u=Math.ceil(l)-l;u=Dt(u,1)?0:u;let h=this.frequency.getTimeOfTick(a+u);for(;h<t;){try{s(h,Math.round(this.getTicksAtTime(h)))}catch(d){r=d;break}h+=this.frequency.getDurationOfTicks(1,h)}}if(r)throw r;return this}dispose(){return super.dispose(),this._state.dispose(),this._tickOffset.dispose(),this._ticksAtTime.dispose(),this._secondsAtTime.dispose(),this.frequency.dispose(),this}}class Ni extends ct{constructor(){super(k(Ni.getDefaults(),arguments,["callback","frequency"])),this.name="Clock",this.callback=oe,this._lastUpdate=0,this._state=new fc("stopped"),this._boundLoop=this._loop.bind(this);const e=k(Ni.getDefaults(),arguments,["callback","frequency"]);this.callback=e.callback,this._tickSource=new Xr({context:this.context,frequency:e.frequency,units:e.units}),this._lastUpdate=0,this.frequency=this._tickSource.frequency,ge(this,"frequency"),this._state.setStateAtTime("stopped",0),this.context.on("tick",this._boundLoop)}static getDefaults(){return Object.assign(ct.getDefaults(),{callback:oe,frequency:1,units:"hertz"})}get state(){return this._state.getValueAtTime(this.now())}start(e,t){Ph(this.context);const s=this.toSeconds(e);return this.log("start",s),this._state.getValueAtTime(s)!=="started"&&(this._state.setStateAtTime("started",s),this._tickSource.start(s,t),s<this._lastUpdate&&this.emit("start",s,t)),this}stop(e){const t=this.toSeconds(e);return this.log("stop",t),this._state.cancel(t),this._state.setStateAtTime("stopped",t),this._tickSource.stop(t),t<this._lastUpdate&&this.emit("stop",t),this}pause(e){const t=this.toSeconds(e);return this._state.getValueAtTime(t)==="started"&&(this._state.setStateAtTime("paused",t),this._tickSource.pause(t),t<this._lastUpdate&&this.emit("pause",t)),this}get ticks(){return Math.ceil(this.getTicksAtTime(this.now()))}set ticks(e){this._tickSource.ticks=e}get seconds(){return this._tickSource.seconds}set seconds(e){this._tickSource.seconds=e}getSecondsAtTime(e){return this._tickSource.getSecondsAtTime(e)}setTicksAtTime(e,t){return this._tickSource.setTicksAtTime(e,t),this}getTimeOfTick(e,t=this.now()){return this._tickSource.getTimeOfTick(e,t)}getTicksAtTime(e){return this._tickSource.getTicksAtTime(e)}nextTickTime(e,t){const s=this.toSeconds(t),i=this.getTicksAtTime(s);return this._tickSource.getTimeOfTick(i+e,s)}_loop(){const e=this._lastUpdate,t=this.now();this._lastUpdate=t,this.log("loop",e,t),e!==t&&(this._state.forEachBetween(e,t,s=>{switch(s.state){case"started":const i=this._tickSource.getTicksAtTime(s.time);this.emit("start",s.time,i);break;case"stopped":s.time!==0&&this.emit("stop",s.time);break;case"paused":this.emit("pause",s.time);break}}),this._tickSource.forEachTickBetween(e,t,(s,i)=>{this.callback(s,i)}))}getStateAtTime(e){const t=this.toSeconds(e);return this._state.getValueAtTime(t)}dispose(){return super.dispose(),this.context.off("tick",this._boundLoop),this._tickSource.dispose(),this._state.dispose(),this}}rr.mixin(Ni);class mc extends ms{constructor(){super(),this.name="ToneAudioBuffers",this._buffers=new Map,this._loadingCount=0;const e=k(mc.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");this.baseUrl=e.baseUrl,Object.keys(e.urls).forEach(t=>{this._loadingCount++;const s=e.urls[t];this.add(t,s,this._bufferLoaded.bind(this,e.onload),e.onerror)})}static getDefaults(){return{baseUrl:"",onerror:oe,onload:oe,urls:{}}}has(e){return this._buffers.has(e.toString())}get(e){return $(this.has(e),`ToneAudioBuffers has no buffer named: ${e}`),this._buffers.get(e.toString())}_bufferLoaded(e){this._loadingCount--,this._loadingCount===0&&e&&e()}get loaded(){return Array.from(this._buffers).every(([e,t])=>t.loaded)}add(e,t,s=oe,i=oe){return us(t)?(this.baseUrl&&t.trim().substring(0,11).toLowerCase()==="data:audio/"&&(this.baseUrl=""),this._buffers.set(e.toString(),new ae(this.baseUrl+t,s,i))):this._buffers.set(e.toString(),new ae(t,s,i)),this}dispose(){return super.dispose(),this._buffers.forEach(e=>e.dispose()),this._buffers.clear(),this}}class Mn extends xi{constructor(){super(...arguments),this.name="Ticks",this.defaultUnits="i"}_now(){return this.context.transport.ticks}_beatsToUnits(e){return this._getPPQ()*e}_secondsToUnits(e){return Math.floor(e/(60/this._getBpm())*this._getPPQ())}_ticksToUnits(e){return e}toTicks(){return this.valueOf()}toSeconds(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())}}class cT extends ct{constructor(){super(...arguments),this.name="Draw",this.expiration=.25,this.anticipation=.008,this._events=new Ct,this._boundDrawLoop=this._drawLoop.bind(this),this._animationFrame=-1}schedule(e,t){return this._events.add({callback:e,time:this.toSeconds(t)}),this._events.length===1&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop)),this}cancel(e){return this._events.cancel(this.toSeconds(e)),this}_drawLoop(){const e=this.context.currentTime;for(;this._events.length&&this._events.peek().time-this.anticipation<=e;){const t=this._events.shift();t&&e-t.time<=this.expiration&&t.callback()}this._events.length>0&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop))}dispose(){return super.dispose(),this._events.dispose(),cancelAnimationFrame(this._animationFrame),this}}_o(n=>{n.draw=new cT({context:n})});go(n=>{n.draw.dispose()});class lT extends ms{constructor(){super(...arguments),this.name="IntervalTimeline",this._root=null,this._length=0}add(e){$(J(e.time),"Events must have a time property"),$(J(e.duration),"Events must have a duration parameter"),e.time=e.time.valueOf();let t=new uT(e.time,e.time+e.duration,e);for(this._root===null?this._root=t:this._root.insert(t),this._length++;t!==null;)t.updateHeight(),t.updateMax(),this._rebalance(t),t=t.parent;return this}remove(e){if(this._root!==null){const t=[];this._root.search(e.time,t);for(const s of t)if(s.event===e){this._removeNode(s),this._length--;break}}return this}get length(){return this._length}cancel(e){return this.forEachFrom(e,t=>this.remove(t)),this}_setRoot(e){this._root=e,this._root!==null&&(this._root.parent=null)}_replaceNodeInParent(e,t){e.parent!==null?(e.isLeftChild()?e.parent.left=t:e.parent.right=t,this._rebalance(e.parent)):this._setRoot(t)}_removeNode(e){if(e.left===null&&e.right===null)this._replaceNodeInParent(e,null);else if(e.right===null)this._replaceNodeInParent(e,e.left);else if(e.left===null)this._replaceNodeInParent(e,e.right);else{const t=e.getBalance();let s,i=null;if(t>0)if(e.left.right===null)s=e.left,s.right=e.right,i=s;else{for(s=e.left.right;s.right!==null;)s=s.right;s.parent&&(s.parent.right=s.left,i=s.parent,s.left=e.left,s.right=e.right)}else if(e.right.left===null)s=e.right,s.left=e.left,i=s;else{for(s=e.right.left;s.left!==null;)s=s.left;s.parent&&(s.parent.left=s.right,i=s.parent,s.left=e.left,s.right=e.right)}e.parent!==null?e.isLeftChild()?e.parent.left=s:e.parent.right=s:this._setRoot(s),i&&this._rebalance(i)}e.dispose()}_rotateLeft(e){const t=e.parent,s=e.isLeftChild(),i=e.right;i&&(e.right=i.left,i.left=e),t!==null?s?t.left=i:t.right=i:this._setRoot(i)}_rotateRight(e){const t=e.parent,s=e.isLeftChild(),i=e.left;i&&(e.left=i.right,i.right=e),t!==null?s?t.left=i:t.right=i:this._setRoot(i)}_rebalance(e){const t=e.getBalance();t>1&&e.left?e.left.getBalance()<0?this._rotateLeft(e.left):this._rotateRight(e):t<-1&&e.right&&(e.right.getBalance()>0?this._rotateRight(e.right):this._rotateLeft(e))}get(e){if(this._root!==null){const t=[];if(this._root.search(e,t),t.length>0){let s=t[0];for(let i=1;i<t.length;i++)t[i].low>s.low&&(s=t[i]);return s.event}}return null}forEach(e){if(this._root!==null){const t=[];this._root.traverse(s=>t.push(s)),t.forEach(s=>{s.event&&e(s.event)})}return this}forEachAtTime(e,t){if(this._root!==null){const s=[];this._root.search(e,s),s.forEach(i=>{i.event&&t(i.event)})}return this}forEachFrom(e,t){if(this._root!==null){const s=[];this._root.searchAfter(e,s),s.forEach(i=>{i.event&&t(i.event)})}return this}dispose(){return super.dispose(),this._root!==null&&this._root.traverse(e=>e.dispose()),this._root=null,this}}class uT{constructor(e,t,s){this._left=null,this._right=null,this.parent=null,this.height=0,this.event=s,this.low=e,this.high=t,this.max=this.high}insert(e){e.low<=this.low?this.left===null?this.left=e:this.left.insert(e):this.right===null?this.right=e:this.right.insert(e)}search(e,t){e>this.max||(this.left!==null&&this.left.search(e,t),this.low<=e&&this.high>e&&t.push(this),!(this.low>e)&&this.right!==null&&this.right.search(e,t))}searchAfter(e,t){this.low>=e&&(t.push(this),this.left!==null&&this.left.searchAfter(e,t)),this.right!==null&&this.right.searchAfter(e,t)}traverse(e){e(this),this.left!==null&&this.left.traverse(e),this.right!==null&&this.right.traverse(e)}updateHeight(){this.left!==null&&this.right!==null?this.height=Math.max(this.left.height,this.right.height)+1:this.right!==null?this.height=this.right.height+1:this.left!==null?this.height=this.left.height+1:this.height=0}updateMax(){this.max=this.high,this.left!==null&&(this.max=Math.max(this.max,this.left.max)),this.right!==null&&(this.max=Math.max(this.max,this.right.max))}getBalance(){let e=0;return this.left!==null&&this.right!==null?e=this.left.height-this.right.height:this.left!==null?e=this.left.height+1:this.right!==null&&(e=-(this.right.height+1)),e}isLeftChild(){return this.parent!==null&&this.parent.left===this}get left(){return this._left}set left(e){this._left=e,e!==null&&(e.parent=this),this.updateHeight(),this.updateMax()}get right(){return this._right}set right(e){this._right=e,e!==null&&(e.parent=this),this.updateHeight(),this.updateMax()}dispose(){this.parent=null,this._left=null,this._right=null,this.event=null}}class Is extends W{constructor(){super(k(Is.getDefaults(),arguments,["volume"])),this.name="Volume";const e=k(Is.getDefaults(),arguments,["volume"]);this.input=this.output=new de({context:this.context,gain:e.volume,units:"decibels"}),this.volume=this.output.gain,ge(this,"volume"),this._unmutedVolume=e.volume,this.mute=e.mute}static getDefaults(){return Object.assign(W.getDefaults(),{mute:!1,volume:0})}get mute(){return this.volume.value===-1/0}set mute(e){!this.mute&&e?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!e&&(this.volume.value=this._unmutedVolume)}dispose(){return super.dispose(),this.input.dispose(),this.volume.dispose(),this}}let hT=class Ta extends W{constructor(){super(k(Ta.getDefaults(),arguments)),this.name="Destination",this.input=new Is({context:this.context}),this.output=new de({context:this.context}),this.volume=this.input.volume;const e=k(Ta.getDefaults(),arguments);Pi(this.input,this.output,this.context.rawContext.destination),this.mute=e.mute,this._internalChannels=[this.input,this.context.rawContext.destination,this.output]}static getDefaults(){return Object.assign(W.getDefaults(),{mute:!1,volume:0})}get mute(){return this.input.mute}set mute(e){this.input.mute=e}chain(...e){return this.input.disconnect(),e.unshift(this.input),e.push(this.output),Pi(...e),this}get maxChannelCount(){return this.context.rawContext.destination.maxChannelCount}dispose(){return super.dispose(),this.volume.dispose(),this}};_o(n=>{n.destination=new hT({context:n})});go(n=>{n.destination.dispose()});class dT extends ms{constructor(e){super(),this.name="TimelineValue",this._timeline=new Ct({memory:10}),this._initialValue=e}set(e,t){return this._timeline.add({value:e,time:t}),this}get(e){const t=this._timeline.get(e);return t?t.value:this._initialValue}}class hs extends W{constructor(){super(Object.assign(k(hs.getDefaults(),arguments,["context"])))}connect(e,t=0,s=0){return pc(this,e,t,s),this}}class cn extends hs{constructor(){super(Object.assign(k(cn.getDefaults(),arguments,["mapping","length"]))),this.name="WaveShaper",this._shaper=this.context.createWaveShaper(),this.input=this._shaper,this.output=this._shaper;const e=k(cn.getDefaults(),arguments,["mapping","length"]);Pt(e.mapping)||e.mapping instanceof Float32Array?this.curve=Float32Array.from(e.mapping):Iy(e.mapping)&&this.setMap(e.mapping,e.length)}static getDefaults(){return Object.assign(me.getDefaults(),{length:1024})}setMap(e,t=1024){const s=new Float32Array(t);for(let i=0,r=t;i<r;i++){const o=i/(r-1)*2-1;s[i]=e(o,i)}return this.curve=s,this}get curve(){return this._shaper.curve}set curve(e){this._shaper.curve=e}get oversample(){return this._shaper.oversample}set oversample(e){const t=["none","2x","4x"].some(s=>s.includes(e));$(t,"oversampling must be either 'none', '2x', or '4x'"),this._shaper.oversample=e}dispose(){return super.dispose(),this._shaper.disconnect(),this}}class Ii extends hs{constructor(){super(Object.assign(k(Ii.getDefaults(),arguments,["value"]))),this.name="Pow";const e=k(Ii.getDefaults(),arguments,["value"]);this._exponentScaler=this.input=this.output=new cn({context:this.context,mapping:this._expFunc(e.value),length:8192}),this._exponent=e.value}static getDefaults(){return Object.assign(hs.getDefaults(),{value:1})}_expFunc(e){return t=>Math.pow(Math.abs(t),e)}get value(){return this._exponent}set value(e){this._exponent=e,this._exponentScaler.setMap(this._expFunc(this._exponent))}dispose(){return super.dispose(),this._exponentScaler.dispose(),this}}class Fs{constructor(e,t){this.id=Fs._eventId++,this._remainderTime=0;const s=Object.assign(Fs.getDefaults(),t);this.transport=e,this.callback=s.callback,this._once=s.once,this.time=Math.floor(s.time),this._remainderTime=s.time-this.time}static getDefaults(){return{callback:oe,once:!1,time:0}}get floatTime(){return this.time+this._remainderTime}invoke(e){if(this.callback){const t=this.transport.bpm.getDurationOfTicks(1,e);this.callback(e+this._remainderTime*t),this._once&&this.transport.clear(this.id)}}dispose(){return this.callback=void 0,this}}Fs._eventId=0;class _c extends Fs{constructor(e,t){super(e,t),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this);const s=Object.assign(_c.getDefaults(),t);this.duration=s.duration,this._interval=s.interval,this._nextTick=s.time,this.transport.on("start",this._boundRestart),this.transport.on("loopStart",this._boundRestart),this.transport.on("ticks",this._boundRestart),this.context=this.transport.context,this._restart()}static getDefaults(){return Object.assign({},Fs.getDefaults(),{duration:1/0,interval:1,once:!1})}invoke(e){this._createEvents(e),super.invoke(e)}_createEvent(){return Gr(this._nextTick,this.floatTime+this.duration)?this.transport.scheduleOnce(this.invoke.bind(this),new Mn(this.context,this._nextTick).toSeconds()):-1}_createEvents(e){Gr(this._nextTick+this._interval,this.floatTime+this.duration)&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new Mn(this.context,this._nextTick).toSeconds()))}_restart(e){this.transport.clear(this._currentId),this.transport.clear(this._nextId),this._nextTick=this.floatTime;const t=this.transport.getTicksAtTime(e);Wn(t,this.time)&&(this._nextTick=this.floatTime+Math.ceil((t-this.floatTime)/this._interval)*this._interval),this._currentId=this._createEvent(),this._nextTick+=this._interval,this._nextId=this._createEvent()}dispose(){return super.dispose(),this.transport.clear(this._currentId),this.transport.clear(this._nextId),this.transport.off("start",this._boundRestart),this.transport.off("loopStart",this._boundRestart),this.transport.off("ticks",this._boundRestart),this}}class Fi extends ct{constructor(){super(k(Fi.getDefaults(),arguments)),this.name="Transport",this._loop=new dT(!1),this._loopStart=0,this._loopEnd=0,this._scheduledEvents={},this._timeline=new Ct,this._repeatedEvents=new lT,this._syncedSignals=[],this._swingAmount=0;const e=k(Fi.getDefaults(),arguments);this._ppq=e.ppq,this._clock=new Ni({callback:this._processTick.bind(this),context:this.context,frequency:0,units:"bpm"}),this._bindClockEvents(),this.bpm=this._clock.frequency,this._clock.frequency.multiplier=e.ppq,this.bpm.setValueAtTime(e.bpm,0),ge(this,"bpm"),this._timeSignature=e.timeSignature,this._swingTicks=e.ppq/2}static getDefaults(){return Object.assign(ct.getDefaults(),{bpm:120,loopEnd:"4m",loopStart:0,ppq:192,swing:0,swingSubdivision:"8n",timeSignature:4})}_processTick(e,t){if(this._loop.get(e)&&t>=this._loopEnd&&(this.emit("loopEnd",e),this._clock.setTicksAtTime(this._loopStart,e),t=this._loopStart,this.emit("loopStart",e,this._clock.getSecondsAtTime(e)),this.emit("loop",e)),this._swingAmount>0&&t%this._ppq!==0&&t%(this._swingTicks*2)!==0){const s=t%(this._swingTicks*2)/(this._swingTicks*2),i=Math.sin(s*Math.PI)*this._swingAmount;e+=new Mn(this.context,this._swingTicks*2/3).toSeconds()*i}yl(!0),this._timeline.forEachAtTime(t,s=>s.invoke(e)),yl(!1)}schedule(e,t){const s=new Fs(this,{callback:e,time:new xi(this.context,t).toTicks()});return this._addEvent(s,this._timeline)}scheduleRepeat(e,t,s,i=1/0){const r=new _c(this,{callback:e,duration:new Rt(this.context,i).toTicks(),interval:new Rt(this.context,t).toTicks(),time:new xi(this.context,s).toTicks()});return this._addEvent(r,this._repeatedEvents)}scheduleOnce(e,t){const s=new Fs(this,{callback:e,once:!0,time:new xi(this.context,t).toTicks()});return this._addEvent(s,this._timeline)}clear(e){if(this._scheduledEvents.hasOwnProperty(e)){const t=this._scheduledEvents[e.toString()];t.timeline.remove(t.event),t.event.dispose(),delete this._scheduledEvents[e.toString()]}return this}_addEvent(e,t){return this._scheduledEvents[e.id.toString()]={event:e,timeline:t},t.add(e),e.id}cancel(e=0){const t=this.toTicks(e);return this._timeline.forEachFrom(t,s=>this.clear(s.id)),this._repeatedEvents.forEachFrom(t,s=>this.clear(s.id)),this}_bindClockEvents(){this._clock.on("start",(e,t)=>{t=new Mn(this.context,t).toSeconds(),this.emit("start",e,t)}),this._clock.on("stop",e=>{this.emit("stop",e)}),this._clock.on("pause",e=>{this.emit("pause",e)})}get state(){return this._clock.getStateAtTime(this.now())}start(e,t){this.context.resume();let s;return J(t)&&(s=this.toTicks(t)),this._clock.start(e,s),this}stop(e){return this._clock.stop(e),this}pause(e){return this._clock.pause(e),this}toggle(e){return e=this.toSeconds(e),this._clock.getStateAtTime(e)!=="started"?this.start(e):this.stop(e),this}get timeSignature(){return this._timeSignature}set timeSignature(e){Pt(e)&&(e=e[0]/e[1]*4),this._timeSignature=e}get loopStart(){return new Rt(this.context,this._loopStart,"i").toSeconds()}set loopStart(e){this._loopStart=this.toTicks(e)}get loopEnd(){return new Rt(this.context,this._loopEnd,"i").toSeconds()}set loopEnd(e){this._loopEnd=this.toTicks(e)}get loop(){return this._loop.get(this.now())}set loop(e){this._loop.set(e,this.now())}setLoopPoints(e,t){return this.loopStart=e,this.loopEnd=t,this}get swing(){return this._swingAmount}set swing(e){this._swingAmount=e}get swingSubdivision(){return new Mn(this.context,this._swingTicks).toNotation()}set swingSubdivision(e){this._swingTicks=this.toTicks(e)}get position(){const e=this.now(),t=this._clock.getTicksAtTime(e);return new Mn(this.context,t).toBarsBeatsSixteenths()}set position(e){const t=this.toTicks(e);this.ticks=t}get seconds(){return this._clock.seconds}set seconds(e){const t=this.now(),s=this._clock.frequency.timeToTicks(e,t);this.ticks=s}get progress(){if(this.loop){const e=this.now();return(this._clock.getTicksAtTime(e)-this._loopStart)/(this._loopEnd-this._loopStart)}else return 0}get ticks(){return this._clock.ticks}set ticks(e){if(this._clock.ticks!==e){const t=this.now();if(this.state==="started"){const s=this._clock.getTicksAtTime(t),i=this._clock.frequency.getDurationOfTicks(Math.ceil(s)-s,t),r=t+i;this.emit("stop",r),this._clock.setTicksAtTime(e,r),this.emit("start",r,this._clock.getSecondsAtTime(r))}else this.emit("ticks",t),this._clock.setTicksAtTime(e,t)}}getTicksAtTime(e){return this._clock.getTicksAtTime(e)}getSecondsAtTime(e){return this._clock.getSecondsAtTime(e)}get PPQ(){return this._clock.frequency.multiplier}set PPQ(e){this._clock.frequency.multiplier=e}nextSubdivision(e){if(e=this.toTicks(e),this.state!=="started")return 0;{const t=this.now(),s=this.getTicksAtTime(t),i=e-s%e;return this._clock.nextTickTime(i,t)}}syncSignal(e,t){const s=this.now();let i=this.bpm,r=1/(60/i.getValueAtTime(s)/this.PPQ),o=[];if(e.units==="time"){const c=.015625/r,l=new de(c),u=new Ii(-1),h=new de(c);i.chain(l,u,h),i=h,r=1/r,o=[l,u,h]}t||(e.getValueAtTime(s)!==0?t=e.getValueAtTime(s)/r:t=0);const a=new de(t);return i.connect(a),a.connect(e._param),o.push(a),this._syncedSignals.push({initial:e.value,nodes:o,signal:e}),e.value=0,this}unsyncSignal(e){for(let t=this._syncedSignals.length-1;t>=0;t--){const s=this._syncedSignals[t];s.signal===e&&(s.nodes.forEach(i=>i.dispose()),s.signal.value=s.initial,this._syncedSignals.splice(t,1))}return this}dispose(){return super.dispose(),this._clock.dispose(),hc(this,"bpm"),this._timeline.dispose(),this._repeatedEvents.dispose(),this}}rr.mixin(Fi);_o(n=>{n.transport=new Fi({context:n})});go(n=>{n.transport.dispose()});class Xe extends W{constructor(e){super(e),this.input=void 0,this._state=new fc("stopped"),this._synced=!1,this._scheduled=[],this._syncedStart=oe,this._syncedStop=oe,this._state.memory=100,this._state.increasing=!0,this._volume=this.output=new Is({context:this.context,mute:e.mute,volume:e.volume}),this.volume=this._volume.volume,ge(this,"volume"),this.onstop=e.onstop}static getDefaults(){return Object.assign(W.getDefaults(),{mute:!1,onstop:oe,volume:0})}get state(){return this._synced?this.context.transport.state==="started"?this._state.getValueAtTime(this.context.transport.seconds):"stopped":this._state.getValueAtTime(this.now())}get mute(){return this._volume.mute}set mute(e){this._volume.mute=e}_clampToCurrentTime(e){return this._synced?e:Math.max(e,this.context.currentTime)}start(e,t,s){let i=mt(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(i=this._clampToCurrentTime(i),!this._synced&&this._state.getValueAtTime(i)==="started")$(Wn(i,this._state.get(i).time),"Start time must be strictly greater than previous start time"),this._state.cancel(i),this._state.setStateAtTime("started",i),this.log("restart",i),this.restart(i,t,s);else if(this.log("start",i),this._state.setStateAtTime("started",i),this._synced){const r=this._state.get(i);r&&(r.offset=this.toSeconds(Nn(t,0)),r.duration=s?this.toSeconds(s):void 0);const o=this.context.transport.schedule(a=>{this._start(a,t,s)},i);this._scheduled.push(o),this.context.transport.state==="started"&&this.context.transport.getSecondsAtTime(this.immediate())>i&&this._syncedStart(this.now(),this.context.transport.seconds)}else Ph(this.context),this._start(i,t,s);return this}stop(e){let t=mt(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(t=this._clampToCurrentTime(t),this._state.getValueAtTime(t)==="started"||J(this._state.getNextState("started",t))){if(this.log("stop",t),!this._synced)this._stop(t);else{const s=this.context.transport.schedule(this._stop.bind(this),t);this._scheduled.push(s)}this._state.cancel(t),this._state.setStateAtTime("stopped",t)}return this}restart(e,t,s){return e=this.toSeconds(e),this._state.getValueAtTime(e)==="started"&&(this._state.cancel(e),this._restart(e,t,s)),this}sync(){return this._synced||(this._synced=!0,this._syncedStart=(e,t)=>{if(Wn(t,0)){const s=this._state.get(t);if(s&&s.state==="started"&&s.time!==t){const i=t-this.toSeconds(s.time);let r;s.duration&&(r=this.toSeconds(s.duration)-i),this._start(e,this.toSeconds(s.offset)+i,r)}}},this._syncedStop=e=>{const t=this.context.transport.getSecondsAtTime(Math.max(e-this.sampleTime,0));this._state.getValueAtTime(t)==="started"&&this._stop(e)},this.context.transport.on("start",this._syncedStart),this.context.transport.on("loopStart",this._syncedStart),this.context.transport.on("stop",this._syncedStop),this.context.transport.on("pause",this._syncedStop),this.context.transport.on("loopEnd",this._syncedStop)),this}unsync(){return this._synced&&(this.context.transport.off("stop",this._syncedStop),this.context.transport.off("pause",this._syncedStop),this.context.transport.off("loopEnd",this._syncedStop),this.context.transport.off("start",this._syncedStart),this.context.transport.off("loopStart",this._syncedStart)),this._synced=!1,this._scheduled.forEach(e=>this.context.transport.clear(e)),this._scheduled=[],this._state.cancel(0),this._stop(0),this}dispose(){return super.dispose(),this.onstop=oe,this.unsync(),this._volume.dispose(),this._state.dispose(),this}}class jn extends Gn{constructor(){super(k(jn.getDefaults(),arguments,["url","onload"])),this.name="ToneBufferSource",this._source=this.context.createBufferSource(),this._internalChannels=[this._source],this._sourceStarted=!1,this._sourceStopped=!1;const e=k(jn.getDefaults(),arguments,["url","onload"]);Ns(this._source,this._gainNode),this._source.onended=()=>this._stopSource(),this.playbackRate=new ce({context:this.context,param:this._source.playbackRate,units:"positive",value:e.playbackRate}),this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this._buffer=new ae(e.url,e.onload,e.onerror),this._internalChannels.push(this._source)}static getDefaults(){return Object.assign(Gn.getDefaults(),{url:new ae,loop:!1,loopEnd:0,loopStart:0,onload:oe,onerror:oe,playbackRate:1})}get fadeIn(){return this._fadeIn}set fadeIn(e){this._fadeIn=e}get fadeOut(){return this._fadeOut}set fadeOut(e){this._fadeOut=e}get curve(){return this._curve}set curve(e){this._curve=e}start(e,t,s,i=1){$(this.buffer.loaded,"buffer is either not set or not loaded");const r=this.toSeconds(e);this._startGain(r,i),this.loop?t=Nn(t,this.loopStart):t=Nn(t,0);let o=Math.max(this.toSeconds(t),0);if(this.loop){const a=this.toSeconds(this.loopEnd)||this.buffer.duration,c=this.toSeconds(this.loopStart),l=a-c;va(o,a)&&(o=(o-c)%l+c),Dt(o,this.buffer.duration)&&(o=0)}if(this._source.buffer=this.buffer.get(),this._source.loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,Gr(o,this.buffer.duration)&&(this._sourceStarted=!0,this._source.start(r,o)),J(s)){let a=this.toSeconds(s);a=Math.max(a,0),this.stop(r+a)}return this}_stopSource(e){!this._sourceStopped&&this._sourceStarted&&(this._sourceStopped=!0,this._source.stop(this.toSeconds(e)),this._onended())}get loopStart(){return this._source.loopStart}set loopStart(e){this._source.loopStart=this.toSeconds(e)}get loopEnd(){return this._source.loopEnd}set loopEnd(e){this._source.loopEnd=this.toSeconds(e)}get buffer(){return this._buffer}set buffer(e){this._buffer.set(e)}get loop(){return this._source.loop}set loop(e){this._source.loop=e,this._sourceStarted&&this.cancelStop()}dispose(){return super.dispose(),this._source.onended=null,this._source.disconnect(),this._buffer.dispose(),this.playbackRate.dispose(),this}}class Ui extends Xe{constructor(){super(k(Ui.getDefaults(),arguments,["type"])),this.name="Noise",this._source=null;const e=k(Ui.getDefaults(),arguments,["type"]);this._playbackRate=e.playbackRate,this.type=e.type,this._fadeIn=e.fadeIn,this._fadeOut=e.fadeOut}static getDefaults(){return Object.assign(Xe.getDefaults(),{fadeIn:0,fadeOut:0,playbackRate:1,type:"white"})}get type(){return this._type}set type(e){if($(e in Tl,"Noise: invalid type: "+e),this._type!==e&&(this._type=e,this.state==="started")){const t=this.now();this._stop(t),this._start(t)}}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e,this._source&&(this._source.playbackRate.value=e)}_start(e){const t=Tl[this._type];this._source=new jn({url:t,context:this.context,fadeIn:this._fadeIn,fadeOut:this._fadeOut,loop:!0,onended:()=>this.onstop(this),playbackRate:this._playbackRate}).connect(this.output),this._source.start(this.toSeconds(e),Math.random()*(t.duration-.001))}_stop(e){this._source&&(this._source.stop(this.toSeconds(e)),this._source=null)}get fadeIn(){return this._fadeIn}set fadeIn(e){this._fadeIn=e,this._source&&(this._source.fadeIn=this._fadeIn)}get fadeOut(){return this._fadeOut}set fadeOut(e){this._fadeOut=e,this._source&&(this._source.fadeOut=this._fadeOut)}_restart(e){this._stop(e),this._start(e)}dispose(){return super.dispose(),this._source&&this._source.disconnect(),this}}const Sn=44100*5,Go=2,es={brown:null,pink:null,white:null},Tl={get brown(){if(!es.brown){const n=[];for(let e=0;e<Go;e++){const t=new Float32Array(Sn);n[e]=t;let s=0;for(let i=0;i<Sn;i++){const r=Math.random()*2-1;t[i]=(s+.02*r)/1.02,s=t[i],t[i]*=3.5}}es.brown=new ae().fromArray(n)}return es.brown},get pink(){if(!es.pink){const n=[];for(let e=0;e<Go;e++){const t=new Float32Array(Sn);n[e]=t;let s,i,r,o,a,c,l;s=i=r=o=a=c=l=0;for(let u=0;u<Sn;u++){const h=Math.random()*2-1;s=.99886*s+h*.0555179,i=.99332*i+h*.0750759,r=.969*r+h*.153852,o=.8665*o+h*.3104856,a=.55*a+h*.5329522,c=-.7616*c-h*.016898,t[u]=s+i+r+o+a+c+l+h*.5362,t[u]*=.11,l=h*.115926}}es.pink=new ae().fromArray(n)}return es.pink},get white(){if(!es.white){const n=[];for(let e=0;e<Go;e++){const t=new Float32Array(Sn);n[e]=t;for(let s=0;s<Sn;s++)t[s]=Math.random()*2-1}es.white=new ae().fromArray(n)}return es.white}};function pn(n,e){return Pe(this,void 0,void 0,function*(){const t=e/n.context.sampleRate,s=new vo(1,t,n.context.sampleRate);return new n.constructor(Object.assign(n.get(),{frequency:2/t,detune:0,context:s})).toDestination().start(0),(yield s.render()).getChannelData(0)})}class $r extends Gn{constructor(){super(k($r.getDefaults(),arguments,["frequency","type"])),this.name="ToneOscillatorNode",this._oscillator=this.context.createOscillator(),this._internalChannels=[this._oscillator];const e=k($r.getDefaults(),arguments,["frequency","type"]);Ns(this._oscillator,this._gainNode),this.type=e.type,this.frequency=new ce({context:this.context,param:this._oscillator.frequency,units:"frequency",value:e.frequency}),this.detune=new ce({context:this.context,param:this._oscillator.detune,units:"cents",value:e.detune}),ge(this,["frequency","detune"])}static getDefaults(){return Object.assign(Gn.getDefaults(),{detune:0,frequency:440,type:"sine"})}start(e){const t=this.toSeconds(e);return this.log("start",t),this._startGain(t),this._oscillator.start(t),this}_stopSource(e){this._oscillator.stop(e)}setPeriodicWave(e){return this._oscillator.setPeriodicWave(e),this}get type(){return this._oscillator.type}set type(e){this._oscillator.type=e}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._oscillator.disconnect(),this.frequency.dispose(),this.detune.dispose(),this}}class ke extends Xe{constructor(){super(k(ke.getDefaults(),arguments,["frequency","type"])),this.name="Oscillator",this._oscillator=null;const e=k(ke.getDefaults(),arguments,["frequency","type"]);this.frequency=new me({context:this.context,units:"frequency",value:e.frequency}),ge(this,"frequency"),this.detune=new me({context:this.context,units:"cents",value:e.detune}),ge(this,"detune"),this._partials=e.partials,this._partialCount=e.partialCount,this._type=e.type,e.partialCount&&e.type!=="custom"&&(this._type=this.baseType+e.partialCount.toString()),this.phase=e.phase}static getDefaults(){return Object.assign(Xe.getDefaults(),{detune:0,frequency:440,partialCount:0,partials:[],phase:0,type:"sine"})}_start(e){const t=this.toSeconds(e),s=new $r({context:this.context,onended:()=>this.onstop(this)});this._oscillator=s,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(t)}_stop(e){const t=this.toSeconds(e);this._oscillator&&this._oscillator.stop(t)}_restart(e){const t=this.toSeconds(e);return this.log("restart",t),this._oscillator&&this._oscillator.cancelStop(),this._state.cancel(t),this}syncFrequency(){return this.context.transport.syncSignal(this.frequency),this}unsyncFrequency(){return this.context.transport.unsyncSignal(this.frequency),this}_getCachedPeriodicWave(){if(this._type==="custom")return ke._periodicWaveCache.find(t=>t.phase===this._phase&&jy(t.partials,this._partials));{const e=ke._periodicWaveCache.find(t=>t.type===this._type&&t.phase===this._phase);return this._partialCount=e?e.partialCount:this._partialCount,e}}get type(){return this._type}set type(e){this._type=e;const t=["sine","square","sawtooth","triangle"].indexOf(e)!==-1;if(this._phase===0&&t)this._wave=void 0,this._partialCount=0,this._oscillator!==null&&(this._oscillator.type=e);else{const s=this._getCachedPeriodicWave();if(J(s)){const{partials:i,wave:r}=s;this._wave=r,this._partials=i,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave)}else{const[i,r]=this._getRealImaginary(e,this._phase),o=this.context.createPeriodicWave(i,r);this._wave=o,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave),ke._periodicWaveCache.push({imag:r,partialCount:this._partialCount,partials:this._partials,phase:this._phase,real:i,type:this._type,wave:this._wave}),ke._periodicWaveCache.length>100&&ke._periodicWaveCache.shift()}}}get baseType(){return this._type.replace(this.partialCount.toString(),"")}set baseType(e){this.partialCount&&this._type!=="custom"&&e!=="custom"?this.type=e+this.partialCount:this.type=e}get partialCount(){return this._partialCount}set partialCount(e){It(e,0);let t=this._type;const s=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(this._type);if(s&&(t=s[1]),this._type!=="custom")e===0?this.type=t:this.type=t+e.toString();else{const i=new Float32Array(e);this._partials.forEach((r,o)=>i[o]=r),this._partials=Array.from(i),this.type=this._type}}_getRealImaginary(e,t){let i=2048;const r=new Float32Array(i),o=new Float32Array(i);let a=1;if(e==="custom"){if(a=this._partials.length+1,this._partialCount=this._partials.length,i=a,this._partials.length===0)return[r,o]}else{const c=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(e);c?(a=parseInt(c[2],10)+1,this._partialCount=parseInt(c[2],10),e=c[1],a=Math.max(a,2),i=a):this._partialCount=0,this._partials=[]}for(let c=1;c<i;++c){const l=2/(c*Math.PI);let u;switch(e){case"sine":u=c<=a?1:0,this._partials[c-1]=u;break;case"square":u=c&1?2*l:0,this._partials[c-1]=u;break;case"sawtooth":u=l*(c&1?1:-1),this._partials[c-1]=u;break;case"triangle":c&1?u=2*(l*l)*(c-1>>1&1?-1:1):u=0,this._partials[c-1]=u;break;case"custom":u=this._partials[c-1];break;default:throw new TypeError("Oscillator: invalid type: "+e)}u!==0?(r[c]=-u*Math.sin(t*c),o[c]=u*Math.cos(t*c)):(r[c]=0,o[c]=0)}return[r,o]}_inverseFFT(e,t,s){let i=0;const r=e.length;for(let o=0;o<r;o++)i+=e[o]*Math.cos(o*s)+t[o]*Math.sin(o*s);return i}getInitialValue(){const[e,t]=this._getRealImaginary(this._type,0);let s=0;const i=Math.PI*2,r=32;for(let o=0;o<r;o++)s=Math.max(this._inverseFFT(e,t,o/r*i),s);return Zy(-this._inverseFFT(e,t,this._phase)/s,-1,1)}get partials(){return this._partials.slice(0,this.partialCount)}set partials(e){this._partials=e,this._partialCount=this._partials.length,e.length&&(this.type="custom")}get phase(){return this._phase*(180/Math.PI)}set phase(e){this._phase=e*Math.PI/180,this.type=this._type}asArray(e=1024){return Pe(this,void 0,void 0,function*(){return pn(this,e)})}dispose(){return super.dispose(),this._oscillator!==null&&this._oscillator.dispose(),this._wave=void 0,this.frequency.dispose(),this.detune.dispose(),this}}ke._periodicWaveCache=[];class fT extends hs{constructor(){super(...arguments),this.name="AudioToGain",this._norm=new cn({context:this.context,mapping:e=>(e+1)/2}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class Us extends me{constructor(){super(Object.assign(k(Us.getDefaults(),arguments,["value"]))),this.name="Multiply",this.override=!1;const e=k(Us.getDefaults(),arguments,["value"]);this._mult=this.input=this.output=new de({context:this.context,minValue:e.minValue,maxValue:e.maxValue}),this.factor=this._param=this._mult.gain,this.factor.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(me.getDefaults(),{value:0})}dispose(){return super.dispose(),this._mult.dispose(),this}}class Li extends Xe{constructor(){super(k(Li.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="AMOscillator",this._modulationScale=new fT({context:this.context}),this._modulationNode=new de({context:this.context});const e=k(Li.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new ke({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase,type:e.type}),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this._modulator=new ke({context:this.context,phase:e.phase,type:e.modulationType}),this.harmonicity=new Us({context:this.context,units:"positive",value:e.harmonicity}),this.frequency.chain(this.harmonicity,this._modulator.frequency),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),ge(this,["frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(ke.getDefaults(),{harmonicity:1,modulationType:"square"})}_start(e){this._modulator.start(e),this._carrier.start(e)}_stop(e){this._modulator.stop(e),this._carrier.stop(e)}_restart(e){this._modulator.restart(e),this._carrier.restart(e)}get type(){return this._carrier.type}set type(e){this._carrier.type=e}get baseType(){return this._carrier.baseType}set baseType(e){this._carrier.baseType=e}get partialCount(){return this._carrier.partialCount}set partialCount(e){this._carrier.partialCount=e}get modulationType(){return this._modulator.type}set modulationType(e){this._modulator.type=e}get phase(){return this._carrier.phase}set phase(e){this._carrier.phase=e,this._modulator.phase=e}get partials(){return this._carrier.partials}set partials(e){this._carrier.partials=e}asArray(e=1024){return Pe(this,void 0,void 0,function*(){return pn(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this._modulationScale.dispose(),this}}class Bi extends Xe{constructor(){super(k(Bi.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="FMOscillator",this._modulationNode=new de({context:this.context,gain:0});const e=k(Bi.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new ke({context:this.context,detune:e.detune,frequency:0,onstop:()=>this.onstop(this),phase:e.phase,type:e.type}),this.detune=this._carrier.detune,this.frequency=new me({context:this.context,units:"frequency",value:e.frequency}),this._modulator=new ke({context:this.context,phase:e.phase,type:e.modulationType}),this.harmonicity=new Us({context:this.context,units:"positive",value:e.harmonicity}),this.modulationIndex=new Us({context:this.context,units:"positive",value:e.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),ge(this,["modulationIndex","frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(ke.getDefaults(),{harmonicity:1,modulationIndex:2,modulationType:"square"})}_start(e){this._modulator.start(e),this._carrier.start(e)}_stop(e){this._modulator.stop(e),this._carrier.stop(e)}_restart(e){return this._modulator.restart(e),this._carrier.restart(e),this}get type(){return this._carrier.type}set type(e){this._carrier.type=e}get baseType(){return this._carrier.baseType}set baseType(e){this._carrier.baseType=e}get partialCount(){return this._carrier.partialCount}set partialCount(e){this._carrier.partialCount=e}get modulationType(){return this._modulator.type}set modulationType(e){this._modulator.type=e}get phase(){return this._carrier.phase}set phase(e){this._carrier.phase=e,this._modulator.phase=e}get partials(){return this._carrier.partials}set partials(e){this._carrier.partials=e}asArray(e=1024){return Pe(this,void 0,void 0,function*(){return pn(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this.modulationIndex.dispose(),this}}class Yn extends Xe{constructor(){super(k(Yn.getDefaults(),arguments,["frequency","width"])),this.name="PulseOscillator",this._widthGate=new de({context:this.context,gain:0}),this._thresh=new cn({context:this.context,mapping:t=>t<=0?-1:1});const e=k(Yn.getDefaults(),arguments,["frequency","width"]);this.width=new me({context:this.context,units:"audioRange",value:e.width}),this._triangle=new ke({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase,type:"triangle"}),this.frequency=this._triangle.frequency,this.detune=this._triangle.detune,this._triangle.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),ge(this,["width","frequency","detune"])}static getDefaults(){return Object.assign(Xe.getDefaults(),{detune:0,frequency:440,phase:0,type:"pulse",width:.2})}_start(e){e=this.toSeconds(e),this._triangle.start(e),this._widthGate.gain.setValueAtTime(1,e)}_stop(e){e=this.toSeconds(e),this._triangle.stop(e),this._widthGate.gain.cancelScheduledValues(e),this._widthGate.gain.setValueAtTime(0,e)}_restart(e){this._triangle.restart(e),this._widthGate.gain.cancelScheduledValues(e),this._widthGate.gain.setValueAtTime(1,e)}get phase(){return this._triangle.phase}set phase(e){this._triangle.phase=e}get type(){return"pulse"}get baseType(){return"pulse"}get partials(){return[]}get partialCount(){return 0}set carrierType(e){this._triangle.type=e}asArray(e=1024){return Pe(this,void 0,void 0,function*(){return pn(this,e)})}dispose(){return super.dispose(),this._triangle.dispose(),this.width.dispose(),this._widthGate.dispose(),this._thresh.dispose(),this}}class zi extends Xe{constructor(){super(k(zi.getDefaults(),arguments,["frequency","type","spread"])),this.name="FatOscillator",this._oscillators=[];const e=k(zi.getDefaults(),arguments,["frequency","type","spread"]);this.frequency=new me({context:this.context,units:"frequency",value:e.frequency}),this.detune=new me({context:this.context,units:"cents",value:e.detune}),this._spread=e.spread,this._type=e.type,this._phase=e.phase,this._partials=e.partials,this._partialCount=e.partialCount,this.count=e.count,ge(this,["frequency","detune"])}static getDefaults(){return Object.assign(ke.getDefaults(),{count:3,spread:20,type:"sawtooth"})}_start(e){e=this.toSeconds(e),this._forEach(t=>t.start(e))}_stop(e){e=this.toSeconds(e),this._forEach(t=>t.stop(e))}_restart(e){this._forEach(t=>t.restart(e))}_forEach(e){for(let t=0;t<this._oscillators.length;t++)e(this._oscillators[t],t)}get type(){return this._type}set type(e){this._type=e,this._forEach(t=>t.type=e)}get spread(){return this._spread}set spread(e){if(this._spread=e,this._oscillators.length>1){const t=-e/2,s=e/(this._oscillators.length-1);this._forEach((i,r)=>i.detune.value=t+s*r)}}get count(){return this._oscillators.length}set count(e){if(It(e,1),this._oscillators.length!==e){this._forEach(t=>t.dispose()),this._oscillators=[];for(let t=0;t<e;t++){const s=new ke({context:this.context,volume:-6-e*1.1,type:this._type,phase:this._phase+t/e*360,partialCount:this._partialCount,onstop:t===0?()=>this.onstop(this):oe});this.type==="custom"&&(s.partials=this._partials),this.frequency.connect(s.frequency),this.detune.connect(s.detune),s.detune.overridden=!1,s.connect(this.output),this._oscillators[t]=s}this.spread=this._spread,this.state==="started"&&this._forEach(t=>t.start())}}get phase(){return this._phase}set phase(e){this._phase=e,this._forEach((t,s)=>t.phase=this._phase+s/this.count*360)}get baseType(){return this._oscillators[0].baseType}set baseType(e){this._forEach(t=>t.baseType=e),this._type=this._oscillators[0].type}get partials(){return this._oscillators[0].partials}set partials(e){this._partials=e,this._partialCount=this._partials.length,e.length&&(this._type="custom",this._forEach(t=>t.partials=e))}get partialCount(){return this._oscillators[0].partialCount}set partialCount(e){this._partialCount=e,this._forEach(t=>t.partialCount=e),this._type=this._oscillators[0].type}asArray(e=1024){return Pe(this,void 0,void 0,function*(){return pn(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this._forEach(e=>e.dispose()),this}}class Vi extends Xe{constructor(){super(k(Vi.getDefaults(),arguments,["frequency","modulationFrequency"])),this.name="PWMOscillator",this.sourceType="pwm",this._scale=new Us({context:this.context,value:2});const e=k(Vi.getDefaults(),arguments,["frequency","modulationFrequency"]);this._pulse=new Yn({context:this.context,frequency:e.modulationFrequency}),this._pulse.carrierType="sine",this.modulationFrequency=this._pulse.frequency,this._modulator=new ke({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase}),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),ge(this,["modulationFrequency","frequency","detune"])}static getDefaults(){return Object.assign(Xe.getDefaults(),{detune:0,frequency:440,modulationFrequency:.4,phase:0,type:"pwm"})}_start(e){e=this.toSeconds(e),this._modulator.start(e),this._pulse.start(e)}_stop(e){e=this.toSeconds(e),this._modulator.stop(e),this._pulse.stop(e)}_restart(e){this._modulator.restart(e),this._pulse.restart(e)}get type(){return"pwm"}get baseType(){return"pwm"}get partials(){return[]}get partialCount(){return 0}get phase(){return this._modulator.phase}set phase(e){this._modulator.phase=e}asArray(e=1024){return Pe(this,void 0,void 0,function*(){return pn(this,e)})}dispose(){return super.dispose(),this._pulse.dispose(),this._scale.dispose(),this._modulator.dispose(),this}}const xl={am:Li,fat:zi,fm:Bi,oscillator:ke,pulse:Yn,pwm:Vi};class ln extends Xe{constructor(){super(k(ln.getDefaults(),arguments,["frequency","type"])),this.name="OmniOscillator";const e=k(ln.getDefaults(),arguments,["frequency","type"]);this.frequency=new me({context:this.context,units:"frequency",value:e.frequency}),this.detune=new me({context:this.context,units:"cents",value:e.detune}),ge(this,["frequency","detune"]),this.set(e)}static getDefaults(){return Object.assign(ke.getDefaults(),Bi.getDefaults(),Li.getDefaults(),zi.getDefaults(),Yn.getDefaults(),Vi.getDefaults())}_start(e){this._oscillator.start(e)}_stop(e){this._oscillator.stop(e)}_restart(e){return this._oscillator.restart(e),this}get type(){let e="";return["am","fm","fat"].some(t=>this._sourceType===t)&&(e=this._sourceType),e+this._oscillator.type}set type(e){e.substr(0,2)==="fm"?(this._createNewOscillator("fm"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(2)):e.substr(0,2)==="am"?(this._createNewOscillator("am"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(2)):e.substr(0,3)==="fat"?(this._createNewOscillator("fat"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(3)):e==="pwm"?(this._createNewOscillator("pwm"),this._oscillator=this._oscillator):e==="pulse"?this._createNewOscillator("pulse"):(this._createNewOscillator("oscillator"),this._oscillator=this._oscillator,this._oscillator.type=e)}get partials(){return this._oscillator.partials}set partials(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&(this._oscillator.partials=e)}get partialCount(){return this._oscillator.partialCount}set partialCount(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&(this._oscillator.partialCount=e)}set(e){return Reflect.has(e,"type")&&e.type&&(this.type=e.type),super.set(e),this}_createNewOscillator(e){if(e!==this._sourceType){this._sourceType=e;const t=xl[e],s=this.now();if(this._oscillator){const i=this._oscillator;i.stop(s),this.context.setTimeout(()=>i.dispose(),this.blockTime)}this._oscillator=new t({context:this.context}),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this._oscillator.onstop=()=>this.onstop(this),this.state==="started"&&this._oscillator.start(s)}}get phase(){return this._oscillator.phase}set phase(e){this._oscillator.phase=e}get sourceType(){return this._sourceType}set sourceType(e){let t="sine";this._oscillator.type!=="pwm"&&this._oscillator.type!=="pulse"&&(t=this._oscillator.type),e==="fm"?this.type="fm"+t:e==="am"?this.type="am"+t:e==="fat"?this.type="fat"+t:e==="oscillator"?this.type=t:e==="pulse"?this.type="pulse":e==="pwm"&&(this.type="pwm")}_getOscType(e,t){return e instanceof xl[t]}get baseType(){return this._oscillator.baseType}set baseType(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&e!=="pulse"&&e!=="pwm"&&(this._oscillator.baseType=e)}get width(){if(this._getOscType(this._oscillator,"pulse"))return this._oscillator.width}get count(){if(this._getOscType(this._oscillator,"fat"))return this._oscillator.count}set count(e){this._getOscType(this._oscillator,"fat")&&Ps(e)&&(this._oscillator.count=e)}get spread(){if(this._getOscType(this._oscillator,"fat"))return this._oscillator.spread}set spread(e){this._getOscType(this._oscillator,"fat")&&Ps(e)&&(this._oscillator.spread=e)}get modulationType(){if(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))return this._oscillator.modulationType}set modulationType(e){(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))&&us(e)&&(this._oscillator.modulationType=e)}get modulationIndex(){if(this._getOscType(this._oscillator,"fm"))return this._oscillator.modulationIndex}get harmonicity(){if(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))return this._oscillator.harmonicity}get modulationFrequency(){if(this._getOscType(this._oscillator,"pwm"))return this._oscillator.modulationFrequency}asArray(e=1024){return Pe(this,void 0,void 0,function*(){return pn(this,e)})}dispose(){return super.dispose(),this.detune.dispose(),this.frequency.dispose(),this._oscillator.dispose(),this}}class gc extends me{constructor(){super(Object.assign(k(gc.getDefaults(),arguments,["value"]))),this.override=!1,this.name="Add",this._sum=new de({context:this.context}),this.input=this._sum,this.output=this._sum,this.addend=this._param,Pi(this._constantSource,this._sum)}static getDefaults(){return Object.assign(me.getDefaults(),{value:0})}dispose(){return super.dispose(),this._sum.dispose(),this}}class Qr extends hs{constructor(){super(Object.assign(k(Qr.getDefaults(),arguments,["min","max"]))),this.name="Scale";const e=k(Qr.getDefaults(),arguments,["min","max"]);this._mult=this.input=new Us({context:this.context,value:e.max-e.min}),this._add=this.output=new gc({context:this.context,value:e.min}),this._min=e.min,this._max=e.max,this.input.connect(this.output)}static getDefaults(){return Object.assign(hs.getDefaults(),{max:1,min:0})}get min(){return this._min}set min(e){this._min=e,this._setRange()}get max(){return this._max}set max(e){this._max=e,this._setRange()}_setRange(){this._add.value=this._min,this._mult.value=this._max-this._min}dispose(){return super.dispose(),this._add.dispose(),this._mult.dispose(),this}}function Hh(n,e=1/0){const t=new WeakMap;return function(s,i){Reflect.defineProperty(s,i,{configurable:!0,enumerable:!0,get:function(){return t.get(this)},set:function(r){It(r,n,e),t.set(this,r)}})}}function _s(n,e=1/0){const t=new WeakMap;return function(s,i){Reflect.defineProperty(s,i,{configurable:!0,enumerable:!0,get:function(){return t.get(this)},set:function(r){It(this.toSeconds(r),n,e),t.set(this,r)}})}}class Hi extends Xe{constructor(){super(k(Hi.getDefaults(),arguments,["url","onload"])),this.name="Player",this._activeSources=new Set;const e=k(Hi.getDefaults(),arguments,["url","onload"]);this._buffer=new ae({onload:this._onload.bind(this,e.onload),onerror:e.onerror,reverse:e.reverse,url:e.url}),this.autostart=e.autostart,this._loop=e.loop,this._loopStart=e.loopStart,this._loopEnd=e.loopEnd,this._playbackRate=e.playbackRate,this.fadeIn=e.fadeIn,this.fadeOut=e.fadeOut}static getDefaults(){return Object.assign(Xe.getDefaults(),{autostart:!1,fadeIn:0,fadeOut:0,loop:!1,loopEnd:0,loopStart:0,onload:oe,onerror:oe,playbackRate:1,reverse:!1})}load(e){return Pe(this,void 0,void 0,function*(){return yield this._buffer.load(e),this._onload(),this})}_onload(e=oe){e(),this.autostart&&this.start()}_onSourceEnd(e){this.onstop(this),this._activeSources.delete(e),this._activeSources.size===0&&!this._synced&&this._state.getValueAtTime(this.now())==="started"&&(this._state.cancel(this.now()),this._state.setStateAtTime("stopped",this.now()))}start(e,t,s){return super.start(e,t,s),this}_start(e,t,s){this._loop?t=Nn(t,this._loopStart):t=Nn(t,0);const i=this.toSeconds(t),r=s;s=Nn(s,Math.max(this._buffer.duration-i,0));let o=this.toSeconds(s);o=o/this._playbackRate,e=this.toSeconds(e);const a=new jn({url:this._buffer,context:this.context,fadeIn:this.fadeIn,fadeOut:this.fadeOut,loop:this._loop,loopEnd:this._loopEnd,loopStart:this._loopStart,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate}).connect(this.output);!this._loop&&!this._synced&&(this._state.cancel(e+o),this._state.setStateAtTime("stopped",e+o,{implicitEnd:!0})),this._activeSources.add(a),this._loop&&mt(r)?a.start(e,i):a.start(e,i,o-this.toSeconds(this.fadeOut))}_stop(e){const t=this.toSeconds(e);this._activeSources.forEach(s=>s.stop(t))}restart(e,t,s){return super.restart(e,t,s),this}_restart(e,t,s){var i;(i=[...this._activeSources].pop())===null||i===void 0||i.stop(e),this._start(e,t,s)}seek(e,t){const s=this.toSeconds(t);if(this._state.getValueAtTime(s)==="started"){const i=this.toSeconds(e);this._stop(s),this._start(s,i)}return this}setLoopPoints(e,t){return this.loopStart=e,this.loopEnd=t,this}get loopStart(){return this._loopStart}set loopStart(e){this._loopStart=e,this.buffer.loaded&&It(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach(t=>{t.loopStart=e})}get loopEnd(){return this._loopEnd}set loopEnd(e){this._loopEnd=e,this.buffer.loaded&&It(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach(t=>{t.loopEnd=e})}get buffer(){return this._buffer}set buffer(e){this._buffer.set(e)}get loop(){return this._loop}set loop(e){if(this._loop!==e&&(this._loop=e,this._activeSources.forEach(t=>{t.loop=e}),e)){const t=this._state.getNextState("stopped",this.now());t&&this._state.cancel(t.time)}}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e;const t=this.now(),s=this._state.getNextState("stopped",t);s&&s.implicitEnd&&(this._state.cancel(s.time),this._activeSources.forEach(i=>i.cancelStop())),this._activeSources.forEach(i=>{i.playbackRate.setValueAtTime(e,t)})}get reverse(){return this._buffer.reverse}set reverse(e){this._buffer.reverse=e}get loaded(){return this._buffer.loaded}dispose(){return super.dispose(),this._activeSources.forEach(e=>e.dispose()),this._activeSources.clear(),this._buffer.dispose(),this}}Ft([_s(0)],Hi.prototype,"fadeIn",void 0);Ft([_s(0)],Hi.prototype,"fadeOut",void 0);class pT extends hs{constructor(){super(...arguments),this.name="GainToAudio",this._norm=new cn({context:this.context,mapping:e=>Math.abs(e)*2-1}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class Ot extends W{constructor(){super(k(Ot.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="Envelope",this._sig=new me({context:this.context,value:0}),this.output=this._sig,this.input=void 0;const e=k(Ot.getDefaults(),arguments,["attack","decay","sustain","release"]);this.attack=e.attack,this.decay=e.decay,this.sustain=e.sustain,this.release=e.release,this.attackCurve=e.attackCurve,this.releaseCurve=e.releaseCurve,this.decayCurve=e.decayCurve}static getDefaults(){return Object.assign(W.getDefaults(),{attack:.01,attackCurve:"linear",decay:.1,decayCurve:"exponential",release:1,releaseCurve:"exponential",sustain:.5})}get value(){return this.getValueAtTime(this.now())}_getCurve(e,t){if(us(e))return e;{let s;for(s in wr)if(wr[s][t]===e)return s;return e}}_setCurve(e,t,s){if(us(s)&&Reflect.has(wr,s)){const i=wr[s];tn(i)?e!=="_decayCurve"&&(this[e]=i[t]):this[e]=i}else if(Pt(s)&&e!=="_decayCurve")this[e]=s;else throw new Error("Envelope: invalid curve: "+s)}get attackCurve(){return this._getCurve(this._attackCurve,"In")}set attackCurve(e){this._setCurve("_attackCurve","In",e)}get releaseCurve(){return this._getCurve(this._releaseCurve,"Out")}set releaseCurve(e){this._setCurve("_releaseCurve","Out",e)}get decayCurve(){return this._getCurve(this._decayCurve,"Out")}set decayCurve(e){this._setCurve("_decayCurve","Out",e)}triggerAttack(e,t=1){this.log("triggerAttack",e,t),e=this.toSeconds(e);let i=this.toSeconds(this.attack);const r=this.toSeconds(this.decay),o=this.getValueAtTime(e);if(o>0){const a=1/i;i=(1-o)/a}if(i<this.sampleTime)this._sig.cancelScheduledValues(e),this._sig.setValueAtTime(t,e);else if(this._attackCurve==="linear")this._sig.linearRampTo(t,i,e);else if(this._attackCurve==="exponential")this._sig.targetRampTo(t,i,e);else{this._sig.cancelAndHoldAtTime(e);let a=this._attackCurve;for(let c=1;c<a.length;c++)if(a[c-1]<=o&&o<=a[c]){a=this._attackCurve.slice(c),a[0]=o;break}this._sig.setValueCurveAtTime(a,e,i,t)}if(r&&this.sustain<1){const a=t*this.sustain,c=e+i;this.log("decay",c),this._decayCurve==="linear"?this._sig.linearRampToValueAtTime(a,r+c):this._sig.exponentialApproachValueAtTime(a,c,r)}return this}triggerRelease(e){this.log("triggerRelease",e),e=this.toSeconds(e);const t=this.getValueAtTime(e);if(t>0){const s=this.toSeconds(this.release);s<this.sampleTime?this._sig.setValueAtTime(0,e):this._releaseCurve==="linear"?this._sig.linearRampTo(0,s,e):this._releaseCurve==="exponential"?this._sig.targetRampTo(0,s,e):($(Pt(this._releaseCurve),"releaseCurve must be either 'linear', 'exponential' or an array"),this._sig.cancelAndHoldAtTime(e),this._sig.setValueCurveAtTime(this._releaseCurve,e,s,t))}return this}getValueAtTime(e){return this._sig.getValueAtTime(e)}triggerAttackRelease(e,t,s=1){return t=this.toSeconds(t),this.triggerAttack(t,s),this.triggerRelease(t+this.toSeconds(e)),this}cancel(e){return this._sig.cancelScheduledValues(this.toSeconds(e)),this}connect(e,t=0,s=0){return pc(this,e,t,s),this}asArray(e=1024){return Pe(this,void 0,void 0,function*(){const t=e/this.context.sampleRate,s=new vo(1,t,this.context.sampleRate),i=this.toSeconds(this.attack)+this.toSeconds(this.decay),r=i+this.toSeconds(this.release),o=r*.1,a=r+o,c=new this.constructor(Object.assign(this.get(),{attack:t*this.toSeconds(this.attack)/a,decay:t*this.toSeconds(this.decay)/a,release:t*this.toSeconds(this.release)/a,context:s}));return c._sig.toDestination(),c.triggerAttackRelease(t*(i+o)/a,0),(yield s.render()).getChannelData(0)})}dispose(){return super.dispose(),this._sig.dispose(),this}}Ft([_s(0)],Ot.prototype,"attack",void 0);Ft([_s(0)],Ot.prototype,"decay",void 0);Ft([Hh(0,1)],Ot.prototype,"sustain",void 0);Ft([_s(0)],Ot.prototype,"release",void 0);const wr=(()=>{let e,t;const s=[];for(e=0;e<128;e++)s[e]=Math.sin(e/(128-1)*(Math.PI/2));const i=[],r=6.4;for(e=0;e<128-1;e++){t=e/(128-1);const d=Math.sin(t*(Math.PI*2)*r-Math.PI/2)+1;i[e]=d/10+t*.83}i[128-1]=1;const o=[],a=5;for(e=0;e<128;e++)o[e]=Math.ceil(e/(128-1)*a)/a;const c=[];for(e=0;e<128;e++)t=e/(128-1),c[e]=.5*(1-Math.cos(Math.PI*t));const l=[];for(e=0;e<128;e++){t=e/(128-1);const d=Math.pow(t,3)*4+.2,f=Math.cos(d*Math.PI*2*t);l[e]=Math.abs(f*(1-t))}function u(d){const f=new Array(d.length);for(let m=0;m<d.length;m++)f[m]=1-d[m];return f}function h(d){return d.slice(0).reverse()}return{bounce:{In:u(l),Out:l},cosine:{In:s,Out:h(s)},exponential:"exponential",linear:"linear",ripple:{In:i,Out:u(i)},sine:{In:c,Out:u(c)},step:{In:o,Out:u(o)}}})();class un extends W{constructor(){super(k(un.getDefaults(),arguments)),this._scheduledEvents=[],this._synced=!1,this._original_triggerAttack=this.triggerAttack,this._original_triggerRelease=this.triggerRelease,this._syncedRelease=t=>this._original_triggerRelease(t);const e=k(un.getDefaults(),arguments);this._volume=this.output=new Is({context:this.context,volume:e.volume}),this.volume=this._volume.volume,ge(this,"volume")}static getDefaults(){return Object.assign(W.getDefaults(),{volume:0})}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0),this.context.transport.on("stop",this._syncedRelease),this.context.transport.on("pause",this._syncedRelease),this.context.transport.on("loopEnd",this._syncedRelease)),this}_syncState(){let e=!1;return this._synced||(this._synced=!0,e=!0),e}_syncMethod(e,t){const s=this["_original_"+e]=this[e];this[e]=(...i)=>{const r=i[t],o=this.context.transport.schedule(a=>{i[t]=a,s.apply(this,i)},r);this._scheduledEvents.push(o)}}unsync(){return this._scheduledEvents.forEach(e=>this.context.transport.clear(e)),this._scheduledEvents=[],this._synced&&(this._synced=!1,this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease,this.context.transport.off("stop",this._syncedRelease),this.context.transport.off("pause",this._syncedRelease),this.context.transport.off("loopEnd",this._syncedRelease)),this}triggerAttackRelease(e,t,s,i){const r=this.toSeconds(s),o=this.toSeconds(t);return this.triggerAttack(e,r,i),this.triggerRelease(r+o),this}dispose(){return super.dispose(),this._volume.dispose(),this.unsync(),this._scheduledEvents=[],this}}class ds extends un{constructor(){super(k(ds.getDefaults(),arguments));const e=k(ds.getDefaults(),arguments);this.portamento=e.portamento,this.onsilence=e.onsilence}static getDefaults(){return Object.assign(un.getDefaults(),{detune:0,onsilence:oe,portamento:0})}triggerAttack(e,t,s=1){this.log("triggerAttack",e,t,s);const i=this.toSeconds(t);return this._triggerEnvelopeAttack(i,s),this.setNote(e,i),this}triggerRelease(e){this.log("triggerRelease",e);const t=this.toSeconds(e);return this._triggerEnvelopeRelease(t),this}setNote(e,t){const s=this.toSeconds(t),i=e instanceof bt?e.toFrequency():e;if(this.portamento>0&&this.getLevelAtTime(s)>.05){const r=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(i,r,s)}else this.frequency.setValueAtTime(i,s);return this}}Ft([_s(0)],ds.prototype,"portamento",void 0);class To extends Ot{constructor(){super(k(To.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="AmplitudeEnvelope",this._gainNode=new de({context:this.context,gain:0}),this.output=this._gainNode,this.input=this._gainNode,this._sig.connect(this._gainNode.gain),this.output=this._gainNode,this.input=this._gainNode}dispose(){return super.dispose(),this._gainNode.dispose(),this}}class qi extends ds{constructor(){super(k(qi.getDefaults(),arguments)),this.name="Synth";const e=k(qi.getDefaults(),arguments);this.oscillator=new ln(Object.assign({context:this.context,detune:e.detune,onstop:()=>this.onsilence(this)},e.oscillator)),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new To(Object.assign({context:this.context},e.envelope)),this.oscillator.chain(this.envelope,this.output),ge(this,["oscillator","frequency","detune","envelope"])}static getDefaults(){return Object.assign(ds.getDefaults(),{envelope:Object.assign(An(Ot.getDefaults(),Object.keys(W.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.3}),oscillator:Object.assign(An(ln.getDefaults(),[...Object.keys(Xe.getDefaults()),"frequency","detune"]),{type:"triangle"})})}_triggerEnvelopeAttack(e,t){if(this.envelope.triggerAttack(e,t),this.oscillator.start(e),this.envelope.sustain===0){const s=this.toSeconds(this.envelope.attack),i=this.toSeconds(this.envelope.decay);this.oscillator.stop(e+s+i)}}_triggerEnvelopeRelease(e){this.envelope.triggerRelease(e),this.oscillator.stop(e+this.toSeconds(this.envelope.release))}getLevelAtTime(e){return e=this.toSeconds(e),this.envelope.getValueAtTime(e)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this}}class Wi extends W{constructor(){super(k(Wi.getDefaults(),arguments,["frequency","type"])),this.name="BiquadFilter";const e=k(Wi.getDefaults(),arguments,["frequency","type"]);this._filter=this.context.createBiquadFilter(),this.input=this.output=this._filter,this.Q=new ce({context:this.context,units:"number",value:e.Q,param:this._filter.Q}),this.frequency=new ce({context:this.context,units:"frequency",value:e.frequency,param:this._filter.frequency}),this.detune=new ce({context:this.context,units:"cents",value:e.detune,param:this._filter.detune}),this.gain=new ce({context:this.context,units:"decibels",convert:!1,value:e.gain,param:this._filter.gain}),this.type=e.type}static getDefaults(){return Object.assign(W.getDefaults(),{Q:1,type:"lowpass",frequency:350,detune:0,gain:0})}get type(){return this._filter.type}set type(e){$(["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(e)!==-1,`Invalid filter type: ${e}`),this._filter.type=e}getFrequencyResponse(e=128){const t=new Float32Array(e);for(let o=0;o<e;o++){const c=Math.pow(o/e,2)*(2e4-20)+20;t[o]=c}const s=new Float32Array(e),i=new Float32Array(e),r=this.context.createBiquadFilter();return r.type=this.type,r.Q.value=this.Q.value,r.frequency.value=this.frequency.value,r.gain.value=this.gain.value,r.getFrequencyResponse(t,s,i),s}dispose(){return super.dispose(),this._filter.disconnect(),this.Q.dispose(),this.frequency.dispose(),this.gain.dispose(),this.detune.dispose(),this}}class Zn extends W{constructor(){super(k(Zn.getDefaults(),arguments,["frequency","type","rolloff"])),this.name="Filter",this.input=new de({context:this.context}),this.output=new de({context:this.context}),this._filters=[];const e=k(Zn.getDefaults(),arguments,["frequency","type","rolloff"]);this._filters=[],this.Q=new me({context:this.context,units:"positive",value:e.Q}),this.frequency=new me({context:this.context,units:"frequency",value:e.frequency}),this.detune=new me({context:this.context,units:"cents",value:e.detune}),this.gain=new me({context:this.context,units:"decibels",convert:!1,value:e.gain}),this._type=e.type,this.rolloff=e.rolloff,ge(this,["detune","frequency","gain","Q"])}static getDefaults(){return Object.assign(W.getDefaults(),{Q:1,detune:0,frequency:350,gain:0,rolloff:-12,type:"lowpass"})}get type(){return this._type}set type(e){$(["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(e)!==-1,`Invalid filter type: ${e}`),this._type=e,this._filters.forEach(s=>s.type=e)}get rolloff(){return this._rolloff}set rolloff(e){const t=Ps(e)?e:parseInt(e,10),s=[-12,-24,-48,-96];let i=s.indexOf(t);$(i!==-1,`rolloff can only be ${s.join(", ")}`),i+=1,this._rolloff=t,this.input.disconnect(),this._filters.forEach(r=>r.disconnect()),this._filters=new Array(i);for(let r=0;r<i;r++){const o=new Wi({context:this.context});o.type=this._type,this.frequency.connect(o.frequency),this.detune.connect(o.detune),this.Q.connect(o.Q),this.gain.connect(o.gain),this._filters[r]=o}this._internalChannels=this._filters,Pi(this.input,...this._internalChannels,this.output)}getFrequencyResponse(e=128){const t=new Wi({frequency:this.frequency.value,gain:this.gain.value,Q:this.Q.value,type:this._type,detune:this.detune.value}),s=new Float32Array(e).map(()=>1);return this._filters.forEach(()=>{t.getFrequencyResponse(e).forEach((r,o)=>s[o]*=r)}),t.dispose(),s}dispose(){return super.dispose(),this._filters.forEach(e=>{e.dispose()}),hc(this,["detune","frequency","gain","Q"]),this.frequency.dispose(),this.Q.dispose(),this.detune.dispose(),this.gain.dispose(),this}}class Gi extends Ot{constructor(){super(k(Gi.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="FrequencyEnvelope";const e=k(Gi.getDefaults(),arguments,["attack","decay","sustain","release"]);this._octaves=e.octaves,this._baseFrequency=this.toFrequency(e.baseFrequency),this._exponent=this.input=new Ii({context:this.context,value:e.exponent}),this._scale=this.output=new Qr({context:this.context,min:this._baseFrequency,max:this._baseFrequency*Math.pow(2,this._octaves)}),this._sig.chain(this._exponent,this._scale)}static getDefaults(){return Object.assign(Ot.getDefaults(),{baseFrequency:200,exponent:1,octaves:4})}get baseFrequency(){return this._baseFrequency}set baseFrequency(e){const t=this.toFrequency(e);It(t,0),this._baseFrequency=t,this._scale.min=this._baseFrequency,this.octaves=this._octaves}get octaves(){return this._octaves}set octaves(e){this._octaves=e,this._scale.max=this._baseFrequency*Math.pow(2,e)}get exponent(){return this._exponent.value}set exponent(e){this._exponent.value=e}dispose(){return super.dispose(),this._exponent.dispose(),this._scale.dispose(),this}}class ji extends ds{constructor(){super(k(ji.getDefaults(),arguments)),this.name="MonoSynth";const e=k(ji.getDefaults(),arguments);this.oscillator=new ln(Object.assign(e.oscillator,{context:this.context,detune:e.detune,onstop:()=>this.onsilence(this)})),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.filter=new Zn(Object.assign(e.filter,{context:this.context})),this.filterEnvelope=new Gi(Object.assign(e.filterEnvelope,{context:this.context})),this.envelope=new To(Object.assign(e.envelope,{context:this.context})),this.oscillator.chain(this.filter,this.envelope,this.output),this.filterEnvelope.connect(this.filter.frequency),ge(this,["oscillator","frequency","detune","filter","filterEnvelope","envelope"])}static getDefaults(){return Object.assign(ds.getDefaults(),{envelope:Object.assign(An(Ot.getDefaults(),Object.keys(W.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.9}),filter:Object.assign(An(Zn.getDefaults(),Object.keys(W.getDefaults())),{Q:1,rolloff:-12,type:"lowpass"}),filterEnvelope:Object.assign(An(Gi.getDefaults(),Object.keys(W.getDefaults())),{attack:.6,baseFrequency:200,decay:.2,exponent:2,octaves:3,release:2,sustain:.5}),oscillator:Object.assign(An(ln.getDefaults(),Object.keys(Xe.getDefaults())),{type:"sawtooth"})})}_triggerEnvelopeAttack(e,t=1){if(this.envelope.triggerAttack(e,t),this.filterEnvelope.triggerAttack(e),this.oscillator.start(e),this.envelope.sustain===0){const s=this.toSeconds(this.envelope.attack),i=this.toSeconds(this.envelope.decay);this.oscillator.stop(e+s+i)}}_triggerEnvelopeRelease(e){this.envelope.triggerRelease(e),this.filterEnvelope.triggerRelease(e),this.oscillator.stop(e+this.toSeconds(this.envelope.release))}getLevelAtTime(e){return e=this.toSeconds(e),this.envelope.getValueAtTime(e)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this.filterEnvelope.dispose(),this.filter.dispose(),this}}class Yi extends qi{constructor(){super(k(Yi.getDefaults(),arguments)),this.name="MembraneSynth",this.portamento=0;const e=k(Yi.getDefaults(),arguments);this.pitchDecay=e.pitchDecay,this.octaves=e.octaves,ge(this,["oscillator","envelope"])}static getDefaults(){return Pn(ds.getDefaults(),qi.getDefaults(),{envelope:{attack:.001,attackCurve:"exponential",decay:.4,release:1.4,sustain:.01},octaves:10,oscillator:{type:"sine"},pitchDecay:.05})}setNote(e,t){const s=this.toSeconds(t),i=this.toFrequency(e instanceof bt?e.toFrequency():e),r=i*this.octaves;return this.oscillator.frequency.setValueAtTime(r,s),this.oscillator.frequency.exponentialRampToValueAtTime(i,s+this.toSeconds(this.pitchDecay)),this}dispose(){return super.dispose(),this}}Ft([Hh(0)],Yi.prototype,"octaves",void 0);Ft([_s(0)],Yi.prototype,"pitchDecay",void 0);const qh=new Set;function vc(n){qh.add(n)}function Wh(n,e){const t=`registerProcessor("${n}", ${e})`;qh.add(t)}const mT=`
	/**
	 * The base AudioWorkletProcessor for use in Tone.js. Works with the [[ToneAudioWorklet]]. 
	 */
	class ToneAudioWorkletProcessor extends AudioWorkletProcessor {

		constructor(options) {
			
			super(options);
			/**
			 * If the processor was disposed or not. Keep alive until it's disposed.
			 */
			this.disposed = false;
		   	/** 
			 * The number of samples in the processing block
			 */
			this.blockSize = 128;
			/**
			 * the sample rate
			 */
			this.sampleRate = sampleRate;

			this.port.onmessage = (event) => {
				// when it receives a dispose 
				if (event.data === "dispose") {
					this.disposed = true;
				}
			};
		}
	}
`;vc(mT);const _T=`
	/**
	 * Abstract class for a single input/output processor. 
	 * has a 'generate' function which processes one sample at a time
	 */
	class SingleIOProcessor extends ToneAudioWorkletProcessor {

		constructor(options) {
			super(Object.assign(options, {
				numberOfInputs: 1,
				numberOfOutputs: 1
			}));
			/**
			 * Holds the name of the parameter and a single value of that
			 * parameter at the current sample
			 * @type { [name: string]: number }
			 */
			this.params = {}
		}

		/**
		 * Generate an output sample from the input sample and parameters
		 * @abstract
		 * @param input number
		 * @param channel number
		 * @param parameters { [name: string]: number }
		 * @returns number
		 */
		generate(){}

		/**
		 * Update the private params object with the 
		 * values of the parameters at the given index
		 * @param parameters { [name: string]: Float32Array },
		 * @param index number
		 */
		updateParams(parameters, index) {
			for (const paramName in parameters) {
				const param = parameters[paramName];
				if (param.length > 1) {
					this.params[paramName] = parameters[paramName][index];
				} else {
					this.params[paramName] = parameters[paramName][0];
				}
			}
		}

		/**
		 * Process a single frame of the audio
		 * @param inputs Float32Array[][]
		 * @param outputs Float32Array[][]
		 */
		process(inputs, outputs, parameters) {
			const input = inputs[0];
			const output = outputs[0];
			// get the parameter values
			const channelCount = Math.max(input && input.length || 0, output.length);
			for (let sample = 0; sample < this.blockSize; sample++) {
				this.updateParams(parameters, sample);
				for (let channel = 0; channel < channelCount; channel++) {
					const inputSample = input && input.length ? input[channel][sample] : 0;
					output[channel][sample] = this.generate(inputSample, channel, this.params);
				}
			}
			return !this.disposed;
		}
	};
`;vc(_T);const gT=`
	/**
	 * A multichannel buffer for use within an AudioWorkletProcessor as a delay line
	 */
	class DelayLine {
		
		constructor(size, channels) {
			this.buffer = [];
			this.writeHead = []
			this.size = size;

			// create the empty channels
			for (let i = 0; i < channels; i++) {
				this.buffer[i] = new Float32Array(this.size);
				this.writeHead[i] = 0;
			}
		}

		/**
		 * Push a value onto the end
		 * @param channel number
		 * @param value number
		 */
		push(channel, value) {
			this.writeHead[channel] += 1;
			if (this.writeHead[channel] > this.size) {
				this.writeHead[channel] = 0;
			}
			this.buffer[channel][this.writeHead[channel]] = value;
		}

		/**
		 * Get the recorded value of the channel given the delay
		 * @param channel number
		 * @param delay number delay samples
		 */
		get(channel, delay) {
			let readHead = this.writeHead[channel] - Math.floor(delay);
			if (readHead < 0) {
				readHead += this.size;
			}
			return this.buffer[channel][readHead];
		}
	}
`;vc(gT);const vT="feedback-comb-filter",yT=`
	class FeedbackCombFilterWorklet extends SingleIOProcessor {

		constructor(options) {
			super(options);
			this.delayLine = new DelayLine(this.sampleRate, options.channelCount || 2);
		}

		static get parameterDescriptors() {
			return [{
				name: "delayTime",
				defaultValue: 0.1,
				minValue: 0,
				maxValue: 1,
				automationRate: "k-rate"
			}, {
				name: "feedback",
				defaultValue: 0.5,
				minValue: 0,
				maxValue: 0.9999,
				automationRate: "k-rate"
			}];
		}

		generate(input, channel, parameters) {
			const delayedSample = this.delayLine.get(channel, parameters.delayTime * this.sampleRate);
			this.delayLine.push(channel, input + delayedSample * parameters.feedback);
			return delayedSample;
		}
	}
`;Wh(vT,yT);class Zi extends un{constructor(){super(k(Zi.getDefaults(),arguments,["urls","onload","baseUrl"],"urls")),this.name="Sampler",this._activeSources=new Map;const e=k(Zi.getDefaults(),arguments,["urls","onload","baseUrl"],"urls"),t={};Object.keys(e.urls).forEach(s=>{const i=parseInt(s,10);if($(xr(s)||Ps(i)&&isFinite(i),`url key is neither a note or midi pitch: ${s}`),xr(s)){const r=new bt(this.context,s).toMidi();t[r]=e.urls[s]}else Ps(i)&&isFinite(i)&&(t[i]=e.urls[i])}),this._buffers=new mc({urls:t,onload:e.onload,baseUrl:e.baseUrl,onerror:e.onerror}),this.attack=e.attack,this.release=e.release,this.curve=e.curve,this._buffers.loaded&&Promise.resolve().then(e.onload)}static getDefaults(){return Object.assign(un.getDefaults(),{attack:0,baseUrl:"",curve:"exponential",onload:oe,onerror:oe,release:.1,urls:{}})}_findClosest(e){let s=0;for(;s<96;){if(this._buffers.has(e+s))return-s;if(this._buffers.has(e-s))return s;s++}throw new Error(`No available buffers for note: ${e}`)}triggerAttack(e,t,s=1){return this.log("triggerAttack",e,t,s),Array.isArray(e)||(e=[e]),e.forEach(i=>{const r=Vh(new bt(this.context,i).toFrequency()),o=Math.round(r),a=r-o,c=this._findClosest(o),l=o-c,u=this._buffers.get(l),h=zh(c+a),d=new jn({url:u,context:this.context,curve:this.curve,fadeIn:this.attack,fadeOut:this.release,playbackRate:h}).connect(this.output);d.start(t,0,u.duration/h,s),Pt(this._activeSources.get(o))||this._activeSources.set(o,[]),this._activeSources.get(o).push(d),d.onended=()=>{if(this._activeSources&&this._activeSources.has(o)){const f=this._activeSources.get(o),m=f.indexOf(d);m!==-1&&f.splice(m,1)}}}),this}triggerRelease(e,t){return this.log("triggerRelease",e,t),Array.isArray(e)||(e=[e]),e.forEach(s=>{const i=new bt(this.context,s).toMidi();if(this._activeSources.has(i)&&this._activeSources.get(i).length){const r=this._activeSources.get(i);t=this.toSeconds(t),r.forEach(o=>{o.stop(t)}),this._activeSources.set(i,[])}}),this}releaseAll(e){const t=this.toSeconds(e);return this._activeSources.forEach(s=>{for(;s.length;)s.shift().stop(t)}),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}triggerAttackRelease(e,t,s,i=1){const r=this.toSeconds(s);return this.triggerAttack(e,r,i),Pt(t)?($(Pt(e),"notes must be an array when duration is array"),e.forEach((o,a)=>{const c=t[Math.min(a,t.length-1)];this.triggerRelease(o,r+this.toSeconds(c))})):this.triggerRelease(e,r+this.toSeconds(t)),this}add(e,t,s){if($(xr(e)||isFinite(e),`note must be a pitch or midi: ${e}`),xr(e)){const i=new bt(this.context,e).toMidi();this._buffers.add(i,t,s)}else this._buffers.add(e,t,s);return this}get loaded(){return this._buffers.loaded}dispose(){return super.dispose(),this._buffers.dispose(),this._activeSources.forEach(e=>{e.forEach(t=>t.dispose())}),this._activeSources.clear(),this}}Ft([_s(0)],Zi.prototype,"attack",void 0);Ft([_s(0)],Zi.prototype,"release",void 0);class Kr extends W{constructor(){super(Object.assign(k(Kr.getDefaults(),arguments,["fade"]))),this.name="CrossFade",this._panner=this.context.createStereoPanner(),this._split=this.context.createChannelSplitter(2),this._g2a=new pT({context:this.context}),this.a=new de({context:this.context,gain:0}),this.b=new de({context:this.context,gain:0}),this.output=new de({context:this.context}),this._internalChannels=[this.a,this.b];const e=k(Kr.getDefaults(),arguments,["fade"]);this.fade=new me({context:this.context,units:"normalRange",value:e.fade}),ge(this,"fade"),this.context.getConstant(1).connect(this._panner),this._panner.connect(this._split),this._panner.channelCount=1,this._panner.channelCountMode="explicit",Ns(this._split,this.a.gain,0),Ns(this._split,this.b.gain,1),this.fade.chain(this._g2a,this._panner.pan),this.a.connect(this.output),this.b.connect(this.output)}static getDefaults(){return Object.assign(W.getDefaults(),{fade:.5})}dispose(){return super.dispose(),this.a.dispose(),this.b.dispose(),this.output.dispose(),this.fade.dispose(),this._g2a.dispose(),this._panner.disconnect(),this._split.disconnect(),this}}class wl extends W{constructor(e){super(e),this.name="Effect",this._dryWet=new Kr({context:this.context}),this.wet=this._dryWet.fade,this.effectSend=new de({context:this.context}),this.effectReturn=new de({context:this.context}),this.input=new de({context:this.context}),this.output=this._dryWet,this.input.fan(this._dryWet.a,this.effectSend),this.effectReturn.connect(this._dryWet.b),this.wet.setValueAtTime(e.wet,0),this._internalChannels=[this.effectReturn,this.effectSend],ge(this,"wet")}static getDefaults(){return Object.assign(W.getDefaults(),{wet:1})}connectEffect(e){return this._internalChannels.push(e),this.effectSend.chain(e,this.effectReturn),this}dispose(){return super.dispose(),this._dryWet.dispose(),this.effectSend.dispose(),this.effectReturn.dispose(),this.wet.dispose(),this}}class Jr extends W{constructor(){super(Object.assign(k(Jr.getDefaults(),arguments,["pan"]))),this.name="Panner",this._panner=this.context.createStereoPanner(),this.input=this._panner,this.output=this._panner;const e=k(Jr.getDefaults(),arguments,["pan"]);this.pan=new ce({context:this.context,param:this._panner.pan,value:e.pan,minValue:-1,maxValue:1}),this._panner.channelCount=e.channelCount,this._panner.channelCountMode="explicit",ge(this,"pan")}static getDefaults(){return Object.assign(W.getDefaults(),{pan:0,channelCount:1})}dispose(){return super.dispose(),this._panner.disconnect(),this.pan.dispose(),this}}const TT="bit-crusher",xT=`
	class BitCrusherWorklet extends SingleIOProcessor {

		static get parameterDescriptors() {
			return [{
				name: "bits",
				defaultValue: 12,
				minValue: 1,
				maxValue: 16,
				automationRate: 'k-rate'
			}];
		}

		generate(input, _channel, parameters) {
			const step = Math.pow(0.5, parameters.bits - 1);
			const val = step * Math.floor(input / step + 0.5);
			return val;
		}
	}
`;Wh(TT,xT);class eo extends W{constructor(){super(k(eo.getDefaults(),arguments,["channels"])),this.name="Merge";const e=k(eo.getDefaults(),arguments,["channels"]);this._merger=this.output=this.input=this.context.createChannelMerger(e.channels)}static getDefaults(){return Object.assign(W.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._merger.disconnect(),this}}class to extends wl{constructor(){super(k(to.getDefaults(),arguments,["decay"])),this.name="Reverb",this._convolver=this.context.createConvolver(),this.ready=Promise.resolve();const e=k(to.getDefaults(),arguments,["decay"]);this._decay=e.decay,this._preDelay=e.preDelay,this.generate(),this.connectEffect(this._convolver)}static getDefaults(){return Object.assign(wl.getDefaults(),{decay:1.5,preDelay:.01})}get decay(){return this._decay}set decay(e){e=this.toSeconds(e),It(e,.001),this._decay=e,this.generate()}get preDelay(){return this._preDelay}set preDelay(e){e=this.toSeconds(e),It(e,0),this._preDelay=e,this.generate()}generate(){return Pe(this,void 0,void 0,function*(){const e=this.ready,t=new vo(2,this._decay+this._preDelay,this.context.sampleRate),s=new Ui({context:t}),i=new Ui({context:t}),r=new eo({context:t});s.connect(r,0,0),i.connect(r,0,1);const o=new de({context:t}).toDestination();r.connect(o),s.start(0),i.start(0),o.gain.setValueAtTime(0,0),o.gain.setValueAtTime(1,this._preDelay),o.gain.exponentialApproachValueAtTime(0,this._preDelay,this.decay);const a=t.render();return this.ready=a.then(oe),yield e,this._convolver.buffer=(yield a).get(),this})}dispose(){return super.dispose(),this._convolver.disconnect(),this}}class Me extends W{constructor(){super(k(Me.getDefaults(),arguments,["solo"])),this.name="Solo";const e=k(Me.getDefaults(),arguments,["solo"]);this.input=this.output=new de({context:this.context}),Me._allSolos.has(this.context)||Me._allSolos.set(this.context,new Set),Me._allSolos.get(this.context).add(this),this.solo=e.solo}static getDefaults(){return Object.assign(W.getDefaults(),{solo:!1})}get solo(){return this._isSoloed()}set solo(e){e?this._addSolo():this._removeSolo(),Me._allSolos.get(this.context).forEach(t=>t._updateSolo())}get muted(){return this.input.gain.value===0}_addSolo(){Me._soloed.has(this.context)||Me._soloed.set(this.context,new Set),Me._soloed.get(this.context).add(this)}_removeSolo(){Me._soloed.has(this.context)&&Me._soloed.get(this.context).delete(this)}_isSoloed(){return Me._soloed.has(this.context)&&Me._soloed.get(this.context).has(this)}_noSolos(){return!Me._soloed.has(this.context)||Me._soloed.has(this.context)&&Me._soloed.get(this.context).size===0}_updateSolo(){this._isSoloed()?this.input.gain.value=1:this._noSolos()?this.input.gain.value=1:this.input.gain.value=0}dispose(){return super.dispose(),Me._allSolos.get(this.context).delete(this),this._removeSolo(),this}}Me._allSolos=new Map;Me._soloed=new Map;class so extends W{constructor(){super(k(so.getDefaults(),arguments,["pan","volume"])),this.name="PanVol";const e=k(so.getDefaults(),arguments,["pan","volume"]);this._panner=this.input=new Jr({context:this.context,pan:e.pan,channelCount:e.channelCount}),this.pan=this._panner.pan,this._volume=this.output=new Is({context:this.context,volume:e.volume}),this.volume=this._volume.volume,this._panner.connect(this._volume),this.mute=e.mute,ge(this,["pan","volume"])}static getDefaults(){return Object.assign(W.getDefaults(),{mute:!1,pan:0,volume:0,channelCount:1})}get mute(){return this._volume.mute}set mute(e){this._volume.mute=e}dispose(){return super.dispose(),this._panner.dispose(),this.pan.dispose(),this._volume.dispose(),this.volume.dispose(),this}}class Zs extends W{constructor(){super(k(Zs.getDefaults(),arguments,["volume","pan"])),this.name="Channel";const e=k(Zs.getDefaults(),arguments,["volume","pan"]);this._solo=this.input=new Me({solo:e.solo,context:this.context}),this._panVol=this.output=new so({context:this.context,pan:e.pan,volume:e.volume,mute:e.mute,channelCount:e.channelCount}),this.pan=this._panVol.pan,this.volume=this._panVol.volume,this._solo.connect(this._panVol),ge(this,["pan","volume"])}static getDefaults(){return Object.assign(W.getDefaults(),{pan:0,volume:0,mute:!1,solo:!1,channelCount:1})}get solo(){return this._solo.solo}set solo(e){this._solo.solo=e}get muted(){return this._solo.muted||this.mute}get mute(){return this._panVol.mute}set mute(e){this._panVol.mute=e}_getBus(e){return Zs.buses.has(e)||Zs.buses.set(e,new de({context:this.context})),Zs.buses.get(e)}send(e,t=0){const s=this._getBus(e),i=new de({context:this.context,units:"decibels",gain:t});return this.connect(i),i.connect(s),i}receive(e){return this._getBus(e).connect(this),this}dispose(){return super.dispose(),this._panVol.dispose(),this.pan.dispose(),this.volume.dispose(),this._solo.dispose(),this}}Zs.buses=new Map;class wT extends W{constructor(){super(...arguments),this.name="Listener",this.positionX=new ce({context:this.context,param:this.context.rawContext.listener.positionX}),this.positionY=new ce({context:this.context,param:this.context.rawContext.listener.positionY}),this.positionZ=new ce({context:this.context,param:this.context.rawContext.listener.positionZ}),this.forwardX=new ce({context:this.context,param:this.context.rawContext.listener.forwardX}),this.forwardY=new ce({context:this.context,param:this.context.rawContext.listener.forwardY}),this.forwardZ=new ce({context:this.context,param:this.context.rawContext.listener.forwardZ}),this.upX=new ce({context:this.context,param:this.context.rawContext.listener.upX}),this.upY=new ce({context:this.context,param:this.context.rawContext.listener.upY}),this.upZ=new ce({context:this.context,param:this.context.rawContext.listener.upZ})}static getDefaults(){return Object.assign(W.getDefaults(),{positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:-1,upX:0,upY:1,upZ:0})}dispose(){return super.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this.forwardX.dispose(),this.forwardY.dispose(),this.forwardZ.dispose(),this.upX.dispose(),this.upY.dispose(),this.upZ.dispose(),this}}_o(n=>{n.listener=new wT({context:n})});go(n=>{n.listener.dispose()});kt().transport;const yc=kt().destination;kt().destination;kt().listener;kt().draw;kt();const Tc=new Zn(900,"highpass"),Gh=new Is(-6);Gh.chain(Tc,yc);const ST=new to(3).connect(Gh),xo=new ji({envelope:{attack:0,decay:.9,sustain:.2,release:.1}});xo.oscillator.type="triangle2";xo.volume.value=-6;xo.chain(Tc,yc);const wo=new ji({envelope:{attack:.4,decay:.9,sustain:.7,release:.6}}).connect(ST);wo.oscillator.type="triangle";wo.volume.value=-6;wo.chain(Tc,yc);function bT(){return Math.floor((Math.random()-.5)*20)}let Sl=!1;const yx=async(n=0)=>{Sl||(await Jy(),Sl=!0);try{if(n>2e3)wo.triggerAttackRelease(60,.3);else if(n>1e3){let e=310;e+=bT(),xo.triggerAttackRelease(e,.001)}}catch(e){console.warn(e)}},Tx=n=>is.jsx("svg",{width:"1em",height:"1em",viewBox:"0 0 20 20",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:is.jsx("g",{id:"Type=Edit, Size=20x20",children:is.jsx("path",{id:"icon","fill-rule":"evenodd","clip-rule":"evenodd",d:"M14.9243 3.3359L9.06461 9.19559C8.97523 9.28497 8.9036 9.39048 8.85353 9.50654L7.99772 11.49C7.89015 11.7394 8.14272 11.9919 8.39203 11.8843L10.3755 11.0285C10.4916 10.9785 10.5971 10.9068 10.6865 10.8175L16.5462 4.95777C16.994 4.50991 16.994 3.78377 16.5462 3.3359C16.0983 2.88804 15.3722 2.88804 14.9243 3.3359ZM14.5297 10.7363C14.5297 10.3876 14.8127 10.1047 15.1615 10.1047C15.5116 10.1047 15.7933 10.3889 15.7933 10.7363L15.7222 14.1051C15.7222 15.1499 14.8954 16 13.8506 16H5.87166C4.85054 16 4 15.1499 4 14.0814V6.0806C4 5.05918 4.85054 4.2091 5.87166 4.2091L9.68606 4.20936C10.0362 4.20936 10.3178 4.49228 10.3178 4.841C10.3178 5.18972 10.0349 5.47264 9.68606 5.47264H5.89535C5.54735 5.47264 5.26357 5.75609 5.26357 6.10428V14.1051C5.26357 14.4533 5.54735 14.7367 5.89535 14.7367H13.898C14.246 14.7367 14.5297 14.4533 14.5297 14.1051V10.7363Z",fill:"currentColor"})})});export{NT as A,VT as B,DT as C,Tx as E,AT as L,HT as O,PT as P,Ne as R,UT as S,qT as V,RT as a,kT as b,MT as c,IT as d,FT as e,zT as f,Am as g,K as h,yx as p,WT as u};
