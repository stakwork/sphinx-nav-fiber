import{r as m,b as Bt,g as Lt,s as Te,_ as H,u as Ft,ad as co,a as Wt,j as n,c as Yt,bo as Ye,bp as it,d as Ut,e as fe,f as mt,ae as lo,af as uo,b9 as at,o as B,T as X,F as j,aW as Be,q as V,bq as po,br as et,bs as fo,b8 as Gt,O as Ht,aa as Le,aV as pe,a1 as gt,a0 as xt,Z as yt,Y as bt,X as ho,M as mo,ao as wt}from"./index-20ea28f6.js";import{B as go}from"./index-acb0ff6f.js";import{h as ct,B as Oe,F as Zt,j as Xt,o as xo,g as yo,I as bo,p as wo}from"./index-b0d8b87e.js";import{A as Fe,O as jo,a as jt,N as Kt}from"./index-f54022ed.js";import{T as We}from"./index-2cd6e591.js";import{C as le}from"./ClipLoader-4ce369de.js";import{u as qt}from"./index-6141d876.js";import{D as vo}from"./DeleteIcon-304ee64b.js";import{P as Eo}from"./PlusIcon-88e6816e.js";import{p as st,c as Po,g as Co}from"./index-44e303ef.js";import{e as To}from"./Stack-72055e8f.js";import{S as Oo}from"./SwitchBase-262eb8cd.js";import{g as Ao,m as Mo,u as J,b as Ue,t as rt,T as Qt,i as Jt,H as So,j as vt,C as _o,P as $o,k as No}from"./index-f8d502c2.js";import{Z as Io,_ as zo,E as ko,V as I,$ as de,a0 as ue,a1 as Et,P as Re,a2 as De,a3 as Pt,a as K,a4 as Ro,G as Do,C as Vo}from"./three.module-2ce81f73.js";import{A as Ct}from"./AddContentIcon-8ac1fc1c.js";import"./Popover-bf44d96f.js";import"./useSlotProps-c721fa06.js";import"./createSvgIcon-55ea993d.js";import"./TextareaAutosize-0dbbd7d8.js";import"./index.esm-f5056f82.js";import"./InfoIcon-3abfdeb4.js";const Bo=m.createContext(),Tt=Bo;function Lo(t){return Bt("MuiGrid",t)}const Fo=[0,1,2,3,4,5,6,7,8,9,10],Wo=["column-reverse","column","row-reverse","row"],Yo=["nowrap","wrap-reverse","wrap"],Pe=["auto",!0,1,2,3,4,5,6,7,8,9,10,11,12],Uo=Lt("MuiGrid",["root","container","item","zeroMinWidth",...Fo.map(t=>`spacing-xs-${t}`),...Wo.map(t=>`direction-xs-${t}`),...Yo.map(t=>`wrap-xs-${t}`),...Pe.map(t=>`grid-xs-${t}`),...Pe.map(t=>`grid-sm-${t}`),...Pe.map(t=>`grid-md-${t}`),...Pe.map(t=>`grid-lg-${t}`),...Pe.map(t=>`grid-xl-${t}`)]),Ce=Uo,Go=["className","columns","columnSpacing","component","container","direction","item","rowSpacing","spacing","wrap","zeroMinWidth"];function he(t){const o=parseFloat(t);return`${o}${String(t).replace(String(o),"")||"px"}`}function Ho({theme:t,ownerState:o}){let s;return t.breakpoints.keys.reduce((e,a)=>{let c={};if(o[a]&&(s=o[a]),!s)return e;if(s===!0)c={flexBasis:0,flexGrow:1,maxWidth:"100%"};else if(s==="auto")c={flexBasis:"auto",flexGrow:0,flexShrink:0,maxWidth:"none",width:"auto"};else{const u=Ye({values:o.columns,breakpoints:t.breakpoints.values}),i=typeof u=="object"?u[a]:u;if(i==null)return e;const l=`${Math.round(s/i*1e8)/1e6}%`;let v={};if(o.container&&o.item&&o.columnSpacing!==0){const d=t.spacing(o.columnSpacing);if(d!=="0px"){const h=`calc(${l} + ${he(d)})`;v={flexBasis:h,maxWidth:h}}}c=H({flexBasis:l,flexGrow:0,maxWidth:l},v)}return t.breakpoints.values[a]===0?Object.assign(e,c):e[t.breakpoints.up(a)]=c,e},{})}function Zo({theme:t,ownerState:o}){const s=Ye({values:o.direction,breakpoints:t.breakpoints.values});return it({theme:t},s,e=>{const a={flexDirection:e};return e.indexOf("column")===0&&(a[`& > .${Ce.item}`]={maxWidth:"none"}),a})}function eo({breakpoints:t,values:o}){let s="";Object.keys(o).forEach(a=>{s===""&&o[a]!==0&&(s=a)});const e=Object.keys(t).sort((a,c)=>t[a]-t[c]);return e.slice(0,e.indexOf(s))}function Xo({theme:t,ownerState:o}){const{container:s,rowSpacing:e}=o;let a={};if(s&&e!==0){const c=Ye({values:e,breakpoints:t.breakpoints.values});let u;typeof c=="object"&&(u=eo({breakpoints:t.breakpoints.values,values:c})),a=it({theme:t},c,(i,l)=>{var v;const d=t.spacing(i);return d!=="0px"?{marginTop:`-${he(d)}`,[`& > .${Ce.item}`]:{paddingTop:he(d)}}:(v=u)!=null&&v.includes(l)?{}:{marginTop:0,[`& > .${Ce.item}`]:{paddingTop:0}}})}return a}function Ko({theme:t,ownerState:o}){const{container:s,columnSpacing:e}=o;let a={};if(s&&e!==0){const c=Ye({values:e,breakpoints:t.breakpoints.values});let u;typeof c=="object"&&(u=eo({breakpoints:t.breakpoints.values,values:c})),a=it({theme:t},c,(i,l)=>{var v;const d=t.spacing(i);return d!=="0px"?{width:`calc(100% + ${he(d)})`,marginLeft:`-${he(d)}`,[`& > .${Ce.item}`]:{paddingLeft:he(d)}}:(v=u)!=null&&v.includes(l)?{}:{width:"100%",marginLeft:0,[`& > .${Ce.item}`]:{paddingLeft:0}}})}return a}function qo(t,o,s={}){if(!t||t<=0)return[];if(typeof t=="string"&&!Number.isNaN(Number(t))||typeof t=="number")return[s[`spacing-xs-${String(t)}`]];const e=[];return o.forEach(a=>{const c=t[a];Number(c)>0&&e.push(s[`spacing-${a}-${String(c)}`])}),e}const Qo=Te("div",{name:"MuiGrid",slot:"Root",overridesResolver:(t,o)=>{const{ownerState:s}=t,{container:e,direction:a,item:c,spacing:u,wrap:i,zeroMinWidth:l,breakpoints:v}=s;let d=[];e&&(d=qo(u,v,o));const h=[];return v.forEach(f=>{const g=s[f];g&&h.push(o[`grid-${f}-${String(g)}`])}),[o.root,e&&o.container,c&&o.item,l&&o.zeroMinWidth,...d,a!=="row"&&o[`direction-xs-${String(a)}`],i!=="wrap"&&o[`wrap-xs-${String(i)}`],...h]}})(({ownerState:t})=>H({boxSizing:"border-box"},t.container&&{display:"flex",flexWrap:"wrap",width:"100%"},t.item&&{margin:0},t.zeroMinWidth&&{minWidth:0},t.wrap!=="wrap"&&{flexWrap:t.wrap}),Zo,Xo,Ko,Ho);function Jo(t,o){if(!t||t<=0)return[];if(typeof t=="string"&&!Number.isNaN(Number(t))||typeof t=="number")return[`spacing-xs-${String(t)}`];const s=[];return o.forEach(e=>{const a=t[e];if(Number(a)>0){const c=`spacing-${e}-${String(a)}`;s.push(c)}}),s}const en=t=>{const{classes:o,container:s,direction:e,item:a,spacing:c,wrap:u,zeroMinWidth:i,breakpoints:l}=t;let v=[];s&&(v=Jo(c,l));const d=[];l.forEach(f=>{const g=t[f];g&&d.push(`grid-${f}-${String(g)}`)});const h={root:["root",s&&"container",a&&"item",i&&"zeroMinWidth",...v,e!=="row"&&`direction-xs-${String(e)}`,u!=="wrap"&&`wrap-xs-${String(u)}`,...d]};return Ut(h,Lo,o)},tn=m.forwardRef(function(o,s){const e=Ft({props:o,name:"MuiGrid"}),{breakpoints:a}=co(),c=To(e),{className:u,columns:i,columnSpacing:l,component:v="div",container:d=!1,direction:h="row",item:f=!1,rowSpacing:g,spacing:x=0,wrap:b="wrap",zeroMinWidth:C=!1}=c,O=Wt(c,Go),E=g||x,S=l||x,_=m.useContext(Tt),w=d?i||12:_,y={},A=H({},O);a.keys.forEach(M=>{O[M]!=null&&(y[M]=O[M],delete A[M])});const $=H({},c,{columns:w,container:d,direction:h,item:f,rowSpacing:E,columnSpacing:S,wrap:b,zeroMinWidth:C,spacing:x},y,{breakpoints:a.keys}),D=en($);return n.jsx(Tt.Provider,{value:w,children:n.jsx(Qo,H({ownerState:$,className:Yt(D.root,u),as:v,ref:s},A))})}),ce=tn;function on(t){return Bt("MuiSwitch",t)}const nn=Lt("MuiSwitch",["root","edgeStart","edgeEnd","switchBase","colorPrimary","colorSecondary","sizeSmall","sizeMedium","checked","disabled","input","thumb","track"]),U=nn,sn=["className","color","edge","size","sx"],rn=t=>{const{classes:o,edge:s,size:e,color:a,checked:c,disabled:u}=t,i={root:["root",s&&`edge${fe(s)}`,`size${fe(e)}`],switchBase:["switchBase",`color${fe(a)}`,c&&"checked",u&&"disabled"],thumb:["thumb"],track:["track"],input:["input"]},l=Ut(i,on,o);return H({},o,l)},an=Te("span",{name:"MuiSwitch",slot:"Root",overridesResolver:(t,o)=>{const{ownerState:s}=t;return[o.root,s.edge&&o[`edge${fe(s.edge)}`],o[`size${fe(s.size)}`]]}})(({ownerState:t})=>H({display:"inline-flex",width:34+12*2,height:14+12*2,overflow:"hidden",padding:12,boxSizing:"border-box",position:"relative",flexShrink:0,zIndex:0,verticalAlign:"middle","@media print":{colorAdjust:"exact"}},t.edge==="start"&&{marginLeft:-8},t.edge==="end"&&{marginRight:-8},t.size==="small"&&{width:40,height:24,padding:7,[`& .${U.thumb}`]:{width:16,height:16},[`& .${U.switchBase}`]:{padding:4,[`&.${U.checked}`]:{transform:"translateX(16px)"}}})),cn=Te(Oo,{name:"MuiSwitch",slot:"SwitchBase",overridesResolver:(t,o)=>{const{ownerState:s}=t;return[o.switchBase,{[`& .${U.input}`]:o.input},s.color!=="default"&&o[`color${fe(s.color)}`]]}})(({theme:t})=>({position:"absolute",top:0,left:0,zIndex:1,color:t.vars?t.vars.palette.Switch.defaultColor:`${t.palette.mode==="light"?t.palette.common.white:t.palette.grey[300]}`,transition:t.transitions.create(["left","transform"],{duration:t.transitions.duration.shortest}),[`&.${U.checked}`]:{transform:"translateX(20px)"},[`&.${U.disabled}`]:{color:t.vars?t.vars.palette.Switch.defaultDisabledColor:`${t.palette.mode==="light"?t.palette.grey[100]:t.palette.grey[600]}`},[`&.${U.checked} + .${U.track}`]:{opacity:.5},[`&.${U.disabled} + .${U.track}`]:{opacity:t.vars?t.vars.opacity.switchTrackDisabled:`${t.palette.mode==="light"?.12:.2}`},[`& .${U.input}`]:{left:"-100%",width:"300%"}}),({theme:t,ownerState:o})=>H({"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette.action.activeChannel} / ${t.vars.palette.action.hoverOpacity})`:mt(t.palette.action.active,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},o.color!=="default"&&{[`&.${U.checked}`]:{color:(t.vars||t).palette[o.color].main,"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette[o.color].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:mt(t.palette[o.color].main,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${U.disabled}`]:{color:t.vars?t.vars.palette.Switch[`${o.color}DisabledColor`]:`${t.palette.mode==="light"?lo(t.palette[o.color].main,.62):uo(t.palette[o.color].main,.55)}`}},[`&.${U.checked} + .${U.track}`]:{backgroundColor:(t.vars||t).palette[o.color].main}})),ln=Te("span",{name:"MuiSwitch",slot:"Track",overridesResolver:(t,o)=>o.track})(({theme:t})=>({height:"100%",width:"100%",borderRadius:14/2,zIndex:-1,transition:t.transitions.create(["opacity","background-color"],{duration:t.transitions.duration.shortest}),backgroundColor:t.vars?t.vars.palette.common.onBackground:`${t.palette.mode==="light"?t.palette.common.black:t.palette.common.white}`,opacity:t.vars?t.vars.opacity.switchTrack:`${t.palette.mode==="light"?.38:.3}`})),dn=Te("span",{name:"MuiSwitch",slot:"Thumb",overridesResolver:(t,o)=>o.thumb})(({theme:t})=>({boxShadow:(t.vars||t).shadows[1],backgroundColor:"currentColor",width:20,height:20,borderRadius:"50%"})),un=m.forwardRef(function(o,s){const e=Ft({props:o,name:"MuiSwitch"}),{className:a,color:c="primary",edge:u=!1,size:i="medium",sx:l}=e,v=Wt(e,sn),d=H({},e,{color:c,edge:u,size:i}),h=rn(d),f=n.jsx(dn,{className:h.thumb,ownerState:d});return n.jsxs(an,{className:Yt(h.root,a),sx:l,ownerState:d,children:[n.jsx(cn,H({type:"checkbox",icon:f,checkedIcon:f,ref:s,ownerState:d},v,{classes:H({},h,{root:h.switchBase})})),n.jsx(ln,{className:h.track,ownerState:d})]})}),pn=un,fn={type:"",parent:""},Ot=({onSelect:t,dataTestId:o,edgeLink:s,hideSelectAll:e})=>{const a=ct({mode:"onChange",defaultValues:fn}),{watch:c,setValue:u}=a,[i,l]=m.useState([]),[v,d]=m.useState(!1),h=b=>{u("parent",(b==null?void 0:b.value)||""),t(b==null?void 0:b.value)},f=b=>b.charAt(0).toUpperCase()+b.slice(1);m.useEffect(()=>{(async()=>{d(!0);try{const O=(await at()).schemas.filter(S=>!S.is_deleted&&S.type).map(S=>(S==null?void 0:S.type)==="thing"?{label:"No Parent",value:S.type}:{label:f(S.type),value:S.type});l(e?O:[{label:"Select all",value:"all"},...O]),s&&u("parent",s)}catch(C){console.warn(C)}finally{d(!1)}})()},[s,u,e]);const g=c("parent"),x=()=>{const b=i==null?void 0:i.find(C=>C.value===g);if(b)return b;if(s)return{label:s,value:s}};return n.jsx(Fe,{dataTestId:o,disabled:!!s,isLoading:v,onSelect:h,options:i||jo,selectedValue:x()})},hn=({selectedType:t,setSelectedFromNode:o,setSelectedToNode:s,edgeLinkData:e,selectedFromNode:a,selectedToNode:c})=>{const u=c==="all",i=a==="all";return n.jsxs(j,{children:[n.jsx(j,{align:"center",direction:"row",justify:"space-between",mb:35,children:n.jsx(j,{align:"center",direction:"row",children:n.jsx(mn,{children:e!=null&&e.refId?"Edit Edge":"Add Edge"})})}),n.jsxs(j,{mb:25,children:[n.jsx(j,{mb:12,children:n.jsx(X,{children:"Source"})}),n.jsx(Ot,{dataTestId:"from_node",edgeLink:e==null?void 0:e.source,hideSelectAll:u,onSelect:o})]}),n.jsxs(j,{mb:10,children:[n.jsx(j,{mb:12,children:n.jsx(X,{children:"Edge Name"})}),n.jsx(j,{mb:12,children:n.jsx(We,{id:"cy-item-name",maxLength:250,name:"type",placeholder:"Enter type name",rules:{...Be},value:t})})]}),n.jsxs(j,{mb:25,children:[n.jsx(j,{mb:12,children:n.jsx(X,{children:"Destination"})}),n.jsx(Ot,{dataTestId:"to_node",edgeLink:e==null?void 0:e.target,hideSelectAll:i,onSelect:s})]})]})},mn=B(X)`
  font-size: 22px;
  font-weight: 600;
`,gn=({onCancel:t,edgeLinkData:o,setGraphLoading:s})=>{var y,A,$;const e=ct({mode:"onChange"}),{setValue:a,getValues:c}=e,[u,i]=m.useState(!1),[l,v]=m.useState(!1),[d,h]=m.useState(""),[f,g]=m.useState(""),[x,b]=m.useState(""),C=e.watch("type");m.useEffect(()=>{a("type",o==null?void 0:o.edgeType)},[o==null?void 0:o.edgeType,a]),m.useEffect(()=>{h(C)},[C]);const O=e.handleSubmit(async D=>{i(!0),s(!0);const M={source:f,target:x,edge_type:D.type},Y={ref_id:o==null?void 0:o.refId,edge_type:D.type};try{if(o!=null&&o.refId)await po(Y);else if(x&&f)if(f==="all"||x==="all"){const z=(await at()).schemas.filter(L=>!L.is_deleted&&L.type).map(L=>L.type);f==="all"?await Promise.all(z.map(L=>et({...M,source:L}))):x==="all"&&await Promise.all(z.map(L=>et({...M,target:L})))}else await et(M)}catch(ee){console.warn("API Error:",ee)}finally{i(!1),s(!1),g(""),b(""),t()}}),E=(A=(y=c())==null?void 0:y.type)==null?void 0:A.trim(),S=E&&(($=o==null?void 0:o.edgeType)==null?void 0:$.trim())!==E,_=o!=null&&o.refId?u||!S:u||!x||!f||!d,w=async()=>{v(!0),s(!0);try{o!=null&&o.refId&&await fo(o==null?void 0:o.refId)}catch(D){console.warn("API Error:",D)}finally{v(!1),s(!1),g(""),b(""),t()}};return n.jsx(Zt,{...e,children:n.jsxs("form",{id:"add-type-form",onSubmit:O,children:[n.jsx(hn,{edgeLinkData:o,selectedFromNode:f,selectedToNode:x,selectedType:d,setSelectedFromNode:g,setSelectedToNode:b}),n.jsxs(j,{direction:"row",justify:"space-between",mt:20,children:[(o==null?void 0:o.refId)&&n.jsx(j,{direction:"column",children:n.jsxs(yn,{color:"secondary",disabled:l,onClick:w,size:"large",style:{marginRight:20},variant:"contained",children:["Delete",l&&n.jsxs(At,{children:[n.jsx(le,{color:V.lightGray,size:12})," "]})]})}),n.jsxs(xn,{color:"secondary",disabled:_,onClick:O,size:"large",variant:"contained",children:["Confirm",u&&n.jsxs(At,{children:[n.jsx(le,{color:V.lightGray,size:12})," "]})]})]})]})})},xn=B(Oe)`
  width: 293px !important;
  margin: 0 0 10px auto !important;
`,At=B.span`
  margin-top: 2px;
`,yn=B(Oe)`
  && {
    color: ${V.primaryRed};
    background-color: rgba(237, 116, 116, 0.1);

    &:hover,
    &:active,
    &:focus {
      color: ${V.primaryRed};
      background-color: rgba(237, 116, 116, 0.2);
    }
  }
`,bn=({setIsAddEdgeNode:t,edgeData:o,setGraphLoading:s})=>{const e=()=>{t(!1)};return n.jsxs(j,{children:[n.jsx(j,{direction:"row",justify:"flex-end",children:n.jsx(wn,{"data-testid":"close-sidebar-sub-view",onClick:e,children:n.jsx(Xt,{})})}),n.jsx(gn,{edgeLinkData:o,onCancel:e,setGraphLoading:s})]})},wn=B(j)`
  font-size: 32px;
  color: ${V.white};
  cursor: pointer;
`,jn=/^[a-z0-9_]+$/,vn=({parentParam:t,onDelete:o})=>{const[s,e]=m.useState(!1),[a,c]=m.useState([]),{fields:u,append:i,replace:l,remove:v}=xo({name:"attributes"}),{setValue:d,watch:h}=yo();return m.useEffect(()=>{const f=async()=>{try{let g=[{required:!1,type:"string",key:""}];if(t!==Kt.value.toLowerCase()){e(!0);const x=await Gt(t);x.attributes&&typeof x.attributes=="object"?g=st(x.attributes):g=st(x)}g=g.filter(x=>x.key!=="node_key"),l(g),c(g)}catch(g){console.warn(g)}finally{e(!1)}};a.length===0&&f()},[t,d,l,a.length]),n.jsxs(n.Fragment,{children:[s?n.jsx(j,{align:"center",children:n.jsx(le,{color:V.SECONDARY_BLUE,size:"30"})}):n.jsx(En,{py:8,children:n.jsx(ce,{container:!0,spacing:2,children:u.map((f,g)=>{const x=h(`attributes[${g}].type`),b=h(`attributes[${g}].required`),C=f.isNew||!1,O=["name"].includes(h(`attributes[${g}].key`));return n.jsxs(m.Fragment,{children:[n.jsx(ce,{item:!0,xs:5,children:n.jsx(We,{autoComplete:"off",className:"text-input",dataTestId:`cy-item-name-${g}`,disabled:!C,id:`cy-item-name-${g}`,maxLength:50,name:`attributes.${g}.key`,placeholder:"Enter value",rules:{...Be,pattern:{message:"Please avoid special characters, spaces and uppercase",value:jn}}})}),n.jsx(ce,{item:!0,xs:4,children:n.jsx(Fe,{dataTestId:`cy-item-select-${g}`,disabled:O,onSelect:E=>d(`attributes[${g}].type`,E==null?void 0:E.value),options:jt,selectedValue:jt.find(E=>E.value===x)})}),n.jsxs(ce,{item:!0,xs:3,children:[n.jsx(pn,{checked:b,"data-testid":`cy-item-${g}`,disabled:O,name:`attributes.${g}.required`,onChange:E=>d(`attributes[${g}].required`,E.target.checked),size:"small"}),!O&&n.jsx(bo,{onClick:()=>{v(g),f.key!==void 0&&o&&o(f.key)},children:n.jsx(vo,{})})]})]},f.id)})})}),n.jsx(j,{align:"flex-start",py:12,children:n.jsx(Oe,{"data-testid":"add-attribute-btn",onClick:()=>i({key:"",type:"string",required:!0,isNew:!0}),size:"medium",startIcon:n.jsx(Eo,{}),variant:"contained",children:"Add Attribute"})})]})},En=B(j)`
  overflow-y: auto;
  width: calc(100% + 20px);
  max-height: calc(80vh - 300px);
`,Pn=({parent:t,onDelete:o})=>{const s=t;return n.jsxs(j,{children:[n.jsx(j,{direction:"row",mb:10,children:n.jsxs(ce,{container:!0,spacing:2,children:[n.jsx(ce,{item:!0,xs:5,children:n.jsx(tt,{style:{marginRight:180},children:"Attributes"})}),n.jsx(ce,{item:!0,xs:4,children:n.jsx(tt,{style:{marginRight:130},children:"Type"})}),n.jsx(ce,{item:!0,xs:3,children:n.jsx(tt,{children:"Required"})})]})}),s&&n.jsx(vn,{onDelete:o,parentParam:s},s)]})},tt=B(X)`
  font-size: 15px;
  color: gray;
`,Cn={type:"",parent:""},Tn=(t,o)=>t.length!==o.length?!0:t.some((s,e)=>{const a=o[e];return s.required!==a.required||s.type!==a.type||s.key!==a.key}),On=async(t,o=!1,s)=>{try{const{attributes:e,...a}=t,c={...Po(e),...s.reduce((l,v)=>({...l,[v]:"delete"}),{})},u={...a,attributes:c};let i;if(o?i=await Le.put(`/schema/${t.ref_id}`,JSON.stringify(u),{}):i=await Le.post("/schema",JSON.stringify({...u,node_key:"name"}),{}),i.status!=="success")throw new Error("error");return i==null?void 0:i.ref_id}catch(e){let a=pe;if(e.status===400){const c=await e.json();a=c.errorCode||(c==null?void 0:c.status)||pe}else e instanceof Error&&(a=e.message);throw new Error(a)}},An=t=>t.charAt(0).toUpperCase()+t.slice(1),Mt=async(t,o)=>{try{const c=((await at()).schemas||[]).filter(u=>!u.is_deleted&&u.type&&(!o||o(u))).map(u=>u.type==="thing"?{label:"No Parent",value:u.type}:{label:An(u.type),value:u.type});t(c)}catch(s){console.warn(s)}},Mn=({graphLoading:t,onSchemaCreate:o,selectedSchema:s,onDelete:e,setSelectedSchemaId:a,setGraphLoading:c,setIsCreateNew:u,onSchemaUpdate:i})=>{const{close:l,visible:v}=Ht("addType"),d=ct({mode:"onChange",defaultValues:s?{type:s.type,parent:s.parent}:Cn}),{watch:h,setValue:f,reset:g,getValues:x}=d,[b,C]=m.useState(!1),[O,E]=m.useState(!1),[S,_]=m.useState(!1),[w,y]=m.useState(null),[A,$]=m.useState(!1),[D,M]=m.useState(null),[Y,ee]=m.useState(""),[z,L]=m.useState(null),[Z,te]=m.useState([]),[re,Q]=m.useState([]),[me,Ae]=m.useState(!0);m.useEffect(()=>()=>{g()},[v,g]);const Me=()=>{u(!1),a("")};m.useEffect(()=>{s||(_(!0),Mt(y).finally(()=>_(!1)))},[s]),m.useEffect(()=>{(async()=>{if(s){f("type",s==null?void 0:s.type),f("parent",s.parent);let k=[{required:!1,type:"string",key:""}];if(s.type!==Kt.value.toLowerCase()){const F=await Gt(s.type);k=F?st(F):k}k=k.filter(F=>F.key!=="node_key"),Q(k),await Mt(M,F=>F.type!==s.type)}})()},[s,f]);const G=h("parent");h("type");const Se=N=>Array.isArray(N)&&N.every(k=>typeof k=="object"&&"key"in k),ge=h("attributes"),xe=m.useMemo(()=>Se(ge)?ge:[],[ge]),Ge=()=>{l()},He=N=>{te(k=>[...k,N])},Ze=async()=>{if(s!=null&&s.type){E(!0),c(!0);try{await Le.delete(`/schema/${s.ref_id}`),e(s.type),l()}catch(N){let k=pe;if((N==null?void 0:N.status)===400){const F=await N.json();k=F.errorCode||(F==null?void 0:F.status)||pe}else N instanceof Error&&(k=N.message);L(k)}finally{E(!1),c(!1),u(!1)}}},_e=d.handleSubmit(async N=>{if(!G){$(!0);return}C(!0);try{if(s&&N.type!==(s==null?void 0:s.type)||s&&x().parent!==(s==null?void 0:s.parent)){const F=x().parent??(s==null?void 0:s.parent);c(!0),await Le.put(`/schema/${s==null?void 0:s.ref_id}`,JSON.stringify({type:N.type,parent:F})),await i()}const k=await On({...N,...s?{ref_id:s==null?void 0:s.ref_id}:{}},!!s,Z);o({type:N.type,parent:G||"",ref_id:(s==null?void 0:s.ref_id)||k||"new"}),Ge()}catch(k){let F=pe;if((k==null?void 0:k.status)===400){const ie=await k.json();F=ie.errorCode||(ie==null?void 0:ie.status)||pe}else k instanceof Error&&(F=k.message);ee(F)}finally{C(!1),c(!1),u(!1)}});m.useEffect(()=>{const N=d.watch(k=>{var be,we,Ne,Ie,je;const F=Tn(xe,re),ie=((be=k.type)==null?void 0:be.trim())!==((we=s==null?void 0:s.type)==null?void 0:we.trim())||((Ne=k.parent)==null?void 0:Ne.trim())!==((Ie=s==null?void 0:s.parent)==null?void 0:Ie.trim())||F,ye=!!((je=k.type)!=null&&je.trim());Ae(s?b||!ie||!ye||A:b||A||!ye)});return()=>N.unsubscribe()},[d,xe,re,s,b,A]);const Xe=()=>w==null?void 0:w.find(N=>N.value===G),$e=()=>{const N=D==null?void 0:D.find(k=>k.value===G);if(N)return N;if(G)return{label:G,value:G}};return n.jsxs(j,{children:[n.jsx(j,{direction:"row",justify:"flex-end",children:n.jsx($n,{"data-testid":"close-sidebar-sub-view",onClick:Me,children:n.jsx(Xt,{})})}),n.jsx(j,{children:n.jsx(Zt,{...d,children:n.jsxs("form",{id:"add-type-form",onSubmit:_e,children:[n.jsx(j,{children:s?n.jsxs(n.Fragment,{children:[n.jsxs(j,{mb:12,children:[n.jsx(j,{mb:12,children:n.jsx(X,{children:"Name"})}),n.jsx(j,{mb:12,children:n.jsx(We,{dataTestId:"cy-item-name",defaultValue:s==null?void 0:s.type,id:"cy-item-name",maxLength:250,name:"type",placeholder:"Enter type name",rules:{...Be},value:G})})]}),n.jsxs(j,{mb:12,children:[n.jsx(j,{mb:12,children:n.jsx(X,{children:"Parent"})}),n.jsx(Fe,{isLoading:S||t,onSelect:N=>{f("parent",(N==null?void 0:N.value)||""),$(!1)},options:D||[],selectedValue:$e()}),Y&&n.jsx(ot,{children:Y})]})]}):n.jsxs(n.Fragment,{children:[n.jsxs(j,{mb:12,children:[n.jsx(j,{mb:12,children:n.jsx(X,{children:"Select Parent"})}),n.jsx(Fe,{isLoading:S,onSelect:N=>{f("parent",(N==null?void 0:N.value)||""),$(!1)},options:w,selectedValue:Xe()}),A&&n.jsx(ot,{children:"A parent type must be selected"})]}),n.jsxs(j,{children:[n.jsx(j,{mb:12,children:n.jsx(X,{children:"Type name"})}),n.jsx(j,{mb:12,children:n.jsx(We,{id:"cy-item-name",maxLength:250,name:"type",placeholder:"Enter type name",rules:{...Be},value:G})})]})]})}),n.jsx(Pn,{onDelete:He,parent:s?s.type:G}),n.jsxs(j,{direction:"row",justify:"space-between",mt:20,children:[s&&n.jsxs(j,{direction:"column",children:[n.jsxs(_n,{color:"secondary",disabled:O,onClick:Ze,size:"large",style:{marginRight:20},variant:"contained",children:["Delete",O&&n.jsxs(St,{children:[n.jsx(le,{color:V.lightGray,size:12})," "]})]}),z&&n.jsx(ot,{children:z})]}),n.jsxs(Sn,{color:"secondary",disabled:me,onClick:_e,size:"large",variant:"contained",children:["Confirm",b&&n.jsxs(St,{children:[n.jsx(le,{color:V.lightGray,size:12})," "]})]})]})]})})})]})},Sn=B(Oe)`
  width: 100% !important;
  margin: 0 auto !important;
`,St=B.span`
  margin-top: 2px;
`,_n=B(Oe)`
  && {
    color: ${V.primaryRed};
    background-color: rgba(237, 116, 116, 0.1);

    &:hover,
    &:active,
    &:focus {
      color: ${V.primaryRed};
      background-color: rgba(237, 116, 116, 0.2);
    }
  }
`,$n=B(j)`
  font-size: 32px;
  color: ${V.white};
  cursor: pointer;
`,ot=B(j)`
  font-size: 13px;
  font-family: Barlow;
  color: #ff8f80;
  line-height: 0.2px;
  margin-top: 12px;
  padding-top: 20px;
`;var Nn=Object.defineProperty,In=(t,o,s)=>o in t?Nn(t,o,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[o]=s,P=(t,o,s)=>(In(t,typeof o!="symbol"?o+"":o,s),s);const Ve=new Io,_t=new zo,zn=Math.cos(70*(Math.PI/180)),$t=(t,o)=>(t%o+o)%o;let kn=class extends ko{constructor(o,s){super(),P(this,"object"),P(this,"domElement"),P(this,"enabled",!0),P(this,"target",new I),P(this,"minDistance",0),P(this,"maxDistance",1/0),P(this,"minZoom",0),P(this,"maxZoom",1/0),P(this,"minPolarAngle",0),P(this,"maxPolarAngle",Math.PI),P(this,"minAzimuthAngle",-1/0),P(this,"maxAzimuthAngle",1/0),P(this,"enableDamping",!1),P(this,"dampingFactor",.05),P(this,"enableZoom",!0),P(this,"zoomSpeed",1),P(this,"enableRotate",!0),P(this,"rotateSpeed",1),P(this,"enablePan",!0),P(this,"panSpeed",1),P(this,"screenSpacePanning",!0),P(this,"keyPanSpeed",7),P(this,"zoomToCursor",!1),P(this,"autoRotate",!1),P(this,"autoRotateSpeed",2),P(this,"reverseOrbit",!1),P(this,"reverseHorizontalOrbit",!1),P(this,"reverseVerticalOrbit",!1),P(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),P(this,"mouseButtons",{LEFT:de.ROTATE,MIDDLE:de.DOLLY,RIGHT:de.PAN}),P(this,"touches",{ONE:ue.ROTATE,TWO:ue.DOLLY_PAN}),P(this,"target0"),P(this,"position0"),P(this,"zoom0"),P(this,"_domElementKeyEvents",null),P(this,"getPolarAngle"),P(this,"getAzimuthalAngle"),P(this,"setPolarAngle"),P(this,"setAzimuthalAngle"),P(this,"getDistance"),P(this,"listenToKeyEvents"),P(this,"stopListenToKeyEvents"),P(this,"saveState"),P(this,"reset"),P(this,"update"),P(this,"connect"),P(this,"dispose"),this.object=o,this.domElement=s,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>d.phi,this.getAzimuthalAngle=()=>d.theta,this.setPolarAngle=r=>{let p=$t(r,2*Math.PI),T=d.phi;T<0&&(T+=2*Math.PI),p<0&&(p+=2*Math.PI);let R=Math.abs(p-T);2*Math.PI-R<R&&(p<T?p+=2*Math.PI:T+=2*Math.PI),h.phi=p-T,e.update()},this.setAzimuthalAngle=r=>{let p=$t(r,2*Math.PI),T=d.theta;T<0&&(T+=2*Math.PI),p<0&&(p+=2*Math.PI);let R=Math.abs(p-T);2*Math.PI-R<R&&(p<T?p+=2*Math.PI:T+=2*Math.PI),h.theta=p-T,e.update()},this.getDistance=()=>e.object.position.distanceTo(e.target),this.listenToKeyEvents=r=>{r.addEventListener("keydown",Qe),this._domElementKeyEvents=r},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",Qe),this._domElementKeyEvents=null},this.saveState=()=>{e.target0.copy(e.target),e.position0.copy(e.object.position),e.zoom0=e.object.zoom},this.reset=()=>{e.target.copy(e.target0),e.object.position.copy(e.position0),e.object.zoom=e.zoom0,e.object.updateProjectionMatrix(),e.dispatchEvent(a),e.update(),l=i.NONE},this.update=(()=>{const r=new I,p=new I(0,1,0),T=new Et().setFromUnitVectors(o.up,p),R=T.clone().invert(),W=new I,oe=new Et,ae=2*Math.PI;return function(){const ht=e.object.position;T.setFromUnitVectors(o.up,p),R.copy(T).invert(),r.copy(ht).sub(e.target),r.applyQuaternion(T),d.setFromVector3(r),e.autoRotate&&l===i.NONE&&L(ee()),e.enableDamping?(d.theta+=h.theta*e.dampingFactor,d.phi+=h.phi*e.dampingFactor):(d.theta+=h.theta,d.phi+=h.phi);let ne=e.minAzimuthAngle,se=e.maxAzimuthAngle;isFinite(ne)&&isFinite(se)&&(ne<-Math.PI?ne+=ae:ne>Math.PI&&(ne-=ae),se<-Math.PI?se+=ae:se>Math.PI&&(se-=ae),ne<=se?d.theta=Math.max(ne,Math.min(se,d.theta)):d.theta=d.theta>(ne+se)/2?Math.max(ne,d.theta):Math.min(se,d.theta)),d.phi=Math.max(e.minPolarAngle,Math.min(e.maxPolarAngle,d.phi)),d.makeSafe(),e.enableDamping===!0?e.target.addScaledVector(g,e.dampingFactor):e.target.add(g),e.zoomToCursor&&D||e.object.isOrthographicCamera?d.radius=G(d.radius):d.radius=G(d.radius*f),r.setFromSpherical(d),r.applyQuaternion(R),ht.copy(e.target).add(r),e.object.matrixAutoUpdate||e.object.updateMatrix(),e.object.lookAt(e.target),e.enableDamping===!0?(h.theta*=1-e.dampingFactor,h.phi*=1-e.dampingFactor,g.multiplyScalar(1-e.dampingFactor)):(h.set(0,0,0),g.set(0,0,0));let ze=!1;if(e.zoomToCursor&&D){let ve=null;if(e.object instanceof Re&&e.object.isPerspectiveCamera){const Ee=r.length();ve=G(Ee*f);const ke=Ee-ve;e.object.position.addScaledVector(A,ke),e.object.updateMatrixWorld()}else if(e.object.isOrthographicCamera){const Ee=new I($.x,$.y,0);Ee.unproject(e.object),e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/f)),e.object.updateProjectionMatrix(),ze=!0;const ke=new I($.x,$.y,0);ke.unproject(e.object),e.object.position.sub(ke).add(Ee),e.object.updateMatrixWorld(),ve=r.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),e.zoomToCursor=!1;ve!==null&&(e.screenSpacePanning?e.target.set(0,0,-1).transformDirection(e.object.matrix).multiplyScalar(ve).add(e.object.position):(Ve.origin.copy(e.object.position),Ve.direction.set(0,0,-1).transformDirection(e.object.matrix),Math.abs(e.object.up.dot(Ve.direction))<zn?o.lookAt(e.target):(_t.setFromNormalAndCoplanarPoint(e.object.up,e.target),Ve.intersectPlane(_t,e.target))))}else e.object instanceof De&&e.object.isOrthographicCamera&&(e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/f)),e.object.updateProjectionMatrix(),ze=!0);return f=1,D=!1,ze||W.distanceToSquared(e.object.position)>v||8*(1-oe.dot(e.object.quaternion))>v?(e.dispatchEvent(a),W.copy(e.object.position),oe.copy(e.object.quaternion),ze=!1,!0):!1}})(),this.connect=r=>{r===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),e.domElement=r,e.domElement.style.touchAction="none",e.domElement.addEventListener("contextmenu",ut),e.domElement.addEventListener("pointerdown",je),e.domElement.addEventListener("pointercancel",lt),e.domElement.addEventListener("wheel",dt)},this.dispose=()=>{var r,p,T,R,W,oe;(r=e.domElement)==null||r.removeEventListener("contextmenu",ut),(p=e.domElement)==null||p.removeEventListener("pointerdown",je),(T=e.domElement)==null||T.removeEventListener("pointercancel",lt),(R=e.domElement)==null||R.removeEventListener("wheel",dt),(W=e.domElement)==null||W.ownerDocument.removeEventListener("pointermove",Ke),(oe=e.domElement)==null||oe.ownerDocument.removeEventListener("pointerup",qe),e._domElementKeyEvents!==null&&e._domElementKeyEvents.removeEventListener("keydown",Qe)};const e=this,a={type:"change"},c={type:"start"},u={type:"end"},i={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let l=i.NONE;const v=1e-6,d=new Pt,h=new Pt;let f=1;const g=new I,x=new K,b=new K,C=new K,O=new K,E=new K,S=new K,_=new K,w=new K,y=new K,A=new I,$=new K;let D=!1;const M=[],Y={};function ee(){return 2*Math.PI/60/60*e.autoRotateSpeed}function z(){return Math.pow(.95,e.zoomSpeed)}function L(r){e.reverseOrbit||e.reverseHorizontalOrbit?h.theta+=r:h.theta-=r}function Z(r){e.reverseOrbit||e.reverseVerticalOrbit?h.phi+=r:h.phi-=r}const te=(()=>{const r=new I;return function(T,R){r.setFromMatrixColumn(R,0),r.multiplyScalar(-T),g.add(r)}})(),re=(()=>{const r=new I;return function(T,R){e.screenSpacePanning===!0?r.setFromMatrixColumn(R,1):(r.setFromMatrixColumn(R,0),r.crossVectors(e.object.up,r)),r.multiplyScalar(T),g.add(r)}})(),Q=(()=>{const r=new I;return function(T,R){const W=e.domElement;if(W&&e.object instanceof Re&&e.object.isPerspectiveCamera){const oe=e.object.position;r.copy(oe).sub(e.target);let ae=r.length();ae*=Math.tan(e.object.fov/2*Math.PI/180),te(2*T*ae/W.clientHeight,e.object.matrix),re(2*R*ae/W.clientHeight,e.object.matrix)}else W&&e.object instanceof De&&e.object.isOrthographicCamera?(te(T*(e.object.right-e.object.left)/e.object.zoom/W.clientWidth,e.object.matrix),re(R*(e.object.top-e.object.bottom)/e.object.zoom/W.clientHeight,e.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),e.enablePan=!1)}})();function me(r){e.object instanceof Re&&e.object.isPerspectiveCamera||e.object instanceof De&&e.object.isOrthographicCamera?f/=r:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function Ae(r){e.object instanceof Re&&e.object.isPerspectiveCamera||e.object instanceof De&&e.object.isOrthographicCamera?f*=r:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function Me(r){if(!e.zoomToCursor||!e.domElement)return;D=!0;const p=e.domElement.getBoundingClientRect(),T=r.clientX-p.left,R=r.clientY-p.top,W=p.width,oe=p.height;$.x=T/W*2-1,$.y=-(R/oe)*2+1,A.set($.x,$.y,1).unproject(e.object).sub(e.object.position).normalize()}function G(r){return Math.max(e.minDistance,Math.min(e.maxDistance,r))}function Se(r){x.set(r.clientX,r.clientY)}function ge(r){Me(r),_.set(r.clientX,r.clientY)}function xe(r){O.set(r.clientX,r.clientY)}function Ge(r){b.set(r.clientX,r.clientY),C.subVectors(b,x).multiplyScalar(e.rotateSpeed);const p=e.domElement;p&&(L(2*Math.PI*C.x/p.clientHeight),Z(2*Math.PI*C.y/p.clientHeight)),x.copy(b),e.update()}function He(r){w.set(r.clientX,r.clientY),y.subVectors(w,_),y.y>0?me(z()):y.y<0&&Ae(z()),_.copy(w),e.update()}function Ze(r){E.set(r.clientX,r.clientY),S.subVectors(E,O).multiplyScalar(e.panSpeed),Q(S.x,S.y),O.copy(E),e.update()}function _e(r){Me(r),r.deltaY<0?Ae(z()):r.deltaY>0&&me(z()),e.update()}function Xe(r){let p=!1;switch(r.code){case e.keys.UP:Q(0,e.keyPanSpeed),p=!0;break;case e.keys.BOTTOM:Q(0,-e.keyPanSpeed),p=!0;break;case e.keys.LEFT:Q(e.keyPanSpeed,0),p=!0;break;case e.keys.RIGHT:Q(-e.keyPanSpeed,0),p=!0;break}p&&(r.preventDefault(),e.update())}function $e(){if(M.length==1)x.set(M[0].pageX,M[0].pageY);else{const r=.5*(M[0].pageX+M[1].pageX),p=.5*(M[0].pageY+M[1].pageY);x.set(r,p)}}function N(){if(M.length==1)O.set(M[0].pageX,M[0].pageY);else{const r=.5*(M[0].pageX+M[1].pageX),p=.5*(M[0].pageY+M[1].pageY);O.set(r,p)}}function k(){const r=M[0].pageX-M[1].pageX,p=M[0].pageY-M[1].pageY,T=Math.sqrt(r*r+p*p);_.set(0,T)}function F(){e.enableZoom&&k(),e.enablePan&&N()}function ie(){e.enableZoom&&k(),e.enableRotate&&$e()}function ye(r){if(M.length==1)b.set(r.pageX,r.pageY);else{const T=Je(r),R=.5*(r.pageX+T.x),W=.5*(r.pageY+T.y);b.set(R,W)}C.subVectors(b,x).multiplyScalar(e.rotateSpeed);const p=e.domElement;p&&(L(2*Math.PI*C.x/p.clientHeight),Z(2*Math.PI*C.y/p.clientHeight)),x.copy(b)}function be(r){if(M.length==1)E.set(r.pageX,r.pageY);else{const p=Je(r),T=.5*(r.pageX+p.x),R=.5*(r.pageY+p.y);E.set(T,R)}S.subVectors(E,O).multiplyScalar(e.panSpeed),Q(S.x,S.y),O.copy(E)}function we(r){const p=Je(r),T=r.pageX-p.x,R=r.pageY-p.y,W=Math.sqrt(T*T+R*R);w.set(0,W),y.set(0,Math.pow(w.y/_.y,e.zoomSpeed)),me(y.y),_.copy(w)}function Ne(r){e.enableZoom&&we(r),e.enablePan&&be(r)}function Ie(r){e.enableZoom&&we(r),e.enableRotate&&ye(r)}function je(r){var p,T;e.enabled!==!1&&(M.length===0&&((p=e.domElement)==null||p.ownerDocument.addEventListener("pointermove",Ke),(T=e.domElement)==null||T.ownerDocument.addEventListener("pointerup",qe)),ao(r),r.pointerType==="touch"?ro(r):no(r))}function Ke(r){e.enabled!==!1&&(r.pointerType==="touch"?io(r):so(r))}function qe(r){var p,T,R;pt(r),M.length===0&&((p=e.domElement)==null||p.releasePointerCapture(r.pointerId),(T=e.domElement)==null||T.ownerDocument.removeEventListener("pointermove",Ke),(R=e.domElement)==null||R.ownerDocument.removeEventListener("pointerup",qe)),e.dispatchEvent(u),l=i.NONE}function lt(r){pt(r)}function no(r){let p;switch(r.button){case 0:p=e.mouseButtons.LEFT;break;case 1:p=e.mouseButtons.MIDDLE;break;case 2:p=e.mouseButtons.RIGHT;break;default:p=-1}switch(p){case de.DOLLY:if(e.enableZoom===!1)return;ge(r),l=i.DOLLY;break;case de.ROTATE:if(r.ctrlKey||r.metaKey||r.shiftKey){if(e.enablePan===!1)return;xe(r),l=i.PAN}else{if(e.enableRotate===!1)return;Se(r),l=i.ROTATE}break;case de.PAN:if(r.ctrlKey||r.metaKey||r.shiftKey){if(e.enableRotate===!1)return;Se(r),l=i.ROTATE}else{if(e.enablePan===!1)return;xe(r),l=i.PAN}break;default:l=i.NONE}l!==i.NONE&&e.dispatchEvent(c)}function so(r){if(e.enabled!==!1)switch(l){case i.ROTATE:if(e.enableRotate===!1)return;Ge(r);break;case i.DOLLY:if(e.enableZoom===!1)return;He(r);break;case i.PAN:if(e.enablePan===!1)return;Ze(r);break}}function dt(r){e.enabled===!1||e.enableZoom===!1||l!==i.NONE&&l!==i.ROTATE||(r.preventDefault(),e.dispatchEvent(c),_e(r),e.dispatchEvent(u))}function Qe(r){e.enabled===!1||e.enablePan===!1||Xe(r)}function ro(r){switch(ft(r),M.length){case 1:switch(e.touches.ONE){case ue.ROTATE:if(e.enableRotate===!1)return;$e(),l=i.TOUCH_ROTATE;break;case ue.PAN:if(e.enablePan===!1)return;N(),l=i.TOUCH_PAN;break;default:l=i.NONE}break;case 2:switch(e.touches.TWO){case ue.DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;F(),l=i.TOUCH_DOLLY_PAN;break;case ue.DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;ie(),l=i.TOUCH_DOLLY_ROTATE;break;default:l=i.NONE}break;default:l=i.NONE}l!==i.NONE&&e.dispatchEvent(c)}function io(r){switch(ft(r),l){case i.TOUCH_ROTATE:if(e.enableRotate===!1)return;ye(r),e.update();break;case i.TOUCH_PAN:if(e.enablePan===!1)return;be(r),e.update();break;case i.TOUCH_DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;Ne(r),e.update();break;case i.TOUCH_DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;Ie(r),e.update();break;default:l=i.NONE}}function ut(r){e.enabled!==!1&&r.preventDefault()}function ao(r){M.push(r)}function pt(r){delete Y[r.pointerId];for(let p=0;p<M.length;p++)if(M[p].pointerId==r.pointerId){M.splice(p,1);return}}function ft(r){let p=Y[r.pointerId];p===void 0&&(p=new K,Y[r.pointerId]=p),p.set(r.pageX,r.pageY)}function Je(r){const p=r.pointerId===M[0].pointerId?M[1]:M[0];return Y[p.pointerId]}s!==void 0&&this.connect(s),this.update()}};const Rn=new I,Nt=m.forwardRef(function({start:o=[0,0,0],end:s=[0,0,0],mid:e,segments:a=20,...c},u){const i=m.useRef(null),[l]=m.useState(()=>new Ro(void 0,void 0,void 0)),v=m.useCallback((h,f,g,x=20)=>(h instanceof I?l.v0.copy(h):l.v0.set(...h),f instanceof I?l.v2.copy(f):l.v2.set(...f),g instanceof I?l.v1.copy(g):l.v1.copy(l.v0.clone().add(l.v2.clone().sub(l.v0)).add(Rn.set(0,l.v0.y-l.v2.y,0))),l.getPoints(x)),[]);m.useLayoutEffect(()=>{i.current.setPoints=(h,f,g)=>{const x=v(h,f,g);i.current.geometry&&i.current.geometry.setPositions(x.map(b=>b.toArray()).flat())}},[]);const d=m.useMemo(()=>v(o,s,e,a),[o,s,e,a]);return m.createElement(Ao,H({ref:Mo([i,u]),points:d},c))}),Dn=m.forwardRef(({makeDefault:t,camera:o,regress:s,domElement:e,enableDamping:a=!0,onChange:c,onStart:u,onEnd:i,...l},v)=>{const d=J(w=>w.invalidate),h=J(w=>w.camera),f=J(w=>w.gl),g=J(w=>w.events),x=J(w=>w.setEvents),b=J(w=>w.set),C=J(w=>w.get),O=J(w=>w.performance),E=o||h,S=e||g.connected||f.domElement,_=m.useMemo(()=>new kn(E),[E]);return Ue(()=>{_.enabled&&_.update()},-1),m.useEffect(()=>(_.connect(S),()=>void _.dispose()),[S,s,_,d]),m.useEffect(()=>{const w=$=>{d(),s&&O.regress(),c&&c($)},y=$=>{u&&u($)},A=$=>{i&&i($)};return _.addEventListener("change",w),_.addEventListener("start",y),_.addEventListener("end",A),()=>{_.removeEventListener("start",y),_.removeEventListener("end",A),_.removeEventListener("change",w)}},[c,u,i,_,d,x]),m.useEffect(()=>{if(t){const w=C().controls;return b({controls:_}),()=>b({controls:w})}},[t,_]),m.createElement("primitive",H({ref:v,object:_,enableDamping:a},l))});function Vn(t){const o=t+"Geometry";return m.forwardRef(({args:s,children:e,...a},c)=>m.createElement("mesh",H({ref:c},a),m.createElement(o,{attach:"geometry",args:s}),e))}const Bn=Vn("circle"),q=10,Ln=2,Fn=2,It=10,Wn=10,zt=(t,o,s)=>{const c=new I().subVectors(o,t).normalize().multiplyScalar(s);return new I().addVectors(t,c)},Yn=(t,o,s,e)=>{const a=new I().lerpVectors(t,o,.5),c=new I().subVectors(o,t).normalize(),u=new I(-c.y,c.x,c.z).normalize(),i=(s-e/2)*Wn;return new I().addVectors(a,u.multiplyScalar(i))},to=({links:t,nodes:o,onEdgeClick:s})=>{const e=m.useRef(null),{camera:a}=J(),c=new I,u=new I,i=new I,l=new I,v=new I,d=new I,h=new I,f=new I;Ue(()=>{e.current&&o&&e.current.children.forEach((x,b)=>{var D,M,Y,ee;const C=t[b];if(!C)return;const O=o.find(z=>z.ref_id===C.target),E=o.find(z=>z.ref_id===C.source);c.set((E==null?void 0:E.x)||0,(E==null?void 0:E.y)||0,(E==null?void 0:E.z)||0),u.set((O==null?void 0:O.x)||0,(O==null?void 0:O.y)||0,(O==null?void 0:O.z)||0);const S=x.children[0],_=x.children[1],w=x.children[2],y=x.children[3],A=t.filter(z=>z.source===C.source&&z.target===C.target||z.source===C.target&&z.target===C.source).length,$=t.filter((z,L)=>L<b&&(z.source===C.source&&z.target===C.target||z.source===C.target&&z.target===C.source)).length;if((E==null?void 0:E.ref_id)===(O==null?void 0:O.ref_id)){const[z,L,Z]=Co(c);(D=S.setPoints)==null||D.call(S,c,Z,z),(M=_.setPoints)==null||M.call(_,Z,u,z),w.position.set(Z.x,Z.y,L.z),w.lookAt(z),w.rotateX(-Math.PI/2),y.position.set(Z.x,Z.y,L.z),y.lookAt(a.position)}else{f.copy(zt(c,u,q)),h.copy(zt(u,c,q+.5)),i.lerpVectors(f,h,.5),A>1?i.copy(Yn(f,h,$,A)):i.lerpVectors(f,h,.5);const z=30;l.subVectors(h,f).normalize().multiplyScalar(z/2),v.subVectors(i,l),d.addVectors(i,l);const L=new I().addVectors(f,v).multiplyScalar(.5),Z=new I().addVectors(d,h).multiplyScalar(.5);(Y=S.setPoints)==null||Y.call(S,f,v,L),(ee=_.setPoints)==null||ee.call(_,d,h,Z),w.position.set(h.x,h.y,h.z),w.lookAt(f),w.rotateX(-Math.PI/2),y.position.set(i.x,i.y,i.z),y.lookAt(a.position);let te=Math.atan2(h.y-f.y,h.x-f.x);(te>Math.PI/2||te<-Math.PI/2)&&(te+=Math.PI),y.rotation.set(0,0,te);const re=f.distanceTo(h),Q=re<z?2:4;re<z?y.text=rt(C.edge_type,It):y.text=C.edge_type,y.fontSize=Q}})});const g=(x,b,C,O)=>{if(x==="CHILD_OF"||b==="string"||C==="string")return;const E=o==null?void 0:o.find(y=>y.ref_id===b),S=o==null?void 0:o.find(y=>y.ref_id===C),_=(E==null?void 0:E.type)||"",w=(S==null?void 0:S.type)||"";s(O,x,_,w)};return n.jsx("group",{ref:e,children:t.map(x=>n.jsxs("group",{children:[n.jsx(Nt,{color:"white",end:[0,0,0],lineWidth:1,start:[0,0,0]}),n.jsx(Nt,{color:"white",end:[0,0,0],lineWidth:1,start:[0,0,0]}),n.jsxs("mesh",{position:new I(0,0,0),children:[n.jsx("coneGeometry",{args:[Ln,Fn,32]}),n.jsx("meshBasicMaterial",{color:"white"})]}),n.jsx(Qt,{anchorX:"center",anchorY:"middle",color:"white",...Jt,lineHeight:1,maxWidth:20,onClick:()=>g(x.edge_type,x.source,x.target,x.ref_id),rotation:[0,0,0],textAlign:"center",children:rt(x.edge_type,It)})]},x.ref_id))})};to.displayName="Lines";const Un=["#ff13c9","#5af0ff","#3233ff","#c2f0c2","#ff6666","#99ccff","#ffb3b3"],Gn=B.div`
  color: white;
  background: rgba(0, 0, 0, 1);
  padding: 2px 5px;
  border-radius: 4px;
  word-wrap: break-word;
  text-align: center;
  white-space: nowrap;
  visibility: visible;
  font-size: 12px;
  font-style: normal;
  font-weight: 400;
`,Hn=B(So)`
  position: absolute;
`;new Do(2,2,2);const oo=m.memo(({node:t,setSelectedNode:o,onSimulationUpdate:s,isSelected:e})=>{var b;const a=m.useRef(null),[c,u]=m.useState(!1);console.log(e);const{size:i,camera:l}=J(),v=wo(C=>{if(t.type==="Thing")return;const{xy:[O,E],down:S,dragging:_,first:w,elapsedTime:y}=C;if(!(!_||w||y<100)&&S&&a.current){s();const A=(O-i.left)/window.innerWidth*i.width,$=(E-i.top)/window.innerHeight*i.height,Y=new I(A/i.width*2-1,-$/i.height*2+1,0).unproject(l).multiply(new I(1,1,0)).clone();t.fx=Y.x,t.fy=Y.y}});Ue(()=>{a.current&&a.current.position.set(t.x||0,t.y||0,0)});const d=Un[(b=t==null?void 0:t.children)==null?void 0:b.length]||"red",h=C=>{C.stopPropagation(),t.type!=="Thing"&&o()},f=rt(t.type||"",q),g=()=>{u(!0)},x=()=>{u(!1)};return n.jsxs("mesh",{ref:a,onClick:h,...v(),onPointerOut:x,onPointerOver:g,position:new I(t.x,t.y,0),children:[n.jsx(Bn,{args:[q,30,20],children:n.jsx("meshStandardMaterial",{attach:"material",color:d})}),n.jsx(Qt,{...Jt,clipRect:[-q,-q,q,q],color:"#000",fontSize:2,maxWidth:q*2,name:t.type,textAlign:"left",children:f}),c&&n.jsx(Hn,{position:[0,5,0],zIndexRange:[100,0],children:n.jsx(Gn,{children:t.type})})]})});oo.displayName="Node";const Zn=({simulation:t,setSelectedSchemaId:o,selectedId:s,setIsAddEdgeNode:e})=>{const[a]=qt(u=>[u.schemas]),c=()=>{t&&(t.alpha(.05),t.restart())};return n.jsx(n.Fragment,{children:a.map((u,i)=>{const l=t.nodes()[i];return l?n.jsx(oo,{isSelected:l.ref_id===s,node:l,onSimulationUpdate:c,setSelectedNode:()=>{e(!1),o(l.ref_id)}},l.ref_id):null})})},Xn=({schemasWithPositions:t,filteredLinks:o,setSelectedSchemaId:s,selectedSchemaId:e,setIsAddEdgeNode:a,onEdgeClick:c})=>{const[u,i]=m.useState(null),l=vt(t),v=vt(o);return m.useEffect(()=>{if(!t.length||!o.length)return;const d=structuredClone(t),h=structuredClone(o);if(u){l&&l.length!==t.length&&v&&v.length!==o.length&&(u.nodes(d).force("link",gt(h).id(g=>g.ref_id).distance(100)).force("charge",xt()).force("center",yt()).force("collide",bt(q+5)).alpha(.5).restart(),i({...u}));return}const f=ho(d).force("link",gt(h).id(g=>g.ref_id).distance(120)).force("charge",xt().strength(-100)).force("center",yt()).force("collide",bt(q+5));i(f)},[t,u,o,l,v]),Ue(()=>{}),u?n.jsxs(n.Fragment,{children:[n.jsx(to,{links:o,nodes:u.nodes(),onEdgeClick:c}),n.jsx(Zn,{selectedId:e,setIsAddEdgeNode:a,setSelectedSchemaId:s,simulation:u})]}):null},nt=new Vo(0),Kn=({selectedSchemaId:t,links:o,schemasWithPositions:s,setSelectedSchemaId:e,setIsAddEdgeNode:a,onEdgeClick:c})=>n.jsxs(_o,{camera:{zoom:1,position:[0,0,200]},id:"schema-canvas",linear:!0,orthographic:!0,children:[n.jsx("color",{args:[nt.r,nt.g,nt.b],attach:"background"}),mo&&n.jsx($o,{position:"right-bottom"}),n.jsx(qn,{}),n.jsx(No,{}),n.jsx(Xn,{filteredLinks:o,onEdgeClick:c,schemasWithPositions:s,selectedSchemaId:t,setIsAddEdgeNode:a,setSelectedSchemaId:e})]}),qn=()=>{m.useEffect(()=>{const s=a=>{["Meta","Alt"].includes(a.key)&&(document.body.style.cursor="grab")},e=a=>{["Meta","Alt"].includes(a.key)&&(document.body.style.cursor="default")};return window.addEventListener("keydown",s,!1),window.addEventListener("keyup",e,!1),()=>{window.removeEventListener("keydown",s,!1),window.removeEventListener("keyup",e,!1)}},[]);const t=()=>{document.body.style.cursor="grabbing"},o=()=>{document.body.style.cursor="default"};return n.jsx(Dn,{dampingFactor:1,enableDamping:!0,enablePan:!0,enableRotate:!1,enableZoom:!0,maxZoom:20,minZoom:1,onEnd:o,onStart:t,zoomSpeed:1.5,zoomToCursor:!0})},Qn=({onCreateNew:t,onAddEdgeNode:o})=>n.jsxs(Jn,{children:[n.jsx(es,{children:"BLUEPRINT"}),n.jsxs(kt,{"data-testid":"add-schema-type",onClick:t,children:[n.jsx(Rt,{children:n.jsx(Ct,{})}),n.jsx(X,{children:"Add Type"})]}),n.jsxs(kt,{"data-testid":"add-edge",onClick:o,children:[n.jsx(Rt,{children:n.jsx(Ct,{})}),n.jsx(X,{children:"Add Edge"})]})]}),Jn=B(j).attrs({align:"flex-start",direction:"column",justify:"flex-start"})`
  flex: 1 1 auto;
  z-index: 31;
  transition: opacity 1s;
  background: ${V.BG2};
  max-height: 100vh;
  border-top-left-radius: 9px;
  border-bottom-left-radius: 9px;

  @media (max-width: 1440px) {
    max-height: 95.2vh;
  }

  @media (max-width: 1024px) {
    max-height: 74.8vh;
  }

  @media (max-width: 924px) {
    max-height: 73.1vh;
  }
`,kt=B(j).attrs({align:"center",justify:"center",p:0})`
  position: relative;
  width: 64px;
  height: 58px;
  padding: 0;
  flex-direction: row;
  color: ${V.GRAY6};
  cursor: pointer;
  transition: ${({theme:t})=>t.transitions.create(["opacity","box-shadow","background-color"])};

  &:before {
    content: '';
    position: absolute;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    width: 4px; /* Initial width */
    height: 32px; /* Initial height on hover */
    background-color: transparent;
    transition: height 0.3s, width 0.3s, background-color 0.3s;
  }

  ${X} {
    display: none;
    opacity: 0;
    width: 0;
    padding: 4px 10px;
    border-radius: 4px;
    background: #000;
    box-shadow: 0px 4px 8px 0px rgba(0, 0, 0, 0.25);
    position: absolute;
    left: 90%;
    z-index: 99;
    white-space: nowrap;
    visibility: visible;
    font-size: 11px;
    font-style: normal;
    font-weight: 400;
    transition: ${({theme:t})=>t.transitions.create(["opacity","visually"])};
  }

  &:hover {
    color: ${V.white};

    &:before {
      width: 3px;
      height: 32px;
      background-color: ${V.primaryBlue};
    }

    ${X} {
      display: block;
      width: min-content;
      opacity: 1;
      visibility: visible;
    }
  }

  &:active {
    color: ${V.white};
    background: ${V.black};
    &:before {
      width: 3px;
      height: 100%;
      background-color: ${V.primaryBlue};
    }
  }

  &.root {
    border-radius: 50%;
    padding: 0;
    align-items: center;
    justify-content: center;
    border: none;
  }
`,es=B(j)`
  background: blue;
  align-items: center;
  justify-content: center;
  background: ${V.primaryBlue};
  width: 64px;
  height: 64px;
  cursor: pointer;
  font-size: 10px;
  font-weight: 600;
  color: ${V.white};
`,Rt=B(j)`
  justify-content: center;
  align-items: center;
  font-size: 24px;
`,ts=()=>{const[t,o]=m.useState(""),[s,e]=m.useState(!1),[a,c]=m.useState(!1),[u,i]=m.useState(!1),[l,v]=m.useState({refId:"",edgeType:"",source:"",target:""}),[d,h]=m.useState(!1),[f,g,x,b]=qt(y=>[y.schemas,y.links,y.setSchemas,y.setSchemaLinks]);m.useEffect(()=>{(async()=>{c(!0);try{const A=await wt(),$=A.schemas.filter(D=>D.ref_id&&!D.is_deleted);x($.length>0?$:A.schemas),b(A.edges.length>0?A.edges:[]),c(!1)}catch(A){console.error("Error fetching data:",A),c(!1)}})()},[x,b]);const C=y=>{if(f.some($=>$.ref_id===y.ref_id))x(f.map($=>$.ref_id===y.ref_id?{...y,children:[]}:$));else{x([...f,{...y,children:[]}]);const $=f.find(D=>y.parent===D.type);b([...g,{ref_id:`new-link-${g.length}`,edge_type:"CHILD_OF",source:y.ref_id||"new",target:($==null?void 0:$.ref_id)||"new"}])}},O=async()=>{const y=await wt();x(y.schemas.filter(A=>A.ref_id&&!A.is_deleted&&A.ref_id)),b(y.edges)},E=y=>{x(f.filter(A=>A.type!==y))},S=f.map(y=>({...y,children:f.filter(A=>A.parent===y.type).map(A=>A.ref_id||"")})),_=g.filter(y=>S.some(A=>A.ref_id===y.source)&&S.some(A=>A.ref_id===y.target)),w=f.find(y=>y.ref_id===t)||null;return a?n.jsx(j,{align:"center",basis:"100%",grow:1,justify:"center",shrink:1,children:n.jsx(le,{color:V.white})}):n.jsx(n.Fragment,{children:n.jsxs(j,{align:"stretch",direction:"row",grow:1,children:[n.jsx(j,{ml:-20,my:-20,children:n.jsx(Qn,{onAddEdgeNode:()=>{i(!0),e(!1),o(""),v({refId:"",edgeType:"",source:"",target:""})},onCreateNew:()=>{i(!1),e(!0),o("")}})}),n.jsx(j,{children:w||s?n.jsx(Dt,{children:n.jsx(Vt,{children:n.jsx(Mn,{graphLoading:d,onDelete:E,onSchemaCreate:C,onSchemaUpdate:O,selectedSchema:w,setGraphLoading:h,setIsCreateNew:e,setSelectedSchemaId:o})})}):null}),n.jsx(j,{children:u?n.jsx(Dt,{children:n.jsx(Vt,{children:n.jsx(bn,{edgeData:l,setGraphLoading:h,setIsAddEdgeNode:i})})}):null}),n.jsx(os,{direction:"row",grow:1,children:n.jsx(ns,{children:d?n.jsx(j,{align:"center",basis:"100%",grow:1,justify:"center",shrink:1,children:n.jsx(le,{color:V.white})}):n.jsx(Kn,{links:_,onEdgeClick:(y,A,$,D)=>{v({refId:y,edgeType:A,source:$,target:D}),i(!0),e(!1),o("")},schemasWithPositions:S,selectedSchemaId:t,setIsAddEdgeNode:i,setSelectedSchemaId:o})})})]})})},os=B(j)`
  flex: 1 1 auto;
  justify-content: center;
  position: relative;
  overflow: hidden;
  max-height: calc(100vh - 20px);

  @media (max-width: 1440px) {
    max-height: calc(95vh - 20px);
  }

  @media (max-width: 1024px) {
    max-height: calc(70vh - 20px);
  }

  @media (max-width: 924px) {
    max-height: calc(70vh - 20px);
  }
`,Dt=B(j)`
  width: 100%;
  max-width: 400px;
  background: ${V.BG1};
  border-top-right-radius: 16px;
  border-bottom-right-radius: 16px;
  flex-grow: 1;
  flex-shrink: 1;
  min-width: 300px;
  overflow: hidden;
  max-height: calc(100vh - 20px);

  @media (max-width: 1440px) {
    max-height: calc(95vh - 20px);
  }

  @media (max-width: 1024px) {
    max-height: calc(70vh - 20px);
  }

  @media (max-width: 924px) {
    max-height: calc(70vh - 20px);
  }
`,Vt=B.div`
  height: 100%;
  overflow-y: auto;
  padding: 16px;
`,ns=B(j)`
  flex: 1 1 100%;
`,ss=()=>{const{close:t}=Ht("blueprintGraph"),o=()=>{t()};return n.jsx(go,{background:"black",id:"blueprintGraph",kind:"full",onClose:o,preventOutsideClose:!0,children:n.jsx(ts,{})})},As=m.memo(ss);export{As as BlueprintModal};
