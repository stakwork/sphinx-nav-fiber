import{g as De,a as Ae,s as ne,_ as I,a9 as Bt,r as y,b as Re,j as s,d as Le,c as oe,e as _e,u as yt,aM as Ft,b4 as we,b5 as Ie,a7 as st,b6 as Vt,b7 as Yt,a0 as Ut,f as G,F as C,h as B,D as Me,a_ as Gt,T as ee,B as wt,N as ye,aY as $e,a$ as Wt,b8 as Ht,b9 as Zt,ba as Kt,Z as $,bb as re,bc as ie,ap as rt,bd as ge,be,bf as it,bg as H,bh as Xt,ar as qt,bi as at,bj as ct,bk as lt,bl as dt,bm as Qt,am as Jt,W as eo,bn as to}from"./index-2dce50d4.js";import{B as oo}from"./index-92200820.js";import{q as no,r as so,i as ro,C as ze,I as io,B as Be,c as ao,b as co,F as lo,s as uo}from"./react-toastify.esm-253bd08d.js";import{e as po,A as Ne}from"./index-3d261195.js";import{T as Se}from"./index-8ff7815d.js";import{c as ut,d as fo}from"./index-539c32be.js";import{D as ho,P as mo}from"./PlusIcon-cc9ec062.js";import{p as go,c as bo}from"./index-30d16895.js";import{u as xo}from"./Popover-25b001e1.js";import{u as yo}from"./index-d5f83200.js";import{L as wo,m as vo,u as Q,b as ve,T as jo,C as Eo}from"./constant-df620f09.js";import{f as ko,P as Po,L as Co}from"./constants-be464bc9.js";import{A as To}from"./AddContentIcon-d4f26337.js";import"./useSlotProps-74b4f075.js";import"./Popper-fb1309ee.js";import"./index.esm-5aaa9399.js";import"./InfoIcon-f5c81c07.js";import"./generateCategoricalChart-98dfa31e.js";import"./NoFilterResultIcon-14e36506.js";import"./index-d8e30e63.js";import"./index-291916bc.js";import"./CheckIcon-0bad8468.js";function Oo(t){return De("PrivateSwitchBase",t)}Ae("PrivateSwitchBase",["root","checked","disabled","input","edgeStart","edgeEnd"]);const Mo=["autoFocus","checked","checkedIcon","className","defaultChecked","disabled","disableFocusRipple","edge","icon","id","inputProps","inputRef","name","onBlur","onChange","onFocus","readOnly","required","tabIndex","type","value"],$o=t=>{const{classes:o,checked:i,disabled:e,edge:a}=t,c={root:["root",i&&"checked",e&&"disabled",a&&`edge${oe(a)}`],input:["input"]};return _e(c,Oo,o)},No=ne(no)(({ownerState:t})=>I({padding:9,borderRadius:"50%"},t.edge==="start"&&{marginLeft:t.size==="small"?-3:-12},t.edge==="end"&&{marginRight:t.size==="small"?-3:-12})),So=ne("input",{shouldForwardProp:Bt})({cursor:"inherit",position:"absolute",opacity:0,width:"100%",height:"100%",top:0,left:0,margin:0,padding:0,zIndex:1}),Do=y.forwardRef(function(o,i){const{autoFocus:e,checked:a,checkedIcon:c,className:p,defaultChecked:r,disabled:u,disableFocusRipple:g=!1,edge:l=!1,icon:f,id:m,inputProps:E,inputRef:P,name:h,onBlur:v,onChange:w,onFocus:N,readOnly:z,required:O=!1,tabIndex:k,type:S,value:A}=o,D=Re(o,Mo),[W,j]=yo({controlled:a,default:!!r,name:"SwitchBase",state:"checked"}),F=xo(),M=Y=>{N&&N(Y),F&&F.onFocus&&F.onFocus(Y)},R=Y=>{v&&v(Y),F&&F.onBlur&&F.onBlur(Y)},U=Y=>{if(Y.nativeEvent.defaultPrevented)return;const ce=Y.target.checked;j(ce),w&&w(Y,ce)};let L=u;F&&typeof L>"u"&&(L=F.disabled);const fe=S==="checkbox"||S==="radio",se=I({},o,{checked:W,disabled:L,disableFocusRipple:g,edge:l}),Z=$o(se);return s.jsxs(No,I({component:"span",className:Le(Z.root,p),centerRipple:!0,focusRipple:!g,disabled:L,tabIndex:null,role:void 0,onFocus:M,onBlur:R,ownerState:se,ref:i},D,{children:[s.jsx(So,I({autoFocus:e,checked:a,defaultChecked:r,className:Z.input,disabled:L,id:fe?m:void 0,name:h,onChange:U,readOnly:z,ref:P,required:O,ownerState:se,tabIndex:k,type:S},S==="checkbox"&&A===void 0?{}:{value:A},E)),W?c:f]}))}),Ao=Do,Ro=y.createContext(),pt=Ro;function Lo(t){return De("MuiGrid",t)}const _o=[0,1,2,3,4,5,6,7,8,9,10],Io=["column-reverse","column","row-reverse","row"],zo=["nowrap","wrap-reverse","wrap"],ue=["auto",!0,1,2,3,4,5,6,7,8,9,10,11,12],Bo=Ae("MuiGrid",["root","container","item","zeroMinWidth",..._o.map(t=>`spacing-xs-${t}`),...Io.map(t=>`direction-xs-${t}`),...zo.map(t=>`wrap-xs-${t}`),...ue.map(t=>`grid-xs-${t}`),...ue.map(t=>`grid-sm-${t}`),...ue.map(t=>`grid-md-${t}`),...ue.map(t=>`grid-lg-${t}`),...ue.map(t=>`grid-xl-${t}`)]),pe=Bo,Fo=["className","columns","columnSpacing","component","container","direction","item","rowSpacing","spacing","wrap","zeroMinWidth"];function ae(t){const o=parseFloat(t);return`${o}${String(t).replace(String(o),"")||"px"}`}function Vo({theme:t,ownerState:o}){let i;return t.breakpoints.keys.reduce((e,a)=>{let c={};if(o[a]&&(i=o[a]),!i)return e;if(i===!0)c={flexBasis:0,flexGrow:1,maxWidth:"100%"};else if(i==="auto")c={flexBasis:"auto",flexGrow:0,flexShrink:0,maxWidth:"none",width:"auto"};else{const p=we({values:o.columns,breakpoints:t.breakpoints.values}),r=typeof p=="object"?p[a]:p;if(r==null)return e;const u=`${Math.round(i/r*1e8)/1e6}%`;let g={};if(o.container&&o.item&&o.columnSpacing!==0){const l=t.spacing(o.columnSpacing);if(l!=="0px"){const f=`calc(${u} + ${ae(l)})`;g={flexBasis:f,maxWidth:f}}}c=I({flexBasis:u,flexGrow:0,maxWidth:u},g)}return t.breakpoints.values[a]===0?Object.assign(e,c):e[t.breakpoints.up(a)]=c,e},{})}function Yo({theme:t,ownerState:o}){const i=we({values:o.direction,breakpoints:t.breakpoints.values});return Ie({theme:t},i,e=>{const a={flexDirection:e};return e.indexOf("column")===0&&(a[`& > .${pe.item}`]={maxWidth:"none"}),a})}function vt({breakpoints:t,values:o}){let i="";Object.keys(o).forEach(a=>{i===""&&o[a]!==0&&(i=a)});const e=Object.keys(t).sort((a,c)=>t[a]-t[c]);return e.slice(0,e.indexOf(i))}function Uo({theme:t,ownerState:o}){const{container:i,rowSpacing:e}=o;let a={};if(i&&e!==0){const c=we({values:e,breakpoints:t.breakpoints.values});let p;typeof c=="object"&&(p=vt({breakpoints:t.breakpoints.values,values:c})),a=Ie({theme:t},c,(r,u)=>{var g;const l=t.spacing(r);return l!=="0px"?{marginTop:`-${ae(l)}`,[`& > .${pe.item}`]:{paddingTop:ae(l)}}:(g=p)!=null&&g.includes(u)?{}:{marginTop:0,[`& > .${pe.item}`]:{paddingTop:0}}})}return a}function Go({theme:t,ownerState:o}){const{container:i,columnSpacing:e}=o;let a={};if(i&&e!==0){const c=we({values:e,breakpoints:t.breakpoints.values});let p;typeof c=="object"&&(p=vt({breakpoints:t.breakpoints.values,values:c})),a=Ie({theme:t},c,(r,u)=>{var g;const l=t.spacing(r);return l!=="0px"?{width:`calc(100% + ${ae(l)})`,marginLeft:`-${ae(l)}`,[`& > .${pe.item}`]:{paddingLeft:ae(l)}}:(g=p)!=null&&g.includes(u)?{}:{width:"100%",marginLeft:0,[`& > .${pe.item}`]:{paddingLeft:0}}})}return a}function Wo(t,o,i={}){if(!t||t<=0)return[];if(typeof t=="string"&&!Number.isNaN(Number(t))||typeof t=="number")return[i[`spacing-xs-${String(t)}`]];const e=[];return o.forEach(a=>{const c=t[a];Number(c)>0&&e.push(i[`spacing-${a}-${String(c)}`])}),e}const Ho=ne("div",{name:"MuiGrid",slot:"Root",overridesResolver:(t,o)=>{const{ownerState:i}=t,{container:e,direction:a,item:c,spacing:p,wrap:r,zeroMinWidth:u,breakpoints:g}=i;let l=[];e&&(l=Wo(p,g,o));const f=[];return g.forEach(m=>{const E=i[m];E&&f.push(o[`grid-${m}-${String(E)}`])}),[o.root,e&&o.container,c&&o.item,u&&o.zeroMinWidth,...l,a!=="row"&&o[`direction-xs-${String(a)}`],r!=="wrap"&&o[`wrap-xs-${String(r)}`],...f]}})(({ownerState:t})=>I({boxSizing:"border-box"},t.container&&{display:"flex",flexWrap:"wrap",width:"100%"},t.item&&{margin:0},t.zeroMinWidth&&{minWidth:0},t.wrap!=="wrap"&&{flexWrap:t.wrap}),Yo,Uo,Go,Vo);function Zo(t,o){if(!t||t<=0)return[];if(typeof t=="string"&&!Number.isNaN(Number(t))||typeof t=="number")return[`spacing-xs-${String(t)}`];const i=[];return o.forEach(e=>{const a=t[e];if(Number(a)>0){const c=`spacing-${e}-${String(a)}`;i.push(c)}}),i}const Ko=t=>{const{classes:o,container:i,direction:e,item:a,spacing:c,wrap:p,zeroMinWidth:r,breakpoints:u}=t;let g=[];i&&(g=Zo(c,u));const l=[];u.forEach(m=>{const E=t[m];E&&l.push(`grid-${m}-${String(E)}`)});const f={root:["root",i&&"container",a&&"item",r&&"zeroMinWidth",...g,e!=="row"&&`direction-xs-${String(e)}`,p!=="wrap"&&`wrap-xs-${String(p)}`,...l]};return _e(f,Lo,o)},Xo=y.forwardRef(function(o,i){const e=yt({props:o,name:"MuiGrid"}),{breakpoints:a}=Ft(),c=po(e),{className:p,columns:r,columnSpacing:u,component:g="div",container:l=!1,direction:f="row",item:m=!1,rowSpacing:E,spacing:P=0,wrap:h="wrap",zeroMinWidth:v=!1}=c,w=Re(c,Fo),N=E||P,z=u||P,O=y.useContext(pt),k=l?r||12:O,S={},A=I({},w);a.keys.forEach(j=>{w[j]!=null&&(S[j]=w[j],delete A[j])});const D=I({},c,{columns:k,container:l,direction:f,item:m,rowSpacing:N,columnSpacing:z,wrap:h,zeroMinWidth:v,spacing:P},S,{breakpoints:a.keys}),W=Ko(D);return s.jsx(pt.Provider,{value:k,children:s.jsx(Ho,I({ownerState:D,className:Le(W.root,p),as:g,ref:i},A))})}),te=Xo;function qo(t){return De("MuiSwitch",t)}const Qo=Ae("MuiSwitch",["root","edgeStart","edgeEnd","switchBase","colorPrimary","colorSecondary","sizeSmall","sizeMedium","checked","disabled","input","thumb","track"]),V=Qo,Jo=["className","color","edge","size","sx"],en=t=>{const{classes:o,edge:i,size:e,color:a,checked:c,disabled:p}=t,r={root:["root",i&&`edge${oe(i)}`,`size${oe(e)}`],switchBase:["switchBase",`color${oe(a)}`,c&&"checked",p&&"disabled"],thumb:["thumb"],track:["track"],input:["input"]},u=_e(r,qo,o);return I({},o,u)},tn=ne("span",{name:"MuiSwitch",slot:"Root",overridesResolver:(t,o)=>{const{ownerState:i}=t;return[o.root,i.edge&&o[`edge${oe(i.edge)}`],o[`size${oe(i.size)}`]]}})(({ownerState:t})=>I({display:"inline-flex",width:34+12*2,height:14+12*2,overflow:"hidden",padding:12,boxSizing:"border-box",position:"relative",flexShrink:0,zIndex:0,verticalAlign:"middle","@media print":{colorAdjust:"exact"}},t.edge==="start"&&{marginLeft:-8},t.edge==="end"&&{marginRight:-8},t.size==="small"&&{width:40,height:24,padding:7,[`& .${V.thumb}`]:{width:16,height:16},[`& .${V.switchBase}`]:{padding:4,[`&.${V.checked}`]:{transform:"translateX(16px)"}}})),on=ne(Ao,{name:"MuiSwitch",slot:"SwitchBase",overridesResolver:(t,o)=>{const{ownerState:i}=t;return[o.switchBase,{[`& .${V.input}`]:o.input},i.color!=="default"&&o[`color${oe(i.color)}`]]}})(({theme:t})=>({position:"absolute",top:0,left:0,zIndex:1,color:t.vars?t.vars.palette.Switch.defaultColor:`${t.palette.mode==="light"?t.palette.common.white:t.palette.grey[300]}`,transition:t.transitions.create(["left","transform"],{duration:t.transitions.duration.shortest}),[`&.${V.checked}`]:{transform:"translateX(20px)"},[`&.${V.disabled}`]:{color:t.vars?t.vars.palette.Switch.defaultDisabledColor:`${t.palette.mode==="light"?t.palette.grey[100]:t.palette.grey[600]}`},[`&.${V.checked} + .${V.track}`]:{opacity:.5},[`&.${V.disabled} + .${V.track}`]:{opacity:t.vars?t.vars.opacity.switchTrackDisabled:`${t.palette.mode==="light"?.12:.2}`},[`& .${V.input}`]:{left:"-100%",width:"300%"}}),({theme:t,ownerState:o})=>I({"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette.action.activeChannel} / ${t.vars.palette.action.hoverOpacity})`:st(t.palette.action.active,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},o.color!=="default"&&{[`&.${V.checked}`]:{color:(t.vars||t).palette[o.color].main,"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette[o.color].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:st(t.palette[o.color].main,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${V.disabled}`]:{color:t.vars?t.vars.palette.Switch[`${o.color}DisabledColor`]:`${t.palette.mode==="light"?Vt(t.palette[o.color].main,.62):Yt(t.palette[o.color].main,.55)}`}},[`&.${V.checked} + .${V.track}`]:{backgroundColor:(t.vars||t).palette[o.color].main}})),nn=ne("span",{name:"MuiSwitch",slot:"Track",overridesResolver:(t,o)=>o.track})(({theme:t})=>({height:"100%",width:"100%",borderRadius:14/2,zIndex:-1,transition:t.transitions.create(["opacity","background-color"],{duration:t.transitions.duration.shortest}),backgroundColor:t.vars?t.vars.palette.common.onBackground:`${t.palette.mode==="light"?t.palette.common.black:t.palette.common.white}`,opacity:t.vars?t.vars.opacity.switchTrack:`${t.palette.mode==="light"?.38:.3}`})),sn=ne("span",{name:"MuiSwitch",slot:"Thumb",overridesResolver:(t,o)=>o.thumb})(({theme:t})=>({boxShadow:(t.vars||t).shadows[1],backgroundColor:"currentColor",width:20,height:20,borderRadius:"50%"})),rn=y.forwardRef(function(o,i){const e=yt({props:o,name:"MuiSwitch"}),{className:a,color:c="primary",edge:p=!1,size:r="medium",sx:u}=e,g=Re(e,Jo),l=I({},e,{color:c,edge:p,size:r}),f=en(l),m=s.jsx(sn,{className:f.thumb,ownerState:l});return s.jsxs(tn,{className:Le(f.root,a),sx:u,ownerState:l,children:[s.jsx(on,I({type:"checkbox",icon:m,checkedIcon:m,ref:i,ownerState:l},g,{classes:I({},f,{root:f.switchBase})})),s.jsx(nn,{className:f.track,ownerState:l})]})}),an=rn,cn={schemas:[],links:[]},jt=Ut(t=>({...cn,setSchemas:o=>{t({schemas:o})},setSchemaLinks:o=>{t({links:o})}})),ln=/^[a-z0-9_]+$/,dn=({parentParam:t})=>{const[o,i]=y.useState(!1),[e,a]=y.useState([]),{fields:c,append:p,replace:r,remove:u}=so({name:"attributes"}),{setValue:g,watch:l}=ro();return y.useEffect(()=>{const f=async()=>{try{let m=[{required:!1,type:"string",key:""}];if(t!==fo.value.toLowerCase()){i(!0);const E=await Gt(t);m=go(E)}r(m),a(m)}catch(m){console.warn(m)}finally{i(!1)}};e.length===0&&f()},[t,g,r,e.length]),s.jsxs(s.Fragment,{children:[o?s.jsx(C,{align:"center",children:s.jsx(ze,{color:B.SECONDARY_BLUE,size:"30"})}):s.jsx(un,{py:8,children:s.jsx(te,{container:!0,spacing:2,children:c.map((f,m)=>{const E=l(`attributes[${m}].type`),P=l(`attributes[${m}].required`),h=f.isNew||!1,v=["name"].includes(l(`attributes[${m}].key`));return s.jsxs(y.Fragment,{children:[s.jsx(te,{item:!0,xs:5,children:s.jsx(Se,{autoComplete:"off",className:"text-input",disabled:!h,id:"cy-item-name",maxLength:50,name:`attributes.${m}.key`,placeholder:"Enter value",rules:{...Me,pattern:{message:"Please avoid special characters, spaces and uppercase",value:ln}}})}),s.jsx(te,{item:!0,xs:4,children:s.jsx(Ne,{disabled:v,onSelect:w=>g(`attributes[${m}].type`,w==null?void 0:w.value),options:ut,selectedValue:ut.find(w=>w.value===E)})}),s.jsxs(te,{item:!0,xs:3,children:[s.jsx(an,{checked:P,disabled:v,name:`attributes.${m}.required`,onChange:w=>g(`attributes[${m}].required`,w.target.checked),size:"small"}),!v&&s.jsx(io,{onClick:()=>u(m),children:s.jsx(ho,{})})]})]},f.id)})})}),s.jsx(C,{align:"flex-start",py:12,children:s.jsx(Be,{onClick:()=>p({key:"",type:"string",required:!0,isNew:!0}),size:"medium",startIcon:s.jsx(mo,{}),variant:"contained",children:"Add Attribute"})})]})},un=G(C)`
  overflow-y: auto;
  width: calc(100% + 20px);
  max-height: calc(80vh - 300px);
`,pn=({parent:t})=>{const o=t;return s.jsxs(C,{children:[s.jsx(C,{direction:"row",mb:10,children:s.jsxs(te,{container:!0,spacing:2,children:[s.jsx(te,{item:!0,xs:5,children:s.jsx(Te,{style:{marginRight:180},children:"Attributes"})}),s.jsx(te,{item:!0,xs:4,children:s.jsx(Te,{style:{marginRight:130},children:"Type"})}),s.jsx(te,{item:!0,xs:3,children:s.jsx(Te,{children:"Required"})})]})}),o&&s.jsx(dn,{parentParam:o},o)]})},Te=G(ee)`
  font-size: 15px;
  color: gray;
`,ft={type:"",parent:""},fn=async(t,o=!1)=>{try{const{attributes:i,...e}=t,a={...e,attributes:bo(i)};let c;if(o?c=await ye.put("/schema",JSON.stringify(a),{}):c=await ye.post("/schema",JSON.stringify({...a,node_key:"name"}),{}),c.status!=="success")throw new Error("error");return c==null?void 0:c.ref_id}catch(i){let e=$e;if(i.status===400){const a=await i.json();e=a.errorCode||(a==null?void 0:a.status)||$e}else i instanceof Error&&(e=i.message);throw new Error(e)}},hn=({onSchemaCreate:t,selectedSchema:o,onDelete:i,setSelectedSchemaId:e,setIsCreateNew:a})=>{const{close:c,visible:p}=wt("addType"),r=ao({mode:"onChange",defaultValues:o?{type:o.type,parent:o.parent}:ft}),{watch:u,setValue:g,reset:l}=r,[f,m]=y.useState(!1),[E,P]=y.useState(!1),[h,v]=y.useState(null),[w,N]=y.useState(!1),[z,O]=y.useState(null);y.useEffect(()=>()=>{l()},[p,l]);const k=()=>{a(!1),e("")},S=M=>M.charAt(0).toUpperCase()+M.slice(1);y.useEffect(()=>{o||(async()=>{P(!0);try{const U=(await Wt()).schemas.filter(L=>!L.is_deleted&&L.type).map(L=>(L==null?void 0:L.type)==="thing"?{label:"No Parent",value:L.type}:{label:S(L.type),value:L.type});v(U)}catch(R){console.warn(R)}finally{P(!1)}})()},[o]),y.useEffect(()=>{if(o){g("type",o==null?void 0:o.type),g("parent",o.parent);const M=[{label:o.parent?S(o.parent):"No Parent",value:o.parent}];O(M)}else l(ft)},[o,g,l]);const A=u("parent"),D=()=>{c()},W=async()=>{if(o!=null&&o.type)try{await ye.delete(`/schema/${o.ref_id}`),i(o.type),c()}catch(M){console.warn(M)}finally{a(!1)}},j=r.handleSubmit(async M=>{if(!A){N(!0);return}m(!1);try{M.type!==(o==null?void 0:o.type)&&await ye.put(`/schema/${o==null?void 0:o.ref_id}`,JSON.stringify({type:M.type}));const R=await fn({...M,...o?{ref_id:o==null?void 0:o.ref_id}:{}},!!o);t({type:M.type,parent:A||"",ref_id:(o==null?void 0:o.ref_id)||R||"new"}),D()}catch(R){if((R==null?void 0:R.status)===400){const U=await R.json();U.errorCode||U!=null&&U.status||$e}else R instanceof Error&&R.message}finally{m(!1),a(!1)}}),F=()=>h==null?void 0:h.find(M=>M.value===A);return s.jsxs(C,{children:[s.jsx(C,{direction:"row",justify:"flex-end",children:s.jsx(gn,{"data-testid":"close-sidebar-sub-view",onClick:k,children:s.jsx(co,{})})}),s.jsx(C,{children:s.jsx(lo,{...r,children:s.jsxs("form",{id:"add-type-form",onSubmit:j,children:[s.jsx(C,{children:o?s.jsxs(s.Fragment,{children:[s.jsxs(C,{mb:12,children:[s.jsx(C,{mb:12,children:s.jsx(ee,{children:"Name"})}),s.jsx(C,{mb:12,children:s.jsx(Se,{defaultValue:o==null?void 0:o.type,id:"cy-item-name",maxLength:250,name:"type",placeholder:"Enter type name",rules:{...Me},value:A})})]}),s.jsxs(C,{mb:12,children:[s.jsx(C,{mb:12,children:s.jsx(ee,{children:"Parent"})}),s.jsx(Ne,{isLoading:E,onSelect:M=>{g("parent",(M==null?void 0:M.value)||""),N(!1)},options:z||[],selectedValue:h==null?void 0:h.find(M=>M.label===(o==null?void 0:o.parent))}),w&&s.jsx(ht,{children:"A parent type must be selected"})]})]}):s.jsxs(s.Fragment,{children:[s.jsxs(C,{mb:12,children:[s.jsx(C,{mb:12,children:s.jsx(ee,{children:"Select Parent"})}),s.jsx(Ne,{isLoading:E,onSelect:M=>{g("parent",(M==null?void 0:M.value)||""),N(!1)},options:h,selectedValue:F()}),w&&s.jsx(ht,{children:"A parent type must be selected"})]}),s.jsxs(C,{children:[s.jsx(C,{mb:12,children:s.jsx(ee,{children:"Type name"})}),s.jsx(C,{mb:12,children:s.jsx(Se,{id:"cy-item-name",maxLength:250,name:"type",placeholder:"Enter type name",rules:{...Me},value:A})})]})]})}),s.jsx(pn,{parent:o?o.type:A}),s.jsxs(C,{direction:"row",justify:"space-between",mt:20,children:[o?s.jsx(mn,{color:"secondary",onClick:W,size:"large",style:{marginRight:20},variant:"contained",children:"Delete"}):null,s.jsx(Be,{color:"secondary",disabled:f||w,onClick:j,size:"large",startIcon:f?s.jsx(ze,{color:B.white,size:24}):null,variant:"contained",children:"Save"})]})]})})})]})},mn=G(Be)`
  && {
    color: ${B.primaryRed};
    background-color: rgba(237, 116, 116, 0.1);

    &:hover,
    &:active,
    &:focus {
      color: ${B.primaryRed};
      background-color: rgba(237, 116, 116, 0.2);
    }
  }
`,gn=G(C)`
  font-size: 32px;
  color: ${B.white};
  cursor: pointer;
`,ht=G(C)`
  font-size: 13px;
  font-family: Barlow;
  color: #ff8f80;
  line-height: 0.2px;
  margin-top: 12px;
`;var bn=Object.defineProperty,xn=(t,o,i)=>o in t?bn(t,o,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[o]=i,b=(t,o,i)=>(xn(t,typeof o!="symbol"?o+"":o,i),i);const xe=new Ht,mt=new Zt,yn=Math.cos(70*(Math.PI/180)),gt=(t,o)=>(t%o+o)%o;let wn=class extends Kt{constructor(o,i){super(),b(this,"object"),b(this,"domElement"),b(this,"enabled",!0),b(this,"target",new $),b(this,"minDistance",0),b(this,"maxDistance",1/0),b(this,"minZoom",0),b(this,"maxZoom",1/0),b(this,"minPolarAngle",0),b(this,"maxPolarAngle",Math.PI),b(this,"minAzimuthAngle",-1/0),b(this,"maxAzimuthAngle",1/0),b(this,"enableDamping",!1),b(this,"dampingFactor",.05),b(this,"enableZoom",!0),b(this,"zoomSpeed",1),b(this,"enableRotate",!0),b(this,"rotateSpeed",1),b(this,"enablePan",!0),b(this,"panSpeed",1),b(this,"screenSpacePanning",!0),b(this,"keyPanSpeed",7),b(this,"zoomToCursor",!1),b(this,"autoRotate",!1),b(this,"autoRotateSpeed",2),b(this,"reverseOrbit",!1),b(this,"reverseHorizontalOrbit",!1),b(this,"reverseVerticalOrbit",!1),b(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),b(this,"mouseButtons",{LEFT:re.ROTATE,MIDDLE:re.DOLLY,RIGHT:re.PAN}),b(this,"touches",{ONE:ie.ROTATE,TWO:ie.DOLLY_PAN}),b(this,"target0"),b(this,"position0"),b(this,"zoom0"),b(this,"_domElementKeyEvents",null),b(this,"getPolarAngle"),b(this,"getAzimuthalAngle"),b(this,"setPolarAngle"),b(this,"setAzimuthalAngle"),b(this,"getDistance"),b(this,"listenToKeyEvents"),b(this,"stopListenToKeyEvents"),b(this,"saveState"),b(this,"reset"),b(this,"update"),b(this,"connect"),b(this,"dispose"),this.object=o,this.domElement=i,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>l.phi,this.getAzimuthalAngle=()=>l.theta,this.setPolarAngle=n=>{let d=gt(n,2*Math.PI),x=l.phi;x<0&&(x+=2*Math.PI),d<0&&(d+=2*Math.PI);let T=Math.abs(d-x);2*Math.PI-T<T&&(d<x?d+=2*Math.PI:x+=2*Math.PI),f.phi=d-x,e.update()},this.setAzimuthalAngle=n=>{let d=gt(n,2*Math.PI),x=l.theta;x<0&&(x+=2*Math.PI),d<0&&(d+=2*Math.PI);let T=Math.abs(d-x);2*Math.PI-T<T&&(d<x?d+=2*Math.PI:x+=2*Math.PI),f.theta=d-x,e.update()},this.getDistance=()=>e.object.position.distanceTo(e.target),this.listenToKeyEvents=n=>{n.addEventListener("keydown",Pe),this._domElementKeyEvents=n},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",Pe),this._domElementKeyEvents=null},this.saveState=()=>{e.target0.copy(e.target),e.position0.copy(e.object.position),e.zoom0=e.object.zoom},this.reset=()=>{e.target.copy(e.target0),e.object.position.copy(e.position0),e.object.zoom=e.zoom0,e.object.updateProjectionMatrix(),e.dispatchEvent(a),e.update(),u=r.NONE},this.update=(()=>{const n=new $,d=new $(0,1,0),x=new rt().setFromUnitVectors(o.up,d),T=x.clone().invert(),_=new $,K=new rt,J=2*Math.PI;return function(){const nt=e.object.position;x.setFromUnitVectors(o.up,d),T.copy(x).invert(),n.copy(nt).sub(e.target),n.applyQuaternion(x),l.setFromVector3(n),e.autoRotate&&u===r.NONE&&U(M()),e.enableDamping?(l.theta+=f.theta*e.dampingFactor,l.phi+=f.phi*e.dampingFactor):(l.theta+=f.theta,l.phi+=f.phi);let X=e.minAzimuthAngle,q=e.maxAzimuthAngle;isFinite(X)&&isFinite(q)&&(X<-Math.PI?X+=J:X>Math.PI&&(X-=J),q<-Math.PI?q+=J:q>Math.PI&&(q-=J),X<=q?l.theta=Math.max(X,Math.min(q,l.theta)):l.theta=l.theta>(X+q)/2?Math.max(X,l.theta):Math.min(q,l.theta)),l.phi=Math.max(e.minPolarAngle,Math.min(e.maxPolarAngle,l.phi)),l.makeSafe(),e.enableDamping===!0?e.target.addScaledVector(E,e.dampingFactor):e.target.add(E),e.zoomToCursor&&W||e.object.isOrthographicCamera?l.radius=je(l.radius):l.radius=je(l.radius*m),n.setFromSpherical(l),n.applyQuaternion(T),nt.copy(e.target).add(n),e.object.matrixAutoUpdate||e.object.updateMatrix(),e.object.lookAt(e.target),e.enableDamping===!0?(f.theta*=1-e.dampingFactor,f.phi*=1-e.dampingFactor,E.multiplyScalar(1-e.dampingFactor)):(f.set(0,0,0),E.set(0,0,0));let he=!1;if(e.zoomToCursor&&W){let le=null;if(e.object instanceof ge&&e.object.isPerspectiveCamera){const de=n.length();le=je(de*m);const me=de-le;e.object.position.addScaledVector(A,me),e.object.updateMatrixWorld()}else if(e.object.isOrthographicCamera){const de=new $(D.x,D.y,0);de.unproject(e.object),e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/m)),e.object.updateProjectionMatrix(),he=!0;const me=new $(D.x,D.y,0);me.unproject(e.object),e.object.position.sub(me).add(de),e.object.updateMatrixWorld(),le=n.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),e.zoomToCursor=!1;le!==null&&(e.screenSpacePanning?e.target.set(0,0,-1).transformDirection(e.object.matrix).multiplyScalar(le).add(e.object.position):(xe.origin.copy(e.object.position),xe.direction.set(0,0,-1).transformDirection(e.object.matrix),Math.abs(e.object.up.dot(xe.direction))<yn?o.lookAt(e.target):(mt.setFromNormalAndCoplanarPoint(e.object.up,e.target),xe.intersectPlane(mt,e.target))))}else e.object instanceof be&&e.object.isOrthographicCamera&&(e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/m)),e.object.updateProjectionMatrix(),he=!0);return m=1,W=!1,he||_.distanceToSquared(e.object.position)>g||8*(1-K.dot(e.object.quaternion))>g?(e.dispatchEvent(a),_.copy(e.object.position),K.copy(e.object.quaternion),he=!1,!0):!1}})(),this.connect=n=>{n===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),e.domElement=n,e.domElement.style.touchAction="none",e.domElement.addEventListener("contextmenu",et),e.domElement.addEventListener("pointerdown",qe),e.domElement.addEventListener("pointercancel",Qe),e.domElement.addEventListener("wheel",Je)},this.dispose=()=>{var n,d,x,T,_,K;(n=e.domElement)==null||n.removeEventListener("contextmenu",et),(d=e.domElement)==null||d.removeEventListener("pointerdown",qe),(x=e.domElement)==null||x.removeEventListener("pointercancel",Qe),(T=e.domElement)==null||T.removeEventListener("wheel",Je),(_=e.domElement)==null||_.ownerDocument.removeEventListener("pointermove",Ee),(K=e.domElement)==null||K.ownerDocument.removeEventListener("pointerup",ke),e._domElementKeyEvents!==null&&e._domElementKeyEvents.removeEventListener("keydown",Pe)};const e=this,a={type:"change"},c={type:"start"},p={type:"end"},r={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let u=r.NONE;const g=1e-6,l=new it,f=new it;let m=1;const E=new $,P=new H,h=new H,v=new H,w=new H,N=new H,z=new H,O=new H,k=new H,S=new H,A=new $,D=new H;let W=!1;const j=[],F={};function M(){return 2*Math.PI/60/60*e.autoRotateSpeed}function R(){return Math.pow(.95,e.zoomSpeed)}function U(n){e.reverseOrbit||e.reverseHorizontalOrbit?f.theta+=n:f.theta-=n}function L(n){e.reverseOrbit||e.reverseVerticalOrbit?f.phi+=n:f.phi-=n}const fe=(()=>{const n=new $;return function(x,T){n.setFromMatrixColumn(T,0),n.multiplyScalar(-x),E.add(n)}})(),se=(()=>{const n=new $;return function(x,T){e.screenSpacePanning===!0?n.setFromMatrixColumn(T,1):(n.setFromMatrixColumn(T,0),n.crossVectors(e.object.up,n)),n.multiplyScalar(x),E.add(n)}})(),Z=(()=>{const n=new $;return function(x,T){const _=e.domElement;if(_&&e.object instanceof ge&&e.object.isPerspectiveCamera){const K=e.object.position;n.copy(K).sub(e.target);let J=n.length();J*=Math.tan(e.object.fov/2*Math.PI/180),fe(2*x*J/_.clientHeight,e.object.matrix),se(2*T*J/_.clientHeight,e.object.matrix)}else _&&e.object instanceof be&&e.object.isOrthographicCamera?(fe(x*(e.object.right-e.object.left)/e.object.zoom/_.clientWidth,e.object.matrix),se(T*(e.object.top-e.object.bottom)/e.object.zoom/_.clientHeight,e.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),e.enablePan=!1)}})();function Y(n){e.object instanceof ge&&e.object.isPerspectiveCamera||e.object instanceof be&&e.object.isOrthographicCamera?m/=n:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function ce(n){e.object instanceof ge&&e.object.isPerspectiveCamera||e.object instanceof be&&e.object.isOrthographicCamera?m*=n:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function Ve(n){if(!e.zoomToCursor||!e.domElement)return;W=!0;const d=e.domElement.getBoundingClientRect(),x=n.clientX-d.left,T=n.clientY-d.top,_=d.width,K=d.height;D.x=x/_*2-1,D.y=-(T/K)*2+1,A.set(D.x,D.y,1).unproject(e.object).sub(e.object.position).normalize()}function je(n){return Math.max(e.minDistance,Math.min(e.maxDistance,n))}function Ye(n){P.set(n.clientX,n.clientY)}function Pt(n){Ve(n),O.set(n.clientX,n.clientY)}function Ue(n){w.set(n.clientX,n.clientY)}function Ct(n){h.set(n.clientX,n.clientY),v.subVectors(h,P).multiplyScalar(e.rotateSpeed);const d=e.domElement;d&&(U(2*Math.PI*v.x/d.clientHeight),L(2*Math.PI*v.y/d.clientHeight)),P.copy(h),e.update()}function Tt(n){k.set(n.clientX,n.clientY),S.subVectors(k,O),S.y>0?Y(R()):S.y<0&&ce(R()),O.copy(k),e.update()}function Ot(n){N.set(n.clientX,n.clientY),z.subVectors(N,w).multiplyScalar(e.panSpeed),Z(z.x,z.y),w.copy(N),e.update()}function Mt(n){Ve(n),n.deltaY<0?ce(R()):n.deltaY>0&&Y(R()),e.update()}function $t(n){let d=!1;switch(n.code){case e.keys.UP:Z(0,e.keyPanSpeed),d=!0;break;case e.keys.BOTTOM:Z(0,-e.keyPanSpeed),d=!0;break;case e.keys.LEFT:Z(e.keyPanSpeed,0),d=!0;break;case e.keys.RIGHT:Z(-e.keyPanSpeed,0),d=!0;break}d&&(n.preventDefault(),e.update())}function Ge(){if(j.length==1)P.set(j[0].pageX,j[0].pageY);else{const n=.5*(j[0].pageX+j[1].pageX),d=.5*(j[0].pageY+j[1].pageY);P.set(n,d)}}function We(){if(j.length==1)w.set(j[0].pageX,j[0].pageY);else{const n=.5*(j[0].pageX+j[1].pageX),d=.5*(j[0].pageY+j[1].pageY);w.set(n,d)}}function He(){const n=j[0].pageX-j[1].pageX,d=j[0].pageY-j[1].pageY,x=Math.sqrt(n*n+d*d);O.set(0,x)}function Nt(){e.enableZoom&&He(),e.enablePan&&We()}function St(){e.enableZoom&&He(),e.enableRotate&&Ge()}function Ze(n){if(j.length==1)h.set(n.pageX,n.pageY);else{const x=Ce(n),T=.5*(n.pageX+x.x),_=.5*(n.pageY+x.y);h.set(T,_)}v.subVectors(h,P).multiplyScalar(e.rotateSpeed);const d=e.domElement;d&&(U(2*Math.PI*v.x/d.clientHeight),L(2*Math.PI*v.y/d.clientHeight)),P.copy(h)}function Ke(n){if(j.length==1)N.set(n.pageX,n.pageY);else{const d=Ce(n),x=.5*(n.pageX+d.x),T=.5*(n.pageY+d.y);N.set(x,T)}z.subVectors(N,w).multiplyScalar(e.panSpeed),Z(z.x,z.y),w.copy(N)}function Xe(n){const d=Ce(n),x=n.pageX-d.x,T=n.pageY-d.y,_=Math.sqrt(x*x+T*T);k.set(0,_),S.set(0,Math.pow(k.y/O.y,e.zoomSpeed)),Y(S.y),O.copy(k)}function Dt(n){e.enableZoom&&Xe(n),e.enablePan&&Ke(n)}function At(n){e.enableZoom&&Xe(n),e.enableRotate&&Ze(n)}function qe(n){var d,x;e.enabled!==!1&&(j.length===0&&((d=e.domElement)==null||d.ownerDocument.addEventListener("pointermove",Ee),(x=e.domElement)==null||x.ownerDocument.addEventListener("pointerup",ke)),zt(n),n.pointerType==="touch"?_t(n):Rt(n))}function Ee(n){e.enabled!==!1&&(n.pointerType==="touch"?It(n):Lt(n))}function ke(n){var d,x,T;tt(n),j.length===0&&((d=e.domElement)==null||d.releasePointerCapture(n.pointerId),(x=e.domElement)==null||x.ownerDocument.removeEventListener("pointermove",Ee),(T=e.domElement)==null||T.ownerDocument.removeEventListener("pointerup",ke)),e.dispatchEvent(p),u=r.NONE}function Qe(n){tt(n)}function Rt(n){let d;switch(n.button){case 0:d=e.mouseButtons.LEFT;break;case 1:d=e.mouseButtons.MIDDLE;break;case 2:d=e.mouseButtons.RIGHT;break;default:d=-1}switch(d){case re.DOLLY:if(e.enableZoom===!1)return;Pt(n),u=r.DOLLY;break;case re.ROTATE:if(n.ctrlKey||n.metaKey||n.shiftKey){if(e.enablePan===!1)return;Ue(n),u=r.PAN}else{if(e.enableRotate===!1)return;Ye(n),u=r.ROTATE}break;case re.PAN:if(n.ctrlKey||n.metaKey||n.shiftKey){if(e.enableRotate===!1)return;Ye(n),u=r.ROTATE}else{if(e.enablePan===!1)return;Ue(n),u=r.PAN}break;default:u=r.NONE}u!==r.NONE&&e.dispatchEvent(c)}function Lt(n){if(e.enabled!==!1)switch(u){case r.ROTATE:if(e.enableRotate===!1)return;Ct(n);break;case r.DOLLY:if(e.enableZoom===!1)return;Tt(n);break;case r.PAN:if(e.enablePan===!1)return;Ot(n);break}}function Je(n){e.enabled===!1||e.enableZoom===!1||u!==r.NONE&&u!==r.ROTATE||(n.preventDefault(),e.dispatchEvent(c),Mt(n),e.dispatchEvent(p))}function Pe(n){e.enabled===!1||e.enablePan===!1||$t(n)}function _t(n){switch(ot(n),j.length){case 1:switch(e.touches.ONE){case ie.ROTATE:if(e.enableRotate===!1)return;Ge(),u=r.TOUCH_ROTATE;break;case ie.PAN:if(e.enablePan===!1)return;We(),u=r.TOUCH_PAN;break;default:u=r.NONE}break;case 2:switch(e.touches.TWO){case ie.DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;Nt(),u=r.TOUCH_DOLLY_PAN;break;case ie.DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;St(),u=r.TOUCH_DOLLY_ROTATE;break;default:u=r.NONE}break;default:u=r.NONE}u!==r.NONE&&e.dispatchEvent(c)}function It(n){switch(ot(n),u){case r.TOUCH_ROTATE:if(e.enableRotate===!1)return;Ze(n),e.update();break;case r.TOUCH_PAN:if(e.enablePan===!1)return;Ke(n),e.update();break;case r.TOUCH_DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;Dt(n),e.update();break;case r.TOUCH_DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;At(n),e.update();break;default:u=r.NONE}}function et(n){e.enabled!==!1&&n.preventDefault()}function zt(n){j.push(n)}function tt(n){delete F[n.pointerId];for(let d=0;d<j.length;d++)if(j[d].pointerId==n.pointerId){j.splice(d,1);return}}function ot(n){let d=F[n.pointerId];d===void 0&&(d=new H,F[n.pointerId]=d),d.set(n.pageX,n.pageY)}function Ce(n){const d=n.pointerId===j[0].pointerId?j[1]:j[0];return F[d.pointerId]}i!==void 0&&this.connect(i),this.update()}};const vn=new $,jn=y.forwardRef(function({start:o=[0,0,0],end:i=[0,0,0],mid:e,segments:a=20,...c},p){const r=y.useRef(null),[u]=y.useState(()=>new Xt(void 0,void 0,void 0)),g=y.useCallback((f,m,E,P=20)=>(f instanceof $?u.v0.copy(f):u.v0.set(...f),m instanceof $?u.v2.copy(m):u.v2.set(...m),E instanceof $?u.v1.copy(E):u.v1.copy(u.v0.clone().add(u.v2.clone().sub(u.v0)).add(vn.set(0,u.v0.y-u.v2.y,0))),u.getPoints(P)),[]);y.useLayoutEffect(()=>{r.current.setPoints=(f,m,E)=>{const P=g(f,m,E);r.current.geometry&&r.current.geometry.setPositions(P.map(h=>h.toArray()).flat())}},[]);const l=y.useMemo(()=>g(o,i,e,a),[o,i,e,a]);return y.createElement(wo,I({ref:vo([r,p]),points:l},c))}),En=y.forwardRef(({makeDefault:t,camera:o,regress:i,domElement:e,enableDamping:a=!0,onChange:c,onStart:p,onEnd:r,...u},g)=>{const l=Q(k=>k.invalidate),f=Q(k=>k.camera),m=Q(k=>k.gl),E=Q(k=>k.events),P=Q(k=>k.setEvents),h=Q(k=>k.set),v=Q(k=>k.get),w=Q(k=>k.performance),N=o||f,z=e||E.connected||m.domElement,O=y.useMemo(()=>new wn(N),[N]);return ve(()=>{O.enabled&&O.update()},-1),y.useEffect(()=>(O.connect(z),()=>void O.dispose()),[z,i,O,l]),y.useEffect(()=>{const k=D=>{l(),i&&w.regress(),c&&c(D)},S=D=>{p&&p(D)},A=D=>{r&&r(D)};return O.addEventListener("change",k),O.addEventListener("start",S),O.addEventListener("end",A),()=>{O.removeEventListener("start",S),O.removeEventListener("end",A),O.removeEventListener("change",k)}},[c,p,r,O,l,P]),y.useEffect(()=>{if(t){const k=v().controls;return h({controls:O}),()=>h({controls:k})}},[t,O]),y.createElement("primitive",I({ref:g,object:O,enableDamping:a},u))});function kn(t){const o=t+"Geometry";return y.forwardRef(({args:i,children:e,...a},c)=>y.createElement("mesh",I({ref:c},a),y.createElement(o,{attach:"geometry",args:i}),e))}const Pn=kn("circle"),bt=t=>{const o=y.useRef();return y.useEffect(()=>{o.current=t}),o.current},Fe=10,Cn=2,xt=2,Tn=(t,o,i)=>{const c=new $().subVectors(o,t).normalize().multiplyScalar(i);return new $().addVectors(t,c)},Et=({links:t,nodes:o})=>{const i=y.useRef(null);return ve(()=>{i.current&&o&&i.current.children.forEach((e,a)=>{var h;const c=t[a];if(!c)return;const p=o.find(v=>v.ref_id===c.source),r=o.find(v=>v.ref_id===c.target),u=new $((r==null?void 0:r.x)||0,(r==null?void 0:r.y)||0,(r==null?void 0:r.z)||0),g=new $((p==null?void 0:p.x)||0,(p==null?void 0:p.y)||0,(p==null?void 0:p.z)||0),l=Tn(g,u,Fe+xt),f=u.clone(),m=new $().lerpVectors(f,l,0),E=e.children[0],P=e.children[1];P.position.set(l.x,l.y,l.z),P.lookAt(f),P.rotateX(-Math.PI/2),(h=E.setPoints)==null||h.call(E,f,l,m)})}),s.jsx("group",{ref:i,children:t.map(e=>s.jsxs("group",{children:[s.jsx(jn,{color:"white",end:[0,0,0],lineWidth:2,start:[0,0,0]}),s.jsxs("mesh",{position:new $(0,0,0),children:[s.jsx("coneGeometry",{args:[Cn,xt,32]}),s.jsx("meshBasicMaterial",{color:"white"})]})]},e.ref_id))})};Et.displayName="Lines";const On=["#ff13c9","#5af0ff","#3233ff","#c2f0c2","#ff6666","#99ccff","#ffb3b3"];new qt(2,2,2);const kt=y.memo(({node:t,setSelectedNode:o,onSimulationUpdate:i,isSelected:e})=>{var l;const a=y.useRef(null);console.log(e);const{size:c,camera:p}=Q(),r=uo(f=>{const{xy:[m,E],down:P,dragging:h,first:v,elapsedTime:w}=f;if(!(!h||v||w<100)&&P&&a.current){i();const N=(m-c.left)/window.innerWidth*c.width,z=(E-c.top)/window.innerHeight*c.height,S=new $(N/c.width*2-1,-z/c.height*2+1,0).unproject(p).multiply(new $(1,1,0)).clone();t.fx=S.x,t.fy=S.y}});ve(()=>{a.current&&a.current.position.set(t.x||0,t.y||0,0)});const u=On[(l=t==null?void 0:t.children)==null?void 0:l.length]||"red",g=f=>{f.stopPropagation(),o()};return s.jsxs("mesh",{ref:a,onClick:g,...r(),position:new $(t.x,t.y,0),children:[s.jsx(Pn,{args:[Fe,30,20],children:s.jsx("meshStandardMaterial",{attach:"material",color:u})}),s.jsx(jo,{...ko,color:"#000",fontSize:2,children:t.type})]})});kt.displayName="Node";const Mn=({simulation:t,setSelectedSchemaId:o,selectedId:i})=>{const[e]=jt(c=>[c.schemas]),a=()=>{t&&(t.alpha(.05),t.restart())};return s.jsx(s.Fragment,{children:e.map((c,p)=>{const r=t.nodes()[p];return r?s.jsx(kt,{isSelected:r.ref_id===i,node:r,onSimulationUpdate:a,setSelectedNode:()=>o(r.ref_id)},r.ref_id):null})})},$n=({schemasWithPositions:t,filteredLinks:o,setSelectedSchemaId:i,selectedSchemaId:e})=>{const[a,c]=y.useState(null),p=bt(t),r=bt(o);return y.useEffect(()=>{if(!t.length||!o.length)return;const u=structuredClone(t),g=structuredClone(o);if(a){p&&p.length!==t.length&&r&&r.length!==o.length&&(a.nodes(u).force("link",at(g).id(f=>f.ref_id)).force("charge",ct()).force("center",lt()).force("collide",dt(Fe+1)).alpha(.5).restart(),c({...a}));return}const l=Qt(u).force("link",at(g).id(f=>f.ref_id)).force("charge",ct()).force("center",lt()).force("collide",dt(0));c(l)},[t,a,o,p,r]),ve(()=>{}),a?s.jsxs(s.Fragment,{children:[s.jsx(Et,{links:o,nodes:a.nodes()}),s.jsx(Mn,{selectedId:e,setSelectedSchemaId:i,simulation:a})]}):null},Oe=new Jt(0),Nn=({selectedSchemaId:t,links:o,schemasWithPositions:i,setSelectedSchemaId:e})=>s.jsxs(Eo,{camera:{zoom:1,position:[0,0,200]},id:"schema-canvas",linear:!0,orthographic:!0,children:[s.jsx("color",{args:[Oe.r,Oe.g,Oe.b],attach:"background"}),eo&&s.jsx(Po,{position:"right-bottom"}),s.jsx(En,{enableRotate:!1,enableZoom:!0}),s.jsx(Co,{}),s.jsx($n,{filteredLinks:o,schemasWithPositions:i,selectedSchemaId:t,setSelectedSchemaId:e})]}),Sn=({onCreateNew:t})=>s.jsxs(Dn,{children:[s.jsx(Rn,{children:"BLUEPRINT"}),s.jsxs(An,{"data-testid":"add-schema-type",onClick:t,children:[s.jsx(Ln,{children:s.jsx(To,{})}),s.jsx(ee,{children:"Add Type"})]})]}),Dn=G(C).attrs({align:"flex-start",direction:"column",justify:"flex-start"})`
  flex: 1 1 auto;
  z-index: 31;
  transition: opacity 1s;
  background: ${B.BG2};
  overflow: hidden;
  max-height: 100vh;

  @media (max-width: 1440px) {
    max-height: 95.2vh;
  }

  @media (max-width: 1024px) {
    max-height: 74.8vh;
  }

  @media (max-width: 924px) {
    max-height: 73.1vh;
  }
`,An=G(C).attrs({align:"center",justify:"center",p:0})`
  position: relative;
  width: 64px;
  height: 58px;
  padding: 0;
  flex-direction: row;
  color: ${B.GRAY6};
  cursor: pointer;
  transition: ${({theme:t})=>t.transitions.create(["opacity","box-shadow","background-color"])};

  &:before {
    content: '';
    position: absolute;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    width: 4px; /* Initial width */
    height: 32px; /* Initial height on hover */
    background-color: transparent;
    transition: height 0.3s, width 0.3s, background-color 0.3s;
  }

  ${ee} {
    display: none;
    opacity: 0;
    width: 0;
    padding: 4px 10px;
    border-radius: 4px;
    background: #000;
    box-shadow: 0px 4px 8px 0px rgba(0, 0, 0, 0.25);
    position: absolute;
    left: 90%;
    z-index: 99;
    white-space: nowrap;
    visibility: visible;
    font-size: 11px;
    font-style: normal;
    font-weight: 400;
    transition: ${({theme:t})=>t.transitions.create(["opacity","visually"])};
  }

  &:hover {
    color: ${B.white};

    &:before {
      width: 3px;
      height: 32px;
      background-color: ${B.primaryBlue};
    }

    ${ee} {
      display: block;
      width: min-content;
      opacity: 1;
      visibility: visible;
    }
  }

  &:active {
    color: ${B.white};
    background: ${B.black};
    &:before {
      width: 3px;
      height: 100%;
      background-color: ${B.primaryBlue};
    }
  }

  &.root {
    border-radius: 50%;
    padding: 0;
    align-items: center;
    justify-content: center;
    border: none;
  }
`,Rn=G(C)`
  background: blue;
  align-items: center;
  justify-content: center;
  background: ${B.primaryBlue};
  width: 64px;
  height: 64px;
  cursor: pointer;
  font-size: 10px;
  font-weight: 600;
  color: ${B.white};
`,Ln=G(C)`
  justify-content: center;
  align-items: center;
  font-size: 24px;
`,_n=()=>{const[t,o]=y.useState(""),[i,e]=y.useState(!1),[a,c]=y.useState(!1),[p,r,u,g]=jt(h=>[h.schemas,h.links,h.setSchemas,h.setSchemaLinks]);y.useEffect(()=>{(async()=>{c(!0);try{const v=await to();u(v.schemas.filter(w=>w.ref_id&&!w.is_deleted&&w.ref_id)),g(v.edges),c(!1)}catch(v){console.error("Error fetching data:",v),c(!1)}})()},[u,g]);const l=h=>{if(p.some(w=>w.ref_id===h.ref_id))u(p.map(w=>w.ref_id===h.ref_id?{...h,children:[]}:w));else{u([...p,{...h,children:[]}]);const w=p.find(N=>h.parent===N.type);g([...r,{ref_id:`new-link-${r.length}`,edge_type:"CHILD_OF",source:h.ref_id||"new",target:(w==null?void 0:w.ref_id)||"new"}])}},f=h=>{u(p.filter(v=>v.type!==h))},m=p.map(h=>({...h,children:p.filter(v=>v.parent===h.type).map(v=>v.ref_id||"")})),E=r.filter(h=>h.edge_type==="CHILD_OF"&&m.some(v=>v.ref_id===h.source)&&m.some(v=>v.ref_id===h.target)),P=p.find(h=>h.ref_id===t)||null;return a?s.jsx(C,{align:"center",basis:"100%",grow:1,justify:"center",shrink:1,children:s.jsx(ze,{color:B.white})}):s.jsx(s.Fragment,{children:s.jsxs(C,{align:"stretch",direction:"row",grow:1,children:[s.jsx(C,{ml:-20,my:-20,children:s.jsx(Sn,{onCreateNew:()=>{e(!0),o("")}})}),s.jsx(C,{children:P||i?s.jsx(zn,{children:s.jsx(hn,{onDelete:f,onSchemaCreate:l,selectedSchema:P,setIsCreateNew:e,setSelectedSchemaId:o})}):null}),s.jsx(In,{direction:"row",grow:1,children:s.jsx(Bn,{children:s.jsx(Nn,{links:E,schemasWithPositions:m,selectedSchemaId:t,setSelectedSchemaId:o})})})]})})},In=G(C)`
  flex: 1 1 auto;
  justify-content: center;
  position: relative;
  overflow: hidden;
  padding: 10px;
  max-height: 80vh;

  @media (max-width: 1440px) {
    max-height: 85vh;
  }

  @media (max-width: 1024px) {
    max-height: 70vh;
  }
`,zn=G(C)`
  width: 100%;
  max-width: 400px;
  background: ${B.BG1};
  padding: 16px;
  border-top-right-radius: 16px;
  border-bottom-right-radius: 16px;
  flex-grow: 1;
  flex-shrink: 1;
  min-width: 300px;
  overflow: auto;
  max-height: calc(100vh - 20px);

  @media (max-width: 1440px) {
    max-height: calc(95vh - 20px);
  }

  @media (max-width: 1024px) {
    max-height: calc(70vh - 20px);
  }

  @media (max-width: 924px) {
    max-height: calc(70vh - 20px);
  }
`,Bn=G(C)`
  flex: 1 1 100%;
`,Fn=()=>{const{close:t}=wt("blueprintGraph"),o=()=>{t()};return s.jsx(oo,{background:"black",id:"blueprintGraph",kind:"full",onClose:o,preventOutsideClose:!0,children:s.jsx(_n,{})})},ps=y.memo(Fn);export{ps as BlueprintModal};
