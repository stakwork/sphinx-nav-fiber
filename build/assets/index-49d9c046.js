import{g as We,a as Ye,s as de,_ as B,a9 as to,r as b,b as Ue,j as o,d as Ge,c as le,e as He,u as Nt,aM as oo,b4 as Ne,b5 as Ze,a7 as lt,b6 as no,b7 as so,a0 as ro,f as I,F as w,h as z,D as Se,a_ as io,T as K,B as Lt,N as Oe,aY as he,a$ as $t,b8 as ao,b9 as co,ba as lo,Z as A,bb as pe,bc as fe,ap as dt,bd as Pe,be as Ce,bf as ut,bg as J,bh as uo,ar as po,bi as pt,bj as ft,bk as ht,bl as mt,bm as fo,am as ho,W as mo,bn as go,bo as gt}from"./index-7581c61b.js";import{B as xo}from"./index-757c305d.js";import{p as bo,q as yo,i as wo,C as we,I as jo,B as Le,c as Ke,b as Dt,F as _t,r as vo}from"./react-toastify.esm-faf00f02.js";import{e as Eo,A as Me}from"./index-89bef4cf.js";import{T as Ae}from"./index-c4429dc0.js";import{c as xt,d as ko,a as Po}from"./index-884feead.js";import{D as Co,P as To}from"./PlusIcon-177523ff.js";import{p as So,c as Oo,g as Mo,t as Ve}from"./index-42c796cc.js";import{u as Ao}from"./Popover-066a18ba.js";import{u as No}from"./index-38b7aaac.js";import{L as Lo,m as $o,u as te,b as $e,T as zt,H as Do,C as _o}from"./constant-5a82780f.js";import{f as zo,P as Io,L as Ro}from"./constants-3eac846e.js";import{A as bt}from"./AddContentIcon-d6404507.js";import"./useSlotProps-a387145b.js";import"./Popper-fbbc4e0b.js";import"./index.esm-e417f1f8.js";import"./InfoIcon-faa9e813.js";import"./generateCategoricalChart-37acc339.js";import"./NoFilterResultIcon-33e10a3d.js";import"./index-de10eb26.js";import"./index-7721cc10.js";import"./CheckIcon-7ebdd6ad.js";function Bo(t){return We("PrivateSwitchBase",t)}Ye("PrivateSwitchBase",["root","checked","disabled","input","edgeStart","edgeEnd"]);const Fo=["autoFocus","checked","checkedIcon","className","defaultChecked","disabled","disableFocusRipple","edge","icon","id","inputProps","inputRef","name","onBlur","onChange","onFocus","readOnly","required","tabIndex","type","value"],Vo=t=>{const{classes:s,checked:r,disabled:e,edge:c}=t,a={root:["root",r&&"checked",e&&"disabled",c&&`edge${le(c)}`],input:["input"]};return He(a,Bo,s)},Wo=de(bo)(({ownerState:t})=>B({padding:9,borderRadius:"50%"},t.edge==="start"&&{marginLeft:t.size==="small"?-3:-12},t.edge==="end"&&{marginRight:t.size==="small"?-3:-12})),Yo=de("input",{shouldForwardProp:to})({cursor:"inherit",position:"absolute",opacity:0,width:"100%",height:"100%",top:0,left:0,margin:0,padding:0,zIndex:1}),Uo=b.forwardRef(function(s,r){const{autoFocus:e,checked:c,checkedIcon:a,className:u,defaultChecked:l,disabled:d,disableFocusRipple:j=!1,edge:i=!1,icon:f,id:m,inputProps:h,inputRef:y,name:P,onBlur:v,onChange:O,onFocus:S,readOnly:$,required:g=!1,tabIndex:x,type:M,value:D}=s,_=Ue(s,Fo),[V,C]=No({controlled:c,default:!!l,name:"SwitchBase",state:"checked"}),T=Ao(),X=Y=>{S&&S(Y),T&&T.onFocus&&T.onFocus(Y)},F=Y=>{v&&v(Y),T&&T.onBlur&&T.onBlur(Y)},q=Y=>{if(Y.nativeEvent.defaultPrevented)return;const ie=Y.target.checked;C(ie),O&&O(Y,ie)};let H=d;T&&typeof H>"u"&&(H=T.disabled);const G=M==="checkbox"||M==="radio",re=B({},s,{checked:V,disabled:H,disableFocusRipple:j,edge:i}),Q=Vo(re);return o.jsxs(Wo,B({component:"span",className:Ge(Q.root,u),centerRipple:!0,focusRipple:!j,disabled:H,tabIndex:null,role:void 0,onFocus:X,onBlur:F,ownerState:re,ref:r},_,{children:[o.jsx(Yo,B({autoFocus:e,checked:c,defaultChecked:l,className:Q.input,disabled:H,id:G?m:void 0,name:P,onChange:q,readOnly:$,ref:y,required:g,ownerState:re,tabIndex:x,type:M},M==="checkbox"&&D===void 0?{}:{value:D},h)),V?a:f]}))}),Go=Uo,Ho=b.createContext(),yt=Ho;function Zo(t){return We("MuiGrid",t)}const Ko=[0,1,2,3,4,5,6,7,8,9,10],Xo=["column-reverse","column","row-reverse","row"],qo=["nowrap","wrap-reverse","wrap"],ye=["auto",!0,1,2,3,4,5,6,7,8,9,10,11,12],Qo=Ye("MuiGrid",["root","container","item","zeroMinWidth",...Ko.map(t=>`spacing-xs-${t}`),...Xo.map(t=>`direction-xs-${t}`),...qo.map(t=>`wrap-xs-${t}`),...ye.map(t=>`grid-xs-${t}`),...ye.map(t=>`grid-sm-${t}`),...ye.map(t=>`grid-md-${t}`),...ye.map(t=>`grid-lg-${t}`),...ye.map(t=>`grid-xl-${t}`)]),je=Qo,Jo=["className","columns","columnSpacing","component","container","direction","item","rowSpacing","spacing","wrap","zeroMinWidth"];function me(t){const s=parseFloat(t);return`${s}${String(t).replace(String(s),"")||"px"}`}function en({theme:t,ownerState:s}){let r;return t.breakpoints.keys.reduce((e,c)=>{let a={};if(s[c]&&(r=s[c]),!r)return e;if(r===!0)a={flexBasis:0,flexGrow:1,maxWidth:"100%"};else if(r==="auto")a={flexBasis:"auto",flexGrow:0,flexShrink:0,maxWidth:"none",width:"auto"};else{const u=Ne({values:s.columns,breakpoints:t.breakpoints.values}),l=typeof u=="object"?u[c]:u;if(l==null)return e;const d=`${Math.round(r/l*1e8)/1e6}%`;let j={};if(s.container&&s.item&&s.columnSpacing!==0){const i=t.spacing(s.columnSpacing);if(i!=="0px"){const f=`calc(${d} + ${me(i)})`;j={flexBasis:f,maxWidth:f}}}a=B({flexBasis:d,flexGrow:0,maxWidth:d},j)}return t.breakpoints.values[c]===0?Object.assign(e,a):e[t.breakpoints.up(c)]=a,e},{})}function tn({theme:t,ownerState:s}){const r=Ne({values:s.direction,breakpoints:t.breakpoints.values});return Ze({theme:t},r,e=>{const c={flexDirection:e};return e.indexOf("column")===0&&(c[`& > .${je.item}`]={maxWidth:"none"}),c})}function It({breakpoints:t,values:s}){let r="";Object.keys(s).forEach(c=>{r===""&&s[c]!==0&&(r=c)});const e=Object.keys(t).sort((c,a)=>t[c]-t[a]);return e.slice(0,e.indexOf(r))}function on({theme:t,ownerState:s}){const{container:r,rowSpacing:e}=s;let c={};if(r&&e!==0){const a=Ne({values:e,breakpoints:t.breakpoints.values});let u;typeof a=="object"&&(u=It({breakpoints:t.breakpoints.values,values:a})),c=Ze({theme:t},a,(l,d)=>{var j;const i=t.spacing(l);return i!=="0px"?{marginTop:`-${me(i)}`,[`& > .${je.item}`]:{paddingTop:me(i)}}:(j=u)!=null&&j.includes(d)?{}:{marginTop:0,[`& > .${je.item}`]:{paddingTop:0}}})}return c}function nn({theme:t,ownerState:s}){const{container:r,columnSpacing:e}=s;let c={};if(r&&e!==0){const a=Ne({values:e,breakpoints:t.breakpoints.values});let u;typeof a=="object"&&(u=It({breakpoints:t.breakpoints.values,values:a})),c=Ze({theme:t},a,(l,d)=>{var j;const i=t.spacing(l);return i!=="0px"?{width:`calc(100% + ${me(i)})`,marginLeft:`-${me(i)}`,[`& > .${je.item}`]:{paddingLeft:me(i)}}:(j=u)!=null&&j.includes(d)?{}:{width:"100%",marginLeft:0,[`& > .${je.item}`]:{paddingLeft:0}}})}return c}function sn(t,s,r={}){if(!t||t<=0)return[];if(typeof t=="string"&&!Number.isNaN(Number(t))||typeof t=="number")return[r[`spacing-xs-${String(t)}`]];const e=[];return s.forEach(c=>{const a=t[c];Number(a)>0&&e.push(r[`spacing-${c}-${String(a)}`])}),e}const rn=de("div",{name:"MuiGrid",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:r}=t,{container:e,direction:c,item:a,spacing:u,wrap:l,zeroMinWidth:d,breakpoints:j}=r;let i=[];e&&(i=sn(u,j,s));const f=[];return j.forEach(m=>{const h=r[m];h&&f.push(s[`grid-${m}-${String(h)}`])}),[s.root,e&&s.container,a&&s.item,d&&s.zeroMinWidth,...i,c!=="row"&&s[`direction-xs-${String(c)}`],l!=="wrap"&&s[`wrap-xs-${String(l)}`],...f]}})(({ownerState:t})=>B({boxSizing:"border-box"},t.container&&{display:"flex",flexWrap:"wrap",width:"100%"},t.item&&{margin:0},t.zeroMinWidth&&{minWidth:0},t.wrap!=="wrap"&&{flexWrap:t.wrap}),tn,on,nn,en);function an(t,s){if(!t||t<=0)return[];if(typeof t=="string"&&!Number.isNaN(Number(t))||typeof t=="number")return[`spacing-xs-${String(t)}`];const r=[];return s.forEach(e=>{const c=t[e];if(Number(c)>0){const a=`spacing-${e}-${String(c)}`;r.push(a)}}),r}const cn=t=>{const{classes:s,container:r,direction:e,item:c,spacing:a,wrap:u,zeroMinWidth:l,breakpoints:d}=t;let j=[];r&&(j=an(a,d));const i=[];d.forEach(m=>{const h=t[m];h&&i.push(`grid-${m}-${String(h)}`)});const f={root:["root",r&&"container",c&&"item",l&&"zeroMinWidth",...j,e!=="row"&&`direction-xs-${String(e)}`,u!=="wrap"&&`wrap-xs-${String(u)}`,...i]};return He(f,Zo,s)},ln=b.forwardRef(function(s,r){const e=Nt({props:s,name:"MuiGrid"}),{breakpoints:c}=oo(),a=Eo(e),{className:u,columns:l,columnSpacing:d,component:j="div",container:i=!1,direction:f="row",item:m=!1,rowSpacing:h,spacing:y=0,wrap:P="wrap",zeroMinWidth:v=!1}=a,O=Ue(a,Jo),S=h||y,$=d||y,g=b.useContext(yt),x=i?l||12:g,M={},D=B({},O);c.keys.forEach(C=>{O[C]!=null&&(M[C]=O[C],delete D[C])});const _=B({},a,{columns:x,container:i,direction:f,item:m,rowSpacing:S,columnSpacing:$,wrap:P,zeroMinWidth:v,spacing:y},M,{breakpoints:c.keys}),V=cn(_);return o.jsx(yt.Provider,{value:x,children:o.jsx(rn,B({ownerState:_,className:Ge(V.root,u),as:j,ref:r},D))})}),ce=ln;function dn(t){return We("MuiSwitch",t)}const un=Ye("MuiSwitch",["root","edgeStart","edgeEnd","switchBase","colorPrimary","colorSecondary","sizeSmall","sizeMedium","checked","disabled","input","thumb","track"]),U=un,pn=["className","color","edge","size","sx"],fn=t=>{const{classes:s,edge:r,size:e,color:c,checked:a,disabled:u}=t,l={root:["root",r&&`edge${le(r)}`,`size${le(e)}`],switchBase:["switchBase",`color${le(c)}`,a&&"checked",u&&"disabled"],thumb:["thumb"],track:["track"],input:["input"]},d=He(l,dn,s);return B({},s,d)},hn=de("span",{name:"MuiSwitch",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:r}=t;return[s.root,r.edge&&s[`edge${le(r.edge)}`],s[`size${le(r.size)}`]]}})(({ownerState:t})=>B({display:"inline-flex",width:34+12*2,height:14+12*2,overflow:"hidden",padding:12,boxSizing:"border-box",position:"relative",flexShrink:0,zIndex:0,verticalAlign:"middle","@media print":{colorAdjust:"exact"}},t.edge==="start"&&{marginLeft:-8},t.edge==="end"&&{marginRight:-8},t.size==="small"&&{width:40,height:24,padding:7,[`& .${U.thumb}`]:{width:16,height:16},[`& .${U.switchBase}`]:{padding:4,[`&.${U.checked}`]:{transform:"translateX(16px)"}}})),mn=de(Go,{name:"MuiSwitch",slot:"SwitchBase",overridesResolver:(t,s)=>{const{ownerState:r}=t;return[s.switchBase,{[`& .${U.input}`]:s.input},r.color!=="default"&&s[`color${le(r.color)}`]]}})(({theme:t})=>({position:"absolute",top:0,left:0,zIndex:1,color:t.vars?t.vars.palette.Switch.defaultColor:`${t.palette.mode==="light"?t.palette.common.white:t.palette.grey[300]}`,transition:t.transitions.create(["left","transform"],{duration:t.transitions.duration.shortest}),[`&.${U.checked}`]:{transform:"translateX(20px)"},[`&.${U.disabled}`]:{color:t.vars?t.vars.palette.Switch.defaultDisabledColor:`${t.palette.mode==="light"?t.palette.grey[100]:t.palette.grey[600]}`},[`&.${U.checked} + .${U.track}`]:{opacity:.5},[`&.${U.disabled} + .${U.track}`]:{opacity:t.vars?t.vars.opacity.switchTrackDisabled:`${t.palette.mode==="light"?.12:.2}`},[`& .${U.input}`]:{left:"-100%",width:"300%"}}),({theme:t,ownerState:s})=>B({"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette.action.activeChannel} / ${t.vars.palette.action.hoverOpacity})`:lt(t.palette.action.active,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},s.color!=="default"&&{[`&.${U.checked}`]:{color:(t.vars||t).palette[s.color].main,"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette[s.color].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:lt(t.palette[s.color].main,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${U.disabled}`]:{color:t.vars?t.vars.palette.Switch[`${s.color}DisabledColor`]:`${t.palette.mode==="light"?no(t.palette[s.color].main,.62):so(t.palette[s.color].main,.55)}`}},[`&.${U.checked} + .${U.track}`]:{backgroundColor:(t.vars||t).palette[s.color].main}})),gn=de("span",{name:"MuiSwitch",slot:"Track",overridesResolver:(t,s)=>s.track})(({theme:t})=>({height:"100%",width:"100%",borderRadius:14/2,zIndex:-1,transition:t.transitions.create(["opacity","background-color"],{duration:t.transitions.duration.shortest}),backgroundColor:t.vars?t.vars.palette.common.onBackground:`${t.palette.mode==="light"?t.palette.common.black:t.palette.common.white}`,opacity:t.vars?t.vars.opacity.switchTrack:`${t.palette.mode==="light"?.38:.3}`})),xn=de("span",{name:"MuiSwitch",slot:"Thumb",overridesResolver:(t,s)=>s.thumb})(({theme:t})=>({boxShadow:(t.vars||t).shadows[1],backgroundColor:"currentColor",width:20,height:20,borderRadius:"50%"})),bn=b.forwardRef(function(s,r){const e=Nt({props:s,name:"MuiSwitch"}),{className:c,color:a="primary",edge:u=!1,size:l="medium",sx:d}=e,j=Ue(e,pn),i=B({},e,{color:a,edge:u,size:l}),f=fn(i),m=o.jsx(xn,{className:f.thumb,ownerState:i});return o.jsxs(hn,{className:Ge(f.root,c),sx:d,ownerState:i,children:[o.jsx(mn,B({type:"checkbox",icon:m,checkedIcon:m,ref:r,ownerState:i},j,{classes:B({},f,{root:f.switchBase})})),o.jsx(gn,{className:f.track,ownerState:i})]})}),yn=bn,wn={schemas:[],links:[]},Rt=ro(t=>({...wn,setSchemas:s=>{t({schemas:s})},setSchemaLinks:s=>{t({links:s})}})),jn=/^[a-z0-9_]+$/,vn=({parentParam:t,onDelete:s})=>{const[r,e]=b.useState(!1),[c,a]=b.useState([]),{fields:u,append:l,replace:d,remove:j}=yo({name:"attributes"}),{setValue:i,watch:f}=wo();return b.useEffect(()=>{const m=async()=>{try{let h=[{required:!1,type:"string",key:""}];if(t!==ko.value.toLowerCase()){e(!0);const y=await io(t);h=So(y)}h=h.filter(y=>y.key!=="node_key"),d(h),a(h)}catch(h){console.warn(h)}finally{e(!1)}};c.length===0&&m()},[t,i,d,c.length]),o.jsxs(o.Fragment,{children:[r?o.jsx(w,{align:"center",children:o.jsx(we,{color:z.SECONDARY_BLUE,size:"30"})}):o.jsx(En,{py:8,children:o.jsx(ce,{container:!0,spacing:2,children:u.map((m,h)=>{const y=f(`attributes[${h}].type`),P=f(`attributes[${h}].required`),v=m.isNew||!1,O=["name"].includes(f(`attributes[${h}].key`));return o.jsxs(b.Fragment,{children:[o.jsx(ce,{item:!0,xs:5,children:o.jsx(Ae,{autoComplete:"off",className:"text-input",disabled:!v,id:"cy-item-name",maxLength:50,name:`attributes.${h}.key`,placeholder:"Enter value",rules:{...Se,pattern:{message:"Please avoid special characters, spaces and uppercase",value:jn}}})}),o.jsx(ce,{item:!0,xs:4,children:o.jsx(Me,{disabled:O,onSelect:S=>i(`attributes[${h}].type`,S==null?void 0:S.value),options:xt,selectedValue:xt.find(S=>S.value===y)})}),o.jsxs(ce,{item:!0,xs:3,children:[o.jsx(yn,{checked:P,disabled:O,name:`attributes.${h}.required`,onChange:S=>i(`attributes[${h}].required`,S.target.checked),size:"small"}),!O&&o.jsx(jo,{onClick:()=>{j(h),m.key!==void 0&&s&&s(m.key)},children:o.jsx(Co,{})})]})]},m.id)})})}),o.jsx(w,{align:"flex-start",py:12,children:o.jsx(Le,{onClick:()=>l({key:"",type:"string",required:!0,isNew:!0}),size:"medium",startIcon:o.jsx(To,{}),variant:"contained",children:"Add Attribute"})})]})},En=I(w)`
  overflow-y: auto;
  width: calc(100% + 20px);
  max-height: calc(80vh - 300px);
`,kn=({parent:t,onDelete:s})=>{const r=t;return o.jsxs(w,{children:[o.jsx(w,{direction:"row",mb:10,children:o.jsxs(ce,{container:!0,spacing:2,children:[o.jsx(ce,{item:!0,xs:5,children:o.jsx(Re,{style:{marginRight:180},children:"Attributes"})}),o.jsx(ce,{item:!0,xs:4,children:o.jsx(Re,{style:{marginRight:130},children:"Type"})}),o.jsx(ce,{item:!0,xs:3,children:o.jsx(Re,{children:"Required"})})]})}),r&&o.jsx(vn,{onDelete:s,parentParam:r},r)]})},Re=I(K)`
  font-size: 15px;
  color: gray;
`,Pn={type:"",parent:""},Cn=async(t,s=!1,r)=>{try{const{attributes:e,...c}=t,a={...c,attributes:Oo(e),...r.reduce((l,d)=>({...l,[d]:"delete"}),{})};let u;if(s?u=await Oe.put("/schema",JSON.stringify(a),{}):u=await Oe.post("/schema",JSON.stringify({...a,node_key:"name"}),{}),u.status!=="success")throw new Error("error");return u==null?void 0:u.ref_id}catch(e){let c=he;if(e.status===400){const a=await e.json();c=a.errorCode||(a==null?void 0:a.status)||he}else e instanceof Error&&(c=e.message);throw new Error(c)}},Tn=t=>t.charAt(0).toUpperCase()+t.slice(1),wt=async(t,s)=>{try{const a=((await $t()).schemas||[]).filter(u=>!u.is_deleted&&u.type&&(!s||s(u))).map(u=>u.type==="thing"?{label:"No Parent",value:u.type}:{label:Tn(u.type),value:u.type});t(a)}catch(r){console.warn(r)}},Sn=({graphLoading:t,onSchemaCreate:s,selectedSchema:r,onDelete:e,setSelectedSchemaId:c,setGraphLoading:a,setIsCreateNew:u,onSchemaUpdate:l})=>{const{close:d,visible:j}=Lt("addType"),i=Ke({mode:"onChange",defaultValues:r?{type:r.type,parent:r.parent}:Pn}),{watch:f,setValue:m,reset:h,getValues:y}=i,[P,v]=b.useState(!1),[O,S]=b.useState(!1),[$,g]=b.useState(null),[x,M]=b.useState(!1),[D,_]=b.useState(null),[V,C]=b.useState(""),[T,X]=b.useState(null),[F,q]=b.useState([]);b.useEffect(()=>()=>{h()},[j,h]);const H=()=>{u(!1),c("")};b.useEffect(()=>{r||(S(!0),wt(g).finally(()=>S(!1)))},[r]),b.useEffect(()=>{r&&(m("type",r==null?void 0:r.type),m("parent",r.parent),wt(_,N=>N.type!==r.type&&N.type!==r.parent))},[r,m]);const G=f("parent"),re=()=>{d()},Q=N=>{q(W=>[...W,N])},Y=async()=>{if(r!=null&&r.type)try{await Oe.delete(`/schema/${r.ref_id}`),e(r.type),d()}catch(N){let W=he;if((N==null?void 0:N.status)===400){const Z=await N.json();W=Z.errorCode||(Z==null?void 0:Z.status)||he}else N instanceof Error&&(W=N.message);X(W)}finally{u(!1)}},ie=i.handleSubmit(async N=>{if(!G){M(!0);return}v(!0);try{if(r&&N.type!==(r==null?void 0:r.type)||r&&y().parent!==(r==null?void 0:r.parent)){const Z=y().parent??(r==null?void 0:r.parent);a(!0),await Oe.put(`/schema/${r==null?void 0:r.ref_id}`,JSON.stringify({type:N.type,parent:Z})),await l()}const W=await Cn({...N,...r?{ref_id:r==null?void 0:r.ref_id}:{}},!!r,F);s({type:N.type,parent:G||"",ref_id:(r==null?void 0:r.ref_id)||W||"new"}),re()}catch(W){let Z=he;if((W==null?void 0:W.status)===400){const ue=await W.json();Z=ue.errorCode||(ue==null?void 0:ue.status)||he}else W instanceof Error&&(Z=W.message);C(Z)}finally{v(!1),a(!1),u(!1)}}),ve=()=>$==null?void 0:$.find(N=>N.value===G),ge=()=>D==null?void 0:D.find(N=>N.value===G);return o.jsxs(w,{children:[o.jsx(w,{direction:"row",justify:"flex-end",children:o.jsx(Mn,{"data-testid":"close-sidebar-sub-view",onClick:H,children:o.jsx(Dt,{})})}),o.jsx(w,{children:o.jsx(_t,{...i,children:o.jsxs("form",{id:"add-type-form",onSubmit:ie,children:[o.jsx(w,{children:r?o.jsxs(o.Fragment,{children:[o.jsxs(w,{mb:12,children:[o.jsx(w,{mb:12,children:o.jsx(K,{children:"Name"})}),o.jsx(w,{mb:12,children:o.jsx(Ae,{defaultValue:r==null?void 0:r.type,id:"cy-item-name",maxLength:250,name:"type",placeholder:"Enter type name",rules:{...Se},value:G})})]}),o.jsxs(w,{mb:12,children:[o.jsx(w,{mb:12,children:o.jsx(K,{children:"Parent"})}),o.jsx(Me,{isLoading:O||t,onSelect:N=>{m("parent",(N==null?void 0:N.value)||""),M(!1)},options:D||[],selectedValue:ge()}),V&&o.jsx(Be,{children:V})]})]}):o.jsxs(o.Fragment,{children:[o.jsxs(w,{mb:12,children:[o.jsx(w,{mb:12,children:o.jsx(K,{children:"Select Parent"})}),o.jsx(Me,{isLoading:O,onSelect:N=>{m("parent",(N==null?void 0:N.value)||""),M(!1)},options:$,selectedValue:ve()}),x&&o.jsx(Be,{children:"A parent type must be selected"})]}),o.jsxs(w,{children:[o.jsx(w,{mb:12,children:o.jsx(K,{children:"Type name"})}),o.jsx(w,{mb:12,children:o.jsx(Ae,{id:"cy-item-name",maxLength:250,name:"type",placeholder:"Enter type name",rules:{...Se},value:G})})]})]})}),o.jsx(kn,{onDelete:Q,parent:r?r.type:G}),o.jsxs(w,{direction:"row",justify:"space-between",mt:20,children:[r?o.jsxs(w,{direction:"column",children:[o.jsx(On,{color:"secondary",onClick:Y,size:"large",style:{marginRight:20},variant:"contained",children:"Delete"}),T&&o.jsx(Be,{children:T})]}):null,o.jsx(Le,{color:"secondary",disabled:P||x,onClick:ie,size:"large",startIcon:P?o.jsx(we,{color:z.white,size:10}):null,variant:"contained",children:"Save"})]})]})})})]})},On=I(Le)`
  && {
    color: ${z.primaryRed};
    background-color: rgba(237, 116, 116, 0.1);

    &:hover,
    &:active,
    &:focus {
      color: ${z.primaryRed};
      background-color: rgba(237, 116, 116, 0.2);
    }
  }
`,Mn=I(w)`
  font-size: 32px;
  color: ${z.white};
  cursor: pointer;
`,Be=I(w)`
  font-size: 13px;
  font-family: Barlow;
  color: #ff8f80;
  line-height: 0.2px;
  margin-top: 12px;
  padding-top: 20px;
`;var An=Object.defineProperty,Nn=(t,s,r)=>s in t?An(t,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[s]=r,E=(t,s,r)=>(Nn(t,typeof s!="symbol"?s+"":s,r),r);const Te=new ao,jt=new co,Ln=Math.cos(70*(Math.PI/180)),vt=(t,s)=>(t%s+s)%s;let $n=class extends lo{constructor(s,r){super(),E(this,"object"),E(this,"domElement"),E(this,"enabled",!0),E(this,"target",new A),E(this,"minDistance",0),E(this,"maxDistance",1/0),E(this,"minZoom",0),E(this,"maxZoom",1/0),E(this,"minPolarAngle",0),E(this,"maxPolarAngle",Math.PI),E(this,"minAzimuthAngle",-1/0),E(this,"maxAzimuthAngle",1/0),E(this,"enableDamping",!1),E(this,"dampingFactor",.05),E(this,"enableZoom",!0),E(this,"zoomSpeed",1),E(this,"enableRotate",!0),E(this,"rotateSpeed",1),E(this,"enablePan",!0),E(this,"panSpeed",1),E(this,"screenSpacePanning",!0),E(this,"keyPanSpeed",7),E(this,"zoomToCursor",!1),E(this,"autoRotate",!1),E(this,"autoRotateSpeed",2),E(this,"reverseOrbit",!1),E(this,"reverseHorizontalOrbit",!1),E(this,"reverseVerticalOrbit",!1),E(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),E(this,"mouseButtons",{LEFT:pe.ROTATE,MIDDLE:pe.DOLLY,RIGHT:pe.PAN}),E(this,"touches",{ONE:fe.ROTATE,TWO:fe.DOLLY_PAN}),E(this,"target0"),E(this,"position0"),E(this,"zoom0"),E(this,"_domElementKeyEvents",null),E(this,"getPolarAngle"),E(this,"getAzimuthalAngle"),E(this,"setPolarAngle"),E(this,"setAzimuthalAngle"),E(this,"getDistance"),E(this,"listenToKeyEvents"),E(this,"stopListenToKeyEvents"),E(this,"saveState"),E(this,"reset"),E(this,"update"),E(this,"connect"),E(this,"dispose"),this.object=s,this.domElement=r,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>i.phi,this.getAzimuthalAngle=()=>i.theta,this.setPolarAngle=n=>{let p=vt(n,2*Math.PI),k=i.phi;k<0&&(k+=2*Math.PI),p<0&&(p+=2*Math.PI);let L=Math.abs(p-k);2*Math.PI-L<L&&(p<k?p+=2*Math.PI:k+=2*Math.PI),f.phi=p-k,e.update()},this.setAzimuthalAngle=n=>{let p=vt(n,2*Math.PI),k=i.theta;k<0&&(k+=2*Math.PI),p<0&&(p+=2*Math.PI);let L=Math.abs(p-k);2*Math.PI-L<L&&(p<k?p+=2*Math.PI:k+=2*Math.PI),f.theta=p-k,e.update()},this.getDistance=()=>e.object.position.distanceTo(e.target),this.listenToKeyEvents=n=>{n.addEventListener("keydown",ze),this._domElementKeyEvents=n},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",ze),this._domElementKeyEvents=null},this.saveState=()=>{e.target0.copy(e.target),e.position0.copy(e.object.position),e.zoom0=e.object.zoom},this.reset=()=>{e.target.copy(e.target0),e.object.position.copy(e.position0),e.object.zoom=e.zoom0,e.object.updateProjectionMatrix(),e.dispatchEvent(c),e.update(),d=l.NONE},this.update=(()=>{const n=new A,p=new A(0,1,0),k=new dt().setFromUnitVectors(s.up,p),L=k.clone().invert(),R=new A,oe=new dt,ae=2*Math.PI;return function(){const ct=e.object.position;k.setFromUnitVectors(s.up,p),L.copy(k).invert(),n.copy(ct).sub(e.target),n.applyQuaternion(k),i.setFromVector3(n),e.autoRotate&&d===l.NONE&&q(X()),e.enableDamping?(i.theta+=f.theta*e.dampingFactor,i.phi+=f.phi*e.dampingFactor):(i.theta+=f.theta,i.phi+=f.phi);let ne=e.minAzimuthAngle,se=e.maxAzimuthAngle;isFinite(ne)&&isFinite(se)&&(ne<-Math.PI?ne+=ae:ne>Math.PI&&(ne-=ae),se<-Math.PI?se+=ae:se>Math.PI&&(se-=ae),ne<=se?i.theta=Math.max(ne,Math.min(se,i.theta)):i.theta=i.theta>(ne+se)/2?Math.max(ne,i.theta):Math.min(se,i.theta)),i.phi=Math.max(e.minPolarAngle,Math.min(e.maxPolarAngle,i.phi)),i.makeSafe(),e.enableDamping===!0?e.target.addScaledVector(h,e.dampingFactor):e.target.add(h),e.zoomToCursor&&V||e.object.isOrthographicCamera?i.radius=ge(i.radius):i.radius=ge(i.radius*m),n.setFromSpherical(i),n.applyQuaternion(L),ct.copy(e.target).add(n),e.object.matrixAutoUpdate||e.object.updateMatrix(),e.object.lookAt(e.target),e.enableDamping===!0?(f.theta*=1-e.dampingFactor,f.phi*=1-e.dampingFactor,h.multiplyScalar(1-e.dampingFactor)):(f.set(0,0,0),h.set(0,0,0));let Ee=!1;if(e.zoomToCursor&&V){let xe=null;if(e.object instanceof Pe&&e.object.isPerspectiveCamera){const be=n.length();xe=ge(be*m);const ke=be-xe;e.object.position.addScaledVector(D,ke),e.object.updateMatrixWorld()}else if(e.object.isOrthographicCamera){const be=new A(_.x,_.y,0);be.unproject(e.object),e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/m)),e.object.updateProjectionMatrix(),Ee=!0;const ke=new A(_.x,_.y,0);ke.unproject(e.object),e.object.position.sub(ke).add(be),e.object.updateMatrixWorld(),xe=n.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),e.zoomToCursor=!1;xe!==null&&(e.screenSpacePanning?e.target.set(0,0,-1).transformDirection(e.object.matrix).multiplyScalar(xe).add(e.object.position):(Te.origin.copy(e.object.position),Te.direction.set(0,0,-1).transformDirection(e.object.matrix),Math.abs(e.object.up.dot(Te.direction))<Ln?s.lookAt(e.target):(jt.setFromNormalAndCoplanarPoint(e.object.up,e.target),Te.intersectPlane(jt,e.target))))}else e.object instanceof Ce&&e.object.isOrthographicCamera&&(e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/m)),e.object.updateProjectionMatrix(),Ee=!0);return m=1,V=!1,Ee||R.distanceToSquared(e.object.position)>j||8*(1-oe.dot(e.object.quaternion))>j?(e.dispatchEvent(c),R.copy(e.object.position),oe.copy(e.object.quaternion),Ee=!1,!0):!1}})(),this.connect=n=>{n===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),e.domElement=n,e.domElement.style.touchAction="none",e.domElement.addEventListener("contextmenu",rt),e.domElement.addEventListener("pointerdown",ot),e.domElement.addEventListener("pointercancel",nt),e.domElement.addEventListener("wheel",st)},this.dispose=()=>{var n,p,k,L,R,oe;(n=e.domElement)==null||n.removeEventListener("contextmenu",rt),(p=e.domElement)==null||p.removeEventListener("pointerdown",ot),(k=e.domElement)==null||k.removeEventListener("pointercancel",nt),(L=e.domElement)==null||L.removeEventListener("wheel",st),(R=e.domElement)==null||R.ownerDocument.removeEventListener("pointermove",De),(oe=e.domElement)==null||oe.ownerDocument.removeEventListener("pointerup",_e),e._domElementKeyEvents!==null&&e._domElementKeyEvents.removeEventListener("keydown",ze)};const e=this,c={type:"change"},a={type:"start"},u={type:"end"},l={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let d=l.NONE;const j=1e-6,i=new ut,f=new ut;let m=1;const h=new A,y=new J,P=new J,v=new J,O=new J,S=new J,$=new J,g=new J,x=new J,M=new J,D=new A,_=new J;let V=!1;const C=[],T={};function X(){return 2*Math.PI/60/60*e.autoRotateSpeed}function F(){return Math.pow(.95,e.zoomSpeed)}function q(n){e.reverseOrbit||e.reverseHorizontalOrbit?f.theta+=n:f.theta-=n}function H(n){e.reverseOrbit||e.reverseVerticalOrbit?f.phi+=n:f.phi-=n}const G=(()=>{const n=new A;return function(k,L){n.setFromMatrixColumn(L,0),n.multiplyScalar(-k),h.add(n)}})(),re=(()=>{const n=new A;return function(k,L){e.screenSpacePanning===!0?n.setFromMatrixColumn(L,1):(n.setFromMatrixColumn(L,0),n.crossVectors(e.object.up,n)),n.multiplyScalar(k),h.add(n)}})(),Q=(()=>{const n=new A;return function(k,L){const R=e.domElement;if(R&&e.object instanceof Pe&&e.object.isPerspectiveCamera){const oe=e.object.position;n.copy(oe).sub(e.target);let ae=n.length();ae*=Math.tan(e.object.fov/2*Math.PI/180),G(2*k*ae/R.clientHeight,e.object.matrix),re(2*L*ae/R.clientHeight,e.object.matrix)}else R&&e.object instanceof Ce&&e.object.isOrthographicCamera?(G(k*(e.object.right-e.object.left)/e.object.zoom/R.clientWidth,e.object.matrix),re(L*(e.object.top-e.object.bottom)/e.object.zoom/R.clientHeight,e.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),e.enablePan=!1)}})();function Y(n){e.object instanceof Pe&&e.object.isPerspectiveCamera||e.object instanceof Ce&&e.object.isOrthographicCamera?m/=n:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function ie(n){e.object instanceof Pe&&e.object.isPerspectiveCamera||e.object instanceof Ce&&e.object.isOrthographicCamera?m*=n:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function ve(n){if(!e.zoomToCursor||!e.domElement)return;V=!0;const p=e.domElement.getBoundingClientRect(),k=n.clientX-p.left,L=n.clientY-p.top,R=p.width,oe=p.height;_.x=k/R*2-1,_.y=-(L/oe)*2+1,D.set(_.x,_.y,1).unproject(e.object).sub(e.object.position).normalize()}function ge(n){return Math.max(e.minDistance,Math.min(e.maxDistance,n))}function N(n){y.set(n.clientX,n.clientY)}function W(n){ve(n),g.set(n.clientX,n.clientY)}function Z(n){O.set(n.clientX,n.clientY)}function ue(n){P.set(n.clientX,n.clientY),v.subVectors(P,y).multiplyScalar(e.rotateSpeed);const p=e.domElement;p&&(q(2*Math.PI*v.x/p.clientHeight),H(2*Math.PI*v.y/p.clientHeight)),y.copy(P),e.update()}function Vt(n){x.set(n.clientX,n.clientY),M.subVectors(x,g),M.y>0?Y(F()):M.y<0&&ie(F()),g.copy(x),e.update()}function Wt(n){S.set(n.clientX,n.clientY),$.subVectors(S,O).multiplyScalar(e.panSpeed),Q($.x,$.y),O.copy(S),e.update()}function Yt(n){ve(n),n.deltaY<0?ie(F()):n.deltaY>0&&Y(F()),e.update()}function Ut(n){let p=!1;switch(n.code){case e.keys.UP:Q(0,e.keyPanSpeed),p=!0;break;case e.keys.BOTTOM:Q(0,-e.keyPanSpeed),p=!0;break;case e.keys.LEFT:Q(e.keyPanSpeed,0),p=!0;break;case e.keys.RIGHT:Q(-e.keyPanSpeed,0),p=!0;break}p&&(n.preventDefault(),e.update())}function Xe(){if(C.length==1)y.set(C[0].pageX,C[0].pageY);else{const n=.5*(C[0].pageX+C[1].pageX),p=.5*(C[0].pageY+C[1].pageY);y.set(n,p)}}function qe(){if(C.length==1)O.set(C[0].pageX,C[0].pageY);else{const n=.5*(C[0].pageX+C[1].pageX),p=.5*(C[0].pageY+C[1].pageY);O.set(n,p)}}function Qe(){const n=C[0].pageX-C[1].pageX,p=C[0].pageY-C[1].pageY,k=Math.sqrt(n*n+p*p);g.set(0,k)}function Gt(){e.enableZoom&&Qe(),e.enablePan&&qe()}function Ht(){e.enableZoom&&Qe(),e.enableRotate&&Xe()}function Je(n){if(C.length==1)P.set(n.pageX,n.pageY);else{const k=Ie(n),L=.5*(n.pageX+k.x),R=.5*(n.pageY+k.y);P.set(L,R)}v.subVectors(P,y).multiplyScalar(e.rotateSpeed);const p=e.domElement;p&&(q(2*Math.PI*v.x/p.clientHeight),H(2*Math.PI*v.y/p.clientHeight)),y.copy(P)}function et(n){if(C.length==1)S.set(n.pageX,n.pageY);else{const p=Ie(n),k=.5*(n.pageX+p.x),L=.5*(n.pageY+p.y);S.set(k,L)}$.subVectors(S,O).multiplyScalar(e.panSpeed),Q($.x,$.y),O.copy(S)}function tt(n){const p=Ie(n),k=n.pageX-p.x,L=n.pageY-p.y,R=Math.sqrt(k*k+L*L);x.set(0,R),M.set(0,Math.pow(x.y/g.y,e.zoomSpeed)),Y(M.y),g.copy(x)}function Zt(n){e.enableZoom&&tt(n),e.enablePan&&et(n)}function Kt(n){e.enableZoom&&tt(n),e.enableRotate&&Je(n)}function ot(n){var p,k;e.enabled!==!1&&(C.length===0&&((p=e.domElement)==null||p.ownerDocument.addEventListener("pointermove",De),(k=e.domElement)==null||k.ownerDocument.addEventListener("pointerup",_e)),eo(n),n.pointerType==="touch"?Qt(n):Xt(n))}function De(n){e.enabled!==!1&&(n.pointerType==="touch"?Jt(n):qt(n))}function _e(n){var p,k,L;it(n),C.length===0&&((p=e.domElement)==null||p.releasePointerCapture(n.pointerId),(k=e.domElement)==null||k.ownerDocument.removeEventListener("pointermove",De),(L=e.domElement)==null||L.ownerDocument.removeEventListener("pointerup",_e)),e.dispatchEvent(u),d=l.NONE}function nt(n){it(n)}function Xt(n){let p;switch(n.button){case 0:p=e.mouseButtons.LEFT;break;case 1:p=e.mouseButtons.MIDDLE;break;case 2:p=e.mouseButtons.RIGHT;break;default:p=-1}switch(p){case pe.DOLLY:if(e.enableZoom===!1)return;W(n),d=l.DOLLY;break;case pe.ROTATE:if(n.ctrlKey||n.metaKey||n.shiftKey){if(e.enablePan===!1)return;Z(n),d=l.PAN}else{if(e.enableRotate===!1)return;N(n),d=l.ROTATE}break;case pe.PAN:if(n.ctrlKey||n.metaKey||n.shiftKey){if(e.enableRotate===!1)return;N(n),d=l.ROTATE}else{if(e.enablePan===!1)return;Z(n),d=l.PAN}break;default:d=l.NONE}d!==l.NONE&&e.dispatchEvent(a)}function qt(n){if(e.enabled!==!1)switch(d){case l.ROTATE:if(e.enableRotate===!1)return;ue(n);break;case l.DOLLY:if(e.enableZoom===!1)return;Vt(n);break;case l.PAN:if(e.enablePan===!1)return;Wt(n);break}}function st(n){e.enabled===!1||e.enableZoom===!1||d!==l.NONE&&d!==l.ROTATE||(n.preventDefault(),e.dispatchEvent(a),Yt(n),e.dispatchEvent(u))}function ze(n){e.enabled===!1||e.enablePan===!1||Ut(n)}function Qt(n){switch(at(n),C.length){case 1:switch(e.touches.ONE){case fe.ROTATE:if(e.enableRotate===!1)return;Xe(),d=l.TOUCH_ROTATE;break;case fe.PAN:if(e.enablePan===!1)return;qe(),d=l.TOUCH_PAN;break;default:d=l.NONE}break;case 2:switch(e.touches.TWO){case fe.DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;Gt(),d=l.TOUCH_DOLLY_PAN;break;case fe.DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;Ht(),d=l.TOUCH_DOLLY_ROTATE;break;default:d=l.NONE}break;default:d=l.NONE}d!==l.NONE&&e.dispatchEvent(a)}function Jt(n){switch(at(n),d){case l.TOUCH_ROTATE:if(e.enableRotate===!1)return;Je(n),e.update();break;case l.TOUCH_PAN:if(e.enablePan===!1)return;et(n),e.update();break;case l.TOUCH_DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;Zt(n),e.update();break;case l.TOUCH_DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;Kt(n),e.update();break;default:d=l.NONE}}function rt(n){e.enabled!==!1&&n.preventDefault()}function eo(n){C.push(n)}function it(n){delete T[n.pointerId];for(let p=0;p<C.length;p++)if(C[p].pointerId==n.pointerId){C.splice(p,1);return}}function at(n){let p=T[n.pointerId];p===void 0&&(p=new J,T[n.pointerId]=p),p.set(n.pageX,n.pageY)}function Ie(n){const p=n.pointerId===C[0].pointerId?C[1]:C[0];return T[p.pointerId]}r!==void 0&&this.connect(r),this.update()}};const Dn=new A,Et=b.forwardRef(function({start:s=[0,0,0],end:r=[0,0,0],mid:e,segments:c=20,...a},u){const l=b.useRef(null),[d]=b.useState(()=>new uo(void 0,void 0,void 0)),j=b.useCallback((f,m,h,y=20)=>(f instanceof A?d.v0.copy(f):d.v0.set(...f),m instanceof A?d.v2.copy(m):d.v2.set(...m),h instanceof A?d.v1.copy(h):d.v1.copy(d.v0.clone().add(d.v2.clone().sub(d.v0)).add(Dn.set(0,d.v0.y-d.v2.y,0))),d.getPoints(y)),[]);b.useLayoutEffect(()=>{l.current.setPoints=(f,m,h)=>{const y=j(f,m,h);l.current.geometry&&l.current.geometry.setPositions(y.map(P=>P.toArray()).flat())}},[]);const i=b.useMemo(()=>j(s,r,e,c),[s,r,e,c]);return b.createElement(Lo,B({ref:$o([l,u]),points:i},a))}),_n=b.forwardRef(({makeDefault:t,camera:s,regress:r,domElement:e,enableDamping:c=!0,onChange:a,onStart:u,onEnd:l,...d},j)=>{const i=te(x=>x.invalidate),f=te(x=>x.camera),m=te(x=>x.gl),h=te(x=>x.events),y=te(x=>x.setEvents),P=te(x=>x.set),v=te(x=>x.get),O=te(x=>x.performance),S=s||f,$=e||h.connected||m.domElement,g=b.useMemo(()=>new $n(S),[S]);return $e(()=>{g.enabled&&g.update()},-1),b.useEffect(()=>(g.connect($),()=>void g.dispose()),[$,r,g,i]),b.useEffect(()=>{const x=_=>{i(),r&&O.regress(),a&&a(_)},M=_=>{u&&u(_)},D=_=>{l&&l(_)};return g.addEventListener("change",x),g.addEventListener("start",M),g.addEventListener("end",D),()=>{g.removeEventListener("start",M),g.removeEventListener("end",D),g.removeEventListener("change",x)}},[a,u,l,g,i,y]),b.useEffect(()=>{if(t){const x=v().controls;return P({controls:g}),()=>P({controls:x})}},[t,g]),b.createElement("primitive",B({ref:j,object:g,enableDamping:c},d))});function zn(t){const s=t+"Geometry";return b.forwardRef(({args:r,children:e,...c},a)=>b.createElement("mesh",B({ref:a},c),b.createElement(s,{attach:"geometry",args:r}),e))}const In=zn("circle"),kt=t=>{const s=b.useRef();return b.useEffect(()=>{s.current=t}),s.current},ee=10,Rn=2,Bn=2,Pt=10,Fn=10,Ct=(t,s,r)=>{const a=new A().subVectors(s,t).normalize().multiplyScalar(r);return new A().addVectors(t,a)},Vn=(t,s,r,e)=>{const c=new A().lerpVectors(t,s,.5),a=new A().subVectors(s,t).normalize(),u=new A(-a.y,a.x,a.z).normalize(),l=(r-e/2)*Fn;return new A().addVectors(c,u.multiplyScalar(l))},Bt=({links:t,nodes:s})=>{const r=b.useRef(null),{camera:e}=te(),c=new A,a=new A,u=new A,l=new A,d=new A,j=new A,i=new A,f=new A;return $e(()=>{r.current&&s&&r.current.children.forEach((m,h)=>{var D,_,V,C;const y=t[h];if(!y)return;const P=s.find(T=>T.ref_id===y.source),v=s.find(T=>T.ref_id===y.target);c.set((v==null?void 0:v.x)||0,(v==null?void 0:v.y)||0,(v==null?void 0:v.z)||0),a.set((P==null?void 0:P.x)||0,(P==null?void 0:P.y)||0,(P==null?void 0:P.z)||0);const O=m.children[0],S=m.children[1],$=m.children[2],g=m.children[3],x=t.filter(T=>T.source===y.source&&T.target===y.target||T.source===y.target&&T.target===y.source).length,M=t.filter((T,X)=>X<h&&(T.source===y.source&&T.target===y.target||T.source===y.target&&T.target===y.source)).length;if((v==null?void 0:v.ref_id)===(P==null?void 0:P.ref_id)){const[T,X,F]=Mo(c);(D=O.setPoints)==null||D.call(O,c,F,T),(_=S.setPoints)==null||_.call(S,F,a,T),$.position.set(F.x,F.y,X.z),$.lookAt(T),$.rotateX(-Math.PI/2),g.position.set(F.x,F.y,X.z),g.lookAt(e.position)}else{f.copy(Ct(c,a,ee)),i.copy(Ct(a,c,ee+.5)),u.lerpVectors(f,i,.5),x>1?u.copy(Vn(f,i,M,x)):u.lerpVectors(f,i,.5);const T=30;l.subVectors(i,f).normalize().multiplyScalar(T/2),d.subVectors(u,l),j.addVectors(u,l);const X=new A().addVectors(f,d).multiplyScalar(.5),F=new A().addVectors(j,i).multiplyScalar(.5);(V=O.setPoints)==null||V.call(O,f,d,X),(C=S.setPoints)==null||C.call(S,j,i,F),$.position.set(i.x,i.y,i.z),$.lookAt(f),$.rotateX(-Math.PI/2),g.position.set(u.x,u.y,u.z),g.lookAt(e.position);let q=Math.atan2(i.y-f.y,i.x-f.x);(q>Math.PI/2||q<-Math.PI/2)&&(q+=Math.PI),g.rotation.set(0,0,q);const H=f.distanceTo(i),G=H<T?2:4;H<T?g.text=Ve(y.edge_type,Pt):g.text=y.edge_type,g.fontSize=G}})}),o.jsx("group",{ref:r,children:t.map(m=>o.jsxs("group",{children:[o.jsx(Et,{color:"white",end:[0,0,0],lineWidth:1,start:[0,0,0]}),o.jsx(Et,{color:"white",end:[0,0,0],lineWidth:1,start:[0,0,0]}),o.jsxs("mesh",{position:new A(0,0,0),children:[o.jsx("coneGeometry",{args:[Rn,Bn,32]}),o.jsx("meshBasicMaterial",{color:"white"})]}),o.jsx(zt,{anchorX:"center",anchorY:"middle",color:"white",fontSize:4,lineHeight:1,maxWidth:20,rotation:[0,0,0],textAlign:"center",children:Ve(m.edge_type,Pt)})]},m.ref_id))})};Bt.displayName="Lines";const Wn=["#ff13c9","#5af0ff","#3233ff","#c2f0c2","#ff6666","#99ccff","#ffb3b3"],Yn=I.div`
  color: white;
  background: rgba(0, 0, 0, 1);
  padding: 2px 5px;
  border-radius: 4px;
  word-wrap: break-word;
  text-align: center;
  white-space: nowrap;
  visibility: visible;
  font-size: 12px;
  font-style: normal;
  font-weight: 400;
`,Un=I(Do)`
  position: absolute;
`;new po(2,2,2);const Ft=b.memo(({node:t,setSelectedNode:s,onSimulationUpdate:r,isSelected:e})=>{var P;const c=b.useRef(null),[a,u]=b.useState(!1);console.log(e);const{size:l,camera:d}=te(),j=vo(v=>{if(t.type==="Thing")return;const{xy:[O,S],down:$,dragging:g,first:x,elapsedTime:M}=v;if(!(!g||x||M<100)&&$&&c.current){r();const D=(O-l.left)/window.innerWidth*l.width,_=(S-l.top)/window.innerHeight*l.height,T=new A(D/l.width*2-1,-_/l.height*2+1,0).unproject(d).multiply(new A(1,1,0)).clone();t.fx=T.x,t.fy=T.y}});$e(()=>{c.current&&c.current.position.set(t.x||0,t.y||0,0)});const i=Wn[(P=t==null?void 0:t.children)==null?void 0:P.length]||"red",f=v=>{v.stopPropagation(),t.type!=="Thing"&&s()},m=Ve(t.type||"",ee),h=()=>{u(!0)},y=()=>{u(!1)};return o.jsxs("mesh",{ref:c,onClick:f,...j(),onPointerOut:y,onPointerOver:h,position:new A(t.x,t.y,0),children:[o.jsx(In,{args:[ee,30,20],children:o.jsx("meshStandardMaterial",{attach:"material",color:i})}),o.jsx(zt,{...zo,clipRect:[-ee,-ee,ee,ee],color:"#000",fontSize:2,maxWidth:ee*2,textAlign:"left",children:m}),a&&o.jsx(Un,{position:[0,5,0],zIndexRange:[100,0],children:o.jsx(Yn,{children:t.type})})]})});Ft.displayName="Node";const Gn=({simulation:t,setSelectedSchemaId:s,selectedId:r,setIsAddEdgeNode:e})=>{const[c]=Rt(u=>[u.schemas]),a=()=>{t&&(t.alpha(.05),t.restart())};return o.jsx(o.Fragment,{children:c.map((u,l)=>{const d=t.nodes()[l];return d?o.jsx(Ft,{isSelected:d.ref_id===r,node:d,onSimulationUpdate:a,setSelectedNode:()=>{e(!1),s(d.ref_id)}},d.ref_id):null})})},Hn=({schemasWithPositions:t,filteredLinks:s,setSelectedSchemaId:r,selectedSchemaId:e,setIsAddEdgeNode:c})=>{const[a,u]=b.useState(null),l=kt(t),d=kt(s);return b.useEffect(()=>{if(!t.length||!s.length)return;const j=structuredClone(t),i=structuredClone(s);if(a){l&&l.length!==t.length&&d&&d.length!==s.length&&(a.nodes(j).force("link",pt(i).id(m=>m.ref_id).distance(100)).force("charge",ft()).force("center",ht()).force("collide",mt(ee+5)).alpha(.5).restart(),u({...a}));return}const f=fo(j).force("link",pt(i).id(m=>m.ref_id).distance(120)).force("charge",ft().strength(-100)).force("center",ht()).force("collide",mt(ee+5));u(f)},[t,a,s,l,d]),$e(()=>{}),a?o.jsxs(o.Fragment,{children:[o.jsx(Bt,{links:s,nodes:a.nodes()}),o.jsx(Gn,{selectedId:e,setIsAddEdgeNode:c,setSelectedSchemaId:r,simulation:a})]}):null},Fe=new ho(0),Zn=({selectedSchemaId:t,links:s,schemasWithPositions:r,setSelectedSchemaId:e,setIsAddEdgeNode:c})=>o.jsxs(_o,{camera:{zoom:1,position:[0,0,200]},id:"schema-canvas",linear:!0,orthographic:!0,children:[o.jsx("color",{args:[Fe.r,Fe.g,Fe.b],attach:"background"}),mo&&o.jsx(Io,{position:"right-bottom"}),o.jsx(Kn,{}),o.jsx(Ro,{}),o.jsx(Hn,{filteredLinks:s,schemasWithPositions:r,selectedSchemaId:t,setIsAddEdgeNode:c,setSelectedSchemaId:e})]}),Kn=()=>{b.useEffect(()=>{const r=c=>{["Meta","Alt"].includes(c.key)&&(document.body.style.cursor="grab")},e=c=>{["Meta","Alt"].includes(c.key)&&(document.body.style.cursor="default")};return window.addEventListener("keydown",r,!1),window.addEventListener("keyup",e,!1),()=>{window.removeEventListener("keydown",r,!1),window.removeEventListener("keyup",e,!1)}},[]);const t=()=>{document.body.style.cursor="grabbing"},s=()=>{document.body.style.cursor="default"};return o.jsx(_n,{dampingFactor:1,enableDamping:!0,enablePan:!0,enableRotate:!1,enableZoom:!0,maxZoom:20,minZoom:1,onEnd:s,onStart:t,zoomSpeed:1.5,zoomToCursor:!0})},Xn=({onCreateNew:t,onAddEdgeNode:s})=>o.jsxs(qn,{children:[o.jsx(Qn,{children:"BLUEPRINT"}),o.jsxs(Tt,{"data-testid":"add-schema-type",onClick:t,children:[o.jsx(St,{children:o.jsx(bt,{})}),o.jsx(K,{children:"Add Type"})]}),o.jsxs(Tt,{"data-testid":"add-edge",onClick:s,children:[o.jsx(St,{children:o.jsx(bt,{})}),o.jsx(K,{children:"Add Edge"})]})]}),qn=I(w).attrs({align:"flex-start",direction:"column",justify:"flex-start"})`
  flex: 1 1 auto;
  z-index: 31;
  transition: opacity 1s;
  background: ${z.BG2};
  max-height: 100vh;
  border-top-left-radius: 9px;
  border-bottom-left-radius: 9px;

  @media (max-width: 1440px) {
    max-height: 95.2vh;
  }

  @media (max-width: 1024px) {
    max-height: 74.8vh;
  }

  @media (max-width: 924px) {
    max-height: 73.1vh;
  }
`,Tt=I(w).attrs({align:"center",justify:"center",p:0})`
  position: relative;
  width: 64px;
  height: 58px;
  padding: 0;
  flex-direction: row;
  color: ${z.GRAY6};
  cursor: pointer;
  transition: ${({theme:t})=>t.transitions.create(["opacity","box-shadow","background-color"])};

  &:before {
    content: '';
    position: absolute;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    width: 4px; /* Initial width */
    height: 32px; /* Initial height on hover */
    background-color: transparent;
    transition: height 0.3s, width 0.3s, background-color 0.3s;
  }

  ${K} {
    display: none;
    opacity: 0;
    width: 0;
    padding: 4px 10px;
    border-radius: 4px;
    background: #000;
    box-shadow: 0px 4px 8px 0px rgba(0, 0, 0, 0.25);
    position: absolute;
    left: 90%;
    z-index: 99;
    white-space: nowrap;
    visibility: visible;
    font-size: 11px;
    font-style: normal;
    font-weight: 400;
    transition: ${({theme:t})=>t.transitions.create(["opacity","visually"])};
  }

  &:hover {
    color: ${z.white};

    &:before {
      width: 3px;
      height: 32px;
      background-color: ${z.primaryBlue};
    }

    ${K} {
      display: block;
      width: min-content;
      opacity: 1;
      visibility: visible;
    }
  }

  &:active {
    color: ${z.white};
    background: ${z.black};
    &:before {
      width: 3px;
      height: 100%;
      background-color: ${z.primaryBlue};
    }
  }

  &.root {
    border-radius: 50%;
    padding: 0;
    align-items: center;
    justify-content: center;
    border: none;
  }
`,Qn=I(w)`
  background: blue;
  align-items: center;
  justify-content: center;
  background: ${z.primaryBlue};
  width: 64px;
  height: 64px;
  cursor: pointer;
  font-size: 10px;
  font-weight: 600;
  color: ${z.white};
`,St=I(w)`
  justify-content: center;
  align-items: center;
  font-size: 24px;
`,Jn={type:"",parent:""},Ot=({onSelect:t,dataTestId:s})=>{const r=Ke({mode:"onChange",defaultValues:Jn}),{watch:e,setValue:c}=r,[a,u]=b.useState([]),[l,d]=b.useState(!1),j=h=>{c("parent",(h==null?void 0:h.value)||""),t(h==null?void 0:h.value)},i=h=>h.charAt(0).toUpperCase()+h.slice(1);b.useEffect(()=>{(async()=>{d(!0);try{const P=(await $t()).schemas.filter(v=>!v.is_deleted&&v.type).map(v=>(v==null?void 0:v.type)==="thing"?{label:"No Parent",value:v.type}:{label:i(v.type),value:v.type});u(P)}catch(y){console.warn(y)}finally{d(!1)}})()},[]);const f=e("parent"),m=()=>a==null?void 0:a.find(h=>h.value===f);return o.jsx(Me,{dataTestId:s,isLoading:l,onSelect:j,options:a||Po,selectedValue:m()})},es=({selectedType:t,setSelectedFromNode:s,setSelectedToNode:r})=>o.jsxs(w,{children:[o.jsx(w,{align:"center",direction:"row",justify:"space-between",mb:35,children:o.jsx(w,{align:"center",direction:"row",children:o.jsx(ts,{children:"Add Edge"})})}),o.jsxs(w,{mb:25,children:[o.jsx(w,{mb:12,children:o.jsx(K,{children:"Source"})}),o.jsx(Ot,{dataTestId:"from_node",onSelect:s})]}),o.jsxs(w,{mb:10,children:[o.jsx(w,{mb:12,children:o.jsx(K,{children:"Edge Name"})}),o.jsx(w,{mb:12,children:o.jsx(Ae,{id:"cy-item-name",maxLength:250,name:"type",placeholder:"Enter type name",rules:{...Se},value:t})})]}),o.jsxs(w,{mb:25,children:[o.jsx(w,{mb:12,children:o.jsx(K,{children:"Destination"})}),o.jsx(Ot,{dataTestId:"to_node",onSelect:r})]})]}),ts=I(K)`
  font-size: 22px;
  font-weight: 600;
`,os=({onCancel:t})=>{const s=Ke({mode:"onChange"}),[r,e]=b.useState(!1),[c,a]=b.useState(""),[u,l]=b.useState(""),[d,j]=b.useState(""),i=s.watch("type");b.useEffect(()=>{a(i)},[i]);const f=s.handleSubmit(async h=>{if(!d||!u)return;e(!0);const y={source:u,target:d,edge_type:h.type};try{await go(y)}catch(P){console.warn("API Error:",P)}finally{e(!1),t()}}),m=r||!d||!u||!c;return o.jsx(_t,{...s,children:o.jsxs("form",{id:"add-type-form",onSubmit:f,children:[o.jsx(es,{selectedType:c,setSelectedFromNode:l,setSelectedToNode:j}),o.jsxs(ns,{color:"secondary",disabled:m,onClick:f,size:"large",variant:"contained",children:["Confirm",r&&o.jsxs(ss,{children:[" ",o.jsx(we,{color:z.lightGray,size:12})," "]})]})]})})},ns=I(Le)`
  width: 293px !important;
  margin: 0 0 10px auto !important;
`,ss=I.span`
  margin-top: 2px;
`,rs=({setIsAddEdgeNode:t})=>{const s=()=>{t(!1)};return o.jsxs(w,{children:[o.jsx(w,{direction:"row",justify:"flex-end",children:o.jsx(is,{"data-testid":"close-sidebar-sub-view",onClick:s,children:o.jsx(Dt,{})})}),o.jsx(os,{onCancel:s})]})},is=I(w)`
  font-size: 32px;
  color: ${z.white};
  cursor: pointer;
`,as=()=>{const[t,s]=b.useState(""),[r,e]=b.useState(!1),[c,a]=b.useState(!1),[u,l]=b.useState(!1),[d,j]=b.useState(!1),[i,f,m,h]=Rt(g=>[g.schemas,g.links,g.setSchemas,g.setSchemaLinks]);b.useEffect(()=>{(async()=>{a(!0);try{const x=await gt(),M=x.schemas.filter(D=>D.ref_id&&!D.is_deleted);m(M.length>0?M:x.schemas),h(x.edges.length>0?x.edges:[]),a(!1)}catch(x){console.error("Error fetching data:",x),a(!1)}})()},[m,h]);const y=g=>{if(i.some(M=>M.ref_id===g.ref_id))m(i.map(M=>M.ref_id===g.ref_id?{...g,children:[]}:M));else{m([...i,{...g,children:[]}]);const M=i.find(D=>g.parent===D.type);h([...f,{ref_id:`new-link-${f.length}`,edge_type:"CHILD_OF",source:g.ref_id||"new",target:(M==null?void 0:M.ref_id)||"new"}])}},P=async()=>{const g=await gt();m(g.schemas.filter(x=>x.ref_id&&!x.is_deleted&&x.ref_id)),h(g.edges)},v=g=>{m(i.filter(x=>x.type!==g))},O=i.map(g=>({...g,children:i.filter(x=>x.parent===g.type).map(x=>x.ref_id||"")})),S=f.filter(g=>O.some(x=>x.ref_id===g.source)&&O.some(x=>x.ref_id===g.target)),$=i.find(g=>g.ref_id===t)||null;return c?o.jsx(w,{align:"center",basis:"100%",grow:1,justify:"center",shrink:1,children:o.jsx(we,{color:z.white})}):o.jsx(o.Fragment,{children:o.jsxs(w,{align:"stretch",direction:"row",grow:1,children:[o.jsx(w,{ml:-20,my:-20,children:o.jsx(Xn,{onAddEdgeNode:()=>{l(!0),e(!1),s("")},onCreateNew:()=>{l(!1),e(!0),s("")}})}),o.jsx(w,{children:$||r?o.jsx(Mt,{children:o.jsx(At,{children:o.jsx(Sn,{graphLoading:d,onDelete:v,onSchemaCreate:y,onSchemaUpdate:P,selectedSchema:$,setGraphLoading:j,setIsCreateNew:e,setSelectedSchemaId:s})})}):null}),o.jsx(w,{children:u?o.jsx(Mt,{children:o.jsx(At,{children:o.jsx(rs,{setIsAddEdgeNode:l})})}):null}),o.jsx(cs,{direction:"row",grow:1,children:o.jsx(ls,{children:d?o.jsx(w,{align:"center",basis:"100%",grow:1,justify:"center",shrink:1,children:o.jsx(we,{color:z.white})}):o.jsx(Zn,{links:S,schemasWithPositions:O,selectedSchemaId:t,setIsAddEdgeNode:l,setSelectedSchemaId:s})})})]})})},cs=I(w)`
  flex: 1 1 auto;
  justify-content: center;
  position: relative;
  overflow: hidden;
  margin: calc(0px - 10px);
  max-height: calc(100vh - 20px);

  @media (max-width: 1440px) {
    max-height: calc(95vh - 20px);
  }

  @media (max-width: 1024px) {
    max-height: calc(70vh - 20px);
  }

  @media (max-width: 924px) {
    max-height: calc(70vh - 20px);
  }
`,Mt=I(w)`
  width: 100%;
  max-width: 400px;
  background: ${z.BG1};
  border-top-right-radius: 16px;
  border-bottom-right-radius: 16px;
  flex-grow: 1;
  flex-shrink: 1;
  min-width: 300px;
  overflow: hidden;
  max-height: calc(100vh - 20px);

  @media (max-width: 1440px) {
    max-height: calc(95vh - 20px);
  }

  @media (max-width: 1024px) {
    max-height: calc(70vh - 20px);
  }

  @media (max-width: 924px) {
    max-height: calc(70vh - 20px);
  }
`,At=I.div`
  height: 100%;
  overflow-y: auto;
  padding: 16px;
`,ls=I(w)`
  flex: 1 1 100%;
`,ds=()=>{const{close:t}=Lt("blueprintGraph"),s=()=>{t()};return o.jsx(xo,{background:"black",id:"blueprintGraph",kind:"full",onClose:s,preventOutsideClose:!0,children:o.jsx(as,{})})},Ds=b.memo(ds);export{Ds as BlueprintModal};
