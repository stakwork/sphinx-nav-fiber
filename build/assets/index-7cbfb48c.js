import{g as Ae,a as Le,s as se,_ as B,a9 as Ft,r as b,b as Re,j as s,d as Ie,c as ne,e as ze,u as wt,aM as Vt,b4 as ve,b5 as Be,a7 as rt,b6 as Yt,b7 as Ut,a0 as Gt,f as U,F as C,h as F,D as Ne,a_ as Wt,T as te,B as jt,N as we,aY as fe,a$ as Ht,b8 as Zt,b9 as Kt,ba as Xt,Z as N,bb as re,bc as ie,ap as it,bd as be,be as xe,bf as at,bg as W,bh as qt,ar as Qt,bi as ct,bj as lt,bk as dt,bl as ut,bm as Jt,am as eo,W as to,bn as pt}from"./index-758a440b.js";import{B as oo}from"./index-f6dd1ae3.js";import{q as no,r as so,i as ro,C as je,I as io,B as Fe,c as ao,b as co,F as lo,s as uo}from"./react-toastify.esm-47dc5d84.js";import{e as po,A as De}from"./index-238efd44.js";import{T as _e}from"./index-56df5078.js";import{c as ft,d as fo}from"./index-6086ed58.js";import{D as ho,P as mo}from"./PlusIcon-914c66ce.js";import{p as go,c as bo}from"./index-30d16895.js";import{u as xo}from"./Popover-fd374a3c.js";import{u as yo}from"./index-1b13d312.js";import{L as wo,m as jo,u as q,b as Ee,T as vo,C as Eo}from"./constant-06a1f7e4.js";import{f as ko,P as Po,L as Co}from"./constants-d722fd41.js";import{A as To}from"./AddContentIcon-ec041957.js";import"./useSlotProps-15a3c690.js";import"./Popper-477ec0b3.js";import"./index.esm-9b32ee46.js";import"./InfoIcon-80b8d650.js";import"./generateCategoricalChart-5313664f.js";import"./NoFilterResultIcon-155b7069.js";import"./index-04476a1d.js";import"./index-dceca974.js";import"./CheckIcon-16d1253d.js";function Oo(t){return Ae("PrivateSwitchBase",t)}Le("PrivateSwitchBase",["root","checked","disabled","input","edgeStart","edgeEnd"]);const Mo=["autoFocus","checked","checkedIcon","className","defaultChecked","disabled","disableFocusRipple","edge","icon","id","inputProps","inputRef","name","onBlur","onChange","onFocus","readOnly","required","tabIndex","type","value"],$o=t=>{const{classes:o,checked:r,disabled:e,edge:a}=t,c={root:["root",r&&"checked",e&&"disabled",a&&`edge${ne(a)}`],input:["input"]};return ze(c,Oo,o)},So=se(no)(({ownerState:t})=>B({padding:9,borderRadius:"50%"},t.edge==="start"&&{marginLeft:t.size==="small"?-3:-12},t.edge==="end"&&{marginRight:t.size==="small"?-3:-12})),No=se("input",{shouldForwardProp:Ft})({cursor:"inherit",position:"absolute",opacity:0,width:"100%",height:"100%",top:0,left:0,margin:0,padding:0,zIndex:1}),Do=b.forwardRef(function(o,r){const{autoFocus:e,checked:a,checkedIcon:c,className:h,defaultChecked:i,disabled:d,disableFocusRipple:m=!1,edge:l=!1,icon:p,id:f,inputProps:j,inputRef:O,name:$,onBlur:S,onChange:P,onFocus:x,readOnly:E,required:w=!1,tabIndex:k,type:A,value:Y}=o,L=Re(o,Mo),[G,v]=yo({controlled:a,default:!!i,name:"SwitchBase",state:"checked"}),I=xo(),ce=D=>{x&&x(D),I&&I.onFocus&&I.onFocus(D)},Q=D=>{S&&S(D),I&&I.onBlur&&I.onBlur(D)},J=D=>{if(D.nativeEvent.defaultPrevented)return;const le=D.target.checked;v(le),P&&P(D,le)};let H=d;I&&typeof H>"u"&&(H=I.disabled);const T=A==="checkbox"||A==="radio",_=B({},o,{checked:G,disabled:H,disableFocusRipple:m,edge:l}),R=$o(_);return s.jsxs(So,B({component:"span",className:Ie(R.root,h),centerRipple:!0,focusRipple:!m,disabled:H,tabIndex:null,role:void 0,onFocus:ce,onBlur:Q,ownerState:_,ref:r},L,{children:[s.jsx(No,B({autoFocus:e,checked:a,defaultChecked:i,className:R.input,disabled:H,id:T?f:void 0,name:$,onChange:J,readOnly:E,ref:O,required:w,ownerState:_,tabIndex:k,type:A},A==="checkbox"&&Y===void 0?{}:{value:Y},j)),G?c:p]}))}),_o=Do,Ao=b.createContext(),ht=Ao;function Lo(t){return Ae("MuiGrid",t)}const Ro=[0,1,2,3,4,5,6,7,8,9,10],Io=["column-reverse","column","row-reverse","row"],zo=["nowrap","wrap-reverse","wrap"],pe=["auto",!0,1,2,3,4,5,6,7,8,9,10,11,12],Bo=Le("MuiGrid",["root","container","item","zeroMinWidth",...Ro.map(t=>`spacing-xs-${t}`),...Io.map(t=>`direction-xs-${t}`),...zo.map(t=>`wrap-xs-${t}`),...pe.map(t=>`grid-xs-${t}`),...pe.map(t=>`grid-sm-${t}`),...pe.map(t=>`grid-md-${t}`),...pe.map(t=>`grid-lg-${t}`),...pe.map(t=>`grid-xl-${t}`)]),he=Bo,Fo=["className","columns","columnSpacing","component","container","direction","item","rowSpacing","spacing","wrap","zeroMinWidth"];function ae(t){const o=parseFloat(t);return`${o}${String(t).replace(String(o),"")||"px"}`}function Vo({theme:t,ownerState:o}){let r;return t.breakpoints.keys.reduce((e,a)=>{let c={};if(o[a]&&(r=o[a]),!r)return e;if(r===!0)c={flexBasis:0,flexGrow:1,maxWidth:"100%"};else if(r==="auto")c={flexBasis:"auto",flexGrow:0,flexShrink:0,maxWidth:"none",width:"auto"};else{const h=ve({values:o.columns,breakpoints:t.breakpoints.values}),i=typeof h=="object"?h[a]:h;if(i==null)return e;const d=`${Math.round(r/i*1e8)/1e6}%`;let m={};if(o.container&&o.item&&o.columnSpacing!==0){const l=t.spacing(o.columnSpacing);if(l!=="0px"){const p=`calc(${d} + ${ae(l)})`;m={flexBasis:p,maxWidth:p}}}c=B({flexBasis:d,flexGrow:0,maxWidth:d},m)}return t.breakpoints.values[a]===0?Object.assign(e,c):e[t.breakpoints.up(a)]=c,e},{})}function Yo({theme:t,ownerState:o}){const r=ve({values:o.direction,breakpoints:t.breakpoints.values});return Be({theme:t},r,e=>{const a={flexDirection:e};return e.indexOf("column")===0&&(a[`& > .${he.item}`]={maxWidth:"none"}),a})}function vt({breakpoints:t,values:o}){let r="";Object.keys(o).forEach(a=>{r===""&&o[a]!==0&&(r=a)});const e=Object.keys(t).sort((a,c)=>t[a]-t[c]);return e.slice(0,e.indexOf(r))}function Uo({theme:t,ownerState:o}){const{container:r,rowSpacing:e}=o;let a={};if(r&&e!==0){const c=ve({values:e,breakpoints:t.breakpoints.values});let h;typeof c=="object"&&(h=vt({breakpoints:t.breakpoints.values,values:c})),a=Be({theme:t},c,(i,d)=>{var m;const l=t.spacing(i);return l!=="0px"?{marginTop:`-${ae(l)}`,[`& > .${he.item}`]:{paddingTop:ae(l)}}:(m=h)!=null&&m.includes(d)?{}:{marginTop:0,[`& > .${he.item}`]:{paddingTop:0}}})}return a}function Go({theme:t,ownerState:o}){const{container:r,columnSpacing:e}=o;let a={};if(r&&e!==0){const c=ve({values:e,breakpoints:t.breakpoints.values});let h;typeof c=="object"&&(h=vt({breakpoints:t.breakpoints.values,values:c})),a=Be({theme:t},c,(i,d)=>{var m;const l=t.spacing(i);return l!=="0px"?{width:`calc(100% + ${ae(l)})`,marginLeft:`-${ae(l)}`,[`& > .${he.item}`]:{paddingLeft:ae(l)}}:(m=h)!=null&&m.includes(d)?{}:{width:"100%",marginLeft:0,[`& > .${he.item}`]:{paddingLeft:0}}})}return a}function Wo(t,o,r={}){if(!t||t<=0)return[];if(typeof t=="string"&&!Number.isNaN(Number(t))||typeof t=="number")return[r[`spacing-xs-${String(t)}`]];const e=[];return o.forEach(a=>{const c=t[a];Number(c)>0&&e.push(r[`spacing-${a}-${String(c)}`])}),e}const Ho=se("div",{name:"MuiGrid",slot:"Root",overridesResolver:(t,o)=>{const{ownerState:r}=t,{container:e,direction:a,item:c,spacing:h,wrap:i,zeroMinWidth:d,breakpoints:m}=r;let l=[];e&&(l=Wo(h,m,o));const p=[];return m.forEach(f=>{const j=r[f];j&&p.push(o[`grid-${f}-${String(j)}`])}),[o.root,e&&o.container,c&&o.item,d&&o.zeroMinWidth,...l,a!=="row"&&o[`direction-xs-${String(a)}`],i!=="wrap"&&o[`wrap-xs-${String(i)}`],...p]}})(({ownerState:t})=>B({boxSizing:"border-box"},t.container&&{display:"flex",flexWrap:"wrap",width:"100%"},t.item&&{margin:0},t.zeroMinWidth&&{minWidth:0},t.wrap!=="wrap"&&{flexWrap:t.wrap}),Yo,Uo,Go,Vo);function Zo(t,o){if(!t||t<=0)return[];if(typeof t=="string"&&!Number.isNaN(Number(t))||typeof t=="number")return[`spacing-xs-${String(t)}`];const r=[];return o.forEach(e=>{const a=t[e];if(Number(a)>0){const c=`spacing-${e}-${String(a)}`;r.push(c)}}),r}const Ko=t=>{const{classes:o,container:r,direction:e,item:a,spacing:c,wrap:h,zeroMinWidth:i,breakpoints:d}=t;let m=[];r&&(m=Zo(c,d));const l=[];d.forEach(f=>{const j=t[f];j&&l.push(`grid-${f}-${String(j)}`)});const p={root:["root",r&&"container",a&&"item",i&&"zeroMinWidth",...m,e!=="row"&&`direction-xs-${String(e)}`,h!=="wrap"&&`wrap-xs-${String(h)}`,...l]};return ze(p,Lo,o)},Xo=b.forwardRef(function(o,r){const e=wt({props:o,name:"MuiGrid"}),{breakpoints:a}=Vt(),c=po(e),{className:h,columns:i,columnSpacing:d,component:m="div",container:l=!1,direction:p="row",item:f=!1,rowSpacing:j,spacing:O=0,wrap:$="wrap",zeroMinWidth:S=!1}=c,P=Re(c,Fo),x=j||O,E=d||O,w=b.useContext(ht),k=l?i||12:w,A={},Y=B({},P);a.keys.forEach(v=>{P[v]!=null&&(A[v]=P[v],delete Y[v])});const L=B({},c,{columns:k,container:l,direction:p,item:f,rowSpacing:x,columnSpacing:E,wrap:$,zeroMinWidth:S,spacing:O},A,{breakpoints:a.keys}),G=Ko(L);return s.jsx(ht.Provider,{value:k,children:s.jsx(Ho,B({ownerState:L,className:Ie(G.root,h),as:m,ref:r},Y))})}),oe=Xo;function qo(t){return Ae("MuiSwitch",t)}const Qo=Le("MuiSwitch",["root","edgeStart","edgeEnd","switchBase","colorPrimary","colorSecondary","sizeSmall","sizeMedium","checked","disabled","input","thumb","track"]),V=Qo,Jo=["className","color","edge","size","sx"],en=t=>{const{classes:o,edge:r,size:e,color:a,checked:c,disabled:h}=t,i={root:["root",r&&`edge${ne(r)}`,`size${ne(e)}`],switchBase:["switchBase",`color${ne(a)}`,c&&"checked",h&&"disabled"],thumb:["thumb"],track:["track"],input:["input"]},d=ze(i,qo,o);return B({},o,d)},tn=se("span",{name:"MuiSwitch",slot:"Root",overridesResolver:(t,o)=>{const{ownerState:r}=t;return[o.root,r.edge&&o[`edge${ne(r.edge)}`],o[`size${ne(r.size)}`]]}})(({ownerState:t})=>B({display:"inline-flex",width:34+12*2,height:14+12*2,overflow:"hidden",padding:12,boxSizing:"border-box",position:"relative",flexShrink:0,zIndex:0,verticalAlign:"middle","@media print":{colorAdjust:"exact"}},t.edge==="start"&&{marginLeft:-8},t.edge==="end"&&{marginRight:-8},t.size==="small"&&{width:40,height:24,padding:7,[`& .${V.thumb}`]:{width:16,height:16},[`& .${V.switchBase}`]:{padding:4,[`&.${V.checked}`]:{transform:"translateX(16px)"}}})),on=se(_o,{name:"MuiSwitch",slot:"SwitchBase",overridesResolver:(t,o)=>{const{ownerState:r}=t;return[o.switchBase,{[`& .${V.input}`]:o.input},r.color!=="default"&&o[`color${ne(r.color)}`]]}})(({theme:t})=>({position:"absolute",top:0,left:0,zIndex:1,color:t.vars?t.vars.palette.Switch.defaultColor:`${t.palette.mode==="light"?t.palette.common.white:t.palette.grey[300]}`,transition:t.transitions.create(["left","transform"],{duration:t.transitions.duration.shortest}),[`&.${V.checked}`]:{transform:"translateX(20px)"},[`&.${V.disabled}`]:{color:t.vars?t.vars.palette.Switch.defaultDisabledColor:`${t.palette.mode==="light"?t.palette.grey[100]:t.palette.grey[600]}`},[`&.${V.checked} + .${V.track}`]:{opacity:.5},[`&.${V.disabled} + .${V.track}`]:{opacity:t.vars?t.vars.opacity.switchTrackDisabled:`${t.palette.mode==="light"?.12:.2}`},[`& .${V.input}`]:{left:"-100%",width:"300%"}}),({theme:t,ownerState:o})=>B({"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette.action.activeChannel} / ${t.vars.palette.action.hoverOpacity})`:rt(t.palette.action.active,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},o.color!=="default"&&{[`&.${V.checked}`]:{color:(t.vars||t).palette[o.color].main,"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette[o.color].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:rt(t.palette[o.color].main,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${V.disabled}`]:{color:t.vars?t.vars.palette.Switch[`${o.color}DisabledColor`]:`${t.palette.mode==="light"?Yt(t.palette[o.color].main,.62):Ut(t.palette[o.color].main,.55)}`}},[`&.${V.checked} + .${V.track}`]:{backgroundColor:(t.vars||t).palette[o.color].main}})),nn=se("span",{name:"MuiSwitch",slot:"Track",overridesResolver:(t,o)=>o.track})(({theme:t})=>({height:"100%",width:"100%",borderRadius:14/2,zIndex:-1,transition:t.transitions.create(["opacity","background-color"],{duration:t.transitions.duration.shortest}),backgroundColor:t.vars?t.vars.palette.common.onBackground:`${t.palette.mode==="light"?t.palette.common.black:t.palette.common.white}`,opacity:t.vars?t.vars.opacity.switchTrack:`${t.palette.mode==="light"?.38:.3}`})),sn=se("span",{name:"MuiSwitch",slot:"Thumb",overridesResolver:(t,o)=>o.thumb})(({theme:t})=>({boxShadow:(t.vars||t).shadows[1],backgroundColor:"currentColor",width:20,height:20,borderRadius:"50%"})),rn=b.forwardRef(function(o,r){const e=wt({props:o,name:"MuiSwitch"}),{className:a,color:c="primary",edge:h=!1,size:i="medium",sx:d}=e,m=Re(e,Jo),l=B({},e,{color:c,edge:h,size:i}),p=en(l),f=s.jsx(sn,{className:p.thumb,ownerState:l});return s.jsxs(tn,{className:Ie(p.root,a),sx:d,ownerState:l,children:[s.jsx(on,B({type:"checkbox",icon:f,checkedIcon:f,ref:r,ownerState:l},m,{classes:B({},p,{root:p.switchBase})})),s.jsx(nn,{className:p.track,ownerState:l})]})}),an=rn,cn={schemas:[],links:[]},Et=Gt(t=>({...cn,setSchemas:o=>{t({schemas:o})},setSchemaLinks:o=>{t({links:o})}})),ln=/^[a-z0-9_]+$/,dn=({parentParam:t})=>{const[o,r]=b.useState(!1),[e,a]=b.useState([]),{fields:c,append:h,replace:i,remove:d}=so({name:"attributes"}),{setValue:m,watch:l}=ro();return b.useEffect(()=>{const p=async()=>{try{let f=[{required:!1,type:"string",key:""}];if(t!==fo.value.toLowerCase()){r(!0);const j=await Wt(t);f=go(j)}f=f.filter(j=>j.key!=="node_key"),i(f),a(f)}catch(f){console.warn(f)}finally{r(!1)}};e.length===0&&p()},[t,m,i,e.length]),s.jsxs(s.Fragment,{children:[o?s.jsx(C,{align:"center",children:s.jsx(je,{color:F.SECONDARY_BLUE,size:"30"})}):s.jsx(un,{py:8,children:s.jsx(oe,{container:!0,spacing:2,children:c.map((p,f)=>{const j=l(`attributes[${f}].type`),O=l(`attributes[${f}].required`),$=p.isNew||!1,S=["name"].includes(l(`attributes[${f}].key`));return s.jsxs(b.Fragment,{children:[s.jsx(oe,{item:!0,xs:5,children:s.jsx(_e,{autoComplete:"off",className:"text-input",disabled:!$,id:"cy-item-name",maxLength:50,name:`attributes.${f}.key`,placeholder:"Enter value",rules:{...Ne,pattern:{message:"Please avoid special characters, spaces and uppercase",value:ln}}})}),s.jsx(oe,{item:!0,xs:4,children:s.jsx(De,{disabled:S,onSelect:P=>m(`attributes[${f}].type`,P==null?void 0:P.value),options:ft,selectedValue:ft.find(P=>P.value===j)})}),s.jsxs(oe,{item:!0,xs:3,children:[s.jsx(an,{checked:O,disabled:S,name:`attributes.${f}.required`,onChange:P=>m(`attributes[${f}].required`,P.target.checked),size:"small"}),!S&&s.jsx(io,{onClick:()=>d(f),children:s.jsx(ho,{})})]})]},p.id)})})}),s.jsx(C,{align:"flex-start",py:12,children:s.jsx(Fe,{onClick:()=>h({key:"",type:"string",required:!0,isNew:!0}),size:"medium",startIcon:s.jsx(mo,{}),variant:"contained",children:"Add Attribute"})})]})},un=U(C)`
  overflow-y: auto;
  width: calc(100% + 20px);
  max-height: calc(80vh - 300px);
`,pn=({parent:t})=>{const o=t;return s.jsxs(C,{children:[s.jsx(C,{direction:"row",mb:10,children:s.jsxs(oe,{container:!0,spacing:2,children:[s.jsx(oe,{item:!0,xs:5,children:s.jsx(Me,{style:{marginRight:180},children:"Attributes"})}),s.jsx(oe,{item:!0,xs:4,children:s.jsx(Me,{style:{marginRight:130},children:"Type"})}),s.jsx(oe,{item:!0,xs:3,children:s.jsx(Me,{children:"Required"})})]})}),o&&s.jsx(dn,{parentParam:o},o)]})},Me=U(te)`
  font-size: 15px;
  color: gray;
`,mt={type:"",parent:""},fn=async(t,o=!1)=>{try{const{attributes:r,...e}=t,a={...e,attributes:bo(r)};let c;if(o?c=await we.put("/schema",JSON.stringify(a),{}):c=await we.post("/schema",JSON.stringify({...a,node_key:"name"}),{}),c.status!=="success")throw new Error("error");return c==null?void 0:c.ref_id}catch(r){let e=fe;if(r.status===400){const a=await r.json();e=a.errorCode||(a==null?void 0:a.status)||fe}else r instanceof Error&&(e=r.message);throw new Error(e)}},hn=({onSchemaCreate:t,selectedSchema:o,onDelete:r,setSelectedSchemaId:e,setGraphLoading:a,setIsCreateNew:c,onSchemaUpdate:h})=>{const{close:i,visible:d}=jt("addType"),m=ao({mode:"onChange",defaultValues:o?{type:o.type,parent:o.parent}:mt}),{watch:l,setValue:p,reset:f}=m,[j,O]=b.useState(!1),[$,S]=b.useState(!1),[P,x]=b.useState(null),[E,w]=b.useState(!1),[k,A]=b.useState(null),[Y,L]=b.useState(null);b.useEffect(()=>()=>{f()},[d,f]);const G=()=>{c(!1),e("")},v=T=>T.charAt(0).toUpperCase()+T.slice(1);b.useEffect(()=>{o||(async()=>{S(!0);try{const R=(await Ht()).schemas.filter(D=>!D.is_deleted&&D.type).map(D=>(D==null?void 0:D.type)==="thing"?{label:"No Parent",value:D.type}:{label:v(D.type),value:D.type});x(R)}catch(_){console.warn(_)}finally{S(!1)}})()},[o]),b.useEffect(()=>{if(o){p("type",o==null?void 0:o.type),p("parent",o.parent);const T=[{label:o.parent?v(o.parent):"No Parent",value:o.parent}];L(T)}else f(mt)},[o,p,f]);const I=l("parent"),ce=()=>{i()},Q=async()=>{if(o!=null&&o.type)try{await we.delete(`/schema/${o.ref_id}`),r(o.type),i()}catch(T){let _=fe;if((T==null?void 0:T.status)===400){const R=await T.json();_=R.errorCode||(R==null?void 0:R.status)||fe}else T instanceof Error&&(_=T.message);A(_)}finally{c(!1)}},J=m.handleSubmit(async T=>{if(!I){w(!0);return}O(!0);try{T.type!==(o==null?void 0:o.type)&&(a(!0),await we.put(`/schema/${o==null?void 0:o.ref_id}`,JSON.stringify({type:T.type})),await h(),a(!1));const _=await fn({...T,...o?{ref_id:o==null?void 0:o.ref_id}:{}},!!o);t({type:T.type,parent:I||"",ref_id:(o==null?void 0:o.ref_id)||_||"new"}),ce()}catch(_){if((_==null?void 0:_.status)===400){const R=await _.json();R.errorCode||R!=null&&R.status||fe}else _ instanceof Error&&_.message}finally{O(!1),c(!1)}}),H=()=>P==null?void 0:P.find(T=>T.value===I);return s.jsxs(C,{children:[s.jsx(C,{direction:"row",justify:"flex-end",children:s.jsx(gn,{"data-testid":"close-sidebar-sub-view",onClick:G,children:s.jsx(co,{})})}),s.jsx(C,{children:s.jsx(lo,{...m,children:s.jsxs("form",{id:"add-type-form",onSubmit:J,children:[s.jsx(C,{children:o?s.jsxs(s.Fragment,{children:[s.jsxs(C,{mb:12,children:[s.jsx(C,{mb:12,children:s.jsx(te,{children:"Name"})}),s.jsx(C,{mb:12,children:s.jsx(_e,{defaultValue:o==null?void 0:o.type,id:"cy-item-name",maxLength:250,name:"type",placeholder:"Enter type name",rules:{...Ne},value:I})})]}),s.jsxs(C,{mb:12,children:[s.jsx(C,{mb:12,children:s.jsx(te,{children:"Parent"})}),s.jsx(De,{isLoading:$,onSelect:T=>{p("parent",(T==null?void 0:T.value)||""),w(!1)},options:Y||[],selectedValue:P==null?void 0:P.find(T=>T.label===(o==null?void 0:o.parent))}),E&&s.jsx($e,{children:"A parent type must be selected"})]})]}):s.jsxs(s.Fragment,{children:[s.jsxs(C,{mb:12,children:[s.jsx(C,{mb:12,children:s.jsx(te,{children:"Select Parent"})}),s.jsx(De,{isLoading:$,onSelect:T=>{p("parent",(T==null?void 0:T.value)||""),w(!1)},options:P,selectedValue:H()}),E&&s.jsx($e,{children:"A parent type must be selected"})]}),s.jsxs(C,{children:[s.jsx(C,{mb:12,children:s.jsx(te,{children:"Type name"})}),s.jsx(C,{mb:12,children:s.jsx(_e,{id:"cy-item-name",maxLength:250,name:"type",placeholder:"Enter type name",rules:{...Ne},value:I})})]})]})}),s.jsx(pn,{parent:o?o.type:I}),s.jsxs(C,{direction:"row",justify:"space-between",mt:20,children:[o?s.jsxs(C,{direction:"column",children:[s.jsx(mn,{color:"secondary",onClick:Q,size:"large",style:{marginRight:20},variant:"contained",children:"Delete"}),k&&s.jsx($e,{children:k})]}):null,s.jsx(Fe,{color:"secondary",disabled:j||E,onClick:J,size:"large",startIcon:j?s.jsx(je,{color:F.white,size:10}):null,variant:"contained",children:"Save"})]})]})})})]})},mn=U(Fe)`
  && {
    color: ${F.primaryRed};
    background-color: rgba(237, 116, 116, 0.1);

    &:hover,
    &:active,
    &:focus {
      color: ${F.primaryRed};
      background-color: rgba(237, 116, 116, 0.2);
    }
  }
`,gn=U(C)`
  font-size: 32px;
  color: ${F.white};
  cursor: pointer;
`,$e=U(C)`
  font-size: 13px;
  font-family: Barlow;
  color: #ff8f80;
  line-height: 0.2px;
  margin-top: 12px;
  padding-top: 20px;
`;var bn=Object.defineProperty,xn=(t,o,r)=>o in t?bn(t,o,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[o]=r,g=(t,o,r)=>(xn(t,typeof o!="symbol"?o+"":o,r),r);const ye=new Zt,gt=new Kt,yn=Math.cos(70*(Math.PI/180)),bt=(t,o)=>(t%o+o)%o;let wn=class extends Xt{constructor(o,r){super(),g(this,"object"),g(this,"domElement"),g(this,"enabled",!0),g(this,"target",new N),g(this,"minDistance",0),g(this,"maxDistance",1/0),g(this,"minZoom",0),g(this,"maxZoom",1/0),g(this,"minPolarAngle",0),g(this,"maxPolarAngle",Math.PI),g(this,"minAzimuthAngle",-1/0),g(this,"maxAzimuthAngle",1/0),g(this,"enableDamping",!1),g(this,"dampingFactor",.05),g(this,"enableZoom",!0),g(this,"zoomSpeed",1),g(this,"enableRotate",!0),g(this,"rotateSpeed",1),g(this,"enablePan",!0),g(this,"panSpeed",1),g(this,"screenSpacePanning",!0),g(this,"keyPanSpeed",7),g(this,"zoomToCursor",!1),g(this,"autoRotate",!1),g(this,"autoRotateSpeed",2),g(this,"reverseOrbit",!1),g(this,"reverseHorizontalOrbit",!1),g(this,"reverseVerticalOrbit",!1),g(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),g(this,"mouseButtons",{LEFT:re.ROTATE,MIDDLE:re.DOLLY,RIGHT:re.PAN}),g(this,"touches",{ONE:ie.ROTATE,TWO:ie.DOLLY_PAN}),g(this,"target0"),g(this,"position0"),g(this,"zoom0"),g(this,"_domElementKeyEvents",null),g(this,"getPolarAngle"),g(this,"getAzimuthalAngle"),g(this,"setPolarAngle"),g(this,"setAzimuthalAngle"),g(this,"getDistance"),g(this,"listenToKeyEvents"),g(this,"stopListenToKeyEvents"),g(this,"saveState"),g(this,"reset"),g(this,"update"),g(this,"connect"),g(this,"dispose"),this.object=o,this.domElement=r,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>l.phi,this.getAzimuthalAngle=()=>l.theta,this.setPolarAngle=n=>{let u=bt(n,2*Math.PI),y=l.phi;y<0&&(y+=2*Math.PI),u<0&&(u+=2*Math.PI);let M=Math.abs(u-y);2*Math.PI-M<M&&(u<y?u+=2*Math.PI:y+=2*Math.PI),p.phi=u-y,e.update()},this.setAzimuthalAngle=n=>{let u=bt(n,2*Math.PI),y=l.theta;y<0&&(y+=2*Math.PI),u<0&&(u+=2*Math.PI);let M=Math.abs(u-y);2*Math.PI-M<M&&(u<y?u+=2*Math.PI:y+=2*Math.PI),p.theta=u-y,e.update()},this.getDistance=()=>e.object.position.distanceTo(e.target),this.listenToKeyEvents=n=>{n.addEventListener("keydown",Te),this._domElementKeyEvents=n},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",Te),this._domElementKeyEvents=null},this.saveState=()=>{e.target0.copy(e.target),e.position0.copy(e.object.position),e.zoom0=e.object.zoom},this.reset=()=>{e.target.copy(e.target0),e.object.position.copy(e.position0),e.object.zoom=e.zoom0,e.object.updateProjectionMatrix(),e.dispatchEvent(a),e.update(),d=i.NONE},this.update=(()=>{const n=new N,u=new N(0,1,0),y=new it().setFromUnitVectors(o.up,u),M=y.clone().invert(),z=new N,Z=new it,ee=2*Math.PI;return function(){const st=e.object.position;y.setFromUnitVectors(o.up,u),M.copy(y).invert(),n.copy(st).sub(e.target),n.applyQuaternion(y),l.setFromVector3(n),e.autoRotate&&d===i.NONE&&J(ce()),e.enableDamping?(l.theta+=p.theta*e.dampingFactor,l.phi+=p.phi*e.dampingFactor):(l.theta+=p.theta,l.phi+=p.phi);let K=e.minAzimuthAngle,X=e.maxAzimuthAngle;isFinite(K)&&isFinite(X)&&(K<-Math.PI?K+=ee:K>Math.PI&&(K-=ee),X<-Math.PI?X+=ee:X>Math.PI&&(X-=ee),K<=X?l.theta=Math.max(K,Math.min(X,l.theta)):l.theta=l.theta>(K+X)/2?Math.max(K,l.theta):Math.min(X,l.theta)),l.phi=Math.max(e.minPolarAngle,Math.min(e.maxPolarAngle,l.phi)),l.makeSafe(),e.enableDamping===!0?e.target.addScaledVector(j,e.dampingFactor):e.target.add(j),e.zoomToCursor&&G||e.object.isOrthographicCamera?l.radius=ke(l.radius):l.radius=ke(l.radius*f),n.setFromSpherical(l),n.applyQuaternion(M),st.copy(e.target).add(n),e.object.matrixAutoUpdate||e.object.updateMatrix(),e.object.lookAt(e.target),e.enableDamping===!0?(p.theta*=1-e.dampingFactor,p.phi*=1-e.dampingFactor,j.multiplyScalar(1-e.dampingFactor)):(p.set(0,0,0),j.set(0,0,0));let me=!1;if(e.zoomToCursor&&G){let de=null;if(e.object instanceof be&&e.object.isPerspectiveCamera){const ue=n.length();de=ke(ue*f);const ge=ue-de;e.object.position.addScaledVector(Y,ge),e.object.updateMatrixWorld()}else if(e.object.isOrthographicCamera){const ue=new N(L.x,L.y,0);ue.unproject(e.object),e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/f)),e.object.updateProjectionMatrix(),me=!0;const ge=new N(L.x,L.y,0);ge.unproject(e.object),e.object.position.sub(ge).add(ue),e.object.updateMatrixWorld(),de=n.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),e.zoomToCursor=!1;de!==null&&(e.screenSpacePanning?e.target.set(0,0,-1).transformDirection(e.object.matrix).multiplyScalar(de).add(e.object.position):(ye.origin.copy(e.object.position),ye.direction.set(0,0,-1).transformDirection(e.object.matrix),Math.abs(e.object.up.dot(ye.direction))<yn?o.lookAt(e.target):(gt.setFromNormalAndCoplanarPoint(e.object.up,e.target),ye.intersectPlane(gt,e.target))))}else e.object instanceof xe&&e.object.isOrthographicCamera&&(e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/f)),e.object.updateProjectionMatrix(),me=!0);return f=1,G=!1,me||z.distanceToSquared(e.object.position)>m||8*(1-Z.dot(e.object.quaternion))>m?(e.dispatchEvent(a),z.copy(e.object.position),Z.copy(e.object.quaternion),me=!1,!0):!1}})(),this.connect=n=>{n===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),e.domElement=n,e.domElement.style.touchAction="none",e.domElement.addEventListener("contextmenu",tt),e.domElement.addEventListener("pointerdown",Qe),e.domElement.addEventListener("pointercancel",Je),e.domElement.addEventListener("wheel",et)},this.dispose=()=>{var n,u,y,M,z,Z;(n=e.domElement)==null||n.removeEventListener("contextmenu",tt),(u=e.domElement)==null||u.removeEventListener("pointerdown",Qe),(y=e.domElement)==null||y.removeEventListener("pointercancel",Je),(M=e.domElement)==null||M.removeEventListener("wheel",et),(z=e.domElement)==null||z.ownerDocument.removeEventListener("pointermove",Pe),(Z=e.domElement)==null||Z.ownerDocument.removeEventListener("pointerup",Ce),e._domElementKeyEvents!==null&&e._domElementKeyEvents.removeEventListener("keydown",Te)};const e=this,a={type:"change"},c={type:"start"},h={type:"end"},i={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let d=i.NONE;const m=1e-6,l=new at,p=new at;let f=1;const j=new N,O=new W,$=new W,S=new W,P=new W,x=new W,E=new W,w=new W,k=new W,A=new W,Y=new N,L=new W;let G=!1;const v=[],I={};function ce(){return 2*Math.PI/60/60*e.autoRotateSpeed}function Q(){return Math.pow(.95,e.zoomSpeed)}function J(n){e.reverseOrbit||e.reverseHorizontalOrbit?p.theta+=n:p.theta-=n}function H(n){e.reverseOrbit||e.reverseVerticalOrbit?p.phi+=n:p.phi-=n}const T=(()=>{const n=new N;return function(y,M){n.setFromMatrixColumn(M,0),n.multiplyScalar(-y),j.add(n)}})(),_=(()=>{const n=new N;return function(y,M){e.screenSpacePanning===!0?n.setFromMatrixColumn(M,1):(n.setFromMatrixColumn(M,0),n.crossVectors(e.object.up,n)),n.multiplyScalar(y),j.add(n)}})(),R=(()=>{const n=new N;return function(y,M){const z=e.domElement;if(z&&e.object instanceof be&&e.object.isPerspectiveCamera){const Z=e.object.position;n.copy(Z).sub(e.target);let ee=n.length();ee*=Math.tan(e.object.fov/2*Math.PI/180),T(2*y*ee/z.clientHeight,e.object.matrix),_(2*M*ee/z.clientHeight,e.object.matrix)}else z&&e.object instanceof xe&&e.object.isOrthographicCamera?(T(y*(e.object.right-e.object.left)/e.object.zoom/z.clientWidth,e.object.matrix),_(M*(e.object.top-e.object.bottom)/e.object.zoom/z.clientHeight,e.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),e.enablePan=!1)}})();function D(n){e.object instanceof be&&e.object.isPerspectiveCamera||e.object instanceof xe&&e.object.isOrthographicCamera?f/=n:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function le(n){e.object instanceof be&&e.object.isPerspectiveCamera||e.object instanceof xe&&e.object.isOrthographicCamera?f*=n:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function Ye(n){if(!e.zoomToCursor||!e.domElement)return;G=!0;const u=e.domElement.getBoundingClientRect(),y=n.clientX-u.left,M=n.clientY-u.top,z=u.width,Z=u.height;L.x=y/z*2-1,L.y=-(M/Z)*2+1,Y.set(L.x,L.y,1).unproject(e.object).sub(e.object.position).normalize()}function ke(n){return Math.max(e.minDistance,Math.min(e.maxDistance,n))}function Ue(n){O.set(n.clientX,n.clientY)}function Ct(n){Ye(n),w.set(n.clientX,n.clientY)}function Ge(n){P.set(n.clientX,n.clientY)}function Tt(n){$.set(n.clientX,n.clientY),S.subVectors($,O).multiplyScalar(e.rotateSpeed);const u=e.domElement;u&&(J(2*Math.PI*S.x/u.clientHeight),H(2*Math.PI*S.y/u.clientHeight)),O.copy($),e.update()}function Ot(n){k.set(n.clientX,n.clientY),A.subVectors(k,w),A.y>0?D(Q()):A.y<0&&le(Q()),w.copy(k),e.update()}function Mt(n){x.set(n.clientX,n.clientY),E.subVectors(x,P).multiplyScalar(e.panSpeed),R(E.x,E.y),P.copy(x),e.update()}function $t(n){Ye(n),n.deltaY<0?le(Q()):n.deltaY>0&&D(Q()),e.update()}function St(n){let u=!1;switch(n.code){case e.keys.UP:R(0,e.keyPanSpeed),u=!0;break;case e.keys.BOTTOM:R(0,-e.keyPanSpeed),u=!0;break;case e.keys.LEFT:R(e.keyPanSpeed,0),u=!0;break;case e.keys.RIGHT:R(-e.keyPanSpeed,0),u=!0;break}u&&(n.preventDefault(),e.update())}function We(){if(v.length==1)O.set(v[0].pageX,v[0].pageY);else{const n=.5*(v[0].pageX+v[1].pageX),u=.5*(v[0].pageY+v[1].pageY);O.set(n,u)}}function He(){if(v.length==1)P.set(v[0].pageX,v[0].pageY);else{const n=.5*(v[0].pageX+v[1].pageX),u=.5*(v[0].pageY+v[1].pageY);P.set(n,u)}}function Ze(){const n=v[0].pageX-v[1].pageX,u=v[0].pageY-v[1].pageY,y=Math.sqrt(n*n+u*u);w.set(0,y)}function Nt(){e.enableZoom&&Ze(),e.enablePan&&He()}function Dt(){e.enableZoom&&Ze(),e.enableRotate&&We()}function Ke(n){if(v.length==1)$.set(n.pageX,n.pageY);else{const y=Oe(n),M=.5*(n.pageX+y.x),z=.5*(n.pageY+y.y);$.set(M,z)}S.subVectors($,O).multiplyScalar(e.rotateSpeed);const u=e.domElement;u&&(J(2*Math.PI*S.x/u.clientHeight),H(2*Math.PI*S.y/u.clientHeight)),O.copy($)}function Xe(n){if(v.length==1)x.set(n.pageX,n.pageY);else{const u=Oe(n),y=.5*(n.pageX+u.x),M=.5*(n.pageY+u.y);x.set(y,M)}E.subVectors(x,P).multiplyScalar(e.panSpeed),R(E.x,E.y),P.copy(x)}function qe(n){const u=Oe(n),y=n.pageX-u.x,M=n.pageY-u.y,z=Math.sqrt(y*y+M*M);k.set(0,z),A.set(0,Math.pow(k.y/w.y,e.zoomSpeed)),D(A.y),w.copy(k)}function _t(n){e.enableZoom&&qe(n),e.enablePan&&Xe(n)}function At(n){e.enableZoom&&qe(n),e.enableRotate&&Ke(n)}function Qe(n){var u,y;e.enabled!==!1&&(v.length===0&&((u=e.domElement)==null||u.ownerDocument.addEventListener("pointermove",Pe),(y=e.domElement)==null||y.ownerDocument.addEventListener("pointerup",Ce)),Bt(n),n.pointerType==="touch"?It(n):Lt(n))}function Pe(n){e.enabled!==!1&&(n.pointerType==="touch"?zt(n):Rt(n))}function Ce(n){var u,y,M;ot(n),v.length===0&&((u=e.domElement)==null||u.releasePointerCapture(n.pointerId),(y=e.domElement)==null||y.ownerDocument.removeEventListener("pointermove",Pe),(M=e.domElement)==null||M.ownerDocument.removeEventListener("pointerup",Ce)),e.dispatchEvent(h),d=i.NONE}function Je(n){ot(n)}function Lt(n){let u;switch(n.button){case 0:u=e.mouseButtons.LEFT;break;case 1:u=e.mouseButtons.MIDDLE;break;case 2:u=e.mouseButtons.RIGHT;break;default:u=-1}switch(u){case re.DOLLY:if(e.enableZoom===!1)return;Ct(n),d=i.DOLLY;break;case re.ROTATE:if(n.ctrlKey||n.metaKey||n.shiftKey){if(e.enablePan===!1)return;Ge(n),d=i.PAN}else{if(e.enableRotate===!1)return;Ue(n),d=i.ROTATE}break;case re.PAN:if(n.ctrlKey||n.metaKey||n.shiftKey){if(e.enableRotate===!1)return;Ue(n),d=i.ROTATE}else{if(e.enablePan===!1)return;Ge(n),d=i.PAN}break;default:d=i.NONE}d!==i.NONE&&e.dispatchEvent(c)}function Rt(n){if(e.enabled!==!1)switch(d){case i.ROTATE:if(e.enableRotate===!1)return;Tt(n);break;case i.DOLLY:if(e.enableZoom===!1)return;Ot(n);break;case i.PAN:if(e.enablePan===!1)return;Mt(n);break}}function et(n){e.enabled===!1||e.enableZoom===!1||d!==i.NONE&&d!==i.ROTATE||(n.preventDefault(),e.dispatchEvent(c),$t(n),e.dispatchEvent(h))}function Te(n){e.enabled===!1||e.enablePan===!1||St(n)}function It(n){switch(nt(n),v.length){case 1:switch(e.touches.ONE){case ie.ROTATE:if(e.enableRotate===!1)return;We(),d=i.TOUCH_ROTATE;break;case ie.PAN:if(e.enablePan===!1)return;He(),d=i.TOUCH_PAN;break;default:d=i.NONE}break;case 2:switch(e.touches.TWO){case ie.DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;Nt(),d=i.TOUCH_DOLLY_PAN;break;case ie.DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;Dt(),d=i.TOUCH_DOLLY_ROTATE;break;default:d=i.NONE}break;default:d=i.NONE}d!==i.NONE&&e.dispatchEvent(c)}function zt(n){switch(nt(n),d){case i.TOUCH_ROTATE:if(e.enableRotate===!1)return;Ke(n),e.update();break;case i.TOUCH_PAN:if(e.enablePan===!1)return;Xe(n),e.update();break;case i.TOUCH_DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;_t(n),e.update();break;case i.TOUCH_DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;At(n),e.update();break;default:d=i.NONE}}function tt(n){e.enabled!==!1&&n.preventDefault()}function Bt(n){v.push(n)}function ot(n){delete I[n.pointerId];for(let u=0;u<v.length;u++)if(v[u].pointerId==n.pointerId){v.splice(u,1);return}}function nt(n){let u=I[n.pointerId];u===void 0&&(u=new W,I[n.pointerId]=u),u.set(n.pageX,n.pageY)}function Oe(n){const u=n.pointerId===v[0].pointerId?v[1]:v[0];return I[u.pointerId]}r!==void 0&&this.connect(r),this.update()}};const jn=new N,vn=b.forwardRef(function({start:o=[0,0,0],end:r=[0,0,0],mid:e,segments:a=20,...c},h){const i=b.useRef(null),[d]=b.useState(()=>new qt(void 0,void 0,void 0)),m=b.useCallback((p,f,j,O=20)=>(p instanceof N?d.v0.copy(p):d.v0.set(...p),f instanceof N?d.v2.copy(f):d.v2.set(...f),j instanceof N?d.v1.copy(j):d.v1.copy(d.v0.clone().add(d.v2.clone().sub(d.v0)).add(jn.set(0,d.v0.y-d.v2.y,0))),d.getPoints(O)),[]);b.useLayoutEffect(()=>{i.current.setPoints=(p,f,j)=>{const O=m(p,f,j);i.current.geometry&&i.current.geometry.setPositions(O.map($=>$.toArray()).flat())}},[]);const l=b.useMemo(()=>m(o,r,e,a),[o,r,e,a]);return b.createElement(wo,B({ref:jo([i,h]),points:l},c))}),En=b.forwardRef(({makeDefault:t,camera:o,regress:r,domElement:e,enableDamping:a=!0,onChange:c,onStart:h,onEnd:i,...d},m)=>{const l=q(k=>k.invalidate),p=q(k=>k.camera),f=q(k=>k.gl),j=q(k=>k.events),O=q(k=>k.setEvents),$=q(k=>k.set),S=q(k=>k.get),P=q(k=>k.performance),x=o||p,E=e||j.connected||f.domElement,w=b.useMemo(()=>new wn(x),[x]);return Ee(()=>{w.enabled&&w.update()},-1),b.useEffect(()=>(w.connect(E),()=>void w.dispose()),[E,r,w,l]),b.useEffect(()=>{const k=L=>{l(),r&&P.regress(),c&&c(L)},A=L=>{h&&h(L)},Y=L=>{i&&i(L)};return w.addEventListener("change",k),w.addEventListener("start",A),w.addEventListener("end",Y),()=>{w.removeEventListener("start",A),w.removeEventListener("end",Y),w.removeEventListener("change",k)}},[c,h,i,w,l,O]),b.useEffect(()=>{if(t){const k=S().controls;return $({controls:w}),()=>$({controls:k})}},[t,w]),b.createElement("primitive",B({ref:m,object:w,enableDamping:a},d))});function kn(t){const o=t+"Geometry";return b.forwardRef(({args:r,children:e,...a},c)=>b.createElement("mesh",B({ref:c},a),b.createElement(o,{attach:"geometry",args:r}),e))}const Pn=kn("circle"),xt=t=>{const o=b.useRef();return b.useEffect(()=>{o.current=t}),o.current},Ve=10,Cn=2,yt=2,Tn=(t,o,r)=>{const c=new N().subVectors(o,t).normalize().multiplyScalar(r);return new N().addVectors(t,c)},kt=({links:t,nodes:o})=>{const r=b.useRef(null);return Ee(()=>{r.current&&o&&r.current.children.forEach((e,a)=>{var $;const c=t[a];if(!c)return;const h=o.find(S=>S.ref_id===c.source),i=o.find(S=>S.ref_id===c.target),d=new N((i==null?void 0:i.x)||0,(i==null?void 0:i.y)||0,(i==null?void 0:i.z)||0),m=new N((h==null?void 0:h.x)||0,(h==null?void 0:h.y)||0,(h==null?void 0:h.z)||0),l=Tn(m,d,Ve+yt),p=d.clone(),f=new N().lerpVectors(p,l,0),j=e.children[0],O=e.children[1];O.position.set(l.x,l.y,l.z),O.lookAt(p),O.rotateX(-Math.PI/2),($=j.setPoints)==null||$.call(j,p,l,f)})}),s.jsx("group",{ref:r,children:t.map(e=>s.jsxs("group",{children:[s.jsx(vn,{color:"white",end:[0,0,0],lineWidth:2,start:[0,0,0]}),s.jsxs("mesh",{position:new N(0,0,0),children:[s.jsx("coneGeometry",{args:[Cn,yt,32]}),s.jsx("meshBasicMaterial",{color:"white"})]})]},e.ref_id))})};kt.displayName="Lines";const On=["#ff13c9","#5af0ff","#3233ff","#c2f0c2","#ff6666","#99ccff","#ffb3b3"];new Qt(2,2,2);const Pt=b.memo(({node:t,setSelectedNode:o,onSimulationUpdate:r,isSelected:e})=>{var l;const a=b.useRef(null);console.log(e);const{size:c,camera:h}=q(),i=uo(p=>{const{xy:[f,j],down:O,dragging:$,first:S,elapsedTime:P}=p;if(!(!$||S||P<100)&&O&&a.current){r();const x=(f-c.left)/window.innerWidth*c.width,E=(j-c.top)/window.innerHeight*c.height,A=new N(x/c.width*2-1,-E/c.height*2+1,0).unproject(h).multiply(new N(1,1,0)).clone();t.fx=A.x,t.fy=A.y}});Ee(()=>{a.current&&a.current.position.set(t.x||0,t.y||0,0)});const d=On[(l=t==null?void 0:t.children)==null?void 0:l.length]||"red",m=p=>{p.stopPropagation(),o()};return s.jsxs("mesh",{ref:a,onClick:m,...i(),position:new N(t.x,t.y,0),children:[s.jsx(Pn,{args:[Ve,30,20],children:s.jsx("meshStandardMaterial",{attach:"material",color:d})}),s.jsx(vo,{...ko,color:"#000",fontSize:2,children:t.type})]})});Pt.displayName="Node";const Mn=({simulation:t,setSelectedSchemaId:o,selectedId:r})=>{const[e]=Et(c=>[c.schemas]),a=()=>{t&&(t.alpha(.05),t.restart())};return s.jsx(s.Fragment,{children:e.map((c,h)=>{const i=t.nodes()[h];return i?s.jsx(Pt,{isSelected:i.ref_id===r,node:i,onSimulationUpdate:a,setSelectedNode:()=>o(i.ref_id)},i.ref_id):null})})},$n=({schemasWithPositions:t,filteredLinks:o,setSelectedSchemaId:r,selectedSchemaId:e})=>{const[a,c]=b.useState(null),h=xt(t),i=xt(o);return b.useEffect(()=>{if(!t.length||!o.length)return;const d=structuredClone(t),m=structuredClone(o);if(a){h&&h.length!==t.length&&i&&i.length!==o.length&&(a.nodes(d).force("link",ct(m).id(p=>p.ref_id)).force("charge",lt()).force("center",dt()).force("collide",ut(Ve+1)).alpha(.5).restart(),c({...a}));return}const l=Jt(d).force("link",ct(m).id(p=>p.ref_id)).force("charge",lt()).force("center",dt()).force("collide",ut(0));c(l)},[t,a,o,h,i]),Ee(()=>{}),a?s.jsxs(s.Fragment,{children:[s.jsx(kt,{links:o,nodes:a.nodes()}),s.jsx(Mn,{selectedId:e,setSelectedSchemaId:r,simulation:a})]}):null},Se=new eo(0),Sn=({selectedSchemaId:t,links:o,schemasWithPositions:r,setSelectedSchemaId:e})=>s.jsxs(Eo,{camera:{zoom:1,position:[0,0,200]},id:"schema-canvas",linear:!0,orthographic:!0,children:[s.jsx("color",{args:[Se.r,Se.g,Se.b],attach:"background"}),to&&s.jsx(Po,{position:"right-bottom"}),s.jsx(En,{enableRotate:!1,enableZoom:!0}),s.jsx(Co,{}),s.jsx($n,{filteredLinks:o,schemasWithPositions:r,selectedSchemaId:t,setSelectedSchemaId:e})]}),Nn=({onCreateNew:t})=>s.jsxs(Dn,{children:[s.jsx(An,{children:"BLUEPRINT"}),s.jsxs(_n,{"data-testid":"add-schema-type",onClick:t,children:[s.jsx(Ln,{children:s.jsx(To,{})}),s.jsx(te,{children:"Add Type"})]})]}),Dn=U(C).attrs({align:"flex-start",direction:"column",justify:"flex-start"})`
  flex: 1 1 auto;
  z-index: 31;
  transition: opacity 1s;
  background: ${F.BG2};
  overflow: hidden;
  max-height: 100vh;

  @media (max-width: 1440px) {
    max-height: 95.2vh;
  }

  @media (max-width: 1024px) {
    max-height: 74.8vh;
  }

  @media (max-width: 924px) {
    max-height: 73.1vh;
  }
`,_n=U(C).attrs({align:"center",justify:"center",p:0})`
  position: relative;
  width: 64px;
  height: 58px;
  padding: 0;
  flex-direction: row;
  color: ${F.GRAY6};
  cursor: pointer;
  transition: ${({theme:t})=>t.transitions.create(["opacity","box-shadow","background-color"])};

  &:before {
    content: '';
    position: absolute;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    width: 4px; /* Initial width */
    height: 32px; /* Initial height on hover */
    background-color: transparent;
    transition: height 0.3s, width 0.3s, background-color 0.3s;
  }

  ${te} {
    display: none;
    opacity: 0;
    width: 0;
    padding: 4px 10px;
    border-radius: 4px;
    background: #000;
    box-shadow: 0px 4px 8px 0px rgba(0, 0, 0, 0.25);
    position: absolute;
    left: 90%;
    z-index: 99;
    white-space: nowrap;
    visibility: visible;
    font-size: 11px;
    font-style: normal;
    font-weight: 400;
    transition: ${({theme:t})=>t.transitions.create(["opacity","visually"])};
  }

  &:hover {
    color: ${F.white};

    &:before {
      width: 3px;
      height: 32px;
      background-color: ${F.primaryBlue};
    }

    ${te} {
      display: block;
      width: min-content;
      opacity: 1;
      visibility: visible;
    }
  }

  &:active {
    color: ${F.white};
    background: ${F.black};
    &:before {
      width: 3px;
      height: 100%;
      background-color: ${F.primaryBlue};
    }
  }

  &.root {
    border-radius: 50%;
    padding: 0;
    align-items: center;
    justify-content: center;
    border: none;
  }
`,An=U(C)`
  background: blue;
  align-items: center;
  justify-content: center;
  background: ${F.primaryBlue};
  width: 64px;
  height: 64px;
  cursor: pointer;
  font-size: 10px;
  font-weight: 600;
  color: ${F.white};
`,Ln=U(C)`
  justify-content: center;
  align-items: center;
  font-size: 24px;
`,Rn=()=>{const[t,o]=b.useState(""),[r,e]=b.useState(!1),[a,c]=b.useState(!1),[h,i]=b.useState(!1),[d,m,l,p]=Et(x=>[x.schemas,x.links,x.setSchemas,x.setSchemaLinks]);b.useEffect(()=>{(async()=>{c(!0);try{const E=await pt();l(E.schemas.filter(w=>w.ref_id&&!w.is_deleted&&w.ref_id)),p(E.edges),c(!1)}catch(E){console.error("Error fetching data:",E),c(!1)}})()},[l,p]);const f=x=>{if(d.some(w=>w.ref_id===x.ref_id))l(d.map(w=>w.ref_id===x.ref_id?{...x,children:[]}:w));else{l([...d,{...x,children:[]}]);const w=d.find(k=>x.parent===k.type);p([...m,{ref_id:`new-link-${m.length}`,edge_type:"CHILD_OF",source:x.ref_id||"new",target:(w==null?void 0:w.ref_id)||"new"}])}},j=async()=>{const x=await pt();l(x.schemas.filter(E=>E.ref_id&&!E.is_deleted&&E.ref_id)),p(x.edges)},O=x=>{l(d.filter(E=>E.type!==x))},$=d.map(x=>({...x,children:d.filter(E=>E.parent===x.type).map(E=>E.ref_id||"")})),S=m.filter(x=>x.edge_type==="CHILD_OF"&&$.some(E=>E.ref_id===x.source)&&$.some(E=>E.ref_id===x.target)),P=d.find(x=>x.ref_id===t)||null;return a?s.jsx(C,{align:"center",basis:"100%",grow:1,justify:"center",shrink:1,children:s.jsx(je,{color:F.white})}):s.jsx(s.Fragment,{children:s.jsxs(C,{align:"stretch",direction:"row",grow:1,children:[s.jsx(C,{ml:-20,my:-20,children:s.jsx(Nn,{onCreateNew:()=>{e(!0),o("")}})}),s.jsx(C,{children:P||r?s.jsx(zn,{children:s.jsx(hn,{onDelete:O,onSchemaCreate:f,onSchemaUpdate:j,selectedSchema:P,setGraphLoading:i,setIsCreateNew:e,setSelectedSchemaId:o})}):null}),s.jsx(In,{direction:"row",grow:1,children:s.jsx(Bn,{children:h?s.jsx(C,{align:"center",basis:"100%",grow:1,justify:"center",shrink:1,children:s.jsx(je,{color:F.white})}):s.jsx(Sn,{links:S,schemasWithPositions:$,selectedSchemaId:t,setSelectedSchemaId:o})})})]})})},In=U(C)`
  flex: 1 1 auto;
  justify-content: center;
  position: relative;
  overflow: hidden;
  padding: 10px;
  max-height: 80vh;

  @media (max-width: 1440px) {
    max-height: 85vh;
  }

  @media (max-width: 1024px) {
    max-height: 70vh;
  }
`,zn=U(C)`
  width: 100%;
  max-width: 400px;
  background: ${F.BG1};
  padding: 16px;
  border-top-right-radius: 16px;
  border-bottom-right-radius: 16px;
  flex-grow: 1;
  flex-shrink: 1;
  min-width: 300px;
  overflow: auto;
  max-height: calc(100vh - 20px);

  @media (max-width: 1440px) {
    max-height: calc(95vh - 20px);
  }

  @media (max-width: 1024px) {
    max-height: calc(70vh - 20px);
  }

  @media (max-width: 924px) {
    max-height: calc(70vh - 20px);
  }
`,Bn=U(C)`
  flex: 1 1 100%;
`,Fn=()=>{const{close:t}=jt("blueprintGraph"),o=()=>{t()};return s.jsx(oo,{background:"black",id:"blueprintGraph",kind:"full",onClose:o,preventOutsideClose:!0,children:s.jsx(Rn,{})})},ps=b.memo(Fn);export{ps as BlueprintModal};
