import{r as E,b as $a,j as M,R as $r,y as uu,p as Le,q as pe,F as xs,x as xn,D as hu,C as hr,I as ef,A as Jt,t as nt,X as Eo,w as du,Y as tf,Z as sf,a0 as nf,a1 as rf,a2 as of,a3 as af,a4 as cf,a5 as lf,a6 as uf,U as Cr,a7 as hf,a8 as df,a9 as ff,aa as pf,O as mf}from"./index-a2fee79d.js";import{u as ve,a as Xa,e as Qa,b as Rt,L as _f,c as gf,d as vf,m as yf,f as xf,g as Tf,h as fu,H as dr,t as pu,T as wf,i as kf,j as Sf,D as Cf,C as bf,P as Ef,k as Of}from"./index-d87dc72a.js";import{D as br,F as Af,V as X,a as Fe,T as Oo,b as Mf,C as hs,W as Df,c as Rf,E as Ka,d as Tt,N as Gn,e as Pf,B as oi,U as ps,M as If,f as Nf,g as Ff,h as Uf,i as Lf,j as Er,k as Mi,S as es,l as Bf,m as Q,R as zf,n as Ts,o as Ta,P as mu,p as Ja,q as Jc,r as Vf,L as Xr,s as jf,t as _u,u as gu,v as vu,w as yu,x as el,y as Hf,z as qf,A as Or,H as Wf,G as Gf,I as Yf,J as Zf,K as $f,O as Xf,Q as fr,X as Qf,Y as Kf}from"./three.module-2ce81f73.js";import{B as xu,_ as Ue,a as Vt,u as ec,T as tl,A as Jf,b as ep,P as tp,O as sp,c as np}from"./index-57446bb9.js";import{T as ip}from"./TextareaAutosize-8a0b55f0.js";import{D as rp}from"./DeleteIcon-19100283.js";import{M as op,a as ap}from"./index.esm-5cf1d22e.js";import{u as cp}from"./index-c1714e2a.js";import{M as lp,A as up,E as hp}from"./MergeIcon-5410b2d7.js";import{P as dp}from"./PlusIcon-274b604c.js";import{C as fp}from"./ClipLoader-94036fe6.js";function pp(n){let e;const t=new Set,s=(l,u)=>{const h=typeof l=="function"?l(e):l;if(h!==e){const f=e;e=u?h:Object.assign({},e,h),t.forEach(d=>d(e,f))}},i=()=>e,r=(l,u=i,h=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let f=u(e);function d(){const m=u(e);if(!h(f,m)){const p=f;l(f=m,p)}}return t.add(d),()=>t.delete(d)},c={setState:s,getState:i,subscribe:(l,u,h)=>u||h?r(l,u,h):(t.add(l),()=>t.delete(l)),destroy:()=>t.clear()};return e=n(s,i,c),c}const mp=typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),sl=mp?E.useEffect:E.useLayoutEffect;function _p(n){const e=typeof n=="function"?pp(n):n,t=(s=e.getState,i=Object.is)=>{const[,r]=E.useReducer(_=>_+1,0),o=e.getState(),a=E.useRef(o),c=E.useRef(s),l=E.useRef(i),u=E.useRef(!1),h=E.useRef();h.current===void 0&&(h.current=s(o));let f,d=!1;(a.current!==o||c.current!==s||l.current!==i||u.current)&&(f=s(o),d=!i(h.current,f)),sl(()=>{d&&(h.current=f),a.current=o,c.current=s,l.current=i,u.current=!1});const m=E.useRef(o);sl(()=>{const _=()=>{try{const T=e.getState(),S=c.current(T);l.current(h.current,S)||(a.current=T,h.current=S,r())}catch{u.current=!0,r()}},v=e.subscribe(_);return e.getState()!==m.current&&_(),v},[]);const p=d?f:h.current;return E.useDebugValue(p),p};return Object.assign(t,e),t[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const s=[t,e];return{next(){const i=s.length<=0;return{value:s.shift(),done:i}}}},t}let fi=0;const gp=_p(n=>(br.onStart=(e,t,s)=>{n({active:!0,item:e,loaded:t,total:s,progress:(t-fi)/(s-fi)*100})},br.onLoad=()=>{n({active:!1})},br.onError=e=>n(t=>({errors:[...t.errors,e]})),br.onProgress=(e,t,s)=>{t===s&&(fi=s),n({active:!0,item:e,loaded:t,total:s,progress:(t-fi)/(s-fi)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0})),vp=n=>`Loading ${n.toFixed(2)}%`;function yp({containerStyles:n,innerStyles:e,barStyles:t,dataStyles:s,dataInterpolation:i=vp,initialState:r=o=>o}){const{active:o,progress:a}=gp(),c=E.useRef(0),l=E.useRef(0),u=E.useRef(null),[h,f]=E.useState(r(o));E.useEffect(()=>{let m;return o!==h&&(m=setTimeout(()=>f(o),300)),()=>clearTimeout(m)},[h,o]);const d=E.useCallback(()=>{u.current&&(c.current+=(a-c.current)/2,(c.current>.95*a||a===100)&&(c.current=a),u.current.innerText=i(c.current),c.current<a&&(l.current=requestAnimationFrame(d)))},[i,a]);return E.useEffect(()=>(d(),()=>cancelAnimationFrame(l.current)),[d]),h?E.createElement("div",{style:{...Ar.container,opacity:o?1:0,...n}},E.createElement("div",null,E.createElement("div",{style:{...Ar.inner,...e}},E.createElement("div",{style:{...Ar.bar,transform:`scaleX(${a/100})`,...t}}),E.createElement("span",{ref:u,style:{...Ar.data,...s}})))):null}const Ar={container:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:"#171717",display:"flex",alignItems:"center",justifyContent:"center",transition:"opacity 300ms ease",zIndex:1e3},inner:{width:100,height:3,background:"#272727",textAlign:"center"},bar:{height:3,width:"100%",background:"white",transition:"transform 200ms",transformOrigin:"left center"},data:{display:"inline-block",position:"relative",fontVariantNumeric:"tabular-nums",marginTop:"0.8em",color:"#f0f0f0",fontSize:"0.6em",fontFamily:'-apple-system, BlinkMacSystemFont, "Inter", "Segoe UI", "Helvetica Neue", Helvetica, Arial, Roboto, Ubuntu, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',whiteSpace:"nowrap"}};let pi;function xp(){var n;if(pi!==void 0)return pi;try{let e;const t=document.createElement("canvas");return pi=!!(window.WebGL2RenderingContext&&(e=t.getContext("webgl2"))),e&&((n=e.getExtension("WEBGL_lose_context"))==null||n.loseContext()),pi}catch{return pi=!1}}const Xo=new Af,Qo=new X,En=new X,Pt=new X,is=new X,qt=new X,rs=new X,os=new X,mi=new X,_i=new X,gi=new X,Mr=new X,vi=new X,yi=new X,xi=new X;class Tp{constructor(e,t,s){this.camera=e,this.scene=t,this.startPoint=new X,this.endPoint=new X,this.collection=[],this.deep=s||Number.MAX_VALUE}select(e,t){return this.startPoint=e||this.startPoint,this.endPoint=t||this.endPoint,this.collection=[],this.updateFrustum(this.startPoint,this.endPoint),this.searchChildInFrustum(Xo,this.scene),this.collection}updateFrustum(e,t){if(e=e||this.startPoint,t=t||this.endPoint,e.x===t.x&&(t.x+=Number.EPSILON),e.y===t.y&&(t.y+=Number.EPSILON),this.camera.updateProjectionMatrix(),this.camera.updateMatrixWorld(),this.camera.isPerspectiveCamera){En.copy(e),En.x=Math.min(e.x,t.x),En.y=Math.max(e.y,t.y),t.x=Math.max(e.x,t.x),t.y=Math.min(e.y,t.y),Pt.setFromMatrixPosition(this.camera.matrixWorld),is.copy(En),qt.set(t.x,En.y,0),rs.copy(t),os.set(En.x,t.y,0),is.unproject(this.camera),qt.unproject(this.camera),rs.unproject(this.camera),os.unproject(this.camera),vi.copy(is).sub(Pt),yi.copy(qt).sub(Pt),xi.copy(rs).sub(Pt),vi.normalize(),yi.normalize(),xi.normalize(),vi.multiplyScalar(this.deep),yi.multiplyScalar(this.deep),xi.multiplyScalar(this.deep),vi.add(Pt),yi.add(Pt),xi.add(Pt);var s=Xo.planes;s[0].setFromCoplanarPoints(Pt,is,qt),s[1].setFromCoplanarPoints(Pt,qt,rs),s[2].setFromCoplanarPoints(rs,os,Pt),s[3].setFromCoplanarPoints(os,is,Pt),s[4].setFromCoplanarPoints(qt,rs,os),s[5].setFromCoplanarPoints(xi,yi,vi),s[5].normal.multiplyScalar(-1)}else if(this.camera.isOrthographicCamera){const i=Math.min(e.x,t.x),r=Math.max(e.y,t.y),o=Math.max(e.x,t.x),a=Math.min(e.y,t.y);is.set(i,r,-1),qt.set(o,r,-1),rs.set(o,a,-1),os.set(i,a,-1),mi.set(i,r,1),_i.set(o,r,1),gi.set(o,a,1),Mr.set(i,a,1),is.unproject(this.camera),qt.unproject(this.camera),rs.unproject(this.camera),os.unproject(this.camera),mi.unproject(this.camera),_i.unproject(this.camera),gi.unproject(this.camera),Mr.unproject(this.camera);var s=Xo.planes;s[0].setFromCoplanarPoints(is,mi,_i),s[1].setFromCoplanarPoints(qt,_i,gi),s[2].setFromCoplanarPoints(gi,Mr,os),s[3].setFromCoplanarPoints(Mr,mi,is),s[4].setFromCoplanarPoints(qt,rs,os),s[5].setFromCoplanarPoints(gi,_i,mi),s[5].normal.multiplyScalar(-1)}else console.error("THREE.SelectionBox: Unsupported camera type.")}searchChildInFrustum(e,t){if((t.isMesh||t.isLine||t.isPoints)&&t.material!==void 0&&(t.geometry.boundingSphere===null&&t.geometry.computeBoundingSphere(),Qo.copy(t.geometry.boundingSphere.center),Qo.applyMatrix4(t.matrixWorld),e.containsPoint(Qo)&&this.collection.push(t)),t.children.length>0)for(let s=0;s<t.children.length;s++)this.searchChildInFrustum(e,t.children[s])}}function wp(n,e){if(Object.is(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;const t=Object.keys(n);if(t.length!==Object.keys(e).length)return!1;for(let s=0;s<t.length;s++)if(!Object.prototype.hasOwnProperty.call(e,t[s])||!Object.is(n[t[s]],e[t[s]]))return!1;return!0}const kp=E.createContext([]);function Sp({box:n,multiple:e,children:t,onChange:s,border:i="1px solid #55aaff",backgroundColor:r="rgba(75, 160, 255, 0.1)",filter:o=c=>c,...a}){const{setEvents:c,camera:l,raycaster:u,gl:h,controls:f,size:d,get:m}=ve(),[p,_]=E.useState(!1),[v,T]=E.useReducer((w,{object:k,shift:x})=>k===void 0?[]:Array.isArray(k)?k:x?w.includes(k)?w.filter(C=>C!==k):[k,...w]:w[0]===k?[]:[k],[]);E.useEffect(()=>void(s==null?void 0:s(v)),[v]);const S=E.useCallback(w=>{w.stopPropagation(),T({object:o([w.object])[0],shift:e&&w.shiftKey})},[]),y=E.useCallback(w=>!p&&T({}),[p]),g=E.useRef(null);return E.useEffect(()=>{if(!n||!e)return;const w=new Tp(l,g.current),k=document.createElement("div");k.style.pointerEvents="none",k.style.border=i,k.style.backgroundColor=r,k.style.position="fixed";const x=new Fe,C=new Fe,b=new Fe,O=m().events.enabled,A=f==null?void 0:f.enabled;let R=!1;function P(B,we){const{offsetX:ae,offsetY:$}=B,{width:_e,height:Ye}=d;we.set(ae/_e*2-1,-($/Ye)*2+1)}function F(B){var we;f&&(f.enabled=!1),c({enabled:!1}),R=!0,(we=h.domElement.parentElement)==null||we.appendChild(k),k.style.left=`${B.clientX}px`,k.style.top=`${B.clientY}px`,k.style.width="0px",k.style.height="0px",x.x=B.clientX,x.y=B.clientY}function N(B){b.x=Math.max(x.x,B.clientX),b.y=Math.max(x.y,B.clientY),C.x=Math.min(x.x,B.clientX),C.y=Math.min(x.y,B.clientY),k.style.left=`${C.x}px`,k.style.top=`${C.y}px`,k.style.width=`${b.x-C.x}px`,k.style.height=`${b.y-C.y}px`}function U(){if(R){var B;f&&(f.enabled=A),c({enabled:O}),R=!1,(B=k.parentElement)==null||B.removeChild(k)}}function V(B){B.shiftKey&&(F(B),P(B,w.startPoint))}let z=[];function q(B){if(R){N(B),P(B,w.endPoint);const we=w.select().sort(ae=>ae.uuid).filter(ae=>ae.isMesh);wp(we,z)||(z=we,T({object:o(we)}))}}function j(B){R&&U()}return document.addEventListener("pointerdown",V,{passive:!0}),document.addEventListener("pointermove",q,{passive:!0,capture:!0}),document.addEventListener("pointerup",j,{passive:!0}),()=>{document.removeEventListener("pointerdown",V),document.removeEventListener("pointermove",q),document.removeEventListener("pointerup",j)}},[d.width,d.height,u,l,f,h]),E.createElement("group",$a({ref:g,onClick:S,onPointerOver:()=>_(!0),onPointerOut:()=>_(!1),onPointerMissed:y},a),E.createElement(kp.Provider,{value:v},t))}const nl=n=>n===Object(n)&&!Array.isArray(n)&&typeof n!="function";function on(n,e){const t=ve(i=>i.gl),s=Xa(Oo,nl(n)?Object.values(n):n);if(E.useLayoutEffect(()=>{e==null||e(s)},[e]),E.useEffect(()=>{(Array.isArray(s)?s:[s]).forEach(t.initTexture)},[t,s]),nl(n)){const i=Object.keys(n),r={};return i.forEach(o=>Object.assign(r,{[o]:s[i.indexOf(o)]})),r}else return s}on.preload=n=>Xa.preload(Oo,n);on.clear=n=>Xa.clear(Oo,n);/*!
 * camera-controls
 * https://github.com/yomotsu/camera-controls
 * (c) 2017 @yomotsu
 * Released under the MIT License.
 */const Z={LEFT:1,RIGHT:2,MIDDLE:4},D=Object.freeze({NONE:0,ROTATE:1,TRUCK:2,OFFSET:4,DOLLY:8,ZOOM:16,TOUCH_ROTATE:32,TOUCH_TRUCK:64,TOUCH_OFFSET:128,TOUCH_DOLLY:256,TOUCH_ZOOM:512,TOUCH_DOLLY_TRUCK:1024,TOUCH_DOLLY_OFFSET:2048,TOUCH_DOLLY_ROTATE:4096,TOUCH_ZOOM_TRUCK:8192,TOUCH_ZOOM_OFFSET:16384,TOUCH_ZOOM_ROTATE:32768}),On={NONE:0,IN:1,OUT:-1};function Qs(n){return n.isPerspectiveCamera}function As(n){return n.isOrthographicCamera}const An=Math.PI*2,il=Math.PI/2,Tu=1e-5,Ti=Math.PI/180;function It(n,e,t){return Math.max(e,Math.min(t,n))}function ge(n,e=Tu){return Math.abs(n)<e}function oe(n,e,t=Tu){return ge(n-e,t)}function rl(n,e){return Math.round(n/e)*e}function wi(n){return isFinite(n)?n:n<0?-Number.MAX_VALUE:Number.MAX_VALUE}function ki(n){return Math.abs(n)<Number.MAX_VALUE?n:n*(1/0)}function Dr(n,e,t,s,i=1/0,r){s=Math.max(1e-4,s);const o=2/s,a=o*r,c=1/(1+a+.48*a*a+.235*a*a*a);let l=n-e;const u=e,h=i*s;l=It(l,-h,h),e=n-l;const f=(t.value+o*l)*r;t.value=(t.value-o*f)*c;let d=e+(l+f)*c;return u-n>0==d>u&&(d=u,t.value=(d-u)/r),d}function ol(n,e,t,s,i=1/0,r,o){s=Math.max(1e-4,s);const a=2/s,c=a*r,l=1/(1+c+.48*c*c+.235*c*c*c);let u=e.x,h=e.y,f=e.z,d=n.x-u,m=n.y-h,p=n.z-f;const _=u,v=h,T=f,S=i*s,y=S*S,g=d*d+m*m+p*p;if(g>y){const F=Math.sqrt(g);d=d/F*S,m=m/F*S,p=p/F*S}u=n.x-d,h=n.y-m,f=n.z-p;const w=(t.x+a*d)*r,k=(t.y+a*m)*r,x=(t.z+a*p)*r;t.x=(t.x-a*w)*l,t.y=(t.y-a*k)*l,t.z=(t.z-a*x)*l,o.x=u+(d+w)*l,o.y=h+(m+k)*l,o.z=f+(p+x)*l;const C=_-n.x,b=v-n.y,O=T-n.z,A=o.x-_,R=o.y-v,P=o.z-T;return C*A+b*R+O*P>0&&(o.x=_,o.y=v,o.z=T,t.x=(o.x-_)/r,t.y=(o.y-v)/r,t.z=(o.z-T)/r),o}function Ko(n,e){e.set(0,0),n.forEach(t=>{e.x+=t.clientX,e.y+=t.clientY}),e.x/=n.length,e.y/=n.length}function Jo(n,e){return As(n)?(console.warn(`${e} is not supported in OrthographicCamera`),!0):!1}class Cp{constructor(){this._listeners={}}addEventListener(e,t){const s=this._listeners;s[e]===void 0&&(s[e]=[]),s[e].indexOf(t)===-1&&s[e].push(t)}hasEventListener(e,t){const s=this._listeners;return s[e]!==void 0&&s[e].indexOf(t)!==-1}removeEventListener(e,t){const i=this._listeners[e];if(i!==void 0){const r=i.indexOf(t);r!==-1&&i.splice(r,1)}}removeAllEventListeners(e){if(!e){this._listeners={};return}Array.isArray(this._listeners[e])&&(this._listeners[e].length=0)}dispatchEvent(e){const s=this._listeners[e.type];if(s!==void 0){e.target=this;const i=s.slice(0);for(let r=0,o=i.length;r<o;r++)i[r].call(this,e)}}}const bp="2.7.3",Rr=1/8,wu=typeof window<"u",Ep=wu&&/Mac/.test(navigator.platform),Op=!(wu&&"PointerEvent"in window);let G,al,Pr,ea,ot,J,ne,Mn,Si,Wt,Gt,Ks,cl,ll,St,Ci,Dn,ul,ta,hl,sa,na,Ir,ia=class wa extends Cp{static install(e){G=e.THREE,al=Object.freeze(new G.Vector3(0,0,0)),Pr=Object.freeze(new G.Vector3(0,1,0)),ea=Object.freeze(new G.Vector3(0,0,1)),ot=new G.Vector2,J=new G.Vector3,ne=new G.Vector3,Mn=new G.Vector3,Si=new G.Vector3,Wt=new G.Vector3,Gt=new G.Vector3,Ks=new G.Vector3,cl=new G.Vector3,ll=new G.Vector3,St=new G.Spherical,Ci=new G.Spherical,Dn=new G.Box3,ul=new G.Box3,ta=new G.Sphere,hl=new G.Quaternion,sa=new G.Quaternion,na=new G.Matrix4,Ir=new G.Raycaster}static get ACTION(){return D}constructor(e,t){super(),this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.minDistance=Number.EPSILON,this.maxDistance=1/0,this.infinityDolly=!1,this.minZoom=.01,this.maxZoom=1/0,this.smoothTime=.25,this.draggingSmoothTime=.125,this.maxSpeed=1/0,this.azimuthRotateSpeed=1,this.polarRotateSpeed=1,this.dollySpeed=1,this.dollyDragInverted=!1,this.truckSpeed=2,this.dollyToCursor=!1,this.dragToOffset=!1,this.verticalDragToForward=!1,this.boundaryFriction=0,this.restThreshold=.01,this.colliderMeshes=[],this.cancel=()=>{},this._enabled=!0,this._state=D.NONE,this._viewport=null,this._changedDolly=0,this._changedZoom=0,this._hasRested=!0,this._boundaryEnclosesCamera=!1,this._needsUpdate=!0,this._updatedLastTime=!1,this._elementRect=new DOMRect,this._isDragging=!1,this._dragNeedsUpdate=!0,this._activePointers=[],this._lockedPointer=null,this._interactiveArea=new DOMRect(0,0,1,1),this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._isUserControllingOffset=!1,this._isUserControllingZoom=!1,this._lastDollyDirection=On.NONE,this._thetaVelocity={value:0},this._phiVelocity={value:0},this._radiusVelocity={value:0},this._targetVelocity=new G.Vector3,this._focalOffsetVelocity=new G.Vector3,this._zoomVelocity={value:0},this._truckInternal=(y,g,w)=>{let k,x;if(Qs(this._camera)){const C=J.copy(this._camera.position).sub(this._target),b=this._camera.getEffectiveFOV()*Ti,O=C.length()*Math.tan(b*.5);k=this.truckSpeed*y*O/this._elementRect.height,x=this.truckSpeed*g*O/this._elementRect.height}else if(As(this._camera)){const C=this._camera;k=y*(C.right-C.left)/C.zoom/this._elementRect.width,x=g*(C.top-C.bottom)/C.zoom/this._elementRect.height}else return;this.verticalDragToForward?(w?this.setFocalOffset(this._focalOffsetEnd.x+k,this._focalOffsetEnd.y,this._focalOffsetEnd.z,!0):this.truck(k,0,!0),this.forward(-x,!0)):w?this.setFocalOffset(this._focalOffsetEnd.x+k,this._focalOffsetEnd.y+x,this._focalOffsetEnd.z,!0):this.truck(k,x,!0)},this._rotateInternal=(y,g)=>{const w=An*this.azimuthRotateSpeed*y/this._elementRect.height,k=An*this.polarRotateSpeed*g/this._elementRect.height;this.rotate(w,k,!0)},this._dollyInternal=(y,g,w)=>{const k=Math.pow(.95,-y*this.dollySpeed),x=this._sphericalEnd.radius,C=this._sphericalEnd.radius*k,b=It(C,this.minDistance,this.maxDistance),O=b-C;this.infinityDolly&&this.dollyToCursor?this._dollyToNoClamp(C,!0):this.infinityDolly&&!this.dollyToCursor?(this.dollyInFixed(O,!0),this._dollyToNoClamp(b,!0)):this._dollyToNoClamp(b,!0),this.dollyToCursor&&(this._changedDolly+=(this.infinityDolly?C:b)-x,this._dollyControlCoord.set(g,w)),this._lastDollyDirection=Math.sign(-y)},this._zoomInternal=(y,g,w)=>{const k=Math.pow(.95,y*this.dollySpeed),x=this._zoom,C=this._zoom*k;this.zoomTo(C,!0),this.dollyToCursor&&(this._changedZoom+=C-x,this._dollyControlCoord.set(g,w))},typeof G>"u"&&console.error("camera-controls: `THREE` is undefined. You must first run `CameraControls.install( { THREE: THREE } )`. Check the docs for further information."),this._camera=e,this._yAxisUpSpace=new G.Quaternion().setFromUnitVectors(this._camera.up,Pr),this._yAxisUpSpaceInverse=this._yAxisUpSpace.clone().invert(),this._state=D.NONE,this._target=new G.Vector3,this._targetEnd=this._target.clone(),this._focalOffset=new G.Vector3,this._focalOffsetEnd=this._focalOffset.clone(),this._spherical=new G.Spherical().setFromVector3(J.copy(this._camera.position).applyQuaternion(this._yAxisUpSpace)),this._sphericalEnd=this._spherical.clone(),this._lastDistance=this._spherical.radius,this._zoom=this._camera.zoom,this._zoomEnd=this._zoom,this._lastZoom=this._zoom,this._nearPlaneCorners=[new G.Vector3,new G.Vector3,new G.Vector3,new G.Vector3],this._updateNearPlaneCorners(),this._boundary=new G.Box3(new G.Vector3(-1/0,-1/0,-1/0),new G.Vector3(1/0,1/0,1/0)),this._cameraUp0=this._camera.up.clone(),this._target0=this._target.clone(),this._position0=this._camera.position.clone(),this._zoom0=this._zoom,this._focalOffset0=this._focalOffset.clone(),this._dollyControlCoord=new G.Vector2,this.mouseButtons={left:D.ROTATE,middle:D.DOLLY,right:D.TRUCK,wheel:Qs(this._camera)?D.DOLLY:As(this._camera)?D.ZOOM:D.NONE},this.touches={one:D.TOUCH_ROTATE,two:Qs(this._camera)?D.TOUCH_DOLLY_TRUCK:As(this._camera)?D.TOUCH_ZOOM_TRUCK:D.NONE,three:D.TOUCH_TRUCK};const s=new G.Vector2,i=new G.Vector2,r=new G.Vector2,o=y=>{if(!this._enabled||!this._domElement)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const k=this._domElement.getBoundingClientRect(),x=y.clientX/k.width,C=y.clientY/k.height;if(x<this._interactiveArea.left||x>this._interactiveArea.right||C<this._interactiveArea.top||C>this._interactiveArea.bottom)return}const g=y.pointerType!=="mouse"?null:(y.buttons&Z.LEFT)===Z.LEFT?Z.LEFT:(y.buttons&Z.MIDDLE)===Z.MIDDLE?Z.MIDDLE:(y.buttons&Z.RIGHT)===Z.RIGHT?Z.RIGHT:null;if(g!==null){const k=this._findPointerByMouseButton(g);k&&this._disposePointer(k)}if((y.buttons&Z.LEFT)===Z.LEFT&&this._lockedPointer)return;const w={pointerId:y.pointerId,clientX:y.clientX,clientY:y.clientY,deltaX:0,deltaY:0,mouseButton:g};this._activePointers.push(w),this._domElement.ownerDocument.removeEventListener("pointermove",c,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",u),this._domElement.ownerDocument.addEventListener("pointermove",c,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",u),this._isDragging=!0,p(y)},a=y=>{if(!this._enabled||!this._domElement||this._lockedPointer)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const k=this._domElement.getBoundingClientRect(),x=y.clientX/k.width,C=y.clientY/k.height;if(x<this._interactiveArea.left||x>this._interactiveArea.right||C<this._interactiveArea.top||C>this._interactiveArea.bottom)return}const g=(y.buttons&Z.LEFT)===Z.LEFT?Z.LEFT:(y.buttons&Z.MIDDLE)===Z.MIDDLE?Z.MIDDLE:(y.buttons&Z.RIGHT)===Z.RIGHT?Z.RIGHT:null;if(g!==null){const k=this._findPointerByMouseButton(g);k&&this._disposePointer(k)}const w={pointerId:1,clientX:y.clientX,clientY:y.clientY,deltaX:0,deltaY:0,mouseButton:(y.buttons&Z.LEFT)===Z.LEFT?Z.LEFT:(y.buttons&Z.MIDDLE)===Z.LEFT?Z.MIDDLE:(y.buttons&Z.RIGHT)===Z.LEFT?Z.RIGHT:null};this._activePointers.push(w),this._domElement.ownerDocument.removeEventListener("mousemove",l),this._domElement.ownerDocument.removeEventListener("mouseup",h),this._domElement.ownerDocument.addEventListener("mousemove",l),this._domElement.ownerDocument.addEventListener("mouseup",h),this._isDragging=!0,p(y)},c=y=>{y.cancelable&&y.preventDefault();const g=y.pointerId,w=this._lockedPointer||this._findPointerById(g);if(w){if(w.clientX=y.clientX,w.clientY=y.clientY,w.deltaX=y.movementX,w.deltaY=y.movementY,this._state=0,y.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else(!this._isDragging&&this._lockedPointer||this._isDragging&&(y.buttons&Z.LEFT)===Z.LEFT)&&(this._state=this._state|this.mouseButtons.left),this._isDragging&&(y.buttons&Z.MIDDLE)===Z.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),this._isDragging&&(y.buttons&Z.RIGHT)===Z.RIGHT&&(this._state=this._state|this.mouseButtons.right);_()}},l=y=>{const g=this._lockedPointer||this._findPointerById(1);g&&(g.clientX=y.clientX,g.clientY=y.clientY,g.deltaX=y.movementX,g.deltaY=y.movementY,this._state=0,(this._lockedPointer||(y.buttons&Z.LEFT)===Z.LEFT)&&(this._state=this._state|this.mouseButtons.left),(y.buttons&Z.MIDDLE)===Z.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(y.buttons&Z.RIGHT)===Z.RIGHT&&(this._state=this._state|this.mouseButtons.right),_())},u=y=>{const g=this._findPointerById(y.pointerId);if(!(g&&g===this._lockedPointer)){if(g&&this._disposePointer(g),y.pointerType==="touch")switch(this._activePointers.length){case 0:this._state=D.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else this._state=D.NONE;v()}},h=()=>{const y=this._findPointerById(1);y&&y===this._lockedPointer||(y&&this._disposePointer(y),this._state=D.NONE,v())};let f=-1;const d=y=>{if(!this._domElement||!this._enabled||this.mouseButtons.wheel===D.NONE)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const C=this._domElement.getBoundingClientRect(),b=y.clientX/C.width,O=y.clientY/C.height;if(b<this._interactiveArea.left||b>this._interactiveArea.right||O<this._interactiveArea.top||O>this._interactiveArea.bottom)return}if(y.preventDefault(),this.dollyToCursor||this.mouseButtons.wheel===D.ROTATE||this.mouseButtons.wheel===D.TRUCK){const C=performance.now();f-C<1e3&&this._getClientRect(this._elementRect),f=C}const g=Ep?-1:-3,w=y.deltaMode===1?y.deltaY/g:y.deltaY/(g*10),k=this.dollyToCursor?(y.clientX-this._elementRect.x)/this._elementRect.width*2-1:0,x=this.dollyToCursor?(y.clientY-this._elementRect.y)/this._elementRect.height*-2+1:0;switch(this.mouseButtons.wheel){case D.ROTATE:{this._rotateInternal(y.deltaX,y.deltaY),this._isUserControllingRotate=!0;break}case D.TRUCK:{this._truckInternal(y.deltaX,y.deltaY,!1),this._isUserControllingTruck=!0;break}case D.OFFSET:{this._truckInternal(y.deltaX,y.deltaY,!0),this._isUserControllingOffset=!0;break}case D.DOLLY:{this._dollyInternal(-w,k,x),this._isUserControllingDolly=!0;break}case D.ZOOM:{this._zoomInternal(-w,k,x),this._isUserControllingZoom=!0;break}}this.dispatchEvent({type:"control"})},m=y=>{if(!(!this._domElement||!this._enabled)){if(this.mouseButtons.right===wa.ACTION.NONE){const g=y instanceof PointerEvent?y.pointerId:(y instanceof MouseEvent,0),w=this._findPointerById(g);w&&this._disposePointer(w),this._domElement.ownerDocument.removeEventListener("pointermove",c,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",u),this._domElement.ownerDocument.removeEventListener("mousemove",l),this._domElement.ownerDocument.removeEventListener("mouseup",h);return}y.preventDefault()}},p=y=>{if(!this._enabled)return;if(Ko(this._activePointers,ot),this._getClientRect(this._elementRect),s.copy(ot),i.copy(ot),this._activePointers.length>=2){const w=ot.x-this._activePointers[1].clientX,k=ot.y-this._activePointers[1].clientY,x=Math.sqrt(w*w+k*k);r.set(0,x);const C=(this._activePointers[0].clientX+this._activePointers[1].clientX)*.5,b=(this._activePointers[0].clientY+this._activePointers[1].clientY)*.5;i.set(C,b)}if(this._state=0,!y)this._lockedPointer&&(this._state=this._state|this.mouseButtons.left);else if("pointerType"in y&&y.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else!this._lockedPointer&&(y.buttons&Z.LEFT)===Z.LEFT&&(this._state=this._state|this.mouseButtons.left),(y.buttons&Z.MIDDLE)===Z.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(y.buttons&Z.RIGHT)===Z.RIGHT&&(this._state=this._state|this.mouseButtons.right);((this._state&D.ROTATE)===D.ROTATE||(this._state&D.TOUCH_ROTATE)===D.TOUCH_ROTATE||(this._state&D.TOUCH_DOLLY_ROTATE)===D.TOUCH_DOLLY_ROTATE||(this._state&D.TOUCH_ZOOM_ROTATE)===D.TOUCH_ZOOM_ROTATE)&&(this._sphericalEnd.theta=this._spherical.theta,this._sphericalEnd.phi=this._spherical.phi,this._thetaVelocity.value=0,this._phiVelocity.value=0),((this._state&D.TRUCK)===D.TRUCK||(this._state&D.TOUCH_TRUCK)===D.TOUCH_TRUCK||(this._state&D.TOUCH_DOLLY_TRUCK)===D.TOUCH_DOLLY_TRUCK||(this._state&D.TOUCH_ZOOM_TRUCK)===D.TOUCH_ZOOM_TRUCK)&&(this._targetEnd.copy(this._target),this._targetVelocity.set(0,0,0)),((this._state&D.DOLLY)===D.DOLLY||(this._state&D.TOUCH_DOLLY)===D.TOUCH_DOLLY||(this._state&D.TOUCH_DOLLY_TRUCK)===D.TOUCH_DOLLY_TRUCK||(this._state&D.TOUCH_DOLLY_OFFSET)===D.TOUCH_DOLLY_OFFSET||(this._state&D.TOUCH_DOLLY_ROTATE)===D.TOUCH_DOLLY_ROTATE)&&(this._sphericalEnd.radius=this._spherical.radius,this._radiusVelocity.value=0),((this._state&D.ZOOM)===D.ZOOM||(this._state&D.TOUCH_ZOOM)===D.TOUCH_ZOOM||(this._state&D.TOUCH_ZOOM_TRUCK)===D.TOUCH_ZOOM_TRUCK||(this._state&D.TOUCH_ZOOM_OFFSET)===D.TOUCH_ZOOM_OFFSET||(this._state&D.TOUCH_ZOOM_ROTATE)===D.TOUCH_ZOOM_ROTATE)&&(this._zoomEnd=this._zoom,this._zoomVelocity.value=0),((this._state&D.OFFSET)===D.OFFSET||(this._state&D.TOUCH_OFFSET)===D.TOUCH_OFFSET||(this._state&D.TOUCH_DOLLY_OFFSET)===D.TOUCH_DOLLY_OFFSET||(this._state&D.TOUCH_ZOOM_OFFSET)===D.TOUCH_ZOOM_OFFSET)&&(this._focalOffsetEnd.copy(this._focalOffset),this._focalOffsetVelocity.set(0,0,0)),this.dispatchEvent({type:"controlstart"})},_=()=>{if(!this._enabled||!this._dragNeedsUpdate)return;this._dragNeedsUpdate=!1,Ko(this._activePointers,ot);const g=this._domElement&&document.pointerLockElement===this._domElement?this._lockedPointer||this._activePointers[0]:null,w=g?-g.deltaX:i.x-ot.x,k=g?-g.deltaY:i.y-ot.y;if(i.copy(ot),((this._state&D.ROTATE)===D.ROTATE||(this._state&D.TOUCH_ROTATE)===D.TOUCH_ROTATE||(this._state&D.TOUCH_DOLLY_ROTATE)===D.TOUCH_DOLLY_ROTATE||(this._state&D.TOUCH_ZOOM_ROTATE)===D.TOUCH_ZOOM_ROTATE)&&(this._rotateInternal(w,k),this._isUserControllingRotate=!0),(this._state&D.DOLLY)===D.DOLLY||(this._state&D.ZOOM)===D.ZOOM){const x=this.dollyToCursor?(s.x-this._elementRect.x)/this._elementRect.width*2-1:0,C=this.dollyToCursor?(s.y-this._elementRect.y)/this._elementRect.height*-2+1:0,b=this.dollyDragInverted?-1:1;(this._state&D.DOLLY)===D.DOLLY?(this._dollyInternal(b*k*Rr,x,C),this._isUserControllingDolly=!0):(this._zoomInternal(b*k*Rr,x,C),this._isUserControllingZoom=!0)}if((this._state&D.TOUCH_DOLLY)===D.TOUCH_DOLLY||(this._state&D.TOUCH_ZOOM)===D.TOUCH_ZOOM||(this._state&D.TOUCH_DOLLY_TRUCK)===D.TOUCH_DOLLY_TRUCK||(this._state&D.TOUCH_ZOOM_TRUCK)===D.TOUCH_ZOOM_TRUCK||(this._state&D.TOUCH_DOLLY_OFFSET)===D.TOUCH_DOLLY_OFFSET||(this._state&D.TOUCH_ZOOM_OFFSET)===D.TOUCH_ZOOM_OFFSET||(this._state&D.TOUCH_DOLLY_ROTATE)===D.TOUCH_DOLLY_ROTATE||(this._state&D.TOUCH_ZOOM_ROTATE)===D.TOUCH_ZOOM_ROTATE){const x=ot.x-this._activePointers[1].clientX,C=ot.y-this._activePointers[1].clientY,b=Math.sqrt(x*x+C*C),O=r.y-b;r.set(0,b);const A=this.dollyToCursor?(i.x-this._elementRect.x)/this._elementRect.width*2-1:0,R=this.dollyToCursor?(i.y-this._elementRect.y)/this._elementRect.height*-2+1:0;(this._state&D.TOUCH_DOLLY)===D.TOUCH_DOLLY||(this._state&D.TOUCH_DOLLY_ROTATE)===D.TOUCH_DOLLY_ROTATE||(this._state&D.TOUCH_DOLLY_TRUCK)===D.TOUCH_DOLLY_TRUCK||(this._state&D.TOUCH_DOLLY_OFFSET)===D.TOUCH_DOLLY_OFFSET?(this._dollyInternal(O*Rr,A,R),this._isUserControllingDolly=!0):(this._zoomInternal(O*Rr,A,R),this._isUserControllingZoom=!0)}((this._state&D.TRUCK)===D.TRUCK||(this._state&D.TOUCH_TRUCK)===D.TOUCH_TRUCK||(this._state&D.TOUCH_DOLLY_TRUCK)===D.TOUCH_DOLLY_TRUCK||(this._state&D.TOUCH_ZOOM_TRUCK)===D.TOUCH_ZOOM_TRUCK)&&(this._truckInternal(w,k,!1),this._isUserControllingTruck=!0),((this._state&D.OFFSET)===D.OFFSET||(this._state&D.TOUCH_OFFSET)===D.TOUCH_OFFSET||(this._state&D.TOUCH_DOLLY_OFFSET)===D.TOUCH_DOLLY_OFFSET||(this._state&D.TOUCH_ZOOM_OFFSET)===D.TOUCH_ZOOM_OFFSET)&&(this._truckInternal(w,k,!0),this._isUserControllingOffset=!0),this.dispatchEvent({type:"control"})},v=()=>{Ko(this._activePointers,ot),i.copy(ot),this._dragNeedsUpdate=!1,(this._activePointers.length===0||this._activePointers.length===1&&this._activePointers[0]===this._lockedPointer)&&(this._isDragging=!1),this._activePointers.length===0&&this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointermove",c,{passive:!1}),this._domElement.ownerDocument.removeEventListener("mousemove",l),this._domElement.ownerDocument.removeEventListener("pointerup",u),this._domElement.ownerDocument.removeEventListener("mouseup",h),this.dispatchEvent({type:"controlend"}))};this.lockPointer=()=>{!this._enabled||!this._domElement||(this.cancel(),this._lockedPointer={pointerId:-1,clientX:0,clientY:0,deltaX:0,deltaY:0,mouseButton:null},this._activePointers.push(this._lockedPointer),this._domElement.ownerDocument.removeEventListener("pointermove",c,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",u),this._domElement.requestPointerLock(),this._domElement.ownerDocument.addEventListener("pointerlockchange",T),this._domElement.ownerDocument.addEventListener("pointerlockerror",S),this._domElement.ownerDocument.addEventListener("pointermove",c,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",u),p())},this.unlockPointer=()=>{this._lockedPointer!==null&&(this._disposePointer(this._lockedPointer),this._lockedPointer=null),document.exitPointerLock(),this.cancel(),this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointerlockchange",T),this._domElement.ownerDocument.removeEventListener("pointerlockerror",S))};const T=()=>{this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement||this.unlockPointer()},S=()=>{this.unlockPointer()};this._addAllEventListeners=y=>{this._domElement=y,this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none",this._domElement.addEventListener("pointerdown",o),Op&&this._domElement.addEventListener("mousedown",a),this._domElement.addEventListener("pointercancel",u),this._domElement.addEventListener("wheel",d,{passive:!1}),this._domElement.addEventListener("contextmenu",m)},this._removeAllEventListeners=()=>{this._domElement&&(this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect="",this._domElement.removeEventListener("pointerdown",o),this._domElement.removeEventListener("mousedown",a),this._domElement.removeEventListener("pointercancel",u),this._domElement.removeEventListener("wheel",d,{passive:!1}),this._domElement.removeEventListener("contextmenu",m),this._domElement.ownerDocument.removeEventListener("pointermove",c,{passive:!1}),this._domElement.ownerDocument.removeEventListener("mousemove",l),this._domElement.ownerDocument.removeEventListener("pointerup",u),this._domElement.ownerDocument.removeEventListener("mouseup",h),this._domElement.ownerDocument.removeEventListener("pointerlockchange",T),this._domElement.ownerDocument.removeEventListener("pointerlockerror",S))},this.cancel=()=>{this._state!==D.NONE&&(this._state=D.NONE,this._activePointers.length=0,v())},t&&this.connect(t),this.update(0)}get camera(){return this._camera}set camera(e){this._camera=e,this.updateCameraUp(),this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this._domElement&&(e?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect=""))}get active(){return!this._hasRested}get currentAction(){return this._state}get distance(){return this._spherical.radius}set distance(e){this._spherical.radius===e&&this._sphericalEnd.radius===e||(this._spherical.radius=e,this._sphericalEnd.radius=e,this._needsUpdate=!0)}get azimuthAngle(){return this._spherical.theta}set azimuthAngle(e){this._spherical.theta===e&&this._sphericalEnd.theta===e||(this._spherical.theta=e,this._sphericalEnd.theta=e,this._needsUpdate=!0)}get polarAngle(){return this._spherical.phi}set polarAngle(e){this._spherical.phi===e&&this._sphericalEnd.phi===e||(this._spherical.phi=e,this._sphericalEnd.phi=e,this._needsUpdate=!0)}get boundaryEnclosesCamera(){return this._boundaryEnclosesCamera}set boundaryEnclosesCamera(e){this._boundaryEnclosesCamera=e,this._needsUpdate=!0}set interactiveArea(e){this._interactiveArea.width=It(e.width,0,1),this._interactiveArea.height=It(e.height,0,1),this._interactiveArea.x=It(e.x,0,1-this._interactiveArea.width),this._interactiveArea.y=It(e.y,0,1-this._interactiveArea.height)}addEventListener(e,t){super.addEventListener(e,t)}removeEventListener(e,t){super.removeEventListener(e,t)}rotate(e,t,s=!1){return this.rotateTo(this._sphericalEnd.theta+e,this._sphericalEnd.phi+t,s)}rotateAzimuthTo(e,t=!1){return this.rotateTo(e,this._sphericalEnd.phi,t)}rotatePolarTo(e,t=!1){return this.rotateTo(this._sphericalEnd.theta,e,t)}rotateTo(e,t,s=!1){this._isUserControllingRotate=!1;const i=It(e,this.minAzimuthAngle,this.maxAzimuthAngle),r=It(t,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=i,this._sphericalEnd.phi=r,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,s||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);const o=!s||oe(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&oe(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(o)}dolly(e,t=!1){return this.dollyTo(this._sphericalEnd.radius-e,t)}dollyTo(e,t=!1){return this._isUserControllingDolly=!1,this._lastDollyDirection=On.NONE,this._changedDolly=0,this._dollyToNoClamp(It(e,this.minDistance,this.maxDistance),t)}_dollyToNoClamp(e,t=!1){const s=this._sphericalEnd.radius;if(this.colliderMeshes.length>=1){const o=this._collisionTest(),a=oe(o,this._spherical.radius);if(!(s>e)&&a)return Promise.resolve();this._sphericalEnd.radius=Math.min(e,o)}else this._sphericalEnd.radius=e;this._needsUpdate=!0,t||(this._spherical.radius=this._sphericalEnd.radius);const r=!t||oe(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(r)}dollyInFixed(e,t=!1){this._targetEnd.add(this._getCameraDirection(Si).multiplyScalar(e)),t||this._target.copy(this._targetEnd);const s=!t||oe(this._target.x,this._targetEnd.x,this.restThreshold)&&oe(this._target.y,this._targetEnd.y,this.restThreshold)&&oe(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(s)}zoom(e,t=!1){return this.zoomTo(this._zoomEnd+e,t)}zoomTo(e,t=!1){this._isUserControllingZoom=!1,this._zoomEnd=It(e,this.minZoom,this.maxZoom),this._needsUpdate=!0,t||(this._zoom=this._zoomEnd);const s=!t||oe(this._zoom,this._zoomEnd,this.restThreshold);return this._changedZoom=0,this._createOnRestPromise(s)}pan(e,t,s=!1){return console.warn("`pan` has been renamed to `truck`"),this.truck(e,t,s)}truck(e,t,s=!1){this._camera.updateMatrix(),Wt.setFromMatrixColumn(this._camera.matrix,0),Gt.setFromMatrixColumn(this._camera.matrix,1),Wt.multiplyScalar(e),Gt.multiplyScalar(-t);const i=J.copy(Wt).add(Gt),r=ne.copy(this._targetEnd).add(i);return this.moveTo(r.x,r.y,r.z,s)}forward(e,t=!1){J.setFromMatrixColumn(this._camera.matrix,0),J.crossVectors(this._camera.up,J),J.multiplyScalar(e);const s=ne.copy(this._targetEnd).add(J);return this.moveTo(s.x,s.y,s.z,t)}elevate(e,t=!1){return J.copy(this._camera.up).multiplyScalar(e),this.moveTo(this._targetEnd.x+J.x,this._targetEnd.y+J.y,this._targetEnd.z+J.z,t)}moveTo(e,t,s,i=!1){this._isUserControllingTruck=!1;const r=J.set(e,t,s).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,r,this.boundaryFriction),this._needsUpdate=!0,i||this._target.copy(this._targetEnd);const o=!i||oe(this._target.x,this._targetEnd.x,this.restThreshold)&&oe(this._target.y,this._targetEnd.y,this.restThreshold)&&oe(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(o)}lookInDirectionOf(e,t,s,i=!1){const a=J.set(e,t,s).sub(this._targetEnd).normalize().multiplyScalar(-this._sphericalEnd.radius);return this.setPosition(a.x,a.y,a.z,i)}fitToBox(e,t,{cover:s=!1,paddingLeft:i=0,paddingRight:r=0,paddingBottom:o=0,paddingTop:a=0}={}){const c=[],l=e.isBox3?Dn.copy(e):Dn.setFromObject(e);l.isEmpty()&&(console.warn("camera-controls: fitTo() cannot be used with an empty box. Aborting"),Promise.resolve());const u=rl(this._sphericalEnd.theta,il),h=rl(this._sphericalEnd.phi,il);c.push(this.rotateTo(u,h,t));const f=J.setFromSpherical(this._sphericalEnd).normalize(),d=hl.setFromUnitVectors(f,ea),m=oe(Math.abs(f.y),1);m&&d.multiply(sa.setFromAxisAngle(Pr,u)),d.multiply(this._yAxisUpSpaceInverse);const p=ul.makeEmpty();ne.copy(l.min).applyQuaternion(d),p.expandByPoint(ne),ne.copy(l.min).setX(l.max.x).applyQuaternion(d),p.expandByPoint(ne),ne.copy(l.min).setY(l.max.y).applyQuaternion(d),p.expandByPoint(ne),ne.copy(l.max).setZ(l.min.z).applyQuaternion(d),p.expandByPoint(ne),ne.copy(l.min).setZ(l.max.z).applyQuaternion(d),p.expandByPoint(ne),ne.copy(l.max).setY(l.min.y).applyQuaternion(d),p.expandByPoint(ne),ne.copy(l.max).setX(l.min.x).applyQuaternion(d),p.expandByPoint(ne),ne.copy(l.max).applyQuaternion(d),p.expandByPoint(ne),p.min.x-=i,p.min.y-=o,p.max.x+=r,p.max.y+=a,d.setFromUnitVectors(ea,f),m&&d.premultiply(sa.invert()),d.premultiply(this._yAxisUpSpace);const _=p.getSize(J),v=p.getCenter(ne).applyQuaternion(d);if(Qs(this._camera)){const T=this.getDistanceToFitBox(_.x,_.y,_.z,s);c.push(this.moveTo(v.x,v.y,v.z,t)),c.push(this.dollyTo(T,t)),c.push(this.setFocalOffset(0,0,0,t))}else if(As(this._camera)){const T=this._camera,S=T.right-T.left,y=T.top-T.bottom,g=s?Math.max(S/_.x,y/_.y):Math.min(S/_.x,y/_.y);c.push(this.moveTo(v.x,v.y,v.z,t)),c.push(this.zoomTo(g,t)),c.push(this.setFocalOffset(0,0,0,t))}return Promise.all(c)}fitToSphere(e,t){const s=[],r=e instanceof G.Sphere?ta.copy(e):wa.createBoundingSphere(e,ta);if(s.push(this.moveTo(r.center.x,r.center.y,r.center.z,t)),Qs(this._camera)){const o=this.getDistanceToFitSphere(r.radius);s.push(this.dollyTo(o,t))}else if(As(this._camera)){const o=this._camera.right-this._camera.left,a=this._camera.top-this._camera.bottom,c=2*r.radius,l=Math.min(o/c,a/c);s.push(this.zoomTo(l,t))}return s.push(this.setFocalOffset(0,0,0,t)),Promise.all(s)}setLookAt(e,t,s,i,r,o,a=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=On.NONE,this._changedDolly=0;const c=ne.set(i,r,o),l=J.set(e,t,s);this._targetEnd.copy(c),this._sphericalEnd.setFromVector3(l.sub(c).applyQuaternion(this._yAxisUpSpace)),this.normalizeRotations(),this._needsUpdate=!0,a||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const u=!a||oe(this._target.x,this._targetEnd.x,this.restThreshold)&&oe(this._target.y,this._targetEnd.y,this.restThreshold)&&oe(this._target.z,this._targetEnd.z,this.restThreshold)&&oe(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&oe(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&oe(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(u)}lerpLookAt(e,t,s,i,r,o,a,c,l,u,h,f,d,m=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=On.NONE,this._changedDolly=0;const p=J.set(i,r,o),_=ne.set(e,t,s);St.setFromVector3(_.sub(p).applyQuaternion(this._yAxisUpSpace));const v=Mn.set(u,h,f),T=ne.set(a,c,l);Ci.setFromVector3(T.sub(v).applyQuaternion(this._yAxisUpSpace)),this._targetEnd.copy(p.lerp(v,d));const S=Ci.theta-St.theta,y=Ci.phi-St.phi,g=Ci.radius-St.radius;this._sphericalEnd.set(St.radius+g*d,St.phi+y*d,St.theta+S*d),this.normalizeRotations(),this._needsUpdate=!0,m||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const w=!m||oe(this._target.x,this._targetEnd.x,this.restThreshold)&&oe(this._target.y,this._targetEnd.y,this.restThreshold)&&oe(this._target.z,this._targetEnd.z,this.restThreshold)&&oe(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&oe(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&oe(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(w)}setPosition(e,t,s,i=!1){return this.setLookAt(e,t,s,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,i)}setTarget(e,t,s,i=!1){const r=this.getPosition(J),o=this.setLookAt(r.x,r.y,r.z,e,t,s,i);return this._sphericalEnd.phi=It(this._sphericalEnd.phi,this.minPolarAngle,this.maxPolarAngle),o}setFocalOffset(e,t,s,i=!1){this._isUserControllingOffset=!1,this._focalOffsetEnd.set(e,t,s),this._needsUpdate=!0,i||this._focalOffset.copy(this._focalOffsetEnd);const r=!i||oe(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&oe(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&oe(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(r)}setOrbitPoint(e,t,s){this._camera.updateMatrixWorld(),Wt.setFromMatrixColumn(this._camera.matrixWorldInverse,0),Gt.setFromMatrixColumn(this._camera.matrixWorldInverse,1),Ks.setFromMatrixColumn(this._camera.matrixWorldInverse,2);const i=J.set(e,t,s),r=i.distanceTo(this._camera.position),o=i.sub(this._camera.position);Wt.multiplyScalar(o.x),Gt.multiplyScalar(o.y),Ks.multiplyScalar(o.z),J.copy(Wt).add(Gt).add(Ks),J.z=J.z+r,this.dollyTo(r,!1),this.setFocalOffset(-J.x,J.y,-J.z,!1),this.moveTo(e,t,s,!1)}setBoundary(e){if(!e){this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),this._needsUpdate=!0;return}this._boundary.copy(e),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}setViewport(e,t,s,i){if(e===null){this._viewport=null;return}this._viewport=this._viewport||new G.Vector4,typeof e=="number"?this._viewport.set(e,t,s,i):this._viewport.copy(e)}getDistanceToFitBox(e,t,s,i=!1){if(Jo(this._camera,"getDistanceToFitBox"))return this._spherical.radius;const r=e/t,o=this._camera.getEffectiveFOV()*Ti,a=this._camera.aspect;return((i?r>a:r<a)?t:e/a)*.5/Math.tan(o*.5)+s*.5}getDistanceToFitSphere(e){if(Jo(this._camera,"getDistanceToFitSphere"))return this._spherical.radius;const t=this._camera.getEffectiveFOV()*Ti,s=Math.atan(Math.tan(t*.5)*this._camera.aspect)*2,i=1<this._camera.aspect?t:s;return e/Math.sin(i*.5)}getTarget(e,t=!0){return(e&&e.isVector3?e:new G.Vector3).copy(t?this._targetEnd:this._target)}getPosition(e,t=!0){return(e&&e.isVector3?e:new G.Vector3).setFromSpherical(t?this._sphericalEnd:this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(t?this._targetEnd:this._target)}getSpherical(e,t=!0){return(e&&e instanceof G.Spherical?e:new G.Spherical).copy(t?this._sphericalEnd:this._spherical)}getFocalOffset(e,t=!0){return(e&&e.isVector3?e:new G.Vector3).copy(t?this._focalOffsetEnd:this._focalOffset)}normalizeRotations(){this._sphericalEnd.theta=this._sphericalEnd.theta%An,this._sphericalEnd.theta<0&&(this._sphericalEnd.theta+=An),this._spherical.theta+=An*Math.round((this._sphericalEnd.theta-this._spherical.theta)/An)}reset(e=!1){if(!oe(this._camera.up.x,this._cameraUp0.x)||!oe(this._camera.up.y,this._cameraUp0.y)||!oe(this._camera.up.z,this._cameraUp0.z)){this._camera.up.copy(this._cameraUp0);const s=this.getPosition(J);this.updateCameraUp(),this.setPosition(s.x,s.y,s.z)}const t=[this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,e),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,e),this.zoomTo(this._zoom0,e)];return Promise.all(t)}saveState(){this._cameraUp0.copy(this._camera.up),this.getTarget(this._target0),this.getPosition(this._position0),this._zoom0=this._zoom,this._focalOffset0.copy(this._focalOffset)}updateCameraUp(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,Pr),this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace).invert()}applyCameraUp(){const e=J.subVectors(this._target,this._camera.position).normalize(),t=ne.crossVectors(e,this._camera.up);this._camera.up.crossVectors(t,e).normalize(),this._camera.updateMatrixWorld();const s=this.getPosition(J);this.updateCameraUp(),this.setPosition(s.x,s.y,s.z)}update(e){const t=this._sphericalEnd.theta-this._spherical.theta,s=this._sphericalEnd.phi-this._spherical.phi,i=this._sphericalEnd.radius-this._spherical.radius,r=cl.subVectors(this._targetEnd,this._target),o=ll.subVectors(this._focalOffsetEnd,this._focalOffset),a=this._zoomEnd-this._zoom;if(ge(t))this._thetaVelocity.value=0,this._spherical.theta=this._sphericalEnd.theta;else{const h=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.theta=Dr(this._spherical.theta,this._sphericalEnd.theta,this._thetaVelocity,h,1/0,e),this._needsUpdate=!0}if(ge(s))this._phiVelocity.value=0,this._spherical.phi=this._sphericalEnd.phi;else{const h=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.phi=Dr(this._spherical.phi,this._sphericalEnd.phi,this._phiVelocity,h,1/0,e),this._needsUpdate=!0}if(ge(i))this._radiusVelocity.value=0,this._spherical.radius=this._sphericalEnd.radius;else{const h=this._isUserControllingDolly?this.draggingSmoothTime:this.smoothTime;this._spherical.radius=Dr(this._spherical.radius,this._sphericalEnd.radius,this._radiusVelocity,h,this.maxSpeed,e),this._needsUpdate=!0}if(ge(r.x)&&ge(r.y)&&ge(r.z))this._targetVelocity.set(0,0,0),this._target.copy(this._targetEnd);else{const h=this._isUserControllingTruck?this.draggingSmoothTime:this.smoothTime;ol(this._target,this._targetEnd,this._targetVelocity,h,this.maxSpeed,e,this._target),this._needsUpdate=!0}if(ge(o.x)&&ge(o.y)&&ge(o.z))this._focalOffsetVelocity.set(0,0,0),this._focalOffset.copy(this._focalOffsetEnd);else{const h=this._isUserControllingOffset?this.draggingSmoothTime:this.smoothTime;ol(this._focalOffset,this._focalOffsetEnd,this._focalOffsetVelocity,h,this.maxSpeed,e,this._focalOffset),this._needsUpdate=!0}if(ge(a))this._zoomVelocity.value=0,this._zoom=this._zoomEnd;else{const h=this._isUserControllingZoom?this.draggingSmoothTime:this.smoothTime;this._zoom=Dr(this._zoom,this._zoomEnd,this._zoomVelocity,h,1/0,e)}if(this.dollyToCursor){if(Qs(this._camera)&&this._changedDolly!==0){const h=this._spherical.radius-this._lastDistance,f=this._camera,d=this._getCameraDirection(Si),m=J.copy(d).cross(f.up).normalize();m.lengthSq()===0&&(m.x=1);const p=ne.crossVectors(m,d),_=this._sphericalEnd.radius*Math.tan(f.getEffectiveFOV()*Ti*.5),T=(this._sphericalEnd.radius-h-this._sphericalEnd.radius)/this._sphericalEnd.radius,S=Mn.copy(this._targetEnd).add(m.multiplyScalar(this._dollyControlCoord.x*_*f.aspect)).add(p.multiplyScalar(this._dollyControlCoord.y*_)),y=J.copy(this._targetEnd).lerp(S,T),g=this._lastDollyDirection===On.IN&&this._spherical.radius<=this.minDistance,w=this._lastDollyDirection===On.OUT&&this.maxDistance<=this._spherical.radius;if(this.infinityDolly&&(g||w)){this._sphericalEnd.radius-=h,this._spherical.radius-=h;const x=ne.copy(d).multiplyScalar(-h);y.add(x)}this._boundary.clampPoint(y,y);const k=ne.subVectors(y,this._targetEnd);this._targetEnd.copy(y),this._target.add(k),this._changedDolly-=h,ge(this._changedDolly)&&(this._changedDolly=0)}else if(As(this._camera)&&this._changedZoom!==0){const h=this._zoom-this._lastZoom,f=this._camera,d=J.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(f.near+f.far)/(f.near-f.far)).unproject(f),m=ne.set(0,0,-1).applyQuaternion(f.quaternion),p=Mn.copy(d).add(m.multiplyScalar(-d.dot(f.up))),v=-(this._zoom-h-this._zoom)/this._zoom,T=this._getCameraDirection(Si),S=this._targetEnd.dot(T),y=J.copy(this._targetEnd).lerp(p,v),g=y.dot(T),w=T.multiplyScalar(g-S);y.sub(w),this._boundary.clampPoint(y,y);const k=ne.subVectors(y,this._targetEnd);this._targetEnd.copy(y),this._target.add(k),this._changedZoom-=h,ge(this._changedZoom)&&(this._changedZoom=0)}}this._camera.zoom!==this._zoom&&(this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0),this._dragNeedsUpdate=!0;const c=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,c),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target),(!ge(this._focalOffset.x)||!ge(this._focalOffset.y)||!ge(this._focalOffset.z))&&(this._camera.updateMatrixWorld(),Wt.setFromMatrixColumn(this._camera.matrix,0),Gt.setFromMatrixColumn(this._camera.matrix,1),Ks.setFromMatrixColumn(this._camera.matrix,2),Wt.multiplyScalar(this._focalOffset.x),Gt.multiplyScalar(-this._focalOffset.y),Ks.multiplyScalar(this._focalOffset.z),J.copy(Wt).add(Gt).add(Ks),this._camera.position.add(J)),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),J.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);const u=this._needsUpdate;return u&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):u?(this.dispatchEvent({type:"update"}),ge(t,this.restThreshold)&&ge(s,this.restThreshold)&&ge(i,this.restThreshold)&&ge(r.x,this.restThreshold)&&ge(r.y,this.restThreshold)&&ge(r.z,this.restThreshold)&&ge(o.x,this.restThreshold)&&ge(o.y,this.restThreshold)&&ge(o.z,this.restThreshold)&&ge(a,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!u&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._lastDistance=this._spherical.radius,this._lastZoom=this._zoom,this._updatedLastTime=u,this._needsUpdate=!1,u}toJSON(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:wi(this.maxDistance),minZoom:this.minZoom,maxZoom:wi(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:wi(this.maxPolarAngle),minAzimuthAngle:wi(this.minAzimuthAngle),maxAzimuthAngle:wi(this.maxAzimuthAngle),smoothTime:this.smoothTime,draggingSmoothTime:this.draggingSmoothTime,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,verticalDragToForward:this.verticalDragToForward,target:this._targetEnd.toArray(),position:J.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}fromJSON(e,t=!1){const s=JSON.parse(e);this.enabled=s.enabled,this.minDistance=s.minDistance,this.maxDistance=ki(s.maxDistance),this.minZoom=s.minZoom,this.maxZoom=ki(s.maxZoom),this.minPolarAngle=s.minPolarAngle,this.maxPolarAngle=ki(s.maxPolarAngle),this.minAzimuthAngle=ki(s.minAzimuthAngle),this.maxAzimuthAngle=ki(s.maxAzimuthAngle),this.smoothTime=s.smoothTime,this.draggingSmoothTime=s.draggingSmoothTime,this.dollySpeed=s.dollySpeed,this.truckSpeed=s.truckSpeed,this.dollyToCursor=s.dollyToCursor,this.verticalDragToForward=s.verticalDragToForward,this._target0.fromArray(s.target0),this._position0.fromArray(s.position0),this._zoom0=s.zoom0,this._focalOffset0.fromArray(s.focalOffset0),this.moveTo(s.target[0],s.target[1],s.target[2],t),St.setFromVector3(J.fromArray(s.position).sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(St.theta,St.phi,t),this.dollyTo(St.radius,t),this.zoomTo(s.zoom,t),this.setFocalOffset(s.focalOffset[0],s.focalOffset[1],s.focalOffset[2],t),this._needsUpdate=!0}connect(e){if(this._domElement){console.warn("camera-controls is already connected.");return}e.setAttribute("data-camera-controls-version",bp),this._addAllEventListeners(e),this._getClientRect(this._elementRect)}disconnect(){this.cancel(),this._removeAllEventListeners(),this._domElement&&(this._domElement.removeAttribute("data-camera-controls-version"),this._domElement=void 0)}dispose(){this.removeAllEventListeners(),this.disconnect()}_getTargetDirection(e){return e.setFromSpherical(this._spherical).divideScalar(this._spherical.radius).applyQuaternion(this._yAxisUpSpaceInverse)}_getCameraDirection(e){return this._getTargetDirection(e).negate()}_findPointerById(e){return this._activePointers.find(t=>t.pointerId===e)}_findPointerByMouseButton(e){return this._activePointers.find(t=>t.mouseButton===e)}_disposePointer(e){this._activePointers.splice(this._activePointers.indexOf(e),1)}_encloseToBoundary(e,t,s){const i=t.lengthSq();if(i===0)return e;const r=ne.copy(t).add(e),a=this._boundary.clampPoint(r,Mn).sub(r),c=a.lengthSq();if(c===0)return e.add(t);if(c===i)return e;if(s===0)return e.add(t).add(a);{const l=1+s*c/t.dot(a);return e.add(ne.copy(t).multiplyScalar(l)).add(a.multiplyScalar(1-s))}}_updateNearPlaneCorners(){if(Qs(this._camera)){const e=this._camera,t=e.near,s=e.getEffectiveFOV()*Ti,i=Math.tan(s*.5)*t,r=i*e.aspect;this._nearPlaneCorners[0].set(-r,-i,0),this._nearPlaneCorners[1].set(r,-i,0),this._nearPlaneCorners[2].set(r,i,0),this._nearPlaneCorners[3].set(-r,i,0)}else if(As(this._camera)){const e=this._camera,t=1/e.zoom,s=e.left*t,i=e.right*t,r=e.top*t,o=e.bottom*t;this._nearPlaneCorners[0].set(s,r,0),this._nearPlaneCorners[1].set(i,r,0),this._nearPlaneCorners[2].set(i,o,0),this._nearPlaneCorners[3].set(s,o,0)}}_collisionTest(){let e=1/0;if(!(this.colliderMeshes.length>=1)||Jo(this._camera,"_collisionTest"))return e;const s=this._getTargetDirection(Si);na.lookAt(al,s,this._camera.up);for(let i=0;i<4;i++){const r=ne.copy(this._nearPlaneCorners[i]);r.applyMatrix4(na);const o=Mn.addVectors(this._target,r);Ir.set(o,s),Ir.far=this._spherical.radius+1;const a=Ir.intersectObjects(this.colliderMeshes);a.length!==0&&a[0].distance<e&&(e=a[0].distance)}return e}_getClientRect(e){if(!this._domElement)return;const t=this._domElement.getBoundingClientRect();return e.x=t.left,e.y=t.top,this._viewport?(e.x+=this._viewport.x,e.y+=t.height-this._viewport.w-this._viewport.y,e.width=this._viewport.z,e.height=this._viewport.w):(e.width=t.width,e.height=t.height),e}_createOnRestPromise(e){return e?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise(t=>{const s=()=>{this.removeEventListener("rest",s),t()};this.addEventListener("rest",s)}))}_addAllEventListeners(e){}_removeAllEventListeners(){}get dampingFactor(){return console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead."),0}set dampingFactor(e){console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead.")}get draggingDampingFactor(){return console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead."),0}set draggingDampingFactor(e){console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead.")}static createBoundingSphere(e,t=new G.Sphere){const s=t,i=s.center;Dn.makeEmpty(),e.traverseVisible(o=>{o.isMesh&&Dn.expandByObject(o)}),Dn.getCenter(i);let r=0;return e.traverseVisible(o=>{if(!o.isMesh)return;const a=o,c=a.geometry.clone();c.applyMatrix4(a.matrixWorld);const u=c.attributes.position;for(let h=0,f=u.count;h<f;h++)J.fromBufferAttribute(u,h),r=Math.max(r,i.distanceToSquared(J))}),s.radius=Math.sqrt(r),s}};const Ap=E.forwardRef((n,e)=>{E.useMemo(()=>{ia.install({THREE:Mf}),Qa({CameraControlsImpl:ia})},[]);const{camera:t,domElement:s,makeDefault:i,onStart:r,onEnd:o,onChange:a,regress:c,...l}=n,u=ve(g=>g.camera),h=ve(g=>g.gl),f=ve(g=>g.invalidate),d=ve(g=>g.events),m=ve(g=>g.setEvents),p=ve(g=>g.set),_=ve(g=>g.get),v=ve(g=>g.performance),T=t||u,S=s||d.connected||h.domElement,y=E.useMemo(()=>new ia(T),[T]);return Rt((g,w)=>{y.enabled&&y.update(w)},-1),E.useEffect(()=>(y.connect(S),()=>void y.disconnect()),[S,y]),E.useEffect(()=>{const g=x=>{f(),c&&v.regress(),a&&a(x)},w=x=>{r&&r(x)},k=x=>{o&&o(x)};return y.addEventListener("update",g),y.addEventListener("controlstart",w),y.addEventListener("controlend",k),()=>{y.removeEventListener("update",g),y.removeEventListener("controlstart",w),y.removeEventListener("controlend",k)}},[y,r,o,f,m,c,a]),E.useEffect(()=>{if(i){const g=_().controls;return p({controls:y}),()=>p({controls:g})}},[i,y]),E.createElement("primitive",$a({ref:e,object:y},l))}),ku=E.createContext(null),Mp=E.forwardRef((n,e)=>{E.useMemo(()=>Qa({SegmentObject:Dp}),[]);const{limit:t=1e3,lineWidth:s=1,children:i,...r}=n,[o,a]=E.useState([]),[c]=E.useState(()=>new _f),[l]=E.useState(()=>new gf),[u]=E.useState(()=>new vf),[h]=E.useState(()=>new Fe(512,512)),[f]=E.useState(()=>Array(t*6).fill(0)),[d]=E.useState(()=>Array(t*6).fill(0)),m=E.useMemo(()=>({subscribe:p=>(a(_=>[..._,p]),()=>a(_=>_.filter(v=>v.current!==p.current)))}),[]);return Rt(()=>{for(let _=0;_<t;_++){var p;const v=(p=o[_])==null?void 0:p.current;v&&(f[_*6+0]=v.start.x,f[_*6+1]=v.start.y,f[_*6+2]=v.start.z,f[_*6+3]=v.end.x,f[_*6+4]=v.end.y,f[_*6+5]=v.end.z,d[_*6+0]=v.color.r,d[_*6+1]=v.color.g,d[_*6+2]=v.color.b,d[_*6+3]=v.color.r,d[_*6+4]=v.color.g,d[_*6+5]=v.color.b)}u.setColors(d),u.setPositions(f),c.computeLineDistances()}),E.createElement("primitive",{object:c,ref:e},E.createElement("primitive",{object:u,attach:"geometry"}),E.createElement("primitive",$a({object:l,attach:"material",vertexColors:!0,resolution:h,linewidth:s},r)),E.createElement(ku.Provider,{value:m},i))});class Dp{constructor(){this.color=new hs("white"),this.start=new X(0,0,0),this.end=new X(0,0,0)}}const dl=n=>n instanceof X?n:new X(...typeof n=="number"?[n,n,n]:n),Rp=E.forwardRef(({color:n,start:e,end:t},s)=>{const i=E.useContext(ku);if(!i)throw"Segment must used inside Segments component.";const r=E.useRef(null);return E.useLayoutEffect(()=>i.subscribe(r),[]),E.createElement("segmentObject",{ref:yf([r,s]),color:n,start:dl(e),end:dl(t)})});function Pp({all:n,scene:e,camera:t}){const s=ve(({gl:o})=>o),i=ve(({camera:o})=>o),r=ve(({scene:o})=>o);return E.useLayoutEffect(()=>{const o=[];n&&(e||r).traverse(l=>{l.visible===!1&&(o.push(l),l.visible=!0)}),s.compile(e||r,t||i);const a=new Df(128);new Rf(.01,1e5,a).update(s,e||r),a.dispose(),o.forEach(l=>l.visible=!1)},[]),null}function Ip({pixelated:n}){const e=ve(o=>o.gl),t=ve(o=>o.internal.active),s=ve(o=>o.performance.current),i=ve(o=>o.viewport.initialDpr),r=ve(o=>o.setDpr);return E.useEffect(()=>{const o=e.domElement;return()=>{t&&r(i),n&&o&&(o.style.imageRendering="auto")}},[]),E.useEffect(()=>{r(s*i),n&&e.domElement&&(e.domElement.style.imageRendering=s===1?"auto":"pixelated")},[s]),null}function Np(){const n=ve(s=>s.get),e=ve(s=>s.setEvents),t=ve(s=>s.performance.current);return E.useEffect(()=>{const s=n().events.enabled;return()=>e({enabled:s})},[]),E.useEffect(()=>e({enabled:t===1}),[t]),null}const tc=E.createContext(null);function Fp({children:n,enabled:e=!0}){const[t,s]=E.useState([]),i=E.useMemo(()=>({selected:t,select:s,enabled:e}),[t,s,e]);return M.jsx(tc.Provider,{value:i,children:n})}function Up({enabled:n=!1,children:e,...t}){const s=E.useRef(null),i=E.useContext(tc);return E.useEffect(()=>{if(i&&n){let r=!1;const o=[];if(s.current.traverse(a=>{a.type==="Mesh"&&o.push(a),i.selected.indexOf(a)===-1&&(r=!0)}),r)return i.select(a=>[...a,...o]),()=>{i.select(a=>a.filter(c=>!o.includes(c)))}}},[n,e,i]),M.jsx("group",{ref:s,...t,children:e})}/**
 * postprocessing v6.33.4 build Sat Dec 02 2023
 * https://github.com/pmndrs/postprocessing
 * Copyright 2015-2023 Raoul van Rschen
 * @license Zlib
 */var Su="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",ee={SKIP:9,SET:30,ADD:0,ALPHA:1,AVERAGE:2,COLOR:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,DIVIDE:8,DST:9,EXCLUSION:10,HARD_LIGHT:11,HARD_MIX:12,HUE:13,INVERT:14,INVERT_RGB:15,LIGHTEN:16,LINEAR_BURN:17,LINEAR_DODGE:18,LINEAR_LIGHT:19,LUMINOSITY:20,MULTIPLY:21,NEGATION:22,NORMAL:23,OVERLAY:24,PIN_LIGHT:25,REFLECT:26,SATURATION:27,SCREEN:28,SOFT_LIGHT:29,SRC:30,SUBTRACT:31,VIVID_LIGHT:32},Cu="",qe="srgb",Ao="srgb-linear",ds={NONE:0,DEPTH:1,CONVOLUTION:2},ie={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},Mo={VERY_SMALL:0,SMALL:1,MEDIUM:2,LARGE:3,VERY_LARGE:4,HUGE:5},Nr={DEFAULT:0,ESKIL:1},bu=Number(Ja.replace(/\D+/g,"")),Eu=bu>=152,Lp=new Map([[vu,Ao],[yu,qe]]),Bp=new Map([[Ao,vu],[qe,yu]]);function Yn(n){return n===null?null:Eu?n.outputColorSpace:Lp.get(n.outputEncoding)}function Is(n,e){n!==null&&(Eu?n.colorSpace=e:n.encoding=Bp.get(e))}function pr(n){return bu<154?n.replace("colorspace_fragment","encodings_fragment"):n}var zp=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;
#include <colorspace_fragment>
}`,Vp="uniform vec4 texelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize.xy*vec2(kernel)+texelSize.zw)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}",jp=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],Hp=class extends es{constructor(n=new el){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new Q(null),texelSize:new Q(new el),scale:new Q(1),kernel:new Q(0)},blending:Ts,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:zp,vertexShader:Vp}),this.fragmentShader=pr(this.fragmentShader),this.setTexelSize(n.x,n.y),this.kernelSize=Mo.MEDIUM}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.inputBuffer=n}get kernelSequence(){return jp[this.kernelSize]}get scale(){return this.uniforms.scale.value}set scale(n){this.uniforms.scale.value=n}getScale(){return this.uniforms.scale.value}setScale(n){this.uniforms.scale.value=n}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(n){this.uniforms.kernel.value=n}setKernel(n){this.kernel=n}setTexelSize(n,e){this.uniforms.texelSize.value.set(n,e,n*.5,e*.5)}setSize(n,e){const t=1/n,s=1/e;this.uniforms.texelSize.value.set(t,s,t*.5,s*.5)}},qp=`#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;
#include <colorspace_fragment>
#include <dithering_fragment>
}`,Ou=class extends es{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new Q(null),opacity:new Q(1)},blending:Ts,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:qp,vertexShader:Su}),this.fragmentShader=pr(this.fragmentShader)}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}getOpacity(n){return this.uniforms.opacity.value}setOpacity(n){this.uniforms.opacity.value=n}},Wp=`#include <packing>
#include <clipping_planes_pars_fragment>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform float cameraNear;uniform float cameraFar;centroid varying float vViewZ;centroid varying vec4 vProjTexCoord;void main(){
#include <clipping_planes_fragment>
vec2 projTexCoord=(vProjTexCoord.xy/vProjTexCoord.w)*0.5+0.5;projTexCoord=clamp(projTexCoord,0.002,0.998);
#if DEPTH_PACKING == 3201
float fragCoordZ=unpackRGBAToDepth(texture2D(depthBuffer,projTexCoord));
#else
float fragCoordZ=texture2D(depthBuffer,projTexCoord).r;
#endif
#ifdef PERSPECTIVE_CAMERA
float viewZ=perspectiveDepthToViewZ(fragCoordZ,cameraNear,cameraFar);
#else
float viewZ=orthographicDepthToViewZ(fragCoordZ,cameraNear,cameraFar);
#endif
float depthTest=(-vViewZ>-viewZ)?1.0:0.0;gl_FragColor.rg=vec2(0.0,depthTest);}`,Gp=`#include <common>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
varying float vViewZ;varying vec4 vProjTexCoord;void main(){
#include <skinbase_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <project_vertex>
vViewZ=mvPosition.z;vProjTexCoord=gl_Position;
#include <clipping_planes_vertex>
}`,Yp=class extends es{constructor(n=null,e){super({name:"DepthComparisonMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new Q(null),cameraNear:new Q(.3),cameraFar:new Q(1e3)},blending:Ts,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Wp,vertexShader:Gp}),this.depthBuffer=n,this.depthPacking=Ta,this.copyCameraSettings(e)}set depthBuffer(n){this.uniforms.depthBuffer.value=n}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,e=Ta){this.depthBuffer=n,this.depthPacking=e}adoptCameraSettings(n){this.copyCameraSettings(n)}copyCameraSettings(n){n&&(this.uniforms.cameraNear.value=n.near,this.uniforms.cameraFar.value=n.far,n instanceof mu?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},Zp=`#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
#ifdef DOWNSAMPLE_NORMALS
uniform lowp sampler2D normalBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}int findBestDepth(const in float samples[4]){float c=(samples[0]+samples[1]+samples[2]+samples[3])*0.25;float distances[4];distances[0]=abs(c-samples[0]);distances[1]=abs(c-samples[1]);distances[2]=abs(c-samples[2]);distances[3]=abs(c-samples[3]);float maxDistance=max(max(distances[0],distances[1]),max(distances[2],distances[3]));int remaining[3];int rejected[3];int i,j,k;for(i=0,j=0,k=0;i<4;++i){if(distances[i]<maxDistance){remaining[j++]=i;}else{rejected[k++]=i;}}for(;j<3;++j){remaining[j]=rejected[--k];}vec3 s=vec3(samples[remaining[0]],samples[remaining[1]],samples[remaining[2]]);c=(s.x+s.y+s.z)/3.0;distances[0]=abs(c-s.x);distances[1]=abs(c-s.y);distances[2]=abs(c-s.z);float minDistance=min(distances[0],min(distances[1],distances[2]));for(i=0;i<3;++i){if(distances[i]==minDistance){break;}}return remaining[i];}void main(){float d[4];d[0]=readDepth(vUv0);d[1]=readDepth(vUv1);d[2]=readDepth(vUv2);d[3]=readDepth(vUv3);int index=findBestDepth(d);
#ifdef DOWNSAMPLE_NORMALS
vec3 n[4];n[0]=texture2D(normalBuffer,vUv0).rgb;n[1]=texture2D(normalBuffer,vUv1).rgb;n[2]=texture2D(normalBuffer,vUv2).rgb;n[3]=texture2D(normalBuffer,vUv3).rgb;
#else
vec3 n[4];n[0]=vec3(0.0);n[1]=vec3(0.0);n[2]=vec3(0.0);n[3]=vec3(0.0);
#endif
gl_FragColor=vec4(n[index],d[index]);}`,$p="uniform vec2 texelSize;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vUv0=uv;vUv1=vec2(uv.x,uv.y+texelSize.y);vUv2=vec2(uv.x+texelSize.x,uv.y);vUv3=uv+texelSize;gl_Position=vec4(position.xy,1.0,1.0);}",Xp=class extends es{constructor(){super({name:"DepthDownsamplingMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new Q(null),normalBuffer:new Q(null),texelSize:new Q(new Fe)},blending:Ts,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Zp,vertexShader:$p})}set depthBuffer(n){this.uniforms.depthBuffer.value=n}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,e=oi){this.depthBuffer=n,this.depthPacking=e}set normalBuffer(n){this.uniforms.normalBuffer.value=n,n!==null?this.defines.DOWNSAMPLE_NORMALS="1":delete this.defines.DOWNSAMPLE_NORMALS,this.needsUpdate=!0}setNormalBuffer(n){this.normalBuffer=n}setTexelSize(n,e){this.uniforms.texelSize.value.set(n,e)}setSize(n,e){this.uniforms.texelSize.value.set(1/n,1/e)}},Qp=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#define WEIGHT_INNER 0.125
#define WEIGHT_OUTER 0.0555555
varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;float clampToBorder(const in vec2 uv){return float(uv.s>=0.0&&uv.s<=1.0&&uv.t>=0.0&&uv.t<=1.0);}void main(){vec4 c=vec4(0.0);vec4 w=WEIGHT_INNER*vec4(clampToBorder(vUv00),clampToBorder(vUv01),clampToBorder(vUv02),clampToBorder(vUv03));c+=w.x*texture2D(inputBuffer,vUv00);c+=w.y*texture2D(inputBuffer,vUv01);c+=w.z*texture2D(inputBuffer,vUv02);c+=w.w*texture2D(inputBuffer,vUv03);w=WEIGHT_OUTER*vec4(clampToBorder(vUv04),clampToBorder(vUv05),clampToBorder(vUv06),clampToBorder(vUv07));c+=w.x*texture2D(inputBuffer,vUv04);c+=w.y*texture2D(inputBuffer,vUv05);c+=w.z*texture2D(inputBuffer,vUv06);c+=w.w*texture2D(inputBuffer,vUv07);w=WEIGHT_OUTER*vec4(clampToBorder(vUv08),clampToBorder(vUv09),clampToBorder(vUv10),clampToBorder(vUv11));c+=w.x*texture2D(inputBuffer,vUv08);c+=w.y*texture2D(inputBuffer,vUv09);c+=w.z*texture2D(inputBuffer,vUv10);c+=w.w*texture2D(inputBuffer,vUv11);c+=WEIGHT_OUTER*texture2D(inputBuffer,vUv);gl_FragColor=c;
#include <colorspace_fragment>
}`,Kp="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;void main(){vUv=position.xy*0.5+0.5;vUv00=vUv+texelSize*vec2(-1.0,1.0);vUv01=vUv+texelSize*vec2(1.0,1.0);vUv02=vUv+texelSize*vec2(-1.0,-1.0);vUv03=vUv+texelSize*vec2(1.0,-1.0);vUv04=vUv+texelSize*vec2(-2.0,2.0);vUv05=vUv+texelSize*vec2(0.0,2.0);vUv06=vUv+texelSize*vec2(2.0,2.0);vUv07=vUv+texelSize*vec2(-2.0,0.0);vUv08=vUv+texelSize*vec2(2.0,0.0);vUv09=vUv+texelSize*vec2(-2.0,-2.0);vUv10=vUv+texelSize*vec2(0.0,-2.0);vUv11=vUv+texelSize*vec2(2.0,-2.0);gl_Position=vec4(position.xy,1.0,1.0);}",Jp=class extends es{constructor(){super({name:"DownsamplingMaterial",uniforms:{inputBuffer:new Q(null),texelSize:new Q(new Fe)},blending:Ts,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Qp,vertexShader:Kp}),this.fragmentShader=pr(this.fragmentShader)}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setSize(n,e){this.uniforms.texelSize.value.set(1/n,1/e)}},e0=`#include <common>
#include <packing>
#include <dithering_pars_fragment>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#if DEPTH_PACKING == 3201
uniform lowp sampler2D depthBuffer;
#elif defined(GL_FRAGMENT_PRECISION_HIGH)
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#if THREE_REVISION >= 137
vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}vec3 RGBToHCV(const in vec3 RGB){vec4 P=mix(vec4(RGB.bg,-1.0,2.0/3.0),vec4(RGB.gb,0.0,-1.0/3.0),step(RGB.b,RGB.g));vec4 Q=mix(vec4(P.xyw,RGB.r),vec4(RGB.r,P.yzx),step(P.x,RGB.r));float C=Q.x-min(Q.w,Q.y);float H=abs((Q.w-Q.y)/(6.0*C+EPSILON)+Q.z);return vec3(H,C,Q.x);}vec3 RGBToHSL(const in vec3 RGB){vec3 HCV=RGBToHCV(RGB);float L=HCV.z-HCV.y*0.5;float S=HCV.y/(1.0-abs(L*2.0-1.0)+EPSILON);return vec3(HCV.x,S,L);}vec3 HueToRGB(const in float H){float R=abs(H*6.0-3.0)-1.0;float G=2.0-abs(H*6.0-2.0);float B=2.0-abs(H*6.0-4.0);return clamp(vec3(R,G,B),0.0,1.0);}vec3 HSLToRGB(const in vec3 HSL){vec3 RGB=HueToRGB(HSL.x);float C=(1.0-abs(2.0*HSL.z-1.0))*HSL.y;return(RGB-0.5)*C+HSL.z;}FRAGMENT_HEAD void main(){FRAGMENT_MAIN_UV vec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGE color0.a=clamp(color0.a,0.0,1.0);gl_FragColor=color0;
#ifdef ENCODE_OUTPUT
#include <colorspace_fragment>
#endif
#include <dithering_fragment>
}`,t0="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEAD void main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORT gl_Position=vec4(position.xy,1.0,1.0);}",s0=class extends es{constructor(n,e,t,s,i=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:Ja.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new Q(null),depthBuffer:new Q(null),resolution:new Q(new Fe),texelSize:new Q(new Fe),cameraNear:new Q(.3),cameraFar:new Q(1e3),aspect:new Q(1),time:new Q(0)},blending:Ts,toneMapped:!1,depthWrite:!1,depthTest:!1,dithering:i}),n&&this.setShaderParts(n),e&&this.setDefines(e),t&&this.setUniforms(t),this.copyCameraSettings(s)}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(n){this.uniforms.depthBuffer.value=n}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,e=oi){this.depthBuffer=n,this.depthPacking=e}setShaderData(n){this.setShaderParts(n.shaderParts),this.setDefines(n.defines),this.setUniforms(n.uniforms),this.setExtensions(n.extensions)}setShaderParts(n){return this.fragmentShader=e0.replace(ie.FRAGMENT_HEAD,n.get(ie.FRAGMENT_HEAD)||"").replace(ie.FRAGMENT_MAIN_UV,n.get(ie.FRAGMENT_MAIN_UV)||"").replace(ie.FRAGMENT_MAIN_IMAGE,n.get(ie.FRAGMENT_MAIN_IMAGE)||""),this.vertexShader=t0.replace(ie.VERTEX_HEAD,n.get(ie.VERTEX_HEAD)||"").replace(ie.VERTEX_MAIN_SUPPORT,n.get(ie.VERTEX_MAIN_SUPPORT)||""),this.fragmentShader=pr(this.fragmentShader),this.needsUpdate=!0,this}setDefines(n){for(const e of n.entries())this.defines[e[0]]=e[1];return this.needsUpdate=!0,this}setUniforms(n){for(const e of n.entries())this.uniforms[e[0]]=e[1];return this}setExtensions(n){this.extensions={};for(const e of n)this.extensions[e]=!0;return this}get encodeOutput(){return this.defines.ENCODE_OUTPUT!==void 0}set encodeOutput(n){this.encodeOutput!==n&&(n?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(n){return this.encodeOutput}setOutputEncodingEnabled(n){this.encodeOutput=n}get time(){return this.uniforms.time.value}set time(n){this.uniforms.time.value=n}setDeltaTime(n){this.uniforms.time.value+=n}adoptCameraSettings(n){this.copyCameraSettings(n)}copyCameraSettings(n){n&&(this.uniforms.cameraNear.value=n.near,this.uniforms.cameraFar.value=n.far,n instanceof mu?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(n,e){const t=this.uniforms;t.resolution.value.set(n,e),t.texelSize.value.set(1/n,1/e),t.aspect.value=n/e}static get Section(){return ie}},n0=`#include <common>
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef RANGE
uniform vec2 range;
#elif defined(THRESHOLD)
uniform float threshold;uniform float smoothing;
#endif
varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);
#ifdef RANGE
float low=step(range.x,l);float high=step(l,range.y);l*=low*high;
#elif defined(THRESHOLD)
l=smoothstep(threshold,threshold+smoothing,l);
#endif
#ifdef COLOR
gl_FragColor=vec4(texel.rgb*l,l);
#else
gl_FragColor=vec4(l);
#endif
}`,i0=class extends es{constructor(n=!1,e=null){super({name:"LuminanceMaterial",defines:{THREE_REVISION:Ja.replace(/\D+/g,"")},uniforms:{inputBuffer:new Q(null),threshold:new Q(0),smoothing:new Q(1),range:new Q(null)},blending:Ts,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:n0,vertexShader:Su}),this.colorOutput=n,this.luminanceRange=e}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}get threshold(){return this.uniforms.threshold.value}set threshold(n){this.smoothing>0||n>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=n}getThreshold(){return this.threshold}setThreshold(n){this.threshold=n}get smoothing(){return this.uniforms.smoothing.value}set smoothing(n){this.threshold>0||n>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=n}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(n){this.smoothing=n}get useThreshold(){return this.threshold>0||this.smoothing>0}set useThreshold(n){}get colorOutput(){return this.defines.COLOR!==void 0}set colorOutput(n){n?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(n){return this.colorOutput}setColorOutputEnabled(n){this.colorOutput=n}get useRange(){return this.luminanceRange!==null}set useRange(n){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(n){n!==null?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=n,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(n){this.luminanceRange=n}},r0="uniform lowp sampler2D inputBuffer;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 c0=texture2D(inputBuffer,vUv0).rg;vec2 c1=texture2D(inputBuffer,vUv1).rg;vec2 c2=texture2D(inputBuffer,vUv2).rg;vec2 c3=texture2D(inputBuffer,vUv3).rg;float d0=(c0.x-c1.x)*0.5;float d1=(c2.x-c3.x)*0.5;float d=length(vec2(d0,d1));float a0=min(c0.y,c1.y);float a1=min(c2.y,c3.y);float visibilityFactor=min(a0,a1);gl_FragColor.rg=(1.0-visibilityFactor>0.001)?vec2(d,0.0):vec2(0.0,d);}",o0="uniform vec2 texelSize;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vUv0=vec2(uv.x+texelSize.x,uv.y);vUv1=vec2(uv.x-texelSize.x,uv.y);vUv2=vec2(uv.x,uv.y+texelSize.y);vUv3=vec2(uv.x,uv.y-texelSize.y);gl_Position=vec4(position.xy,1.0,1.0);}",a0=class extends es{constructor(n=new Fe){super({name:"OutlineMaterial",uniforms:{inputBuffer:new Q(null),texelSize:new Q(new Fe)},blending:Ts,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:r0,vertexShader:o0}),this.uniforms.texelSize.value.set(n.x,n.y),this.uniforms.maskTexture=this.uniforms.inputBuffer}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}setTexelSize(n,e){this.uniforms.texelSize.value.set(n,e)}setSize(n,e){this.uniforms.texelSize.value.set(1/n,1/e)}},c0=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;uniform mediump sampler2D supportBuffer;
#else
uniform lowp sampler2D inputBuffer;uniform lowp sampler2D supportBuffer;
#endif
uniform float radius;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vec4 c=vec4(0.0);c+=texture2D(inputBuffer,vUv0)*0.0625;c+=texture2D(inputBuffer,vUv1)*0.125;c+=texture2D(inputBuffer,vUv2)*0.0625;c+=texture2D(inputBuffer,vUv3)*0.125;c+=texture2D(inputBuffer,vUv)*0.25;c+=texture2D(inputBuffer,vUv4)*0.125;c+=texture2D(inputBuffer,vUv5)*0.0625;c+=texture2D(inputBuffer,vUv6)*0.125;c+=texture2D(inputBuffer,vUv7)*0.0625;vec4 baseColor=texture2D(supportBuffer,vUv);gl_FragColor=mix(baseColor,c,radius);
#include <colorspace_fragment>
}`,l0="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,1.0);vUv1=vUv+texelSize*vec2(0.0,1.0);vUv2=vUv+texelSize*vec2(1.0,1.0);vUv3=vUv+texelSize*vec2(-1.0,0.0);vUv4=vUv+texelSize*vec2(1.0,0.0);vUv5=vUv+texelSize*vec2(-1.0,-1.0);vUv6=vUv+texelSize*vec2(0.0,-1.0);vUv7=vUv+texelSize*vec2(1.0,-1.0);gl_Position=vec4(position.xy,1.0,1.0);}",u0=class extends es{constructor(){super({name:"UpsamplingMaterial",uniforms:{inputBuffer:new Q(null),supportBuffer:new Q(null),texelSize:new Q(new Fe),radius:new Q(.85)},blending:Ts,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:c0,vertexShader:l0}),this.fragmentShader=pr(this.fragmentShader)}set inputBuffer(n){this.uniforms.inputBuffer.value=n}set supportBuffer(n){this.uniforms.supportBuffer.value=n}get radius(){return this.uniforms.radius.value}set radius(n){this.uniforms.radius.value=n}setSize(n,e){this.uniforms.texelSize.value.set(1/n,1/e)}},h0=new Hf,bs=null;function d0(){if(bs===null){const n=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),e=new Float32Array([0,0,2,0,0,2]);bs=new qf,bs.setAttribute!==void 0?(bs.setAttribute("position",new Or(n,3)),bs.setAttribute("uv",new Or(e,2))):(bs.addAttribute("position",new Or(n,3)),bs.addAttribute("uv",new Or(e,2)))}return bs}var it=class Au{constructor(e="Pass",t=new Jc,s=h0){this.name=e,this.renderer=null,this.scene=t,this.camera=s,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(e){if(this.rtt===e){const t=this.fullscreenMaterial;t!==null&&(t.needsUpdate=!0),this.rtt=!e}}set mainScene(e){}set mainCamera(e){}setRenderer(e){this.renderer=e}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(e){let t=this.screen;t!==null?t.material=e:(t=new Vf(d0(),e),t.frustumCulled=!1,this.scene===null&&(this.scene=new Jc),this.scene.add(t),this.screen=t)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(e){this.fullscreenMaterial=e}getDepthTexture(){return null}setDepthTexture(e,t=oi){}render(e,t,s,i,r){throw new Error("Render method not implemented!")}setSize(e,t){}initialize(e,t,s){}dispose(){for(const e of Object.keys(this)){const t=this[e];(t instanceof Tt||t instanceof _u||t instanceof gu||t instanceof Au)&&this[e].dispose()}}},f0=class extends it{constructor(n,e=!0){super("CopyPass"),this.fullscreenMaterial=new Ou,this.needsSwap=!1,this.renderTarget=n,n===void 0&&(this.renderTarget=new Tt(1,1,{minFilter:Xr,magFilter:Xr,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=e}get resize(){return this.autoResize}set resize(n){this.autoResize=n}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(n){this.autoResize=n}render(n,e,t,s,i){this.fullscreenMaterial.inputBuffer=e.texture,n.setRenderTarget(this.renderToScreen?null:this.renderTarget),n.render(this.scene,this.camera)}setSize(n,e){this.autoResize&&this.renderTarget.setSize(n,e)}initialize(n,e,t){t!==void 0&&(this.renderTarget.texture.type=t,t!==ps?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":Yn(n)===qe&&Is(this.renderTarget.texture,qe))}},p0=class extends it{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(n,e,t,s,i){const r=n.state.buffers.stencil;r.setLocked(!1),r.setTest(!1)}},fl=new hs,sc=class extends it{constructor(n=!0,e=!0,t=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=n,this.depth=e,this.stencil=t,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(n,e,t){this.color=n,this.depth=e,this.stencil=t}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(n){this.overrideClearColor=n}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(n){this.overrideClearAlpha=n}render(n,e,t,s,i){const r=this.overrideClearColor,o=this.overrideClearAlpha,a=n.getClearAlpha(),c=r!==null,l=o>=0;c?(n.getClearColor(fl),n.setClearColor(r,l?o:a)):l&&n.setClearAlpha(o),n.setRenderTarget(this.renderToScreen?null:e),n.clear(this.color,this.depth,this.stencil),c?n.setClearColor(fl,a):l&&n.setClearAlpha(a)}},Do=class extends it{constructor(n,e,t=null){super("RenderPass",n,e),this.needsSwap=!1,this.clearPass=new sc,this.overrideMaterialManager=t===null?null:new ml(t),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}set mainScene(n){this.scene=n}set mainCamera(n){this.camera=n}get renderToScreen(){return super.renderToScreen}set renderToScreen(n){super.renderToScreen=n,this.clearPass.renderToScreen=n}get overrideMaterial(){const n=this.overrideMaterialManager;return n!==null?n.material:null}set overrideMaterial(n){const e=this.overrideMaterialManager;n!==null?e!==null?e.setMaterial(n):this.overrideMaterialManager=new ml(n):e!==null&&(e.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(n){this.overrideMaterial=n}get clear(){return this.clearPass.enabled}set clear(n){this.clearPass.enabled=n}getSelection(){return this.selection}setSelection(n){this.selection=n}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(n){this.ignoreBackground=n}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(n){this.skipShadowMapUpdate=n}getClearPass(){return this.clearPass}render(n,e,t,s,i){const r=this.scene,o=this.camera,a=this.selection,c=o.layers.mask,l=r.background,u=n.shadowMap.autoUpdate,h=this.renderToScreen?null:e;a!==null&&o.layers.set(a.getLayer()),this.skipShadowMapUpdate&&(n.shadowMap.autoUpdate=!1),(this.ignoreBackground||this.clearPass.overrideClearColor!==null)&&(r.background=null),this.clearPass.enabled&&this.clearPass.render(n,e),n.setRenderTarget(h),this.overrideMaterialManager!==null?this.overrideMaterialManager.render(n,r,o):n.render(r,o),o.layers.mask=c,r.background=l,n.shadowMap.autoUpdate=u}},m0=class extends it{constructor(n,e,{renderTarget:t,resolutionScale:s=1,width:i=Oe.AUTO_SIZE,height:r=Oe.AUTO_SIZE,resolutionX:o=i,resolutionY:a=r}={}){super("DepthPass"),this.needsSwap=!1,this.renderPass=new Do(n,e,new jf({depthPacking:Ta}));const c=this.renderPass;c.skipShadowMapUpdate=!0,c.ignoreBackground=!0;const l=c.clearPass;l.overrideClearColor=new hs(16777215),l.overrideClearAlpha=1,this.renderTarget=t,this.renderTarget===void 0&&(this.renderTarget=new Tt(1,1,{minFilter:Gn,magFilter:Gn}),this.renderTarget.texture.name="DepthPass.Target");const u=this.resolution=new Oe(this,o,a,s);u.addEventListener("change",h=>this.setSize(u.baseWidth,u.baseHeight))}set mainScene(n){this.renderPass.mainScene=n}set mainCamera(n){this.renderPass.mainCamera=n}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}render(n,e,t,s,i){const r=this.renderToScreen?null:this.renderTarget;this.renderPass.render(n,r)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e),this.renderTarget.setSize(t.width,t.height)}},_0=class extends it{constructor({normalBuffer:n=null,resolutionScale:e=.5,width:t=Oe.AUTO_SIZE,height:s=Oe.AUTO_SIZE,resolutionX:i=t,resolutionY:r=s}={}){super("DepthDownsamplingPass");const o=new Xp;o.normalBuffer=n,this.fullscreenMaterial=o,this.needsDepthTexture=!0,this.needsSwap=!1,this.renderTarget=new Tt(1,1,{minFilter:Gn,magFilter:Gn,depthBuffer:!1,type:Pf}),this.renderTarget.texture.name="DepthDownsamplingPass.Target",this.renderTarget.texture.generateMipmaps=!1;const a=this.resolution=new Oe(this,i,r,e);a.addEventListener("change",c=>this.setSize(a.baseWidth,a.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}setDepthTexture(n,e=oi){this.fullscreenMaterial.depthBuffer=n,this.fullscreenMaterial.depthPacking=e}render(n,e,t,s,i){n.setRenderTarget(this.renderToScreen?null:this.renderTarget),n.render(this.scene,this.camera)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e),this.renderTarget.setSize(t.width,t.height),this.fullscreenMaterial.setSize(n,e)}initialize(n,e,t){const s=n.getContext();if(!(s.getExtension("EXT_color_buffer_float")||s.getExtension("EXT_color_buffer_half_float")))throw new Error("Rendering to float texture is not supported.")}};function pl(n,e,t){for(const s of e){const i="$1"+n+s.charAt(0).toUpperCase()+s.slice(1),r=new RegExp("([^\\.])(\\b"+s+"\\b)","g");for(const o of t.entries())o[1]!==null&&t.set(o[0],o[1].replace(r,i))}}function g0(n,e,t){let s=e.getFragmentShader(),i=e.getVertexShader();const r=s!==void 0&&/mainImage/.test(s),o=s!==void 0&&/mainUv/.test(s);if(t.attributes|=e.getAttributes(),s===void 0)throw new Error(`Missing fragment shader (${e.name})`);if(o&&t.attributes&ds.CONVOLUTION)throw new Error(`Effects that transform UVs are incompatible with convolution effects (${e.name})`);if(!r&&!o)throw new Error(`Could not find mainImage or mainUv function (${e.name})`);{const a=/\w+\s+(\w+)\([\w\s,]*\)\s*{/g,c=t.shaderParts;let l=c.get(ie.FRAGMENT_HEAD)||"",u=c.get(ie.FRAGMENT_MAIN_UV)||"",h=c.get(ie.FRAGMENT_MAIN_IMAGE)||"",f=c.get(ie.VERTEX_HEAD)||"",d=c.get(ie.VERTEX_MAIN_SUPPORT)||"";const m=new Set,p=new Set;if(o&&(u+=`	${n}MainUv(UV);
`,t.uvTransformation=!0),i!==null&&/mainSupport/.test(i)){const T=/mainSupport *\([\w\s]*?uv\s*?\)/.test(i);d+=`	${n}MainSupport(`,d+=T?`vUv);
`:`);
`;for(const S of i.matchAll(/(?:varying\s+\w+\s+([\S\s]*?);)/g))for(const y of S[1].split(/\s*,\s*/))t.varyings.add(y),m.add(y),p.add(y);for(const S of i.matchAll(a))p.add(S[1])}for(const T of s.matchAll(a))p.add(T[1]);for(const T of e.defines.keys())p.add(T.replace(/\([\w\s,]*\)/g,""));for(const T of e.uniforms.keys())p.add(T);p.delete("while"),p.delete("for"),p.delete("if"),e.uniforms.forEach((T,S)=>t.uniforms.set(n+S.charAt(0).toUpperCase()+S.slice(1),T)),e.defines.forEach((T,S)=>t.defines.set(n+S.charAt(0).toUpperCase()+S.slice(1),T));const _=new Map([["fragment",s],["vertex",i]]);pl(n,p,t.defines),pl(n,p,_),s=_.get("fragment"),i=_.get("vertex");const v=e.blendMode;if(t.blendModes.set(v.blendFunction,v),r){e.inputColorSpace!==null&&e.inputColorSpace!==t.colorSpace&&(h+=e.inputColorSpace===qe?`color0 = LinearTosRGB(color0);
	`:`color0 = sRGBToLinear(color0);
	`),e.outputColorSpace!==Cu?t.colorSpace=e.outputColorSpace:e.inputColorSpace!==null&&(t.colorSpace=e.inputColorSpace);const T=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/;h+=`${n}MainImage(color0, UV, `,t.attributes&ds.DEPTH&&T.test(s)&&(h+="depth, ",t.readDepth=!0),h+=`color1);
	`;const S=n+"BlendOpacity";t.uniforms.set(S,v.opacity),h+=`color0 = blend${v.blendFunction}(color0, color1, ${S});

	`,l+=`uniform float ${S};

`}if(l+=s+`
`,i!==null&&(f+=i+`
`),c.set(ie.FRAGMENT_HEAD,l),c.set(ie.FRAGMENT_MAIN_UV,u),c.set(ie.FRAGMENT_MAIN_IMAGE,h),c.set(ie.VERTEX_HEAD,f),c.set(ie.VERTEX_MAIN_SUPPORT,d),e.extensions!==null)for(const T of e.extensions)t.extensions.add(T)}}var v0=class extends it{constructor(n,...e){super("EffectPass"),this.fullscreenMaterial=new s0(null,null,null,n),this.listener=t=>this.handleEvent(t),this.effects=[],this.setEffects(e),this.skipRendering=!1,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY,this.timeScale=1}set mainScene(n){for(const e of this.effects)e.mainScene=n}set mainCamera(n){this.fullscreenMaterial.copyCameraSettings(n);for(const e of this.effects)e.mainCamera=n}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(n){this.fullscreenMaterial.encodeOutput=n}get dithering(){return this.fullscreenMaterial.dithering}set dithering(n){const e=this.fullscreenMaterial;e.dithering=n,e.needsUpdate=!0}setEffects(n){for(const e of this.effects)e.removeEventListener("change",this.listener);this.effects=n.sort((e,t)=>t.attributes-e.attributes);for(const e of this.effects)e.addEventListener("change",this.listener)}updateMaterial(){const n=new E0;let e=0;for(const o of this.effects)if(o.blendMode.blendFunction===ee.DST)n.attributes|=o.getAttributes()&ds.DEPTH;else{if(n.attributes&o.getAttributes()&ds.CONVOLUTION)throw new Error(`Convolution effects cannot be merged (${o.name})`);g0("e"+e++,o,n)}let t=n.shaderParts.get(ie.FRAGMENT_HEAD),s=n.shaderParts.get(ie.FRAGMENT_MAIN_IMAGE),i=n.shaderParts.get(ie.FRAGMENT_MAIN_UV);const r=/\bblend\b/g;for(const o of n.blendModes.values())t+=o.getShaderCode().replace(r,`blend${o.blendFunction}`)+`
`;n.attributes&ds.DEPTH?(n.readDepth&&(s=`float depth = readDepth(UV);

	`+s),this.needsDepthTexture=this.getDepthTexture()===null):this.needsDepthTexture=!1,n.colorSpace===qe&&(s+=`color0 = sRGBToLinear(color0);
	`),n.uvTransformation?(i=`vec2 transformedUv = vUv;
`+i,n.defines.set("UV","transformedUv")):n.defines.set("UV","vUv"),n.shaderParts.set(ie.FRAGMENT_HEAD,t),n.shaderParts.set(ie.FRAGMENT_MAIN_IMAGE,s),n.shaderParts.set(ie.FRAGMENT_MAIN_UV,i);for(const[o,a]of n.shaderParts)a!==null&&n.shaderParts.set(o,a.trim().replace(/^#/,`
#`));this.skipRendering=e===0,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderData(n)}recompile(){this.updateMaterial()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(n,e=oi){this.fullscreenMaterial.depthBuffer=n,this.fullscreenMaterial.depthPacking=e;for(const t of this.effects)t.setDepthTexture(n,e)}render(n,e,t,s,i){for(const r of this.effects)r.update(n,e,s);if(!this.skipRendering||this.renderToScreen){const r=this.fullscreenMaterial;r.inputBuffer=e.texture,r.time+=s*this.timeScale,n.setRenderTarget(this.renderToScreen?null:t),n.render(this.scene,this.camera)}}setSize(n,e){this.fullscreenMaterial.setSize(n,e);for(const t of this.effects)t.setSize(n,e)}initialize(n,e,t){this.renderer=n;for(const s of this.effects)s.initialize(n,e,t);this.updateMaterial(),t!==void 0&&t!==ps&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(const n of this.effects)n.removeEventListener("change",this.listener),n.dispose()}handleEvent(n){switch(n.type){case"change":this.recompile();break}}},Mu=class extends it{constructor({kernelSize:n=Mo.MEDIUM,resolutionScale:e=.5,width:t=Oe.AUTO_SIZE,height:s=Oe.AUTO_SIZE,resolutionX:i=t,resolutionY:r=s}={}){super("KawaseBlurPass"),this.renderTargetA=new Tt(1,1,{depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";const o=this.resolution=new Oe(this,i,r,e);o.addEventListener("change",a=>this.setSize(o.baseWidth,o.baseHeight)),this._blurMaterial=new Hp,this._blurMaterial.kernelSize=n,this.copyMaterial=new Ou}getResolution(){return this.resolution}get blurMaterial(){return this._blurMaterial}set blurMaterial(n){this._blurMaterial=n}get dithering(){return this.copyMaterial.dithering}set dithering(n){this.copyMaterial.dithering=n}get kernelSize(){return this.blurMaterial.kernelSize}set kernelSize(n){this.blurMaterial.kernelSize=n}get width(){return this.resolution.width}set width(n){this.resolution.preferredWidth=n}get height(){return this.resolution.height}set height(n){this.resolution.preferredHeight=n}get scale(){return this.blurMaterial.scale}set scale(n){this.blurMaterial.scale=n}getScale(){return this.blurMaterial.scale}setScale(n){this.blurMaterial.scale=n}getKernelSize(){return this.kernelSize}setKernelSize(n){this.kernelSize=n}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}render(n,e,t,s,i){const r=this.scene,o=this.camera,a=this.renderTargetA,c=this.renderTargetB,l=this.blurMaterial,u=l.kernelSequence;let h=e;this.fullscreenMaterial=l;for(let f=0,d=u.length;f<d;++f){const m=f&1?c:a;l.kernel=u[f],l.inputBuffer=h.texture,n.setRenderTarget(m),n.render(r,o),h=m}this.fullscreenMaterial=this.copyMaterial,this.copyMaterial.inputBuffer=h.texture,n.setRenderTarget(this.renderToScreen?null:t),n.render(r,o)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e);const s=t.width,i=t.height;this.renderTargetA.setSize(s,i),this.renderTargetB.setSize(s,i),this.blurMaterial.setSize(n,e)}initialize(n,e,t){t!==void 0&&(this.renderTargetA.texture.type=t,this.renderTargetB.texture.type=t,t!==ps?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.copyMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):Yn(n)===qe&&(Is(this.renderTargetA.texture,qe),Is(this.renderTargetB.texture,qe)))}static get AUTO_SIZE(){return Oe.AUTO_SIZE}},y0=class extends it{constructor({renderTarget:n,luminanceRange:e,colorOutput:t,resolutionScale:s=1,width:i=Oe.AUTO_SIZE,height:r=Oe.AUTO_SIZE,resolutionX:o=i,resolutionY:a=r}={}){super("LuminancePass"),this.fullscreenMaterial=new i0(t,e),this.needsSwap=!1,this.renderTarget=n,this.renderTarget===void 0&&(this.renderTarget=new Tt(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target");const c=this.resolution=new Oe(this,o,a,s);c.addEventListener("change",l=>this.setSize(c.baseWidth,c.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(n,e,t,s,i){const r=this.fullscreenMaterial;r.inputBuffer=e.texture,n.setRenderTarget(this.renderToScreen?null:this.renderTarget),n.render(this.scene,this.camera)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e),this.renderTarget.setSize(t.width,t.height)}initialize(n,e,t){t!==void 0&&t!==ps&&(this.renderTarget.texture.type=t,this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},x0=class extends it{constructor(n,e){super("MaskPass",n,e),this.needsSwap=!1,this.clearPass=new sc(!1,!1,!0),this.inverse=!1}set mainScene(n){this.scene=n}set mainCamera(n){this.camera=n}get inverted(){return this.inverse}set inverted(n){this.inverse=n}get clear(){return this.clearPass.enabled}set clear(n){this.clearPass.enabled=n}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(n){this.inverted=n}render(n,e,t,s,i){const r=n.getContext(),o=n.state.buffers,a=this.scene,c=this.camera,l=this.clearPass,u=this.inverted?0:1,h=1-u;o.color.setMask(!1),o.depth.setMask(!1),o.color.setLocked(!0),o.depth.setLocked(!0),o.stencil.setTest(!0),o.stencil.setOp(r.REPLACE,r.REPLACE,r.REPLACE),o.stencil.setFunc(r.ALWAYS,u,4294967295),o.stencil.setClear(h),o.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?l.render(n,null):(l.render(n,e),l.render(n,t))),this.renderToScreen?(n.setRenderTarget(null),n.render(a,c)):(n.setRenderTarget(e),n.render(a,c),n.setRenderTarget(t),n.render(a,c)),o.color.setLocked(!1),o.depth.setLocked(!1),o.stencil.setLocked(!1),o.stencil.setFunc(r.EQUAL,1,4294967295),o.stencil.setOp(r.KEEP,r.KEEP,r.KEEP),o.stencil.setLocked(!0)}},T0=class extends it{constructor(){super("MipmapBlurPass"),this.needsSwap=!1,this.renderTarget=new Tt(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Upsampling.Mipmap0",this.downsamplingMipmaps=[],this.upsamplingMipmaps=[],this.downsamplingMaterial=new Jp,this.upsamplingMaterial=new u0,this.resolution=new Fe}get texture(){return this.renderTarget.texture}get levels(){return this.downsamplingMipmaps.length}set levels(n){if(this.levels!==n){const e=this.renderTarget;this.dispose(),this.downsamplingMipmaps=[],this.upsamplingMipmaps=[];for(let t=0;t<n;++t){const s=e.clone();s.texture.name="Downsampling.Mipmap"+t,this.downsamplingMipmaps.push(s)}this.upsamplingMipmaps.push(e);for(let t=1,s=n-1;t<s;++t){const i=e.clone();i.texture.name="Upsampling.Mipmap"+t,this.upsamplingMipmaps.push(i)}this.setSize(this.resolution.x,this.resolution.y)}}get radius(){return this.upsamplingMaterial.radius}set radius(n){this.upsamplingMaterial.radius=n}render(n,e,t,s,i){const{scene:r,camera:o}=this,{downsamplingMaterial:a,upsamplingMaterial:c}=this,{downsamplingMipmaps:l,upsamplingMipmaps:u}=this;let h=e;this.fullscreenMaterial=a;for(let f=0,d=l.length;f<d;++f){const m=l[f];a.setSize(h.width,h.height),a.inputBuffer=h.texture,n.setRenderTarget(m),n.render(r,o),h=m}this.fullscreenMaterial=c;for(let f=u.length-1;f>=0;--f){const d=u[f];c.setSize(h.width,h.height),c.inputBuffer=h.texture,c.supportBuffer=l[f].texture,n.setRenderTarget(d),n.render(r,o),h=d}}setSize(n,e){const t=this.resolution;t.set(n,e);let s=t.width,i=t.height;for(let r=0,o=this.downsamplingMipmaps.length;r<o;++r)s=Math.round(s*.5),i=Math.round(i*.5),this.downsamplingMipmaps[r].setSize(s,i),r<this.upsamplingMipmaps.length&&this.upsamplingMipmaps[r].setSize(s,i)}initialize(n,e,t){if(t!==void 0){const s=this.downsamplingMipmaps.concat(this.upsamplingMipmaps);for(const i of s)i.texture.type=t;if(t!==ps)this.downsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.upsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1";else if(Yn(n)===qe)for(const i of s)Is(i.texture,qe)}}dispose(){super.dispose();for(const n of this.downsamplingMipmaps.concat(this.upsamplingMipmaps))n.dispose()}},w0=class extends it{constructor(n,e,{renderTarget:t,resolutionScale:s=1,width:i=Oe.AUTO_SIZE,height:r=Oe.AUTO_SIZE,resolutionX:o=i,resolutionY:a=r}={}){super("NormalPass"),this.needsSwap=!1,this.renderPass=new Do(n,e,new If);const c=this.renderPass;c.ignoreBackground=!0,c.skipShadowMapUpdate=!0;const l=c.getClearPass();l.overrideClearColor=new hs(7829503),l.overrideClearAlpha=1,this.renderTarget=t,this.renderTarget===void 0&&(this.renderTarget=new Tt(1,1,{minFilter:Gn,magFilter:Gn}),this.renderTarget.texture.name="NormalPass.Target");const u=this.resolution=new Oe(this,o,a,s);u.addEventListener("change",h=>this.setSize(u.baseWidth,u.baseHeight))}set mainScene(n){this.renderPass.mainScene=n}set mainCamera(n){this.renderPass.mainCamera=n}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}render(n,e,t,s,i){const r=this.renderToScreen?null:this.renderTarget;this.renderPass.render(n,r,r)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e),this.renderTarget.setSize(t.width,t.height)}},k0=class extends it{constructor(n,e="inputBuffer"){super("ShaderPass"),this.fullscreenMaterial=n,this.input=e}setInput(n){this.input=n}render(n,e,t,s,i){const r=this.fullscreenMaterial.uniforms;e!==null&&r!==void 0&&r[this.input]!==void 0&&(r[this.input].value=e.texture),n.setRenderTarget(this.renderToScreen?null:t),n.render(this.scene,this.camera)}initialize(n,e,t){t!==void 0&&t!==ps&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},ra=1/1e3,S0=1e3,C0=class{constructor(){this.startTime=performance.now(),this.previousTime=0,this.currentTime=0,this._delta=0,this._elapsed=0,this._fixedDelta=1e3/60,this.timescale=1,this.useFixedDelta=!1,this._autoReset=!1}get autoReset(){return this._autoReset}set autoReset(n){typeof document<"u"&&document.hidden!==void 0&&(n?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this._autoReset=n)}get delta(){return this._delta*ra}get fixedDelta(){return this._fixedDelta*ra}set fixedDelta(n){this._fixedDelta=n*S0}get elapsed(){return this._elapsed*ra}update(n){this.useFixedDelta?this._delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=(n!==void 0?n:performance.now())-this.startTime,this._delta=this.currentTime-this.previousTime),this._delta*=this.timescale,this._elapsed+=this._delta}reset(){this._delta=0,this._elapsed=0,this.currentTime=performance.now()-this.startTime}handleEvent(n){document.hidden||(this.currentTime=performance.now()-this.startTime)}dispose(){this.autoReset=!1}},b0=class{constructor(e=null,{depthBuffer:t=!0,stencilBuffer:s=!1,multisampling:i=0,frameBufferType:r}={}){this.renderer=null,this.inputBuffer=this.createBuffer(t,s,r,i),this.outputBuffer=this.inputBuffer.clone(),this.copyPass=new f0,this.depthTexture=null,this.passes=[],this.timer=new C0,this.autoRenderToScreen=!0,this.setRenderer(e)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(e){const t=this.inputBuffer,s=this.multisampling;s>0&&e>0?(this.inputBuffer.samples=e,this.outputBuffer.samples=e,this.inputBuffer.dispose(),this.outputBuffer.dispose()):s!==e&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),this.inputBuffer=this.createBuffer(t.depthBuffer,t.stencilBuffer,t.texture.type,e),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(e){if(this.renderer=e,e!==null){const t=e.getSize(new Fe),s=e.getContext().getContextAttributes().alpha,i=this.inputBuffer.texture.type;i===ps&&Yn(e)===qe&&(Is(this.inputBuffer.texture,qe),Is(this.outputBuffer.texture,qe),this.inputBuffer.dispose(),this.outputBuffer.dispose()),e.autoClear=!1,this.setSize(t.width,t.height);for(const r of this.passes)r.initialize(e,s,i)}}replaceRenderer(e,t=!0){const s=this.renderer,i=s.domElement.parentNode;return this.setRenderer(e),t&&i!==null&&(i.removeChild(s.domElement),i.appendChild(e.domElement)),s}createDepthTexture(){const e=this.depthTexture=new Nf;return this.inputBuffer.depthTexture=e,this.inputBuffer.dispose(),this.inputBuffer.stencilBuffer?(e.format=Ff,e.type=Uf):e.type=Lf,e}deleteDepthTexture(){if(this.depthTexture!==null){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(const e of this.passes)e.setDepthTexture(null)}}createBuffer(e,t,s,i){const r=this.renderer,o=r===null?new Fe:r.getDrawingBufferSize(new Fe),a={minFilter:Xr,magFilter:Xr,stencilBuffer:t,depthBuffer:e,type:s},c=new Tt(o.width,o.height,a);return i>0&&(c.ignoreDepthForMultisampleCopy=!1,c.samples=i),s===ps&&Yn(r)===qe&&Is(c.texture,qe),c.texture.name="EffectComposer.Buffer",c.texture.generateMipmaps=!1,c}setMainScene(e){for(const t of this.passes)t.mainScene=e}setMainCamera(e){for(const t of this.passes)t.mainCamera=e}addPass(e,t){const s=this.passes,i=this.renderer,r=i.getDrawingBufferSize(new Fe),o=i.getContext().getContextAttributes().alpha,a=this.inputBuffer.texture.type;if(e.setRenderer(i),e.setSize(r.width,r.height),e.initialize(i,o,a),this.autoRenderToScreen&&(s.length>0&&(s[s.length-1].renderToScreen=!1),e.renderToScreen&&(this.autoRenderToScreen=!1)),t!==void 0?s.splice(t,0,e):s.push(e),this.autoRenderToScreen&&(s[s.length-1].renderToScreen=!0),e.needsDepthTexture||this.depthTexture!==null)if(this.depthTexture===null){const c=this.createDepthTexture();for(e of s)e.setDepthTexture(c)}else e.setDepthTexture(this.depthTexture)}removePass(e){const t=this.passes,s=t.indexOf(e);if(s!==-1&&t.splice(s,1).length>0){if(this.depthTexture!==null){const o=(c,l)=>c||l.needsDepthTexture;t.reduce(o,!1)||(e.getDepthTexture()===this.depthTexture&&e.setDepthTexture(null),this.deleteDepthTexture())}this.autoRenderToScreen&&s===t.length&&(e.renderToScreen=!1,t.length>0&&(t[t.length-1].renderToScreen=!0))}}removeAllPasses(){const e=this.passes;this.deleteDepthTexture(),e.length>0&&(this.autoRenderToScreen&&(e[e.length-1].renderToScreen=!1),this.passes=[])}render(e){const t=this.renderer,s=this.copyPass;let i=this.inputBuffer,r=this.outputBuffer,o=!1,a,c,l;e===void 0&&(this.timer.update(),e=this.timer.delta);for(const u of this.passes)u.enabled&&(u.render(t,i,r,e,o),u.needsSwap&&(o&&(s.renderToScreen=u.renderToScreen,a=t.getContext(),c=t.state.buffers.stencil,c.setFunc(a.NOTEQUAL,1,4294967295),s.render(t,i,r,e,o),c.setFunc(a.EQUAL,1,4294967295)),l=i,i=r,r=l),u instanceof x0?o=!0:u instanceof p0&&(o=!1))}setSize(e,t,s){const i=this.renderer,r=i.getSize(new Fe);(e===void 0||t===void 0)&&(e=r.width,t=r.height),(r.width!==e||r.height!==t)&&i.setSize(e,t,s);const o=i.getDrawingBufferSize(new Fe);this.inputBuffer.setSize(o.width,o.height),this.outputBuffer.setSize(o.width,o.height);for(const a of this.passes)a.setSize(o.width,o.height)}reset(){const e=this.timer.autoReset;this.dispose(),this.autoRenderToScreen=!0,this.timer.autoReset=e}dispose(){for(const e of this.passes)e.dispose();this.passes=[],this.inputBuffer!==null&&this.inputBuffer.dispose(),this.outputBuffer!==null&&this.outputBuffer.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose()}},E0=class{constructor(){this.shaderParts=new Map([[ie.FRAGMENT_HEAD,null],[ie.FRAGMENT_MAIN_UV,null],[ie.FRAGMENT_MAIN_IMAGE,null],[ie.VERTEX_HEAD,null],[ie.VERTEX_MAIN_SUPPORT,null]]),this.defines=new Map,this.uniforms=new Map,this.blendModes=new Map,this.extensions=new Set,this.attributes=ds.NONE,this.varyings=new Set,this.uvTransformation=!1,this.readDepth=!1,this.colorSpace=Ao}},oa=!1,ml=class{constructor(n=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(n),this.meshCount=0,this.replaceMaterial=e=>{if(e.isMesh){let t;if(e.material.flatShading)switch(e.material.side){case Mi:t=this.materialsFlatShadedDoubleSide;break;case Er:t=this.materialsFlatShadedBackSide;break;default:t=this.materialsFlatShaded;break}else switch(e.material.side){case Mi:t=this.materialsDoubleSide;break;case Er:t=this.materialsBackSide;break;default:t=this.materials;break}this.originalMaterials.set(e,e.material),e.isSkinnedMesh?e.material=t[2]:e.isInstancedMesh?e.material=t[1]:e.material=t[0],++this.meshCount}}}cloneMaterial(n){if(!(n instanceof es))return n.clone();const e=n.uniforms,t=new Map;for(const i in e){const r=e[i].value;r.isRenderTargetTexture&&(e[i].value=null,t.set(i,r))}const s=n.clone();for(const i of t)e[i[0]].value=i[1],s.uniforms[i[0]].value=i[1];return s}setMaterial(n){if(this.disposeMaterials(),this.material=n,n!==null){const e=this.materials=[this.cloneMaterial(n),this.cloneMaterial(n),this.cloneMaterial(n)];for(const t of e)t.uniforms=Object.assign({},n.uniforms),t.side=Bf;e[2].skinning=!0,this.materialsBackSide=e.map(t=>{const s=this.cloneMaterial(t);return s.uniforms=Object.assign({},n.uniforms),s.side=Er,s}),this.materialsDoubleSide=e.map(t=>{const s=this.cloneMaterial(t);return s.uniforms=Object.assign({},n.uniforms),s.side=Mi,s}),this.materialsFlatShaded=e.map(t=>{const s=this.cloneMaterial(t);return s.uniforms=Object.assign({},n.uniforms),s.flatShading=!0,s}),this.materialsFlatShadedBackSide=e.map(t=>{const s=this.cloneMaterial(t);return s.uniforms=Object.assign({},n.uniforms),s.flatShading=!0,s.side=Er,s}),this.materialsFlatShadedDoubleSide=e.map(t=>{const s=this.cloneMaterial(t);return s.uniforms=Object.assign({},n.uniforms),s.flatShading=!0,s.side=Mi,s})}}render(n,e,t){const s=n.shadowMap.enabled;if(n.shadowMap.enabled=!1,oa){const i=this.originalMaterials;this.meshCount=0,e.traverse(this.replaceMaterial),n.render(e,t);for(const r of i)r[0].material=r[1];this.meshCount!==i.size&&i.clear()}else{const i=e.overrideMaterial;e.overrideMaterial=this.material,n.render(e,t),e.overrideMaterial=i}n.shadowMap.enabled=s}disposeMaterials(){if(this.material!==null){const n=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(const e of n)e.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return oa}static set workaroundEnabled(n){oa=n}},Es=-1,Oe=class extends Ka{constructor(n,e=Es,t=Es,s=1){super(),this.resizable=n,this.baseSize=new Fe(1,1),this.preferredSize=new Fe(e,t),this.target=this.preferredSize,this.s=s,this.effectiveSize=new Fe,this.addEventListener("change",()=>this.updateEffectiveSize()),this.updateEffectiveSize()}updateEffectiveSize(){const n=this.baseSize,e=this.preferredSize,t=this.effectiveSize,s=this.scale;e.width!==Es?t.width=e.width:e.height!==Es?t.width=Math.round(e.height*(n.width/Math.max(n.height,1))):t.width=Math.round(n.width*s),e.height!==Es?t.height=e.height:e.width!==Es?t.height=Math.round(e.width/Math.max(n.width/Math.max(n.height,1),1)):t.height=Math.round(n.height*s)}get width(){return this.effectiveSize.width}set width(n){this.preferredWidth=n}get height(){return this.effectiveSize.height}set height(n){this.preferredHeight=n}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(n){this.s!==n&&(this.s=n,this.preferredSize.setScalar(Es),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getScale(){return this.scale}setScale(n){this.scale=n}get baseWidth(){return this.baseSize.width}set baseWidth(n){this.baseSize.width!==n&&(this.baseSize.width=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseWidth(){return this.baseWidth}setBaseWidth(n){this.baseWidth=n}get baseHeight(){return this.baseSize.height}set baseHeight(n){this.baseSize.height!==n&&(this.baseSize.height=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(n){this.baseHeight=n}setBaseSize(n,e){(this.baseSize.width!==n||this.baseSize.height!==e)&&(this.baseSize.set(n,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}get preferredWidth(){return this.preferredSize.width}set preferredWidth(n){this.preferredSize.width!==n&&(this.preferredSize.width=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(n){this.preferredWidth=n}get preferredHeight(){return this.preferredSize.height}set preferredHeight(n){this.preferredSize.height!==n&&(this.preferredSize.height=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(n){this.preferredHeight=n}setPreferredSize(n,e){(this.preferredSize.width!==n||this.preferredSize.height!==e)&&(this.preferredSize.set(n,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}copy(n){this.s=n.scale,this.baseSize.set(n.baseWidth,n.baseHeight),this.preferredSize.set(n.preferredWidth,n.preferredHeight),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height)}static get AUTO_SIZE(){return Es}},O0=class extends Set{constructor(n,e=10){super(),this.l=e,this.exclusive=!1,n!==void 0&&this.set(n)}get layer(){return this.l}set layer(n){const e=this.l;for(const t of this)t.layers.disable(e),t.layers.enable(n);this.l=n}getLayer(){return this.layer}setLayer(n){this.layer=n}isExclusive(){return this.exclusive}setExclusive(n){this.exclusive=n}clear(){const n=this.layer;for(const e of this)e.layers.disable(n);return super.clear()}set(n){this.clear();for(const e of n)this.add(e);return this}indexOf(n){return this.has(n)?0:-1}add(n){return this.exclusive?n.layers.set(this.layer):n.layers.enable(this.layer),super.add(n)}delete(n){return this.has(n)&&n.layers.disable(this.layer),super.delete(n)}toggle(n){let e;return this.has(n)?(this.delete(n),e=!1):(this.add(n),e=!0),e}setVisible(n){for(const e of this)n?e.layers.enable(0):e.layers.disable(0);return this}},A0="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y,opacity);}",M0="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,min(y.a,opacity));}",D0="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y)*0.5,opacity);}",R0="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.rg,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",P0="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(step(0.0,y)*(1.0-min(vec4(1.0),(1.0-x)/y)),vec4(1.0),step(1.0,x));return mix(x,z,opacity);}",I0="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=step(0.0,x)*mix(min(vec4(1.0),x/max(1.0-y,1e-9)),vec4(1.0),step(1.0,y));return mix(x,z,opacity);}",N0="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x,y),opacity);}",F0="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,abs(x-y),opacity);}",U0="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x/max(y,1e-12),opacity);}",L0="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y-2.0*x*y),opacity);}",B0="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 a=min(x,1.0),b=min(y,1.0);vec4 z=mix(2.0*a*b,1.0-2.0*(1.0-a)*(1.0-b),step(0.5,y));return mix(x,z,opacity);}",z0="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,step(1.0,x+y),opacity);}",V0="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.r,xHSL.gb));return vec4(mix(x.rgb,z,opacity),y.a);}",j0="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-y,opacity);}",H0="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y*(1.0-x),opacity);}",q0="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x,y),opacity);}",W0="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(y+x-1.0,0.0,1.0),opacity);}",G0="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x+y,1.0),opacity);}",Y0="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(2.0*y+x-1.0,0.0,1.0),opacity);}",Z0="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.rg,yHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",$0="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x*y,opacity);}",X0="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-abs(1.0-x-y),opacity);}",Q0="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,opacity);}",K0="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(2.0*y*x,1.0-2.0*(1.0-y)*(1.0-x),step(0.5,x));return mix(x,z,opacity);}",J0="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 z=mix(mix(y2,x,step(0.5*x,y)),max(vec4(0.0),y2-1.0),step(x,(y2-1.0)));return mix(x,z,opacity);}",em="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(min(x*x/max(1.0-y,1e-12),1.0),y,step(1.0,y));return mix(x,z,opacity);}",tm="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.r,yHSL.g,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",sm="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y-min(x*y,1.0),opacity);}",nm="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 w=step(0.5,y);vec4 z=mix(x-(1.0-y2)*x*(1.0-x),mix(x+(y2-1.0)*(sqrt(x)-x),x+(y2-1.0)*x*((16.0*x-12.0)*x+3.0),w*(1.0-step(0.25,x))),w);return mix(x,z,opacity);}",im="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y;}",rm="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x+y-1.0,0.0),opacity);}",om="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(max(1.0-min((1.0-x)/(2.0*y),1.0),0.0),min(x/(2.0*(1.0-y)),1.0),step(0.5,y));return mix(x,z,opacity);}",am=new Map([[ee.ADD,A0],[ee.ALPHA,M0],[ee.AVERAGE,D0],[ee.COLOR,R0],[ee.COLOR_BURN,P0],[ee.COLOR_DODGE,I0],[ee.DARKEN,N0],[ee.DIFFERENCE,F0],[ee.DIVIDE,U0],[ee.DST,null],[ee.EXCLUSION,L0],[ee.HARD_LIGHT,B0],[ee.HARD_MIX,z0],[ee.HUE,V0],[ee.INVERT,j0],[ee.INVERT_RGB,H0],[ee.LIGHTEN,q0],[ee.LINEAR_BURN,W0],[ee.LINEAR_DODGE,G0],[ee.LINEAR_LIGHT,Y0],[ee.LUMINOSITY,Z0],[ee.MULTIPLY,$0],[ee.NEGATION,X0],[ee.NORMAL,Q0],[ee.OVERLAY,K0],[ee.PIN_LIGHT,J0],[ee.REFLECT,em],[ee.SATURATION,tm],[ee.SCREEN,sm],[ee.SOFT_LIGHT,nm],[ee.SRC,im],[ee.SUBTRACT,rm],[ee.VIVID_LIGHT,om]]),cm=class extends Ka{constructor(n,e=1){super(),this._blendFunction=n,this.opacity=new Q(e)}getOpacity(){return this.opacity.value}setOpacity(n){this.opacity.value=n}get blendFunction(){return this._blendFunction}set blendFunction(n){this._blendFunction=n,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(n){this.blendFunction=n}getShaderCode(){return am.get(this.blendFunction)}},Li=class extends Ka{constructor(e,t,{attributes:s=ds.NONE,blendFunction:i=ee.NORMAL,defines:r=new Map,uniforms:o=new Map,extensions:a=null,vertexShader:c=null}={}){super(),this.name=e,this.renderer=null,this.attributes=s,this.fragmentShader=t,this.vertexShader=c,this.defines=r,this.uniforms=o,this.extensions=a,this.blendMode=new cm(i),this.blendMode.addEventListener("change",l=>this.setChanged()),this._inputColorSpace=Ao,this._outputColorSpace=Cu}get inputColorSpace(){return this._inputColorSpace}set inputColorSpace(e){this._inputColorSpace=e,this.setChanged()}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e,this.setChanged()}set mainScene(e){}set mainCamera(e){}getName(){return this.name}setRenderer(e){this.renderer=e}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(e){this.attributes=e,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(e){this.fragmentShader=e,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(e){this.vertexShader=e,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(e,t=oi){}update(e,t,s){}setSize(e,t){}initialize(e,t,s){}dispose(){for(const e of Object.keys(this)){const t=this[e];(t instanceof Tt||t instanceof _u||t instanceof gu||t instanceof it)&&this[e].dispose()}}},lm=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 texel=texture2D(map,uv);outputColor=vec4(texel.rgb*intensity,texel.a);}`,um=class extends Li{constructor({blendFunction:n=ee.SCREEN,luminanceThreshold:e=.9,luminanceSmoothing:t=.025,mipmapBlur:s=!1,intensity:i=1,radius:r=.85,levels:o=8,kernelSize:a=Mo.LARGE,resolutionScale:c=.5,width:l=Oe.AUTO_SIZE,height:u=Oe.AUTO_SIZE,resolutionX:h=l,resolutionY:f=u}={}){super("BloomEffect",lm,{blendFunction:n,uniforms:new Map([["map",new Q(null)],["intensity",new Q(i)]])}),this.renderTarget=new Tt(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Bloom.Target",this.blurPass=new Mu({kernelSize:a}),this.luminancePass=new y0({colorOutput:!0}),this.luminanceMaterial.threshold=e,this.luminanceMaterial.smoothing=t,this.mipmapBlurPass=new T0,this.mipmapBlurPass.enabled=s,this.mipmapBlurPass.radius=r,this.mipmapBlurPass.levels=o,this.uniforms.get("map").value=s?this.mipmapBlurPass.texture:this.renderTarget.texture;const d=this.resolution=new Oe(this,h,f,c);d.addEventListener("change",m=>this.setSize(d.baseWidth,d.baseHeight))}get texture(){return this.mipmapBlurPass.enabled?this.mipmapBlurPass.texture:this.renderTarget.texture}getTexture(){return this.texture}getResolution(){return this.resolution}getBlurPass(){return this.blurPass}getLuminancePass(){return this.luminancePass}get luminanceMaterial(){return this.luminancePass.fullscreenMaterial}getLuminanceMaterial(){return this.luminancePass.fullscreenMaterial}get width(){return this.resolution.width}set width(n){this.resolution.preferredWidth=n}get height(){return this.resolution.height}set height(n){this.resolution.preferredHeight=n}get dithering(){return this.blurPass.dithering}set dithering(n){this.blurPass.dithering=n}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(n){this.blurPass.kernelSize=n}get distinction(){return console.warn(this.name,"distinction was removed"),1}set distinction(n){console.warn(this.name,"distinction was removed")}get intensity(){return this.uniforms.get("intensity").value}set intensity(n){this.uniforms.get("intensity").value=n}getIntensity(){return this.intensity}setIntensity(n){this.intensity=n}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}update(n,e,t){const s=this.renderTarget,i=this.luminancePass;i.enabled?(i.render(n,e),this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(n,i.renderTarget):this.blurPass.render(n,i.renderTarget,s)):this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(n,e):this.blurPass.render(n,e,s)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e),this.renderTarget.setSize(t.width,t.height),this.blurPass.resolution.copy(t),this.luminancePass.setSize(n,e),this.mipmapBlurPass.setSize(n,e)}initialize(n,e,t){this.blurPass.initialize(n,e,t),this.luminancePass.initialize(n,e,t),this.mipmapBlurPass.initialize(n,e,t),t!==void 0&&(this.renderTarget.texture.type=t,Yn(n)===qe&&Is(this.renderTarget.texture,qe))}},hm=`uniform lowp sampler2D edgeTexture;uniform lowp sampler2D maskTexture;uniform vec3 visibleEdgeColor;uniform vec3 hiddenEdgeColor;uniform float pulse;uniform float edgeStrength;
#ifdef USE_PATTERN
uniform lowp sampler2D patternTexture;varying vec2 vUvPattern;
#endif
void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec2 edge=texture2D(edgeTexture,uv).rg;vec2 mask=texture2D(maskTexture,uv).rg;
#ifndef X_RAY
edge.y=0.0;
#endif
edge*=(edgeStrength*mask.x*pulse);vec3 color=edge.x*visibleEdgeColor+edge.y*hiddenEdgeColor;float visibilityFactor=0.0;
#ifdef USE_PATTERN
vec4 patternColor=texture2D(patternTexture,vUvPattern);
#ifdef X_RAY
float hiddenFactor=0.5;
#else
float hiddenFactor=0.0;
#endif
visibilityFactor=(1.0-mask.y>0.0)?1.0:hiddenFactor;visibilityFactor*=(1.0-mask.x)*patternColor.a;color+=visibilityFactor*patternColor.rgb;
#endif
float alpha=max(max(edge.x,edge.y),visibilityFactor);
#ifdef ALPHA
outputColor=vec4(color,alpha);
#else
outputColor=vec4(color,max(alpha,inputColor.a));
#endif
}`,dm="uniform float patternScale;varying vec2 vUvPattern;void mainSupport(const in vec2 uv){vUvPattern=uv*vec2(aspect,1.0)*patternScale;}",fm=class extends Li{constructor(n,e,{blendFunction:t=ee.SCREEN,patternTexture:s=null,patternScale:i=1,edgeStrength:r=1,pulseSpeed:o=0,visibleEdgeColor:a=16777215,hiddenEdgeColor:c=2230538,kernelSize:l=Mo.VERY_SMALL,blur:u=!1,xRay:h=!0,multisampling:f=0,resolutionScale:d=.5,width:m=Oe.AUTO_SIZE,height:p=Oe.AUTO_SIZE,resolutionX:_=m,resolutionY:v=p}={}){super("OutlineEffect",hm,{uniforms:new Map([["maskTexture",new Q(null)],["edgeTexture",new Q(null)],["edgeStrength",new Q(r)],["visibleEdgeColor",new Q(new hs(a))],["hiddenEdgeColor",new Q(new hs(c))],["pulse",new Q(1)],["patternScale",new Q(i)],["patternTexture",new Q(null)]])}),this.blendMode.addEventListener("change",g=>{this.blendMode.blendFunction===ee.ALPHA?this.defines.set("ALPHA","1"):this.defines.delete("ALPHA"),this.setChanged()}),this.blendMode.blendFunction=t,this.patternTexture=s,this.xRay=h,this.scene=n,this.camera=e,this.renderTargetMask=new Tt(1,1),this.renderTargetMask.samples=f,this.renderTargetMask.texture.name="Outline.Mask",this.uniforms.get("maskTexture").value=this.renderTargetMask.texture,this.renderTargetOutline=new Tt(1,1,{depthBuffer:!1}),this.renderTargetOutline.texture.name="Outline.Edges",this.uniforms.get("edgeTexture").value=this.renderTargetOutline.texture,this.clearPass=new sc,this.clearPass.overrideClearColor=new hs(0),this.clearPass.overrideClearAlpha=1,this.depthPass=new m0(n,e),this.maskPass=new Do(n,e,new Yp(this.depthPass.texture,e));const T=this.maskPass.clearPass;T.overrideClearColor=new hs(16777215),T.overrideClearAlpha=1,this.blurPass=new Mu({resolutionScale:d,resolutionX:_,resolutionY:v,kernelSize:l}),this.blurPass.enabled=u;const S=this.blurPass.resolution;S.addEventListener("change",g=>this.setSize(S.baseWidth,S.baseHeight)),this.outlinePass=new k0(new a0);const y=this.outlinePass.fullscreenMaterial;y.inputBuffer=this.renderTargetMask.texture,this.time=0,this.forceUpdate=!0,this.selection=new O0,this.selection.layer=10,this.pulseSpeed=o}set mainScene(n){this.scene=n,this.depthPass.mainScene=n,this.maskPass.mainScene=n}set mainCamera(n){this.camera=n,this.depthPass.mainCamera=n,this.maskPass.mainCamera=n,this.maskPass.overrideMaterial.copyCameraSettings(n)}get resolution(){return this.blurPass.resolution}getResolution(){return this.blurPass.getResolution()}get multisampling(){return this.renderTargetMask.samples}set multisampling(n){this.renderTargetMask.samples=n,this.renderTargetMask.dispose()}get patternScale(){return this.uniforms.get("patternScale").value}set patternScale(n){this.uniforms.get("patternScale").value=n}get edgeStrength(){return this.uniforms.get("edgeStrength").value}set edgeStrength(n){this.uniforms.get("edgeStrength").value=n}get visibleEdgeColor(){return this.uniforms.get("visibleEdgeColor").value}set visibleEdgeColor(n){this.uniforms.get("visibleEdgeColor").value=n}get hiddenEdgeColor(){return this.uniforms.get("hiddenEdgeColor").value}set hiddenEdgeColor(n){this.uniforms.get("hiddenEdgeColor").value=n}getBlurPass(){return this.blurPass}getSelection(){return this.selection}getPulseSpeed(){return this.pulseSpeed}setPulseSpeed(n){this.pulseSpeed=n}get width(){return this.resolution.width}set width(n){this.resolution.preferredWidth=n}get height(){return this.resolution.height}set height(n){this.resolution.preferredHeight=n}get selectionLayer(){return this.selection.layer}set selectionLayer(n){this.selection.layer=n}get dithering(){return this.blurPass.dithering}set dithering(n){this.blurPass.dithering=n}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(n){this.blurPass.kernelSize=n}get blur(){return this.blurPass.enabled}set blur(n){this.blurPass.enabled=n}get xRay(){return this.defines.has("X_RAY")}set xRay(n){this.xRay!==n&&(n?this.defines.set("X_RAY","1"):this.defines.delete("X_RAY"),this.setChanged())}isXRayEnabled(){return this.xRay}setXRayEnabled(n){this.xRay=n}get patternTexture(){return this.uniforms.get("patternTexture").value}set patternTexture(n){n!==null?(n.wrapS=n.wrapT=zf,this.defines.set("USE_PATTERN","1"),this.setVertexShader(dm)):(this.defines.delete("USE_PATTERN"),this.setVertexShader(null)),this.uniforms.get("patternTexture").value=n,this.setChanged()}setPatternTexture(n){this.patternTexture=n}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}setSelection(n){return this.selection.set(n),this}clearSelection(){return this.selection.clear(),this}selectObject(n){return this.selection.add(n),this}deselectObject(n){return this.selection.delete(n),this}update(n,e,t){const s=this.scene,i=this.camera,r=this.selection,a=this.uniforms.get("pulse"),c=s.background,l=i.layers.mask;(this.forceUpdate||r.size>0)&&(s.background=null,a.value=1,this.pulseSpeed>0&&(a.value=Math.cos(this.time*this.pulseSpeed*10)*.375+.625),this.time+=t,r.setVisible(!1),this.depthPass.render(n),r.setVisible(!0),i.layers.set(r.layer),this.maskPass.render(n,this.renderTargetMask),i.layers.mask=l,s.background=c,this.outlinePass.render(n,null,this.renderTargetOutline),this.blurPass.enabled&&this.blurPass.render(n,this.renderTargetOutline,this.renderTargetOutline)),this.forceUpdate=r.size>0}setSize(n,e){this.blurPass.setSize(n,e),this.renderTargetMask.setSize(n,e);const t=this.resolution;t.setBaseSize(n,e);const s=t.width,i=t.height;this.depthPass.setSize(s,i),this.renderTargetOutline.setSize(s,i),this.outlinePass.fullscreenMaterial.setSize(s,i)}initialize(n,e,t){this.blurPass.initialize(n,e,ps),t!==void 0&&(this.depthPass.initialize(n,e,t),this.maskPass.initialize(n,e,t),this.outlinePass.initialize(n,e,t))}},pm=`uniform float offset;uniform float darkness;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){const vec2 center=vec2(0.5);vec3 color=inputColor.rgb;
#if VIGNETTE_TECHNIQUE == 0
float d=distance(uv,center);color*=smoothstep(0.8,offset*0.799,d*(darkness+offset));
#else
vec2 coord=(uv-center)*vec2(offset);color=mix(color,vec3(1.0-darkness),dot(coord,coord));
#endif
outputColor=vec4(color,inputColor.a);}`,mm=class extends Li{constructor({blendFunction:n,technique:e=Nr.DEFAULT,eskil:t=!1,offset:s=.5,darkness:i=.5}={}){super("VignetteEffect",pm,{blendFunction:n,defines:new Map([["VIGNETTE_TECHNIQUE",e.toFixed(0)]]),uniforms:new Map([["offset",new Q(s)],["darkness",new Q(i)]])})}get technique(){return Number(this.defines.get("VIGNETTE_TECHNIQUE"))}set technique(n){this.technique!==n&&(this.defines.set("VIGNETTE_TECHNIQUE",n.toFixed(0)),this.setChanged())}get eskil(){return this.technique===Nr.ESKIL}set eskil(n){this.technique=n?Nr.ESKIL:Nr.DEFAULT}getTechnique(){return this.technique}setTechnique(n){this.technique=n}get offset(){return this.uniforms.get("offset").value}set offset(n){this.uniforms.get("offset").value=n}getOffset(){return this.offset}setOffset(n){this.offset=n}get darkness(){return this.uniforms.get("darkness").value}set darkness(n){this.uniforms.get("darkness").value=n}getDarkness(){return this.darkness}setDarkness(n){this.darkness=n}};const Du=E.createContext(null),_l=n=>(n.getAttributes()&ds.CONVOLUTION)===ds.CONVOLUTION,_m=$r.memo(E.forwardRef(({children:n,camera:e,scene:t,resolutionScale:s,enabled:i=!0,renderPriority:r=1,autoClear:o=!0,depthBuffer:a,disableNormalPass:c,stencilBuffer:l,multisampling:u=8,frameBufferType:h=Wf},f)=>{const{gl:d,scene:m,camera:p,size:_}=ve(),v=t||m,T=e||p,[S,y,g]=E.useMemo(()=>{const C=xp(),b=new b0(d,{depthBuffer:a,stencilBuffer:l,multisampling:u>0&&C?u:0,frameBufferType:h});b.addPass(new Do(v,T));let O=null,A=null;return c||(A=new w0(v,T),A.enabled=!1,b.addPass(A),s!==void 0&&C&&(O=new _0({normalBuffer:A.texture,resolutionScale:s}),O.enabled=!1,b.addPass(O))),[b,A,O]},[T,d,a,l,u,h,v,c,s]);E.useEffect(()=>S==null?void 0:S.setSize(_.width,_.height),[S,_]),Rt((C,b)=>{if(i){const O=d.autoClear;d.autoClear=o,l&&!o&&d.clearStencil(),S.render(b),d.autoClear=O}},i?r:0);const w=E.useRef(null),k=xf(w);E.useLayoutEffect(()=>{const C=[];if(w.current&&k.current&&S){const b=k.current.objects;for(let O=0;O<b.length;O++){const A=b[O];if(A instanceof Li){const R=[A];if(!_l(A)){let F=null;for(;(F=b[O+1])instanceof Li&&!_l(F);)R.push(F),O++}const P=new v0(T,...R);C.push(P)}else A instanceof it&&C.push(A)}for(const O of C)S==null||S.addPass(O);y&&(y.enabled=!0),g&&(g.enabled=!0)}return()=>{for(const b of C)S==null||S.removePass(b);y&&(y.enabled=!1),g&&(g.enabled=!1)}},[S,n,T,y,g,k]);const x=E.useMemo(()=>({composer:S,normalPass:y,downSamplingPass:g,resolutionScale:s,camera:T,scene:v}),[S,y,g,s,T,v]);return E.useImperativeHandle(f,()=>S,[S]),M.jsx(Du.Provider,{value:x,children:M.jsx("group",{ref:w,children:n})})})),gl=n=>typeof n=="object"&&n!=null&&"current"in n?n.current:n;let gm=0;const vl=new WeakMap,Ru=(n,e)=>$r.forwardRef(function({blendFunction:s=e==null?void 0:e.blendFunction,opacity:i=e==null?void 0:e.opacity,...r},o){let a=vl.get(n);if(!a){const u=`@react-three/postprocessing/${n.name}-${gm++}`;Qa({[u]:n}),vl.set(n,a=u)}const c=ve(u=>u.camera),l=$r.useMemo(()=>{var u,h;return[...(u=e==null?void 0:e.args)!=null?u:[],...(h=r.args)!=null?h:[{...e,...r}]]},[JSON.stringify(r)]);return M.jsx(a,{camera:c,"blendMode-blendFunction":s,"blendMode-opacity-value":i,...r,ref:o,args:l})}),vm=Ru(um,{blendFunction:ee.ADD}),ym=E.forwardRef(function({selection:e=[],selectionLayer:t=10,blendFunction:s,patternTexture:i,edgeStrength:r,pulseSpeed:o,visibleEdgeColor:a,hiddenEdgeColor:c,width:l,height:u,kernelSize:h,blur:f,xRay:d,...m},p){const _=ve(g=>g.invalidate),{scene:v,camera:T}=E.useContext(Du),S=E.useMemo(()=>new fm(v,T,{blendFunction:s,patternTexture:i,edgeStrength:r,pulseSpeed:o,visibleEdgeColor:a,hiddenEdgeColor:c,width:l,height:u,kernelSize:h,blur:f,xRay:d,...m}),[s,f,T,r,u,c,h,i,o,v,a,l,d]),y=E.useContext(tc);return E.useEffect(()=>{if(!y&&e)return S.selection.set(Array.isArray(e)?e.map(gl):[gl(e)]),_(),()=>{S.selection.clear(),_()}},[S,e,y,_]),E.useEffect(()=>{S.selectionLayer=t,_()},[S,_,t]),E.useRef(),E.useEffect(()=>{var g;if(y&&y.enabled&&(g=y.selected)!=null&&g.length)return S.selection.set(y.selected),_(),()=>{S.selection.clear(),_()}},[y,S.selection,_]),E.useEffect(()=>()=>{S.dispose()},[S]),M.jsx("primitive",{ref:p,object:S})}),xm=Ru(mm),Tm={isUserDragging:!1,isUserScrolling:!1,userMovedCamera:!1,isUserScrollingOnHtmlPanel:!1},Ns=uu(n=>({...Tm,setIsUserDragging:e=>n({isUserDragging:e}),setIsUserScrolling:e=>n({isUserScrolling:e}),setUserMovedCamera:e=>n({userMovedCamera:e}),setIsUserScrollingOnHtmlPanel:e=>n({isUserScrollingOnHtmlPanel:e})})),yl=n=>M.jsx("svg",{width:"1em",height:"1em",viewBox:"0 0 12 12",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:M.jsx("path",{d:"M9.47019 6.56248H0.9375C0.777887 6.56248 0.644237 6.50863 0.53655 6.40094C0.42885 6.29326 0.375 6.15961 0.375 5.99999C0.375 5.84038 0.42885 5.70673 0.53655 5.59904C0.644237 5.49136 0.777887 5.43751 0.9375 5.43751H9.47019L5.59326 1.56058C5.48172 1.44904 5.42667 1.31851 5.42812 1.169C5.42956 1.01948 5.48846 0.886545 5.60481 0.770208C5.72114 0.661558 5.85287 0.605308 5.99998 0.601458C6.14709 0.597608 6.27882 0.653858 6.39516 0.770208L11.1504 5.52549C11.2206 5.59568 11.2701 5.66971 11.299 5.7476C11.3278 5.82548 11.3423 5.90961 11.3423 5.99999C11.3423 6.09038 11.3278 6.17451 11.299 6.25239C11.2701 6.33028 11.2206 6.40431 11.1504 6.4745L6.39516 11.2298C6.29132 11.3336 6.16272 11.3868 6.00936 11.3892C5.85599 11.3916 5.72114 11.3384 5.60481 11.2298C5.48846 11.1134 5.43028 10.9798 5.43028 10.8288C5.43028 10.6779 5.48846 10.5442 5.60481 10.4279L9.47019 6.56248Z",fill:"currentColor"})}),wm=n=>M.jsx("svg",{width:"1em",height:"1em",viewBox:"0 0 20 20",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:M.jsxs("g",{id:"captive_portal",children:[M.jsx("mask",{id:"mask0_8513_13265",maskUnits:"userSpaceOnUse",x:"0",y:"0",width:"20",height:"20",children:M.jsx("rect",{id:"Bounding box",width:"1em",height:"1em",fill:"currentColor"})}),M.jsxs("g",{mask:"url(#mask0_8513_13265)",children:[M.jsx("path",{id:"captive_portal_2",d:"M9.99992 17.9154C8.90589 17.9154 7.87735 17.7073 6.91429 17.2912C5.9511 16.8751 5.11318 16.3107 4.40054 15.5981C3.6879 14.8854 3.12353 14.0475 2.70742 13.0843C2.29131 12.1213 2.08325 11.0927 2.08325 9.9987C2.08325 8.90467 2.29131 7.87613 2.70742 6.91307C3.12353 5.94988 3.6879 5.11196 4.40054 4.39932C5.11318 3.68668 5.9511 3.12231 6.91429 2.7062C7.87735 2.29009 8.90589 2.08203 9.99992 2.08203C11.0939 2.08203 12.1225 2.29009 13.0855 2.7062C14.0487 3.12231 14.8867 3.68668 15.5993 4.39932C16.3119 5.11196 16.8763 5.94988 17.2924 6.91307C17.7085 7.87613 17.9166 8.90467 17.9166 9.9987C17.9166 10.1429 17.9131 10.2983 17.9062 10.4649C17.8992 10.6316 17.8861 10.7871 17.8668 10.9314C17.8444 11.1088 17.7699 11.2487 17.6433 11.3512C17.5167 11.4538 17.3605 11.5052 17.1745 11.5052C17.011 11.5052 16.8717 11.4346 16.7564 11.2935C16.641 11.1525 16.5945 10.9977 16.617 10.8289C16.6448 10.6846 16.66 10.5462 16.6626 10.4137C16.6653 10.2812 16.6666 10.1429 16.6666 9.9987C16.6666 9.69425 16.6466 9.39113 16.6066 9.08932C16.5664 8.78738 16.5037 8.48689 16.4183 8.18786H13.3203C13.3727 8.48689 13.4107 8.78738 13.4343 9.08932C13.4578 9.39113 13.4695 9.69425 13.4695 9.9987C13.4695 10.1429 13.4682 10.2962 13.4655 10.4587C13.4628 10.6211 13.4544 10.7743 13.4405 10.9185C13.4182 11.0959 13.345 11.2379 13.221 11.3447C13.0971 11.4517 12.9464 11.5052 12.7691 11.5052C12.6056 11.5052 12.4628 11.4389 12.3405 11.3064C12.2182 11.1739 12.1682 11.0233 12.1905 10.8545C12.2044 10.7102 12.2128 10.5676 12.2155 10.4266C12.2182 10.2855 12.2195 10.1429 12.2195 9.9987C12.2195 9.69425 12.2078 9.39113 12.1843 9.08932C12.1607 8.78738 12.1228 8.48689 12.0705 8.18786H7.92929C7.87707 8.48689 7.83915 8.78738 7.81554 9.08932C7.79207 9.39113 7.78033 9.69425 7.78033 9.9987C7.78033 10.3031 7.79207 10.6063 7.81554 10.9081C7.83915 11.21 7.87707 11.5105 7.92929 11.8095H10.3685C10.5458 11.8095 10.6944 11.8694 10.8141 11.9891C10.9337 12.1087 10.9935 12.2572 10.9935 12.4345C10.9935 12.6119 10.9337 12.7604 10.8141 12.8802C10.6944 12.9997 10.5458 13.0595 10.3685 13.0595H8.21617C8.39895 13.7155 8.63693 14.3445 8.93013 14.9466C9.22346 15.5487 9.58006 16.1157 9.99992 16.6477C10.1495 16.6477 10.2991 16.6485 10.4487 16.6502C10.5983 16.6517 10.7451 16.6429 10.8893 16.6237C11.0614 16.6012 11.2051 16.6455 11.3203 16.7566C11.4358 16.8677 11.4935 17.0093 11.4935 17.1814C11.4935 17.3672 11.4457 17.5222 11.3501 17.6462C11.2544 17.7701 11.1179 17.8432 10.9405 17.8656C10.7964 17.8849 10.641 17.898 10.4743 17.9049C10.3076 17.9119 10.1495 17.9154 9.99992 17.9154ZM3.58159 11.8095H6.6795C6.62714 11.5105 6.58915 11.21 6.56554 10.9081C6.54207 10.6063 6.53033 10.3031 6.53033 9.9987C6.53033 9.69425 6.54207 9.39113 6.56554 9.08932C6.58915 8.78738 6.62714 8.48689 6.6795 8.18786H3.58159C3.49617 8.48689 3.43339 8.78738 3.39325 9.08932C3.35325 9.39113 3.33325 9.69425 3.33325 9.9987C3.33325 10.3031 3.35325 10.6063 3.39325 10.9081C3.43339 11.21 3.49617 11.5105 3.58159 11.8095ZM8.38617 16.4345C8.05075 15.9143 7.76256 15.3715 7.52159 14.8064C7.28061 14.2413 7.08429 13.659 6.93263 13.0595H4.10575C4.54047 13.9174 5.1302 14.6413 5.87492 15.231C6.61964 15.8209 7.45672 16.222 8.38617 16.4345ZM4.10575 6.93786H6.93263C7.0736 6.33314 7.26325 5.74821 7.50159 5.18307C7.73978 4.61779 8.03464 4.07773 8.38617 3.56286C7.45131 3.77009 6.6129 4.16856 5.87096 4.75828C5.12888 5.348 4.54047 6.07453 4.10575 6.93786ZM8.21617 6.93786H11.7837C11.6063 6.28189 11.3669 5.65557 11.0655 5.05891C10.7643 4.4621 10.4091 3.89238 9.99992 3.34974C9.58534 3.88168 9.22874 4.4487 8.93013 5.05078C8.63152 5.65286 8.39353 6.28189 8.21617 6.93786ZM13.0672 6.93786H15.8941C15.4594 6.07453 14.871 5.34668 14.1289 4.75432C13.3869 4.16182 12.5485 3.76467 11.6137 3.56286C11.9491 4.08314 12.2333 4.62717 12.4662 5.19495C12.6991 5.76286 12.8994 6.34384 13.0672 6.93786Z",fill:"currentColor"}),M.jsx("path",{id:"travel_explore",d:"M18.0634 18.7783L16.8556 17.5822C16.6378 17.7211 16.4031 17.8331 16.1517 17.9184C15.9003 18.0038 15.6342 18.0465 15.3535 18.0465C14.6044 18.0465 13.9694 17.7857 13.4484 17.2642C12.9275 16.7428 12.667 16.1071 12.667 15.3572C12.667 14.6074 12.9275 13.9717 13.4484 13.4502C13.9694 12.9287 14.6044 12.668 15.3535 12.668C16.1026 12.668 16.7376 12.9287 17.2586 13.4502C17.7795 13.9717 18.04 14.6074 18.04 15.3572C18.04 15.6425 17.9963 15.9121 17.9089 16.166C17.8215 16.4198 17.7063 16.6557 17.5633 16.8738L18.7711 18.0698C18.8684 18.1628 18.917 18.2798 18.917 18.4208C18.917 18.5618 18.8684 18.6809 18.7711 18.7783C18.6781 18.8714 18.5611 18.918 18.4203 18.918C18.2796 18.918 18.1606 18.8714 18.0634 18.7783ZM15.3535 17.038C15.8236 17.038 16.221 16.8755 16.5456 16.5506C16.8703 16.2256 17.0326 15.8278 17.0326 15.3572C17.0326 14.8866 16.8703 14.4888 16.5456 14.1639C16.221 13.8389 15.8236 13.6764 15.3535 13.6764C14.8834 13.6764 14.486 13.8389 14.1614 14.1639C13.8367 14.4888 13.6744 14.8866 13.6744 15.3572C13.6744 15.8278 13.8367 16.2256 14.1614 16.5506C14.486 16.8755 14.8834 17.038 15.3535 17.038Z",fill:"currentColor"})]})]})}),km=n=>M.jsx("svg",{width:"1em",height:"1em",viewBox:"0 0 18 18",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:M.jsx("path",{d:"M8.95833 14.0013C9.25 14.0013 9.49653 13.9006 9.69792 13.6992C9.89931 13.4978 10 13.2513 10 12.9596C10 12.668 9.89931 12.4214 9.69792 12.2201C9.49653 12.0187 9.25 11.918 8.95833 11.918C8.66667 11.918 8.42014 12.0187 8.21875 12.2201C8.01736 12.4214 7.91667 12.668 7.91667 12.9596C7.91667 13.2513 8.01736 13.4978 8.21875 13.6992C8.42014 13.9006 8.66667 14.0013 8.95833 14.0013ZM9 17.3346C7.84722 17.3346 6.76389 17.1159 5.75 16.6784C4.73611 16.2409 3.85417 15.6471 3.10417 14.8971C2.35417 14.1471 1.76042 13.2652 1.32292 12.2513C0.885416 11.2374 0.666666 10.1541 0.666666 9.0013C0.666666 7.84852 0.885416 6.76519 1.32292 5.7513C1.76042 4.73741 2.35417 3.85547 3.10417 3.10547C3.85417 2.35547 4.73611 1.76172 5.75 1.32422C6.76389 0.886719 7.84722 0.667969 9 0.667969C10.1528 0.667969 11.2361 0.886719 12.25 1.32422C13.2639 1.76172 14.1458 2.35547 14.8958 3.10547C15.6458 3.85547 16.2396 4.73741 16.6771 5.7513C17.1146 6.76519 17.3333 7.84852 17.3333 9.0013C17.3333 10.1541 17.1146 11.2374 16.6771 12.2513C16.2396 13.2652 15.6458 14.1471 14.8958 14.8971C14.1458 15.6471 13.2639 16.2409 12.25 16.6784C11.2361 17.1159 10.1528 17.3346 9 17.3346ZM9.08333 5.41797C9.43056 5.41797 9.73264 5.52908 9.98958 5.7513C10.2465 5.97352 10.375 6.2513 10.375 6.58464C10.375 6.89019 10.2812 7.16102 10.0937 7.39714C9.90625 7.63325 9.69444 7.85547 9.45833 8.0638C9.13889 8.34158 8.85764 8.64714 8.61458 8.98047C8.37153 9.3138 8.25 9.6888 8.25 10.1055C8.25 10.2999 8.32292 10.4631 8.46875 10.5951C8.61458 10.727 8.78472 10.793 8.97917 10.793C9.1875 10.793 9.36458 10.7235 9.51042 10.5846C9.65625 10.4457 9.75 10.2721 9.79167 10.0638C9.84722 9.77214 9.97222 9.51172 10.1667 9.28255C10.3611 9.05339 10.5694 8.83464 10.7917 8.6263C11.1111 8.32075 11.3854 7.98741 11.6146 7.6263C11.8437 7.26519 11.9583 6.86241 11.9583 6.41797C11.9583 5.70964 11.6701 5.12977 11.0937 4.67839C10.5174 4.227 9.84722 4.0013 9.08333 4.0013C8.55555 4.0013 8.05208 4.11241 7.57292 4.33464C7.09375 4.55686 6.72917 4.89714 6.47917 5.35547C6.38194 5.52214 6.35069 5.69922 6.38542 5.88672C6.42014 6.07422 6.51389 6.21658 6.66667 6.3138C6.86111 6.42491 7.0625 6.45964 7.27083 6.41797C7.47917 6.3763 7.65278 6.25825 7.79167 6.0638C7.94444 5.85547 8.13542 5.69575 8.36458 5.58464C8.59375 5.47352 8.83333 5.41797 9.08333 5.41797Z",fill:"currentColor"})}),Sm=()=>{const[n,e]=E.useState(""),t=E.useRef(null),{fetchData:s,setAbortRequests:i,seedQuestions:r}=xn(y=>y),[o]=hu(y=>[y.setBudget]),{setUniverseQuestionIsOpen:a,setSidebarOpen:c,setShowCollapseButton:l}=hr(y=>({setUniverseQuestionIsOpen:y.setUniverseQuestionIsOpen,setSidebarOpen:y.setSidebarOpen,setShowCollapseButton:y.setShowCollapseButton})),u=ef(y=>y.resetAiSummaryAnswer),[h,f]=E.useState([]);E.useEffect(()=>{r&&f(T(r).slice(0,4))},[r]),E.useEffect(()=>{t.current&&t.current.focus()},[]);const d=async y=>{y&&(u(),a(),c(!0),l(!0)),await s(o,i,y)},m=!!n.trim().length,p=async y=>{y.keyCode===13&&y.shiftKey===!1&&m&&(y.preventDefault(),d(n))},_=async y=>{e(y),await d(y)},v=()=>{a(),c(!0),l(!0)},T=y=>{const g=[...y];let w=g.length-1;for(;w>0;){const k=Math.floor(Math.random()*(w+1));[g[w],g[k]]=[g[k],g[w]],w-=1}return g},S=!!n&&n.trim().length>0;return M.jsxs(Em,{children:["Ideas have shapes",M.jsxs(bm,{onKeyDown:p,py:12,tabIndex:-1,children:[M.jsx(Cm,{ref:t,onChange:y=>e(y.target.value),placeholder:"What do you want to know?",value:n}),M.jsx(Om,{color:"secondary",disabled:!S,onClick:()=>d(n),variant:"contained",children:S?M.jsxs(M.Fragment,{children:["Search ",M.jsx(yl,{})]}):M.jsx(yl,{})})]}),h.length>0&&M.jsx(Mm,{children:h.map(y=>M.jsxs(Dm,{onClick:()=>_(y),children:[M.jsx(km,{}),y]},y))}),M.jsx(Am,{"data-testid":"explore-graph-btn",onClick:v,startIcon:M.jsx(wm,{}),children:"Explore Graph"})]})},Cm=Le(ip).attrs({maxRows:3})`
  background: ${pe.BG1};
  max-width: 700px;
  width: 700px;
  color: ${pe.white};
  padding: 0 16px 0 16px;
  overflow-y: auto !important;
  border: none;
  resize: none;
  outline: none;
  border-radius: 12px;
  font-family: 'Barlow';
  display: flex;
  align-items: center;
  text-align: justify;
  font-size: 16px;
  font-weight: 400;

  &:-moz-placeholder, /* Firefox 18- */
  &::-moz-placeholder, /* Firefox 19+ */
  &:-ms-input-placeholder, /* IE 10+ */
  &::-webkit-input-placeholder, /* Webkit based */
  &::placeholder {
    color: #0bf;
  }

  &::-webkit-scrollbar {
    width: 3px;
  }

  &::-webkit-scrollbar-track {
    border-radius: 12px;
    margin: 13px;
    overflow-y: hidden;
  }
`,bm=Le(xs)`
  position: relative;
  margin-top: 30px;
  background: ${pe.BG1};
  max-width: 702px;
  width: 702px;
  color: ${pe.white};
  min-height: 150px;
  border: 1px solid ${pe.modalShield};
  resize: none;
  outline: none;
  border-radius: 12px;
  box-shadow: 0px 1px 6px 0px rgba(0, 0, 0, 0.5);
`,Em=Le(xs)`
  background: #16161de3;
  position: absolute;
  left: 0;
  right: 0;
  bottom: 0;
  top: 0;
  color: #fff;
  align-items: center;
  justify-content: center;
  font-size: 32px;
  font-style: normal;
  font-weight: 700;
  line-height: 16px;
  font-family: 'Barlow';
`,Om=Le(xu)`
  && {
    position: absolute;
    bottom: 16px;
    right: 16px;
    height: 32px;
    border-radius: 16px;
    min-width: 32px;
  }

  &&.MuiButton-root {
    padding: 0 10px 0 12px;
  }

  svg {
    margin-top: 1px;
    width: 11px;
    height: 11px;
  }
`,Am=Le(xu)`
  && {
    position: absolute;
    bottom: 20px;
    right: 20px;
    border-radius: 16px;
  }
`,Mm=Le.div`
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 10px;
  margin-top: 20px;
  max-width: 702px;
  width: 100%;
`,Dm=Le.div`
  background: ${pe.BG1};
  color: ${pe.white};
  padding: 15px 12px;
  border-radius: 8px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: flex-start;
  text-align: left;
  font-family: Barlow;
  font-size: 14px;
  font-weight: 400;
  gap: 10px;
  &:hover {
    background: ${pe.SEEDQUESTION_HOVER};
  }

  &:active {
    background: ${pe.SEEDQUESTION};
  }
  svg {
    width: 20px;
    height: 20px;
  }

  path {
    fill: ${pe.modalWhiteOverlayBg};
  }
`,Pi=new X(0,0,0),xl=100,Rm=600,Pm=2e3,aa={x:172.7392402058252,y:-239.04675366094037,z:-2e3},Pu="14.8.49",Tl=(n,e,t)=>({endTime:e,insertTime:t,type:"exponentialRampToValue",value:n}),wl=(n,e,t)=>({endTime:e,insertTime:t,type:"linearRampToValue",value:n}),ka=(n,e)=>({startTime:e,type:"setValue",value:n}),Iu=(n,e,t)=>({duration:t,startTime:e,type:"setValueCurve",values:n}),Nu=(n,e,{startTime:t,target:s,timeConstant:i})=>s+(e-s)*Math.exp((t-n)/i),Fn=n=>n.type==="exponentialRampToValue",Qr=n=>n.type==="linearRampToValue",Ms=n=>Fn(n)||Qr(n),nc=n=>n.type==="setValue",cs=n=>n.type==="setValueCurve",Kr=(n,e,t,s)=>{const i=n[e];return i===void 0?s:Ms(i)||nc(i)?i.value:cs(i)?i.values[i.values.length-1]:Nu(t,Kr(n,e-1,i.startTime,s),i)},kl=(n,e,t,s,i)=>t===void 0?[s.insertTime,i]:Ms(t)?[t.endTime,t.value]:nc(t)?[t.startTime,t.value]:cs(t)?[t.startTime+t.duration,t.values[t.values.length-1]]:[t.startTime,Kr(n,e-1,t.startTime,i)],Sa=n=>n.type==="cancelAndHold",Ca=n=>n.type==="cancelScheduledValues",Os=n=>Sa(n)||Ca(n)?n.cancelTime:Fn(n)||Qr(n)?n.endTime:n.startTime,Sl=(n,e,t,{endTime:s,value:i})=>t===i?i:0<t&&0<i||t<0&&i<0?t*(i/t)**((n-e)/(s-e)):0,Cl=(n,e,t,{endTime:s,value:i})=>t+(n-e)/(s-e)*(i-t),Im=(n,e)=>{const t=Math.floor(e),s=Math.ceil(e);return t===s?n[t]:(1-(e-t))*n[t]+(1-(s-e))*n[s]},Nm=(n,{duration:e,startTime:t,values:s})=>{const i=(n-t)/e*(s.length-1);return Im(s,i)},Fr=n=>n.type==="setTarget";class Fm{constructor(e){this._automationEvents=[],this._currenTime=0,this._defaultValue=e}[Symbol.iterator](){return this._automationEvents[Symbol.iterator]()}add(e){const t=Os(e);if(Sa(e)||Ca(e)){const s=this._automationEvents.findIndex(r=>Ca(e)&&cs(r)?r.startTime+r.duration>=t:Os(r)>=t),i=this._automationEvents[s];if(s!==-1&&(this._automationEvents=this._automationEvents.slice(0,s)),Sa(e)){const r=this._automationEvents[this._automationEvents.length-1];if(i!==void 0&&Ms(i)){if(r!==void 0&&Fr(r))throw new Error("The internal list is malformed.");const o=r===void 0?i.insertTime:cs(r)?r.startTime+r.duration:Os(r),a=r===void 0?this._defaultValue:cs(r)?r.values[r.values.length-1]:r.value,c=Fn(i)?Sl(t,o,a,i):Cl(t,o,a,i),l=Fn(i)?Tl(c,t,this._currenTime):wl(c,t,this._currenTime);this._automationEvents.push(l)}if(r!==void 0&&Fr(r)&&this._automationEvents.push(ka(this.getValue(t),t)),r!==void 0&&cs(r)&&r.startTime+r.duration>t){const o=t-r.startTime,a=(r.values.length-1)/r.duration,c=Math.max(2,1+Math.ceil(o*a)),l=o/(c-1)*a,u=r.values.slice(0,c);if(l<1)for(let h=1;h<c;h+=1){const f=l*h%1;u[h]=r.values[h-1]*(1-f)+r.values[h]*f}this._automationEvents[this._automationEvents.length-1]=Iu(u,r.startTime,o)}}}else{const s=this._automationEvents.findIndex(o=>Os(o)>t),i=s===-1?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[s-1];if(i!==void 0&&cs(i)&&Os(i)+i.duration>t)return!1;const r=Fn(e)?Tl(e.value,e.endTime,this._currenTime):Qr(e)?wl(e.value,t,this._currenTime):e;if(s===-1)this._automationEvents.push(r);else{if(cs(e)&&t+e.duration>Os(this._automationEvents[s]))return!1;this._automationEvents.splice(s,0,r)}}return!0}flush(e){const t=this._automationEvents.findIndex(s=>Os(s)>e);if(t>1){const s=this._automationEvents.slice(t-1),i=s[0];Fr(i)&&s.unshift(ka(Kr(this._automationEvents,t-2,i.startTime,this._defaultValue),i.startTime)),this._automationEvents=s}}getValue(e){if(this._automationEvents.length===0)return this._defaultValue;const t=this._automationEvents.findIndex(o=>Os(o)>e),s=this._automationEvents[t],i=(t===-1?this._automationEvents.length:t)-1,r=this._automationEvents[i];if(r!==void 0&&Fr(r)&&(s===void 0||!Ms(s)||s.insertTime>e))return Nu(e,Kr(this._automationEvents,i-1,r.startTime,this._defaultValue),r);if(r!==void 0&&nc(r)&&(s===void 0||!Ms(s)))return r.value;if(r!==void 0&&cs(r)&&(s===void 0||!Ms(s)||r.startTime+r.duration>e))return e<r.startTime+r.duration?Nm(e,r):r.values[r.values.length-1];if(r!==void 0&&Ms(r)&&(s===void 0||!Ms(s)))return r.value;if(s!==void 0&&Fn(s)){const[o,a]=kl(this._automationEvents,i,r,s,this._defaultValue);return Sl(e,o,a,s)}if(s!==void 0&&Qr(s)){const[o,a]=kl(this._automationEvents,i,r,s,this._defaultValue);return Cl(e,o,a,s)}return this._defaultValue}}const Um=n=>({cancelTime:n,type:"cancelAndHold"}),Lm=n=>({cancelTime:n,type:"cancelScheduledValues"}),Bm=(n,e)=>({endTime:e,type:"exponentialRampToValue",value:n}),zm=(n,e)=>({endTime:e,type:"linearRampToValue",value:n}),Vm=(n,e,t)=>({startTime:e,target:n,timeConstant:t,type:"setTarget"}),jm=()=>new DOMException("","AbortError"),Hm=n=>(e,t,[s,i,r],o)=>{n(e[i],[t,s,r],a=>a[0]===t&&a[1]===s,o)},qm=n=>(e,t,s)=>{const i=[];for(let r=0;r<s.numberOfInputs;r+=1)i.push(new Set);n.set(e,{activeInputs:i,outputs:new Set,passiveInputs:new WeakMap,renderer:t})},Wm=n=>(e,t)=>{n.set(e,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:t})},Zn=new WeakSet,Fu=new WeakMap,ic=new WeakMap,Uu=new WeakMap,rc=new WeakMap,Ro=new WeakMap,Lu=new WeakMap,ba=new WeakMap,Ea=new WeakMap,Oa=new WeakMap,Bu={construct(){return Bu}},Gm=n=>{try{const e=new Proxy(n,Bu);new e}catch{return!1}return!0},bl=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,El=(n,e)=>{const t=[];let s=n.replace(/^[\s]+/,""),i=s.match(bl);for(;i!==null;){const r=i[1].slice(1,-1),o=i[0].replace(/([\s]+)?;?$/,"").replace(r,new URL(r,e).toString());t.push(o),s=s.slice(i[0].length).replace(/^[\s]+/,""),i=s.match(bl)}return[t.join(";"),s]},Ol=n=>{if(n!==void 0&&!Array.isArray(n))throw new TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},Al=n=>{if(!Gm(n))throw new TypeError("The given value for processorCtor should be a constructor.");if(n.prototype===null||typeof n.prototype!="object")throw new TypeError("The given value for processorCtor should have a prototype.")},Ym=(n,e,t,s,i,r,o,a,c,l,u,h,f)=>{let d=0;return(m,p,_={credentials:"omit"})=>{const v=u.get(m);if(v!==void 0&&v.has(p))return Promise.resolve();const T=l.get(m);if(T!==void 0){const g=T.get(p);if(g!==void 0)return g}const S=r(m),y=S.audioWorklet===void 0?i(p).then(([g,w])=>{const[k,x]=El(g,w),C=`${k};((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{${x}
})})(window,'_AWGS')`;return t(C)}).then(()=>{const g=f._AWGS.pop();if(g===void 0)throw new SyntaxError;s(S.currentTime,S.sampleRate,()=>g(class{},void 0,(w,k)=>{if(w.trim()==="")throw e();const x=Ea.get(S);if(x!==void 0){if(x.has(w))throw e();Al(k),Ol(k.parameterDescriptors),x.set(w,k)}else Al(k),Ol(k.parameterDescriptors),Ea.set(S,new Map([[w,k]]))},S.sampleRate,void 0,void 0))}):Promise.all([i(p),Promise.resolve(n(h,h))]).then(([[g,w],k])=>{const x=d+1;d=x;const[C,b]=El(g,w),P=`${C};((AudioWorkletProcessor,registerProcessor)=>{${b}
})(${k?"AudioWorkletProcessor":"class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}"},(n,p)=>registerProcessor(n,class extends p{${k?"":"__c = (a) => a.forEach(e=>this.__b.add(e.buffer));"}process(i,o,p){${k?"":"i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));"}return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}));registerProcessor('__sac${x}',class extends AudioWorkletProcessor{process(){return !1}})`,F=new Blob([P],{type:"application/javascript; charset=utf-8"}),N=URL.createObjectURL(F);return S.audioWorklet.addModule(N,_).then(()=>{if(a(S))return S;const U=o(S);return U.audioWorklet.addModule(N,_).then(()=>U)}).then(U=>{if(c===null)throw new SyntaxError;try{new c(U,`__sac${x}`)}catch{throw new SyntaxError}}).finally(()=>URL.revokeObjectURL(N))});return T===void 0?l.set(m,new Map([[p,y]])):T.set(p,y),y.then(()=>{const g=u.get(m);g===void 0?u.set(m,new Set([p])):g.add(p)}).finally(()=>{const g=l.get(m);g!==void 0&&g.delete(p)}),y}},Bt=(n,e)=>{const t=n.get(e);if(t===void 0)throw new Error("A value with the given key could not be found.");return t},Po=(n,e)=>{const t=Array.from(n).filter(e);if(t.length>1)throw Error("More than one element was found.");if(t.length===0)throw Error("No element was found.");const[s]=t;return n.delete(s),s},zu=(n,e,t,s)=>{const i=Bt(n,e),r=Po(i,o=>o[0]===t&&o[1]===s);return i.size===0&&n.delete(e),r},mr=n=>Bt(Lu,n),$n=n=>{if(Zn.has(n))throw new Error("The AudioNode is already stored.");Zn.add(n),mr(n).forEach(e=>e(!0))},Vu=n=>"port"in n,_r=n=>{if(!Zn.has(n))throw new Error("The AudioNode is not stored.");Zn.delete(n),mr(n).forEach(e=>e(!1))},Aa=(n,e)=>{!Vu(n)&&e.every(t=>t.size===0)&&_r(n)},Zm=(n,e,t,s,i,r,o,a,c,l,u,h,f)=>{const d=new WeakMap;return(m,p,_,v,T)=>{const{activeInputs:S,passiveInputs:y}=r(p),{outputs:g}=r(m),w=a(m),k=x=>{const C=c(p),b=c(m);if(x){const O=zu(y,m,_,v);n(S,m,O,!1),!T&&!h(m)&&t(b,C,_,v),f(p)&&$n(p)}else{const O=s(S,m,_,v);e(y,v,O,!1),!T&&!h(m)&&i(b,C,_,v);const A=o(p);if(A===0)u(p)&&Aa(p,S);else{const R=d.get(p);R!==void 0&&clearTimeout(R),d.set(p,setTimeout(()=>{u(p)&&Aa(p,S)},A*1e3))}}};return l(g,[p,_,v],x=>x[0]===p&&x[1]===_&&x[2]===v,!0)?(w.add(k),u(m)?n(S,m,[_,v,k],!0):e(y,v,[m,_,k],!0),!0):!1}},$m=n=>(e,t,[s,i,r],o)=>{const a=e.get(s);a===void 0?e.set(s,new Set([[i,t,r]])):n(a,[i,t,r],c=>c[0]===i&&c[1]===t,o)},Xm=n=>(e,t)=>{const s=n(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});t.connect(s).connect(e.destination);const i=()=>{t.removeEventListener("ended",i),t.disconnect(s),s.disconnect()};t.addEventListener("ended",i)},Qm=n=>(e,t)=>{n(e).add(t)},Km={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",fftSize:2048,maxDecibels:-30,minDecibels:-100,smoothingTimeConstant:.8},Jm=(n,e,t,s,i,r)=>class extends n{constructor(a,c){const l=i(a),u={...Km,...c},h=s(l,u),f=r(l)?e():null;super(a,!1,h,f),this._nativeAnalyserNode=h}get fftSize(){return this._nativeAnalyserNode.fftSize}set fftSize(a){this._nativeAnalyserNode.fftSize=a}get frequencyBinCount(){return this._nativeAnalyserNode.frequencyBinCount}get maxDecibels(){return this._nativeAnalyserNode.maxDecibels}set maxDecibels(a){const c=this._nativeAnalyserNode.maxDecibels;if(this._nativeAnalyserNode.maxDecibels=a,!(a>this._nativeAnalyserNode.minDecibels))throw this._nativeAnalyserNode.maxDecibels=c,t()}get minDecibels(){return this._nativeAnalyserNode.minDecibels}set minDecibels(a){const c=this._nativeAnalyserNode.minDecibels;if(this._nativeAnalyserNode.minDecibels=a,!(this._nativeAnalyserNode.maxDecibels>a))throw this._nativeAnalyserNode.minDecibels=c,t()}get smoothingTimeConstant(){return this._nativeAnalyserNode.smoothingTimeConstant}set smoothingTimeConstant(a){this._nativeAnalyserNode.smoothingTimeConstant=a}getByteFrequencyData(a){this._nativeAnalyserNode.getByteFrequencyData(a)}getByteTimeDomainData(a){this._nativeAnalyserNode.getByteTimeDomainData(a)}getFloatFrequencyData(a){this._nativeAnalyserNode.getFloatFrequencyData(a)}getFloatTimeDomainData(a){this._nativeAnalyserNode.getFloatTimeDomainData(a)}},Je=(n,e)=>n.context===e,e_=(n,e,t)=>()=>{const s=new WeakMap,i=async(r,o)=>{let a=e(r);if(!Je(a,o)){const l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,fftSize:a.fftSize,maxDecibels:a.maxDecibels,minDecibels:a.minDecibels,smoothingTimeConstant:a.smoothingTimeConstant};a=n(o,l)}return s.set(o,a),await t(r,o,a),a};return{render(r,o){const a=s.get(o);return a!==void 0?Promise.resolve(a):i(r,o)}}},Jr=n=>{try{n.copyToChannel(new Float32Array(1),0,-1)}catch{return!1}return!0},ts=()=>new DOMException("","IndexSizeError"),oc=n=>{n.getChannelData=(e=>t=>{try{return e.call(n,t)}catch(s){throw s.code===12?ts():s}})(n.getChannelData)},t_={numberOfChannels:1},s_=(n,e,t,s,i,r,o,a)=>{let c=null;return class ju{constructor(u){if(i===null)throw new Error("Missing the native OfflineAudioContext constructor.");const{length:h,numberOfChannels:f,sampleRate:d}={...t_,...u};c===null&&(c=new i(1,1,44100));const m=s!==null&&e(r,r)?new s({length:h,numberOfChannels:f,sampleRate:d}):c.createBuffer(f,h,d);if(m.numberOfChannels===0)throw t();return typeof m.copyFromChannel!="function"?(o(m),oc(m)):e(Jr,()=>Jr(m))||a(m),n.add(m),m}static[Symbol.hasInstance](u){return u!==null&&typeof u=="object"&&Object.getPrototypeOf(u)===ju.prototype||n.has(u)}}},at=-34028234663852886e22,et=-at,fs=n=>Zn.has(n),n_={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},i_=(n,e,t,s,i,r,o,a)=>class extends n{constructor(l,u){const h=r(l),f={...n_,...u},d=i(h,f),m=o(h),p=m?e():null;super(l,!1,d,p),this._audioBufferSourceNodeRenderer=p,this._isBufferNullified=!1,this._isBufferSet=f.buffer!==null,this._nativeAudioBufferSourceNode=d,this._onended=null,this._playbackRate=t(this,m,d.playbackRate,et,at)}get buffer(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer}set buffer(l){if(this._nativeAudioBufferSourceNode.buffer=l,l!==null){if(this._isBufferSet)throw s();this._isBufferSet=!0}}get loop(){return this._nativeAudioBufferSourceNode.loop}set loop(l){this._nativeAudioBufferSourceNode.loop=l}get loopEnd(){return this._nativeAudioBufferSourceNode.loopEnd}set loopEnd(l){this._nativeAudioBufferSourceNode.loopEnd=l}get loopStart(){return this._nativeAudioBufferSourceNode.loopStart}set loopStart(l){this._nativeAudioBufferSourceNode.loopStart=l}get onended(){return this._onended}set onended(l){const u=typeof l=="function"?a(this,l):null;this._nativeAudioBufferSourceNode.onended=u;const h=this._nativeAudioBufferSourceNode.onended;this._onended=h!==null&&h===u?l:h}get playbackRate(){return this._playbackRate}start(l=0,u=0,h){if(this._nativeAudioBufferSourceNode.start(l,u,h),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.start=h===void 0?[l,u]:[l,u,h]),this.context.state!=="closed"){$n(this);const f=()=>{this._nativeAudioBufferSourceNode.removeEventListener("ended",f),fs(this)&&_r(this)};this._nativeAudioBufferSourceNode.addEventListener("ended",f)}}stop(l=0){this._nativeAudioBufferSourceNode.stop(l),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.stop=l)}},r_=(n,e,t,s,i)=>()=>{const r=new WeakMap;let o=null,a=null;const c=async(l,u)=>{let h=t(l);const f=Je(h,u);if(!f){const d={buffer:h.buffer,channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,loop:h.loop,loopEnd:h.loopEnd,loopStart:h.loopStart,playbackRate:h.playbackRate.value};h=e(u,d),o!==null&&h.start(...o),a!==null&&h.stop(a)}return r.set(u,h),f?await n(u,l.playbackRate,h.playbackRate):await s(u,l.playbackRate,h.playbackRate),await i(l,u,h),h};return{set start(l){o=l},set stop(l){a=l},render(l,u){const h=r.get(u);return h!==void 0?Promise.resolve(h):c(l,u)}}},o_=n=>"playbackRate"in n,a_=n=>"frequency"in n&&"gain"in n,c_=n=>"offset"in n,l_=n=>!("frequency"in n)&&"gain"in n,u_=n=>"detune"in n&&"frequency"in n,h_=n=>"pan"in n,st=n=>Bt(Fu,n),gr=n=>Bt(Uu,n),Ma=(n,e)=>{const{activeInputs:t}=st(n);t.forEach(i=>i.forEach(([r])=>{e.includes(n)||Ma(r,[...e,n])}));const s=o_(n)?[n.playbackRate]:Vu(n)?Array.from(n.parameters.values()):a_(n)?[n.Q,n.detune,n.frequency,n.gain]:c_(n)?[n.offset]:l_(n)?[n.gain]:u_(n)?[n.detune,n.frequency]:h_(n)?[n.pan]:[];for(const i of s){const r=gr(i);r!==void 0&&r.activeInputs.forEach(([o])=>Ma(o,e))}fs(n)&&_r(n)},Hu=n=>{Ma(n.destination,[])},d_=n=>n===void 0||typeof n=="number"||typeof n=="string"&&(n==="balanced"||n==="interactive"||n==="playback"),f_=(n,e,t,s,i,r,o,a,c)=>class extends n{constructor(u={}){if(c===null)throw new Error("Missing the native AudioContext constructor.");let h;try{h=new c(u)}catch(m){throw m.code===12&&m.message==="sampleRate is not in range"?t():m}if(h===null)throw s();if(!d_(u.latencyHint))throw new TypeError(`The provided value '${u.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(u.sampleRate!==void 0&&h.sampleRate!==u.sampleRate)throw t();super(h,2);const{latencyHint:f}=u,{sampleRate:d}=h;if(this._baseLatency=typeof h.baseLatency=="number"?h.baseLatency:f==="balanced"?512/d:f==="interactive"||f===void 0?256/d:f==="playback"?1024/d:Math.max(2,Math.min(128,Math.round(f*d/128)))*128/d,this._nativeAudioContext=h,c.name==="webkitAudioContext"?(this._nativeGainNode=h.createGain(),this._nativeOscillatorNode=h.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(h.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,h.state==="running"){this._state="suspended";const m=()=>{this._state==="suspended"&&(this._state=null),h.removeEventListener("statechange",m)};h.addEventListener("statechange",m)}}get baseLatency(){return this._baseLatency}get state(){return this._state!==null?this._state:this._nativeAudioContext.state}close(){return this.state==="closed"?this._nativeAudioContext.close().then(()=>{throw e()}):(this._state==="suspended"&&(this._state=null),this._nativeAudioContext.close().then(()=>{this._nativeGainNode!==null&&this._nativeOscillatorNode!==null&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),Hu(this)}))}createMediaElementSource(u){return new i(this,{mediaElement:u})}createMediaStreamDestination(){return new r(this)}createMediaStreamSource(u){return new o(this,{mediaStream:u})}createMediaStreamTrackSource(u){return new a(this,{mediaStreamTrack:u})}resume(){return this._state==="suspended"?new Promise((u,h)=>{const f=()=>{this._nativeAudioContext.removeEventListener("statechange",f),this._nativeAudioContext.state==="running"?u():this.resume().then(u,h)};this._nativeAudioContext.addEventListener("statechange",f)}):this._nativeAudioContext.resume().catch(u=>{throw u===void 0||u.code===15?e():u})}suspend(){return this._nativeAudioContext.suspend().catch(u=>{throw u===void 0?e():u})}},p_=(n,e,t,s,i,r,o,a)=>class extends n{constructor(l,u){const h=r(l),f=o(h),d=i(h,u,f),m=f?e(a):null;super(l,!1,d,m),this._isNodeOfNativeOfflineAudioContext=f,this._nativeAudioDestinationNode=d}get channelCount(){return this._nativeAudioDestinationNode.channelCount}set channelCount(l){if(this._isNodeOfNativeOfflineAudioContext)throw s();if(l>this._nativeAudioDestinationNode.maxChannelCount)throw t();this._nativeAudioDestinationNode.channelCount=l}get channelCountMode(){return this._nativeAudioDestinationNode.channelCountMode}set channelCountMode(l){if(this._isNodeOfNativeOfflineAudioContext)throw s();this._nativeAudioDestinationNode.channelCountMode=l}get maxChannelCount(){return this._nativeAudioDestinationNode.maxChannelCount}},m_=n=>{const e=new WeakMap,t=async(s,i)=>{const r=i.destination;return e.set(i,r),await n(s,i,r),r};return{render(s,i){const r=e.get(i);return r!==void 0?Promise.resolve(r):t(s,i)}}},__=(n,e,t,s,i,r,o,a)=>(c,l)=>{const u=l.listener,h=()=>{const g=new Float32Array(1),w=e(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),k=o(l);let x=!1,C=[0,0,-1,0,1,0],b=[0,0,0];const O=()=>{if(x)return;x=!0;const F=s(l,256,9,0);F.onaudioprocess=({inputBuffer:N})=>{const U=[r(N,g,0),r(N,g,1),r(N,g,2),r(N,g,3),r(N,g,4),r(N,g,5)];U.some((z,q)=>z!==C[q])&&(u.setOrientation(...U),C=U);const V=[r(N,g,6),r(N,g,7),r(N,g,8)];V.some((z,q)=>z!==b[q])&&(u.setPosition(...V),b=V)},w.connect(F)},A=F=>N=>{N!==C[F]&&(C[F]=N,u.setOrientation(...C))},R=F=>N=>{N!==b[F]&&(b[F]=N,u.setPosition(...b))},P=(F,N,U)=>{const V=t(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:N});V.connect(w,0,F),V.start(),Object.defineProperty(V.offset,"defaultValue",{get(){return N}});const z=n({context:c},k,V.offset,et,at);return a(z,"value",q=>()=>q.call(z),q=>j=>{try{q.call(z,j)}catch(B){if(B.code!==9)throw B}O(),k&&U(j)}),z.cancelAndHoldAtTime=(q=>k?()=>{throw i()}:(...j)=>{const B=q.apply(z,j);return O(),B})(z.cancelAndHoldAtTime),z.cancelScheduledValues=(q=>k?()=>{throw i()}:(...j)=>{const B=q.apply(z,j);return O(),B})(z.cancelScheduledValues),z.exponentialRampToValueAtTime=(q=>k?()=>{throw i()}:(...j)=>{const B=q.apply(z,j);return O(),B})(z.exponentialRampToValueAtTime),z.linearRampToValueAtTime=(q=>k?()=>{throw i()}:(...j)=>{const B=q.apply(z,j);return O(),B})(z.linearRampToValueAtTime),z.setTargetAtTime=(q=>k?()=>{throw i()}:(...j)=>{const B=q.apply(z,j);return O(),B})(z.setTargetAtTime),z.setValueAtTime=(q=>k?()=>{throw i()}:(...j)=>{const B=q.apply(z,j);return O(),B})(z.setValueAtTime),z.setValueCurveAtTime=(q=>k?()=>{throw i()}:(...j)=>{const B=q.apply(z,j);return O(),B})(z.setValueCurveAtTime),z};return{forwardX:P(0,0,A(0)),forwardY:P(1,0,A(1)),forwardZ:P(2,-1,A(2)),positionX:P(6,0,R(0)),positionY:P(7,0,R(1)),positionZ:P(8,0,R(2)),upX:P(3,0,A(3)),upY:P(4,1,A(4)),upZ:P(5,0,A(5))}},{forwardX:f,forwardY:d,forwardZ:m,positionX:p,positionY:_,positionZ:v,upX:T,upY:S,upZ:y}=u.forwardX===void 0?h():u;return{get forwardX(){return f},get forwardY(){return d},get forwardZ(){return m},get positionX(){return p},get positionY(){return _},get positionZ(){return v},get upX(){return T},get upY(){return S},get upZ(){return y}}},eo=n=>"context"in n,vr=n=>eo(n[0]),Tn=(n,e,t,s)=>{for(const i of n)if(t(i)){if(s)return!1;throw Error("The set contains at least one similar element.")}return n.add(e),!0},Ml=(n,e,[t,s],i)=>{Tn(n,[e,t,s],r=>r[0]===e&&r[1]===t,i)},Dl=(n,[e,t,s],i)=>{const r=n.get(e);r===void 0?n.set(e,new Set([[t,s]])):Tn(r,[t,s],o=>o[0]===t,i)},ai=n=>"inputs"in n,to=(n,e,t,s)=>{if(ai(e)){const i=e.inputs[s];return n.connect(i,t,0),[i,t,0]}return n.connect(e,t,s),[e,t,s]},qu=(n,e,t)=>{for(const s of n)if(s[0]===e&&s[1]===t)return n.delete(s),s;return null},g_=(n,e,t)=>Po(n,s=>s[0]===e&&s[1]===t),Wu=(n,e)=>{if(!mr(n).delete(e))throw new Error("Missing the expected event listener.")},Gu=(n,e,t)=>{const s=Bt(n,e),i=Po(s,r=>r[0]===t);return s.size===0&&n.delete(e),i},so=(n,e,t,s)=>{ai(e)?n.disconnect(e.inputs[s],t,0):n.disconnect(e,t,s)},ke=n=>Bt(ic,n),Bi=n=>Bt(rc,n),fn=n=>ba.has(n),qr=n=>!Zn.has(n),Rl=(n,e)=>new Promise(t=>{if(e!==null)t(!0);else{const s=n.createScriptProcessor(256,1,1),i=n.createGain(),r=n.createBuffer(1,2,44100),o=r.getChannelData(0);o[0]=1,o[1]=1;const a=n.createBufferSource();a.buffer=r,a.loop=!0,a.connect(s).connect(n.destination),a.connect(i),a.disconnect(i),s.onaudioprocess=c=>{const l=c.inputBuffer.getChannelData(0);Array.prototype.some.call(l,u=>u===1)?t(!0):t(!1),a.stop(),s.onaudioprocess=null,a.disconnect(s),s.disconnect(n.destination)},a.start()}}),ca=(n,e)=>{const t=new Map;for(const s of n)for(const i of s){const r=t.get(i);t.set(i,r===void 0?1:r+1)}t.forEach((s,i)=>e(i,s))},no=n=>"context"in n,v_=n=>{const e=new Map;n.connect=(t=>(s,i=0,r=0)=>{const o=no(s)?t(s,i,r):t(s,i),a=e.get(s);return a===void 0?e.set(s,[{input:r,output:i}]):a.every(c=>c.input!==r||c.output!==i)&&a.push({input:r,output:i}),o})(n.connect.bind(n)),n.disconnect=(t=>(s,i,r)=>{if(t.apply(n),s===void 0)e.clear();else if(typeof s=="number")for(const[o,a]of e){const c=a.filter(l=>l.output!==s);c.length===0?e.delete(o):e.set(o,c)}else if(e.has(s))if(i===void 0)e.delete(s);else{const o=e.get(s);if(o!==void 0){const a=o.filter(c=>c.output!==i&&(c.input!==r||r===void 0));a.length===0?e.delete(s):e.set(s,a)}}for(const[o,a]of e)a.forEach(c=>{no(o)?n.connect(o,c.output,c.input):n.connect(o,c.output)})})(n.disconnect)},y_=(n,e,t,s)=>{const{activeInputs:i,passiveInputs:r}=gr(e),{outputs:o}=st(n),a=mr(n),c=l=>{const u=ke(n),h=Bi(e);if(l){const f=Gu(r,n,t);Ml(i,n,f,!1),!s&&!fn(n)&&u.connect(h,t)}else{const f=g_(i,n,t);Dl(r,f,!1),!s&&!fn(n)&&u.disconnect(h,t)}};return Tn(o,[e,t],l=>l[0]===e&&l[1]===t,!0)?(a.add(c),fs(n)?Ml(i,n,[t,c],!0):Dl(r,[n,t,c],!0),!0):!1},x_=(n,e,t,s)=>{const{activeInputs:i,passiveInputs:r}=st(e),o=qu(i[s],n,t);return o===null?[zu(r,n,t,s)[2],!1]:[o[2],!0]},T_=(n,e,t)=>{const{activeInputs:s,passiveInputs:i}=gr(e),r=qu(s,n,t);return r===null?[Gu(i,n,t)[1],!1]:[r[2],!0]},ac=(n,e,t,s,i)=>{const[r,o]=x_(n,t,s,i);if(r!==null&&(Wu(n,r),o&&!e&&!fn(n)&&so(ke(n),ke(t),s,i)),fs(t)){const{activeInputs:a}=st(t);Aa(t,a)}},cc=(n,e,t,s)=>{const[i,r]=T_(n,t,s);i!==null&&(Wu(n,i),r&&!e&&!fn(n)&&ke(n).disconnect(Bi(t),s))},w_=(n,e)=>{const t=st(n),s=[];for(const i of t.outputs)vr(i)?ac(n,e,...i):cc(n,e,...i),s.push(i[0]);return t.outputs.clear(),s},k_=(n,e,t)=>{const s=st(n),i=[];for(const r of s.outputs)r[1]===t&&(vr(r)?ac(n,e,...r):cc(n,e,...r),i.push(r[0]),s.outputs.delete(r));return i},S_=(n,e,t,s,i)=>{const r=st(n);return Array.from(r.outputs).filter(o=>o[0]===t&&(s===void 0||o[1]===s)&&(i===void 0||o[2]===i)).map(o=>(vr(o)?ac(n,e,...o):cc(n,e,...o),r.outputs.delete(o),o[0]))},C_=(n,e,t,s,i,r,o,a,c,l,u,h,f,d,m,p)=>class extends l{constructor(v,T,S,y){super(S),this._context=v,this._nativeAudioNode=S;const g=u(v);h(g)&&t(Rl,()=>Rl(g,p))!==!0&&v_(S),ic.set(this,S),Lu.set(this,new Set),v.state!=="closed"&&T&&$n(this),n(this,y,S)}get channelCount(){return this._nativeAudioNode.channelCount}set channelCount(v){this._nativeAudioNode.channelCount=v}get channelCountMode(){return this._nativeAudioNode.channelCountMode}set channelCountMode(v){this._nativeAudioNode.channelCountMode=v}get channelInterpretation(){return this._nativeAudioNode.channelInterpretation}set channelInterpretation(v){this._nativeAudioNode.channelInterpretation=v}get context(){return this._context}get numberOfInputs(){return this._nativeAudioNode.numberOfInputs}get numberOfOutputs(){return this._nativeAudioNode.numberOfOutputs}connect(v,T=0,S=0){if(T<0||T>=this._nativeAudioNode.numberOfOutputs)throw i();const y=u(this._context),g=m(y);if(f(v)||d(v))throw r();if(eo(v)){const x=ke(v);try{const b=to(this._nativeAudioNode,x,T,S),O=qr(this);(g||O)&&this._nativeAudioNode.disconnect(...b),this.context.state!=="closed"&&!O&&qr(v)&&$n(v)}catch(b){throw b.code===12?r():b}if(e(this,v,T,S,g)){const b=c([this],v);ca(b,s(g))}return v}const w=Bi(v);if(w.name==="playbackRate"&&w.maxValue===1024)throw o();try{this._nativeAudioNode.connect(w,T),(g||qr(this))&&this._nativeAudioNode.disconnect(w,T)}catch(x){throw x.code===12?r():x}if(y_(this,v,T,g)){const x=c([this],v);ca(x,s(g))}}disconnect(v,T,S){let y;const g=u(this._context),w=m(g);if(v===void 0)y=w_(this,w);else if(typeof v=="number"){if(v<0||v>=this.numberOfOutputs)throw i();y=k_(this,w,v)}else{if(T!==void 0&&(T<0||T>=this.numberOfOutputs)||eo(v)&&S!==void 0&&(S<0||S>=v.numberOfInputs))throw i();if(y=S_(this,w,v,T,S),y.length===0)throw r()}for(const k of y){const x=c([this],k);ca(x,a)}}},b_=(n,e,t,s,i,r,o,a,c,l,u,h,f)=>(d,m,p,_=null,v=null)=>{const T=p.value,S=new Fm(T),y=m?s(S):null,g={get defaultValue(){return T},get maxValue(){return _===null?p.maxValue:_},get minValue(){return v===null?p.minValue:v},get value(){return p.value},set value(w){p.value=w,g.setValueAtTime(w,d.context.currentTime)},cancelAndHoldAtTime(w){if(typeof p.cancelAndHoldAtTime=="function")y===null&&S.flush(d.context.currentTime),S.add(i(w)),p.cancelAndHoldAtTime(w);else{const k=Array.from(S).pop();y===null&&S.flush(d.context.currentTime),S.add(i(w));const x=Array.from(S).pop();p.cancelScheduledValues(w),k!==x&&x!==void 0&&(x.type==="exponentialRampToValue"?p.exponentialRampToValueAtTime(x.value,x.endTime):x.type==="linearRampToValue"?p.linearRampToValueAtTime(x.value,x.endTime):x.type==="setValue"?p.setValueAtTime(x.value,x.startTime):x.type==="setValueCurve"&&p.setValueCurveAtTime(x.values,x.startTime,x.duration))}return g},cancelScheduledValues(w){return y===null&&S.flush(d.context.currentTime),S.add(r(w)),p.cancelScheduledValues(w),g},exponentialRampToValueAtTime(w,k){if(w===0)throw new RangeError;if(!Number.isFinite(k)||k<0)throw new RangeError;const x=d.context.currentTime;return y===null&&S.flush(x),Array.from(S).length===0&&(S.add(l(T,x)),p.setValueAtTime(T,x)),S.add(o(w,k)),p.exponentialRampToValueAtTime(w,k),g},linearRampToValueAtTime(w,k){const x=d.context.currentTime;return y===null&&S.flush(x),Array.from(S).length===0&&(S.add(l(T,x)),p.setValueAtTime(T,x)),S.add(a(w,k)),p.linearRampToValueAtTime(w,k),g},setTargetAtTime(w,k,x){return y===null&&S.flush(d.context.currentTime),S.add(c(w,k,x)),p.setTargetAtTime(w,k,x),g},setValueAtTime(w,k){return y===null&&S.flush(d.context.currentTime),S.add(l(w,k)),p.setValueAtTime(w,k),g},setValueCurveAtTime(w,k,x){const C=w instanceof Float32Array?w:new Float32Array(w);if(h!==null&&h.name==="webkitAudioContext"){const b=k+x,O=d.context.sampleRate,A=Math.ceil(k*O),R=Math.floor(b*O),P=R-A,F=new Float32Array(P);for(let U=0;U<P;U+=1){const V=(C.length-1)/x*((A+U)/O-k),z=Math.floor(V),q=Math.ceil(V);F[U]=z===q?C[z]:(1-(V-z))*C[z]+(1-(q-V))*C[q]}y===null&&S.flush(d.context.currentTime),S.add(u(F,k,x)),p.setValueCurveAtTime(F,k,x);const N=R/O;N<b&&f(g,F[F.length-1],N),f(g,C[C.length-1],b)}else y===null&&S.flush(d.context.currentTime),S.add(u(C,k,x)),p.setValueCurveAtTime(C,k,x);return g}};return t.set(g,p),e.set(g,d),n(g,y),g},E_=n=>({replay(e){for(const t of n)if(t.type==="exponentialRampToValue"){const{endTime:s,value:i}=t;e.exponentialRampToValueAtTime(i,s)}else if(t.type==="linearRampToValue"){const{endTime:s,value:i}=t;e.linearRampToValueAtTime(i,s)}else if(t.type==="setTarget"){const{startTime:s,target:i,timeConstant:r}=t;e.setTargetAtTime(i,s,r)}else if(t.type==="setValue"){const{startTime:s,value:i}=t;e.setValueAtTime(i,s)}else if(t.type==="setValueCurve"){const{duration:s,startTime:i,values:r}=t;e.setValueCurveAtTime(r,i,s)}else throw new Error("Can't apply an unknown automation.")}});class Yu{constructor(e){this._map=new Map(e)}get size(){return this._map.size}entries(){return this._map.entries()}forEach(e,t=null){return this._map.forEach((s,i)=>e.call(t,s,i,this))}get(e){return this._map.get(e)}has(e){return this._map.has(e)}keys(){return this._map.keys()}values(){return this._map.values()}}const O_={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,parameterData:{},processorOptions:{}},A_=(n,e,t,s,i,r,o,a,c,l,u,h,f,d)=>class extends e{constructor(p,_,v){var T;const S=a(p),y=c(S),g=u({...O_,...v});f(g);const w=Ea.get(S),k=w==null?void 0:w.get(_),x=y||S.state!=="closed"?S:(T=o(S))!==null&&T!==void 0?T:S,C=i(x,y?null:p.baseLatency,l,_,k,g),b=y?s(_,g,k):null;super(p,!0,C,b);const O=[];C.parameters.forEach((R,P)=>{const F=t(this,y,R);O.push([P,F])}),this._nativeAudioWorkletNode=C,this._onprocessorerror=null,this._parameters=new Yu(O),y&&n(S,this);const{activeInputs:A}=r(this);h(C,A)}get onprocessorerror(){return this._onprocessorerror}set onprocessorerror(p){const _=typeof p=="function"?d(this,p):null;this._nativeAudioWorkletNode.onprocessorerror=_;const v=this._nativeAudioWorkletNode.onprocessorerror;this._onprocessorerror=v!==null&&v===_?p:v}get parameters(){return this._parameters===null?this._nativeAudioWorkletNode.parameters:this._parameters}get port(){return this._nativeAudioWorkletNode.port}};function io(n,e,t,s,i){if(typeof n.copyFromChannel=="function")e[t].byteLength===0&&(e[t]=new Float32Array(128)),n.copyFromChannel(e[t],s,i);else{const r=n.getChannelData(s);if(e[t].byteLength===0)e[t]=r.slice(i,i+128);else{const o=new Float32Array(r.buffer,i*Float32Array.BYTES_PER_ELEMENT,128);e[t].set(o)}}}const Zu=(n,e,t,s,i)=>{typeof n.copyToChannel=="function"?e[t].byteLength!==0&&n.copyToChannel(e[t],s,i):e[t].byteLength!==0&&n.getChannelData(s).set(e[t],i)},ro=(n,e)=>{const t=[];for(let s=0;s<n;s+=1){const i=[],r=typeof e=="number"?e:e[s];for(let o=0;o<r;o+=1)i.push(new Float32Array(128));t.push(i)}return t},M_=(n,e)=>{const t=Bt(Oa,n),s=ke(e);return Bt(t,s)},D_=async(n,e,t,s,i,r,o)=>{const a=e===null?Math.ceil(n.context.length/128)*128:e.length,c=s.channelCount*s.numberOfInputs,l=i.reduce((_,v)=>_+v,0),u=l===0?null:t.createBuffer(l,a,t.sampleRate);if(r===void 0)throw new Error("Missing the processor constructor.");const h=st(n),f=await M_(t,n),d=ro(s.numberOfInputs,s.channelCount),m=ro(s.numberOfOutputs,i),p=Array.from(n.parameters.keys()).reduce((_,v)=>({..._,[v]:new Float32Array(128)}),{});for(let _=0;_<a;_+=128){if(s.numberOfInputs>0&&e!==null)for(let v=0;v<s.numberOfInputs;v+=1)for(let T=0;T<s.channelCount;T+=1)io(e,d[v],T,T,_);r.parameterDescriptors!==void 0&&e!==null&&r.parameterDescriptors.forEach(({name:v},T)=>{io(e,p,v,c+T,_)});for(let v=0;v<s.numberOfInputs;v+=1)for(let T=0;T<i[v];T+=1)m[v][T].byteLength===0&&(m[v][T]=new Float32Array(128));try{const v=d.map((S,y)=>h.activeInputs[y].size===0?[]:S),T=o(_/t.sampleRate,t.sampleRate,()=>f.process(v,m,p));if(u!==null)for(let S=0,y=0;S<s.numberOfOutputs;S+=1){for(let g=0;g<i[S];g+=1)Zu(u,m[S],g,y+g,_);y+=i[S]}if(!T)break}catch(v){n.dispatchEvent(new ErrorEvent("processorerror",{colno:v.colno,filename:v.filename,lineno:v.lineno,message:v.message}));break}}return u},R_=(n,e,t,s,i,r,o,a,c,l,u,h,f,d,m,p)=>(_,v,T)=>{const S=new WeakMap;let y=null;const g=async(w,k)=>{let x=u(w),C=null;const b=Je(x,k),O=Array.isArray(v.outputChannelCount)?v.outputChannelCount:Array.from(v.outputChannelCount);if(h===null){const A=O.reduce((N,U)=>N+U,0),R=i(k,{channelCount:Math.max(1,A),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,A)}),P=[];for(let N=0;N<w.numberOfOutputs;N+=1)P.push(s(k,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:O[N]}));const F=o(k,{channelCount:v.channelCount,channelCountMode:v.channelCountMode,channelInterpretation:v.channelInterpretation,gain:1});F.connect=e.bind(null,P),F.disconnect=c.bind(null,P),C=[R,P,F]}else b||(x=new h(k,_));if(S.set(k,C===null?x:C[2]),C!==null){if(y===null){if(T===void 0)throw new Error("Missing the processor constructor.");if(f===null)throw new Error("Missing the native OfflineAudioContext constructor.");const U=w.channelCount*w.numberOfInputs,V=T.parameterDescriptors===void 0?0:T.parameterDescriptors.length,z=U+V;y=D_(w,z===0?null:await(async()=>{const j=new f(z,Math.ceil(w.context.length/128)*128,k.sampleRate),B=[],we=[];for(let _e=0;_e<v.numberOfInputs;_e+=1)B.push(o(j,{channelCount:v.channelCount,channelCountMode:v.channelCountMode,channelInterpretation:v.channelInterpretation,gain:1})),we.push(i(j,{channelCount:v.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:v.channelCount}));const ae=await Promise.all(Array.from(w.parameters.values()).map(async _e=>{const Ye=r(j,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:_e.value});return await d(j,_e,Ye.offset),Ye})),$=s(j,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,U+V)});for(let _e=0;_e<v.numberOfInputs;_e+=1){B[_e].connect(we[_e]);for(let Ye=0;Ye<v.channelCount;Ye+=1)we[_e].connect($,Ye,_e*v.channelCount+Ye)}for(const[_e,Ye]of ae.entries())Ye.connect($,0,U+_e),Ye.start(0);return $.connect(j.destination),await Promise.all(B.map(_e=>m(w,j,_e))),p(j)})(),k,v,O,T,l)}const A=await y,R=t(k,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),[P,F,N]=C;A!==null&&(R.buffer=A,R.start(0)),R.connect(P);for(let U=0,V=0;U<w.numberOfOutputs;U+=1){const z=F[U];for(let q=0;q<O[U];q+=1)P.connect(z,V+q,q);V+=O[U]}return N}if(b)for(const[A,R]of w.parameters.entries())await n(k,R,x.parameters.get(A));else for(const[A,R]of w.parameters.entries())await d(k,R,x.parameters.get(A));return await m(w,k,x),x};return{render(w,k){a(k,w);const x=S.get(k);return x!==void 0?Promise.resolve(x):g(w,k)}}},P_=(n,e,t,s,i,r,o,a,c,l,u,h,f,d,m,p,_,v,T,S)=>class extends m{constructor(g,w){super(g,w),this._nativeContext=g,this._audioWorklet=n===void 0?void 0:{addModule:(k,x)=>n(this,k,x)}}get audioWorklet(){return this._audioWorklet}createAnalyser(){return new e(this)}createBiquadFilter(){return new i(this)}createBuffer(g,w,k){return new t({length:w,numberOfChannels:g,sampleRate:k})}createBufferSource(){return new s(this)}createChannelMerger(g=6){return new r(this,{numberOfInputs:g})}createChannelSplitter(g=6){return new o(this,{numberOfOutputs:g})}createConstantSource(){return new a(this)}createConvolver(){return new c(this)}createDelay(g=1){return new u(this,{maxDelayTime:g})}createDynamicsCompressor(){return new h(this)}createGain(){return new f(this)}createIIRFilter(g,w){return new d(this,{feedback:w,feedforward:g})}createOscillator(){return new p(this)}createPanner(){return new _(this)}createPeriodicWave(g,w,k={disableNormalization:!1}){return new v(this,{...k,imag:w,real:g})}createStereoPanner(){return new T(this)}createWaveShaper(){return new S(this)}decodeAudioData(g,w,k){return l(this._nativeContext,g).then(x=>(typeof w=="function"&&w(x),x),x=>{throw typeof k=="function"&&k(x),x})}},I_={Q:1,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:350,gain:0,type:"lowpass"},N_=(n,e,t,s,i,r,o,a)=>class extends n{constructor(l,u){const h=r(l),f={...I_,...u},d=i(h,f),m=o(h),p=m?t():null;super(l,!1,d,p),this._Q=e(this,m,d.Q,et,at),this._detune=e(this,m,d.detune,1200*Math.log2(et),-1200*Math.log2(et)),this._frequency=e(this,m,d.frequency,l.sampleRate/2,0),this._gain=e(this,m,d.gain,40*Math.log10(et),at),this._nativeBiquadFilterNode=d,a(this,1)}get detune(){return this._detune}get frequency(){return this._frequency}get gain(){return this._gain}get Q(){return this._Q}get type(){return this._nativeBiquadFilterNode.type}set type(l){this._nativeBiquadFilterNode.type=l}getFrequencyResponse(l,u,h){try{this._nativeBiquadFilterNode.getFrequencyResponse(l,u,h)}catch(f){throw f.code===11?s():f}if(l.length!==u.length||u.length!==h.length)throw s()}},F_=(n,e,t,s,i)=>()=>{const r=new WeakMap,o=async(a,c)=>{let l=t(a);const u=Je(l,c);if(!u){const h={Q:l.Q.value,channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,detune:l.detune.value,frequency:l.frequency.value,gain:l.gain.value,type:l.type};l=e(c,h)}return r.set(c,l),u?(await n(c,a.Q,l.Q),await n(c,a.detune,l.detune),await n(c,a.frequency,l.frequency),await n(c,a.gain,l.gain)):(await s(c,a.Q,l.Q),await s(c,a.detune,l.detune),await s(c,a.frequency,l.frequency),await s(c,a.gain,l.gain)),await i(a,c,l),l};return{render(a,c){const l=r.get(c);return l!==void 0?Promise.resolve(l):o(a,c)}}},U_=(n,e)=>(t,s)=>{const i=e.get(t);if(i!==void 0)return i;const r=n.get(t);if(r!==void 0)return r;try{const o=s();return o instanceof Promise?(n.set(t,o),o.catch(()=>!1).then(a=>(n.delete(t),e.set(t,a),a))):(e.set(t,o),o)}catch{return e.set(t,!1),!1}},L_={channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6},B_=(n,e,t,s,i)=>class extends n{constructor(o,a){const c=s(o),l={...L_,...a},u=t(c,l),h=i(c)?e():null;super(o,!1,u,h)}},z_=(n,e,t)=>()=>{const s=new WeakMap,i=async(r,o)=>{let a=e(r);if(!Je(a,o)){const l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,numberOfInputs:a.numberOfInputs};a=n(o,l)}return s.set(o,a),await t(r,o,a),a};return{render(r,o){const a=s.get(o);return a!==void 0?Promise.resolve(a):i(r,o)}}},V_={channelCount:6,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:6},j_=(n,e,t,s,i,r)=>class extends n{constructor(a,c){const l=s(a),u=r({...V_,...c}),h=t(l,u),f=i(l)?e():null;super(a,!1,h,f)}},H_=(n,e,t)=>()=>{const s=new WeakMap,i=async(r,o)=>{let a=e(r);if(!Je(a,o)){const l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,numberOfOutputs:a.numberOfOutputs};a=n(o,l)}return s.set(o,a),await t(r,o,a),a};return{render(r,o){const a=s.get(o);return a!==void 0?Promise.resolve(a):i(r,o)}}},q_=n=>(e,t,s)=>n(t,e,s),W_=n=>(e,t,s=0,i=0)=>{const r=e[s];if(r===void 0)throw n();return no(t)?r.connect(t,0,i):r.connect(t,0)},G_=n=>(e,t)=>{const s=n(e,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),i=e.createBuffer(1,2,44100);return s.buffer=i,s.loop=!0,s.connect(t),s.start(),()=>{s.stop(),s.disconnect(t)}},Y_={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",offset:1},Z_=(n,e,t,s,i,r,o)=>class extends n{constructor(c,l){const u=i(c),h={...Y_,...l},f=s(u,h),d=r(u),m=d?t():null;super(c,!1,f,m),this._constantSourceNodeRenderer=m,this._nativeConstantSourceNode=f,this._offset=e(this,d,f.offset,et,at),this._onended=null}get offset(){return this._offset}get onended(){return this._onended}set onended(c){const l=typeof c=="function"?o(this,c):null;this._nativeConstantSourceNode.onended=l;const u=this._nativeConstantSourceNode.onended;this._onended=u!==null&&u===l?c:u}start(c=0){if(this._nativeConstantSourceNode.start(c),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.start=c),this.context.state!=="closed"){$n(this);const l=()=>{this._nativeConstantSourceNode.removeEventListener("ended",l),fs(this)&&_r(this)};this._nativeConstantSourceNode.addEventListener("ended",l)}}stop(c=0){this._nativeConstantSourceNode.stop(c),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.stop=c)}},$_=(n,e,t,s,i)=>()=>{const r=new WeakMap;let o=null,a=null;const c=async(l,u)=>{let h=t(l);const f=Je(h,u);if(!f){const d={channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,offset:h.offset.value};h=e(u,d),o!==null&&h.start(o),a!==null&&h.stop(a)}return r.set(u,h),f?await n(u,l.offset,h.offset):await s(u,l.offset,h.offset),await i(l,u,h),h};return{set start(l){o=l},set stop(l){a=l},render(l,u){const h=r.get(u);return h!==void 0?Promise.resolve(h):c(l,u)}}},X_=n=>e=>(n[0]=e,n[0]),Q_={buffer:null,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",disableNormalization:!1},K_=(n,e,t,s,i,r)=>class extends n{constructor(a,c){const l=s(a),u={...Q_,...c},h=t(l,u),d=i(l)?e():null;super(a,!1,h,d),this._isBufferNullified=!1,this._nativeConvolverNode=h,u.buffer!==null&&r(this,u.buffer.duration)}get buffer(){return this._isBufferNullified?null:this._nativeConvolverNode.buffer}set buffer(a){if(this._nativeConvolverNode.buffer=a,a===null&&this._nativeConvolverNode.buffer!==null){const c=this._nativeConvolverNode.context;this._nativeConvolverNode.buffer=c.createBuffer(1,1,c.sampleRate),this._isBufferNullified=!0,r(this,0)}else this._isBufferNullified=!1,r(this,this._nativeConvolverNode.buffer===null?0:this._nativeConvolverNode.buffer.duration)}get normalize(){return this._nativeConvolverNode.normalize}set normalize(a){this._nativeConvolverNode.normalize=a}},J_=(n,e,t)=>()=>{const s=new WeakMap,i=async(r,o)=>{let a=e(r);if(!Je(a,o)){const l={buffer:a.buffer,channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,disableNormalization:!a.normalize};a=n(o,l)}return s.set(o,a),ai(a)?await t(r,o,a.inputs[0]):await t(r,o,a),a};return{render(r,o){const a=s.get(o);return a!==void 0?Promise.resolve(a):i(r,o)}}},eg=(n,e)=>(t,s,i)=>{if(e===null)throw new Error("Missing the native OfflineAudioContext constructor.");try{return new e(t,s,i)}catch(r){throw r.name==="SyntaxError"?n():r}},tg=()=>new DOMException("","DataCloneError"),Pl=n=>{const{port1:e,port2:t}=new MessageChannel;return new Promise(s=>{const i=()=>{t.onmessage=null,e.close(),t.close(),s()};t.onmessage=()=>i();try{e.postMessage(n,[n])}catch{}finally{i()}})},sg=(n,e,t,s,i,r,o,a,c,l,u)=>(h,f)=>{const d=o(h)?h:r(h);if(i.has(f)){const m=t();return Promise.reject(m)}try{i.add(f)}catch{}return e(c,()=>c(d))?d.decodeAudioData(f).then(m=>(Pl(f).catch(()=>{}),e(a,()=>a(m))||u(m),n.add(m),m)):new Promise((m,p)=>{const _=async()=>{try{await Pl(f)}catch{}},v=T=>{p(T),_()};try{d.decodeAudioData(f,T=>{typeof T.copyFromChannel!="function"&&(l(T),oc(T)),n.add(T),_().then(()=>m(T))},T=>{v(T===null?s():T)})}catch(T){v(T)}})},ng=(n,e,t,s,i,r,o,a)=>(c,l)=>{const u=e.get(c);if(u===void 0)throw new Error("Missing the expected cycle count.");const h=r(c.context),f=a(h);if(u===l){if(e.delete(c),!f&&o(c)){const d=s(c),{outputs:m}=t(c);for(const p of m)if(vr(p)){const _=s(p[0]);n(d,_,p[1],p[2])}else{const _=i(p[0]);d.connect(_,p[1])}}}else e.set(c,u-l)},ig={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",delayTime:0,maxDelayTime:1},rg=(n,e,t,s,i,r,o)=>class extends n{constructor(c,l){const u=i(c),h={...ig,...l},f=s(u,h),d=r(u),m=d?t(h.maxDelayTime):null;super(c,!1,f,m),this._delayTime=e(this,d,f.delayTime),o(this,h.maxDelayTime)}get delayTime(){return this._delayTime}},og=(n,e,t,s,i)=>r=>{const o=new WeakMap,a=async(c,l)=>{let u=t(c);const h=Je(u,l);if(!h){const f={channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,delayTime:u.delayTime.value,maxDelayTime:r};u=e(l,f)}return o.set(l,u),h?await n(l,c.delayTime,u.delayTime):await s(l,c.delayTime,u.delayTime),await i(c,l,u),u};return{render(c,l){const u=o.get(l);return u!==void 0?Promise.resolve(u):a(c,l)}}},ag=n=>(e,t,s,i)=>n(e[i],r=>r[0]===t&&r[1]===s),cg=n=>(e,t)=>{n(e).delete(t)},lg=n=>"delayTime"in n,ug=(n,e,t)=>function s(i,r){const o=eo(r)?r:t(n,r);if(lg(o))return[];if(i[0]===o)return[i];if(i.includes(o))return[];const{outputs:a}=e(o);return Array.from(a).map(c=>s([...i,o],c[0])).reduce((c,l)=>c.concat(l),[])},Ur=(n,e,t)=>{const s=e[t];if(s===void 0)throw n();return s},hg=n=>(e,t=void 0,s=void 0,i=0)=>t===void 0?e.forEach(r=>r.disconnect()):typeof t=="number"?Ur(n,e,t).disconnect():no(t)?s===void 0?e.forEach(r=>r.disconnect(t)):i===void 0?Ur(n,e,s).disconnect(t,0):Ur(n,e,s).disconnect(t,0,i):s===void 0?e.forEach(r=>r.disconnect(t)):Ur(n,e,s).disconnect(t,0),dg={attack:.003,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",knee:30,ratio:12,release:.25,threshold:-24},fg=(n,e,t,s,i,r,o,a)=>class extends n{constructor(l,u){const h=r(l),f={...dg,...u},d=s(h,f),m=o(h),p=m?t():null;super(l,!1,d,p),this._attack=e(this,m,d.attack),this._knee=e(this,m,d.knee),this._nativeDynamicsCompressorNode=d,this._ratio=e(this,m,d.ratio),this._release=e(this,m,d.release),this._threshold=e(this,m,d.threshold),a(this,.006)}get attack(){return this._attack}get channelCount(){return this._nativeDynamicsCompressorNode.channelCount}set channelCount(l){const u=this._nativeDynamicsCompressorNode.channelCount;if(this._nativeDynamicsCompressorNode.channelCount=l,l>2)throw this._nativeDynamicsCompressorNode.channelCount=u,i()}get channelCountMode(){return this._nativeDynamicsCompressorNode.channelCountMode}set channelCountMode(l){const u=this._nativeDynamicsCompressorNode.channelCountMode;if(this._nativeDynamicsCompressorNode.channelCountMode=l,l==="max")throw this._nativeDynamicsCompressorNode.channelCountMode=u,i()}get knee(){return this._knee}get ratio(){return this._ratio}get reduction(){return typeof this._nativeDynamicsCompressorNode.reduction.value=="number"?this._nativeDynamicsCompressorNode.reduction.value:this._nativeDynamicsCompressorNode.reduction}get release(){return this._release}get threshold(){return this._threshold}},pg=(n,e,t,s,i)=>()=>{const r=new WeakMap,o=async(a,c)=>{let l=t(a);const u=Je(l,c);if(!u){const h={attack:l.attack.value,channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,knee:l.knee.value,ratio:l.ratio.value,release:l.release.value,threshold:l.threshold.value};l=e(c,h)}return r.set(c,l),u?(await n(c,a.attack,l.attack),await n(c,a.knee,l.knee),await n(c,a.ratio,l.ratio),await n(c,a.release,l.release),await n(c,a.threshold,l.threshold)):(await s(c,a.attack,l.attack),await s(c,a.knee,l.knee),await s(c,a.ratio,l.ratio),await s(c,a.release,l.release),await s(c,a.threshold,l.threshold)),await i(a,c,l),l};return{render(a,c){const l=r.get(c);return l!==void 0?Promise.resolve(l):o(a,c)}}},mg=()=>new DOMException("","EncodingError"),_g=n=>e=>new Promise((t,s)=>{if(n===null){s(new SyntaxError);return}const i=n.document.head;if(i===null)s(new SyntaxError);else{const r=n.document.createElement("script"),o=new Blob([e],{type:"application/javascript"}),a=URL.createObjectURL(o),c=n.onerror,l=()=>{n.onerror=c,URL.revokeObjectURL(a)};n.onerror=(u,h,f,d,m)=>{if(h===a||h===n.location.href&&f===1&&d===1)return l(),s(m),!1;if(c!==null)return c(u,h,f,d,m)},r.onerror=()=>{l(),s(new SyntaxError)},r.onload=()=>{l(),t()},r.src=a,r.type="module",i.appendChild(r)}}),gg=n=>class{constructor(t){this._nativeEventTarget=t,this._listeners=new WeakMap}addEventListener(t,s,i){if(s!==null){let r=this._listeners.get(s);r===void 0&&(r=n(this,s),typeof s=="function"&&this._listeners.set(s,r)),this._nativeEventTarget.addEventListener(t,r,i)}}dispatchEvent(t){return this._nativeEventTarget.dispatchEvent(t)}removeEventListener(t,s,i){const r=s===null?void 0:this._listeners.get(s);this._nativeEventTarget.removeEventListener(t,r===void 0?null:r,i)}},vg=n=>(e,t,s)=>{Object.defineProperties(n,{currentFrame:{configurable:!0,get(){return Math.round(e*t)}},currentTime:{configurable:!0,get(){return e}}});try{return s()}finally{n!==null&&(delete n.currentFrame,delete n.currentTime)}},yg=n=>async e=>{try{const t=await fetch(e);if(t.ok)return[await t.text(),t.url]}catch{}throw n()},xg={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",gain:1},Tg=(n,e,t,s,i,r)=>class extends n{constructor(a,c){const l=i(a),u={...xg,...c},h=s(l,u),f=r(l),d=f?t():null;super(a,!1,h,d),this._gain=e(this,f,h.gain,et,at)}get gain(){return this._gain}},wg=(n,e,t,s,i)=>()=>{const r=new WeakMap,o=async(a,c)=>{let l=t(a);const u=Je(l,c);if(!u){const h={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,gain:l.gain.value};l=e(c,h)}return r.set(c,l),u?await n(c,a.gain,l.gain):await s(c,a.gain,l.gain),await i(a,c,l),l};return{render(a,c){const l=r.get(c);return l!==void 0?Promise.resolve(l):o(a,c)}}},kg=(n,e)=>t=>e(n,t),Sg=n=>e=>{const t=n(e);if(t.renderer===null)throw new Error("Missing the renderer of the given AudioNode in the audio graph.");return t.renderer},Cg=n=>e=>{var t;return(t=n.get(e))!==null&&t!==void 0?t:0},bg=n=>e=>{const t=n(e);if(t.renderer===null)throw new Error("Missing the renderer of the given AudioParam in the audio graph.");return t.renderer},Eg=n=>e=>n.get(e),We=()=>new DOMException("","InvalidStateError"),Og=n=>e=>{const t=n.get(e);if(t===void 0)throw We();return t},Ag=(n,e)=>t=>{let s=n.get(t);if(s!==void 0)return s;if(e===null)throw new Error("Missing the native OfflineAudioContext constructor.");return s=new e(1,1,44100),n.set(t,s),s},Mg=n=>e=>{const t=n.get(e);if(t===void 0)throw new Error("The context has no set of AudioWorkletNodes.");return t},Io=()=>new DOMException("","InvalidAccessError"),Dg=n=>{n.getFrequencyResponse=(e=>(t,s,i)=>{if(t.length!==s.length||s.length!==i.length)throw Io();return e.call(n,t,s,i)})(n.getFrequencyResponse)},Rg={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers"},Pg=(n,e,t,s,i,r)=>class extends n{constructor(a,c){const l=s(a),u=i(l),h={...Rg,...c},f=e(l,u?null:a.baseLatency,h),d=u?t(h.feedback,h.feedforward):null;super(a,!1,f,d),Dg(f),this._nativeIIRFilterNode=f,r(this,1)}getFrequencyResponse(a,c,l){return this._nativeIIRFilterNode.getFrequencyResponse(a,c,l)}},$u=(n,e,t,s,i,r,o,a,c,l,u)=>{const h=l.length;let f=a;for(let d=0;d<h;d+=1){let m=t[0]*l[d];for(let p=1;p<i;p+=1){const _=f-p&c-1;m+=t[p]*r[_],m-=n[p]*o[_]}for(let p=i;p<s;p+=1)m+=t[p]*r[f-p&c-1];for(let p=i;p<e;p+=1)m-=n[p]*o[f-p&c-1];r[f]=l[d],o[f]=m,f=f+1&c-1,u[d]=m}return f},Ig=(n,e,t,s)=>{const i=t instanceof Float64Array?t:new Float64Array(t),r=s instanceof Float64Array?s:new Float64Array(s),o=i.length,a=r.length,c=Math.min(o,a);if(i[0]!==1){for(let m=0;m<o;m+=1)r[m]/=i[0];for(let m=1;m<a;m+=1)i[m]/=i[0]}const l=32,u=new Float32Array(l),h=new Float32Array(l),f=e.createBuffer(n.numberOfChannels,n.length,n.sampleRate),d=n.numberOfChannels;for(let m=0;m<d;m+=1){const p=n.getChannelData(m),_=f.getChannelData(m);u.fill(0),h.fill(0),$u(i,o,r,a,c,u,h,0,l,p,_)}return f},Ng=(n,e,t,s,i)=>(r,o)=>{const a=new WeakMap;let c=null;const l=async(u,h)=>{let f=null,d=e(u);const m=Je(d,h);if(h.createIIRFilter===void 0?f=n(h,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}):m||(d=h.createIIRFilter(o,r)),a.set(h,f===null?d:f),f!==null){if(c===null){if(t===null)throw new Error("Missing the native OfflineAudioContext constructor.");const _=new t(u.context.destination.channelCount,u.context.length,h.sampleRate);c=(async()=>{await s(u,_,_.destination);const v=await i(_);return Ig(v,h,r,o)})()}const p=await c;return f.buffer=p,f.start(0),f}return await s(u,h,d),d};return{render(u,h){const f=a.get(h);return f!==void 0?Promise.resolve(f):l(u,h)}}},Fg=(n,e,t,s,i,r)=>o=>(a,c)=>{const l=n.get(a);if(l===void 0){if(!o&&r(a)){const u=s(a),{outputs:h}=t(a);for(const f of h)if(vr(f)){const d=s(f[0]);e(u,d,f[1],f[2])}else{const d=i(f[0]);u.disconnect(d,f[1])}}n.set(a,c)}else n.set(a,l+c)},Ug=(n,e)=>t=>{const s=n.get(t);return e(s)||e(t)},Lg=(n,e)=>t=>n.has(t)||e(t),Bg=(n,e)=>t=>n.has(t)||e(t),zg=(n,e)=>t=>{const s=n.get(t);return e(s)||e(t)},Vg=n=>e=>n!==null&&e instanceof n,jg=n=>e=>n!==null&&typeof n.AudioNode=="function"&&e instanceof n.AudioNode,Hg=n=>e=>n!==null&&typeof n.AudioParam=="function"&&e instanceof n.AudioParam,qg=(n,e)=>t=>n(t)||e(t),Wg=n=>e=>n!==null&&e instanceof n,Gg=n=>n!==null&&n.isSecureContext,Yg=(n,e,t,s)=>class extends n{constructor(r,o){const a=t(r),c=e(a,o);if(s(a))throw TypeError();super(r,!0,c,null),this._nativeMediaElementAudioSourceNode=c}get mediaElement(){return this._nativeMediaElementAudioSourceNode.mediaElement}},Zg={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"},$g=(n,e,t,s)=>class extends n{constructor(r,o){const a=t(r);if(s(a))throw new TypeError;const c={...Zg,...o},l=e(a,c);super(r,!1,l,null),this._nativeMediaStreamAudioDestinationNode=l}get stream(){return this._nativeMediaStreamAudioDestinationNode.stream}},Xg=(n,e,t,s)=>class extends n{constructor(r,o){const a=t(r),c=e(a,o);if(s(a))throw new TypeError;super(r,!0,c,null),this._nativeMediaStreamAudioSourceNode=c}get mediaStream(){return this._nativeMediaStreamAudioSourceNode.mediaStream}},Qg=(n,e,t)=>class extends n{constructor(i,r){const o=t(i),a=e(o,r);super(i,!0,a,null)}},Kg=(n,e,t,s,i,r)=>class extends t{constructor(a,c){super(a),this._nativeContext=a,Ro.set(this,a),s(a)&&i.set(a,new Set),this._destination=new n(this,c),this._listener=e(this,a),this._onstatechange=null}get currentTime(){return this._nativeContext.currentTime}get destination(){return this._destination}get listener(){return this._listener}get onstatechange(){return this._onstatechange}set onstatechange(a){const c=typeof a=="function"?r(this,a):null;this._nativeContext.onstatechange=c;const l=this._nativeContext.onstatechange;this._onstatechange=l!==null&&l===c?a:l}get sampleRate(){return this._nativeContext.sampleRate}get state(){return this._nativeContext.state}},zi=n=>{const e=new Uint32Array([1179011410,40,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,4,0]);try{const t=n.decodeAudioData(e.buffer,()=>{});return t===void 0?!1:(t.catch(()=>{}),!0)}catch{}return!1},Jg=(n,e)=>(t,s,i)=>{const r=new Set;return t.connect=(o=>(a,c=0,l=0)=>{const u=r.size===0;if(e(a))return o.call(t,a,c,l),n(r,[a,c,l],h=>h[0]===a&&h[1]===c&&h[2]===l,!0),u&&s(),a;o.call(t,a,c),n(r,[a,c],h=>h[0]===a&&h[1]===c,!0),u&&s()})(t.connect),t.disconnect=(o=>(a,c,l)=>{const u=r.size>0;if(a===void 0)o.apply(t),r.clear();else if(typeof a=="number"){o.call(t,a);for(const f of r)f[1]===a&&r.delete(f)}else{e(a)?o.call(t,a,c,l):o.call(t,a,c);for(const f of r)f[0]===a&&(c===void 0||f[1]===c)&&(l===void 0||f[2]===l)&&r.delete(f)}const h=r.size===0;u&&h&&i()})(t.disconnect),t},Se=(n,e,t)=>{const s=e[t];s!==void 0&&s!==n[t]&&(n[t]=s)},je=(n,e)=>{Se(n,e,"channelCount"),Se(n,e,"channelCountMode"),Se(n,e,"channelInterpretation")},Il=n=>typeof n.getFloatTimeDomainData=="function",e1=n=>{n.getFloatTimeDomainData=e=>{const t=new Uint8Array(e.length);n.getByteTimeDomainData(t);const s=Math.max(t.length,n.fftSize);for(let i=0;i<s;i+=1)e[i]=(t[i]-128)*.0078125;return e}},t1=(n,e)=>(t,s)=>{const i=t.createAnalyser();if(je(i,s),!(s.maxDecibels>s.minDecibels))throw e();return Se(i,s,"fftSize"),Se(i,s,"maxDecibels"),Se(i,s,"minDecibels"),Se(i,s,"smoothingTimeConstant"),n(Il,()=>Il(i))||e1(i),i},s1=n=>n===null?null:n.hasOwnProperty("AudioBuffer")?n.AudioBuffer:null,Me=(n,e,t)=>{const s=e[t];s!==void 0&&s!==n[t].value&&(n[t].value=s)},n1=n=>{n.start=(e=>{let t=!1;return(s=0,i=0,r)=>{if(t)throw We();e.call(n,s,i,r),t=!0}})(n.start)},lc=n=>{n.start=(e=>(t=0,s=0,i)=>{if(typeof i=="number"&&i<0||s<0||t<0)throw new RangeError("The parameters can't be negative.");e.call(n,t,s,i)})(n.start)},uc=n=>{n.stop=(e=>(t=0)=>{if(t<0)throw new RangeError("The parameter can't be negative.");e.call(n,t)})(n.stop)},i1=(n,e,t,s,i,r,o,a,c,l,u)=>(h,f)=>{const d=h.createBufferSource();return je(d,f),Me(d,f,"playbackRate"),Se(d,f,"buffer"),Se(d,f,"loop"),Se(d,f,"loopEnd"),Se(d,f,"loopStart"),e(t,()=>t(h))||n1(d),e(s,()=>s(h))||c(d),e(i,()=>i(h))||l(d,h),e(r,()=>r(h))||lc(d),e(o,()=>o(h))||u(d,h),e(a,()=>a(h))||uc(d),n(h,d),d},r1=n=>n===null?null:n.hasOwnProperty("AudioContext")?n.AudioContext:n.hasOwnProperty("webkitAudioContext")?n.webkitAudioContext:null,o1=(n,e)=>(t,s,i)=>{const r=t.destination;if(r.channelCount!==s)try{r.channelCount=s}catch{}i&&r.channelCountMode!=="explicit"&&(r.channelCountMode="explicit"),r.maxChannelCount===0&&Object.defineProperty(r,"maxChannelCount",{value:s});const o=n(t,{channelCount:s,channelCountMode:r.channelCountMode,channelInterpretation:r.channelInterpretation,gain:1});return e(o,"channelCount",a=>()=>a.call(o),a=>c=>{a.call(o,c);try{r.channelCount=c}catch(l){if(c>r.maxChannelCount)throw l}}),e(o,"channelCountMode",a=>()=>a.call(o),a=>c=>{a.call(o,c),r.channelCountMode=c}),e(o,"channelInterpretation",a=>()=>a.call(o),a=>c=>{a.call(o,c),r.channelInterpretation=c}),Object.defineProperty(o,"maxChannelCount",{get:()=>r.maxChannelCount}),o.connect(r),o},a1=n=>n===null?null:n.hasOwnProperty("AudioWorkletNode")?n.AudioWorkletNode:null,c1=n=>{const{port1:e}=new MessageChannel;try{e.postMessage(n)}finally{e.close()}},l1=(n,e,t,s,i)=>(r,o,a,c,l,u)=>{if(a!==null)try{const h=new a(r,c,u),f=new Map;let d=null;if(Object.defineProperties(h,{channelCount:{get:()=>u.channelCount,set:()=>{throw n()}},channelCountMode:{get:()=>"explicit",set:()=>{throw n()}},onprocessorerror:{get:()=>d,set:m=>{typeof d=="function"&&h.removeEventListener("processorerror",d),d=typeof m=="function"?m:null,typeof d=="function"&&h.addEventListener("processorerror",d)}}}),h.addEventListener=(m=>(...p)=>{if(p[0]==="processorerror"){const _=typeof p[1]=="function"?p[1]:typeof p[1]=="object"&&p[1]!==null&&typeof p[1].handleEvent=="function"?p[1].handleEvent:null;if(_!==null){const v=f.get(p[1]);v!==void 0?p[1]=v:(p[1]=T=>{T.type==="error"?(Object.defineProperties(T,{type:{value:"processorerror"}}),_(T)):_(new ErrorEvent(p[0],{...T}))},f.set(_,p[1]))}}return m.call(h,"error",p[1],p[2]),m.call(h,...p)})(h.addEventListener),h.removeEventListener=(m=>(...p)=>{if(p[0]==="processorerror"){const _=f.get(p[1]);_!==void 0&&(f.delete(p[1]),p[1]=_)}return m.call(h,"error",p[1],p[2]),m.call(h,p[0],p[1],p[2])})(h.removeEventListener),u.numberOfOutputs!==0){const m=t(r,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return h.connect(m).connect(r.destination),i(h,()=>m.disconnect(),()=>m.connect(r.destination))}return h}catch(h){throw h.code===11?s():h}if(l===void 0)throw s();return c1(u),e(r,o,l,u)},Xu=(n,e)=>n===null?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2(n*e))))),u1=n=>new Promise((e,t)=>{const{port1:s,port2:i}=new MessageChannel;s.onmessage=({data:r})=>{s.close(),i.close(),e(r)},s.onmessageerror=({data:r})=>{s.close(),i.close(),t(r)},i.postMessage(n)}),h1=async(n,e)=>{const t=await u1(e);return new n(t)},d1=(n,e,t,s)=>{let i=Oa.get(n);i===void 0&&(i=new WeakMap,Oa.set(n,i));const r=h1(t,s);return i.set(e,r),r},f1=(n,e,t,s,i,r,o,a,c,l,u,h,f)=>(d,m,p,_)=>{if(_.numberOfInputs===0&&_.numberOfOutputs===0)throw c();const v=Array.isArray(_.outputChannelCount)?_.outputChannelCount:Array.from(_.outputChannelCount);if(v.some(L=>L<1))throw c();if(v.length!==_.numberOfOutputs)throw e();if(_.channelCountMode!=="explicit")throw c();const T=_.channelCount*_.numberOfInputs,S=v.reduce((L,Y)=>L+Y,0),y=p.parameterDescriptors===void 0?0:p.parameterDescriptors.length;if(T+y>6||S>6)throw c();const g=new MessageChannel,w=[],k=[];for(let L=0;L<_.numberOfInputs;L+=1)w.push(o(d,{channelCount:_.channelCount,channelCountMode:_.channelCountMode,channelInterpretation:_.channelInterpretation,gain:1})),k.push(i(d,{channelCount:_.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:_.channelCount}));const x=[];if(p.parameterDescriptors!==void 0)for(const{defaultValue:L,maxValue:Y,minValue:Ve,name:Ce}of p.parameterDescriptors){const re=r(d,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:_.parameterData[Ce]!==void 0?_.parameterData[Ce]:L===void 0?0:L});Object.defineProperties(re.offset,{defaultValue:{get:()=>L===void 0?0:L},maxValue:{get:()=>Y===void 0?et:Y},minValue:{get:()=>Ve===void 0?at:Ve}}),x.push(re)}const C=s(d,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,T+y)}),b=Xu(m,d.sampleRate),O=a(d,b,T+y,Math.max(1,S)),A=i(d,{channelCount:Math.max(1,S),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,S)}),R=[];for(let L=0;L<_.numberOfOutputs;L+=1)R.push(s(d,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:v[L]}));for(let L=0;L<_.numberOfInputs;L+=1){w[L].connect(k[L]);for(let Y=0;Y<_.channelCount;Y+=1)k[L].connect(C,Y,L*_.channelCount+Y)}const P=new Yu(p.parameterDescriptors===void 0?[]:p.parameterDescriptors.map(({name:L},Y)=>{const Ve=x[Y];return Ve.connect(C,0,T+Y),Ve.start(0),[L,Ve.offset]}));C.connect(O);let F=_.channelInterpretation,N=null;const U=_.numberOfOutputs===0?[O]:R,V={get bufferSize(){return b},get channelCount(){return _.channelCount},set channelCount(L){throw t()},get channelCountMode(){return _.channelCountMode},set channelCountMode(L){throw t()},get channelInterpretation(){return F},set channelInterpretation(L){for(const Y of w)Y.channelInterpretation=L;F=L},get context(){return O.context},get inputs(){return w},get numberOfInputs(){return _.numberOfInputs},get numberOfOutputs(){return _.numberOfOutputs},get onprocessorerror(){return N},set onprocessorerror(L){typeof N=="function"&&V.removeEventListener("processorerror",N),N=typeof L=="function"?L:null,typeof N=="function"&&V.addEventListener("processorerror",N)},get parameters(){return P},get port(){return g.port2},addEventListener(...L){return O.addEventListener(L[0],L[1],L[2])},connect:n.bind(null,U),disconnect:l.bind(null,U),dispatchEvent(...L){return O.dispatchEvent(L[0])},removeEventListener(...L){return O.removeEventListener(L[0],L[1],L[2])}},z=new Map;g.port1.addEventListener=(L=>(...Y)=>{if(Y[0]==="message"){const Ve=typeof Y[1]=="function"?Y[1]:typeof Y[1]=="object"&&Y[1]!==null&&typeof Y[1].handleEvent=="function"?Y[1].handleEvent:null;if(Ve!==null){const Ce=z.get(Y[1]);Ce!==void 0?Y[1]=Ce:(Y[1]=re=>{u(d.currentTime,d.sampleRate,()=>Ve(re))},z.set(Ve,Y[1]))}}return L.call(g.port1,Y[0],Y[1],Y[2])})(g.port1.addEventListener),g.port1.removeEventListener=(L=>(...Y)=>{if(Y[0]==="message"){const Ve=z.get(Y[1]);Ve!==void 0&&(z.delete(Y[1]),Y[1]=Ve)}return L.call(g.port1,Y[0],Y[1],Y[2])})(g.port1.removeEventListener);let q=null;Object.defineProperty(g.port1,"onmessage",{get:()=>q,set:L=>{typeof q=="function"&&g.port1.removeEventListener("message",q),q=typeof L=="function"?L:null,typeof q=="function"&&(g.port1.addEventListener("message",q),g.port1.start())}}),p.prototype.port=g.port1;let j=null;d1(d,V,p,_).then(L=>j=L);const we=ro(_.numberOfInputs,_.channelCount),ae=ro(_.numberOfOutputs,v),$=p.parameterDescriptors===void 0?[]:p.parameterDescriptors.reduce((L,{name:Y})=>({...L,[Y]:new Float32Array(128)}),{});let _e=!0;const Ye=()=>{_.numberOfOutputs>0&&O.disconnect(A);for(let L=0,Y=0;L<_.numberOfOutputs;L+=1){const Ve=R[L];for(let Ce=0;Ce<v[L];Ce+=1)A.disconnect(Ve,Y+Ce,Ce);Y+=v[L]}},H=new Map;O.onaudioprocess=({inputBuffer:L,outputBuffer:Y})=>{if(j!==null){const Ve=h(V);for(let Ce=0;Ce<b;Ce+=128){for(let re=0;re<_.numberOfInputs;re+=1)for(let Ae=0;Ae<_.channelCount;Ae+=1)io(L,we[re],Ae,Ae,Ce);p.parameterDescriptors!==void 0&&p.parameterDescriptors.forEach(({name:re},Ae)=>{io(L,$,re,T+Ae,Ce)});for(let re=0;re<_.numberOfInputs;re+=1)for(let Ae=0;Ae<v[re];Ae+=1)ae[re][Ae].byteLength===0&&(ae[re][Ae]=new Float32Array(128));try{const re=we.map((kt,Cs)=>{if(Ve[Cs].size>0)return H.set(Cs,b/128),kt;const $o=H.get(Cs);return $o===void 0?[]:(kt.every(Kd=>Kd.every(Jd=>Jd===0))&&($o===1?H.delete(Cs):H.set(Cs,$o-1)),kt)});_e=u(d.currentTime+Ce/d.sampleRate,d.sampleRate,()=>j.process(re,ae,$));for(let kt=0,Cs=0;kt<_.numberOfOutputs;kt+=1){for(let di=0;di<v[kt];di+=1)Zu(Y,ae[kt],di,Cs+di,Ce);Cs+=v[kt]}}catch(re){_e=!1,V.dispatchEvent(new ErrorEvent("processorerror",{colno:re.colno,filename:re.filename,lineno:re.lineno,message:re.message}))}if(!_e){for(let re=0;re<_.numberOfInputs;re+=1){w[re].disconnect(k[re]);for(let Ae=0;Ae<_.channelCount;Ae+=1)k[Ce].disconnect(C,Ae,re*_.channelCount+Ae)}if(p.parameterDescriptors!==void 0){const re=p.parameterDescriptors.length;for(let Ae=0;Ae<re;Ae+=1){const kt=x[Ae];kt.disconnect(C,0,T+Ae),kt.stop()}}C.disconnect(O),O.onaudioprocess=null,$s?Ye():bn();break}}}};let $s=!1;const Xs=o(d,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),Cn=()=>O.connect(Xs).connect(d.destination),bn=()=>{O.disconnect(Xs),Xs.disconnect()},Xd=()=>{if(_e){bn(),_.numberOfOutputs>0&&O.connect(A);for(let L=0,Y=0;L<_.numberOfOutputs;L+=1){const Ve=R[L];for(let Ce=0;Ce<v[L];Ce+=1)A.connect(Ve,Y+Ce,Ce);Y+=v[L]}}$s=!0},Qd=()=>{_e&&(Cn(),Ye()),$s=!1};return Cn(),f(V,Xd,Qd)},Qu=(n,e)=>{const t=n.createBiquadFilter();return je(t,e),Me(t,e,"Q"),Me(t,e,"detune"),Me(t,e,"frequency"),Me(t,e,"gain"),Se(t,e,"type"),t},p1=(n,e)=>(t,s)=>{const i=t.createChannelMerger(s.numberOfInputs);return n!==null&&n.name==="webkitAudioContext"&&e(t,i),je(i,s),i},m1=n=>{const e=n.numberOfOutputs;Object.defineProperty(n,"channelCount",{get:()=>e,set:t=>{if(t!==e)throw We()}}),Object.defineProperty(n,"channelCountMode",{get:()=>"explicit",set:t=>{if(t!=="explicit")throw We()}}),Object.defineProperty(n,"channelInterpretation",{get:()=>"discrete",set:t=>{if(t!=="discrete")throw We()}})},yr=(n,e)=>{const t=n.createChannelSplitter(e.numberOfOutputs);return je(t,e),m1(t),t},_1=(n,e,t,s,i)=>(r,o)=>{if(r.createConstantSource===void 0)return t(r,o);const a=r.createConstantSource();return je(a,o),Me(a,o,"offset"),e(s,()=>s(r))||lc(a),e(i,()=>i(r))||uc(a),n(r,a),a},ci=(n,e)=>(n.connect=e.connect.bind(e),n.disconnect=e.disconnect.bind(e),n),g1=(n,e,t,s)=>(i,{offset:r,...o})=>{const a=i.createBuffer(1,2,44100),c=e(i,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),l=t(i,{...o,gain:r}),u=a.getChannelData(0);u[0]=1,u[1]=1,c.buffer=a,c.loop=!0;const h={get bufferSize(){},get channelCount(){return l.channelCount},set channelCount(m){l.channelCount=m},get channelCountMode(){return l.channelCountMode},set channelCountMode(m){l.channelCountMode=m},get channelInterpretation(){return l.channelInterpretation},set channelInterpretation(m){l.channelInterpretation=m},get context(){return l.context},get inputs(){return[]},get numberOfInputs(){return c.numberOfInputs},get numberOfOutputs(){return l.numberOfOutputs},get offset(){return l.gain},get onended(){return c.onended},set onended(m){c.onended=m},addEventListener(...m){return c.addEventListener(m[0],m[1],m[2])},dispatchEvent(...m){return c.dispatchEvent(m[0])},removeEventListener(...m){return c.removeEventListener(m[0],m[1],m[2])},start(m=0){c.start.call(c,m)},stop(m=0){c.stop.call(c,m)}},f=()=>c.connect(l),d=()=>c.disconnect(l);return n(i,c),s(ci(h,l),f,d)},v1=(n,e)=>(t,s)=>{const i=t.createConvolver();if(je(i,s),s.disableNormalization===i.normalize&&(i.normalize=!s.disableNormalization),Se(i,s,"buffer"),s.channelCount>2||(e(i,"channelCount",r=>()=>r.call(i),r=>o=>{if(o>2)throw n();return r.call(i,o)}),s.channelCountMode==="max"))throw n();return e(i,"channelCountMode",r=>()=>r.call(i),r=>o=>{if(o==="max")throw n();return r.call(i,o)}),i},Ku=(n,e)=>{const t=n.createDelay(e.maxDelayTime);return je(t,e),Me(t,e,"delayTime"),t},y1=n=>(e,t)=>{const s=e.createDynamicsCompressor();if(je(s,t),t.channelCount>2||t.channelCountMode==="max")throw n();return Me(s,t,"attack"),Me(s,t,"knee"),Me(s,t,"ratio"),Me(s,t,"release"),Me(s,t,"threshold"),s},ft=(n,e)=>{const t=n.createGain();return je(t,e),Me(t,e,"gain"),t},x1=n=>(e,t,s)=>{if(e.createIIRFilter===void 0)return n(e,t,s);const i=e.createIIRFilter(s.feedforward,s.feedback);return je(i,s),i};function T1(n,e){const t=e[0]*e[0]+e[1]*e[1];return[(n[0]*e[0]+n[1]*e[1])/t,(n[1]*e[0]-n[0]*e[1])/t]}function w1(n,e){return[n[0]*e[0]-n[1]*e[1],n[0]*e[1]+n[1]*e[0]]}function Nl(n,e){let t=[0,0];for(let s=n.length-1;s>=0;s-=1)t=w1(t,e),t[0]+=n[s];return t}const k1=(n,e,t,s)=>(i,r,{channelCount:o,channelCountMode:a,channelInterpretation:c,feedback:l,feedforward:u})=>{const h=Xu(r,i.sampleRate),f=l instanceof Float64Array?l:new Float64Array(l),d=u instanceof Float64Array?u:new Float64Array(u),m=f.length,p=d.length,_=Math.min(m,p);if(m===0||m>20)throw s();if(f[0]===0)throw e();if(p===0||p>20)throw s();if(d[0]===0)throw e();if(f[0]!==1){for(let x=0;x<p;x+=1)d[x]/=f[0];for(let x=1;x<m;x+=1)f[x]/=f[0]}const v=t(i,h,o,o);v.channelCount=o,v.channelCountMode=a,v.channelInterpretation=c;const T=32,S=[],y=[],g=[];for(let x=0;x<o;x+=1){S.push(0);const C=new Float32Array(T),b=new Float32Array(T);C.fill(0),b.fill(0),y.push(C),g.push(b)}v.onaudioprocess=x=>{const C=x.inputBuffer,b=x.outputBuffer,O=C.numberOfChannels;for(let A=0;A<O;A+=1){const R=C.getChannelData(A),P=b.getChannelData(A);S[A]=$u(f,m,d,p,_,y[A],g[A],S[A],T,R,P)}};const w=i.sampleRate/2;return ci({get bufferSize(){return h},get channelCount(){return v.channelCount},set channelCount(x){v.channelCount=x},get channelCountMode(){return v.channelCountMode},set channelCountMode(x){v.channelCountMode=x},get channelInterpretation(){return v.channelInterpretation},set channelInterpretation(x){v.channelInterpretation=x},get context(){return v.context},get inputs(){return[v]},get numberOfInputs(){return v.numberOfInputs},get numberOfOutputs(){return v.numberOfOutputs},addEventListener(...x){return v.addEventListener(x[0],x[1],x[2])},dispatchEvent(...x){return v.dispatchEvent(x[0])},getFrequencyResponse(x,C,b){if(x.length!==C.length||C.length!==b.length)throw n();const O=x.length;for(let A=0;A<O;A+=1){const R=-Math.PI*(x[A]/w),P=[Math.cos(R),Math.sin(R)],F=Nl(d,P),N=Nl(f,P),U=T1(F,N);C[A]=Math.sqrt(U[0]*U[0]+U[1]*U[1]),b[A]=Math.atan2(U[1],U[0])}},removeEventListener(...x){return v.removeEventListener(x[0],x[1],x[2])}},v)},S1=(n,e)=>n.createMediaElementSource(e.mediaElement),C1=(n,e)=>{const t=n.createMediaStreamDestination();return je(t,e),t.numberOfOutputs===1&&Object.defineProperty(t,"numberOfOutputs",{get:()=>0}),t},b1=(n,{mediaStream:e})=>{const t=e.getAudioTracks();t.sort((r,o)=>r.id<o.id?-1:r.id>o.id?1:0);const s=t.slice(0,1),i=n.createMediaStreamSource(new MediaStream(s));return Object.defineProperty(i,"mediaStream",{value:e}),i},E1=(n,e)=>(t,{mediaStreamTrack:s})=>{if(typeof t.createMediaStreamTrackSource=="function")return t.createMediaStreamTrackSource(s);const i=new MediaStream([s]),r=t.createMediaStreamSource(i);if(s.kind!=="audio")throw n();if(e(t))throw new TypeError;return r},O1=n=>n===null?null:n.hasOwnProperty("OfflineAudioContext")?n.OfflineAudioContext:n.hasOwnProperty("webkitOfflineAudioContext")?n.webkitOfflineAudioContext:null,A1=(n,e,t,s,i,r)=>(o,a)=>{const c=o.createOscillator();return je(c,a),Me(c,a,"detune"),Me(c,a,"frequency"),a.periodicWave!==void 0?c.setPeriodicWave(a.periodicWave):Se(c,a,"type"),e(t,()=>t(o))||lc(c),e(s,()=>s(o))||r(c,o),e(i,()=>i(o))||uc(c),n(o,c),c},M1=n=>(e,t)=>{const s=e.createPanner();return s.orientationX===void 0?n(e,t):(je(s,t),Me(s,t,"orientationX"),Me(s,t,"orientationY"),Me(s,t,"orientationZ"),Me(s,t,"positionX"),Me(s,t,"positionY"),Me(s,t,"positionZ"),Se(s,t,"coneInnerAngle"),Se(s,t,"coneOuterAngle"),Se(s,t,"coneOuterGain"),Se(s,t,"distanceModel"),Se(s,t,"maxDistance"),Se(s,t,"panningModel"),Se(s,t,"refDistance"),Se(s,t,"rolloffFactor"),s)},D1=(n,e,t,s,i,r,o,a,c,l)=>(u,{coneInnerAngle:h,coneOuterAngle:f,coneOuterGain:d,distanceModel:m,maxDistance:p,orientationX:_,orientationY:v,orientationZ:T,panningModel:S,positionX:y,positionY:g,positionZ:w,refDistance:k,rolloffFactor:x,...C})=>{const b=u.createPanner();if(C.channelCount>2||C.channelCountMode==="max")throw o();je(b,C);const O={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},A=t(u,{...O,channelInterpretation:"speakers",numberOfInputs:6}),R=s(u,{...C,gain:1}),P=s(u,{...O,gain:1}),F=s(u,{...O,gain:0}),N=s(u,{...O,gain:0}),U=s(u,{...O,gain:0}),V=s(u,{...O,gain:0}),z=s(u,{...O,gain:0}),q=i(u,256,6,1),j=r(u,{...O,curve:new Float32Array([1,1]),oversample:"none"});let B=[_,v,T],we=[y,g,w];const ae=new Float32Array(1);q.onaudioprocess=({inputBuffer:H})=>{const $s=[c(H,ae,0),c(H,ae,1),c(H,ae,2)];$s.some((Cn,bn)=>Cn!==B[bn])&&(b.setOrientation(...$s),B=$s);const Xs=[c(H,ae,3),c(H,ae,4),c(H,ae,5)];Xs.some((Cn,bn)=>Cn!==we[bn])&&(b.setPosition(...Xs),we=Xs)},Object.defineProperty(F.gain,"defaultValue",{get:()=>0}),Object.defineProperty(N.gain,"defaultValue",{get:()=>0}),Object.defineProperty(U.gain,"defaultValue",{get:()=>0}),Object.defineProperty(V.gain,"defaultValue",{get:()=>0}),Object.defineProperty(z.gain,"defaultValue",{get:()=>0});const $={get bufferSize(){},get channelCount(){return b.channelCount},set channelCount(H){if(H>2)throw o();R.channelCount=H,b.channelCount=H},get channelCountMode(){return b.channelCountMode},set channelCountMode(H){if(H==="max")throw o();R.channelCountMode=H,b.channelCountMode=H},get channelInterpretation(){return b.channelInterpretation},set channelInterpretation(H){R.channelInterpretation=H,b.channelInterpretation=H},get coneInnerAngle(){return b.coneInnerAngle},set coneInnerAngle(H){b.coneInnerAngle=H},get coneOuterAngle(){return b.coneOuterAngle},set coneOuterAngle(H){b.coneOuterAngle=H},get coneOuterGain(){return b.coneOuterGain},set coneOuterGain(H){if(H<0||H>1)throw e();b.coneOuterGain=H},get context(){return b.context},get distanceModel(){return b.distanceModel},set distanceModel(H){b.distanceModel=H},get inputs(){return[R]},get maxDistance(){return b.maxDistance},set maxDistance(H){if(H<0)throw new RangeError;b.maxDistance=H},get numberOfInputs(){return b.numberOfInputs},get numberOfOutputs(){return b.numberOfOutputs},get orientationX(){return P.gain},get orientationY(){return F.gain},get orientationZ(){return N.gain},get panningModel(){return b.panningModel},set panningModel(H){b.panningModel=H},get positionX(){return U.gain},get positionY(){return V.gain},get positionZ(){return z.gain},get refDistance(){return b.refDistance},set refDistance(H){if(H<0)throw new RangeError;b.refDistance=H},get rolloffFactor(){return b.rolloffFactor},set rolloffFactor(H){if(H<0)throw new RangeError;b.rolloffFactor=H},addEventListener(...H){return R.addEventListener(H[0],H[1],H[2])},dispatchEvent(...H){return R.dispatchEvent(H[0])},removeEventListener(...H){return R.removeEventListener(H[0],H[1],H[2])}};h!==$.coneInnerAngle&&($.coneInnerAngle=h),f!==$.coneOuterAngle&&($.coneOuterAngle=f),d!==$.coneOuterGain&&($.coneOuterGain=d),m!==$.distanceModel&&($.distanceModel=m),p!==$.maxDistance&&($.maxDistance=p),_!==$.orientationX.value&&($.orientationX.value=_),v!==$.orientationY.value&&($.orientationY.value=v),T!==$.orientationZ.value&&($.orientationZ.value=T),S!==$.panningModel&&($.panningModel=S),y!==$.positionX.value&&($.positionX.value=y),g!==$.positionY.value&&($.positionY.value=g),w!==$.positionZ.value&&($.positionZ.value=w),k!==$.refDistance&&($.refDistance=k),x!==$.rolloffFactor&&($.rolloffFactor=x),(B[0]!==1||B[1]!==0||B[2]!==0)&&b.setOrientation(...B),(we[0]!==0||we[1]!==0||we[2]!==0)&&b.setPosition(...we);const _e=()=>{R.connect(b),n(R,j,0,0),j.connect(P).connect(A,0,0),j.connect(F).connect(A,0,1),j.connect(N).connect(A,0,2),j.connect(U).connect(A,0,3),j.connect(V).connect(A,0,4),j.connect(z).connect(A,0,5),A.connect(q).connect(u.destination)},Ye=()=>{R.disconnect(b),a(R,j,0,0),j.disconnect(P),P.disconnect(A),j.disconnect(F),F.disconnect(A),j.disconnect(N),N.disconnect(A),j.disconnect(U),U.disconnect(A),j.disconnect(V),V.disconnect(A),j.disconnect(z),z.disconnect(A),A.disconnect(q),q.disconnect(u.destination)};return l(ci($,b),_e,Ye)},R1=n=>(e,{disableNormalization:t,imag:s,real:i})=>{const r=s instanceof Float32Array?s:new Float32Array(s),o=i instanceof Float32Array?i:new Float32Array(i),a=e.createPeriodicWave(o,r,{disableNormalization:t});if(Array.from(s).length<2)throw n();return a},xr=(n,e,t,s)=>n.createScriptProcessor(e,t,s),P1=(n,e)=>(t,s)=>{const i=s.channelCountMode;if(i==="clamped-max")throw e();if(t.createStereoPanner===void 0)return n(t,s);const r=t.createStereoPanner();return je(r,s),Me(r,s,"pan"),Object.defineProperty(r,"channelCountMode",{get:()=>i,set:o=>{if(o!==i)throw e()}}),r},I1=(n,e,t,s,i,r)=>{const a=new Float32Array([1,1]),c=Math.PI/2,l={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},u={...l,oversample:"none"},h=(m,p,_,v)=>{const T=new Float32Array(16385),S=new Float32Array(16385);for(let C=0;C<16385;C+=1){const b=C/16384*c;T[C]=Math.cos(b),S[C]=Math.sin(b)}const y=t(m,{...l,gain:0}),g=s(m,{...u,curve:T}),w=s(m,{...u,curve:a}),k=t(m,{...l,gain:0}),x=s(m,{...u,curve:S});return{connectGraph(){p.connect(y),p.connect(w.inputs===void 0?w:w.inputs[0]),p.connect(k),w.connect(_),_.connect(g.inputs===void 0?g:g.inputs[0]),_.connect(x.inputs===void 0?x:x.inputs[0]),g.connect(y.gain),x.connect(k.gain),y.connect(v,0,0),k.connect(v,0,1)},disconnectGraph(){p.disconnect(y),p.disconnect(w.inputs===void 0?w:w.inputs[0]),p.disconnect(k),w.disconnect(_),_.disconnect(g.inputs===void 0?g:g.inputs[0]),_.disconnect(x.inputs===void 0?x:x.inputs[0]),g.disconnect(y.gain),x.disconnect(k.gain),y.disconnect(v,0,0),k.disconnect(v,0,1)}}},f=(m,p,_,v)=>{const T=new Float32Array(16385),S=new Float32Array(16385),y=new Float32Array(16385),g=new Float32Array(16385),w=Math.floor(16385/2);for(let U=0;U<16385;U+=1)if(U>w){const V=(U-w)/(16384-w)*c;T[U]=Math.cos(V),S[U]=Math.sin(V),y[U]=0,g[U]=1}else{const V=U/(16384-w)*c;T[U]=1,S[U]=0,y[U]=Math.cos(V),g[U]=Math.sin(V)}const k=e(m,{channelCount:2,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:2}),x=t(m,{...l,gain:0}),C=s(m,{...u,curve:T}),b=t(m,{...l,gain:0}),O=s(m,{...u,curve:S}),A=s(m,{...u,curve:a}),R=t(m,{...l,gain:0}),P=s(m,{...u,curve:y}),F=t(m,{...l,gain:0}),N=s(m,{...u,curve:g});return{connectGraph(){p.connect(k),p.connect(A.inputs===void 0?A:A.inputs[0]),k.connect(x,0),k.connect(b,0),k.connect(R,1),k.connect(F,1),A.connect(_),_.connect(C.inputs===void 0?C:C.inputs[0]),_.connect(O.inputs===void 0?O:O.inputs[0]),_.connect(P.inputs===void 0?P:P.inputs[0]),_.connect(N.inputs===void 0?N:N.inputs[0]),C.connect(x.gain),O.connect(b.gain),P.connect(R.gain),N.connect(F.gain),x.connect(v,0,0),R.connect(v,0,0),b.connect(v,0,1),F.connect(v,0,1)},disconnectGraph(){p.disconnect(k),p.disconnect(A.inputs===void 0?A:A.inputs[0]),k.disconnect(x,0),k.disconnect(b,0),k.disconnect(R,1),k.disconnect(F,1),A.disconnect(_),_.disconnect(C.inputs===void 0?C:C.inputs[0]),_.disconnect(O.inputs===void 0?O:O.inputs[0]),_.disconnect(P.inputs===void 0?P:P.inputs[0]),_.disconnect(N.inputs===void 0?N:N.inputs[0]),C.disconnect(x.gain),O.disconnect(b.gain),P.disconnect(R.gain),N.disconnect(F.gain),x.disconnect(v,0,0),R.disconnect(v,0,0),b.disconnect(v,0,1),F.disconnect(v,0,1)}}},d=(m,p,_,v,T)=>{if(p===1)return h(m,_,v,T);if(p===2)return f(m,_,v,T);throw i()};return(m,{channelCount:p,channelCountMode:_,pan:v,...T})=>{if(_==="max")throw i();const S=n(m,{...T,channelCount:1,channelCountMode:_,numberOfInputs:2}),y=t(m,{...T,channelCount:p,channelCountMode:_,gain:1}),g=t(m,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:v});let{connectGraph:w,disconnectGraph:k}=d(m,p,y,g,S);Object.defineProperty(g.gain,"defaultValue",{get:()=>0}),Object.defineProperty(g.gain,"maxValue",{get:()=>1}),Object.defineProperty(g.gain,"minValue",{get:()=>-1});const x={get bufferSize(){},get channelCount(){return y.channelCount},set channelCount(A){y.channelCount!==A&&(C&&k(),{connectGraph:w,disconnectGraph:k}=d(m,A,y,g,S),C&&w()),y.channelCount=A},get channelCountMode(){return y.channelCountMode},set channelCountMode(A){if(A==="clamped-max"||A==="max")throw i();y.channelCountMode=A},get channelInterpretation(){return y.channelInterpretation},set channelInterpretation(A){y.channelInterpretation=A},get context(){return y.context},get inputs(){return[y]},get numberOfInputs(){return y.numberOfInputs},get numberOfOutputs(){return y.numberOfOutputs},get pan(){return g.gain},addEventListener(...A){return y.addEventListener(A[0],A[1],A[2])},dispatchEvent(...A){return y.dispatchEvent(A[0])},removeEventListener(...A){return y.removeEventListener(A[0],A[1],A[2])}};let C=!1;const b=()=>{w(),C=!0},O=()=>{k(),C=!1};return r(ci(x,S),b,O)}},N1=(n,e,t,s,i,r,o)=>(a,c)=>{const l=a.createWaveShaper();if(r!==null&&r.name==="webkitAudioContext"&&a.createGain().gain.automationRate===void 0)return t(a,c);je(l,c);const u=c.curve===null||c.curve instanceof Float32Array?c.curve:new Float32Array(c.curve);if(u!==null&&u.length<2)throw e();Se(l,{curve:u},"curve"),Se(l,c,"oversample");let h=null,f=!1;return o(l,"curve",p=>()=>p.call(l),p=>_=>(p.call(l,_),f&&(s(_)&&h===null?h=n(a,l):!s(_)&&h!==null&&(h(),h=null)),_)),i(l,()=>{f=!0,s(l.curve)&&(h=n(a,l))},()=>{f=!1,h!==null&&(h(),h=null)})},F1=(n,e,t,s,i)=>(r,{curve:o,oversample:a,...c})=>{const l=r.createWaveShaper(),u=r.createWaveShaper();je(l,c),je(u,c);const h=t(r,{...c,gain:1}),f=t(r,{...c,gain:-1}),d=t(r,{...c,gain:1}),m=t(r,{...c,gain:-1});let p=null,_=!1,v=null;const T={get bufferSize(){},get channelCount(){return l.channelCount},set channelCount(g){h.channelCount=g,f.channelCount=g,l.channelCount=g,d.channelCount=g,u.channelCount=g,m.channelCount=g},get channelCountMode(){return l.channelCountMode},set channelCountMode(g){h.channelCountMode=g,f.channelCountMode=g,l.channelCountMode=g,d.channelCountMode=g,u.channelCountMode=g,m.channelCountMode=g},get channelInterpretation(){return l.channelInterpretation},set channelInterpretation(g){h.channelInterpretation=g,f.channelInterpretation=g,l.channelInterpretation=g,d.channelInterpretation=g,u.channelInterpretation=g,m.channelInterpretation=g},get context(){return l.context},get curve(){return v},set curve(g){if(g!==null&&g.length<2)throw e();if(g===null)l.curve=g,u.curve=g;else{const w=g.length,k=new Float32Array(w+2-w%2),x=new Float32Array(w+2-w%2);k[0]=g[0],x[0]=-g[w-1];const C=Math.ceil((w+1)/2),b=(w+1)/2-1;for(let O=1;O<C;O+=1){const A=O/C*b,R=Math.floor(A),P=Math.ceil(A);k[O]=R===P?g[R]:(1-(A-R))*g[R]+(1-(P-A))*g[P],x[O]=R===P?-g[w-1-R]:-((1-(A-R))*g[w-1-R])-(1-(P-A))*g[w-1-P]}k[C]=w%2===1?g[C-1]:(g[C-2]+g[C-1])/2,l.curve=k,u.curve=x}v=g,_&&(s(v)&&p===null?p=n(r,h):p!==null&&(p(),p=null))},get inputs(){return[h]},get numberOfInputs(){return l.numberOfInputs},get numberOfOutputs(){return l.numberOfOutputs},get oversample(){return l.oversample},set oversample(g){l.oversample=g,u.oversample=g},addEventListener(...g){return h.addEventListener(g[0],g[1],g[2])},dispatchEvent(...g){return h.dispatchEvent(g[0])},removeEventListener(...g){return h.removeEventListener(g[0],g[1],g[2])}};o!==null&&(T.curve=o instanceof Float32Array?o:new Float32Array(o)),a!==T.oversample&&(T.oversample=a);const S=()=>{h.connect(l).connect(d),h.connect(f).connect(u).connect(m).connect(d),_=!0,s(v)&&(p=n(r,h))},y=()=>{h.disconnect(l),l.disconnect(d),h.disconnect(f),f.disconnect(u),u.disconnect(m),m.disconnect(d),_=!1,p!==null&&(p(),p=null)};return i(ci(T,d),S,y)},rt=()=>new DOMException("","NotSupportedError"),U1={numberOfChannels:1},L1=(n,e,t,s,i)=>class extends n{constructor(o,a,c){let l;if(typeof o=="number"&&a!==void 0&&c!==void 0)l={length:a,numberOfChannels:o,sampleRate:c};else if(typeof o=="object")l=o;else throw new Error("The given parameters are not valid.");const{length:u,numberOfChannels:h,sampleRate:f}={...U1,...l},d=s(h,u,f);e(zi,()=>zi(d))||d.addEventListener("statechange",(()=>{let m=0;const p=_=>{this._state==="running"&&(m>0?(d.removeEventListener("statechange",p),_.stopImmediatePropagation(),this._waitForThePromiseToSettle(_)):m+=1)};return p})()),super(d,h),this._length=u,this._nativeOfflineAudioContext=d,this._state=null}get length(){return this._nativeOfflineAudioContext.length===void 0?this._length:this._nativeOfflineAudioContext.length}get state(){return this._state===null?this._nativeOfflineAudioContext.state:this._state}startRendering(){return this._state==="running"?Promise.reject(t()):(this._state="running",i(this.destination,this._nativeOfflineAudioContext).finally(()=>{this._state=null,Hu(this)}))}_waitForThePromiseToSettle(o){this._state===null?this._nativeOfflineAudioContext.dispatchEvent(o):setTimeout(()=>this._waitForThePromiseToSettle(o))}},B1={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:440,periodicWave:void 0,type:"sine"},z1=(n,e,t,s,i,r,o)=>class extends n{constructor(c,l){const u=i(c),h={...B1,...l},f=t(u,h),d=r(u),m=d?s():null,p=c.sampleRate/2;super(c,!1,f,m),this._detune=e(this,d,f.detune,153600,-153600),this._frequency=e(this,d,f.frequency,p,-p),this._nativeOscillatorNode=f,this._onended=null,this._oscillatorNodeRenderer=m,this._oscillatorNodeRenderer!==null&&h.periodicWave!==void 0&&(this._oscillatorNodeRenderer.periodicWave=h.periodicWave)}get detune(){return this._detune}get frequency(){return this._frequency}get onended(){return this._onended}set onended(c){const l=typeof c=="function"?o(this,c):null;this._nativeOscillatorNode.onended=l;const u=this._nativeOscillatorNode.onended;this._onended=u!==null&&u===l?c:u}get type(){return this._nativeOscillatorNode.type}set type(c){this._nativeOscillatorNode.type=c,this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=null)}setPeriodicWave(c){this._nativeOscillatorNode.setPeriodicWave(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=c)}start(c=0){if(this._nativeOscillatorNode.start(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.start=c),this.context.state!=="closed"){$n(this);const l=()=>{this._nativeOscillatorNode.removeEventListener("ended",l),fs(this)&&_r(this)};this._nativeOscillatorNode.addEventListener("ended",l)}}stop(c=0){this._nativeOscillatorNode.stop(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.stop=c)}},V1=(n,e,t,s,i)=>()=>{const r=new WeakMap;let o=null,a=null,c=null;const l=async(u,h)=>{let f=t(u);const d=Je(f,h);if(!d){const m={channelCount:f.channelCount,channelCountMode:f.channelCountMode,channelInterpretation:f.channelInterpretation,detune:f.detune.value,frequency:f.frequency.value,periodicWave:o===null?void 0:o,type:f.type};f=e(h,m),a!==null&&f.start(a),c!==null&&f.stop(c)}return r.set(h,f),d?(await n(h,u.detune,f.detune),await n(h,u.frequency,f.frequency)):(await s(h,u.detune,f.detune),await s(h,u.frequency,f.frequency)),await i(u,h,f),f};return{set periodicWave(u){o=u},set start(u){a=u},set stop(u){c=u},render(u,h){const f=r.get(h);return f!==void 0?Promise.resolve(f):l(u,h)}}},j1={channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:1,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1},H1=(n,e,t,s,i,r,o)=>class extends n{constructor(c,l){const u=i(c),h={...j1,...l},f=t(u,h),d=r(u),m=d?s():null;super(c,!1,f,m),this._nativePannerNode=f,this._orientationX=e(this,d,f.orientationX,et,at),this._orientationY=e(this,d,f.orientationY,et,at),this._orientationZ=e(this,d,f.orientationZ,et,at),this._positionX=e(this,d,f.positionX,et,at),this._positionY=e(this,d,f.positionY,et,at),this._positionZ=e(this,d,f.positionZ,et,at),o(this,1)}get coneInnerAngle(){return this._nativePannerNode.coneInnerAngle}set coneInnerAngle(c){this._nativePannerNode.coneInnerAngle=c}get coneOuterAngle(){return this._nativePannerNode.coneOuterAngle}set coneOuterAngle(c){this._nativePannerNode.coneOuterAngle=c}get coneOuterGain(){return this._nativePannerNode.coneOuterGain}set coneOuterGain(c){this._nativePannerNode.coneOuterGain=c}get distanceModel(){return this._nativePannerNode.distanceModel}set distanceModel(c){this._nativePannerNode.distanceModel=c}get maxDistance(){return this._nativePannerNode.maxDistance}set maxDistance(c){this._nativePannerNode.maxDistance=c}get orientationX(){return this._orientationX}get orientationY(){return this._orientationY}get orientationZ(){return this._orientationZ}get panningModel(){return this._nativePannerNode.panningModel}set panningModel(c){this._nativePannerNode.panningModel=c}get positionX(){return this._positionX}get positionY(){return this._positionY}get positionZ(){return this._positionZ}get refDistance(){return this._nativePannerNode.refDistance}set refDistance(c){this._nativePannerNode.refDistance=c}get rolloffFactor(){return this._nativePannerNode.rolloffFactor}set rolloffFactor(c){this._nativePannerNode.rolloffFactor=c}},q1=(n,e,t,s,i,r,o,a,c,l)=>()=>{const u=new WeakMap;let h=null;const f=async(d,m)=>{let p=null,_=r(d);const v={channelCount:_.channelCount,channelCountMode:_.channelCountMode,channelInterpretation:_.channelInterpretation},T={...v,coneInnerAngle:_.coneInnerAngle,coneOuterAngle:_.coneOuterAngle,coneOuterGain:_.coneOuterGain,distanceModel:_.distanceModel,maxDistance:_.maxDistance,panningModel:_.panningModel,refDistance:_.refDistance,rolloffFactor:_.rolloffFactor},S=Je(_,m);if("bufferSize"in _)p=s(m,{...v,gain:1});else if(!S){const y={...T,orientationX:_.orientationX.value,orientationY:_.orientationY.value,orientationZ:_.orientationZ.value,positionX:_.positionX.value,positionY:_.positionY.value,positionZ:_.positionZ.value};_=i(m,y)}if(u.set(m,p===null?_:p),p!==null){if(h===null){if(o===null)throw new Error("Missing the native OfflineAudioContext constructor.");const O=new o(6,d.context.length,m.sampleRate),A=e(O,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6});A.connect(O.destination),h=(async()=>{const R=await Promise.all([d.orientationX,d.orientationY,d.orientationZ,d.positionX,d.positionY,d.positionZ].map(async(P,F)=>{const N=t(O,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:F===0?1:0});return await a(O,P,N.offset),N}));for(let P=0;P<6;P+=1)R[P].connect(A,0,P),R[P].start(0);return l(O)})()}const y=await h,g=s(m,{...v,gain:1});await c(d,m,g);const w=[];for(let O=0;O<y.numberOfChannels;O+=1)w.push(y.getChannelData(O));let k=[w[0][0],w[1][0],w[2][0]],x=[w[3][0],w[4][0],w[5][0]],C=s(m,{...v,gain:1}),b=i(m,{...T,orientationX:k[0],orientationY:k[1],orientationZ:k[2],positionX:x[0],positionY:x[1],positionZ:x[2]});g.connect(C).connect(b.inputs[0]),b.connect(p);for(let O=128;O<y.length;O+=128){const A=[w[0][O],w[1][O],w[2][O]],R=[w[3][O],w[4][O],w[5][O]];if(A.some((P,F)=>P!==k[F])||R.some((P,F)=>P!==x[F])){k=A,x=R;const P=O/m.sampleRate;C.gain.setValueAtTime(0,P),C=s(m,{...v,gain:0}),b=i(m,{...T,orientationX:k[0],orientationY:k[1],orientationZ:k[2],positionX:x[0],positionY:x[1],positionZ:x[2]}),C.gain.setValueAtTime(1,P),g.connect(C).connect(b.inputs[0]),b.connect(p)}}return p}return S?(await n(m,d.orientationX,_.orientationX),await n(m,d.orientationY,_.orientationY),await n(m,d.orientationZ,_.orientationZ),await n(m,d.positionX,_.positionX),await n(m,d.positionY,_.positionY),await n(m,d.positionZ,_.positionZ)):(await a(m,d.orientationX,_.orientationX),await a(m,d.orientationY,_.orientationY),await a(m,d.orientationZ,_.orientationZ),await a(m,d.positionX,_.positionX),await a(m,d.positionY,_.positionY),await a(m,d.positionZ,_.positionZ)),ai(_)?await c(d,m,_.inputs[0]):await c(d,m,_),_};return{render(d,m){const p=u.get(m);return p!==void 0?Promise.resolve(p):f(d,m)}}},W1={disableNormalization:!1},G1=(n,e,t,s)=>class Ju{constructor(r,o){const a=e(r),c=s({...W1,...o}),l=n(a,c);return t.add(l),l}static[Symbol.hasInstance](r){return r!==null&&typeof r=="object"&&Object.getPrototypeOf(r)===Ju.prototype||t.has(r)}},Y1=(n,e)=>(t,s,i)=>(n(s).replay(i),e(s,t,i)),Z1=(n,e,t)=>async(s,i,r)=>{const o=n(s);await Promise.all(o.activeInputs.map((a,c)=>Array.from(a).map(async([l,u])=>{const f=await e(l).render(l,i),d=s.context.destination;!t(l)&&(s!==d||!t(s))&&f.connect(r,u,c)})).reduce((a,c)=>[...a,...c],[]))},$1=(n,e,t)=>async(s,i,r)=>{const o=e(s);await Promise.all(Array.from(o.activeInputs).map(async([a,c])=>{const u=await n(a).render(a,i);t(a)||u.connect(r,c)}))},X1=(n,e,t,s)=>i=>n(zi,()=>zi(i))?Promise.resolve(n(s,s)).then(r=>{if(!r){const o=t(i,512,0,1);i.oncomplete=()=>{o.onaudioprocess=null,o.disconnect()},o.onaudioprocess=()=>i.currentTime,o.connect(i.destination)}return i.startRendering()}):new Promise(r=>{const o=e(i,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});i.oncomplete=a=>{o.disconnect(),r(a.renderedBuffer)},o.connect(i.destination),i.startRendering()}),Q1=n=>(e,t)=>{n.set(e,t)},K1=n=>(e,t)=>n.set(e,t),J1=(n,e,t,s,i,r,o,a)=>(c,l)=>t(c).render(c,l).then(()=>Promise.all(Array.from(s(l)).map(u=>t(u).render(u,l)))).then(()=>i(l)).then(u=>(typeof u.copyFromChannel!="function"?(o(u),oc(u)):e(r,()=>r(u))||a(u),n.add(u),u)),ev={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",pan:0},tv=(n,e,t,s,i,r)=>class extends n{constructor(a,c){const l=i(a),u={...ev,...c},h=t(l,u),f=r(l),d=f?s():null;super(a,!1,h,d),this._pan=e(this,f,h.pan)}get pan(){return this._pan}},sv=(n,e,t,s,i)=>()=>{const r=new WeakMap,o=async(a,c)=>{let l=t(a);const u=Je(l,c);if(!u){const h={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,pan:l.pan.value};l=e(c,h)}return r.set(c,l),u?await n(c,a.pan,l.pan):await s(c,a.pan,l.pan),ai(l)?await i(a,c,l.inputs[0]):await i(a,c,l),l};return{render(a,c){const l=r.get(c);return l!==void 0?Promise.resolve(l):o(a,c)}}},nv=n=>()=>{if(n===null)return!1;try{new n({length:1,sampleRate:44100})}catch{return!1}return!0},iv=(n,e)=>async()=>{if(n===null)return!0;if(e===null)return!1;const t=new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),s=new e(1,128,44100),i=URL.createObjectURL(t);let r=!1,o=!1;try{await s.audioWorklet.addModule(i);const a=new n(s,"a",{numberOfOutputs:0}),c=s.createOscillator();a.port.onmessage=()=>r=!0,a.onprocessorerror=()=>o=!0,c.connect(a),c.start(0),await s.startRendering(),await new Promise(l=>setTimeout(l))}catch{}finally{URL.revokeObjectURL(i)}return r&&!o},rv=(n,e)=>()=>{if(e===null)return Promise.resolve(!1);const t=new e(1,1,44100),s=n(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise(i=>{t.oncomplete=()=>{s.disconnect(),i(t.currentTime!==0)},t.startRendering()})},ov=()=>new DOMException("","UnknownError"),av={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",curve:null,oversample:"none"},cv=(n,e,t,s,i,r,o)=>class extends n{constructor(c,l){const u=i(c),h={...av,...l},f=t(u,h),m=r(u)?s():null;super(c,!0,f,m),this._isCurveNullified=!1,this._nativeWaveShaperNode=f,o(this,1)}get curve(){return this._isCurveNullified?null:this._nativeWaveShaperNode.curve}set curve(c){if(c===null)this._isCurveNullified=!0,this._nativeWaveShaperNode.curve=new Float32Array([0,0]);else{if(c.length<2)throw e();this._isCurveNullified=!1,this._nativeWaveShaperNode.curve=c}}get oversample(){return this._nativeWaveShaperNode.oversample}set oversample(c){this._nativeWaveShaperNode.oversample=c}},lv=(n,e,t)=>()=>{const s=new WeakMap,i=async(r,o)=>{let a=e(r);if(!Je(a,o)){const l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,curve:a.curve,oversample:a.oversample};a=n(o,l)}return s.set(o,a),ai(a)?await t(r,o,a.inputs[0]):await t(r,o,a),a};return{render(r,o){const a=s.get(o);return a!==void 0?Promise.resolve(a):i(r,o)}}},uv=()=>typeof window>"u"?null:window,hv=(n,e)=>t=>{t.copyFromChannel=(s,i,r=0)=>{const o=n(r),a=n(i);if(a>=t.numberOfChannels)throw e();const c=t.length,l=t.getChannelData(a),u=s.length;for(let h=o<0?-o:0;h+o<c&&h<u;h+=1)s[h]=l[h+o]},t.copyToChannel=(s,i,r=0)=>{const o=n(r),a=n(i);if(a>=t.numberOfChannels)throw e();const c=t.length,l=t.getChannelData(a),u=s.length;for(let h=o<0?-o:0;h+o<c&&h<u;h+=1)l[h+o]=s[h]}},dv=n=>e=>{e.copyFromChannel=(t=>(s,i,r=0)=>{const o=n(r),a=n(i);if(o<e.length)return t.call(e,s,a,o)})(e.copyFromChannel),e.copyToChannel=(t=>(s,i,r=0)=>{const o=n(r),a=n(i);if(o<e.length)return t.call(e,s,a,o)})(e.copyToChannel)},fv=n=>(e,t)=>{const s=t.createBuffer(1,1,44100);e.buffer===null&&(e.buffer=s),n(e,"buffer",i=>()=>{const r=i.call(e);return r===s?null:r},i=>r=>i.call(e,r===null?s:r))},pv=(n,e)=>(t,s)=>{s.channelCount=1,s.channelCountMode="explicit",Object.defineProperty(s,"channelCount",{get:()=>1,set:()=>{throw n()}}),Object.defineProperty(s,"channelCountMode",{get:()=>"explicit",set:()=>{throw n()}});const i=t.createBufferSource();e(s,()=>{const a=s.numberOfInputs;for(let c=0;c<a;c+=1)i.connect(s,0,c)},()=>i.disconnect(s))},eh=(n,e,t)=>n.copyFromChannel===void 0?n.getChannelData(t)[0]:(n.copyFromChannel(e,t),e[0]),th=n=>{if(n===null)return!1;const e=n.length;return e%2!==0?n[Math.floor(e/2)]!==0:n[e/2-1]+n[e/2]!==0},Tr=(n,e,t,s)=>{let i=n;for(;!i.hasOwnProperty(e);)i=Object.getPrototypeOf(i);const{get:r,set:o}=Object.getOwnPropertyDescriptor(i,e);Object.defineProperty(n,e,{get:t(r),set:s(o)})},mv=n=>({...n,outputChannelCount:n.outputChannelCount!==void 0?n.outputChannelCount:n.numberOfInputs===1&&n.numberOfOutputs===1?[n.channelCount]:Array.from({length:n.numberOfOutputs},()=>1)}),_v=n=>({...n,channelCount:n.numberOfOutputs}),gv=n=>{const{imag:e,real:t}=n;return e===void 0?t===void 0?{...n,imag:[0,0],real:[0,0]}:{...n,imag:Array.from(t,()=>0),real:t}:t===void 0?{...n,imag:e,real:Array.from(e,()=>0)}:{...n,imag:e,real:t}},sh=(n,e,t)=>{try{n.setValueAtTime(e,t)}catch(s){if(s.code!==9)throw s;sh(n,e,t+1e-7)}},vv=n=>{const e=n.createBufferSource();e.start();try{e.start()}catch{return!0}return!1},yv=n=>{const e=n.createBufferSource(),t=n.createBuffer(1,1,44100);e.buffer=t;try{e.start(0,1)}catch{return!1}return!0},xv=n=>{const e=n.createBufferSource();e.start();try{e.stop()}catch{return!1}return!0},hc=n=>{const e=n.createOscillator();try{e.start(-1)}catch(t){return t instanceof RangeError}return!1},nh=n=>{const e=n.createBuffer(1,1,44100),t=n.createBufferSource();t.buffer=e,t.start(),t.stop();try{return t.stop(),!0}catch{return!1}},dc=n=>{const e=n.createOscillator();try{e.stop(-1)}catch(t){return t instanceof RangeError}return!1},Tv=n=>{const{port1:e,port2:t}=new MessageChannel;try{e.postMessage(n)}finally{e.close(),t.close()}},wv=n=>{n.start=(e=>(t=0,s=0,i)=>{const r=n.buffer,o=r===null?s:Math.min(r.duration,s);r!==null&&o>r.duration-.5/n.context.sampleRate?e.call(n,t,0,0):e.call(n,t,o,i)})(n.start)},ih=(n,e)=>{const t=e.createGain();n.connect(t);const s=(i=>()=>{i.call(n,t),n.removeEventListener("ended",s)})(n.disconnect);n.addEventListener("ended",s),ci(n,t),n.stop=(i=>{let r=!1;return(o=0)=>{if(r)try{i.call(n,o)}catch{t.gain.setValueAtTime(0,o)}else i.call(n,o),r=!0}})(n.stop)},li=(n,e)=>t=>{const s={value:n};return Object.defineProperties(t,{currentTarget:s,target:s}),typeof e=="function"?e.call(n,t):e.handleEvent.call(n,t)},kv=Hm(Tn),Sv=$m(Tn),Cv=ag(Po),rh=new WeakMap,bv=Cg(rh),jt=U_(new Map,new WeakMap),Qt=uv(),oh=t1(jt,ts),fc=Sg(st),Ze=Z1(st,fc,fn),Ev=e_(oh,ke,Ze),xe=Og(Ro),ws=O1(Qt),he=Wg(ws),ah=new WeakMap,ch=gg(li),wr=r1(Qt),pc=Vg(wr),mc=jg(Qt),lh=Hg(Qt),Vi=a1(Qt),Be=C_(qm(Fu),Zm(kv,Sv,to,Cv,so,st,bv,mr,ke,Tn,fs,fn,qr),jt,Fg(ba,so,st,ke,Bi,fs),ts,Io,rt,ng(to,ba,st,ke,Bi,xe,fs,he),ug(ah,st,Bt),ch,xe,pc,mc,lh,he,Vi),Ov=Jm(Be,Ev,ts,oh,xe,he),_c=new WeakSet,Fl=s1(Qt),uh=X_(new Uint32Array(1)),gc=hv(uh,ts),vc=dv(uh),hh=s_(_c,jt,rt,Fl,ws,nv(Fl),gc,vc),No=Xm(ft),dh=$1(fc,gr,fn),ss=q_(dh),ui=i1(No,jt,vv,yv,xv,hc,nh,dc,wv,fv(Tr),ih),ns=Y1(bg(gr),dh),Av=r_(ss,ui,ke,ns,Ze),Ht=b_(Wm(Uu),ah,rc,E_,Um,Lm,Bm,zm,Vm,ka,Iu,wr,sh),Mv=i_(Be,Av,Ht,We,ui,xe,he,li),Dv=p_(Be,m_,ts,We,o1(ft,Tr),xe,he,Ze),Rv=F_(ss,Qu,ke,ns,Ze),wn=K1(rh),Pv=N_(Be,Ht,Rv,Io,Qu,xe,he,wn),Gs=Jg(Tn,mc),Iv=pv(We,Gs),Ys=p1(wr,Iv),Nv=z_(Ys,ke,Ze),Fv=B_(Be,Nv,Ys,xe,he),Uv=H_(yr,ke,Ze),Lv=j_(Be,Uv,yr,xe,he,_v),Bv=g1(No,ui,ft,Gs),hi=_1(No,jt,Bv,hc,dc),zv=$_(ss,hi,ke,ns,Ze),Vv=Z_(Be,Ht,zv,hi,xe,he,li),fh=v1(rt,Tr),jv=J_(fh,ke,Ze),Hv=K_(Be,jv,fh,xe,he,wn),qv=og(ss,Ku,ke,ns,Ze),Wv=rg(Be,Ht,qv,Ku,xe,he,wn),ph=y1(rt),Gv=pg(ss,ph,ke,ns,Ze),Yv=fg(Be,Ht,Gv,ph,rt,xe,he,wn),Zv=wg(ss,ft,ke,ns,Ze),$v=Tg(Be,Ht,Zv,ft,xe,he),Xv=k1(Io,We,xr,rt),Fo=X1(jt,ft,xr,rv(ft,ws)),Qv=Ng(ui,ke,ws,Ze,Fo),Kv=x1(Xv),Jv=Pg(Be,Kv,Qv,xe,he,wn),ey=__(Ht,Ys,hi,xr,rt,eh,he,Tr),mh=new WeakMap,ty=Kg(Dv,ey,ch,he,mh,li),_h=A1(No,jt,hc,nh,dc,ih),sy=V1(ss,_h,ke,ns,Ze),ny=z1(Be,Ht,_h,sy,xe,he,li),gh=G_(ui),iy=F1(gh,We,ft,th,Gs),Uo=N1(gh,We,iy,th,Gs,wr,Tr),ry=D1(to,We,Ys,ft,xr,Uo,rt,so,eh,Gs),vh=M1(ry),oy=q1(ss,Ys,hi,ft,vh,ke,ws,ns,Ze,Fo),ay=H1(Be,Ht,vh,oy,xe,he,wn),cy=R1(ts),ly=G1(cy,xe,new WeakSet,gv),uy=I1(Ys,yr,ft,Uo,rt,Gs),yh=P1(uy,rt),hy=sv(ss,yh,ke,ns,Ze),dy=tv(Be,Ht,yh,hy,xe,he),fy=lv(Uo,ke,Ze),py=cv(Be,We,Uo,fy,xe,he,wn),xh=Gg(Qt),yc=vg(Qt),Th=new WeakMap,my=Ag(Th,ws),_y=xh?Ym(jt,rt,_g(Qt),yc,yg(jm),xe,my,he,Vi,new WeakMap,new WeakMap,iv(Vi,ws),Qt):void 0,gy=qg(pc,he),vy=sg(_c,jt,tg,mg,new WeakSet,xe,gy,Jr,zi,gc,vc),wh=P_(_y,Ov,hh,Mv,Pv,Fv,Lv,Vv,Hv,vy,Wv,Yv,$v,Jv,ty,ny,ay,ly,dy,py),yy=Yg(Be,S1,xe,he),xy=$g(Be,C1,xe,he),Ty=Xg(Be,b1,xe,he),wy=E1(We,he),ky=Qg(Be,wy,xe),Sy=f_(wh,We,rt,ov,yy,xy,Ty,ky,wr),xc=Mg(mh),Cy=Qm(xc),kh=W_(ts),by=cg(xc),Sh=hg(ts),Ch=new WeakMap,Ey=kg(Ch,Bt),Oy=f1(kh,ts,We,Ys,yr,hi,ft,xr,rt,Sh,yc,Ey,Gs),Ay=l1(We,Oy,ft,rt,Gs),My=R_(ss,kh,ui,Ys,yr,hi,ft,by,Sh,yc,ke,Vi,ws,ns,Ze,Fo),Dy=Eg(Th),Ry=Q1(Ch),Ul=xh?A_(Cy,Be,Ht,My,Ay,st,Dy,xe,he,Vi,mv,Ry,Tv,li):void 0,Py=eg(rt,ws),Iy=J1(_c,jt,fc,xc,Fo,Jr,gc,vc),Ny=L1(wh,jt,We,Py,Iy),Fy=Ug(Ro,pc),Uy=Lg(ic,mc),Ly=Bg(rc,lh),By=zg(Ro,he);function yt(n){return typeof n>"u"}function te(n){return!yt(n)}function zy(n){return typeof n=="function"}function Bs(n){return typeof n=="number"}function an(n){return Object.prototype.toString.call(n)==="[object Object]"&&n.constructor===Object}function Vy(n){return typeof n=="boolean"}function Lt(n){return Array.isArray(n)}function ms(n){return typeof n=="string"}function Lr(n){return ms(n)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(n)}function K(n,e){if(!n)throw new Error(e)}function zt(n,e,t=1/0){if(!(e<=n&&n<=t))throw new RangeError(`Value must be within [${e}, ${t}], got: ${n}`)}function bh(n){!n.isOffline&&n.state!=="running"&&Tc('The AudioContext is "suspended". Invoke Tone.start() from a user action to start the audio.')}let Eh=!1,Ll=!1;function Bl(n){Eh=n}function jy(n){yt(n)&&Eh&&!Ll&&(Ll=!0,Tc("Events scheduled inside of scheduled callbacks should use the passed in scheduling time. See https://github.com/Tonejs/Tone.js/wiki/Accurate-Timing"))}let Oh=console;function Hy(...n){Oh.log(...n)}function Tc(...n){Oh.warn(...n)}function qy(n){return new Sy(n)}function Wy(n,e,t){return new Ny(n,e,t)}const cn=typeof self=="object"?self:null,Gy=cn&&(cn.hasOwnProperty("AudioContext")||cn.hasOwnProperty("webkitAudioContext"));function Yy(n,e,t){return K(te(Ul),"This node only works in a secure context (https or localhost)"),new Ul(n,e,t)}class Zy{constructor(e,t,s,i){this._callback=e,this._type=t,this._minimumUpdateInterval=Math.max(128/(i||44100),.001),this.updateInterval=s,this._createClock()}_createWorker(){const e=new Blob([`
			// the initial timeout time
			let timeoutTime =  ${(this._updateInterval*1e3).toFixed(1)};
			// onmessage callback
			self.onmessage = function(msg){
				timeoutTime = parseInt(msg.data);
			};
			// the tick function which posts a message
			// and schedules a new tick
			function tick(){
				setTimeout(tick, timeoutTime);
				self.postMessage('tick');
			}
			// call tick initially
			tick();
			`],{type:"text/javascript"}),t=URL.createObjectURL(e),s=new Worker(t);s.onmessage=this._callback.bind(this),this._worker=s}_createTimeout(){this._timeout=setTimeout(()=>{this._createTimeout(),this._callback()},this._updateInterval*1e3)}_createClock(){if(this._type==="worker")try{this._createWorker()}catch{this._type="timeout",this._createClock()}else this._type==="timeout"&&this._createTimeout()}_disposeClock(){this._timeout&&clearTimeout(this._timeout),this._worker&&(this._worker.terminate(),this._worker.onmessage=null)}get updateInterval(){return this._updateInterval}set updateInterval(e){var t;this._updateInterval=Math.max(e,this._minimumUpdateInterval),this._type==="worker"&&((t=this._worker)===null||t===void 0||t.postMessage(this._updateInterval*1e3))}get type(){return this._type}set type(e){this._disposeClock(),this._type=e,this._createClock()}dispose(){this._disposeClock()}}function pn(n){return Ly(n)}function Fs(n){return Uy(n)}function Wr(n){return By(n)}function Nn(n){return Fy(n)}function $y(n){return n instanceof hh}function Xy(n,e){return n==="value"||pn(e)||Fs(e)||$y(e)}function Vn(n,...e){if(!e.length)return n;const t=e.shift();if(an(n)&&an(t))for(const s in t)Xy(s,t[s])?n[s]=t[s]:an(t[s])?(n[s]||Object.assign(n,{[s]:{}}),Vn(n[s],t[s])):Object.assign(n,{[s]:t[s]});return Vn(n,...e)}function Qy(n,e){return n.length===e.length&&n.every((t,s)=>e[s]===t)}function I(n,e,t=[],s){const i={},r=Array.from(e);if(an(r[0])&&s&&!Reflect.has(r[0],s)&&(Object.keys(r[0]).some(a=>Reflect.has(n,a))||(Vn(i,{[s]:r[0]}),t.splice(t.indexOf(s),1),r.shift())),r.length===1&&an(r[0]))Vn(i,r[0]);else for(let o=0;o<t.length;o++)te(r[o])&&(i[t[o]]=r[o]);return Vn(n,i)}function Ky(n){return n.constructor.getDefaults()}function jn(n,e){return yt(n)?e:n}function Un(n,e){return e.forEach(t=>{Reflect.has(n,t)&&delete n[t]}),n}/**
 * Tone.js
 * @author Yotam Mann
 * @license http://opensource.org/licenses/MIT MIT License
 * @copyright 2014-2019 Yotam Mann
 */class ks{constructor(){this.debug=!1,this._wasDisposed=!1}static getDefaults(){return{}}log(...e){(this.debug||cn&&this.toString()===cn.TONE_DEBUG_CLASS)&&Hy(this,...e)}dispose(){return this._wasDisposed=!0,this}get disposed(){return this._wasDisposed}toString(){return this.name}}ks.version=Pu;const wc=1e-6;function Xn(n,e){return n>e+wc}function Da(n,e){return Xn(n,e)||Nt(n,e)}function oo(n,e){return n+wc<e}function Nt(n,e){return Math.abs(n-e)<wc}function Jy(n,e,t){return Math.max(Math.min(n,t),e)}let $t=class Ah extends ks{constructor(){super(),this.name="Timeline",this._timeline=[];const e=I(Ah.getDefaults(),arguments,["memory"]);this.memory=e.memory,this.increasing=e.increasing}static getDefaults(){return{memory:1/0,increasing:!1}}get length(){return this._timeline.length}add(e){if(K(Reflect.has(e,"time"),"Timeline: events must have a time attribute"),e.time=e.time.valueOf(),this.increasing&&this.length){const t=this._timeline[this.length-1];K(Da(e.time,t.time),"The time must be greater than or equal to the last scheduled time"),this._timeline.push(e)}else{const t=this._search(e.time);this._timeline.splice(t+1,0,e)}if(this.length>this.memory){const t=this.length-this.memory;this._timeline.splice(0,t)}return this}remove(e){const t=this._timeline.indexOf(e);return t!==-1&&this._timeline.splice(t,1),this}get(e,t="time"){const s=this._search(e,t);return s!==-1?this._timeline[s]:null}peek(){return this._timeline[0]}shift(){return this._timeline.shift()}getAfter(e,t="time"){const s=this._search(e,t);return s+1<this._timeline.length?this._timeline[s+1]:null}getBefore(e){const t=this._timeline.length;if(t>0&&this._timeline[t-1].time<e)return this._timeline[t-1];const s=this._search(e);return s-1>=0?this._timeline[s-1]:null}cancel(e){if(this._timeline.length>1){let t=this._search(e);if(t>=0)if(Nt(this._timeline[t].time,e)){for(let s=t;s>=0&&Nt(this._timeline[s].time,e);s--)t=s;this._timeline=this._timeline.slice(0,t)}else this._timeline=this._timeline.slice(0,t+1);else this._timeline=[]}else this._timeline.length===1&&Da(this._timeline[0].time,e)&&(this._timeline=[]);return this}cancelBefore(e){const t=this._search(e);return t>=0&&(this._timeline=this._timeline.slice(t+1)),this}previousEvent(e){const t=this._timeline.indexOf(e);return t>0?this._timeline[t-1]:null}_search(e,t="time"){if(this._timeline.length===0)return-1;let s=0;const i=this._timeline.length;let r=i;if(i>0&&this._timeline[i-1][t]<=e)return i-1;for(;s<r;){let o=Math.floor(s+(r-s)/2);const a=this._timeline[o],c=this._timeline[o+1];if(Nt(a[t],e)){for(let l=o;l<this._timeline.length;l++){const u=this._timeline[l];if(Nt(u[t],e))o=l;else break}return o}else{if(oo(a[t],e)&&Xn(c[t],e))return o;Xn(a[t],e)?r=o:s=o+1}}return-1}_iterate(e,t=0,s=this._timeline.length-1){this._timeline.slice(t,s+1).forEach(e)}forEach(e){return this._iterate(e),this}forEachBefore(e,t){const s=this._search(e);return s!==-1&&this._iterate(t,0,s),this}forEachAfter(e,t){const s=this._search(e);return this._iterate(t,s+1),this}forEachBetween(e,t,s){let i=this._search(e),r=this._search(t);return i!==-1&&r!==-1?(this._timeline[i].time!==e&&(i+=1),this._timeline[r].time===t&&(r-=1),this._iterate(s,i,r)):i===-1&&this._iterate(s,0,r),this}forEachFrom(e,t){let s=this._search(e);for(;s>=0&&this._timeline[s].time>=e;)s--;return this._iterate(t,s+1),this}forEachAtTime(e,t){const s=this._search(e);if(s!==-1&&Nt(this._timeline[s].time,e)){let i=s;for(let r=s;r>=0&&Nt(this._timeline[r].time,e);r--)i=r;this._iterate(r=>{t(r)},i,s)}return this}dispose(){return super.dispose(),this._timeline=[],this}};const Mh=[];function Lo(n){Mh.push(n)}function ex(n){Mh.forEach(e=>e(n))}const Dh=[];function Bo(n){Dh.push(n)}function tx(n){Dh.forEach(e=>e(n))}class kr extends ks{constructor(){super(...arguments),this.name="Emitter"}on(e,t){return e.split(/\W+/).forEach(i=>{yt(this._events)&&(this._events={}),this._events.hasOwnProperty(i)||(this._events[i]=[]),this._events[i].push(t)}),this}once(e,t){const s=(...i)=>{t(...i),this.off(e,s)};return this.on(e,s),this}off(e,t){return e.split(/\W+/).forEach(i=>{if(yt(this._events)&&(this._events={}),this._events.hasOwnProperty(i))if(yt(t))this._events[i]=[];else{const r=this._events[i];for(let o=r.length-1;o>=0;o--)r[o]===t&&r.splice(o,1)}}),this}emit(e,...t){if(this._events&&this._events.hasOwnProperty(e)){const s=this._events[e].slice(0);for(let i=0,r=s.length;i<r;i++)s[i].apply(this,t)}return this}static mixin(e){["on","once","off","emit"].forEach(t=>{const s=Object.getOwnPropertyDescriptor(kr.prototype,t);Object.defineProperty(e.prototype,t,s)})}dispose(){return super.dispose(),this._events=void 0,this}}class Rh extends kr{constructor(){super(...arguments),this.isOffline=!1}toJSON(){return{}}}let kc=class Ph extends Rh{constructor(){var e,t;super(),this.name="Context",this._constants=new Map,this._timeouts=new $t,this._timeoutIds=0,this._initialized=!1,this._closeStarted=!1,this.isOffline=!1,this._workletPromise=null;const s=I(Ph.getDefaults(),arguments,["context"]);s.context?(this._context=s.context,this._latencyHint=((e=arguments[0])===null||e===void 0?void 0:e.latencyHint)||""):(this._context=qy({latencyHint:s.latencyHint}),this._latencyHint=s.latencyHint),this._ticker=new Zy(this.emit.bind(this,"tick"),s.clockSource,s.updateInterval,this._context.sampleRate),this.on("tick",this._timeoutLoop.bind(this)),this._context.onstatechange=()=>{this.emit("statechange",this.state)},this[!((t=arguments[0])===null||t===void 0)&&t.hasOwnProperty("updateInterval")?"_lookAhead":"lookAhead"]=s.lookAhead}static getDefaults(){return{clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.05}}initialize(){return this._initialized||(ex(this),this._initialized=!0),this}createAnalyser(){return this._context.createAnalyser()}createOscillator(){return this._context.createOscillator()}createBufferSource(){return this._context.createBufferSource()}createBiquadFilter(){return this._context.createBiquadFilter()}createBuffer(e,t,s){return this._context.createBuffer(e,t,s)}createChannelMerger(e){return this._context.createChannelMerger(e)}createChannelSplitter(e){return this._context.createChannelSplitter(e)}createConstantSource(){return this._context.createConstantSource()}createConvolver(){return this._context.createConvolver()}createDelay(e){return this._context.createDelay(e)}createDynamicsCompressor(){return this._context.createDynamicsCompressor()}createGain(){return this._context.createGain()}createIIRFilter(e,t){return this._context.createIIRFilter(e,t)}createPanner(){return this._context.createPanner()}createPeriodicWave(e,t,s){return this._context.createPeriodicWave(e,t,s)}createStereoPanner(){return this._context.createStereoPanner()}createWaveShaper(){return this._context.createWaveShaper()}createMediaStreamSource(e){return K(Nn(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamSource(e)}createMediaElementSource(e){return K(Nn(this._context),"Not available if OfflineAudioContext"),this._context.createMediaElementSource(e)}createMediaStreamDestination(){return K(Nn(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamDestination()}decodeAudioData(e){return this._context.decodeAudioData(e)}get currentTime(){return this._context.currentTime}get state(){return this._context.state}get sampleRate(){return this._context.sampleRate}get listener(){return this.initialize(),this._listener}set listener(e){K(!this._initialized,"The listener cannot be set after initialization."),this._listener=e}get transport(){return this.initialize(),this._transport}set transport(e){K(!this._initialized,"The transport cannot be set after initialization."),this._transport=e}get draw(){return this.initialize(),this._draw}set draw(e){K(!this._initialized,"Draw cannot be set after initialization."),this._draw=e}get destination(){return this.initialize(),this._destination}set destination(e){K(!this._initialized,"The destination cannot be set after initialization."),this._destination=e}createAudioWorkletNode(e,t){return Yy(this.rawContext,e,t)}addAudioWorkletModule(e){return Ue(this,void 0,void 0,function*(){K(te(this.rawContext.audioWorklet),"AudioWorkletNode is only available in a secure context (https or localhost)"),this._workletPromise||(this._workletPromise=this.rawContext.audioWorklet.addModule(e)),yield this._workletPromise})}workletsAreReady(){return Ue(this,void 0,void 0,function*(){(yield this._workletPromise)?this._workletPromise:Promise.resolve()})}get updateInterval(){return this._ticker.updateInterval}set updateInterval(e){this._ticker.updateInterval=e}get clockSource(){return this._ticker.type}set clockSource(e){this._ticker.type=e}get lookAhead(){return this._lookAhead}set lookAhead(e){this._lookAhead=e,this.updateInterval=e?e/2:.01}get latencyHint(){return this._latencyHint}get rawContext(){return this._context}now(){return this._context.currentTime+this._lookAhead}immediate(){return this._context.currentTime}resume(){return Nn(this._context)?this._context.resume():Promise.resolve()}close(){return Ue(this,void 0,void 0,function*(){Nn(this._context)&&this.state!=="closed"&&!this._closeStarted&&(this._closeStarted=!0,yield this._context.close()),this._initialized&&tx(this)})}getConstant(e){if(this._constants.has(e))return this._constants.get(e);{const t=this._context.createBuffer(1,128,this._context.sampleRate),s=t.getChannelData(0);for(let r=0;r<s.length;r++)s[r]=e;const i=this._context.createBufferSource();return i.channelCount=1,i.channelCountMode="explicit",i.buffer=t,i.loop=!0,i.start(0),this._constants.set(e,i),i}}dispose(){return super.dispose(),this._ticker.dispose(),this._timeouts.dispose(),Object.keys(this._constants).map(e=>this._constants[e].disconnect()),this.close(),this}_timeoutLoop(){const e=this.now();let t=this._timeouts.peek();for(;this._timeouts.length&&t&&t.time<=e;)t.callback(),this._timeouts.shift(),t=this._timeouts.peek()}setTimeout(e,t){this._timeoutIds++;const s=this.now();return this._timeouts.add({callback:e,id:this._timeoutIds,time:s+t}),this._timeoutIds}clearTimeout(e){return this._timeouts.forEach(t=>{t.id===e&&this._timeouts.remove(t)}),this}clearInterval(e){return this.clearTimeout(e)}setInterval(e,t){const s=++this._timeoutIds,i=()=>{const r=this.now();this._timeouts.add({callback:()=>{e(),i()},id:s,time:r+t})};return i(),s}};class sx extends Rh{constructor(){super(...arguments),this.lookAhead=0,this.latencyHint=0,this.isOffline=!1}createAnalyser(){return{}}createOscillator(){return{}}createBufferSource(){return{}}createBiquadFilter(){return{}}createBuffer(e,t,s){return{}}createChannelMerger(e){return{}}createChannelSplitter(e){return{}}createConstantSource(){return{}}createConvolver(){return{}}createDelay(e){return{}}createDynamicsCompressor(){return{}}createGain(){return{}}createIIRFilter(e,t){return{}}createPanner(){return{}}createPeriodicWave(e,t,s){return{}}createStereoPanner(){return{}}createWaveShaper(){return{}}createMediaStreamSource(e){return{}}createMediaElementSource(e){return{}}createMediaStreamDestination(){return{}}decodeAudioData(e){return Promise.resolve({})}createAudioWorkletNode(e,t){return{}}get rawContext(){return{}}addAudioWorkletModule(e){return Ue(this,void 0,void 0,function*(){return Promise.resolve()})}resume(){return Promise.resolve()}setTimeout(e,t){return 0}clearTimeout(e){return this}setInterval(e,t){return 0}clearInterval(e){return this}getConstant(e){return{}}get currentTime(){return 0}get state(){return{}}get sampleRate(){return 0}get listener(){return{}}get transport(){return{}}get draw(){return{}}set draw(e){}get destination(){return{}}set destination(e){}now(){return 0}immediate(){return 0}}function Te(n,e){Lt(e)?e.forEach(t=>Te(n,t)):Object.defineProperty(n,e,{enumerable:!0,writable:!1})}function Sc(n,e){Lt(e)?e.forEach(t=>Sc(n,t)):Object.defineProperty(n,e,{writable:!0})}const ce=()=>{};class le extends ks{constructor(){super(),this.name="ToneAudioBuffer",this.onload=ce;const e=I(le.getDefaults(),arguments,["url","onload","onerror"]);this.reverse=e.reverse,this.onload=e.onload,ms(e.url)?this.load(e.url).catch(e.onerror):e.url&&this.set(e.url)}static getDefaults(){return{onerror:ce,onload:ce,reverse:!1}}get sampleRate(){return this._buffer?this._buffer.sampleRate:Ft().sampleRate}set(e){return e instanceof le?e.loaded?this._buffer=e.get():e.onload=()=>{this.set(e),this.onload(this)}:this._buffer=e,this._reversed&&this._reverse(),this}get(){return this._buffer}load(e){return Ue(this,void 0,void 0,function*(){const t=le.load(e).then(s=>{this.set(s),this.onload(this)});le.downloads.push(t);try{yield t}finally{const s=le.downloads.indexOf(t);le.downloads.splice(s,1)}return this})}dispose(){return super.dispose(),this._buffer=void 0,this}fromArray(e){const t=Lt(e)&&e[0].length>0,s=t?e.length:1,i=t?e[0].length:e.length,r=Ft(),o=r.createBuffer(s,i,r.sampleRate),a=!t&&s===1?[e]:e;for(let c=0;c<s;c++)o.copyToChannel(a[c],c);return this._buffer=o,this}toMono(e){if(Bs(e))this.fromArray(this.toArray(e));else{let t=new Float32Array(this.length);const s=this.numberOfChannels;for(let i=0;i<s;i++){const r=this.toArray(i);for(let o=0;o<r.length;o++)t[o]+=r[o]}t=t.map(i=>i/s),this.fromArray(t)}return this}toArray(e){if(Bs(e))return this.getChannelData(e);if(this.numberOfChannels===1)return this.toArray(0);{const t=[];for(let s=0;s<this.numberOfChannels;s++)t[s]=this.getChannelData(s);return t}}getChannelData(e){return this._buffer?this._buffer.getChannelData(e):new Float32Array(0)}slice(e,t=this.duration){K(this.loaded,"Buffer is not loaded");const s=Math.floor(e*this.sampleRate),i=Math.floor(t*this.sampleRate);K(s<i,"The start time must be less than the end time");const r=i-s,o=Ft().createBuffer(this.numberOfChannels,r,this.sampleRate);for(let a=0;a<this.numberOfChannels;a++)o.copyToChannel(this.getChannelData(a).subarray(s,i),a);return new le(o)}_reverse(){if(this.loaded)for(let e=0;e<this.numberOfChannels;e++)this.getChannelData(e).reverse();return this}get loaded(){return this.length>0}get duration(){return this._buffer?this._buffer.duration:0}get length(){return this._buffer?this._buffer.length:0}get numberOfChannels(){return this._buffer?this._buffer.numberOfChannels:0}get reverse(){return this._reversed}set reverse(e){this._reversed!==e&&(this._reversed=e,this._reverse())}static fromArray(e){return new le().fromArray(e)}static fromUrl(e){return Ue(this,void 0,void 0,function*(){return yield new le().load(e)})}static load(e){return Ue(this,void 0,void 0,function*(){const t=e.match(/\[([^\]\[]+\|.+)\]$/);if(t){const c=t[1].split("|");let l=c[0];for(const u of c)if(le.supportsType(u)){l=u;break}e=e.replace(t[0],l)}const s=le.baseUrl===""||le.baseUrl.endsWith("/")?le.baseUrl:le.baseUrl+"/",i=document.createElement("a");i.href=s+e,i.pathname=(i.pathname+i.hash).split("/").map(encodeURIComponent).join("/");const r=yield fetch(i.href);if(!r.ok)throw new Error(`could not load url: ${e}`);const o=yield r.arrayBuffer();return yield Ft().decodeAudioData(o)})}static supportsType(e){const t=e.split("."),s=t[t.length-1];return document.createElement("audio").canPlayType("audio/"+s)!==""}static loaded(){return Ue(this,void 0,void 0,function*(){for(yield Promise.resolve();le.downloads.length;)yield le.downloads[0]})}}le.baseUrl="";le.downloads=[];class zo extends kc{constructor(){super({clockSource:"offline",context:Wr(arguments[0])?arguments[0]:Wy(arguments[0],arguments[1]*arguments[2],arguments[2]),lookAhead:0,updateInterval:Wr(arguments[0])?128/arguments[0].sampleRate:128/arguments[2]}),this.name="OfflineContext",this._currentTime=0,this.isOffline=!0,this._duration=Wr(arguments[0])?arguments[0].length/arguments[0].sampleRate:arguments[1]}now(){return this._currentTime}get currentTime(){return this._currentTime}_renderClock(e){return Ue(this,void 0,void 0,function*(){let t=0;for(;this._duration-this._currentTime>=0;){this.emit("tick"),this._currentTime+=128/this.sampleRate,t++;const s=Math.floor(this.sampleRate/128);e&&t%s===0&&(yield new Promise(i=>setTimeout(i,1)))}})}render(e=!0){return Ue(this,void 0,void 0,function*(){yield this.workletsAreReady(),yield this._renderClock(e);const t=yield this._context.startRendering();return new le(t)})}close(){return Promise.resolve()}}const Ih=new sx;let nn=Ih;function Ft(){return nn===Ih&&Gy&&nx(new kc),nn}function nx(n,e=!1){e&&nn.dispose(),Nn(n)?nn=new kc(n):Wr(n)?nn=new zo(n):nn=n}function ix(){return nn.resume()}if(cn&&!cn.TONE_SILENCE_LOGGING){const e=` * Tone.js v${Pu} * `;console.log(`%c${e}`,"background: #000; color: #fff")}function rx(n){return Math.pow(10,n/20)}function ox(n){return 20*(Math.log(n)/Math.LN10)}function Nh(n){return Math.pow(2,n/12)}let Vo=440;function ax(){return Vo}function cx(n){Vo=n}function Ra(n){return Math.round(Fh(n))}function Fh(n){return 69+12*Math.log2(n/Vo)}function lx(n){return Vo*Math.pow(2,(n-69)/12)}class Cc extends ks{constructor(e,t,s){super(),this.defaultUnits="s",this._val=t,this._units=s,this.context=e,this._expressions=this._getExpressions()}_getExpressions(){return{hz:{method:e=>this._frequencyToUnits(parseFloat(e)),regexp:/^(\d+(?:\.\d+)?)hz$/i},i:{method:e=>this._ticksToUnits(parseInt(e,10)),regexp:/^(\d+)i$/i},m:{method:e=>this._beatsToUnits(parseInt(e,10)*this._getTimeSignature()),regexp:/^(\d+)m$/i},n:{method:(e,t)=>{const s=parseInt(e,10),i=t==="."?1.5:1;return s===1?this._beatsToUnits(this._getTimeSignature())*i:this._beatsToUnits(4/s)*i},regexp:/^(\d+)n(\.?)$/i},number:{method:e=>this._expressions[this.defaultUnits].method.call(this,e),regexp:/^(\d+(?:\.\d+)?)$/},s:{method:e=>this._secondsToUnits(parseFloat(e)),regexp:/^(\d+(?:\.\d+)?)s$/},samples:{method:e=>parseInt(e,10)/this.context.sampleRate,regexp:/^(\d+)samples$/},t:{method:e=>{const t=parseInt(e,10);return this._beatsToUnits(8/(Math.floor(t)*3))},regexp:/^(\d+)t$/i},tr:{method:(e,t,s)=>{let i=0;return e&&e!=="0"&&(i+=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),t&&t!=="0"&&(i+=this._beatsToUnits(parseFloat(t))),s&&s!=="0"&&(i+=this._beatsToUnits(parseFloat(s)/4)),i},regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/}}}valueOf(){if(this._val instanceof Cc&&this.fromType(this._val),yt(this._val))return this._noArg();if(ms(this._val)&&yt(this._units)){for(const e in this._expressions)if(this._expressions[e].regexp.test(this._val.trim())){this._units=e;break}}else if(an(this._val)){let e=0;for(const t in this._val)if(te(this._val[t])){const s=this._val[t],i=new this.constructor(this.context,t).valueOf()*s;e+=i}return e}if(te(this._units)){const e=this._expressions[this._units],t=this._val.toString().trim().match(e.regexp);return t?e.method.apply(this,t.slice(1)):e.method.call(this,this._val)}else return ms(this._val)?parseFloat(this._val):this._val}_frequencyToUnits(e){return 1/e}_beatsToUnits(e){return 60/this._getBpm()*e}_secondsToUnits(e){return e}_ticksToUnits(e){return e*this._beatsToUnits(1)/this._getPPQ()}_noArg(){return this._now()}_getBpm(){return this.context.transport.bpm.value}_getTimeSignature(){return this.context.transport.timeSignature}_getPPQ(){return this.context.transport.PPQ}fromType(e){switch(this._units=void 0,this.defaultUnits){case"s":this._val=e.toSeconds();break;case"i":this._val=e.toTicks();break;case"hz":this._val=e.toFrequency();break;case"midi":this._val=e.toMidi();break}return this}toFrequency(){return 1/this.toSeconds()}toSamples(){return this.toSeconds()*this.context.sampleRate}toMilliseconds(){return this.toSeconds()*1e3}}class Ut extends Cc{constructor(){super(...arguments),this.name="TimeClass"}_getExpressions(){return Object.assign(super._getExpressions(),{now:{method:e=>this._now()+new this.constructor(this.context,e).valueOf(),regexp:/^\+(.+)/},quantize:{method:e=>{const t=new Ut(this.context,e).valueOf();return this._secondsToUnits(this.context.transport.nextSubdivision(t))},regexp:/^@(.+)/}})}quantize(e,t=1){const s=new this.constructor(this.context,e).valueOf(),i=this.valueOf(),a=Math.round(i/s)*s-i;return i+a*t}toNotation(){const e=this.toSeconds(),t=["1m"];for(let r=1;r<9;r++){const o=Math.pow(2,r);t.push(o+"n."),t.push(o+"n"),t.push(o+"t")}t.push("0");let s=t[0],i=new Ut(this.context,t[0]).toSeconds();return t.forEach(r=>{const o=new Ut(this.context,r).toSeconds();Math.abs(o-e)<Math.abs(i-e)&&(s=r,i=o)}),s}toBarsBeatsSixteenths(){const e=this._beatsToUnits(1);let t=this.valueOf()/e;t=parseFloat(t.toFixed(4));const s=Math.floor(t/this._getTimeSignature());let i=t%1*4;t=Math.floor(t)%this._getTimeSignature();const r=i.toString();return r.length>3&&(i=parseFloat(parseFloat(r).toFixed(3))),[s,t,i].join(":")}toTicks(){const e=this._beatsToUnits(1);return this.valueOf()/e*this._getPPQ()}toSeconds(){return this.valueOf()}toMidi(){return Ra(this.toFrequency())}_now(){return this.context.now()}}class Et extends Ut{constructor(){super(...arguments),this.name="Frequency",this.defaultUnits="hz"}static get A4(){return ax()}static set A4(e){cx(e)}_getExpressions(){return Object.assign({},super._getExpressions(),{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method(e){return this.defaultUnits==="midi"?e:Et.mtof(e)}},note:{regexp:/^([a-g]{1}(?:b|#|##|x|bb|###|#x|x#|bbb)?)(-?[0-9]+)/i,method(e,t){const i=ux[e.toLowerCase()]+(parseInt(t,10)+1)*12;return this.defaultUnits==="midi"?i:Et.mtof(i)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method(e,t,s){let i=1;return e&&e!=="0"&&(i*=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),t&&t!=="0"&&(i*=this._beatsToUnits(parseFloat(t))),s&&s!=="0"&&(i*=this._beatsToUnits(parseFloat(s)/4)),i}}})}transpose(e){return new Et(this.context,this.valueOf()*Nh(e))}harmonize(e){return e.map(t=>this.transpose(t))}toMidi(){return Ra(this.valueOf())}toNote(){const e=this.toFrequency(),t=Math.log2(e/Et.A4);let s=Math.round(12*t)+57;const i=Math.floor(s/12);return i<0&&(s+=-12*i),hx[s%12]+i.toString()}toSeconds(){return 1/super.toSeconds()}toTicks(){const e=this._beatsToUnits(1),t=this.valueOf()/e;return Math.floor(t*this._getPPQ())}_noArg(){return 0}_frequencyToUnits(e){return e}_ticksToUnits(e){return 1/(e*60/(this._getBpm()*this._getPPQ()))}_beatsToUnits(e){return 1/super._beatsToUnits(e)}_secondsToUnits(e){return 1/e}static mtof(e){return lx(e)}static ftom(e){return Ra(e)}}const ux={cbbb:-3,cbb:-2,cb:-1,c:0,"c#":1,cx:2,"c##":2,"c###":3,"cx#":3,"c#x":3,dbbb:-1,dbb:0,db:1,d:2,"d#":3,dx:4,"d##":4,"d###":5,"dx#":5,"d#x":5,ebbb:1,ebb:2,eb:3,e:4,"e#":5,ex:6,"e##":6,"e###":7,"ex#":7,"e#x":7,fbbb:2,fbb:3,fb:4,f:5,"f#":6,fx:7,"f##":7,"f###":8,"fx#":8,"f#x":8,gbbb:4,gbb:5,gb:6,g:7,"g#":8,gx:9,"g##":9,"g###":10,"gx#":10,"g#x":10,abbb:6,abb:7,ab:8,a:9,"a#":10,ax:11,"a##":11,"a###":12,"ax#":12,"a#x":12,bbbb:8,bbb:9,bb:10,b:11,"b#":12,bx:13,"b##":13,"b###":14,"bx#":14,"b#x":14},hx=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];class Ii extends Ut{constructor(){super(...arguments),this.name="TransportTime"}_now(){return this.context.transport.seconds}}class ct extends ks{constructor(){super();const e=I(ct.getDefaults(),arguments,["context"]);this.defaultContext?this.context=this.defaultContext:this.context=e.context}static getDefaults(){return{context:Ft()}}now(){return this.context.currentTime+this.context.lookAhead}immediate(){return this.context.currentTime}get sampleTime(){return 1/this.context.sampleRate}get blockTime(){return 128/this.context.sampleRate}toSeconds(e){return jy(e),new Ut(this.context,e).toSeconds()}toFrequency(e){return new Et(this.context,e).toFrequency()}toTicks(e){return new Ii(this.context,e).toTicks()}_getPartialProperties(e){const t=this.get();return Object.keys(t).forEach(s=>{yt(e[s])&&delete t[s]}),t}get(){const e=Ky(this);return Object.keys(e).forEach(t=>{if(Reflect.has(this,t)){const s=this[t];te(s)&&te(s.value)&&te(s.setValueAtTime)?e[t]=s.value:s instanceof ct?e[t]=s._getPartialProperties(e[t]):Lt(s)||Bs(s)||ms(s)||Vy(s)?e[t]=s:delete e[t]}}),e}set(e){return Object.keys(e).forEach(t=>{Reflect.has(this,t)&&te(this[t])&&(this[t]&&te(this[t].value)&&te(this[t].setValueAtTime)?this[t].value!==e[t]&&(this[t].value=e[t]):this[t]instanceof ct?this[t].set(e[t]):this[t]=e[t])}),this}}class bc extends $t{constructor(e="stopped"){super(),this.name="StateTimeline",this._initial=e,this.setStateAtTime(this._initial,0)}getValueAtTime(e){const t=this.get(e);return t!==null?t.state:this._initial}setStateAtTime(e,t,s){return zt(t,0),this.add(Object.assign({},s,{state:e,time:t})),this}getLastState(e,t){const s=this._search(t);for(let i=s;i>=0;i--){const r=this._timeline[i];if(r.state===e)return r}}getNextState(e,t){const s=this._search(t);if(s!==-1)for(let i=s;i<this._timeline.length;i++){const r=this._timeline[i];if(r.state===e)return r}}}class ue extends ct{constructor(){super(I(ue.getDefaults(),arguments,["param","units","convert"])),this.name="Param",this.overridden=!1,this._minOutput=1e-7;const e=I(ue.getDefaults(),arguments,["param","units","convert"]);for(K(te(e.param)&&(pn(e.param)||e.param instanceof ue),"param must be an AudioParam");!pn(e.param);)e.param=e.param._param;this._swappable=te(e.swappable)?e.swappable:!1,this._swappable?(this.input=this.context.createGain(),this._param=e.param,this.input.connect(this._param)):this._param=this.input=e.param,this._events=new $t(1e3),this._initialValue=this._param.defaultValue,this.units=e.units,this.convert=e.convert,this._minValue=e.minValue,this._maxValue=e.maxValue,te(e.value)&&e.value!==this._toType(this._initialValue)&&this.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(ct.getDefaults(),{convert:!0,units:"number"})}get value(){const e=this.now();return this.getValueAtTime(e)}set value(e){this.cancelScheduledValues(this.now()),this.setValueAtTime(e,this.now())}get minValue(){return te(this._minValue)?this._minValue:this.units==="time"||this.units==="frequency"||this.units==="normalRange"||this.units==="positive"||this.units==="transportTime"||this.units==="ticks"||this.units==="bpm"||this.units==="hertz"||this.units==="samples"?0:this.units==="audioRange"?-1:this.units==="decibels"?-1/0:this._param.minValue}get maxValue(){return te(this._maxValue)?this._maxValue:this.units==="normalRange"||this.units==="audioRange"?1:this._param.maxValue}_is(e,t){return this.units===t}_assertRange(e){return te(this.maxValue)&&te(this.minValue)&&zt(e,this._fromType(this.minValue),this._fromType(this.maxValue)),e}_fromType(e){return this.convert&&!this.overridden?this._is(e,"time")?this.toSeconds(e):this._is(e,"decibels")?rx(e):this._is(e,"frequency")?this.toFrequency(e):e:this.overridden?0:e}_toType(e){return this.convert&&this.units==="decibels"?ox(e):e}setValueAtTime(e,t){const s=this.toSeconds(t),i=this._fromType(e);return K(isFinite(i)&&isFinite(s),`Invalid argument(s) to setValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._assertRange(i),this.log(this.units,"setValueAtTime",e,s),this._events.add({time:s,type:"setValueAtTime",value:i}),this._param.setValueAtTime(i,s),this}getValueAtTime(e){const t=Math.max(this.toSeconds(e),0),s=this._events.getAfter(t),i=this._events.get(t);let r=this._initialValue;if(i===null)r=this._initialValue;else if(i.type==="setTargetAtTime"&&(s===null||s.type==="setValueAtTime")){const o=this._events.getBefore(i.time);let a;o===null?a=this._initialValue:a=o.value,i.type==="setTargetAtTime"&&(r=this._exponentialApproach(i.time,a,i.value,i.constant,t))}else if(s===null)r=i.value;else if(s.type==="linearRampToValueAtTime"||s.type==="exponentialRampToValueAtTime"){let o=i.value;if(i.type==="setTargetAtTime"){const a=this._events.getBefore(i.time);a===null?o=this._initialValue:o=a.value}s.type==="linearRampToValueAtTime"?r=this._linearInterpolate(i.time,o,s.time,s.value,t):r=this._exponentialInterpolate(i.time,o,s.time,s.value,t)}else r=i.value;return this._toType(r)}setRampPoint(e){e=this.toSeconds(e);let t=this.getValueAtTime(e);return this.cancelAndHoldAtTime(e),this._fromType(t)===0&&(t=this._toType(this._minOutput)),this.setValueAtTime(t,e),this}linearRampToValueAtTime(e,t){const s=this._fromType(e),i=this.toSeconds(t);return K(isFinite(s)&&isFinite(i),`Invalid argument(s) to linearRampToValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._assertRange(s),this._events.add({time:i,type:"linearRampToValueAtTime",value:s}),this.log(this.units,"linearRampToValueAtTime",e,i),this._param.linearRampToValueAtTime(s,i),this}exponentialRampToValueAtTime(e,t){let s=this._fromType(e);s=Nt(s,0)?this._minOutput:s,this._assertRange(s);const i=this.toSeconds(t);return K(isFinite(s)&&isFinite(i),`Invalid argument(s) to exponentialRampToValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._events.add({time:i,type:"exponentialRampToValueAtTime",value:s}),this.log(this.units,"exponentialRampToValueAtTime",e,i),this._param.exponentialRampToValueAtTime(s,i),this}exponentialRampTo(e,t,s){return s=this.toSeconds(s),this.setRampPoint(s),this.exponentialRampToValueAtTime(e,s+this.toSeconds(t)),this}linearRampTo(e,t,s){return s=this.toSeconds(s),this.setRampPoint(s),this.linearRampToValueAtTime(e,s+this.toSeconds(t)),this}targetRampTo(e,t,s){return s=this.toSeconds(s),this.setRampPoint(s),this.exponentialApproachValueAtTime(e,s,t),this}exponentialApproachValueAtTime(e,t,s){t=this.toSeconds(t),s=this.toSeconds(s);const i=Math.log(s+1)/Math.log(200);return this.setTargetAtTime(e,t,i),this.cancelAndHoldAtTime(t+s*.9),this.linearRampToValueAtTime(e,t+s),this}setTargetAtTime(e,t,s){const i=this._fromType(e);K(isFinite(s)&&s>0,"timeConstant must be a number greater than 0");const r=this.toSeconds(t);return this._assertRange(i),K(isFinite(i)&&isFinite(r),`Invalid argument(s) to setTargetAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._events.add({constant:s,time:r,type:"setTargetAtTime",value:i}),this.log(this.units,"setTargetAtTime",e,r,s),this._param.setTargetAtTime(i,r,s),this}setValueCurveAtTime(e,t,s,i=1){s=this.toSeconds(s),t=this.toSeconds(t);const r=this._fromType(e[0])*i;this.setValueAtTime(this._toType(r),t);const o=s/(e.length-1);for(let a=1;a<e.length;a++){const c=this._fromType(e[a])*i;this.linearRampToValueAtTime(this._toType(c),t+a*o)}return this}cancelScheduledValues(e){const t=this.toSeconds(e);return K(isFinite(t),`Invalid argument to cancelScheduledValues: ${JSON.stringify(e)}`),this._events.cancel(t),this._param.cancelScheduledValues(t),this.log(this.units,"cancelScheduledValues",t),this}cancelAndHoldAtTime(e){const t=this.toSeconds(e),s=this._fromType(this.getValueAtTime(t));K(isFinite(t),`Invalid argument to cancelAndHoldAtTime: ${JSON.stringify(e)}`),this.log(this.units,"cancelAndHoldAtTime",t,"value="+s);const i=this._events.get(t),r=this._events.getAfter(t);return i&&Nt(i.time,t)?r?(this._param.cancelScheduledValues(r.time),this._events.cancel(r.time)):(this._param.cancelAndHoldAtTime(t),this._events.cancel(t+this.sampleTime)):r&&(this._param.cancelScheduledValues(r.time),this._events.cancel(r.time),r.type==="linearRampToValueAtTime"?this.linearRampToValueAtTime(this._toType(s),t):r.type==="exponentialRampToValueAtTime"&&this.exponentialRampToValueAtTime(this._toType(s),t)),this._events.add({time:t,type:"setValueAtTime",value:s}),this._param.setValueAtTime(s,t),this}rampTo(e,t=.1,s){return this.units==="frequency"||this.units==="bpm"||this.units==="decibels"?this.exponentialRampTo(e,t,s):this.linearRampTo(e,t,s),this}apply(e){const t=this.context.currentTime;e.setValueAtTime(this.getValueAtTime(t),t);const s=this._events.get(t);if(s&&s.type==="setTargetAtTime"){const i=this._events.getAfter(s.time),r=i?i.time:t+2,o=(r-t)/10;for(let a=t;a<r;a+=o)e.linearRampToValueAtTime(this.getValueAtTime(a),a)}return this._events.forEachAfter(this.context.currentTime,i=>{i.type==="cancelScheduledValues"?e.cancelScheduledValues(i.time):i.type==="setTargetAtTime"?e.setTargetAtTime(i.value,i.time,i.constant):e[i.type](i.value,i.time)}),this}setParam(e){K(this._swappable,"The Param must be assigned as 'swappable' in the constructor");const t=this.input;return t.disconnect(this._param),this.apply(e),this._param=e,t.connect(this._param),this}dispose(){return super.dispose(),this._events.dispose(),this}get defaultValue(){return this._toType(this._param.defaultValue)}_exponentialApproach(e,t,s,i,r){return s+(t-s)*Math.exp(-(r-e)/i)}_linearInterpolate(e,t,s,i,r){return t+(i-t)*((r-e)/(s-e))}_exponentialInterpolate(e,t,s,i,r){return t*Math.pow(i/t,(r-e)/(s-e))}}class W extends ct{constructor(){super(...arguments),this._internalChannels=[]}get numberOfInputs(){return te(this.input)?pn(this.input)||this.input instanceof ue?1:this.input.numberOfInputs:0}get numberOfOutputs(){return te(this.output)?this.output.numberOfOutputs:0}_isAudioNode(e){return te(e)&&(e instanceof W||Fs(e))}_getInternalNodes(){const e=this._internalChannels.slice(0);return this._isAudioNode(this.input)&&e.push(this.input),this._isAudioNode(this.output)&&this.input!==this.output&&e.push(this.output),e}_setChannelProperties(e){this._getInternalNodes().forEach(s=>{s.channelCount=e.channelCount,s.channelCountMode=e.channelCountMode,s.channelInterpretation=e.channelInterpretation})}_getChannelProperties(){const e=this._getInternalNodes();K(e.length>0,"ToneAudioNode does not have any internal nodes");const t=e[0];return{channelCount:t.channelCount,channelCountMode:t.channelCountMode,channelInterpretation:t.channelInterpretation}}get channelCount(){return this._getChannelProperties().channelCount}set channelCount(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelCount:e}))}get channelCountMode(){return this._getChannelProperties().channelCountMode}set channelCountMode(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelCountMode:e}))}get channelInterpretation(){return this._getChannelProperties().channelInterpretation}set channelInterpretation(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelInterpretation:e}))}connect(e,t=0,s=0){return zs(this,e,t,s),this}toDestination(){return this.connect(this.context.destination),this}toMaster(){return Tc("toMaster() has been renamed toDestination()"),this.toDestination()}disconnect(e,t=0,s=0){return dx(this,e,t,s),this}chain(...e){return ji(this,...e),this}fan(...e){return e.forEach(t=>this.connect(t)),this}dispose(){return super.dispose(),te(this.input)&&(this.input instanceof W?this.input.dispose():Fs(this.input)&&this.input.disconnect()),te(this.output)&&(this.output instanceof W?this.output.dispose():Fs(this.output)&&this.output.disconnect()),this._internalChannels=[],this}}function ji(...n){const e=n.shift();n.reduce((t,s)=>(t instanceof W?t.connect(s):Fs(t)&&zs(t,s),s),e)}function zs(n,e,t=0,s=0){for(K(te(n),"Cannot connect from undefined node"),K(te(e),"Cannot connect to undefined node"),(e instanceof W||Fs(e))&&K(e.numberOfInputs>0,"Cannot connect to node with no inputs"),K(n.numberOfOutputs>0,"Cannot connect from node with no outputs");e instanceof W||e instanceof ue;)te(e.input)&&(e=e.input);for(;n instanceof W;)te(n.output)&&(n=n.output);pn(e)?n.connect(e,t):n.connect(e,t,s)}function dx(n,e,t=0,s=0){if(te(e))for(;e instanceof W;)e=e.input;for(;!Fs(n);)te(n.output)&&(n=n.output);pn(e)?n.disconnect(e,t):Fs(e)?n.disconnect(e,t,s):n.disconnect()}class me extends W{constructor(){super(I(me.getDefaults(),arguments,["gain","units"])),this.name="Gain",this._gainNode=this.context.createGain(),this.input=this._gainNode,this.output=this._gainNode;const e=I(me.getDefaults(),arguments,["gain","units"]);this.gain=new ue({context:this.context,convert:e.convert,param:this._gainNode.gain,units:e.units,value:e.gain,minValue:e.minValue,maxValue:e.maxValue}),Te(this,"gain")}static getDefaults(){return Object.assign(W.getDefaults(),{convert:!0,gain:1,units:"gain"})}dispose(){return super.dispose(),this._gainNode.disconnect(),this.gain.dispose(),this}}class Qn extends W{constructor(e){super(e),this.onended=ce,this._startTime=-1,this._stopTime=-1,this._timeout=-1,this.output=new me({context:this.context,gain:0}),this._gainNode=this.output,this.getStateAtTime=function(t){const s=this.toSeconds(t);return this._startTime!==-1&&s>=this._startTime&&(this._stopTime===-1||s<=this._stopTime)?"started":"stopped"},this._fadeIn=e.fadeIn,this._fadeOut=e.fadeOut,this._curve=e.curve,this.onended=e.onended}static getDefaults(){return Object.assign(W.getDefaults(),{curve:"linear",fadeIn:0,fadeOut:0,onended:ce})}_startGain(e,t=1){K(this._startTime===-1,"Source cannot be started more than once");const s=this.toSeconds(this._fadeIn);return this._startTime=e+s,this._startTime=Math.max(this._startTime,this.context.currentTime),s>0?(this._gainNode.gain.setValueAtTime(0,e),this._curve==="linear"?this._gainNode.gain.linearRampToValueAtTime(t,e+s):this._gainNode.gain.exponentialApproachValueAtTime(t,e,s)):this._gainNode.gain.setValueAtTime(t,e),this}stop(e){return this.log("stop",e),this._stopGain(this.toSeconds(e)),this}_stopGain(e){K(this._startTime!==-1,"'start' must be called before 'stop'"),this.cancelStop();const t=this.toSeconds(this._fadeOut);return this._stopTime=this.toSeconds(e)+t,this._stopTime=Math.max(this._stopTime,this.now()),t>0?this._curve==="linear"?this._gainNode.gain.linearRampTo(0,t,e):this._gainNode.gain.targetRampTo(0,t,e):(this._gainNode.gain.cancelAndHoldAtTime(e),this._gainNode.gain.setValueAtTime(0,e)),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout(()=>{const s=this._curve==="exponential"?t*2:0;this._stopSource(this.now()+s),this._onended()},this._stopTime-this.context.currentTime),this}_onended(){if(this.onended!==ce&&(this.onended(this),this.onended=ce,!this.context.isOffline)){const e=()=>this.dispose();typeof window.requestIdleCallback<"u"?window.requestIdleCallback(e):setTimeout(e,1e3)}}get state(){return this.getStateAtTime(this.now())}cancelStop(){return this.log("cancelStop"),K(this._startTime!==-1,"Source is not started"),this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this.context.clearTimeout(this._timeout),this._stopTime=-1,this}dispose(){return super.dispose(),this._gainNode.dispose(),this.onended=ce,this}}class ao extends Qn{constructor(){super(I(ao.getDefaults(),arguments,["offset"])),this.name="ToneConstantSource",this._source=this.context.createConstantSource();const e=I(ao.getDefaults(),arguments,["offset"]);zs(this._source,this._gainNode),this.offset=new ue({context:this.context,convert:e.convert,param:this._source.offset,units:e.units,value:e.offset,minValue:e.minValue,maxValue:e.maxValue})}static getDefaults(){return Object.assign(Qn.getDefaults(),{convert:!0,offset:1,units:"number"})}start(e){const t=this.toSeconds(e);return this.log("start",t),this._startGain(t),this._source.start(t),this}_stopSource(e){this._source.stop(e)}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._source.disconnect(),this.offset.dispose(),this}}class ye extends W{constructor(){super(I(ye.getDefaults(),arguments,["value","units"])),this.name="Signal",this.override=!0;const e=I(ye.getDefaults(),arguments,["value","units"]);this.output=this._constantSource=new ao({context:this.context,convert:e.convert,offset:e.value,units:e.units,minValue:e.minValue,maxValue:e.maxValue}),this._constantSource.start(0),this.input=this._param=this._constantSource.offset}static getDefaults(){return Object.assign(W.getDefaults(),{convert:!0,units:"number",value:0})}connect(e,t=0,s=0){return Ec(this,e,t,s),this}dispose(){return super.dispose(),this._param.dispose(),this._constantSource.dispose(),this}setValueAtTime(e,t){return this._param.setValueAtTime(e,t),this}getValueAtTime(e){return this._param.getValueAtTime(e)}setRampPoint(e){return this._param.setRampPoint(e),this}linearRampToValueAtTime(e,t){return this._param.linearRampToValueAtTime(e,t),this}exponentialRampToValueAtTime(e,t){return this._param.exponentialRampToValueAtTime(e,t),this}exponentialRampTo(e,t,s){return this._param.exponentialRampTo(e,t,s),this}linearRampTo(e,t,s){return this._param.linearRampTo(e,t,s),this}targetRampTo(e,t,s){return this._param.targetRampTo(e,t,s),this}exponentialApproachValueAtTime(e,t,s){return this._param.exponentialApproachValueAtTime(e,t,s),this}setTargetAtTime(e,t,s){return this._param.setTargetAtTime(e,t,s),this}setValueCurveAtTime(e,t,s,i){return this._param.setValueCurveAtTime(e,t,s,i),this}cancelScheduledValues(e){return this._param.cancelScheduledValues(e),this}cancelAndHoldAtTime(e){return this._param.cancelAndHoldAtTime(e),this}rampTo(e,t,s){return this._param.rampTo(e,t,s),this}get value(){return this._param.value}set value(e){this._param.value=e}get convert(){return this._param.convert}set convert(e){this._param.convert=e}get units(){return this._param.units}get overridden(){return this._param.overridden}set overridden(e){this._param.overridden=e}get maxValue(){return this._param.maxValue}get minValue(){return this._param.minValue}apply(e){return this._param.apply(e),this}}function Ec(n,e,t,s){(e instanceof ue||pn(e)||e instanceof ye&&e.override)&&(e.cancelScheduledValues(0),e.setValueAtTime(0,0),e instanceof ye&&(e.overridden=!0)),zs(n,e,t,s)}class co extends ue{constructor(){super(I(co.getDefaults(),arguments,["value"])),this.name="TickParam",this._events=new $t(1/0),this._multiplier=1;const e=I(co.getDefaults(),arguments,["value"]);this._multiplier=e.multiplier,this._events.cancel(0),this._events.add({ticks:0,time:0,type:"setValueAtTime",value:this._fromType(e.value)}),this.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(ue.getDefaults(),{multiplier:1,units:"hertz",value:1})}setTargetAtTime(e,t,s){t=this.toSeconds(t),this.setRampPoint(t);const i=this._fromType(e),r=this._events.get(t),o=Math.round(Math.max(1/s,1));for(let a=0;a<=o;a++){const c=s*a+t,l=this._exponentialApproach(r.time,r.value,i,s,c);this.linearRampToValueAtTime(this._toType(l),c)}return this}setValueAtTime(e,t){const s=this.toSeconds(t);super.setValueAtTime(e,t);const i=this._events.get(s),r=this._events.previousEvent(i),o=this._getTicksUntilEvent(r,s);return i.ticks=Math.max(o,0),this}linearRampToValueAtTime(e,t){const s=this.toSeconds(t);super.linearRampToValueAtTime(e,t);const i=this._events.get(s),r=this._events.previousEvent(i),o=this._getTicksUntilEvent(r,s);return i.ticks=Math.max(o,0),this}exponentialRampToValueAtTime(e,t){t=this.toSeconds(t);const s=this._fromType(e),i=this._events.get(t),r=Math.round(Math.max((t-i.time)*10,1)),o=(t-i.time)/r;for(let a=0;a<=r;a++){const c=o*a+i.time,l=this._exponentialInterpolate(i.time,i.value,t,s,c);this.linearRampToValueAtTime(this._toType(l),c)}return this}_getTicksUntilEvent(e,t){if(e===null)e={ticks:0,time:0,type:"setValueAtTime",value:0};else if(yt(e.ticks)){const o=this._events.previousEvent(e);e.ticks=this._getTicksUntilEvent(o,e.time)}const s=this._fromType(this.getValueAtTime(e.time));let i=this._fromType(this.getValueAtTime(t));const r=this._events.get(t);return r&&r.time===t&&r.type==="setValueAtTime"&&(i=this._fromType(this.getValueAtTime(t-this.sampleTime))),.5*(t-e.time)*(s+i)+e.ticks}getTicksAtTime(e){const t=this.toSeconds(e),s=this._events.get(t);return Math.max(this._getTicksUntilEvent(s,t),0)}getDurationOfTicks(e,t){const s=this.toSeconds(t),i=this.getTicksAtTime(t);return this.getTimeOfTick(i+e)-s}getTimeOfTick(e){const t=this._events.get(e,"ticks"),s=this._events.getAfter(e,"ticks");if(t&&t.ticks===e)return t.time;if(t&&s&&s.type==="linearRampToValueAtTime"&&t.value!==s.value){const i=this._fromType(this.getValueAtTime(t.time)),o=(this._fromType(this.getValueAtTime(s.time))-i)/(s.time-t.time),a=Math.sqrt(Math.pow(i,2)-2*o*(t.ticks-e)),c=(-i+a)/o,l=(-i-a)/o;return(c>0?c:l)+t.time}else return t?t.value===0?1/0:t.time+(e-t.ticks)/t.value:e/this._initialValue}ticksToTime(e,t){return this.getDurationOfTicks(e,t)}timeToTicks(e,t){const s=this.toSeconds(t),i=this.toSeconds(e),r=this.getTicksAtTime(s);return this.getTicksAtTime(s+i)-r}_fromType(e){return this.units==="bpm"&&this.multiplier?1/(60/e/this.multiplier):super._fromType(e)}_toType(e){return this.units==="bpm"&&this.multiplier?e/this.multiplier*60:super._toType(e)}get multiplier(){return this._multiplier}set multiplier(e){const t=this.value;this._multiplier=e,this.cancelScheduledValues(0),this.setValueAtTime(t,0)}}class lo extends ye{constructor(){super(I(lo.getDefaults(),arguments,["value"])),this.name="TickSignal";const e=I(lo.getDefaults(),arguments,["value"]);this.input=this._param=new co({context:this.context,convert:e.convert,multiplier:e.multiplier,param:this._constantSource.offset,units:e.units,value:e.value})}static getDefaults(){return Object.assign(ye.getDefaults(),{multiplier:1,units:"hertz",value:1})}ticksToTime(e,t){return this._param.ticksToTime(e,t)}timeToTicks(e,t){return this._param.timeToTicks(e,t)}getTimeOfTick(e){return this._param.getTimeOfTick(e)}getDurationOfTicks(e,t){return this._param.getDurationOfTicks(e,t)}getTicksAtTime(e){return this._param.getTicksAtTime(e)}get multiplier(){return this._param.multiplier}set multiplier(e){this._param.multiplier=e}dispose(){return super.dispose(),this._param.dispose(),this}}class uo extends ct{constructor(){super(I(uo.getDefaults(),arguments,["frequency"])),this.name="TickSource",this._state=new bc,this._tickOffset=new $t,this._ticksAtTime=new $t,this._secondsAtTime=new $t;const e=I(uo.getDefaults(),arguments,["frequency"]);this.frequency=new lo({context:this.context,units:e.units,value:e.frequency}),Te(this,"frequency"),this._state.setStateAtTime("stopped",0),this.setTicksAtTime(0,0)}static getDefaults(){return Object.assign({frequency:1,units:"hertz"},ct.getDefaults())}get state(){return this.getStateAtTime(this.now())}start(e,t){const s=this.toSeconds(e);return this._state.getValueAtTime(s)!=="started"&&(this._state.setStateAtTime("started",s),te(t)&&this.setTicksAtTime(t,s),this._ticksAtTime.cancel(s),this._secondsAtTime.cancel(s)),this}stop(e){const t=this.toSeconds(e);if(this._state.getValueAtTime(t)==="stopped"){const s=this._state.get(t);s&&s.time>0&&(this._tickOffset.cancel(s.time),this._state.cancel(s.time))}return this._state.cancel(t),this._state.setStateAtTime("stopped",t),this.setTicksAtTime(0,t),this._ticksAtTime.cancel(t),this._secondsAtTime.cancel(t),this}pause(e){const t=this.toSeconds(e);return this._state.getValueAtTime(t)==="started"&&(this._state.setStateAtTime("paused",t),this._ticksAtTime.cancel(t),this._secondsAtTime.cancel(t)),this}cancel(e){return e=this.toSeconds(e),this._state.cancel(e),this._tickOffset.cancel(e),this._ticksAtTime.cancel(e),this._secondsAtTime.cancel(e),this}getTicksAtTime(e){const t=this.toSeconds(e),s=this._state.getLastState("stopped",t),i=this._ticksAtTime.get(t),r={state:"paused",time:t};this._state.add(r);let o=i||s,a=i?i.ticks:0,c=null;return this._state.forEachBetween(o.time,t+this.sampleTime,l=>{let u=o.time;const h=this._tickOffset.get(l.time);h&&h.time>=o.time&&(a=h.ticks,u=h.time),o.state==="started"&&l.state!=="started"&&(a+=this.frequency.getTicksAtTime(l.time)-this.frequency.getTicksAtTime(u),l.time!=r.time&&(c={state:l.state,time:l.time,ticks:a})),o=l}),this._state.remove(r),c&&this._ticksAtTime.add(c),a}get ticks(){return this.getTicksAtTime(this.now())}set ticks(e){this.setTicksAtTime(e,this.now())}get seconds(){return this.getSecondsAtTime(this.now())}set seconds(e){const t=this.now(),s=this.frequency.timeToTicks(e,t);this.setTicksAtTime(s,t)}getSecondsAtTime(e){e=this.toSeconds(e);const t=this._state.getLastState("stopped",e),s={state:"paused",time:e};this._state.add(s);const i=this._secondsAtTime.get(e);let r=i||t,o=i?i.seconds:0,a=null;return this._state.forEachBetween(r.time,e+this.sampleTime,c=>{let l=r.time;const u=this._tickOffset.get(c.time);u&&u.time>=r.time&&(o=u.seconds,l=u.time),r.state==="started"&&c.state!=="started"&&(o+=c.time-l,c.time!=s.time&&(a={state:c.state,time:c.time,seconds:o})),r=c}),this._state.remove(s),a&&this._secondsAtTime.add(a),o}setTicksAtTime(e,t){return t=this.toSeconds(t),this._tickOffset.cancel(t),this._tickOffset.add({seconds:this.frequency.getDurationOfTicks(e,t),ticks:e,time:t}),this._ticksAtTime.cancel(t),this._secondsAtTime.cancel(t),this}getStateAtTime(e){return e=this.toSeconds(e),this._state.getValueAtTime(e)}getTimeOfTick(e,t=this.now()){const s=this._tickOffset.get(t),i=this._state.get(t),r=Math.max(s.time,i.time),o=this.frequency.getTicksAtTime(r)+e-s.ticks;return this.frequency.getTimeOfTick(o)}forEachTickBetween(e,t,s){let i=this._state.get(e);this._state.forEachBetween(e,t,o=>{i&&i.state==="started"&&o.state!=="started"&&this.forEachTickBetween(Math.max(i.time,e),o.time-this.sampleTime,s),i=o});let r=null;if(i&&i.state==="started"){const o=Math.max(i.time,e),a=this.frequency.getTicksAtTime(o),c=this.frequency.getTicksAtTime(i.time),l=a-c;let u=Math.ceil(l)-l;u=Nt(u,1)?0:u;let h=this.frequency.getTimeOfTick(a+u);for(;h<t;){try{s(h,Math.round(this.getTicksAtTime(h)))}catch(f){r=f;break}h+=this.frequency.getDurationOfTicks(1,h)}}if(r)throw r;return this}dispose(){return super.dispose(),this._state.dispose(),this._tickOffset.dispose(),this._ticksAtTime.dispose(),this._secondsAtTime.dispose(),this.frequency.dispose(),this}}class Hi extends ct{constructor(){super(I(Hi.getDefaults(),arguments,["callback","frequency"])),this.name="Clock",this.callback=ce,this._lastUpdate=0,this._state=new bc("stopped"),this._boundLoop=this._loop.bind(this);const e=I(Hi.getDefaults(),arguments,["callback","frequency"]);this.callback=e.callback,this._tickSource=new uo({context:this.context,frequency:e.frequency,units:e.units}),this._lastUpdate=0,this.frequency=this._tickSource.frequency,Te(this,"frequency"),this._state.setStateAtTime("stopped",0),this.context.on("tick",this._boundLoop)}static getDefaults(){return Object.assign(ct.getDefaults(),{callback:ce,frequency:1,units:"hertz"})}get state(){return this._state.getValueAtTime(this.now())}start(e,t){bh(this.context);const s=this.toSeconds(e);return this.log("start",s),this._state.getValueAtTime(s)!=="started"&&(this._state.setStateAtTime("started",s),this._tickSource.start(s,t),s<this._lastUpdate&&this.emit("start",s,t)),this}stop(e){const t=this.toSeconds(e);return this.log("stop",t),this._state.cancel(t),this._state.setStateAtTime("stopped",t),this._tickSource.stop(t),t<this._lastUpdate&&this.emit("stop",t),this}pause(e){const t=this.toSeconds(e);return this._state.getValueAtTime(t)==="started"&&(this._state.setStateAtTime("paused",t),this._tickSource.pause(t),t<this._lastUpdate&&this.emit("pause",t)),this}get ticks(){return Math.ceil(this.getTicksAtTime(this.now()))}set ticks(e){this._tickSource.ticks=e}get seconds(){return this._tickSource.seconds}set seconds(e){this._tickSource.seconds=e}getSecondsAtTime(e){return this._tickSource.getSecondsAtTime(e)}setTicksAtTime(e,t){return this._tickSource.setTicksAtTime(e,t),this}getTimeOfTick(e,t=this.now()){return this._tickSource.getTimeOfTick(e,t)}getTicksAtTime(e){return this._tickSource.getTicksAtTime(e)}nextTickTime(e,t){const s=this.toSeconds(t),i=this.getTicksAtTime(s);return this._tickSource.getTimeOfTick(i+e,s)}_loop(){const e=this._lastUpdate,t=this.now();this._lastUpdate=t,this.log("loop",e,t),e!==t&&(this._state.forEachBetween(e,t,s=>{switch(s.state){case"started":const i=this._tickSource.getTicksAtTime(s.time);this.emit("start",s.time,i);break;case"stopped":s.time!==0&&this.emit("stop",s.time);break;case"paused":this.emit("pause",s.time);break}}),this._tickSource.forEachTickBetween(e,t,(s,i)=>{this.callback(s,i)}))}getStateAtTime(e){const t=this.toSeconds(e);return this._state.getValueAtTime(t)}dispose(){return super.dispose(),this.context.off("tick",this._boundLoop),this._tickSource.dispose(),this._state.dispose(),this}}kr.mixin(Hi);class Oc extends ks{constructor(){super(),this.name="ToneAudioBuffers",this._buffers=new Map,this._loadingCount=0;const e=I(Oc.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");this.baseUrl=e.baseUrl,Object.keys(e.urls).forEach(t=>{this._loadingCount++;const s=e.urls[t];this.add(t,s,this._bufferLoaded.bind(this,e.onload),e.onerror)})}static getDefaults(){return{baseUrl:"",onerror:ce,onload:ce,urls:{}}}has(e){return this._buffers.has(e.toString())}get(e){return K(this.has(e),`ToneAudioBuffers has no buffer named: ${e}`),this._buffers.get(e.toString())}_bufferLoaded(e){this._loadingCount--,this._loadingCount===0&&e&&e()}get loaded(){return Array.from(this._buffers).every(([e,t])=>t.loaded)}add(e,t,s=ce,i=ce){return ms(t)?(this.baseUrl&&t.trim().substring(0,11).toLowerCase()==="data:audio/"&&(this.baseUrl=""),this._buffers.set(e.toString(),new le(this.baseUrl+t,s,i))):this._buffers.set(e.toString(),new le(t,s,i)),this}dispose(){return super.dispose(),this._buffers.forEach(e=>e.dispose()),this._buffers.clear(),this}}class Ln extends Ii{constructor(){super(...arguments),this.name="Ticks",this.defaultUnits="i"}_now(){return this.context.transport.ticks}_beatsToUnits(e){return this._getPPQ()*e}_secondsToUnits(e){return Math.floor(e/(60/this._getBpm())*this._getPPQ())}_ticksToUnits(e){return e}toTicks(){return this.valueOf()}toSeconds(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())}}class fx extends ct{constructor(){super(...arguments),this.name="Draw",this.expiration=.25,this.anticipation=.008,this._events=new $t,this._boundDrawLoop=this._drawLoop.bind(this),this._animationFrame=-1}schedule(e,t){return this._events.add({callback:e,time:this.toSeconds(t)}),this._events.length===1&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop)),this}cancel(e){return this._events.cancel(this.toSeconds(e)),this}_drawLoop(){const e=this.context.currentTime;for(;this._events.length&&this._events.peek().time-this.anticipation<=e;){const t=this._events.shift();t&&e-t.time<=this.expiration&&t.callback()}this._events.length>0&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop))}dispose(){return super.dispose(),this._events.dispose(),cancelAnimationFrame(this._animationFrame),this}}Lo(n=>{n.draw=new fx({context:n})});Bo(n=>{n.draw.dispose()});class px extends ks{constructor(){super(...arguments),this.name="IntervalTimeline",this._root=null,this._length=0}add(e){K(te(e.time),"Events must have a time property"),K(te(e.duration),"Events must have a duration parameter"),e.time=e.time.valueOf();let t=new mx(e.time,e.time+e.duration,e);for(this._root===null?this._root=t:this._root.insert(t),this._length++;t!==null;)t.updateHeight(),t.updateMax(),this._rebalance(t),t=t.parent;return this}remove(e){if(this._root!==null){const t=[];this._root.search(e.time,t);for(const s of t)if(s.event===e){this._removeNode(s),this._length--;break}}return this}get length(){return this._length}cancel(e){return this.forEachFrom(e,t=>this.remove(t)),this}_setRoot(e){this._root=e,this._root!==null&&(this._root.parent=null)}_replaceNodeInParent(e,t){e.parent!==null?(e.isLeftChild()?e.parent.left=t:e.parent.right=t,this._rebalance(e.parent)):this._setRoot(t)}_removeNode(e){if(e.left===null&&e.right===null)this._replaceNodeInParent(e,null);else if(e.right===null)this._replaceNodeInParent(e,e.left);else if(e.left===null)this._replaceNodeInParent(e,e.right);else{const t=e.getBalance();let s,i=null;if(t>0)if(e.left.right===null)s=e.left,s.right=e.right,i=s;else{for(s=e.left.right;s.right!==null;)s=s.right;s.parent&&(s.parent.right=s.left,i=s.parent,s.left=e.left,s.right=e.right)}else if(e.right.left===null)s=e.right,s.left=e.left,i=s;else{for(s=e.right.left;s.left!==null;)s=s.left;s.parent&&(s.parent.left=s.right,i=s.parent,s.left=e.left,s.right=e.right)}e.parent!==null?e.isLeftChild()?e.parent.left=s:e.parent.right=s:this._setRoot(s),i&&this._rebalance(i)}e.dispose()}_rotateLeft(e){const t=e.parent,s=e.isLeftChild(),i=e.right;i&&(e.right=i.left,i.left=e),t!==null?s?t.left=i:t.right=i:this._setRoot(i)}_rotateRight(e){const t=e.parent,s=e.isLeftChild(),i=e.left;i&&(e.left=i.right,i.right=e),t!==null?s?t.left=i:t.right=i:this._setRoot(i)}_rebalance(e){const t=e.getBalance();t>1&&e.left?e.left.getBalance()<0?this._rotateLeft(e.left):this._rotateRight(e):t<-1&&e.right&&(e.right.getBalance()>0?this._rotateRight(e.right):this._rotateLeft(e))}get(e){if(this._root!==null){const t=[];if(this._root.search(e,t),t.length>0){let s=t[0];for(let i=1;i<t.length;i++)t[i].low>s.low&&(s=t[i]);return s.event}}return null}forEach(e){if(this._root!==null){const t=[];this._root.traverse(s=>t.push(s)),t.forEach(s=>{s.event&&e(s.event)})}return this}forEachAtTime(e,t){if(this._root!==null){const s=[];this._root.search(e,s),s.forEach(i=>{i.event&&t(i.event)})}return this}forEachFrom(e,t){if(this._root!==null){const s=[];this._root.searchAfter(e,s),s.forEach(i=>{i.event&&t(i.event)})}return this}dispose(){return super.dispose(),this._root!==null&&this._root.traverse(e=>e.dispose()),this._root=null,this}}class mx{constructor(e,t,s){this._left=null,this._right=null,this.parent=null,this.height=0,this.event=s,this.low=e,this.high=t,this.max=this.high}insert(e){e.low<=this.low?this.left===null?this.left=e:this.left.insert(e):this.right===null?this.right=e:this.right.insert(e)}search(e,t){e>this.max||(this.left!==null&&this.left.search(e,t),this.low<=e&&this.high>e&&t.push(this),!(this.low>e)&&this.right!==null&&this.right.search(e,t))}searchAfter(e,t){this.low>=e&&(t.push(this),this.left!==null&&this.left.searchAfter(e,t)),this.right!==null&&this.right.searchAfter(e,t)}traverse(e){e(this),this.left!==null&&this.left.traverse(e),this.right!==null&&this.right.traverse(e)}updateHeight(){this.left!==null&&this.right!==null?this.height=Math.max(this.left.height,this.right.height)+1:this.right!==null?this.height=this.right.height+1:this.left!==null?this.height=this.left.height+1:this.height=0}updateMax(){this.max=this.high,this.left!==null&&(this.max=Math.max(this.max,this.left.max)),this.right!==null&&(this.max=Math.max(this.max,this.right.max))}getBalance(){let e=0;return this.left!==null&&this.right!==null?e=this.left.height-this.right.height:this.left!==null?e=this.left.height+1:this.right!==null&&(e=-(this.right.height+1)),e}isLeftChild(){return this.parent!==null&&this.parent.left===this}get left(){return this._left}set left(e){this._left=e,e!==null&&(e.parent=this),this.updateHeight(),this.updateMax()}get right(){return this._right}set right(e){this._right=e,e!==null&&(e.parent=this),this.updateHeight(),this.updateMax()}dispose(){this.parent=null,this._left=null,this._right=null,this.event=null}}class Vs extends W{constructor(){super(I(Vs.getDefaults(),arguments,["volume"])),this.name="Volume";const e=I(Vs.getDefaults(),arguments,["volume"]);this.input=this.output=new me({context:this.context,gain:e.volume,units:"decibels"}),this.volume=this.output.gain,Te(this,"volume"),this._unmutedVolume=e.volume,this.mute=e.mute}static getDefaults(){return Object.assign(W.getDefaults(),{mute:!1,volume:0})}get mute(){return this.volume.value===-1/0}set mute(e){!this.mute&&e?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!e&&(this.volume.value=this._unmutedVolume)}dispose(){return super.dispose(),this.input.dispose(),this.volume.dispose(),this}}let _x=class Pa extends W{constructor(){super(I(Pa.getDefaults(),arguments)),this.name="Destination",this.input=new Vs({context:this.context}),this.output=new me({context:this.context}),this.volume=this.input.volume;const e=I(Pa.getDefaults(),arguments);ji(this.input,this.output,this.context.rawContext.destination),this.mute=e.mute,this._internalChannels=[this.input,this.context.rawContext.destination,this.output]}static getDefaults(){return Object.assign(W.getDefaults(),{mute:!1,volume:0})}get mute(){return this.input.mute}set mute(e){this.input.mute=e}chain(...e){return this.input.disconnect(),e.unshift(this.input),e.push(this.output),ji(...e),this}get maxChannelCount(){return this.context.rawContext.destination.maxChannelCount}dispose(){return super.dispose(),this.volume.dispose(),this}};Lo(n=>{n.destination=new _x({context:n})});Bo(n=>{n.destination.dispose()});class gx extends ks{constructor(e){super(),this.name="TimelineValue",this._timeline=new $t({memory:10}),this._initialValue=e}set(e,t){return this._timeline.add({value:e,time:t}),this}get(e){const t=this._timeline.get(e);return t?t.value:this._initialValue}}class _s extends W{constructor(){super(Object.assign(I(_s.getDefaults(),arguments,["context"])))}connect(e,t=0,s=0){return Ec(this,e,t,s),this}}class mn extends _s{constructor(){super(Object.assign(I(mn.getDefaults(),arguments,["mapping","length"]))),this.name="WaveShaper",this._shaper=this.context.createWaveShaper(),this.input=this._shaper,this.output=this._shaper;const e=I(mn.getDefaults(),arguments,["mapping","length"]);Lt(e.mapping)||e.mapping instanceof Float32Array?this.curve=Float32Array.from(e.mapping):zy(e.mapping)&&this.setMap(e.mapping,e.length)}static getDefaults(){return Object.assign(ye.getDefaults(),{length:1024})}setMap(e,t=1024){const s=new Float32Array(t);for(let i=0,r=t;i<r;i++){const o=i/(r-1)*2-1;s[i]=e(o,i)}return this.curve=s,this}get curve(){return this._shaper.curve}set curve(e){this._shaper.curve=e}get oversample(){return this._shaper.oversample}set oversample(e){const t=["none","2x","4x"].some(s=>s.includes(e));K(t,"oversampling must be either 'none', '2x', or '4x'"),this._shaper.oversample=e}dispose(){return super.dispose(),this._shaper.disconnect(),this}}class qi extends _s{constructor(){super(Object.assign(I(qi.getDefaults(),arguments,["value"]))),this.name="Pow";const e=I(qi.getDefaults(),arguments,["value"]);this._exponentScaler=this.input=this.output=new mn({context:this.context,mapping:this._expFunc(e.value),length:8192}),this._exponent=e.value}static getDefaults(){return Object.assign(_s.getDefaults(),{value:1})}_expFunc(e){return t=>Math.pow(Math.abs(t),e)}get value(){return this._exponent}set value(e){this._exponent=e,this._exponentScaler.setMap(this._expFunc(this._exponent))}dispose(){return super.dispose(),this._exponentScaler.dispose(),this}}class js{constructor(e,t){this.id=js._eventId++,this._remainderTime=0;const s=Object.assign(js.getDefaults(),t);this.transport=e,this.callback=s.callback,this._once=s.once,this.time=Math.floor(s.time),this._remainderTime=s.time-this.time}static getDefaults(){return{callback:ce,once:!1,time:0}}get floatTime(){return this.time+this._remainderTime}invoke(e){if(this.callback){const t=this.transport.bpm.getDurationOfTicks(1,e);this.callback(e+this._remainderTime*t),this._once&&this.transport.clear(this.id)}}dispose(){return this.callback=void 0,this}}js._eventId=0;class Ac extends js{constructor(e,t){super(e,t),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this);const s=Object.assign(Ac.getDefaults(),t);this.duration=s.duration,this._interval=s.interval,this._nextTick=s.time,this.transport.on("start",this._boundRestart),this.transport.on("loopStart",this._boundRestart),this.transport.on("ticks",this._boundRestart),this.context=this.transport.context,this._restart()}static getDefaults(){return Object.assign({},js.getDefaults(),{duration:1/0,interval:1,once:!1})}invoke(e){this._createEvents(e),super.invoke(e)}_createEvent(){return oo(this._nextTick,this.floatTime+this.duration)?this.transport.scheduleOnce(this.invoke.bind(this),new Ln(this.context,this._nextTick).toSeconds()):-1}_createEvents(e){oo(this._nextTick+this._interval,this.floatTime+this.duration)&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new Ln(this.context,this._nextTick).toSeconds()))}_restart(e){this.transport.clear(this._currentId),this.transport.clear(this._nextId),this._nextTick=this.floatTime;const t=this.transport.getTicksAtTime(e);Xn(t,this.time)&&(this._nextTick=this.floatTime+Math.ceil((t-this.floatTime)/this._interval)*this._interval),this._currentId=this._createEvent(),this._nextTick+=this._interval,this._nextId=this._createEvent()}dispose(){return super.dispose(),this.transport.clear(this._currentId),this.transport.clear(this._nextId),this.transport.off("start",this._boundRestart),this.transport.off("loopStart",this._boundRestart),this.transport.off("ticks",this._boundRestart),this}}class Wi extends ct{constructor(){super(I(Wi.getDefaults(),arguments)),this.name="Transport",this._loop=new gx(!1),this._loopStart=0,this._loopEnd=0,this._scheduledEvents={},this._timeline=new $t,this._repeatedEvents=new px,this._syncedSignals=[],this._swingAmount=0;const e=I(Wi.getDefaults(),arguments);this._ppq=e.ppq,this._clock=new Hi({callback:this._processTick.bind(this),context:this.context,frequency:0,units:"bpm"}),this._bindClockEvents(),this.bpm=this._clock.frequency,this._clock.frequency.multiplier=e.ppq,this.bpm.setValueAtTime(e.bpm,0),Te(this,"bpm"),this._timeSignature=e.timeSignature,this._swingTicks=e.ppq/2}static getDefaults(){return Object.assign(ct.getDefaults(),{bpm:120,loopEnd:"4m",loopStart:0,ppq:192,swing:0,swingSubdivision:"8n",timeSignature:4})}_processTick(e,t){if(this._loop.get(e)&&t>=this._loopEnd&&(this.emit("loopEnd",e),this._clock.setTicksAtTime(this._loopStart,e),t=this._loopStart,this.emit("loopStart",e,this._clock.getSecondsAtTime(e)),this.emit("loop",e)),this._swingAmount>0&&t%this._ppq!==0&&t%(this._swingTicks*2)!==0){const s=t%(this._swingTicks*2)/(this._swingTicks*2),i=Math.sin(s*Math.PI)*this._swingAmount;e+=new Ln(this.context,this._swingTicks*2/3).toSeconds()*i}Bl(!0),this._timeline.forEachAtTime(t,s=>s.invoke(e)),Bl(!1)}schedule(e,t){const s=new js(this,{callback:e,time:new Ii(this.context,t).toTicks()});return this._addEvent(s,this._timeline)}scheduleRepeat(e,t,s,i=1/0){const r=new Ac(this,{callback:e,duration:new Ut(this.context,i).toTicks(),interval:new Ut(this.context,t).toTicks(),time:new Ii(this.context,s).toTicks()});return this._addEvent(r,this._repeatedEvents)}scheduleOnce(e,t){const s=new js(this,{callback:e,once:!0,time:new Ii(this.context,t).toTicks()});return this._addEvent(s,this._timeline)}clear(e){if(this._scheduledEvents.hasOwnProperty(e)){const t=this._scheduledEvents[e.toString()];t.timeline.remove(t.event),t.event.dispose(),delete this._scheduledEvents[e.toString()]}return this}_addEvent(e,t){return this._scheduledEvents[e.id.toString()]={event:e,timeline:t},t.add(e),e.id}cancel(e=0){const t=this.toTicks(e);return this._timeline.forEachFrom(t,s=>this.clear(s.id)),this._repeatedEvents.forEachFrom(t,s=>this.clear(s.id)),this}_bindClockEvents(){this._clock.on("start",(e,t)=>{t=new Ln(this.context,t).toSeconds(),this.emit("start",e,t)}),this._clock.on("stop",e=>{this.emit("stop",e)}),this._clock.on("pause",e=>{this.emit("pause",e)})}get state(){return this._clock.getStateAtTime(this.now())}start(e,t){this.context.resume();let s;return te(t)&&(s=this.toTicks(t)),this._clock.start(e,s),this}stop(e){return this._clock.stop(e),this}pause(e){return this._clock.pause(e),this}toggle(e){return e=this.toSeconds(e),this._clock.getStateAtTime(e)!=="started"?this.start(e):this.stop(e),this}get timeSignature(){return this._timeSignature}set timeSignature(e){Lt(e)&&(e=e[0]/e[1]*4),this._timeSignature=e}get loopStart(){return new Ut(this.context,this._loopStart,"i").toSeconds()}set loopStart(e){this._loopStart=this.toTicks(e)}get loopEnd(){return new Ut(this.context,this._loopEnd,"i").toSeconds()}set loopEnd(e){this._loopEnd=this.toTicks(e)}get loop(){return this._loop.get(this.now())}set loop(e){this._loop.set(e,this.now())}setLoopPoints(e,t){return this.loopStart=e,this.loopEnd=t,this}get swing(){return this._swingAmount}set swing(e){this._swingAmount=e}get swingSubdivision(){return new Ln(this.context,this._swingTicks).toNotation()}set swingSubdivision(e){this._swingTicks=this.toTicks(e)}get position(){const e=this.now(),t=this._clock.getTicksAtTime(e);return new Ln(this.context,t).toBarsBeatsSixteenths()}set position(e){const t=this.toTicks(e);this.ticks=t}get seconds(){return this._clock.seconds}set seconds(e){const t=this.now(),s=this._clock.frequency.timeToTicks(e,t);this.ticks=s}get progress(){if(this.loop){const e=this.now();return(this._clock.getTicksAtTime(e)-this._loopStart)/(this._loopEnd-this._loopStart)}else return 0}get ticks(){return this._clock.ticks}set ticks(e){if(this._clock.ticks!==e){const t=this.now();if(this.state==="started"){const s=this._clock.getTicksAtTime(t),i=this._clock.frequency.getDurationOfTicks(Math.ceil(s)-s,t),r=t+i;this.emit("stop",r),this._clock.setTicksAtTime(e,r),this.emit("start",r,this._clock.getSecondsAtTime(r))}else this.emit("ticks",t),this._clock.setTicksAtTime(e,t)}}getTicksAtTime(e){return this._clock.getTicksAtTime(e)}getSecondsAtTime(e){return this._clock.getSecondsAtTime(e)}get PPQ(){return this._clock.frequency.multiplier}set PPQ(e){this._clock.frequency.multiplier=e}nextSubdivision(e){if(e=this.toTicks(e),this.state!=="started")return 0;{const t=this.now(),s=this.getTicksAtTime(t),i=e-s%e;return this._clock.nextTickTime(i,t)}}syncSignal(e,t){const s=this.now();let i=this.bpm,r=1/(60/i.getValueAtTime(s)/this.PPQ),o=[];if(e.units==="time"){const c=.015625/r,l=new me(c),u=new qi(-1),h=new me(c);i.chain(l,u,h),i=h,r=1/r,o=[l,u,h]}t||(e.getValueAtTime(s)!==0?t=e.getValueAtTime(s)/r:t=0);const a=new me(t);return i.connect(a),a.connect(e._param),o.push(a),this._syncedSignals.push({initial:e.value,nodes:o,signal:e}),e.value=0,this}unsyncSignal(e){for(let t=this._syncedSignals.length-1;t>=0;t--){const s=this._syncedSignals[t];s.signal===e&&(s.nodes.forEach(i=>i.dispose()),s.signal.value=s.initial,this._syncedSignals.splice(t,1))}return this}dispose(){return super.dispose(),this._clock.dispose(),Sc(this,"bpm"),this._timeline.dispose(),this._repeatedEvents.dispose(),this}}kr.mixin(Wi);Lo(n=>{n.transport=new Wi({context:n})});Bo(n=>{n.transport.dispose()});class Ke extends W{constructor(e){super(e),this.input=void 0,this._state=new bc("stopped"),this._synced=!1,this._scheduled=[],this._syncedStart=ce,this._syncedStop=ce,this._state.memory=100,this._state.increasing=!0,this._volume=this.output=new Vs({context:this.context,mute:e.mute,volume:e.volume}),this.volume=this._volume.volume,Te(this,"volume"),this.onstop=e.onstop}static getDefaults(){return Object.assign(W.getDefaults(),{mute:!1,onstop:ce,volume:0})}get state(){return this._synced?this.context.transport.state==="started"?this._state.getValueAtTime(this.context.transport.seconds):"stopped":this._state.getValueAtTime(this.now())}get mute(){return this._volume.mute}set mute(e){this._volume.mute=e}_clampToCurrentTime(e){return this._synced?e:Math.max(e,this.context.currentTime)}start(e,t,s){let i=yt(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(i=this._clampToCurrentTime(i),!this._synced&&this._state.getValueAtTime(i)==="started")K(Xn(i,this._state.get(i).time),"Start time must be strictly greater than previous start time"),this._state.cancel(i),this._state.setStateAtTime("started",i),this.log("restart",i),this.restart(i,t,s);else if(this.log("start",i),this._state.setStateAtTime("started",i),this._synced){const r=this._state.get(i);r&&(r.offset=this.toSeconds(jn(t,0)),r.duration=s?this.toSeconds(s):void 0);const o=this.context.transport.schedule(a=>{this._start(a,t,s)},i);this._scheduled.push(o),this.context.transport.state==="started"&&this.context.transport.getSecondsAtTime(this.immediate())>i&&this._syncedStart(this.now(),this.context.transport.seconds)}else bh(this.context),this._start(i,t,s);return this}stop(e){let t=yt(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(t=this._clampToCurrentTime(t),this._state.getValueAtTime(t)==="started"||te(this._state.getNextState("started",t))){if(this.log("stop",t),!this._synced)this._stop(t);else{const s=this.context.transport.schedule(this._stop.bind(this),t);this._scheduled.push(s)}this._state.cancel(t),this._state.setStateAtTime("stopped",t)}return this}restart(e,t,s){return e=this.toSeconds(e),this._state.getValueAtTime(e)==="started"&&(this._state.cancel(e),this._restart(e,t,s)),this}sync(){return this._synced||(this._synced=!0,this._syncedStart=(e,t)=>{if(Xn(t,0)){const s=this._state.get(t);if(s&&s.state==="started"&&s.time!==t){const i=t-this.toSeconds(s.time);let r;s.duration&&(r=this.toSeconds(s.duration)-i),this._start(e,this.toSeconds(s.offset)+i,r)}}},this._syncedStop=e=>{const t=this.context.transport.getSecondsAtTime(Math.max(e-this.sampleTime,0));this._state.getValueAtTime(t)==="started"&&this._stop(e)},this.context.transport.on("start",this._syncedStart),this.context.transport.on("loopStart",this._syncedStart),this.context.transport.on("stop",this._syncedStop),this.context.transport.on("pause",this._syncedStop),this.context.transport.on("loopEnd",this._syncedStop)),this}unsync(){return this._synced&&(this.context.transport.off("stop",this._syncedStop),this.context.transport.off("pause",this._syncedStop),this.context.transport.off("loopEnd",this._syncedStop),this.context.transport.off("start",this._syncedStart),this.context.transport.off("loopStart",this._syncedStart)),this._synced=!1,this._scheduled.forEach(e=>this.context.transport.clear(e)),this._scheduled=[],this._state.cancel(0),this._stop(0),this}dispose(){return super.dispose(),this.onstop=ce,this.unsync(),this._volume.dispose(),this._state.dispose(),this}}class Kn extends Qn{constructor(){super(I(Kn.getDefaults(),arguments,["url","onload"])),this.name="ToneBufferSource",this._source=this.context.createBufferSource(),this._internalChannels=[this._source],this._sourceStarted=!1,this._sourceStopped=!1;const e=I(Kn.getDefaults(),arguments,["url","onload"]);zs(this._source,this._gainNode),this._source.onended=()=>this._stopSource(),this.playbackRate=new ue({context:this.context,param:this._source.playbackRate,units:"positive",value:e.playbackRate}),this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this._buffer=new le(e.url,e.onload,e.onerror),this._internalChannels.push(this._source)}static getDefaults(){return Object.assign(Qn.getDefaults(),{url:new le,loop:!1,loopEnd:0,loopStart:0,onload:ce,onerror:ce,playbackRate:1})}get fadeIn(){return this._fadeIn}set fadeIn(e){this._fadeIn=e}get fadeOut(){return this._fadeOut}set fadeOut(e){this._fadeOut=e}get curve(){return this._curve}set curve(e){this._curve=e}start(e,t,s,i=1){K(this.buffer.loaded,"buffer is either not set or not loaded");const r=this.toSeconds(e);this._startGain(r,i),this.loop?t=jn(t,this.loopStart):t=jn(t,0);let o=Math.max(this.toSeconds(t),0);if(this.loop){const a=this.toSeconds(this.loopEnd)||this.buffer.duration,c=this.toSeconds(this.loopStart),l=a-c;Da(o,a)&&(o=(o-c)%l+c),Nt(o,this.buffer.duration)&&(o=0)}if(this._source.buffer=this.buffer.get(),this._source.loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,oo(o,this.buffer.duration)&&(this._sourceStarted=!0,this._source.start(r,o)),te(s)){let a=this.toSeconds(s);a=Math.max(a,0),this.stop(r+a)}return this}_stopSource(e){!this._sourceStopped&&this._sourceStarted&&(this._sourceStopped=!0,this._source.stop(this.toSeconds(e)),this._onended())}get loopStart(){return this._source.loopStart}set loopStart(e){this._source.loopStart=this.toSeconds(e)}get loopEnd(){return this._source.loopEnd}set loopEnd(e){this._source.loopEnd=this.toSeconds(e)}get buffer(){return this._buffer}set buffer(e){this._buffer.set(e)}get loop(){return this._source.loop}set loop(e){this._source.loop=e,this._sourceStarted&&this.cancelStop()}dispose(){return super.dispose(),this._source.onended=null,this._source.disconnect(),this._buffer.dispose(),this.playbackRate.dispose(),this}}class Gi extends Ke{constructor(){super(I(Gi.getDefaults(),arguments,["type"])),this.name="Noise",this._source=null;const e=I(Gi.getDefaults(),arguments,["type"]);this._playbackRate=e.playbackRate,this.type=e.type,this._fadeIn=e.fadeIn,this._fadeOut=e.fadeOut}static getDefaults(){return Object.assign(Ke.getDefaults(),{fadeIn:0,fadeOut:0,playbackRate:1,type:"white"})}get type(){return this._type}set type(e){if(K(e in zl,"Noise: invalid type: "+e),this._type!==e&&(this._type=e,this.state==="started")){const t=this.now();this._stop(t),this._start(t)}}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e,this._source&&(this._source.playbackRate.value=e)}_start(e){const t=zl[this._type];this._source=new Kn({url:t,context:this.context,fadeIn:this._fadeIn,fadeOut:this._fadeOut,loop:!0,onended:()=>this.onstop(this),playbackRate:this._playbackRate}).connect(this.output),this._source.start(this.toSeconds(e),Math.random()*(t.duration-.001))}_stop(e){this._source&&(this._source.stop(this.toSeconds(e)),this._source=null)}get fadeIn(){return this._fadeIn}set fadeIn(e){this._fadeIn=e,this._source&&(this._source.fadeIn=this._fadeIn)}get fadeOut(){return this._fadeOut}set fadeOut(e){this._fadeOut=e,this._source&&(this._source.fadeOut=this._fadeOut)}_restart(e){this._stop(e),this._start(e)}dispose(){return super.dispose(),this._source&&this._source.disconnect(),this}}const Rn=44100*5,la=2,as={brown:null,pink:null,white:null},zl={get brown(){if(!as.brown){const n=[];for(let e=0;e<la;e++){const t=new Float32Array(Rn);n[e]=t;let s=0;for(let i=0;i<Rn;i++){const r=Math.random()*2-1;t[i]=(s+.02*r)/1.02,s=t[i],t[i]*=3.5}}as.brown=new le().fromArray(n)}return as.brown},get pink(){if(!as.pink){const n=[];for(let e=0;e<la;e++){const t=new Float32Array(Rn);n[e]=t;let s,i,r,o,a,c,l;s=i=r=o=a=c=l=0;for(let u=0;u<Rn;u++){const h=Math.random()*2-1;s=.99886*s+h*.0555179,i=.99332*i+h*.0750759,r=.969*r+h*.153852,o=.8665*o+h*.3104856,a=.55*a+h*.5329522,c=-.7616*c-h*.016898,t[u]=s+i+r+o+a+c+l+h*.5362,t[u]*=.11,l=h*.115926}}as.pink=new le().fromArray(n)}return as.pink},get white(){if(!as.white){const n=[];for(let e=0;e<la;e++){const t=new Float32Array(Rn);n[e]=t;for(let s=0;s<Rn;s++)t[s]=Math.random()*2-1}as.white=new le().fromArray(n)}return as.white}};function kn(n,e){return Ue(this,void 0,void 0,function*(){const t=e/n.context.sampleRate,s=new zo(1,t,n.context.sampleRate);return new n.constructor(Object.assign(n.get(),{frequency:2/t,detune:0,context:s})).toDestination().start(0),(yield s.render()).getChannelData(0)})}class ho extends Qn{constructor(){super(I(ho.getDefaults(),arguments,["frequency","type"])),this.name="ToneOscillatorNode",this._oscillator=this.context.createOscillator(),this._internalChannels=[this._oscillator];const e=I(ho.getDefaults(),arguments,["frequency","type"]);zs(this._oscillator,this._gainNode),this.type=e.type,this.frequency=new ue({context:this.context,param:this._oscillator.frequency,units:"frequency",value:e.frequency}),this.detune=new ue({context:this.context,param:this._oscillator.detune,units:"cents",value:e.detune}),Te(this,["frequency","detune"])}static getDefaults(){return Object.assign(Qn.getDefaults(),{detune:0,frequency:440,type:"sine"})}start(e){const t=this.toSeconds(e);return this.log("start",t),this._startGain(t),this._oscillator.start(t),this}_stopSource(e){this._oscillator.stop(e)}setPeriodicWave(e){return this._oscillator.setPeriodicWave(e),this}get type(){return this._oscillator.type}set type(e){this._oscillator.type=e}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._oscillator.disconnect(),this.frequency.dispose(),this.detune.dispose(),this}}class Ne extends Ke{constructor(){super(I(Ne.getDefaults(),arguments,["frequency","type"])),this.name="Oscillator",this._oscillator=null;const e=I(Ne.getDefaults(),arguments,["frequency","type"]);this.frequency=new ye({context:this.context,units:"frequency",value:e.frequency}),Te(this,"frequency"),this.detune=new ye({context:this.context,units:"cents",value:e.detune}),Te(this,"detune"),this._partials=e.partials,this._partialCount=e.partialCount,this._type=e.type,e.partialCount&&e.type!=="custom"&&(this._type=this.baseType+e.partialCount.toString()),this.phase=e.phase}static getDefaults(){return Object.assign(Ke.getDefaults(),{detune:0,frequency:440,partialCount:0,partials:[],phase:0,type:"sine"})}_start(e){const t=this.toSeconds(e),s=new ho({context:this.context,onended:()=>this.onstop(this)});this._oscillator=s,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(t)}_stop(e){const t=this.toSeconds(e);this._oscillator&&this._oscillator.stop(t)}_restart(e){const t=this.toSeconds(e);return this.log("restart",t),this._oscillator&&this._oscillator.cancelStop(),this._state.cancel(t),this}syncFrequency(){return this.context.transport.syncSignal(this.frequency),this}unsyncFrequency(){return this.context.transport.unsyncSignal(this.frequency),this}_getCachedPeriodicWave(){if(this._type==="custom")return Ne._periodicWaveCache.find(t=>t.phase===this._phase&&Qy(t.partials,this._partials));{const e=Ne._periodicWaveCache.find(t=>t.type===this._type&&t.phase===this._phase);return this._partialCount=e?e.partialCount:this._partialCount,e}}get type(){return this._type}set type(e){this._type=e;const t=["sine","square","sawtooth","triangle"].indexOf(e)!==-1;if(this._phase===0&&t)this._wave=void 0,this._partialCount=0,this._oscillator!==null&&(this._oscillator.type=e);else{const s=this._getCachedPeriodicWave();if(te(s)){const{partials:i,wave:r}=s;this._wave=r,this._partials=i,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave)}else{const[i,r]=this._getRealImaginary(e,this._phase),o=this.context.createPeriodicWave(i,r);this._wave=o,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave),Ne._periodicWaveCache.push({imag:r,partialCount:this._partialCount,partials:this._partials,phase:this._phase,real:i,type:this._type,wave:this._wave}),Ne._periodicWaveCache.length>100&&Ne._periodicWaveCache.shift()}}}get baseType(){return this._type.replace(this.partialCount.toString(),"")}set baseType(e){this.partialCount&&this._type!=="custom"&&e!=="custom"?this.type=e+this.partialCount:this.type=e}get partialCount(){return this._partialCount}set partialCount(e){zt(e,0);let t=this._type;const s=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(this._type);if(s&&(t=s[1]),this._type!=="custom")e===0?this.type=t:this.type=t+e.toString();else{const i=new Float32Array(e);this._partials.forEach((r,o)=>i[o]=r),this._partials=Array.from(i),this.type=this._type}}_getRealImaginary(e,t){let i=2048;const r=new Float32Array(i),o=new Float32Array(i);let a=1;if(e==="custom"){if(a=this._partials.length+1,this._partialCount=this._partials.length,i=a,this._partials.length===0)return[r,o]}else{const c=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(e);c?(a=parseInt(c[2],10)+1,this._partialCount=parseInt(c[2],10),e=c[1],a=Math.max(a,2),i=a):this._partialCount=0,this._partials=[]}for(let c=1;c<i;++c){const l=2/(c*Math.PI);let u;switch(e){case"sine":u=c<=a?1:0,this._partials[c-1]=u;break;case"square":u=c&1?2*l:0,this._partials[c-1]=u;break;case"sawtooth":u=l*(c&1?1:-1),this._partials[c-1]=u;break;case"triangle":c&1?u=2*(l*l)*(c-1>>1&1?-1:1):u=0,this._partials[c-1]=u;break;case"custom":u=this._partials[c-1];break;default:throw new TypeError("Oscillator: invalid type: "+e)}u!==0?(r[c]=-u*Math.sin(t*c),o[c]=u*Math.cos(t*c)):(r[c]=0,o[c]=0)}return[r,o]}_inverseFFT(e,t,s){let i=0;const r=e.length;for(let o=0;o<r;o++)i+=e[o]*Math.cos(o*s)+t[o]*Math.sin(o*s);return i}getInitialValue(){const[e,t]=this._getRealImaginary(this._type,0);let s=0;const i=Math.PI*2,r=32;for(let o=0;o<r;o++)s=Math.max(this._inverseFFT(e,t,o/r*i),s);return Jy(-this._inverseFFT(e,t,this._phase)/s,-1,1)}get partials(){return this._partials.slice(0,this.partialCount)}set partials(e){this._partials=e,this._partialCount=this._partials.length,e.length&&(this.type="custom")}get phase(){return this._phase*(180/Math.PI)}set phase(e){this._phase=e*Math.PI/180,this.type=this._type}asArray(e=1024){return Ue(this,void 0,void 0,function*(){return kn(this,e)})}dispose(){return super.dispose(),this._oscillator!==null&&this._oscillator.dispose(),this._wave=void 0,this.frequency.dispose(),this.detune.dispose(),this}}Ne._periodicWaveCache=[];class vx extends _s{constructor(){super(...arguments),this.name="AudioToGain",this._norm=new mn({context:this.context,mapping:e=>(e+1)/2}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class Hs extends ye{constructor(){super(Object.assign(I(Hs.getDefaults(),arguments,["value"]))),this.name="Multiply",this.override=!1;const e=I(Hs.getDefaults(),arguments,["value"]);this._mult=this.input=this.output=new me({context:this.context,minValue:e.minValue,maxValue:e.maxValue}),this.factor=this._param=this._mult.gain,this.factor.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(ye.getDefaults(),{value:0})}dispose(){return super.dispose(),this._mult.dispose(),this}}class Yi extends Ke{constructor(){super(I(Yi.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="AMOscillator",this._modulationScale=new vx({context:this.context}),this._modulationNode=new me({context:this.context});const e=I(Yi.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new Ne({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase,type:e.type}),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this._modulator=new Ne({context:this.context,phase:e.phase,type:e.modulationType}),this.harmonicity=new Hs({context:this.context,units:"positive",value:e.harmonicity}),this.frequency.chain(this.harmonicity,this._modulator.frequency),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),Te(this,["frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(Ne.getDefaults(),{harmonicity:1,modulationType:"square"})}_start(e){this._modulator.start(e),this._carrier.start(e)}_stop(e){this._modulator.stop(e),this._carrier.stop(e)}_restart(e){this._modulator.restart(e),this._carrier.restart(e)}get type(){return this._carrier.type}set type(e){this._carrier.type=e}get baseType(){return this._carrier.baseType}set baseType(e){this._carrier.baseType=e}get partialCount(){return this._carrier.partialCount}set partialCount(e){this._carrier.partialCount=e}get modulationType(){return this._modulator.type}set modulationType(e){this._modulator.type=e}get phase(){return this._carrier.phase}set phase(e){this._carrier.phase=e,this._modulator.phase=e}get partials(){return this._carrier.partials}set partials(e){this._carrier.partials=e}asArray(e=1024){return Ue(this,void 0,void 0,function*(){return kn(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this._modulationScale.dispose(),this}}class Zi extends Ke{constructor(){super(I(Zi.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="FMOscillator",this._modulationNode=new me({context:this.context,gain:0});const e=I(Zi.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new Ne({context:this.context,detune:e.detune,frequency:0,onstop:()=>this.onstop(this),phase:e.phase,type:e.type}),this.detune=this._carrier.detune,this.frequency=new ye({context:this.context,units:"frequency",value:e.frequency}),this._modulator=new Ne({context:this.context,phase:e.phase,type:e.modulationType}),this.harmonicity=new Hs({context:this.context,units:"positive",value:e.harmonicity}),this.modulationIndex=new Hs({context:this.context,units:"positive",value:e.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),Te(this,["modulationIndex","frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(Ne.getDefaults(),{harmonicity:1,modulationIndex:2,modulationType:"square"})}_start(e){this._modulator.start(e),this._carrier.start(e)}_stop(e){this._modulator.stop(e),this._carrier.stop(e)}_restart(e){return this._modulator.restart(e),this._carrier.restart(e),this}get type(){return this._carrier.type}set type(e){this._carrier.type=e}get baseType(){return this._carrier.baseType}set baseType(e){this._carrier.baseType=e}get partialCount(){return this._carrier.partialCount}set partialCount(e){this._carrier.partialCount=e}get modulationType(){return this._modulator.type}set modulationType(e){this._modulator.type=e}get phase(){return this._carrier.phase}set phase(e){this._carrier.phase=e,this._modulator.phase=e}get partials(){return this._carrier.partials}set partials(e){this._carrier.partials=e}asArray(e=1024){return Ue(this,void 0,void 0,function*(){return kn(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this.modulationIndex.dispose(),this}}class Jn extends Ke{constructor(){super(I(Jn.getDefaults(),arguments,["frequency","width"])),this.name="PulseOscillator",this._widthGate=new me({context:this.context,gain:0}),this._thresh=new mn({context:this.context,mapping:t=>t<=0?-1:1});const e=I(Jn.getDefaults(),arguments,["frequency","width"]);this.width=new ye({context:this.context,units:"audioRange",value:e.width}),this._triangle=new Ne({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase,type:"triangle"}),this.frequency=this._triangle.frequency,this.detune=this._triangle.detune,this._triangle.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),Te(this,["width","frequency","detune"])}static getDefaults(){return Object.assign(Ke.getDefaults(),{detune:0,frequency:440,phase:0,type:"pulse",width:.2})}_start(e){e=this.toSeconds(e),this._triangle.start(e),this._widthGate.gain.setValueAtTime(1,e)}_stop(e){e=this.toSeconds(e),this._triangle.stop(e),this._widthGate.gain.cancelScheduledValues(e),this._widthGate.gain.setValueAtTime(0,e)}_restart(e){this._triangle.restart(e),this._widthGate.gain.cancelScheduledValues(e),this._widthGate.gain.setValueAtTime(1,e)}get phase(){return this._triangle.phase}set phase(e){this._triangle.phase=e}get type(){return"pulse"}get baseType(){return"pulse"}get partials(){return[]}get partialCount(){return 0}set carrierType(e){this._triangle.type=e}asArray(e=1024){return Ue(this,void 0,void 0,function*(){return kn(this,e)})}dispose(){return super.dispose(),this._triangle.dispose(),this.width.dispose(),this._widthGate.dispose(),this._thresh.dispose(),this}}class $i extends Ke{constructor(){super(I($i.getDefaults(),arguments,["frequency","type","spread"])),this.name="FatOscillator",this._oscillators=[];const e=I($i.getDefaults(),arguments,["frequency","type","spread"]);this.frequency=new ye({context:this.context,units:"frequency",value:e.frequency}),this.detune=new ye({context:this.context,units:"cents",value:e.detune}),this._spread=e.spread,this._type=e.type,this._phase=e.phase,this._partials=e.partials,this._partialCount=e.partialCount,this.count=e.count,Te(this,["frequency","detune"])}static getDefaults(){return Object.assign(Ne.getDefaults(),{count:3,spread:20,type:"sawtooth"})}_start(e){e=this.toSeconds(e),this._forEach(t=>t.start(e))}_stop(e){e=this.toSeconds(e),this._forEach(t=>t.stop(e))}_restart(e){this._forEach(t=>t.restart(e))}_forEach(e){for(let t=0;t<this._oscillators.length;t++)e(this._oscillators[t],t)}get type(){return this._type}set type(e){this._type=e,this._forEach(t=>t.type=e)}get spread(){return this._spread}set spread(e){if(this._spread=e,this._oscillators.length>1){const t=-e/2,s=e/(this._oscillators.length-1);this._forEach((i,r)=>i.detune.value=t+s*r)}}get count(){return this._oscillators.length}set count(e){if(zt(e,1),this._oscillators.length!==e){this._forEach(t=>t.dispose()),this._oscillators=[];for(let t=0;t<e;t++){const s=new Ne({context:this.context,volume:-6-e*1.1,type:this._type,phase:this._phase+t/e*360,partialCount:this._partialCount,onstop:t===0?()=>this.onstop(this):ce});this.type==="custom"&&(s.partials=this._partials),this.frequency.connect(s.frequency),this.detune.connect(s.detune),s.detune.overridden=!1,s.connect(this.output),this._oscillators[t]=s}this.spread=this._spread,this.state==="started"&&this._forEach(t=>t.start())}}get phase(){return this._phase}set phase(e){this._phase=e,this._forEach((t,s)=>t.phase=this._phase+s/this.count*360)}get baseType(){return this._oscillators[0].baseType}set baseType(e){this._forEach(t=>t.baseType=e),this._type=this._oscillators[0].type}get partials(){return this._oscillators[0].partials}set partials(e){this._partials=e,this._partialCount=this._partials.length,e.length&&(this._type="custom",this._forEach(t=>t.partials=e))}get partialCount(){return this._oscillators[0].partialCount}set partialCount(e){this._partialCount=e,this._forEach(t=>t.partialCount=e),this._type=this._oscillators[0].type}asArray(e=1024){return Ue(this,void 0,void 0,function*(){return kn(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this._forEach(e=>e.dispose()),this}}class Xi extends Ke{constructor(){super(I(Xi.getDefaults(),arguments,["frequency","modulationFrequency"])),this.name="PWMOscillator",this.sourceType="pwm",this._scale=new Hs({context:this.context,value:2});const e=I(Xi.getDefaults(),arguments,["frequency","modulationFrequency"]);this._pulse=new Jn({context:this.context,frequency:e.modulationFrequency}),this._pulse.carrierType="sine",this.modulationFrequency=this._pulse.frequency,this._modulator=new Ne({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase}),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),Te(this,["modulationFrequency","frequency","detune"])}static getDefaults(){return Object.assign(Ke.getDefaults(),{detune:0,frequency:440,modulationFrequency:.4,phase:0,type:"pwm"})}_start(e){e=this.toSeconds(e),this._modulator.start(e),this._pulse.start(e)}_stop(e){e=this.toSeconds(e),this._modulator.stop(e),this._pulse.stop(e)}_restart(e){this._modulator.restart(e),this._pulse.restart(e)}get type(){return"pwm"}get baseType(){return"pwm"}get partials(){return[]}get partialCount(){return 0}get phase(){return this._modulator.phase}set phase(e){this._modulator.phase=e}asArray(e=1024){return Ue(this,void 0,void 0,function*(){return kn(this,e)})}dispose(){return super.dispose(),this._pulse.dispose(),this._scale.dispose(),this._modulator.dispose(),this}}const Vl={am:Yi,fat:$i,fm:Zi,oscillator:Ne,pulse:Jn,pwm:Xi};class _n extends Ke{constructor(){super(I(_n.getDefaults(),arguments,["frequency","type"])),this.name="OmniOscillator";const e=I(_n.getDefaults(),arguments,["frequency","type"]);this.frequency=new ye({context:this.context,units:"frequency",value:e.frequency}),this.detune=new ye({context:this.context,units:"cents",value:e.detune}),Te(this,["frequency","detune"]),this.set(e)}static getDefaults(){return Object.assign(Ne.getDefaults(),Zi.getDefaults(),Yi.getDefaults(),$i.getDefaults(),Jn.getDefaults(),Xi.getDefaults())}_start(e){this._oscillator.start(e)}_stop(e){this._oscillator.stop(e)}_restart(e){return this._oscillator.restart(e),this}get type(){let e="";return["am","fm","fat"].some(t=>this._sourceType===t)&&(e=this._sourceType),e+this._oscillator.type}set type(e){e.substr(0,2)==="fm"?(this._createNewOscillator("fm"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(2)):e.substr(0,2)==="am"?(this._createNewOscillator("am"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(2)):e.substr(0,3)==="fat"?(this._createNewOscillator("fat"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(3)):e==="pwm"?(this._createNewOscillator("pwm"),this._oscillator=this._oscillator):e==="pulse"?this._createNewOscillator("pulse"):(this._createNewOscillator("oscillator"),this._oscillator=this._oscillator,this._oscillator.type=e)}get partials(){return this._oscillator.partials}set partials(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&(this._oscillator.partials=e)}get partialCount(){return this._oscillator.partialCount}set partialCount(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&(this._oscillator.partialCount=e)}set(e){return Reflect.has(e,"type")&&e.type&&(this.type=e.type),super.set(e),this}_createNewOscillator(e){if(e!==this._sourceType){this._sourceType=e;const t=Vl[e],s=this.now();if(this._oscillator){const i=this._oscillator;i.stop(s),this.context.setTimeout(()=>i.dispose(),this.blockTime)}this._oscillator=new t({context:this.context}),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this._oscillator.onstop=()=>this.onstop(this),this.state==="started"&&this._oscillator.start(s)}}get phase(){return this._oscillator.phase}set phase(e){this._oscillator.phase=e}get sourceType(){return this._sourceType}set sourceType(e){let t="sine";this._oscillator.type!=="pwm"&&this._oscillator.type!=="pulse"&&(t=this._oscillator.type),e==="fm"?this.type="fm"+t:e==="am"?this.type="am"+t:e==="fat"?this.type="fat"+t:e==="oscillator"?this.type=t:e==="pulse"?this.type="pulse":e==="pwm"&&(this.type="pwm")}_getOscType(e,t){return e instanceof Vl[t]}get baseType(){return this._oscillator.baseType}set baseType(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&e!=="pulse"&&e!=="pwm"&&(this._oscillator.baseType=e)}get width(){if(this._getOscType(this._oscillator,"pulse"))return this._oscillator.width}get count(){if(this._getOscType(this._oscillator,"fat"))return this._oscillator.count}set count(e){this._getOscType(this._oscillator,"fat")&&Bs(e)&&(this._oscillator.count=e)}get spread(){if(this._getOscType(this._oscillator,"fat"))return this._oscillator.spread}set spread(e){this._getOscType(this._oscillator,"fat")&&Bs(e)&&(this._oscillator.spread=e)}get modulationType(){if(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))return this._oscillator.modulationType}set modulationType(e){(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))&&ms(e)&&(this._oscillator.modulationType=e)}get modulationIndex(){if(this._getOscType(this._oscillator,"fm"))return this._oscillator.modulationIndex}get harmonicity(){if(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))return this._oscillator.harmonicity}get modulationFrequency(){if(this._getOscType(this._oscillator,"pwm"))return this._oscillator.modulationFrequency}asArray(e=1024){return Ue(this,void 0,void 0,function*(){return kn(this,e)})}dispose(){return super.dispose(),this.detune.dispose(),this.frequency.dispose(),this._oscillator.dispose(),this}}class Mc extends ye{constructor(){super(Object.assign(I(Mc.getDefaults(),arguments,["value"]))),this.override=!1,this.name="Add",this._sum=new me({context:this.context}),this.input=this._sum,this.output=this._sum,this.addend=this._param,ji(this._constantSource,this._sum)}static getDefaults(){return Object.assign(ye.getDefaults(),{value:0})}dispose(){return super.dispose(),this._sum.dispose(),this}}class fo extends _s{constructor(){super(Object.assign(I(fo.getDefaults(),arguments,["min","max"]))),this.name="Scale";const e=I(fo.getDefaults(),arguments,["min","max"]);this._mult=this.input=new Hs({context:this.context,value:e.max-e.min}),this._add=this.output=new Mc({context:this.context,value:e.min}),this._min=e.min,this._max=e.max,this.input.connect(this.output)}static getDefaults(){return Object.assign(_s.getDefaults(),{max:1,min:0})}get min(){return this._min}set min(e){this._min=e,this._setRange()}get max(){return this._max}set max(e){this._max=e,this._setRange()}_setRange(){this._add.value=this._min,this._mult.value=this._max-this._min}dispose(){return super.dispose(),this._add.dispose(),this._mult.dispose(),this}}function Uh(n,e=1/0){const t=new WeakMap;return function(s,i){Reflect.defineProperty(s,i,{configurable:!0,enumerable:!0,get:function(){return t.get(this)},set:function(r){zt(r,n,e),t.set(this,r)}})}}function Ss(n,e=1/0){const t=new WeakMap;return function(s,i){Reflect.defineProperty(s,i,{configurable:!0,enumerable:!0,get:function(){return t.get(this)},set:function(r){zt(this.toSeconds(r),n,e),t.set(this,r)}})}}class Qi extends Ke{constructor(){super(I(Qi.getDefaults(),arguments,["url","onload"])),this.name="Player",this._activeSources=new Set;const e=I(Qi.getDefaults(),arguments,["url","onload"]);this._buffer=new le({onload:this._onload.bind(this,e.onload),onerror:e.onerror,reverse:e.reverse,url:e.url}),this.autostart=e.autostart,this._loop=e.loop,this._loopStart=e.loopStart,this._loopEnd=e.loopEnd,this._playbackRate=e.playbackRate,this.fadeIn=e.fadeIn,this.fadeOut=e.fadeOut}static getDefaults(){return Object.assign(Ke.getDefaults(),{autostart:!1,fadeIn:0,fadeOut:0,loop:!1,loopEnd:0,loopStart:0,onload:ce,onerror:ce,playbackRate:1,reverse:!1})}load(e){return Ue(this,void 0,void 0,function*(){return yield this._buffer.load(e),this._onload(),this})}_onload(e=ce){e(),this.autostart&&this.start()}_onSourceEnd(e){this.onstop(this),this._activeSources.delete(e),this._activeSources.size===0&&!this._synced&&this._state.getValueAtTime(this.now())==="started"&&(this._state.cancel(this.now()),this._state.setStateAtTime("stopped",this.now()))}start(e,t,s){return super.start(e,t,s),this}_start(e,t,s){this._loop?t=jn(t,this._loopStart):t=jn(t,0);const i=this.toSeconds(t),r=s;s=jn(s,Math.max(this._buffer.duration-i,0));let o=this.toSeconds(s);o=o/this._playbackRate,e=this.toSeconds(e);const a=new Kn({url:this._buffer,context:this.context,fadeIn:this.fadeIn,fadeOut:this.fadeOut,loop:this._loop,loopEnd:this._loopEnd,loopStart:this._loopStart,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate}).connect(this.output);!this._loop&&!this._synced&&(this._state.cancel(e+o),this._state.setStateAtTime("stopped",e+o,{implicitEnd:!0})),this._activeSources.add(a),this._loop&&yt(r)?a.start(e,i):a.start(e,i,o-this.toSeconds(this.fadeOut))}_stop(e){const t=this.toSeconds(e);this._activeSources.forEach(s=>s.stop(t))}restart(e,t,s){return super.restart(e,t,s),this}_restart(e,t,s){var i;(i=[...this._activeSources].pop())===null||i===void 0||i.stop(e),this._start(e,t,s)}seek(e,t){const s=this.toSeconds(t);if(this._state.getValueAtTime(s)==="started"){const i=this.toSeconds(e);this._stop(s),this._start(s,i)}return this}setLoopPoints(e,t){return this.loopStart=e,this.loopEnd=t,this}get loopStart(){return this._loopStart}set loopStart(e){this._loopStart=e,this.buffer.loaded&&zt(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach(t=>{t.loopStart=e})}get loopEnd(){return this._loopEnd}set loopEnd(e){this._loopEnd=e,this.buffer.loaded&&zt(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach(t=>{t.loopEnd=e})}get buffer(){return this._buffer}set buffer(e){this._buffer.set(e)}get loop(){return this._loop}set loop(e){if(this._loop!==e&&(this._loop=e,this._activeSources.forEach(t=>{t.loop=e}),e)){const t=this._state.getNextState("stopped",this.now());t&&this._state.cancel(t.time)}}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e;const t=this.now(),s=this._state.getNextState("stopped",t);s&&s.implicitEnd&&(this._state.cancel(s.time),this._activeSources.forEach(i=>i.cancelStop())),this._activeSources.forEach(i=>{i.playbackRate.setValueAtTime(e,t)})}get reverse(){return this._buffer.reverse}set reverse(e){this._buffer.reverse=e}get loaded(){return this._buffer.loaded}dispose(){return super.dispose(),this._activeSources.forEach(e=>e.dispose()),this._activeSources.clear(),this._buffer.dispose(),this}}Vt([Ss(0)],Qi.prototype,"fadeIn",void 0);Vt([Ss(0)],Qi.prototype,"fadeOut",void 0);class yx extends _s{constructor(){super(...arguments),this.name="GainToAudio",this._norm=new mn({context:this.context,mapping:e=>Math.abs(e)*2-1}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class Mt extends W{constructor(){super(I(Mt.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="Envelope",this._sig=new ye({context:this.context,value:0}),this.output=this._sig,this.input=void 0;const e=I(Mt.getDefaults(),arguments,["attack","decay","sustain","release"]);this.attack=e.attack,this.decay=e.decay,this.sustain=e.sustain,this.release=e.release,this.attackCurve=e.attackCurve,this.releaseCurve=e.releaseCurve,this.decayCurve=e.decayCurve}static getDefaults(){return Object.assign(W.getDefaults(),{attack:.01,attackCurve:"linear",decay:.1,decayCurve:"exponential",release:1,releaseCurve:"exponential",sustain:.5})}get value(){return this.getValueAtTime(this.now())}_getCurve(e,t){if(ms(e))return e;{let s;for(s in Br)if(Br[s][t]===e)return s;return e}}_setCurve(e,t,s){if(ms(s)&&Reflect.has(Br,s)){const i=Br[s];an(i)?e!=="_decayCurve"&&(this[e]=i[t]):this[e]=i}else if(Lt(s)&&e!=="_decayCurve")this[e]=s;else throw new Error("Envelope: invalid curve: "+s)}get attackCurve(){return this._getCurve(this._attackCurve,"In")}set attackCurve(e){this._setCurve("_attackCurve","In",e)}get releaseCurve(){return this._getCurve(this._releaseCurve,"Out")}set releaseCurve(e){this._setCurve("_releaseCurve","Out",e)}get decayCurve(){return this._getCurve(this._decayCurve,"Out")}set decayCurve(e){this._setCurve("_decayCurve","Out",e)}triggerAttack(e,t=1){this.log("triggerAttack",e,t),e=this.toSeconds(e);let i=this.toSeconds(this.attack);const r=this.toSeconds(this.decay),o=this.getValueAtTime(e);if(o>0){const a=1/i;i=(1-o)/a}if(i<this.sampleTime)this._sig.cancelScheduledValues(e),this._sig.setValueAtTime(t,e);else if(this._attackCurve==="linear")this._sig.linearRampTo(t,i,e);else if(this._attackCurve==="exponential")this._sig.targetRampTo(t,i,e);else{this._sig.cancelAndHoldAtTime(e);let a=this._attackCurve;for(let c=1;c<a.length;c++)if(a[c-1]<=o&&o<=a[c]){a=this._attackCurve.slice(c),a[0]=o;break}this._sig.setValueCurveAtTime(a,e,i,t)}if(r&&this.sustain<1){const a=t*this.sustain,c=e+i;this.log("decay",c),this._decayCurve==="linear"?this._sig.linearRampToValueAtTime(a,r+c):this._sig.exponentialApproachValueAtTime(a,c,r)}return this}triggerRelease(e){this.log("triggerRelease",e),e=this.toSeconds(e);const t=this.getValueAtTime(e);if(t>0){const s=this.toSeconds(this.release);s<this.sampleTime?this._sig.setValueAtTime(0,e):this._releaseCurve==="linear"?this._sig.linearRampTo(0,s,e):this._releaseCurve==="exponential"?this._sig.targetRampTo(0,s,e):(K(Lt(this._releaseCurve),"releaseCurve must be either 'linear', 'exponential' or an array"),this._sig.cancelAndHoldAtTime(e),this._sig.setValueCurveAtTime(this._releaseCurve,e,s,t))}return this}getValueAtTime(e){return this._sig.getValueAtTime(e)}triggerAttackRelease(e,t,s=1){return t=this.toSeconds(t),this.triggerAttack(t,s),this.triggerRelease(t+this.toSeconds(e)),this}cancel(e){return this._sig.cancelScheduledValues(this.toSeconds(e)),this}connect(e,t=0,s=0){return Ec(this,e,t,s),this}asArray(e=1024){return Ue(this,void 0,void 0,function*(){const t=e/this.context.sampleRate,s=new zo(1,t,this.context.sampleRate),i=this.toSeconds(this.attack)+this.toSeconds(this.decay),r=i+this.toSeconds(this.release),o=r*.1,a=r+o,c=new this.constructor(Object.assign(this.get(),{attack:t*this.toSeconds(this.attack)/a,decay:t*this.toSeconds(this.decay)/a,release:t*this.toSeconds(this.release)/a,context:s}));return c._sig.toDestination(),c.triggerAttackRelease(t*(i+o)/a,0),(yield s.render()).getChannelData(0)})}dispose(){return super.dispose(),this._sig.dispose(),this}}Vt([Ss(0)],Mt.prototype,"attack",void 0);Vt([Ss(0)],Mt.prototype,"decay",void 0);Vt([Uh(0,1)],Mt.prototype,"sustain",void 0);Vt([Ss(0)],Mt.prototype,"release",void 0);const Br=(()=>{let e,t;const s=[];for(e=0;e<128;e++)s[e]=Math.sin(e/(128-1)*(Math.PI/2));const i=[],r=6.4;for(e=0;e<128-1;e++){t=e/(128-1);const f=Math.sin(t*(Math.PI*2)*r-Math.PI/2)+1;i[e]=f/10+t*.83}i[128-1]=1;const o=[],a=5;for(e=0;e<128;e++)o[e]=Math.ceil(e/(128-1)*a)/a;const c=[];for(e=0;e<128;e++)t=e/(128-1),c[e]=.5*(1-Math.cos(Math.PI*t));const l=[];for(e=0;e<128;e++){t=e/(128-1);const f=Math.pow(t,3)*4+.2,d=Math.cos(f*Math.PI*2*t);l[e]=Math.abs(d*(1-t))}function u(f){const d=new Array(f.length);for(let m=0;m<f.length;m++)d[m]=1-f[m];return d}function h(f){return f.slice(0).reverse()}return{bounce:{In:u(l),Out:l},cosine:{In:s,Out:h(s)},exponential:"exponential",linear:"linear",ripple:{In:i,Out:u(i)},sine:{In:c,Out:u(c)},step:{In:o,Out:u(o)}}})();class gn extends W{constructor(){super(I(gn.getDefaults(),arguments)),this._scheduledEvents=[],this._synced=!1,this._original_triggerAttack=this.triggerAttack,this._original_triggerRelease=this.triggerRelease,this._syncedRelease=t=>this._original_triggerRelease(t);const e=I(gn.getDefaults(),arguments);this._volume=this.output=new Vs({context:this.context,volume:e.volume}),this.volume=this._volume.volume,Te(this,"volume")}static getDefaults(){return Object.assign(W.getDefaults(),{volume:0})}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0),this.context.transport.on("stop",this._syncedRelease),this.context.transport.on("pause",this._syncedRelease),this.context.transport.on("loopEnd",this._syncedRelease)),this}_syncState(){let e=!1;return this._synced||(this._synced=!0,e=!0),e}_syncMethod(e,t){const s=this["_original_"+e]=this[e];this[e]=(...i)=>{const r=i[t],o=this.context.transport.schedule(a=>{i[t]=a,s.apply(this,i)},r);this._scheduledEvents.push(o)}}unsync(){return this._scheduledEvents.forEach(e=>this.context.transport.clear(e)),this._scheduledEvents=[],this._synced&&(this._synced=!1,this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease,this.context.transport.off("stop",this._syncedRelease),this.context.transport.off("pause",this._syncedRelease),this.context.transport.off("loopEnd",this._syncedRelease)),this}triggerAttackRelease(e,t,s,i){const r=this.toSeconds(s),o=this.toSeconds(t);return this.triggerAttack(e,r,i),this.triggerRelease(r+o),this}dispose(){return super.dispose(),this._volume.dispose(),this.unsync(),this._scheduledEvents=[],this}}class gs extends gn{constructor(){super(I(gs.getDefaults(),arguments));const e=I(gs.getDefaults(),arguments);this.portamento=e.portamento,this.onsilence=e.onsilence}static getDefaults(){return Object.assign(gn.getDefaults(),{detune:0,onsilence:ce,portamento:0})}triggerAttack(e,t,s=1){this.log("triggerAttack",e,t,s);const i=this.toSeconds(t);return this._triggerEnvelopeAttack(i,s),this.setNote(e,i),this}triggerRelease(e){this.log("triggerRelease",e);const t=this.toSeconds(e);return this._triggerEnvelopeRelease(t),this}setNote(e,t){const s=this.toSeconds(t),i=e instanceof Et?e.toFrequency():e;if(this.portamento>0&&this.getLevelAtTime(s)>.05){const r=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(i,r,s)}else this.frequency.setValueAtTime(i,s);return this}}Vt([Ss(0)],gs.prototype,"portamento",void 0);class jo extends Mt{constructor(){super(I(jo.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="AmplitudeEnvelope",this._gainNode=new me({context:this.context,gain:0}),this.output=this._gainNode,this.input=this._gainNode,this._sig.connect(this._gainNode.gain),this.output=this._gainNode,this.input=this._gainNode}dispose(){return super.dispose(),this._gainNode.dispose(),this}}class Ki extends gs{constructor(){super(I(Ki.getDefaults(),arguments)),this.name="Synth";const e=I(Ki.getDefaults(),arguments);this.oscillator=new _n(Object.assign({context:this.context,detune:e.detune,onstop:()=>this.onsilence(this)},e.oscillator)),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new jo(Object.assign({context:this.context},e.envelope)),this.oscillator.chain(this.envelope,this.output),Te(this,["oscillator","frequency","detune","envelope"])}static getDefaults(){return Object.assign(gs.getDefaults(),{envelope:Object.assign(Un(Mt.getDefaults(),Object.keys(W.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.3}),oscillator:Object.assign(Un(_n.getDefaults(),[...Object.keys(Ke.getDefaults()),"frequency","detune"]),{type:"triangle"})})}_triggerEnvelopeAttack(e,t){if(this.envelope.triggerAttack(e,t),this.oscillator.start(e),this.envelope.sustain===0){const s=this.toSeconds(this.envelope.attack),i=this.toSeconds(this.envelope.decay);this.oscillator.stop(e+s+i)}}_triggerEnvelopeRelease(e){this.envelope.triggerRelease(e),this.oscillator.stop(e+this.toSeconds(this.envelope.release))}getLevelAtTime(e){return e=this.toSeconds(e),this.envelope.getValueAtTime(e)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this}}class Ji extends W{constructor(){super(I(Ji.getDefaults(),arguments,["frequency","type"])),this.name="BiquadFilter";const e=I(Ji.getDefaults(),arguments,["frequency","type"]);this._filter=this.context.createBiquadFilter(),this.input=this.output=this._filter,this.Q=new ue({context:this.context,units:"number",value:e.Q,param:this._filter.Q}),this.frequency=new ue({context:this.context,units:"frequency",value:e.frequency,param:this._filter.frequency}),this.detune=new ue({context:this.context,units:"cents",value:e.detune,param:this._filter.detune}),this.gain=new ue({context:this.context,units:"decibels",convert:!1,value:e.gain,param:this._filter.gain}),this.type=e.type}static getDefaults(){return Object.assign(W.getDefaults(),{Q:1,type:"lowpass",frequency:350,detune:0,gain:0})}get type(){return this._filter.type}set type(e){K(["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(e)!==-1,`Invalid filter type: ${e}`),this._filter.type=e}getFrequencyResponse(e=128){const t=new Float32Array(e);for(let o=0;o<e;o++){const c=Math.pow(o/e,2)*(2e4-20)+20;t[o]=c}const s=new Float32Array(e),i=new Float32Array(e),r=this.context.createBiquadFilter();return r.type=this.type,r.Q.value=this.Q.value,r.frequency.value=this.frequency.value,r.gain.value=this.gain.value,r.getFrequencyResponse(t,s,i),s}dispose(){return super.dispose(),this._filter.disconnect(),this.Q.dispose(),this.frequency.dispose(),this.gain.dispose(),this.detune.dispose(),this}}class ei extends W{constructor(){super(I(ei.getDefaults(),arguments,["frequency","type","rolloff"])),this.name="Filter",this.input=new me({context:this.context}),this.output=new me({context:this.context}),this._filters=[];const e=I(ei.getDefaults(),arguments,["frequency","type","rolloff"]);this._filters=[],this.Q=new ye({context:this.context,units:"positive",value:e.Q}),this.frequency=new ye({context:this.context,units:"frequency",value:e.frequency}),this.detune=new ye({context:this.context,units:"cents",value:e.detune}),this.gain=new ye({context:this.context,units:"decibels",convert:!1,value:e.gain}),this._type=e.type,this.rolloff=e.rolloff,Te(this,["detune","frequency","gain","Q"])}static getDefaults(){return Object.assign(W.getDefaults(),{Q:1,detune:0,frequency:350,gain:0,rolloff:-12,type:"lowpass"})}get type(){return this._type}set type(e){K(["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(e)!==-1,`Invalid filter type: ${e}`),this._type=e,this._filters.forEach(s=>s.type=e)}get rolloff(){return this._rolloff}set rolloff(e){const t=Bs(e)?e:parseInt(e,10),s=[-12,-24,-48,-96];let i=s.indexOf(t);K(i!==-1,`rolloff can only be ${s.join(", ")}`),i+=1,this._rolloff=t,this.input.disconnect(),this._filters.forEach(r=>r.disconnect()),this._filters=new Array(i);for(let r=0;r<i;r++){const o=new Ji({context:this.context});o.type=this._type,this.frequency.connect(o.frequency),this.detune.connect(o.detune),this.Q.connect(o.Q),this.gain.connect(o.gain),this._filters[r]=o}this._internalChannels=this._filters,ji(this.input,...this._internalChannels,this.output)}getFrequencyResponse(e=128){const t=new Ji({frequency:this.frequency.value,gain:this.gain.value,Q:this.Q.value,type:this._type,detune:this.detune.value}),s=new Float32Array(e).map(()=>1);return this._filters.forEach(()=>{t.getFrequencyResponse(e).forEach((r,o)=>s[o]*=r)}),t.dispose(),s}dispose(){return super.dispose(),this._filters.forEach(e=>{e.dispose()}),Sc(this,["detune","frequency","gain","Q"]),this.frequency.dispose(),this.Q.dispose(),this.detune.dispose(),this.gain.dispose(),this}}class er extends Mt{constructor(){super(I(er.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="FrequencyEnvelope";const e=I(er.getDefaults(),arguments,["attack","decay","sustain","release"]);this._octaves=e.octaves,this._baseFrequency=this.toFrequency(e.baseFrequency),this._exponent=this.input=new qi({context:this.context,value:e.exponent}),this._scale=this.output=new fo({context:this.context,min:this._baseFrequency,max:this._baseFrequency*Math.pow(2,this._octaves)}),this._sig.chain(this._exponent,this._scale)}static getDefaults(){return Object.assign(Mt.getDefaults(),{baseFrequency:200,exponent:1,octaves:4})}get baseFrequency(){return this._baseFrequency}set baseFrequency(e){const t=this.toFrequency(e);zt(t,0),this._baseFrequency=t,this._scale.min=this._baseFrequency,this.octaves=this._octaves}get octaves(){return this._octaves}set octaves(e){this._octaves=e,this._scale.max=this._baseFrequency*Math.pow(2,e)}get exponent(){return this._exponent.value}set exponent(e){this._exponent.value=e}dispose(){return super.dispose(),this._exponent.dispose(),this._scale.dispose(),this}}class tr extends gs{constructor(){super(I(tr.getDefaults(),arguments)),this.name="MonoSynth";const e=I(tr.getDefaults(),arguments);this.oscillator=new _n(Object.assign(e.oscillator,{context:this.context,detune:e.detune,onstop:()=>this.onsilence(this)})),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.filter=new ei(Object.assign(e.filter,{context:this.context})),this.filterEnvelope=new er(Object.assign(e.filterEnvelope,{context:this.context})),this.envelope=new jo(Object.assign(e.envelope,{context:this.context})),this.oscillator.chain(this.filter,this.envelope,this.output),this.filterEnvelope.connect(this.filter.frequency),Te(this,["oscillator","frequency","detune","filter","filterEnvelope","envelope"])}static getDefaults(){return Object.assign(gs.getDefaults(),{envelope:Object.assign(Un(Mt.getDefaults(),Object.keys(W.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.9}),filter:Object.assign(Un(ei.getDefaults(),Object.keys(W.getDefaults())),{Q:1,rolloff:-12,type:"lowpass"}),filterEnvelope:Object.assign(Un(er.getDefaults(),Object.keys(W.getDefaults())),{attack:.6,baseFrequency:200,decay:.2,exponent:2,octaves:3,release:2,sustain:.5}),oscillator:Object.assign(Un(_n.getDefaults(),Object.keys(Ke.getDefaults())),{type:"sawtooth"})})}_triggerEnvelopeAttack(e,t=1){if(this.envelope.triggerAttack(e,t),this.filterEnvelope.triggerAttack(e),this.oscillator.start(e),this.envelope.sustain===0){const s=this.toSeconds(this.envelope.attack),i=this.toSeconds(this.envelope.decay);this.oscillator.stop(e+s+i)}}_triggerEnvelopeRelease(e){this.envelope.triggerRelease(e),this.filterEnvelope.triggerRelease(e),this.oscillator.stop(e+this.toSeconds(this.envelope.release))}getLevelAtTime(e){return e=this.toSeconds(e),this.envelope.getValueAtTime(e)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this.filterEnvelope.dispose(),this.filter.dispose(),this}}class sr extends Ki{constructor(){super(I(sr.getDefaults(),arguments)),this.name="MembraneSynth",this.portamento=0;const e=I(sr.getDefaults(),arguments);this.pitchDecay=e.pitchDecay,this.octaves=e.octaves,Te(this,["oscillator","envelope"])}static getDefaults(){return Vn(gs.getDefaults(),Ki.getDefaults(),{envelope:{attack:.001,attackCurve:"exponential",decay:.4,release:1.4,sustain:.01},octaves:10,oscillator:{type:"sine"},pitchDecay:.05})}setNote(e,t){const s=this.toSeconds(t),i=this.toFrequency(e instanceof Et?e.toFrequency():e),r=i*this.octaves;return this.oscillator.frequency.setValueAtTime(r,s),this.oscillator.frequency.exponentialRampToValueAtTime(i,s+this.toSeconds(this.pitchDecay)),this}dispose(){return super.dispose(),this}}Vt([Uh(0)],sr.prototype,"octaves",void 0);Vt([Ss(0)],sr.prototype,"pitchDecay",void 0);const Lh=new Set;function Dc(n){Lh.add(n)}function Bh(n,e){const t=`registerProcessor("${n}", ${e})`;Lh.add(t)}const xx=`
	/**
	 * The base AudioWorkletProcessor for use in Tone.js. Works with the [[ToneAudioWorklet]]. 
	 */
	class ToneAudioWorkletProcessor extends AudioWorkletProcessor {

		constructor(options) {
			
			super(options);
			/**
			 * If the processor was disposed or not. Keep alive until it's disposed.
			 */
			this.disposed = false;
		   	/** 
			 * The number of samples in the processing block
			 */
			this.blockSize = 128;
			/**
			 * the sample rate
			 */
			this.sampleRate = sampleRate;

			this.port.onmessage = (event) => {
				// when it receives a dispose 
				if (event.data === "dispose") {
					this.disposed = true;
				}
			};
		}
	}
`;Dc(xx);const Tx=`
	/**
	 * Abstract class for a single input/output processor. 
	 * has a 'generate' function which processes one sample at a time
	 */
	class SingleIOProcessor extends ToneAudioWorkletProcessor {

		constructor(options) {
			super(Object.assign(options, {
				numberOfInputs: 1,
				numberOfOutputs: 1
			}));
			/**
			 * Holds the name of the parameter and a single value of that
			 * parameter at the current sample
			 * @type { [name: string]: number }
			 */
			this.params = {}
		}

		/**
		 * Generate an output sample from the input sample and parameters
		 * @abstract
		 * @param input number
		 * @param channel number
		 * @param parameters { [name: string]: number }
		 * @returns number
		 */
		generate(){}

		/**
		 * Update the private params object with the 
		 * values of the parameters at the given index
		 * @param parameters { [name: string]: Float32Array },
		 * @param index number
		 */
		updateParams(parameters, index) {
			for (const paramName in parameters) {
				const param = parameters[paramName];
				if (param.length > 1) {
					this.params[paramName] = parameters[paramName][index];
				} else {
					this.params[paramName] = parameters[paramName][0];
				}
			}
		}

		/**
		 * Process a single frame of the audio
		 * @param inputs Float32Array[][]
		 * @param outputs Float32Array[][]
		 */
		process(inputs, outputs, parameters) {
			const input = inputs[0];
			const output = outputs[0];
			// get the parameter values
			const channelCount = Math.max(input && input.length || 0, output.length);
			for (let sample = 0; sample < this.blockSize; sample++) {
				this.updateParams(parameters, sample);
				for (let channel = 0; channel < channelCount; channel++) {
					const inputSample = input && input.length ? input[channel][sample] : 0;
					output[channel][sample] = this.generate(inputSample, channel, this.params);
				}
			}
			return !this.disposed;
		}
	};
`;Dc(Tx);const wx=`
	/**
	 * A multichannel buffer for use within an AudioWorkletProcessor as a delay line
	 */
	class DelayLine {
		
		constructor(size, channels) {
			this.buffer = [];
			this.writeHead = []
			this.size = size;

			// create the empty channels
			for (let i = 0; i < channels; i++) {
				this.buffer[i] = new Float32Array(this.size);
				this.writeHead[i] = 0;
			}
		}

		/**
		 * Push a value onto the end
		 * @param channel number
		 * @param value number
		 */
		push(channel, value) {
			this.writeHead[channel] += 1;
			if (this.writeHead[channel] > this.size) {
				this.writeHead[channel] = 0;
			}
			this.buffer[channel][this.writeHead[channel]] = value;
		}

		/**
		 * Get the recorded value of the channel given the delay
		 * @param channel number
		 * @param delay number delay samples
		 */
		get(channel, delay) {
			let readHead = this.writeHead[channel] - Math.floor(delay);
			if (readHead < 0) {
				readHead += this.size;
			}
			return this.buffer[channel][readHead];
		}
	}
`;Dc(wx);const kx="feedback-comb-filter",Sx=`
	class FeedbackCombFilterWorklet extends SingleIOProcessor {

		constructor(options) {
			super(options);
			this.delayLine = new DelayLine(this.sampleRate, options.channelCount || 2);
		}

		static get parameterDescriptors() {
			return [{
				name: "delayTime",
				defaultValue: 0.1,
				minValue: 0,
				maxValue: 1,
				automationRate: "k-rate"
			}, {
				name: "feedback",
				defaultValue: 0.5,
				minValue: 0,
				maxValue: 0.9999,
				automationRate: "k-rate"
			}];
		}

		generate(input, channel, parameters) {
			const delayedSample = this.delayLine.get(channel, parameters.delayTime * this.sampleRate);
			this.delayLine.push(channel, input + delayedSample * parameters.feedback);
			return delayedSample;
		}
	}
`;Bh(kx,Sx);class nr extends gn{constructor(){super(I(nr.getDefaults(),arguments,["urls","onload","baseUrl"],"urls")),this.name="Sampler",this._activeSources=new Map;const e=I(nr.getDefaults(),arguments,["urls","onload","baseUrl"],"urls"),t={};Object.keys(e.urls).forEach(s=>{const i=parseInt(s,10);if(K(Lr(s)||Bs(i)&&isFinite(i),`url key is neither a note or midi pitch: ${s}`),Lr(s)){const r=new Et(this.context,s).toMidi();t[r]=e.urls[s]}else Bs(i)&&isFinite(i)&&(t[i]=e.urls[i])}),this._buffers=new Oc({urls:t,onload:e.onload,baseUrl:e.baseUrl,onerror:e.onerror}),this.attack=e.attack,this.release=e.release,this.curve=e.curve,this._buffers.loaded&&Promise.resolve().then(e.onload)}static getDefaults(){return Object.assign(gn.getDefaults(),{attack:0,baseUrl:"",curve:"exponential",onload:ce,onerror:ce,release:.1,urls:{}})}_findClosest(e){let s=0;for(;s<96;){if(this._buffers.has(e+s))return-s;if(this._buffers.has(e-s))return s;s++}throw new Error(`No available buffers for note: ${e}`)}triggerAttack(e,t,s=1){return this.log("triggerAttack",e,t,s),Array.isArray(e)||(e=[e]),e.forEach(i=>{const r=Fh(new Et(this.context,i).toFrequency()),o=Math.round(r),a=r-o,c=this._findClosest(o),l=o-c,u=this._buffers.get(l),h=Nh(c+a),f=new Kn({url:u,context:this.context,curve:this.curve,fadeIn:this.attack,fadeOut:this.release,playbackRate:h}).connect(this.output);f.start(t,0,u.duration/h,s),Lt(this._activeSources.get(o))||this._activeSources.set(o,[]),this._activeSources.get(o).push(f),f.onended=()=>{if(this._activeSources&&this._activeSources.has(o)){const d=this._activeSources.get(o),m=d.indexOf(f);m!==-1&&d.splice(m,1)}}}),this}triggerRelease(e,t){return this.log("triggerRelease",e,t),Array.isArray(e)||(e=[e]),e.forEach(s=>{const i=new Et(this.context,s).toMidi();if(this._activeSources.has(i)&&this._activeSources.get(i).length){const r=this._activeSources.get(i);t=this.toSeconds(t),r.forEach(o=>{o.stop(t)}),this._activeSources.set(i,[])}}),this}releaseAll(e){const t=this.toSeconds(e);return this._activeSources.forEach(s=>{for(;s.length;)s.shift().stop(t)}),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}triggerAttackRelease(e,t,s,i=1){const r=this.toSeconds(s);return this.triggerAttack(e,r,i),Lt(t)?(K(Lt(e),"notes must be an array when duration is array"),e.forEach((o,a)=>{const c=t[Math.min(a,t.length-1)];this.triggerRelease(o,r+this.toSeconds(c))})):this.triggerRelease(e,r+this.toSeconds(t)),this}add(e,t,s){if(K(Lr(e)||isFinite(e),`note must be a pitch or midi: ${e}`),Lr(e)){const i=new Et(this.context,e).toMidi();this._buffers.add(i,t,s)}else this._buffers.add(e,t,s);return this}get loaded(){return this._buffers.loaded}dispose(){return super.dispose(),this._buffers.dispose(),this._activeSources.forEach(e=>{e.forEach(t=>t.dispose())}),this._activeSources.clear(),this}}Vt([Ss(0)],nr.prototype,"attack",void 0);Vt([Ss(0)],nr.prototype,"release",void 0);class po extends W{constructor(){super(Object.assign(I(po.getDefaults(),arguments,["fade"]))),this.name="CrossFade",this._panner=this.context.createStereoPanner(),this._split=this.context.createChannelSplitter(2),this._g2a=new yx({context:this.context}),this.a=new me({context:this.context,gain:0}),this.b=new me({context:this.context,gain:0}),this.output=new me({context:this.context}),this._internalChannels=[this.a,this.b];const e=I(po.getDefaults(),arguments,["fade"]);this.fade=new ye({context:this.context,units:"normalRange",value:e.fade}),Te(this,"fade"),this.context.getConstant(1).connect(this._panner),this._panner.connect(this._split),this._panner.channelCount=1,this._panner.channelCountMode="explicit",zs(this._split,this.a.gain,0),zs(this._split,this.b.gain,1),this.fade.chain(this._g2a,this._panner.pan),this.a.connect(this.output),this.b.connect(this.output)}static getDefaults(){return Object.assign(W.getDefaults(),{fade:.5})}dispose(){return super.dispose(),this.a.dispose(),this.b.dispose(),this.output.dispose(),this.fade.dispose(),this._g2a.dispose(),this._panner.disconnect(),this._split.disconnect(),this}}class jl extends W{constructor(e){super(e),this.name="Effect",this._dryWet=new po({context:this.context}),this.wet=this._dryWet.fade,this.effectSend=new me({context:this.context}),this.effectReturn=new me({context:this.context}),this.input=new me({context:this.context}),this.output=this._dryWet,this.input.fan(this._dryWet.a,this.effectSend),this.effectReturn.connect(this._dryWet.b),this.wet.setValueAtTime(e.wet,0),this._internalChannels=[this.effectReturn,this.effectSend],Te(this,"wet")}static getDefaults(){return Object.assign(W.getDefaults(),{wet:1})}connectEffect(e){return this._internalChannels.push(e),this.effectSend.chain(e,this.effectReturn),this}dispose(){return super.dispose(),this._dryWet.dispose(),this.effectSend.dispose(),this.effectReturn.dispose(),this.wet.dispose(),this}}class mo extends W{constructor(){super(Object.assign(I(mo.getDefaults(),arguments,["pan"]))),this.name="Panner",this._panner=this.context.createStereoPanner(),this.input=this._panner,this.output=this._panner;const e=I(mo.getDefaults(),arguments,["pan"]);this.pan=new ue({context:this.context,param:this._panner.pan,value:e.pan,minValue:-1,maxValue:1}),this._panner.channelCount=e.channelCount,this._panner.channelCountMode="explicit",Te(this,"pan")}static getDefaults(){return Object.assign(W.getDefaults(),{pan:0,channelCount:1})}dispose(){return super.dispose(),this._panner.disconnect(),this.pan.dispose(),this}}const Cx="bit-crusher",bx=`
	class BitCrusherWorklet extends SingleIOProcessor {

		static get parameterDescriptors() {
			return [{
				name: "bits",
				defaultValue: 12,
				minValue: 1,
				maxValue: 16,
				automationRate: 'k-rate'
			}];
		}

		generate(input, _channel, parameters) {
			const step = Math.pow(0.5, parameters.bits - 1);
			const val = step * Math.floor(input / step + 0.5);
			return val;
		}
	}
`;Bh(Cx,bx);class _o extends W{constructor(){super(I(_o.getDefaults(),arguments,["channels"])),this.name="Merge";const e=I(_o.getDefaults(),arguments,["channels"]);this._merger=this.output=this.input=this.context.createChannelMerger(e.channels)}static getDefaults(){return Object.assign(W.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._merger.disconnect(),this}}class go extends jl{constructor(){super(I(go.getDefaults(),arguments,["decay"])),this.name="Reverb",this._convolver=this.context.createConvolver(),this.ready=Promise.resolve();const e=I(go.getDefaults(),arguments,["decay"]);this._decay=e.decay,this._preDelay=e.preDelay,this.generate(),this.connectEffect(this._convolver)}static getDefaults(){return Object.assign(jl.getDefaults(),{decay:1.5,preDelay:.01})}get decay(){return this._decay}set decay(e){e=this.toSeconds(e),zt(e,.001),this._decay=e,this.generate()}get preDelay(){return this._preDelay}set preDelay(e){e=this.toSeconds(e),zt(e,0),this._preDelay=e,this.generate()}generate(){return Ue(this,void 0,void 0,function*(){const e=this.ready,t=new zo(2,this._decay+this._preDelay,this.context.sampleRate),s=new Gi({context:t}),i=new Gi({context:t}),r=new _o({context:t});s.connect(r,0,0),i.connect(r,0,1);const o=new me({context:t}).toDestination();r.connect(o),s.start(0),i.start(0),o.gain.setValueAtTime(0,0),o.gain.setValueAtTime(1,this._preDelay),o.gain.exponentialApproachValueAtTime(0,this._preDelay,this.decay);const a=t.render();return this.ready=a.then(ce),yield e,this._convolver.buffer=(yield a).get(),this})}dispose(){return super.dispose(),this._convolver.disconnect(),this}}class Pe extends W{constructor(){super(I(Pe.getDefaults(),arguments,["solo"])),this.name="Solo";const e=I(Pe.getDefaults(),arguments,["solo"]);this.input=this.output=new me({context:this.context}),Pe._allSolos.has(this.context)||Pe._allSolos.set(this.context,new Set),Pe._allSolos.get(this.context).add(this),this.solo=e.solo}static getDefaults(){return Object.assign(W.getDefaults(),{solo:!1})}get solo(){return this._isSoloed()}set solo(e){e?this._addSolo():this._removeSolo(),Pe._allSolos.get(this.context).forEach(t=>t._updateSolo())}get muted(){return this.input.gain.value===0}_addSolo(){Pe._soloed.has(this.context)||Pe._soloed.set(this.context,new Set),Pe._soloed.get(this.context).add(this)}_removeSolo(){Pe._soloed.has(this.context)&&Pe._soloed.get(this.context).delete(this)}_isSoloed(){return Pe._soloed.has(this.context)&&Pe._soloed.get(this.context).has(this)}_noSolos(){return!Pe._soloed.has(this.context)||Pe._soloed.has(this.context)&&Pe._soloed.get(this.context).size===0}_updateSolo(){this._isSoloed()?this.input.gain.value=1:this._noSolos()?this.input.gain.value=1:this.input.gain.value=0}dispose(){return super.dispose(),Pe._allSolos.get(this.context).delete(this),this._removeSolo(),this}}Pe._allSolos=new Map;Pe._soloed=new Map;class vo extends W{constructor(){super(I(vo.getDefaults(),arguments,["pan","volume"])),this.name="PanVol";const e=I(vo.getDefaults(),arguments,["pan","volume"]);this._panner=this.input=new mo({context:this.context,pan:e.pan,channelCount:e.channelCount}),this.pan=this._panner.pan,this._volume=this.output=new Vs({context:this.context,volume:e.volume}),this.volume=this._volume.volume,this._panner.connect(this._volume),this.mute=e.mute,Te(this,["pan","volume"])}static getDefaults(){return Object.assign(W.getDefaults(),{mute:!1,pan:0,volume:0,channelCount:1})}get mute(){return this._volume.mute}set mute(e){this._volume.mute=e}dispose(){return super.dispose(),this._panner.dispose(),this.pan.dispose(),this._volume.dispose(),this.volume.dispose(),this}}class sn extends W{constructor(){super(I(sn.getDefaults(),arguments,["volume","pan"])),this.name="Channel";const e=I(sn.getDefaults(),arguments,["volume","pan"]);this._solo=this.input=new Pe({solo:e.solo,context:this.context}),this._panVol=this.output=new vo({context:this.context,pan:e.pan,volume:e.volume,mute:e.mute,channelCount:e.channelCount}),this.pan=this._panVol.pan,this.volume=this._panVol.volume,this._solo.connect(this._panVol),Te(this,["pan","volume"])}static getDefaults(){return Object.assign(W.getDefaults(),{pan:0,volume:0,mute:!1,solo:!1,channelCount:1})}get solo(){return this._solo.solo}set solo(e){this._solo.solo=e}get muted(){return this._solo.muted||this.mute}get mute(){return this._panVol.mute}set mute(e){this._panVol.mute=e}_getBus(e){return sn.buses.has(e)||sn.buses.set(e,new me({context:this.context})),sn.buses.get(e)}send(e,t=0){const s=this._getBus(e),i=new me({context:this.context,units:"decibels",gain:t});return this.connect(i),i.connect(s),i}receive(e){return this._getBus(e).connect(this),this}dispose(){return super.dispose(),this._panVol.dispose(),this.pan.dispose(),this.volume.dispose(),this._solo.dispose(),this}}sn.buses=new Map;class Ex extends W{constructor(){super(...arguments),this.name="Listener",this.positionX=new ue({context:this.context,param:this.context.rawContext.listener.positionX}),this.positionY=new ue({context:this.context,param:this.context.rawContext.listener.positionY}),this.positionZ=new ue({context:this.context,param:this.context.rawContext.listener.positionZ}),this.forwardX=new ue({context:this.context,param:this.context.rawContext.listener.forwardX}),this.forwardY=new ue({context:this.context,param:this.context.rawContext.listener.forwardY}),this.forwardZ=new ue({context:this.context,param:this.context.rawContext.listener.forwardZ}),this.upX=new ue({context:this.context,param:this.context.rawContext.listener.upX}),this.upY=new ue({context:this.context,param:this.context.rawContext.listener.upY}),this.upZ=new ue({context:this.context,param:this.context.rawContext.listener.upZ})}static getDefaults(){return Object.assign(W.getDefaults(),{positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:-1,upX:0,upY:1,upZ:0})}dispose(){return super.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this.forwardX.dispose(),this.forwardY.dispose(),this.forwardZ.dispose(),this.upX.dispose(),this.upY.dispose(),this.upZ.dispose(),this}}Lo(n=>{n.listener=new Ex({context:n})});Bo(n=>{n.listener.dispose()});Ft().transport;const Rc=Ft().destination;Ft().destination;Ft().listener;Ft().draw;Ft();const Pc=new ei(900,"highpass"),zh=new Vs(-6);zh.chain(Pc,Rc);const Ox=new go(3).connect(zh),Ho=new tr({envelope:{attack:0,decay:.9,sustain:.2,release:.1}});Ho.oscillator.type="triangle2";Ho.volume.value=-6;Ho.chain(Pc,Rc);const qo=new tr({envelope:{attack:.4,decay:.9,sustain:.7,release:.6}}).connect(Ox);qo.oscillator.type="triangle";qo.volume.value=-6;qo.chain(Pc,Rc);function Ax(){return Math.floor((Math.random()-.5)*20)}let Hl=!1;const Mx=async(n=0)=>{Hl||(await ix(),Hl=!0);try{if(n>2e3)qo.triggerAttackRelease(60,.3);else if(n>1e3){let e=310;e+=Ax(),Ho.triggerAttackRelease(e,.001)}}catch(e){console.warn(e)}},zr=1800,Dx=(n,e)=>n.clone().normalize().clone().negate().normalize().multiplyScalar(e).add(n),Rx=(n,e,t,s,i)=>{const r=new Yf,o=1e-5;r.absarc(o,o,o,-Math.PI/2,-Math.PI,!0),r.absarc(o,e-s*2,o,Math.PI,Math.PI/2,!0),r.absarc(n-s*2,e-s*2,o,Math.PI/2,0,!0),r.absarc(n-s*2,o,o,0,-Math.PI/2,!0);const a=new Zf(r,{depth:t-s*2,bevelEnabled:!0,bevelSegments:i,steps:2,bevelSize:s,bevelThickness:s,curveSegments:i});a.center();const c=[],l=a.getAttribute("normal"),u=a.getAttribute("position");for(let h=0;h<u.count;h+=1){const f=new X(l.getX(h),l.getY(h),l.getZ(h)),d=new X(u.getX(h),u.getY(h),u.getZ(h));let m=0,p=0;Math.abs(f.y)>.9?(m=d.x/n+.5,p=1-(d.z/t+.5)):Math.abs(f.x)>.9?(m=-d.z/t+.5,p=1-(-d.y/e+.5)):Math.abs(f.z)>.9&&(m=d.x/n+.5,p=1-(-d.y/e+.5)),c.push(m,p)}return a.setAttribute("uv",new $f(c,2)),a};Rx(10,10,10,2,10);const ql=new Gf(10,10,10),Px=500,Ix=800,Nx=new X(0,0,0),Fx=16777215,Ux=20,Lx=(n,e)=>{var r,o;if(!(n!=null&&n.ref_id)||!(e!=null&&e.ref_id))return!1;let t=!1;const s=n.guests,i=e.guests;return((r=n.children)!=null&&r.includes(e.ref_id)||(o=e.children)!=null&&o.includes(n.ref_id))&&(t=!0),(s!=null&&s.find(a=>a.ref_id===e.ref_id)||i!=null&&i.find(a=>a.ref_id===n.ref_id))&&(t=!0),t};let bi=null;const Bx=500,Vh=(n,e)=>{if(bi)return null;bi=setTimeout(()=>{bi&&(clearTimeout(bi),bi=null)},Bx);const t=[];return n.forEach(i=>{const r=e.position.distanceTo(Nx.set(i.x,i.y,i.z));r<Ix&&t.push({id:i.ref_id||"",distance:r})}),t.sort((i,r)=>i.distance-r.distance).slice(0,Px).map(i=>i.id)};let Pn,Ei;const zx=1e3,Vx=2e3,jx=n=>{const e=Jt(),t=Ns(x=>x.isUserDragging),s=Ns(x=>x.isUserScrolling),i=Ns(x=>x.setUserMovedCamera),{data:r,graphStyle:o,showSelectionGraph:a,setNearbyNodeIds:c,cameraFocusTrigger:l,graphRadius:u}=nt(x=>x),{camera:h}=ve(),[f,d]=E.useState(!1),[m,p]=E.useState(!1),[_,v]=E.useState(xl),T=E.useMemo(()=>{if(a)return new X(0,0,0);const x=r==null?void 0:r.nodes.find(O=>O.ref_id===(e==null?void 0:e.ref_id)),C=u+300;let b=new X(0,0,C);if(x&&r){const O=r==null?void 0:r.nodes.filter(N=>{var U;return(U=x.children)==null?void 0:U.find(V=>V===N.id)}),A=new X(x.x,x.y,x.z);let R=new X(0,0,0);O.map(N=>(R=R.add(new X(N.x,N.y,N.z).normalize()),N));const P=x.scale?1-1/(x.scale+10):1,F=A.sub(R).multiplyScalar(.8*P);b=A.add(F)}return b},[a,e,r,u]),S=E.useMemo(()=>{if(a)return new X(0,0,0);const x=r==null?void 0:r.nodes.find(C=>C.ref_id===(e==null?void 0:e.ref_id));return new X((x==null?void 0:x.x)||0,(x==null?void 0:x.y)||0,(x==null?void 0:x.z)||0)},[a,e,r]);E.useEffect(()=>{var x;a&&((x=n.current)==null||x.setLookAt(aa.x,aa.y,aa.z,0,0,0,!1)),y()},[a]),E.useEffect(()=>{a?v(Pm):(e==null?void 0:e.node_type)==="topic"?v(Rm):v(xl)},[e,v,a]),E.useEffect(()=>{g()},[l]),E.useEffect(()=>{(t||s)&&(d(!0),p(!0))},[t,s,d,p]),E.useEffect(()=>{if(e)if(!a&&o==="earth"&&(n!=null&&n.current)){const x=n.current.camera.position.distanceTo(new X),C=Dx(S,-x/2);n.current.setLookAt(C.x,C.y,C.z,0,0,0,!0)}else Pn&&clearTimeout(Pn),Pn=setTimeout(()=>{p(!0),clearTimeout(Pn)},Vx),y();return()=>{Pn&&clearTimeout(Pn),Ei&&clearTimeout(Ei)}},[e]),Rt(x=>{n.current&&(f||w(T,x.camera),m||k(S,x.camera))});const y=()=>{if(e){const x=h.position.distanceTo(T);Mx(x)}g()},g=()=>{d(!1),p(!1),i(!1),Ei&&clearTimeout(Ei),Ei=setTimeout(()=>{d(!0),p(!0)},zx)},w=(x,C)=>{if(C.position.distanceTo(x)<_)d(!0);else{C.position.lerp(x,.5);const O=Vh((r==null?void 0:r.nodes)||[],h);O&&c(O)}},k=(x,C)=>{var b;(b=n==null?void 0:n.current)==null||b.setLookAt(C.position.x,C.position.y,C.position.z,x.x,x.y,x.z,!0)};return null},Hx=1;let Vr=null;const qx=(n,{enabled:e})=>{const t=Jt();jx(n);const s=Ns(a=>a.isUserDragging),{graphStyle:i,graphRadius:r,disableCameraRotation:o}=nt(a=>a);return E.useEffect(()=>{e||(Vr==null||Vr.kill(),Vr=null)},[e]),E.useEffect(()=>{n.current&&r&&(i==="sphere"?(n.current.maxDistance=8e3,n.current.minDistance=200,n.current.setTarget(0,0,500,!0)):(n.current.maxDistance=n.current.getDistanceToFitSphere(r+200),n.current.minDistance=100))},[r,i,n]),E.useEffect(()=>{!t&&n.current&&n.current.setLookAt(Pi.x,Pi.y,r,0,0,0,!0)},[t,r]),Rt((a,c)=>{n.current&&(!o&&!s&&(n.current.azimuthAngle+=Hx*c*Xf.DEG2RAD),n.current.update(c))}),null},Wx=({disableAnimations:n})=>{const e=E.useRef(null),{data:t,setNearbyNodeIds:s,setDisableCameraRotation:i}=nt(h=>h),[r]=E.useState(.8),{camera:o}=ve(),[a,c,l,u]=Ns(h=>[h.isUserDragging,h.setIsUserDragging,h.isUserScrolling,h.isUserScrollingOnHtmlPanel]);return qx(e,{enabled:!n&&!l&&!a}),E.useEffect(()=>{if(!a){const h=Vh((t==null?void 0:t.nodes)||[],o);h&&s(h)}},[o,o.position,o.position.x,o.position.y,o.position.z,t==null?void 0:t.nodes,s,a]),E.useEffect(()=>{a&&i(!0)},[a,i]),M.jsx(Ap,{ref:e,boundaryEnclosesCamera:!0,enabled:!u,makeDefault:!0,maxDistance:12e3,minDistance:100,onEnd:()=>c(!1),onStart:()=>c(!0),smoothTime:r})};function ls(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function jh(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.__proto__=e}/*!
 * GSAP 3.12.4
 * https://gsap.com
 *
 * @license Copyright 2008-2023, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license or for
 * Club GSAP members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var xt={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},ti={duration:.5,overwrite:!1,delay:0},Ic,Xe,De,Ot=1e8,fe=1/Ot,Ia=Math.PI*2,Gx=Ia/4,Yx=0,Hh=Math.sqrt,Zx=Math.cos,$x=Math.sin,Ge=function(e){return typeof e=="string"},Re=function(e){return typeof e=="function"},vs=function(e){return typeof e=="number"},Nc=function(e){return typeof e>"u"},Kt=function(e){return typeof e=="object"},lt=function(e){return e!==!1},Fc=function(){return typeof window<"u"},jr=function(e){return Re(e)||Ge(e)},qh=typeof ArrayBuffer=="function"&&ArrayBuffer.isView||function(){},Qe=Array.isArray,Na=/(?:-?\.?\d|\.)+/gi,Wh=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,Bn=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,ua=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,Gh=/[+-]=-?[.\d]+/,Yh=/[^,'"\[\]\s]+/gi,Xx=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,be,bt,Fa,Uc,wt={},yo={},Zh,$h=function(e){return(yo=vn(e,wt))&&pt},Lc=function(e,t){return console.warn("Invalid property",e,"set to",t,"Missing plugin? gsap.registerPlugin()")},ir=function(e,t){return!t&&console.warn(e)},Xh=function(e,t){return e&&(wt[e]=t)&&yo&&(yo[e]=t)||wt},rr=function(){return 0},Qx={suppressEvents:!0,isStart:!0,kill:!1},Gr={suppressEvents:!0,kill:!1},Kx={suppressEvents:!0},Bc={},Us=[],Ua={},Qh,_t={},ha={},Wl=30,Yr=[],zc="",Vc=function(e){var t=e[0],s,i;if(Kt(t)||Re(t)||(e=[e]),!(s=(t._gsap||{}).harness)){for(i=Yr.length;i--&&!Yr[i].targetTest(t););s=Yr[i]}for(i=e.length;i--;)e[i]&&(e[i]._gsap||(e[i]._gsap=new Td(e[i],s)))||e.splice(i,1);return e},ln=function(e){return e._gsap||Vc(At(e))[0]._gsap},Kh=function(e,t,s){return(s=e[t])&&Re(s)?e[t]():Nc(s)&&e.getAttribute&&e.getAttribute(t)||s},ut=function(e,t){return(e=e.split(",")).forEach(t)||e},Ie=function(e){return Math.round(e*1e5)/1e5||0},He=function(e){return Math.round(e*1e7)/1e7||0},Hn=function(e,t){var s=t.charAt(0),i=parseFloat(t.substr(2));return e=parseFloat(e),s==="+"?e+i:s==="-"?e-i:s==="*"?e*i:e/i},Jx=function(e,t){for(var s=t.length,i=0;e.indexOf(t[i])<0&&++i<s;);return i<s},xo=function(){var e=Us.length,t=Us.slice(0),s,i;for(Ua={},Us.length=0,s=0;s<e;s++)i=t[s],i&&i._lazy&&(i.render(i._lazy[0],i._lazy[1],!0)._lazy=0)},Jh=function(e,t,s,i){Us.length&&!Xe&&xo(),e.render(t,s,i||Xe&&t<0&&(e._initted||e._startAt)),Us.length&&!Xe&&xo()},ed=function(e){var t=parseFloat(e);return(t||t===0)&&(e+"").match(Yh).length<2?t:Ge(e)?e.trim():e},td=function(e){return e},Dt=function(e,t){for(var s in t)s in e||(e[s]=t[s]);return e},eT=function(e){return function(t,s){for(var i in s)i in t||i==="duration"&&e||i==="ease"||(t[i]=s[i])}},vn=function(e,t){for(var s in t)e[s]=t[s];return e},Gl=function n(e,t){for(var s in t)s!=="__proto__"&&s!=="constructor"&&s!=="prototype"&&(e[s]=Kt(t[s])?n(e[s]||(e[s]={}),t[s]):t[s]);return e},To=function(e,t){var s={},i;for(i in e)i in t||(s[i]=e[i]);return s},Ni=function(e){var t=e.parent||be,s=e.keyframes?eT(Qe(e.keyframes)):Dt;if(lt(e.inherit))for(;t;)s(e,t.vars.defaults),t=t.parent||t._dp;return e},tT=function(e,t){for(var s=e.length,i=s===t.length;i&&s--&&e[s]===t[s];);return s<0},sd=function(e,t,s,i,r){s===void 0&&(s="_first"),i===void 0&&(i="_last");var o=e[i],a;if(r)for(a=t[r];o&&o[r]>a;)o=o._prev;return o?(t._next=o._next,o._next=t):(t._next=e[s],e[s]=t),t._next?t._next._prev=t:e[i]=t,t._prev=o,t.parent=t._dp=e,t},Wo=function(e,t,s,i){s===void 0&&(s="_first"),i===void 0&&(i="_last");var r=t._prev,o=t._next;r?r._next=o:e[s]===t&&(e[s]=o),o?o._prev=r:e[i]===t&&(e[i]=r),t._next=t._prev=t.parent=null},qs=function(e,t){e.parent&&(!t||e.parent.autoRemoveChildren)&&e.parent.remove&&e.parent.remove(e),e._act=0},un=function(e,t){if(e&&(!t||t._end>e._dur||t._start<0))for(var s=e;s;)s._dirty=1,s=s.parent;return e},sT=function(e){for(var t=e.parent;t&&t.parent;)t._dirty=1,t.totalDuration(),t=t.parent;return e},La=function(e,t,s,i){return e._startAt&&(Xe?e._startAt.revert(Gr):e.vars.immediateRender&&!e.vars.autoRevert||e._startAt.render(t,!0,i))},nT=function n(e){return!e||e._ts&&n(e.parent)},Yl=function(e){return e._repeat?si(e._tTime,e=e.duration()+e._rDelay)*e:0},si=function(e,t){var s=Math.floor(e/=t);return e&&s===e?s-1:s},wo=function(e,t){return(e-t._start)*t._ts+(t._ts>=0?0:t._dirty?t.totalDuration():t._tDur)},Go=function(e){return e._end=He(e._start+(e._tDur/Math.abs(e._ts||e._rts||fe)||0))},Yo=function(e,t){var s=e._dp;return s&&s.smoothChildTiming&&e._ts&&(e._start=He(s._time-(e._ts>0?t/e._ts:((e._dirty?e.totalDuration():e._tDur)-t)/-e._ts)),Go(e),s._dirty||un(s,e)),e},nd=function(e,t){var s;if((t._time||!t._dur&&t._initted||t._start<e._time&&(t._dur||!t.add))&&(s=wo(e.rawTime(),t),(!t._dur||Sr(0,t.totalDuration(),s)-t._tTime>fe)&&t.render(s,!0)),un(e,t)._dp&&e._initted&&e._time>=e._dur&&e._ts){if(e._dur<e.duration())for(s=e;s._dp;)s.rawTime()>=0&&s.totalTime(s._tTime),s=s._dp;e._zTime=-fe}},Yt=function(e,t,s,i){return t.parent&&qs(t),t._start=He((vs(s)?s:s||e!==be?Ct(e,s,t):e._time)+t._delay),t._end=He(t._start+(t.totalDuration()/Math.abs(t.timeScale())||0)),sd(e,t,"_first","_last",e._sort?"_start":0),Ba(t)||(e._recent=t),i||nd(e,t),e._ts<0&&Yo(e,e._tTime),e},id=function(e,t){return(wt.ScrollTrigger||Lc("scrollTrigger",t))&&wt.ScrollTrigger.create(t,e)},rd=function(e,t,s,i,r){if(Hc(e,t,r),!e._initted)return 1;if(!s&&e._pt&&!Xe&&(e._dur&&e.vars.lazy!==!1||!e._dur&&e.vars.lazy)&&Qh!==gt.frame)return Us.push(e),e._lazy=[r,i],1},iT=function n(e){var t=e.parent;return t&&t._ts&&t._initted&&!t._lock&&(t.rawTime()<0||n(t))},Ba=function(e){var t=e.data;return t==="isFromStart"||t==="isStart"},rT=function(e,t,s,i){var r=e.ratio,o=t<0||!t&&(!e._start&&iT(e)&&!(!e._initted&&Ba(e))||(e._ts<0||e._dp._ts<0)&&!Ba(e))?0:1,a=e._rDelay,c=0,l,u,h;if(a&&e._repeat&&(c=Sr(0,e._tDur,t),u=si(c,a),e._yoyo&&u&1&&(o=1-o),u!==si(e._tTime,a)&&(r=1-o,e.vars.repeatRefresh&&e._initted&&e.invalidate())),o!==r||Xe||i||e._zTime===fe||!t&&e._zTime){if(!e._initted&&rd(e,t,i,s,c))return;for(h=e._zTime,e._zTime=t||(s?fe:0),s||(s=t&&!h),e.ratio=o,e._from&&(o=1-o),e._time=0,e._tTime=c,l=e._pt;l;)l.r(o,l.d),l=l._next;t<0&&La(e,t,s,!0),e._onUpdate&&!s&&vt(e,"onUpdate"),c&&e._repeat&&!s&&e.parent&&vt(e,"onRepeat"),(t>=e._tDur||t<0)&&e.ratio===o&&(o&&qs(e,1),!s&&!Xe&&(vt(e,o?"onComplete":"onReverseComplete",!0),e._prom&&e._prom()))}else e._zTime||(e._zTime=t)},oT=function(e,t,s){var i;if(s>t)for(i=e._first;i&&i._start<=s;){if(i.data==="isPause"&&i._start>t)return i;i=i._next}else for(i=e._last;i&&i._start>=s;){if(i.data==="isPause"&&i._start<t)return i;i=i._prev}},ni=function(e,t,s,i){var r=e._repeat,o=He(t)||0,a=e._tTime/e._tDur;return a&&!i&&(e._time*=o/e._dur),e._dur=o,e._tDur=r?r<0?1e10:He(o*(r+1)+e._rDelay*r):o,a>0&&!i&&Yo(e,e._tTime=e._tDur*a),e.parent&&Go(e),s||un(e.parent,e),e},Zl=function(e){return e instanceof tt?un(e):ni(e,e._dur)},aT={_start:0,endTime:rr,totalDuration:rr},Ct=function n(e,t,s){var i=e.labels,r=e._recent||aT,o=e.duration()>=Ot?r.endTime(!1):e._dur,a,c,l;return Ge(t)&&(isNaN(t)||t in i)?(c=t.charAt(0),l=t.substr(-1)==="%",a=t.indexOf("="),c==="<"||c===">"?(a>=0&&(t=t.replace(/=/,"")),(c==="<"?r._start:r.endTime(r._repeat>=0))+(parseFloat(t.substr(1))||0)*(l?(a<0?r:s).totalDuration()/100:1)):a<0?(t in i||(i[t]=o),i[t]):(c=parseFloat(t.charAt(a-1)+t.substr(a+1)),l&&s&&(c=c/100*(Qe(s)?s[0]:s).totalDuration()),a>1?n(e,t.substr(0,a-1),s)+c:o+c)):t==null?o:+t},Fi=function(e,t,s){var i=vs(t[1]),r=(i?2:1)+(e<2?0:1),o=t[r],a,c;if(i&&(o.duration=t[1]),o.parent=s,e){for(a=o,c=s;c&&!("immediateRender"in a);)a=c.vars.defaults||{},c=lt(c.vars.inherit)&&c.parent;o.immediateRender=lt(a.immediateRender),e<2?o.runBackwards=1:o.startAt=t[r-1]}return new ze(t[0],o,t[r+1])},Zs=function(e,t){return e||e===0?t(e):t},Sr=function(e,t,s){return s<e?e:s>t?t:s},$e=function(e,t){return!Ge(e)||!(t=Xx.exec(e))?"":t[1]},cT=function(e,t,s){return Zs(s,function(i){return Sr(e,t,i)})},za=[].slice,od=function(e,t){return e&&Kt(e)&&"length"in e&&(!t&&!e.length||e.length-1 in e&&Kt(e[0]))&&!e.nodeType&&e!==bt},lT=function(e,t,s){return s===void 0&&(s=[]),e.forEach(function(i){var r;return Ge(i)&&!t||od(i,1)?(r=s).push.apply(r,At(i)):s.push(i)})||s},At=function(e,t,s){return De&&!t&&De.selector?De.selector(e):Ge(e)&&!s&&(Fa||!ii())?za.call((t||Uc).querySelectorAll(e),0):Qe(e)?lT(e,s):od(e)?za.call(e,0):e?[e]:[]},Va=function(e){return e=At(e)[0]||ir("Invalid scope")||{},function(t){var s=e.current||e.nativeElement||e;return At(t,s.querySelectorAll?s:s===e?ir("Invalid scope")||Uc.createElement("div"):e)}},ad=function(e){return e.sort(function(){return .5-Math.random()})},cd=function(e){if(Re(e))return e;var t=Kt(e)?e:{each:e},s=hn(t.ease),i=t.from||0,r=parseFloat(t.base)||0,o={},a=i>0&&i<1,c=isNaN(i)||a,l=t.axis,u=i,h=i;return Ge(i)?u=h={center:.5,edges:.5,end:1}[i]||0:!a&&c&&(u=i[0],h=i[1]),function(f,d,m){var p=(m||t).length,_=o[p],v,T,S,y,g,w,k,x,C;if(!_){if(C=t.grid==="auto"?0:(t.grid||[1,Ot])[1],!C){for(k=-Ot;k<(k=m[C++].getBoundingClientRect().left)&&C<p;);C<p&&C--}for(_=o[p]=[],v=c?Math.min(C,p)*u-.5:i%C,T=C===Ot?0:c?p*h/C-.5:i/C|0,k=0,x=Ot,w=0;w<p;w++)S=w%C-v,y=T-(w/C|0),_[w]=g=l?Math.abs(l==="y"?y:S):Hh(S*S+y*y),g>k&&(k=g),g<x&&(x=g);i==="random"&&ad(_),_.max=k-x,_.min=x,_.v=p=(parseFloat(t.amount)||parseFloat(t.each)*(C>p?p-1:l?l==="y"?p/C:C:Math.max(C,p/C))||0)*(i==="edges"?-1:1),_.b=p<0?r-p:r,_.u=$e(t.amount||t.each)||0,s=s&&p<0?vd(s):s}return p=(_[f]-_.min)/_.max||0,He(_.b+(s?s(p):p)*_.v)+_.u}},ja=function(e){var t=Math.pow(10,((e+"").split(".")[1]||"").length);return function(s){var i=He(Math.round(parseFloat(s)/e)*e*t);return(i-i%1)/t+(vs(s)?0:$e(s))}},ld=function(e,t){var s=Qe(e),i,r;return!s&&Kt(e)&&(i=s=e.radius||Ot,e.values?(e=At(e.values),(r=!vs(e[0]))&&(i*=i)):e=ja(e.increment)),Zs(t,s?Re(e)?function(o){return r=e(o),Math.abs(r-o)<=i?r:o}:function(o){for(var a=parseFloat(r?o.x:o),c=parseFloat(r?o.y:0),l=Ot,u=0,h=e.length,f,d;h--;)r?(f=e[h].x-a,d=e[h].y-c,f=f*f+d*d):f=Math.abs(e[h]-a),f<l&&(l=f,u=h);return u=!i||l<=i?e[u]:o,r||u===o||vs(o)?u:u+$e(o)}:ja(e))},ud=function(e,t,s,i){return Zs(Qe(e)?!t:s===!0?!!(s=0):!i,function(){return Qe(e)?e[~~(Math.random()*e.length)]:(s=s||1e-5)&&(i=s<1?Math.pow(10,(s+"").length-2):1)&&Math.floor(Math.round((e-s/2+Math.random()*(t-e+s*.99))/s)*s*i)/i})},uT=function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return function(i){return t.reduce(function(r,o){return o(r)},i)}},hT=function(e,t){return function(s){return e(parseFloat(s))+(t||$e(s))}},dT=function(e,t,s){return dd(e,t,0,1,s)},hd=function(e,t,s){return Zs(s,function(i){return e[~~t(i)]})},fT=function n(e,t,s){var i=t-e;return Qe(e)?hd(e,n(0,e.length),t):Zs(s,function(r){return(i+(r-e)%i)%i+e})},pT=function n(e,t,s){var i=t-e,r=i*2;return Qe(e)?hd(e,n(0,e.length-1),t):Zs(s,function(o){return o=(r+(o-e)%r)%r||0,e+(o>i?r-o:o)})},or=function(e){for(var t=0,s="",i,r,o,a;~(i=e.indexOf("random(",t));)o=e.indexOf(")",i),a=e.charAt(i+7)==="[",r=e.substr(i+7,o-i-7).match(a?Yh:Na),s+=e.substr(t,i-t)+ud(a?r:+r[0],a?0:+r[1],+r[2]||1e-5),t=o+1;return s+e.substr(t,e.length-t)},dd=function(e,t,s,i,r){var o=t-e,a=i-s;return Zs(r,function(c){return s+((c-e)/o*a||0)})},mT=function n(e,t,s,i){var r=isNaN(e+t)?0:function(d){return(1-d)*e+d*t};if(!r){var o=Ge(e),a={},c,l,u,h,f;if(s===!0&&(i=1)&&(s=null),o)e={p:e},t={p:t};else if(Qe(e)&&!Qe(t)){for(u=[],h=e.length,f=h-2,l=1;l<h;l++)u.push(n(e[l-1],e[l]));h--,r=function(m){m*=h;var p=Math.min(f,~~m);return u[p](m-p)},s=t}else i||(e=vn(Qe(e)?[]:{},e));if(!u){for(c in t)jc.call(a,e,c,"get",t[c]);r=function(m){return Gc(m,a)||(o?e.p:e)}}}return Zs(s,r)},$l=function(e,t,s){var i=e.labels,r=Ot,o,a,c;for(o in i)a=i[o]-t,a<0==!!s&&a&&r>(a=Math.abs(a))&&(c=o,r=a);return c},vt=function(e,t,s){var i=e.vars,r=i[t],o=De,a=e._ctx,c,l,u;if(r)return c=i[t+"Params"],l=i.callbackScope||e,s&&Us.length&&xo(),a&&(De=a),u=c?r.apply(l,c):r.call(l),De=o,u},Di=function(e){return qs(e),e.scrollTrigger&&e.scrollTrigger.kill(!!Xe),e.progress()<1&&vt(e,"onInterrupt"),e},zn,fd=[],pd=function(e){if(Fc()&&e){e=!e.name&&e.default||e;var t=e.name,s=Re(e),i=t&&!s&&e.init?function(){this._props=[]}:e,r={init:rr,render:Gc,add:jc,kill:DT,modifier:MT,rawVars:0},o={targetTest:0,get:0,getSetter:Wc,aliases:{},register:0};if(ii(),e!==i){if(_t[t])return;Dt(i,Dt(To(e,r),o)),vn(i.prototype,vn(r,To(e,o))),_t[i.prop=t]=i,e.targetTest&&(Yr.push(i),Bc[t]=1),t=(t==="css"?"CSS":t.charAt(0).toUpperCase()+t.substr(1))+"Plugin"}Xh(t,i),e.register&&e.register(pt,i,ht)}else e&&fd.push(e)},de=255,Ri={aqua:[0,de,de],lime:[0,de,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,de],navy:[0,0,128],white:[de,de,de],olive:[128,128,0],yellow:[de,de,0],orange:[de,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[de,0,0],pink:[de,192,203],cyan:[0,de,de],transparent:[de,de,de,0]},da=function(e,t,s){return e+=e<0?1:e>1?-1:0,(e*6<1?t+(s-t)*e*6:e<.5?s:e*3<2?t+(s-t)*(2/3-e)*6:t)*de+.5|0},md=function(e,t,s){var i=e?vs(e)?[e>>16,e>>8&de,e&de]:0:Ri.black,r,o,a,c,l,u,h,f,d,m;if(!i){if(e.substr(-1)===","&&(e=e.substr(0,e.length-1)),Ri[e])i=Ri[e];else if(e.charAt(0)==="#"){if(e.length<6&&(r=e.charAt(1),o=e.charAt(2),a=e.charAt(3),e="#"+r+r+o+o+a+a+(e.length===5?e.charAt(4)+e.charAt(4):"")),e.length===9)return i=parseInt(e.substr(1,6),16),[i>>16,i>>8&de,i&de,parseInt(e.substr(7),16)/255];e=parseInt(e.substr(1),16),i=[e>>16,e>>8&de,e&de]}else if(e.substr(0,3)==="hsl"){if(i=m=e.match(Na),!t)c=+i[0]%360/360,l=+i[1]/100,u=+i[2]/100,o=u<=.5?u*(l+1):u+l-u*l,r=u*2-o,i.length>3&&(i[3]*=1),i[0]=da(c+1/3,r,o),i[1]=da(c,r,o),i[2]=da(c-1/3,r,o);else if(~e.indexOf("="))return i=e.match(Wh),s&&i.length<4&&(i[3]=1),i}else i=e.match(Na)||Ri.transparent;i=i.map(Number)}return t&&!m&&(r=i[0]/de,o=i[1]/de,a=i[2]/de,h=Math.max(r,o,a),f=Math.min(r,o,a),u=(h+f)/2,h===f?c=l=0:(d=h-f,l=u>.5?d/(2-h-f):d/(h+f),c=h===r?(o-a)/d+(o<a?6:0):h===o?(a-r)/d+2:(r-o)/d+4,c*=60),i[0]=~~(c+.5),i[1]=~~(l*100+.5),i[2]=~~(u*100+.5)),s&&i.length<4&&(i[3]=1),i},_d=function(e){var t=[],s=[],i=-1;return e.split(Ls).forEach(function(r){var o=r.match(Bn)||[];t.push.apply(t,o),s.push(i+=o.length+1)}),t.c=s,t},Xl=function(e,t,s){var i="",r=(e+i).match(Ls),o=t?"hsla(":"rgba(",a=0,c,l,u,h;if(!r)return e;if(r=r.map(function(f){return(f=md(f,t,1))&&o+(t?f[0]+","+f[1]+"%,"+f[2]+"%,"+f[3]:f.join(","))+")"}),s&&(u=_d(e),c=s.c,c.join(i)!==u.c.join(i)))for(l=e.replace(Ls,"1").split(Bn),h=l.length-1;a<h;a++)i+=l[a]+(~c.indexOf(a)?r.shift()||o+"0,0,0,0)":(u.length?u:r.length?r:s).shift());if(!l)for(l=e.split(Ls),h=l.length-1;a<h;a++)i+=l[a]+r[a];return i+l[h]},Ls=function(){var n="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b",e;for(e in Ri)n+="|"+e+"\\b";return new RegExp(n+")","gi")}(),_T=/hsl[a]?\(/,gd=function(e){var t=e.join(" "),s;if(Ls.lastIndex=0,Ls.test(t))return s=_T.test(t),e[1]=Xl(e[1],s),e[0]=Xl(e[0],s,_d(e[1])),!0},ar,gt=function(){var n=Date.now,e=500,t=33,s=n(),i=s,r=1e3/240,o=r,a=[],c,l,u,h,f,d,m=function p(_){var v=n()-i,T=_===!0,S,y,g,w;if(v>e&&(s+=v-t),i+=v,g=i-s,S=g-o,(S>0||T)&&(w=++h.frame,f=g-h.time*1e3,h.time=g=g/1e3,o+=S+(S>=r?4:r-S),y=1),T||(c=l(p)),y)for(d=0;d<a.length;d++)a[d](g,f,w,_)};return h={time:0,frame:0,tick:function(){m(!0)},deltaRatio:function(_){return f/(1e3/(_||60))},wake:function(){Zh&&(!Fa&&Fc()&&(bt=Fa=window,Uc=bt.document||{},wt.gsap=pt,(bt.gsapVersions||(bt.gsapVersions=[])).push(pt.version),$h(yo||bt.GreenSockGlobals||!bt.gsap&&bt||{}),u=bt.requestAnimationFrame,fd.forEach(pd)),c&&h.sleep(),l=u||function(_){return setTimeout(_,o-h.time*1e3+1|0)},ar=1,m(2))},sleep:function(){(u?bt.cancelAnimationFrame:clearTimeout)(c),ar=0,l=rr},lagSmoothing:function(_,v){e=_||1/0,t=Math.min(v||33,e)},fps:function(_){r=1e3/(_||240),o=h.time*1e3+r},add:function(_,v,T){var S=v?function(y,g,w,k){_(y,g,w,k),h.remove(S)}:_;return h.remove(_),a[T?"unshift":"push"](S),ii(),S},remove:function(_,v){~(v=a.indexOf(_))&&a.splice(v,1)&&d>=v&&d--},_listeners:a},h}(),ii=function(){return!ar&&gt.wake()},se={},gT=/^[\d.\-M][\d.\-,\s]/,vT=/["']/g,yT=function(e){for(var t={},s=e.substr(1,e.length-3).split(":"),i=s[0],r=1,o=s.length,a,c,l;r<o;r++)c=s[r],a=r!==o-1?c.lastIndexOf(","):c.length,l=c.substr(0,a),t[i]=isNaN(l)?l.replace(vT,"").trim():+l,i=c.substr(a+1).trim();return t},xT=function(e){var t=e.indexOf("(")+1,s=e.indexOf(")"),i=e.indexOf("(",t);return e.substring(t,~i&&i<s?e.indexOf(")",s+1):s)},TT=function(e){var t=(e+"").split("("),s=se[t[0]];return s&&t.length>1&&s.config?s.config.apply(null,~e.indexOf("{")?[yT(t[1])]:xT(e).split(",").map(ed)):se._CE&&gT.test(e)?se._CE("",e):s},vd=function(e){return function(t){return 1-e(1-t)}},yd=function n(e,t){for(var s=e._first,i;s;)s instanceof tt?n(s,t):s.vars.yoyoEase&&(!s._yoyo||!s._repeat)&&s._yoyo!==t&&(s.timeline?n(s.timeline,t):(i=s._ease,s._ease=s._yEase,s._yEase=i,s._yoyo=t)),s=s._next},hn=function(e,t){return e&&(Re(e)?e:se[e]||TT(e))||t},Sn=function(e,t,s,i){s===void 0&&(s=function(c){return 1-t(1-c)}),i===void 0&&(i=function(c){return c<.5?t(c*2)/2:1-t((1-c)*2)/2});var r={easeIn:t,easeOut:s,easeInOut:i},o;return ut(e,function(a){se[a]=wt[a]=r,se[o=a.toLowerCase()]=s;for(var c in r)se[o+(c==="easeIn"?".in":c==="easeOut"?".out":".inOut")]=se[a+"."+c]=r[c]}),r},xd=function(e){return function(t){return t<.5?(1-e(1-t*2))/2:.5+e((t-.5)*2)/2}},fa=function n(e,t,s){var i=t>=1?t:1,r=(s||(e?.3:.45))/(t<1?t:1),o=r/Ia*(Math.asin(1/i)||0),a=function(u){return u===1?1:i*Math.pow(2,-10*u)*$x((u-o)*r)+1},c=e==="out"?a:e==="in"?function(l){return 1-a(1-l)}:xd(a);return r=Ia/r,c.config=function(l,u){return n(e,l,u)},c},pa=function n(e,t){t===void 0&&(t=1.70158);var s=function(o){return o?--o*o*((t+1)*o+t)+1:0},i=e==="out"?s:e==="in"?function(r){return 1-s(1-r)}:xd(s);return i.config=function(r){return n(e,r)},i};ut("Linear,Quad,Cubic,Quart,Quint,Strong",function(n,e){var t=e<5?e+1:e;Sn(n+",Power"+(t-1),e?function(s){return Math.pow(s,t)}:function(s){return s},function(s){return 1-Math.pow(1-s,t)},function(s){return s<.5?Math.pow(s*2,t)/2:1-Math.pow((1-s)*2,t)/2})});se.Linear.easeNone=se.none=se.Linear.easeIn;Sn("Elastic",fa("in"),fa("out"),fa());(function(n,e){var t=1/e,s=2*t,i=2.5*t,r=function(a){return a<t?n*a*a:a<s?n*Math.pow(a-1.5/e,2)+.75:a<i?n*(a-=2.25/e)*a+.9375:n*Math.pow(a-2.625/e,2)+.984375};Sn("Bounce",function(o){return 1-r(1-o)},r)})(7.5625,2.75);Sn("Expo",function(n){return n?Math.pow(2,10*(n-1)):0});Sn("Circ",function(n){return-(Hh(1-n*n)-1)});Sn("Sine",function(n){return n===1?1:-Zx(n*Gx)+1});Sn("Back",pa("in"),pa("out"),pa());se.SteppedEase=se.steps=wt.SteppedEase={config:function(e,t){e===void 0&&(e=1);var s=1/e,i=e+(t?0:1),r=t?1:0,o=1-fe;return function(a){return((i*Sr(0,o,a)|0)+r)*s}}};ti.ease=se["quad.out"];ut("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function(n){return zc+=n+","+n+"Params,"});var Td=function(e,t){this.id=Yx++,e._gsap=this,this.target=e,this.harness=t,this.get=t?t.get:Kh,this.set=t?t.getSetter:Wc},cr=function(){function n(t){this.vars=t,this._delay=+t.delay||0,(this._repeat=t.repeat===1/0?-2:t.repeat||0)&&(this._rDelay=t.repeatDelay||0,this._yoyo=!!t.yoyo||!!t.yoyoEase),this._ts=1,ni(this,+t.duration,1,1),this.data=t.data,De&&(this._ctx=De,De.data.push(this)),ar||gt.wake()}var e=n.prototype;return e.delay=function(s){return s||s===0?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+s-this._delay),this._delay=s,this):this._delay},e.duration=function(s){return arguments.length?this.totalDuration(this._repeat>0?s+(s+this._rDelay)*this._repeat:s):this.totalDuration()&&this._dur},e.totalDuration=function(s){return arguments.length?(this._dirty=0,ni(this,this._repeat<0?s:(s-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},e.totalTime=function(s,i){if(ii(),!arguments.length)return this._tTime;var r=this._dp;if(r&&r.smoothChildTiming&&this._ts){for(Yo(this,s),!r._dp||r.parent||nd(r,this);r&&r.parent;)r.parent._time!==r._start+(r._ts>=0?r._tTime/r._ts:(r.totalDuration()-r._tTime)/-r._ts)&&r.totalTime(r._tTime,!0),r=r.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&s<this._tDur||this._ts<0&&s>0||!this._tDur&&!s)&&Yt(this._dp,this,this._start-this._delay)}return(this._tTime!==s||!this._dur&&!i||this._initted&&Math.abs(this._zTime)===fe||!s&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=s),Jh(this,s,i)),this},e.time=function(s,i){return arguments.length?this.totalTime(Math.min(this.totalDuration(),s+Yl(this))%(this._dur+this._rDelay)||(s?this._dur:0),i):this._time},e.totalProgress=function(s,i){return arguments.length?this.totalTime(this.totalDuration()*s,i):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.rawTime()>0?1:0},e.progress=function(s,i){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&!(this.iteration()&1)?1-s:s)+Yl(this),i):this.duration()?Math.min(1,this._time/this._dur):this.rawTime()>0?1:0},e.iteration=function(s,i){var r=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(s-1)*r,i):this._repeat?si(this._tTime,r)+1:1},e.timeScale=function(s,i){if(!arguments.length)return this._rts===-fe?0:this._rts;if(this._rts===s)return this;var r=this.parent&&this._ts?wo(this.parent._time,this):this._tTime;return this._rts=+s||0,this._ts=this._ps||s===-fe?0:this._rts,this.totalTime(Sr(-Math.abs(this._delay),this._tDur,r),i!==!1),Go(this),sT(this)},e.paused=function(s){return arguments.length?(this._ps!==s&&(this._ps=s,s?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(ii(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,this.progress()===1&&Math.abs(this._zTime)!==fe&&(this._tTime-=fe)))),this):this._ps},e.startTime=function(s){if(arguments.length){this._start=s;var i=this.parent||this._dp;return i&&(i._sort||!this.parent)&&Yt(i,this,s-this._delay),this}return this._start},e.endTime=function(s){return this._start+(lt(s)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},e.rawTime=function(s){var i=this.parent||this._dp;return i?s&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?wo(i.rawTime(s),this):this._tTime:this._tTime},e.revert=function(s){s===void 0&&(s=Kx);var i=Xe;return Xe=s,(this._initted||this._startAt)&&(this.timeline&&this.timeline.revert(s),this.totalTime(-.01,s.suppressEvents)),this.data!=="nested"&&s.kill!==!1&&this.kill(),Xe=i,this},e.globalTime=function(s){for(var i=this,r=arguments.length?s:i.rawTime();i;)r=i._start+r/(Math.abs(i._ts)||1),i=i._dp;return!this.parent&&this._sat?this._sat.globalTime(s):r},e.repeat=function(s){return arguments.length?(this._repeat=s===1/0?-2:s,Zl(this)):this._repeat===-2?1/0:this._repeat},e.repeatDelay=function(s){if(arguments.length){var i=this._time;return this._rDelay=s,Zl(this),i?this.time(i):this}return this._rDelay},e.yoyo=function(s){return arguments.length?(this._yoyo=s,this):this._yoyo},e.seek=function(s,i){return this.totalTime(Ct(this,s),lt(i))},e.restart=function(s,i){return this.play().totalTime(s?-this._delay:0,lt(i))},e.play=function(s,i){return s!=null&&this.seek(s,i),this.reversed(!1).paused(!1)},e.reverse=function(s,i){return s!=null&&this.seek(s||this.totalDuration(),i),this.reversed(!0).paused(!1)},e.pause=function(s,i){return s!=null&&this.seek(s,i),this.paused(!0)},e.resume=function(){return this.paused(!1)},e.reversed=function(s){return arguments.length?(!!s!==this.reversed()&&this.timeScale(-this._rts||(s?-fe:0)),this):this._rts<0},e.invalidate=function(){return this._initted=this._act=0,this._zTime=-fe,this},e.isActive=function(){var s=this.parent||this._dp,i=this._start,r;return!!(!s||this._ts&&this._initted&&s.isActive()&&(r=s.rawTime(!0))>=i&&r<this.endTime(!0)-fe)},e.eventCallback=function(s,i,r){var o=this.vars;return arguments.length>1?(i?(o[s]=i,r&&(o[s+"Params"]=r),s==="onUpdate"&&(this._onUpdate=i)):delete o[s],this):o[s]},e.then=function(s){var i=this;return new Promise(function(r){var o=Re(s)?s:td,a=function(){var l=i.then;i.then=null,Re(o)&&(o=o(i))&&(o.then||o===i)&&(i.then=l),r(o),i.then=l};i._initted&&i.totalProgress()===1&&i._ts>=0||!i._tTime&&i._ts<0?a():i._prom=a})},e.kill=function(){Di(this)},n}();Dt(cr.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-fe,_prom:0,_ps:!1,_rts:1});var tt=function(n){jh(e,n);function e(s,i){var r;return s===void 0&&(s={}),r=n.call(this,s)||this,r.labels={},r.smoothChildTiming=!!s.smoothChildTiming,r.autoRemoveChildren=!!s.autoRemoveChildren,r._sort=lt(s.sortChildren),be&&Yt(s.parent||be,ls(r),i),s.reversed&&r.reverse(),s.paused&&r.paused(!0),s.scrollTrigger&&id(ls(r),s.scrollTrigger),r}var t=e.prototype;return t.to=function(i,r,o){return Fi(0,arguments,this),this},t.from=function(i,r,o){return Fi(1,arguments,this),this},t.fromTo=function(i,r,o,a){return Fi(2,arguments,this),this},t.set=function(i,r,o){return r.duration=0,r.parent=this,Ni(r).repeatDelay||(r.repeat=0),r.immediateRender=!!r.immediateRender,new ze(i,r,Ct(this,o),1),this},t.call=function(i,r,o){return Yt(this,ze.delayedCall(0,i,r),o)},t.staggerTo=function(i,r,o,a,c,l,u){return o.duration=r,o.stagger=o.stagger||a,o.onComplete=l,o.onCompleteParams=u,o.parent=this,new ze(i,o,Ct(this,c)),this},t.staggerFrom=function(i,r,o,a,c,l,u){return o.runBackwards=1,Ni(o).immediateRender=lt(o.immediateRender),this.staggerTo(i,r,o,a,c,l,u)},t.staggerFromTo=function(i,r,o,a,c,l,u,h){return a.startAt=o,Ni(a).immediateRender=lt(a.immediateRender),this.staggerTo(i,r,a,c,l,u,h)},t.render=function(i,r,o){var a=this._time,c=this._dirty?this.totalDuration():this._tDur,l=this._dur,u=i<=0?0:He(i),h=this._zTime<0!=i<0&&(this._initted||!l),f,d,m,p,_,v,T,S,y,g,w,k;if(this!==be&&u>c&&i>=0&&(u=c),u!==this._tTime||o||h){if(a!==this._time&&l&&(u+=this._time-a,i+=this._time-a),f=u,y=this._start,S=this._ts,v=!S,h&&(l||(a=this._zTime),(i||!r)&&(this._zTime=i)),this._repeat){if(w=this._yoyo,_=l+this._rDelay,this._repeat<-1&&i<0)return this.totalTime(_*100+i,r,o);if(f=He(u%_),u===c?(p=this._repeat,f=l):(p=~~(u/_),p&&p===u/_&&(f=l,p--),f>l&&(f=l)),g=si(this._tTime,_),!a&&this._tTime&&g!==p&&this._tTime-g*_-this._dur<=0&&(g=p),w&&p&1&&(f=l-f,k=1),p!==g&&!this._lock){var x=w&&g&1,C=x===(w&&p&1);if(p<g&&(x=!x),a=x?0:u%l?l:u,this._lock=1,this.render(a||(k?0:He(p*_)),r,!l)._lock=0,this._tTime=u,!r&&this.parent&&vt(this,"onRepeat"),this.vars.repeatRefresh&&!k&&(this.invalidate()._lock=1),a&&a!==this._time||v!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(l=this._dur,c=this._tDur,C&&(this._lock=2,a=x?l:-1e-4,this.render(a,!0),this.vars.repeatRefresh&&!k&&this.invalidate()),this._lock=0,!this._ts&&!v)return this;yd(this,k)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(T=oT(this,He(a),He(f)),T&&(u-=f-(f=T._start))),this._tTime=u,this._time=f,this._act=!S,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=i,a=0),!a&&f&&!r&&!p&&(vt(this,"onStart"),this._tTime!==u))return this;if(f>=a&&i>=0)for(d=this._first;d;){if(m=d._next,(d._act||f>=d._start)&&d._ts&&T!==d){if(d.parent!==this)return this.render(i,r,o);if(d.render(d._ts>0?(f-d._start)*d._ts:(d._dirty?d.totalDuration():d._tDur)+(f-d._start)*d._ts,r,o),f!==this._time||!this._ts&&!v){T=0,m&&(u+=this._zTime=-fe);break}}d=m}else{d=this._last;for(var b=i<0?i:f;d;){if(m=d._prev,(d._act||b<=d._end)&&d._ts&&T!==d){if(d.parent!==this)return this.render(i,r,o);if(d.render(d._ts>0?(b-d._start)*d._ts:(d._dirty?d.totalDuration():d._tDur)+(b-d._start)*d._ts,r,o||Xe&&(d._initted||d._startAt)),f!==this._time||!this._ts&&!v){T=0,m&&(u+=this._zTime=b?-fe:fe);break}}d=m}}if(T&&!r&&(this.pause(),T.render(f>=a?0:-fe)._zTime=f>=a?1:-1,this._ts))return this._start=y,Go(this),this.render(i,r,o);this._onUpdate&&!r&&vt(this,"onUpdate",!0),(u===c&&this._tTime>=this.totalDuration()||!u&&a)&&(y===this._start||Math.abs(S)!==Math.abs(this._ts))&&(this._lock||((i||!l)&&(u===c&&this._ts>0||!u&&this._ts<0)&&qs(this,1),!r&&!(i<0&&!a)&&(u||a||!c)&&(vt(this,u===c&&i>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(u<c&&this.timeScale()>0)&&this._prom())))}return this},t.add=function(i,r){var o=this;if(vs(r)||(r=Ct(this,r,i)),!(i instanceof cr)){if(Qe(i))return i.forEach(function(a){return o.add(a,r)}),this;if(Ge(i))return this.addLabel(i,r);if(Re(i))i=ze.delayedCall(0,i);else return this}return this!==i?Yt(this,i,r):this},t.getChildren=function(i,r,o,a){i===void 0&&(i=!0),r===void 0&&(r=!0),o===void 0&&(o=!0),a===void 0&&(a=-Ot);for(var c=[],l=this._first;l;)l._start>=a&&(l instanceof ze?r&&c.push(l):(o&&c.push(l),i&&c.push.apply(c,l.getChildren(!0,r,o)))),l=l._next;return c},t.getById=function(i){for(var r=this.getChildren(1,1,1),o=r.length;o--;)if(r[o].vars.id===i)return r[o]},t.remove=function(i){return Ge(i)?this.removeLabel(i):Re(i)?this.killTweensOf(i):(Wo(this,i),i===this._recent&&(this._recent=this._last),un(this))},t.totalTime=function(i,r){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=He(gt.time-(this._ts>0?i/this._ts:(this.totalDuration()-i)/-this._ts))),n.prototype.totalTime.call(this,i,r),this._forcing=0,this):this._tTime},t.addLabel=function(i,r){return this.labels[i]=Ct(this,r),this},t.removeLabel=function(i){return delete this.labels[i],this},t.addPause=function(i,r,o){var a=ze.delayedCall(0,r||rr,o);return a.data="isPause",this._hasPause=1,Yt(this,a,Ct(this,i))},t.removePause=function(i){var r=this._first;for(i=Ct(this,i);r;)r._start===i&&r.data==="isPause"&&qs(r),r=r._next},t.killTweensOf=function(i,r,o){for(var a=this.getTweensOf(i,o),c=a.length;c--;)Ds!==a[c]&&a[c].kill(i,r);return this},t.getTweensOf=function(i,r){for(var o=[],a=At(i),c=this._first,l=vs(r),u;c;)c instanceof ze?Jx(c._targets,a)&&(l?(!Ds||c._initted&&c._ts)&&c.globalTime(0)<=r&&c.globalTime(c.totalDuration())>r:!r||c.isActive())&&o.push(c):(u=c.getTweensOf(a,r)).length&&o.push.apply(o,u),c=c._next;return o},t.tweenTo=function(i,r){r=r||{};var o=this,a=Ct(o,i),c=r,l=c.startAt,u=c.onStart,h=c.onStartParams,f=c.immediateRender,d,m=ze.to(o,Dt({ease:r.ease||"none",lazy:!1,immediateRender:!1,time:a,overwrite:"auto",duration:r.duration||Math.abs((a-(l&&"time"in l?l.time:o._time))/o.timeScale())||fe,onStart:function(){if(o.pause(),!d){var _=r.duration||Math.abs((a-(l&&"time"in l?l.time:o._time))/o.timeScale());m._dur!==_&&ni(m,_,0,1).render(m._time,!0,!0),d=1}u&&u.apply(m,h||[])}},r));return f?m.render(0):m},t.tweenFromTo=function(i,r,o){return this.tweenTo(r,Dt({startAt:{time:Ct(this,i)}},o))},t.recent=function(){return this._recent},t.nextLabel=function(i){return i===void 0&&(i=this._time),$l(this,Ct(this,i))},t.previousLabel=function(i){return i===void 0&&(i=this._time),$l(this,Ct(this,i),1)},t.currentLabel=function(i){return arguments.length?this.seek(i,!0):this.previousLabel(this._time+fe)},t.shiftChildren=function(i,r,o){o===void 0&&(o=0);for(var a=this._first,c=this.labels,l;a;)a._start>=o&&(a._start+=i,a._end+=i),a=a._next;if(r)for(l in c)c[l]>=o&&(c[l]+=i);return un(this)},t.invalidate=function(i){var r=this._first;for(this._lock=0;r;)r.invalidate(i),r=r._next;return n.prototype.invalidate.call(this,i)},t.clear=function(i){i===void 0&&(i=!0);for(var r=this._first,o;r;)o=r._next,this.remove(r),r=o;return this._dp&&(this._time=this._tTime=this._pTime=0),i&&(this.labels={}),un(this)},t.totalDuration=function(i){var r=0,o=this,a=o._last,c=Ot,l,u,h;if(arguments.length)return o.timeScale((o._repeat<0?o.duration():o.totalDuration())/(o.reversed()?-i:i));if(o._dirty){for(h=o.parent;a;)l=a._prev,a._dirty&&a.totalDuration(),u=a._start,u>c&&o._sort&&a._ts&&!o._lock?(o._lock=1,Yt(o,a,u-a._delay,1)._lock=0):c=u,u<0&&a._ts&&(r-=u,(!h&&!o._dp||h&&h.smoothChildTiming)&&(o._start+=u/o._ts,o._time-=u,o._tTime-=u),o.shiftChildren(-u,!1,-1/0),c=0),a._end>r&&a._ts&&(r=a._end),a=l;ni(o,o===be&&o._time>r?o._time:r,1,1),o._dirty=0}return o._tDur},e.updateRoot=function(i){if(be._ts&&(Jh(be,wo(i,be)),Qh=gt.frame),gt.frame>=Wl){Wl+=xt.autoSleep||120;var r=be._first;if((!r||!r._ts)&&xt.autoSleep&&gt._listeners.length<2){for(;r&&!r._ts;)r=r._next;r||gt.sleep()}}},e}(cr);Dt(tt.prototype,{_lock:0,_hasPause:0,_forcing:0});var wT=function(e,t,s,i,r,o,a){var c=new ht(this._pt,e,t,0,1,Ed,null,r),l=0,u=0,h,f,d,m,p,_,v,T;for(c.b=s,c.e=i,s+="",i+="",(v=~i.indexOf("random("))&&(i=or(i)),o&&(T=[s,i],o(T,e,t),s=T[0],i=T[1]),f=s.match(ua)||[];h=ua.exec(i);)m=h[0],p=i.substring(l,h.index),d?d=(d+1)%5:p.substr(-5)==="rgba("&&(d=1),m!==f[u++]&&(_=parseFloat(f[u-1])||0,c._pt={_next:c._pt,p:p||u===1?p:",",s:_,c:m.charAt(1)==="="?Hn(_,m)-_:parseFloat(m)-_,m:d&&d<4?Math.round:0},l=ua.lastIndex);return c.c=l<i.length?i.substring(l,i.length):"",c.fp=a,(Gh.test(i)||v)&&(c.e=0),this._pt=c,c},jc=function(e,t,s,i,r,o,a,c,l,u){Re(i)&&(i=i(r||0,e,o));var h=e[t],f=s!=="get"?s:Re(h)?l?e[t.indexOf("set")||!Re(e["get"+t.substr(3)])?t:"get"+t.substr(3)](l):e[t]():h,d=Re(h)?l?ET:Cd:qc,m;if(Ge(i)&&(~i.indexOf("random(")&&(i=or(i)),i.charAt(1)==="="&&(m=Hn(f,i)+($e(f)||0),(m||m===0)&&(i=m))),!u||f!==i||Ha)return!isNaN(f*i)&&i!==""?(m=new ht(this._pt,e,t,+f||0,i-(f||0),typeof h=="boolean"?AT:bd,0,d),l&&(m.fp=l),a&&m.modifier(a,this,e),this._pt=m):(!h&&!(t in e)&&Lc(t,i),wT.call(this,e,t,f,i,d,c||xt.stringFilter,l))},kT=function(e,t,s,i,r){if(Re(e)&&(e=Ui(e,r,t,s,i)),!Kt(e)||e.style&&e.nodeType||Qe(e)||qh(e))return Ge(e)?Ui(e,r,t,s,i):e;var o={},a;for(a in e)o[a]=Ui(e[a],r,t,s,i);return o},wd=function(e,t,s,i,r,o){var a,c,l,u;if(_t[e]&&(a=new _t[e]).init(r,a.rawVars?t[e]:kT(t[e],i,r,o,s),s,i,o)!==!1&&(s._pt=c=new ht(s._pt,r,e,0,1,a.render,a,0,a.priority),s!==zn))for(l=s._ptLookup[s._targets.indexOf(r)],u=a._props.length;u--;)l[a._props[u]]=c;return a},Ds,Ha,Hc=function n(e,t,s){var i=e.vars,r=i.ease,o=i.startAt,a=i.immediateRender,c=i.lazy,l=i.onUpdate,u=i.runBackwards,h=i.yoyoEase,f=i.keyframes,d=i.autoRevert,m=e._dur,p=e._startAt,_=e._targets,v=e.parent,T=v&&v.data==="nested"?v.vars.targets:_,S=e._overwrite==="auto"&&!Ic,y=e.timeline,g,w,k,x,C,b,O,A,R,P,F,N,U;if(y&&(!f||!r)&&(r="none"),e._ease=hn(r,ti.ease),e._yEase=h?vd(hn(h===!0?r:h,ti.ease)):0,h&&e._yoyo&&!e._repeat&&(h=e._yEase,e._yEase=e._ease,e._ease=h),e._from=!y&&!!i.runBackwards,!y||f&&!i.stagger){if(A=_[0]?ln(_[0]).harness:0,N=A&&i[A.prop],g=To(i,Bc),p&&(p._zTime<0&&p.progress(1),t<0&&u&&a&&!d?p.render(-1,!0):p.revert(u&&m?Gr:Qx),p._lazy=0),o){if(qs(e._startAt=ze.set(_,Dt({data:"isStart",overwrite:!1,parent:v,immediateRender:!0,lazy:!p&&lt(c),startAt:null,delay:0,onUpdate:l&&function(){return vt(e,"onUpdate")},stagger:0},o))),e._startAt._dp=0,e._startAt._sat=e,t<0&&(Xe||!a&&!d)&&e._startAt.revert(Gr),a&&m&&t<=0&&s<=0){t&&(e._zTime=t);return}}else if(u&&m&&!p){if(t&&(a=!1),k=Dt({overwrite:!1,data:"isFromStart",lazy:a&&!p&&lt(c),immediateRender:a,stagger:0,parent:v},g),N&&(k[A.prop]=N),qs(e._startAt=ze.set(_,k)),e._startAt._dp=0,e._startAt._sat=e,t<0&&(Xe?e._startAt.revert(Gr):e._startAt.render(-1,!0)),e._zTime=t,!a)n(e._startAt,fe,fe);else if(!t)return}for(e._pt=e._ptCache=0,c=m&&lt(c)||c&&!m,w=0;w<_.length;w++){if(C=_[w],O=C._gsap||Vc(_)[w]._gsap,e._ptLookup[w]=P={},Ua[O.id]&&Us.length&&xo(),F=T===_?w:T.indexOf(C),A&&(R=new A).init(C,N||g,e,F,T)!==!1&&(e._pt=x=new ht(e._pt,C,R.name,0,1,R.render,R,0,R.priority),R._props.forEach(function(V){P[V]=x}),R.priority&&(b=1)),!A||N)for(k in g)_t[k]&&(R=wd(k,g,e,F,C,T))?R.priority&&(b=1):P[k]=x=jc.call(e,C,k,"get",g[k],F,T,0,i.stringFilter);e._op&&e._op[w]&&e.kill(C,e._op[w]),S&&e._pt&&(Ds=e,be.killTweensOf(C,P,e.globalTime(t)),U=!e.parent,Ds=0),e._pt&&c&&(Ua[O.id]=1)}b&&Od(e),e._onInit&&e._onInit(e)}e._onUpdate=l,e._initted=(!e._op||e._pt)&&!U,f&&t<=0&&y.render(Ot,!0,!0)},ST=function(e,t,s,i,r,o,a,c){var l=(e._pt&&e._ptCache||(e._ptCache={}))[t],u,h,f,d;if(!l)for(l=e._ptCache[t]=[],f=e._ptLookup,d=e._targets.length;d--;){if(u=f[d][t],u&&u.d&&u.d._pt)for(u=u.d._pt;u&&u.p!==t&&u.fp!==t;)u=u._next;if(!u)return Ha=1,e.vars[t]="+=0",Hc(e,a),Ha=0,c?ir(t+" not eligible for reset"):1;l.push(u)}for(d=l.length;d--;)h=l[d],u=h._pt||h,u.s=(i||i===0)&&!r?i:u.s+(i||0)+o*u.c,u.c=s-u.s,h.e&&(h.e=Ie(s)+$e(h.e)),h.b&&(h.b=u.s+$e(h.b))},CT=function(e,t){var s=e[0]?ln(e[0]).harness:0,i=s&&s.aliases,r,o,a,c;if(!i)return t;r=vn({},t);for(o in i)if(o in r)for(c=i[o].split(","),a=c.length;a--;)r[c[a]]=r[o];return r},bT=function(e,t,s,i){var r=t.ease||i||"power1.inOut",o,a;if(Qe(t))a=s[e]||(s[e]=[]),t.forEach(function(c,l){return a.push({t:l/(t.length-1)*100,v:c,e:r})});else for(o in t)a=s[o]||(s[o]=[]),o==="ease"||a.push({t:parseFloat(e),v:t[o],e:r})},Ui=function(e,t,s,i,r){return Re(e)?e.call(t,s,i,r):Ge(e)&&~e.indexOf("random(")?or(e):e},kd=zc+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",Sd={};ut(kd+",id,stagger,delay,duration,paused,scrollTrigger",function(n){return Sd[n]=1});var ze=function(n){jh(e,n);function e(s,i,r,o){var a;typeof i=="number"&&(r.duration=i,i=r,r=null),a=n.call(this,o?i:Ni(i))||this;var c=a.vars,l=c.duration,u=c.delay,h=c.immediateRender,f=c.stagger,d=c.overwrite,m=c.keyframes,p=c.defaults,_=c.scrollTrigger,v=c.yoyoEase,T=i.parent||be,S=(Qe(s)||qh(s)?vs(s[0]):"length"in i)?[s]:At(s),y,g,w,k,x,C,b,O;if(a._targets=S.length?Vc(S):ir("GSAP target "+s+" not found. https://gsap.com",!xt.nullTargetWarn)||[],a._ptLookup=[],a._overwrite=d,m||f||jr(l)||jr(u)){if(i=a.vars,y=a.timeline=new tt({data:"nested",defaults:p||{},targets:T&&T.data==="nested"?T.vars.targets:S}),y.kill(),y.parent=y._dp=ls(a),y._start=0,f||jr(l)||jr(u)){if(k=S.length,b=f&&cd(f),Kt(f))for(x in f)~kd.indexOf(x)&&(O||(O={}),O[x]=f[x]);for(g=0;g<k;g++)w=To(i,Sd),w.stagger=0,v&&(w.yoyoEase=v),O&&vn(w,O),C=S[g],w.duration=+Ui(l,ls(a),g,C,S),w.delay=(+Ui(u,ls(a),g,C,S)||0)-a._delay,!f&&k===1&&w.delay&&(a._delay=u=w.delay,a._start+=u,w.delay=0),y.to(C,w,b?b(g,C,S):0),y._ease=se.none;y.duration()?l=u=0:a.timeline=0}else if(m){Ni(Dt(y.vars.defaults,{ease:"none"})),y._ease=hn(m.ease||i.ease||"none");var A=0,R,P,F;if(Qe(m))m.forEach(function(N){return y.to(S,N,">")}),y.duration();else{w={};for(x in m)x==="ease"||x==="easeEach"||bT(x,m[x],w,m.easeEach);for(x in w)for(R=w[x].sort(function(N,U){return N.t-U.t}),A=0,g=0;g<R.length;g++)P=R[g],F={ease:P.e,duration:(P.t-(g?R[g-1].t:0))/100*l},F[x]=P.v,y.to(S,F,A),A+=F.duration;y.duration()<l&&y.to({},{duration:l-y.duration()})}}l||a.duration(l=y.duration())}else a.timeline=0;return d===!0&&!Ic&&(Ds=ls(a),be.killTweensOf(S),Ds=0),Yt(T,ls(a),r),i.reversed&&a.reverse(),i.paused&&a.paused(!0),(h||!l&&!m&&a._start===He(T._time)&&lt(h)&&nT(ls(a))&&T.data!=="nested")&&(a._tTime=-fe,a.render(Math.max(0,-u)||0)),_&&id(ls(a),_),a}var t=e.prototype;return t.render=function(i,r,o){var a=this._time,c=this._tDur,l=this._dur,u=i<0,h=i>c-fe&&!u?c:i<fe?0:i,f,d,m,p,_,v,T,S,y;if(!l)rT(this,i,r,o);else if(h!==this._tTime||!i||o||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==u){if(f=h,S=this.timeline,this._repeat){if(p=l+this._rDelay,this._repeat<-1&&u)return this.totalTime(p*100+i,r,o);if(f=He(h%p),h===c?(m=this._repeat,f=l):(m=~~(h/p),m&&m===He(h/p)&&(f=l,m--),f>l&&(f=l)),v=this._yoyo&&m&1,v&&(y=this._yEase,f=l-f),_=si(this._tTime,p),f===a&&!o&&this._initted&&m===_)return this._tTime=h,this;m!==_&&(S&&this._yEase&&yd(S,v),this.vars.repeatRefresh&&!v&&!this._lock&&this._time!==l&&this._initted&&(this._lock=o=1,this.render(He(p*m),!0).invalidate()._lock=0))}if(!this._initted){if(rd(this,u?i:f,o,r,h))return this._tTime=0,this;if(a!==this._time&&!(o&&this.vars.repeatRefresh&&m!==_))return this;if(l!==this._dur)return this.render(i,r,o)}if(this._tTime=h,this._time=f,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=T=(y||this._ease)(f/l),this._from&&(this.ratio=T=1-T),f&&!a&&!r&&!m&&(vt(this,"onStart"),this._tTime!==h))return this;for(d=this._pt;d;)d.r(T,d.d),d=d._next;S&&S.render(i<0?i:!f&&v?-fe:S._dur*S._ease(f/this._dur),r,o)||this._startAt&&(this._zTime=i),this._onUpdate&&!r&&(u&&La(this,i,r,o),vt(this,"onUpdate")),this._repeat&&m!==_&&this.vars.onRepeat&&!r&&this.parent&&vt(this,"onRepeat"),(h===this._tDur||!h)&&this._tTime===h&&(u&&!this._onUpdate&&La(this,i,!0,!0),(i||!l)&&(h===this._tDur&&this._ts>0||!h&&this._ts<0)&&qs(this,1),!r&&!(u&&!a)&&(h||a||v)&&(vt(this,h===c?"onComplete":"onReverseComplete",!0),this._prom&&!(h<c&&this.timeScale()>0)&&this._prom()))}return this},t.targets=function(){return this._targets},t.invalidate=function(i){return(!i||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(i),n.prototype.invalidate.call(this,i)},t.resetTo=function(i,r,o,a,c){ar||gt.wake(),this._ts||this.play();var l=Math.min(this._dur,(this._dp._time-this._start)*this._ts),u;return this._initted||Hc(this,l),u=this._ease(l/this._dur),ST(this,i,r,o,a,u,l,c)?this.resetTo(i,r,o,a,1):(Yo(this,0),this.parent||sd(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},t.kill=function(i,r){if(r===void 0&&(r="all"),!i&&(!r||r==="all"))return this._lazy=this._pt=0,this.parent?Di(this):this;if(this.timeline){var o=this.timeline.totalDuration();return this.timeline.killTweensOf(i,r,Ds&&Ds.vars.overwrite!==!0)._first||Di(this),this.parent&&o!==this.timeline.totalDuration()&&ni(this,this._dur*this.timeline._tDur/o,0,1),this}var a=this._targets,c=i?At(i):a,l=this._ptLookup,u=this._pt,h,f,d,m,p,_,v;if((!r||r==="all")&&tT(a,c))return r==="all"&&(this._pt=0),Di(this);for(h=this._op=this._op||[],r!=="all"&&(Ge(r)&&(p={},ut(r,function(T){return p[T]=1}),r=p),r=CT(a,r)),v=a.length;v--;)if(~c.indexOf(a[v])){f=l[v],r==="all"?(h[v]=r,m=f,d={}):(d=h[v]=h[v]||{},m=r);for(p in m)_=f&&f[p],_&&((!("kill"in _.d)||_.d.kill(p)===!0)&&Wo(this,_,"_pt"),delete f[p]),d!=="all"&&(d[p]=1)}return this._initted&&!this._pt&&u&&Di(this),this},e.to=function(i,r){return new e(i,r,arguments[2])},e.from=function(i,r){return Fi(1,arguments)},e.delayedCall=function(i,r,o,a){return new e(r,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:i,onComplete:r,onReverseComplete:r,onCompleteParams:o,onReverseCompleteParams:o,callbackScope:a})},e.fromTo=function(i,r,o){return Fi(2,arguments)},e.set=function(i,r){return r.duration=0,r.repeatDelay||(r.repeat=0),new e(i,r)},e.killTweensOf=function(i,r,o){return be.killTweensOf(i,r,o)},e}(cr);Dt(ze.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0});ut("staggerTo,staggerFrom,staggerFromTo",function(n){ze[n]=function(){var e=new tt,t=za.call(arguments,0);return t.splice(n==="staggerFromTo"?5:4,0,0),e[n].apply(e,t)}});var qc=function(e,t,s){return e[t]=s},Cd=function(e,t,s){return e[t](s)},ET=function(e,t,s,i){return e[t](i.fp,s)},OT=function(e,t,s){return e.setAttribute(t,s)},Wc=function(e,t){return Re(e[t])?Cd:Nc(e[t])&&e.setAttribute?OT:qc},bd=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e6)/1e6,t)},AT=function(e,t){return t.set(t.t,t.p,!!(t.s+t.c*e),t)},Ed=function(e,t){var s=t._pt,i="";if(!e&&t.b)i=t.b;else if(e===1&&t.e)i=t.e;else{for(;s;)i=s.p+(s.m?s.m(s.s+s.c*e):Math.round((s.s+s.c*e)*1e4)/1e4)+i,s=s._next;i+=t.c}t.set(t.t,t.p,i,t)},Gc=function(e,t){for(var s=t._pt;s;)s.r(e,s.d),s=s._next},MT=function(e,t,s,i){for(var r=this._pt,o;r;)o=r._next,r.p===i&&r.modifier(e,t,s),r=o},DT=function(e){for(var t=this._pt,s,i;t;)i=t._next,t.p===e&&!t.op||t.op===e?Wo(this,t,"_pt"):t.dep||(s=1),t=i;return!s},RT=function(e,t,s,i){i.mSet(e,t,i.m.call(i.tween,s,i.mt),i)},Od=function(e){for(var t=e._pt,s,i,r,o;t;){for(s=t._next,i=r;i&&i.pr>t.pr;)i=i._next;(t._prev=i?i._prev:o)?t._prev._next=t:r=t,(t._next=i)?i._prev=t:o=t,t=s}e._pt=r},ht=function(){function n(t,s,i,r,o,a,c,l,u){this.t=s,this.s=r,this.c=o,this.p=i,this.r=a||bd,this.d=c||this,this.set=l||qc,this.pr=u||0,this._next=t,t&&(t._prev=this)}var e=n.prototype;return e.modifier=function(s,i,r){this.mSet=this.mSet||this.set,this.set=RT,this.m=s,this.mt=r,this.tween=i},n}();ut(zc+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",function(n){return Bc[n]=1});wt.TweenMax=wt.TweenLite=ze;wt.TimelineLite=wt.TimelineMax=tt;be=new tt({sortChildren:!1,defaults:ti,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0});xt.stringFilter=gd;var dn=[],Zr={},PT=[],Ql=0,IT=0,ma=function(e){return(Zr[e]||PT).map(function(t){return t()})},qa=function(){var e=Date.now(),t=[];e-Ql>2&&(ma("matchMediaInit"),dn.forEach(function(s){var i=s.queries,r=s.conditions,o,a,c,l;for(a in i)o=bt.matchMedia(i[a]).matches,o&&(c=1),o!==r[a]&&(r[a]=o,l=1);l&&(s.revert(),c&&t.push(s))}),ma("matchMediaRevert"),t.forEach(function(s){return s.onMatch(s,function(i){return s.add(null,i)})}),Ql=e,ma("matchMedia"))},Ad=function(){function n(t,s){this.selector=s&&Va(s),this.data=[],this._r=[],this.isReverted=!1,this.id=IT++,t&&this.add(t)}var e=n.prototype;return e.add=function(s,i,r){Re(s)&&(r=i,i=s,s=Re);var o=this,a=function(){var l=De,u=o.selector,h;return l&&l!==o&&l.data.push(o),r&&(o.selector=Va(r)),De=o,h=i.apply(o,arguments),Re(h)&&o._r.push(h),De=l,o.selector=u,o.isReverted=!1,h};return o.last=a,s===Re?a(o,function(c){return o.add(null,c)}):s?o[s]=a:a},e.ignore=function(s){var i=De;De=null,s(this),De=i},e.getTweens=function(){var s=[];return this.data.forEach(function(i){return i instanceof n?s.push.apply(s,i.getTweens()):i instanceof ze&&!(i.parent&&i.parent.data==="nested")&&s.push(i)}),s},e.clear=function(){this._r.length=this.data.length=0},e.kill=function(s,i){var r=this;if(s?function(){for(var a=r.getTweens(),c=r.data.length,l;c--;)l=r.data[c],l.data==="isFlip"&&(l.revert(),l.getChildren(!0,!0,!1).forEach(function(u){return a.splice(a.indexOf(u),1)}));for(a.map(function(u){return{g:u._dur||u._delay||u._sat&&!u._sat.vars.immediateRender?u.globalTime(0):-1/0,t:u}}).sort(function(u,h){return h.g-u.g||-1/0}).forEach(function(u){return u.t.revert(s)}),c=r.data.length;c--;)l=r.data[c],l instanceof tt?l.data!=="nested"&&(l.scrollTrigger&&l.scrollTrigger.revert(),l.kill()):!(l instanceof ze)&&l.revert&&l.revert(s);r._r.forEach(function(u){return u(s,r)}),r.isReverted=!0}():this.data.forEach(function(a){return a.kill&&a.kill()}),this.clear(),i)for(var o=dn.length;o--;)dn[o].id===this.id&&dn.splice(o,1)},e.revert=function(s){this.kill(s||{})},n}(),NT=function(){function n(t){this.contexts=[],this.scope=t}var e=n.prototype;return e.add=function(s,i,r){Kt(s)||(s={matches:s});var o=new Ad(0,r||this.scope),a=o.conditions={},c,l,u;De&&!o.selector&&(o.selector=De.selector),this.contexts.push(o),i=o.add("onMatch",i),o.queries=s;for(l in s)l==="all"?u=1:(c=bt.matchMedia(s[l]),c&&(dn.indexOf(o)<0&&dn.push(o),(a[l]=c.matches)&&(u=1),c.addListener?c.addListener(qa):c.addEventListener("change",qa)));return u&&i(o,function(h){return o.add(null,h)}),this},e.revert=function(s){this.kill(s||{})},e.kill=function(s){this.contexts.forEach(function(i){return i.kill(s,!0)})},n}(),ko={registerPlugin:function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];t.forEach(function(i){return pd(i)})},timeline:function(e){return new tt(e)},getTweensOf:function(e,t){return be.getTweensOf(e,t)},getProperty:function(e,t,s,i){Ge(e)&&(e=At(e)[0]);var r=ln(e||{}).get,o=s?td:ed;return s==="native"&&(s=""),e&&(t?o((_t[t]&&_t[t].get||r)(e,t,s,i)):function(a,c,l){return o((_t[a]&&_t[a].get||r)(e,a,c,l))})},quickSetter:function(e,t,s){if(e=At(e),e.length>1){var i=e.map(function(u){return pt.quickSetter(u,t,s)}),r=i.length;return function(u){for(var h=r;h--;)i[h](u)}}e=e[0]||{};var o=_t[t],a=ln(e),c=a.harness&&(a.harness.aliases||{})[t]||t,l=o?function(u){var h=new o;zn._pt=0,h.init(e,s?u+s:u,zn,0,[e]),h.render(1,h),zn._pt&&Gc(1,zn)}:a.set(e,c);return o?l:function(u){return l(e,c,s?u+s:u,a,1)}},quickTo:function(e,t,s){var i,r=pt.to(e,vn((i={},i[t]="+=0.1",i.paused=!0,i),s||{})),o=function(c,l,u){return r.resetTo(t,c,l,u)};return o.tween=r,o},isTweening:function(e){return be.getTweensOf(e,!0).length>0},defaults:function(e){return e&&e.ease&&(e.ease=hn(e.ease,ti.ease)),Gl(ti,e||{})},config:function(e){return Gl(xt,e||{})},registerEffect:function(e){var t=e.name,s=e.effect,i=e.plugins,r=e.defaults,o=e.extendTimeline;(i||"").split(",").forEach(function(a){return a&&!_t[a]&&!wt[a]&&ir(t+" effect requires "+a+" plugin.")}),ha[t]=function(a,c,l){return s(At(a),Dt(c||{},r),l)},o&&(tt.prototype[t]=function(a,c,l){return this.add(ha[t](a,Kt(c)?c:(l=c)&&{},this),l)})},registerEase:function(e,t){se[e]=hn(t)},parseEase:function(e,t){return arguments.length?hn(e,t):se},getById:function(e){return be.getById(e)},exportRoot:function(e,t){e===void 0&&(e={});var s=new tt(e),i,r;for(s.smoothChildTiming=lt(e.smoothChildTiming),be.remove(s),s._dp=0,s._time=s._tTime=be._time,i=be._first;i;)r=i._next,(t||!(!i._dur&&i instanceof ze&&i.vars.onComplete===i._targets[0]))&&Yt(s,i,i._start-i._delay),i=r;return Yt(be,s,0),s},context:function(e,t){return e?new Ad(e,t):De},matchMedia:function(e){return new NT(e)},matchMediaRefresh:function(){return dn.forEach(function(e){var t=e.conditions,s,i;for(i in t)t[i]&&(t[i]=!1,s=1);s&&e.revert()})||qa()},addEventListener:function(e,t){var s=Zr[e]||(Zr[e]=[]);~s.indexOf(t)||s.push(t)},removeEventListener:function(e,t){var s=Zr[e],i=s&&s.indexOf(t);i>=0&&s.splice(i,1)},utils:{wrap:fT,wrapYoyo:pT,distribute:cd,random:ud,snap:ld,normalize:dT,getUnit:$e,clamp:cT,splitColor:md,toArray:At,selector:Va,mapRange:dd,pipe:uT,unitize:hT,interpolate:mT,shuffle:ad},install:$h,effects:ha,ticker:gt,updateRoot:tt.updateRoot,plugins:_t,globalTimeline:be,core:{PropTween:ht,globals:Xh,Tween:ze,Timeline:tt,Animation:cr,getCache:ln,_removeLinkedListItem:Wo,reverting:function(){return Xe},context:function(e){return e&&De&&(De.data.push(e),e._ctx=De),De},suppressOverwrites:function(e){return Ic=e}}};ut("to,from,fromTo,delayedCall,set,killTweensOf",function(n){return ko[n]=ze[n]});gt.add(tt.updateRoot);zn=ko.to({},{duration:0});var FT=function(e,t){for(var s=e._pt;s&&s.p!==t&&s.op!==t&&s.fp!==t;)s=s._next;return s},UT=function(e,t){var s=e._targets,i,r,o;for(i in t)for(r=s.length;r--;)o=e._ptLookup[r][i],o&&(o=o.d)&&(o._pt&&(o=FT(o,i)),o&&o.modifier&&o.modifier(t[i],e,s[r],i))},_a=function(e,t){return{name:e,rawVars:1,init:function(i,r,o){o._onInit=function(a){var c,l;if(Ge(r)&&(c={},ut(r,function(u){return c[u]=1}),r=c),t){c={};for(l in r)c[l]=t(r[l]);r=c}UT(a,r)}}}},pt=ko.registerPlugin({name:"attr",init:function(e,t,s,i,r){var o,a,c;this.tween=s;for(o in t)c=e.getAttribute(o)||"",a=this.add(e,"setAttribute",(c||0)+"",t[o],i,r,0,0,o),a.op=o,a.b=c,this._props.push(o)},render:function(e,t){for(var s=t._pt;s;)Xe?s.set(s.t,s.p,s.b,s):s.r(e,s.d),s=s._next}},{name:"endArray",init:function(e,t){for(var s=t.length;s--;)this.add(e,s,e[s]||0,t[s],0,0,0,0,0,1)}},_a("roundProps",ja),_a("modifiers"),_a("snap",ld))||ko;ze.version=tt.version=pt.version="3.12.4";Zh=1;Fc()&&ii();se.Power0;se.Power1;se.Power2;se.Power3;se.Power4;se.Linear;se.Quad;se.Cubic;se.Quart;se.Quint;se.Strong;se.Elastic;se.Back;se.SteppedEase;se.Bounce;se.Sine;se.Expo;se.Circ;/*!
 * CSSPlugin 3.12.4
 * https://gsap.com
 *
 * Copyright 2008-2023, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license or for
 * Club GSAP members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var Kl,Rs,qn,Yc,rn,Jl,Zc,LT=function(){return typeof window<"u"},ys={},tn=180/Math.PI,Wn=Math.PI/180,In=Math.atan2,eu=1e8,$c=/([A-Z])/g,BT=/(left|right|width|margin|padding|x)/i,zT=/[\s,\(]\S/,Zt={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},Wa=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},VT=function(e,t){return t.set(t.t,t.p,e===1?t.e:Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},jT=function(e,t){return t.set(t.t,t.p,e?Math.round((t.s+t.c*e)*1e4)/1e4+t.u:t.b,t)},HT=function(e,t){var s=t.s+t.c*e;t.set(t.t,t.p,~~(s+(s<0?-.5:.5))+t.u,t)},Md=function(e,t){return t.set(t.t,t.p,e?t.e:t.b,t)},Dd=function(e,t){return t.set(t.t,t.p,e!==1?t.b:t.e,t)},qT=function(e,t,s){return e.style[t]=s},WT=function(e,t,s){return e.style.setProperty(t,s)},GT=function(e,t,s){return e._gsap[t]=s},YT=function(e,t,s){return e._gsap.scaleX=e._gsap.scaleY=s},ZT=function(e,t,s,i,r){var o=e._gsap;o.scaleX=o.scaleY=s,o.renderTransform(r,o)},$T=function(e,t,s,i,r){var o=e._gsap;o[t]=s,o.renderTransform(r,o)},Ee="transform",dt=Ee+"Origin",XT=function n(e,t){var s=this,i=this.target,r=i.style,o=i._gsap;if(e in ys&&r){if(this.tfm=this.tfm||{},e!=="transform")e=Zt[e]||e,~e.indexOf(",")?e.split(",").forEach(function(a){return s.tfm[a]=us(i,a)}):this.tfm[e]=o.x?o[e]:us(i,e),e===dt&&(this.tfm.zOrigin=o.zOrigin);else return Zt.transform.split(",").forEach(function(a){return n.call(s,a,t)});if(this.props.indexOf(Ee)>=0)return;o.svg&&(this.svgo=i.getAttribute("data-svg-origin"),this.props.push(dt,t,"")),e=Ee}(r||t)&&this.props.push(e,t,r[e])},Rd=function(e){e.translate&&(e.removeProperty("translate"),e.removeProperty("scale"),e.removeProperty("rotate"))},QT=function(){var e=this.props,t=this.target,s=t.style,i=t._gsap,r,o;for(r=0;r<e.length;r+=3)e[r+1]?t[e[r]]=e[r+2]:e[r+2]?s[e[r]]=e[r+2]:s.removeProperty(e[r].substr(0,2)==="--"?e[r]:e[r].replace($c,"-$1").toLowerCase());if(this.tfm){for(o in this.tfm)i[o]=this.tfm[o];i.svg&&(i.renderTransform(),t.setAttribute("data-svg-origin",this.svgo||"")),r=Zc(),(!r||!r.isStart)&&!s[Ee]&&(Rd(s),i.zOrigin&&s[dt]&&(s[dt]+=" "+i.zOrigin+"px",i.zOrigin=0,i.renderTransform()),i.uncache=1)}},Pd=function(e,t){var s={target:e,props:[],revert:QT,save:XT};return e._gsap||pt.core.getCache(e),t&&t.split(",").forEach(function(i){return s.save(i)}),s},Id,Ga=function(e,t){var s=Rs.createElementNS?Rs.createElementNS((t||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),e):Rs.createElement(e);return s&&s.style?s:Rs.createElement(e)},Xt=function n(e,t,s){var i=getComputedStyle(e);return i[t]||i.getPropertyValue(t.replace($c,"-$1").toLowerCase())||i.getPropertyValue(t)||!s&&n(e,ri(t)||t,1)||""},tu="O,Moz,ms,Ms,Webkit".split(","),ri=function(e,t,s){var i=t||rn,r=i.style,o=5;if(e in r&&!s)return e;for(e=e.charAt(0).toUpperCase()+e.substr(1);o--&&!(tu[o]+e in r););return o<0?null:(o===3?"ms":o>=0?tu[o]:"")+e},Ya=function(){LT()&&window.document&&(Kl=window,Rs=Kl.document,qn=Rs.documentElement,rn=Ga("div")||{style:{}},Ga("div"),Ee=ri(Ee),dt=Ee+"Origin",rn.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",Id=!!ri("perspective"),Zc=pt.core.reverting,Yc=1)},ga=function n(e){var t=Ga("svg",this.ownerSVGElement&&this.ownerSVGElement.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),s=this.parentNode,i=this.nextSibling,r=this.style.cssText,o;if(qn.appendChild(t),t.appendChild(this),this.style.display="block",e)try{o=this.getBBox(),this._gsapBBox=this.getBBox,this.getBBox=n}catch{}else this._gsapBBox&&(o=this._gsapBBox());return s&&(i?s.insertBefore(this,i):s.appendChild(this)),qn.removeChild(t),this.style.cssText=r,o},su=function(e,t){for(var s=t.length;s--;)if(e.hasAttribute(t[s]))return e.getAttribute(t[s])},Nd=function(e){var t;try{t=e.getBBox()}catch{t=ga.call(e,!0)}return t&&(t.width||t.height)||e.getBBox===ga||(t=ga.call(e,!0)),t&&!t.width&&!t.x&&!t.y?{x:+su(e,["x","cx","x1"])||0,y:+su(e,["y","cy","y1"])||0,width:0,height:0}:t},Fd=function(e){return!!(e.getCTM&&(!e.parentNode||e.ownerSVGElement)&&Nd(e))},yn=function(e,t){if(t){var s=e.style,i;t in ys&&t!==dt&&(t=Ee),s.removeProperty?(i=t.substr(0,2),(i==="ms"||t.substr(0,6)==="webkit")&&(t="-"+t),s.removeProperty(i==="--"?t:t.replace($c,"-$1").toLowerCase())):s.removeAttribute(t)}},Ps=function(e,t,s,i,r,o){var a=new ht(e._pt,t,s,0,1,o?Dd:Md);return e._pt=a,a.b=i,a.e=r,e._props.push(s),a},nu={deg:1,rad:1,turn:1},KT={grid:1,flex:1},Ws=function n(e,t,s,i){var r=parseFloat(s)||0,o=(s+"").trim().substr((r+"").length)||"px",a=rn.style,c=BT.test(t),l=e.tagName.toLowerCase()==="svg",u=(l?"client":"offset")+(c?"Width":"Height"),h=100,f=i==="px",d=i==="%",m,p,_,v;if(i===o||!r||nu[i]||nu[o])return r;if(o!=="px"&&!f&&(r=n(e,t,s,"px")),v=e.getCTM&&Fd(e),(d||o==="%")&&(ys[t]||~t.indexOf("adius")))return m=v?e.getBBox()[c?"width":"height"]:e[u],Ie(d?r/m*h:r/100*m);if(a[c?"width":"height"]=h+(f?o:i),p=~t.indexOf("adius")||i==="em"&&e.appendChild&&!l?e:e.parentNode,v&&(p=(e.ownerSVGElement||{}).parentNode),(!p||p===Rs||!p.appendChild)&&(p=Rs.body),_=p._gsap,_&&d&&_.width&&c&&_.time===gt.time&&!_.uncache)return Ie(r/_.width*h);if(d&&(t==="height"||t==="width")){var T=e.style[t];e.style[t]=h+i,m=e[u],T?e.style[t]=T:yn(e,t)}else(d||o==="%")&&!KT[Xt(p,"display")]&&(a.position=Xt(e,"position")),p===e&&(a.position="static"),p.appendChild(rn),m=rn[u],p.removeChild(rn),a.position="absolute";return c&&d&&(_=ln(p),_.time=gt.time,_.width=p[u]),Ie(f?m*r/h:m&&r?h/m*r:0)},us=function(e,t,s,i){var r;return Yc||Ya(),t in Zt&&t!=="transform"&&(t=Zt[t],~t.indexOf(",")&&(t=t.split(",")[0])),ys[t]&&t!=="transform"?(r=ur(e,i),r=t!=="transformOrigin"?r[t]:r.svg?r.origin:Co(Xt(e,dt))+" "+r.zOrigin+"px"):(r=e.style[t],(!r||r==="auto"||i||~(r+"").indexOf("calc("))&&(r=So[t]&&So[t](e,t,s)||Xt(e,t)||Kh(e,t)||(t==="opacity"?1:0))),s&&!~(r+"").trim().indexOf(" ")?Ws(e,t,r,s)+s:r},JT=function(e,t,s,i){if(!s||s==="none"){var r=ri(t,e,1),o=r&&Xt(e,r,1);o&&o!==s?(t=r,s=o):t==="borderColor"&&(s=Xt(e,"borderTopColor"))}var a=new ht(this._pt,e.style,t,0,1,Ed),c=0,l=0,u,h,f,d,m,p,_,v,T,S,y,g;if(a.b=s,a.e=i,s+="",i+="",i==="auto"&&(p=e.style[t],e.style[t]=i,i=Xt(e,t)||i,p?e.style[t]=p:yn(e,t)),u=[s,i],gd(u),s=u[0],i=u[1],f=s.match(Bn)||[],g=i.match(Bn)||[],g.length){for(;h=Bn.exec(i);)_=h[0],T=i.substring(c,h.index),m?m=(m+1)%5:(T.substr(-5)==="rgba("||T.substr(-5)==="hsla(")&&(m=1),_!==(p=f[l++]||"")&&(d=parseFloat(p)||0,y=p.substr((d+"").length),_.charAt(1)==="="&&(_=Hn(d,_)+y),v=parseFloat(_),S=_.substr((v+"").length),c=Bn.lastIndex-S.length,S||(S=S||xt.units[t]||y,c===i.length&&(i+=S,a.e+=S)),y!==S&&(d=Ws(e,t,p,S)||0),a._pt={_next:a._pt,p:T||l===1?T:",",s:d,c:v-d,m:m&&m<4||t==="zIndex"?Math.round:0});a.c=c<i.length?i.substring(c,i.length):""}else a.r=t==="display"&&i==="none"?Dd:Md;return Gh.test(i)&&(a.e=0),this._pt=a,a},iu={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},ew=function(e){var t=e.split(" "),s=t[0],i=t[1]||"50%";return(s==="top"||s==="bottom"||i==="left"||i==="right")&&(e=s,s=i,i=e),t[0]=iu[s]||s,t[1]=iu[i]||i,t.join(" ")},tw=function(e,t){if(t.tween&&t.tween._time===t.tween._dur){var s=t.t,i=s.style,r=t.u,o=s._gsap,a,c,l;if(r==="all"||r===!0)i.cssText="",c=1;else for(r=r.split(","),l=r.length;--l>-1;)a=r[l],ys[a]&&(c=1,a=a==="transformOrigin"?dt:Ee),yn(s,a);c&&(yn(s,Ee),o&&(o.svg&&s.removeAttribute("transform"),ur(s,1),o.uncache=1,Rd(i)))}},So={clearProps:function(e,t,s,i,r){if(r.data!=="isFromStart"){var o=e._pt=new ht(e._pt,t,s,0,0,tw);return o.u=i,o.pr=-10,o.tween=r,e._props.push(s),1}}},lr=[1,0,0,1,0,0],Ud={},Ld=function(e){return e==="matrix(1, 0, 0, 1, 0, 0)"||e==="none"||!e},ru=function(e){var t=Xt(e,Ee);return Ld(t)?lr:t.substr(7).match(Wh).map(Ie)},Xc=function(e,t){var s=e._gsap||ln(e),i=e.style,r=ru(e),o,a,c,l;return s.svg&&e.getAttribute("transform")?(c=e.transform.baseVal.consolidate().matrix,r=[c.a,c.b,c.c,c.d,c.e,c.f],r.join(",")==="1,0,0,1,0,0"?lr:r):(r===lr&&!e.offsetParent&&e!==qn&&!s.svg&&(c=i.display,i.display="block",o=e.parentNode,(!o||!e.offsetParent)&&(l=1,a=e.nextElementSibling,qn.appendChild(e)),r=ru(e),c?i.display=c:yn(e,"display"),l&&(a?o.insertBefore(e,a):o?o.appendChild(e):qn.removeChild(e))),t&&r.length>6?[r[0],r[1],r[4],r[5],r[12],r[13]]:r)},Za=function(e,t,s,i,r,o){var a=e._gsap,c=r||Xc(e,!0),l=a.xOrigin||0,u=a.yOrigin||0,h=a.xOffset||0,f=a.yOffset||0,d=c[0],m=c[1],p=c[2],_=c[3],v=c[4],T=c[5],S=t.split(" "),y=parseFloat(S[0])||0,g=parseFloat(S[1])||0,w,k,x,C;s?c!==lr&&(k=d*_-m*p)&&(x=y*(_/k)+g*(-p/k)+(p*T-_*v)/k,C=y*(-m/k)+g*(d/k)-(d*T-m*v)/k,y=x,g=C):(w=Nd(e),y=w.x+(~S[0].indexOf("%")?y/100*w.width:y),g=w.y+(~(S[1]||S[0]).indexOf("%")?g/100*w.height:g)),i||i!==!1&&a.smooth?(v=y-l,T=g-u,a.xOffset=h+(v*d+T*p)-v,a.yOffset=f+(v*m+T*_)-T):a.xOffset=a.yOffset=0,a.xOrigin=y,a.yOrigin=g,a.smooth=!!i,a.origin=t,a.originIsAbsolute=!!s,e.style[dt]="0px 0px",o&&(Ps(o,a,"xOrigin",l,y),Ps(o,a,"yOrigin",u,g),Ps(o,a,"xOffset",h,a.xOffset),Ps(o,a,"yOffset",f,a.yOffset)),e.setAttribute("data-svg-origin",y+" "+g)},ur=function(e,t){var s=e._gsap||new Td(e);if("x"in s&&!t&&!s.uncache)return s;var i=e.style,r=s.scaleX<0,o="px",a="deg",c=getComputedStyle(e),l=Xt(e,dt)||"0",u,h,f,d,m,p,_,v,T,S,y,g,w,k,x,C,b,O,A,R,P,F,N,U,V,z,q,j,B,we,ae,$;return u=h=f=p=_=v=T=S=y=0,d=m=1,s.svg=!!(e.getCTM&&Fd(e)),c.translate&&((c.translate!=="none"||c.scale!=="none"||c.rotate!=="none")&&(i[Ee]=(c.translate!=="none"?"translate3d("+(c.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+(c.rotate!=="none"?"rotate("+c.rotate+") ":"")+(c.scale!=="none"?"scale("+c.scale.split(" ").join(",")+") ":"")+(c[Ee]!=="none"?c[Ee]:"")),i.scale=i.rotate=i.translate="none"),k=Xc(e,s.svg),s.svg&&(s.uncache?(V=e.getBBox(),l=s.xOrigin-V.x+"px "+(s.yOrigin-V.y)+"px",U=""):U=!t&&e.getAttribute("data-svg-origin"),Za(e,U||l,!!U||s.originIsAbsolute,s.smooth!==!1,k)),g=s.xOrigin||0,w=s.yOrigin||0,k!==lr&&(O=k[0],A=k[1],R=k[2],P=k[3],u=F=k[4],h=N=k[5],k.length===6?(d=Math.sqrt(O*O+A*A),m=Math.sqrt(P*P+R*R),p=O||A?In(A,O)*tn:0,T=R||P?In(R,P)*tn+p:0,T&&(m*=Math.abs(Math.cos(T*Wn))),s.svg&&(u-=g-(g*O+w*R),h-=w-(g*A+w*P))):($=k[6],we=k[7],q=k[8],j=k[9],B=k[10],ae=k[11],u=k[12],h=k[13],f=k[14],x=In($,B),_=x*tn,x&&(C=Math.cos(-x),b=Math.sin(-x),U=F*C+q*b,V=N*C+j*b,z=$*C+B*b,q=F*-b+q*C,j=N*-b+j*C,B=$*-b+B*C,ae=we*-b+ae*C,F=U,N=V,$=z),x=In(-R,B),v=x*tn,x&&(C=Math.cos(-x),b=Math.sin(-x),U=O*C-q*b,V=A*C-j*b,z=R*C-B*b,ae=P*b+ae*C,O=U,A=V,R=z),x=In(A,O),p=x*tn,x&&(C=Math.cos(x),b=Math.sin(x),U=O*C+A*b,V=F*C+N*b,A=A*C-O*b,N=N*C-F*b,O=U,F=V),_&&Math.abs(_)+Math.abs(p)>359.9&&(_=p=0,v=180-v),d=Ie(Math.sqrt(O*O+A*A+R*R)),m=Ie(Math.sqrt(N*N+$*$)),x=In(F,N),T=Math.abs(x)>2e-4?x*tn:0,y=ae?1/(ae<0?-ae:ae):0),s.svg&&(U=e.getAttribute("transform"),s.forceCSS=e.setAttribute("transform","")||!Ld(Xt(e,Ee)),U&&e.setAttribute("transform",U))),Math.abs(T)>90&&Math.abs(T)<270&&(r?(d*=-1,T+=p<=0?180:-180,p+=p<=0?180:-180):(m*=-1,T+=T<=0?180:-180)),t=t||s.uncache,s.x=u-((s.xPercent=u&&(!t&&s.xPercent||(Math.round(e.offsetWidth/2)===Math.round(-u)?-50:0)))?e.offsetWidth*s.xPercent/100:0)+o,s.y=h-((s.yPercent=h&&(!t&&s.yPercent||(Math.round(e.offsetHeight/2)===Math.round(-h)?-50:0)))?e.offsetHeight*s.yPercent/100:0)+o,s.z=f+o,s.scaleX=Ie(d),s.scaleY=Ie(m),s.rotation=Ie(p)+a,s.rotationX=Ie(_)+a,s.rotationY=Ie(v)+a,s.skewX=T+a,s.skewY=S+a,s.transformPerspective=y+o,(s.zOrigin=parseFloat(l.split(" ")[2])||!t&&s.zOrigin||0)&&(i[dt]=Co(l)),s.xOffset=s.yOffset=0,s.force3D=xt.force3D,s.renderTransform=s.svg?nw:Id?Bd:sw,s.uncache=0,s},Co=function(e){return(e=e.split(" "))[0]+" "+e[1]},va=function(e,t,s){var i=$e(t);return Ie(parseFloat(t)+parseFloat(Ws(e,"x",s+"px",i)))+i},sw=function(e,t){t.z="0px",t.rotationY=t.rotationX="0deg",t.force3D=0,Bd(e,t)},Js="0deg",Oi="0px",en=") ",Bd=function(e,t){var s=t||this,i=s.xPercent,r=s.yPercent,o=s.x,a=s.y,c=s.z,l=s.rotation,u=s.rotationY,h=s.rotationX,f=s.skewX,d=s.skewY,m=s.scaleX,p=s.scaleY,_=s.transformPerspective,v=s.force3D,T=s.target,S=s.zOrigin,y="",g=v==="auto"&&e&&e!==1||v===!0;if(S&&(h!==Js||u!==Js)){var w=parseFloat(u)*Wn,k=Math.sin(w),x=Math.cos(w),C;w=parseFloat(h)*Wn,C=Math.cos(w),o=va(T,o,k*C*-S),a=va(T,a,-Math.sin(w)*-S),c=va(T,c,x*C*-S+S)}_!==Oi&&(y+="perspective("+_+en),(i||r)&&(y+="translate("+i+"%, "+r+"%) "),(g||o!==Oi||a!==Oi||c!==Oi)&&(y+=c!==Oi||g?"translate3d("+o+", "+a+", "+c+") ":"translate("+o+", "+a+en),l!==Js&&(y+="rotate("+l+en),u!==Js&&(y+="rotateY("+u+en),h!==Js&&(y+="rotateX("+h+en),(f!==Js||d!==Js)&&(y+="skew("+f+", "+d+en),(m!==1||p!==1)&&(y+="scale("+m+", "+p+en),T.style[Ee]=y||"translate(0, 0)"},nw=function(e,t){var s=t||this,i=s.xPercent,r=s.yPercent,o=s.x,a=s.y,c=s.rotation,l=s.skewX,u=s.skewY,h=s.scaleX,f=s.scaleY,d=s.target,m=s.xOrigin,p=s.yOrigin,_=s.xOffset,v=s.yOffset,T=s.forceCSS,S=parseFloat(o),y=parseFloat(a),g,w,k,x,C;c=parseFloat(c),l=parseFloat(l),u=parseFloat(u),u&&(u=parseFloat(u),l+=u,c+=u),c||l?(c*=Wn,l*=Wn,g=Math.cos(c)*h,w=Math.sin(c)*h,k=Math.sin(c-l)*-f,x=Math.cos(c-l)*f,l&&(u*=Wn,C=Math.tan(l-u),C=Math.sqrt(1+C*C),k*=C,x*=C,u&&(C=Math.tan(u),C=Math.sqrt(1+C*C),g*=C,w*=C)),g=Ie(g),w=Ie(w),k=Ie(k),x=Ie(x)):(g=h,x=f,w=k=0),(S&&!~(o+"").indexOf("px")||y&&!~(a+"").indexOf("px"))&&(S=Ws(d,"x",o,"px"),y=Ws(d,"y",a,"px")),(m||p||_||v)&&(S=Ie(S+m-(m*g+p*k)+_),y=Ie(y+p-(m*w+p*x)+v)),(i||r)&&(C=d.getBBox(),S=Ie(S+i/100*C.width),y=Ie(y+r/100*C.height)),C="matrix("+g+","+w+","+k+","+x+","+S+","+y+")",d.setAttribute("transform",C),T&&(d.style[Ee]=C)},iw=function(e,t,s,i,r){var o=360,a=Ge(r),c=parseFloat(r)*(a&&~r.indexOf("rad")?tn:1),l=c-i,u=i+l+"deg",h,f;return a&&(h=r.split("_")[1],h==="short"&&(l%=o,l!==l%(o/2)&&(l+=l<0?o:-o)),h==="cw"&&l<0?l=(l+o*eu)%o-~~(l/o)*o:h==="ccw"&&l>0&&(l=(l-o*eu)%o-~~(l/o)*o)),e._pt=f=new ht(e._pt,t,s,i,l,VT),f.e=u,f.u="deg",e._props.push(s),f},ou=function(e,t){for(var s in t)e[s]=t[s];return e},rw=function(e,t,s){var i=ou({},s._gsap),r="perspective,force3D,transformOrigin,svgOrigin",o=s.style,a,c,l,u,h,f,d,m;i.svg?(l=s.getAttribute("transform"),s.setAttribute("transform",""),o[Ee]=t,a=ur(s,1),yn(s,Ee),s.setAttribute("transform",l)):(l=getComputedStyle(s)[Ee],o[Ee]=t,a=ur(s,1),o[Ee]=l);for(c in ys)l=i[c],u=a[c],l!==u&&r.indexOf(c)<0&&(d=$e(l),m=$e(u),h=d!==m?Ws(s,c,l,m):parseFloat(l),f=parseFloat(u),e._pt=new ht(e._pt,a,c,h,f-h,Wa),e._pt.u=m||0,e._props.push(c));ou(a,i)};ut("padding,margin,Width,Radius",function(n,e){var t="Top",s="Right",i="Bottom",r="Left",o=(e<3?[t,s,i,r]:[t+r,t+s,i+s,i+r]).map(function(a){return e<2?n+a:"border"+a+n});So[e>1?"border"+n:n]=function(a,c,l,u,h){var f,d;if(arguments.length<4)return f=o.map(function(m){return us(a,m,l)}),d=f.join(" "),d.split(f[0]).length===5?f[0]:d;f=(u+"").split(" "),d={},o.forEach(function(m,p){return d[m]=f[p]=f[p]||f[(p-1)/2|0]}),a.init(c,d,h)}});var zd={name:"css",register:Ya,targetTest:function(e){return e.style&&e.nodeType},init:function(e,t,s,i,r){var o=this._props,a=e.style,c=s.vars.startAt,l,u,h,f,d,m,p,_,v,T,S,y,g,w,k,x;Yc||Ya(),this.styles=this.styles||Pd(e),x=this.styles.props,this.tween=s;for(p in t)if(p!=="autoRound"&&(u=t[p],!(_t[p]&&wd(p,t,s,i,e,r)))){if(d=typeof u,m=So[p],d==="function"&&(u=u.call(s,i,e,r),d=typeof u),d==="string"&&~u.indexOf("random(")&&(u=or(u)),m)m(this,e,p,u,s)&&(k=1);else if(p.substr(0,2)==="--")l=(getComputedStyle(e).getPropertyValue(p)+"").trim(),u+="",Ls.lastIndex=0,Ls.test(l)||(_=$e(l),v=$e(u)),v?_!==v&&(l=Ws(e,p,l,v)+v):_&&(u+=_),this.add(a,"setProperty",l,u,i,r,0,0,p),o.push(p),x.push(p,0,a[p]);else if(d!=="undefined"){if(c&&p in c?(l=typeof c[p]=="function"?c[p].call(s,i,e,r):c[p],Ge(l)&&~l.indexOf("random(")&&(l=or(l)),$e(l+"")||l==="auto"||(l+=xt.units[p]||$e(us(e,p))||""),(l+"").charAt(1)==="="&&(l=us(e,p))):l=us(e,p),f=parseFloat(l),T=d==="string"&&u.charAt(1)==="="&&u.substr(0,2),T&&(u=u.substr(2)),h=parseFloat(u),p in Zt&&(p==="autoAlpha"&&(f===1&&us(e,"visibility")==="hidden"&&h&&(f=0),x.push("visibility",0,a.visibility),Ps(this,a,"visibility",f?"inherit":"hidden",h?"inherit":"hidden",!h)),p!=="scale"&&p!=="transform"&&(p=Zt[p],~p.indexOf(",")&&(p=p.split(",")[0]))),S=p in ys,S){if(this.styles.save(p),y||(g=e._gsap,g.renderTransform&&!t.parseTransform||ur(e,t.parseTransform),w=t.smoothOrigin!==!1&&g.smooth,y=this._pt=new ht(this._pt,a,Ee,0,1,g.renderTransform,g,0,-1),y.dep=1),p==="scale")this._pt=new ht(this._pt,g,"scaleY",g.scaleY,(T?Hn(g.scaleY,T+h):h)-g.scaleY||0,Wa),this._pt.u=0,o.push("scaleY",p),p+="X";else if(p==="transformOrigin"){x.push(dt,0,a[dt]),u=ew(u),g.svg?Za(e,u,0,w,0,this):(v=parseFloat(u.split(" ")[2])||0,v!==g.zOrigin&&Ps(this,g,"zOrigin",g.zOrigin,v),Ps(this,a,p,Co(l),Co(u)));continue}else if(p==="svgOrigin"){Za(e,u,1,w,0,this);continue}else if(p in Ud){iw(this,g,p,f,T?Hn(f,T+u):u);continue}else if(p==="smoothOrigin"){Ps(this,g,"smooth",g.smooth,u);continue}else if(p==="force3D"){g[p]=u;continue}else if(p==="transform"){rw(this,u,e);continue}}else p in a||(p=ri(p)||p);if(S||(h||h===0)&&(f||f===0)&&!zT.test(u)&&p in a)_=(l+"").substr((f+"").length),h||(h=0),v=$e(u)||(p in xt.units?xt.units[p]:_),_!==v&&(f=Ws(e,p,l,v)),this._pt=new ht(this._pt,S?g:a,p,f,(T?Hn(f,T+h):h)-f,!S&&(v==="px"||p==="zIndex")&&t.autoRound!==!1?HT:Wa),this._pt.u=v||0,_!==v&&v!=="%"&&(this._pt.b=l,this._pt.r=jT);else if(p in a)JT.call(this,e,p,l,T?T+u:u);else if(p in e)this.add(e,p,l||e[p],T?T+u:u,i,r);else if(p!=="parseTransform"){Lc(p,u);continue}S||(p in a?x.push(p,0,a[p]):x.push(p,1,l||e[p])),o.push(p)}}k&&Od(this)},render:function(e,t){if(t.tween._time||!Zc())for(var s=t._pt;s;)s.r(e,s.d),s=s._next;else t.styles.revert()},get:us,aliases:Zt,getSetter:function(e,t,s){var i=Zt[t];return i&&i.indexOf(",")<0&&(t=i),t in ys&&t!==dt&&(e._gsap.x||us(e,"x"))?s&&Jl===s?t==="scale"?YT:GT:(Jl=s||{})&&(t==="scale"?ZT:$T):e.style&&!Nc(e.style[t])?qT:~t.indexOf("-")?WT:Wc(e,t)},core:{_removeProperty:yn,_getMatrix:Xc}};pt.utils.checkPrefix=ri;pt.core.getStyleSaver=Pd;(function(n,e,t,s){var i=ut(n+","+e+","+t,function(r){ys[r]=1});ut(e,function(r){xt.units[r]="deg",Ud[r]=1}),Zt[i[13]]=n+","+e,ut(s,function(r){var o=r.split(":");Zt[o[1]]=i[o[0]]})})("x,y,z,scale,scaleX,scaleY,xPercent,yPercent","rotation,rotationX,rotationY,skewX,skewY","transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective","0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY");ut("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function(n){xt.units[n]="px"});pt.registerPlugin(zd);var Vd=pt.registerPlugin(zd)||pt;Vd.core.Tween;const jd=E.memo(({linksPositions:n})=>{const e=xn(r=>r.dataInitial),{showSelectionGraph:t}=nt(r=>r),s=Jt(),i=E.useRef([]);return E.useEffect(()=>{i.current.forEach((r,o)=>{if(r){const a=s?0:.5,c=(s==null?void 0:s.ref_id)===(e==null?void 0:e.links[o].source)||(s==null?void 0:s.ref_id)===(e==null?void 0:e.links[o].target);Vd.fromTo(r.material,{linewidth:5},{linewidth:c?2:a,duration:1})}})},[e,s]),M.jsx("group",{name:"simulation-3d-group__connections",children:e==null?void 0:e.links.map((r,o)=>{var l,u,h,f,d,m;const a=new X(((l=n[o])==null?void 0:l.sx)||0,((u=n[o])==null?void 0:u.sy)||0,((h=n[o])==null?void 0:h.sz)||0),c=new X(((f=n[o])==null?void 0:f.tx)||0,((d=n[o])==null?void 0:d.ty)||0,((m=n[o])==null?void 0:m.tz)||0);return M.jsx(Tf,{ref:p=>{i.current[o]=p},color:"rgba(136, 136, 136, 1)",isLine2:!0,lineWidth:1,opacity:1,points:[a,c],transparent:!0,visible:!t},r.ref_id)})})});jd.displayName="Connections";const Zo={metalness:.9,roughness:0},ow={...Zo};new fr(ow);const Hd=new Oo,bo=Hd.load("noimage.jpeg"),au=new fr({...Zo,map:bo}),qd=.4,aw=new fr({...Zo,map:bo,transparent:!0,opacity:qd}),Hr={},cw=(n,e)=>{const[t,s]=E.useState(bo),[i,r]=E.useState(au);return E.useEffect(()=>{const o=`${n}${e&&"-transparent"}`;if(Hr[o]){s(Hr[o].texture),r(Hr[o].material);return}Hd.load(n,a=>{const c=new fr({map:a,transparent:e,opacity:e?qd:1,...Zo});Hr[o]={texture:a,material:c},s(a),r(c)},void 0,()=>{s(bo),r(e?aw:au)})},[n,e]),E.useEffect(()=>function(){t.dispose(),i.dispose()},[t,i]),i},Qc=E.memo(({node:n,hide:e,animated:t})=>{const s=E.useRef(null),[i]=E.useState(ql),r=Jt(),{showSelectionGraph:o}=nt(u=>u),a=!!r&&n.ref_id===r.ref_id,c=cw(n.image_url||"noimage.jpeg",!1);Rt((u,h)=>{t&&s.current&&a&&(s.current.rotation.y+=h*1,s.current.rotation.x-=h*.6)}),E.useEffect(()=>function(){i.dispose()},[i]);const l=E.useMemo(()=>o&&a?20:a?(n.scale||1)*1.2:n.scale,[n,a,o]);return M.jsx(Up,{enabled:!!a,children:M.jsx("mesh",{ref:s,geometry:ql,material:c,name:n.id,scale:l,userData:n,visible:!e})})});Qc.displayName="Cube";const lw=Le(xs)`
  text-align: center;
  width: ${n=>n.type==="topic"?"auto":`${n.size}px`};
  height: ${n=>n.type==="topic"?"auto":`${n.size}px`};
  outline: 1px solid ${n=>pe.white||n.color};
  outline-offset: 0px;
  background: rgba(0, 0, 0, 0.75);
  color: ${n=>n.fontColor};
  border-radius: ${n=>`${n.type==="guest"?"100%":"6px"}`};
  font-size: ${n=>`${n.fontSize}px`};
  cursor: pointer;
  transition: font-size 0.4s, outline 0.4s;
  transform: scale(${n=>n.scale});
  align-items: center;
  justify-content: center;
  font-family: Barlow;
  font-size: 26px;
  font-style: normal;
  font-weight: 700;
  text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);

  &:hover {
    outline-offset: 4px;
  }

  &.selected {
    .badge-wrapper {
      top: 0;
    }

    font-size: 36px;

    &:hover {
      outline-offset: 0px;
    }
  }

  &.topic {
    outline: none;
    background: none;
    &:hover {
      font-size: 36px;
    }
    white-space: nowrap;
    .badge-wrapper {
      display: none;
    }
  }

  .badge-wrapper {
    position: absolute;
    top: -7px;
    left: -14px;
  }
`,uw=Le(xs)`
  text-align: center;
  outline: 1px solid ${pe.white};
  outline-offset: 0px;
  white-space: nowrap;
  padding: 4px;
  background: rgba(0, 0, 0, 0.75);
  color: ${pe.white};
  border-radius: 6px;
  font-size: 20px;
  cursor: pointer;
  transition: font-size 0.4s, outline 0.4s;
  align-items: center;
  justify-content: flex-start;
  font-family: Barlow;
  font-size: 26px;
  font-style: normal;
  font-weight: 700;
  text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
  max-width: auto;
  max-height: 100px;
  white-space: normal;
  font-size: 16px;

  &:hover {
    outline-offset: 4px;
  }

  &.selected {
    .badge-wrapper {
      top: 0;
    }

    font-size: 36px;

    &:hover {
      outline-offset: 0px;
    }
  }

  &.topic {
    outline: none;
    background: none;
    &:hover {
      font-size: 36px;
    }
    white-space: nowrap;
    .badge-wrapper {
      display: none;
    }
  }

  .badge-wrapper {
    position: absolute;
    top: -7px;
    left: -14px;
  }
`;Le.img`
  background-image: ${({src:n})=>`url(${n})`};
  background-size: contain;
  background-repeat: no-repeat;
  width: ${n=>n.size}px;
  height: ${n=>n.size}px;
  border-radius: ${n=>n.borderRadius};
`;Le.div`
  display: flex;
  position: absolute;
  bottom: -14px;
  left: -5px;
  width: auto;
  justify-content: center;
  align-items: center;
`;Le.div`
  display: flex;
  justify-content: center;
  align-items: center;
  background: ${pe.transparentBlack};
  border: 2px solid ${n=>n.color};
  color: #fff;
  padding: 0 4px;
  min-width: 30px;
  height: 26px;
  font-size: 12px;
  font-weight: 500;
  border-radius: 6px;
  margin-right: 5px;
`;Le.div`
  display: flex;
  justify-content: center;
  align-items: center;
  border: 2px solid ${n=>n.color}44;
  background: ${pe.transparentBlack};
  padding: 0 4px;
  color: ${n=>n.color};
  min-width: 30px;
  height: 26px;
  font-size: 12px;
  font-weight: 500;
  border-radius: 6px;
  margin-right: 5px;
`;const hw=new X,dw=({position:n,userData:e,color:t})=>{const s=E.useRef(null),{selectedNode:i,setSelectedNode:r,showSelectionGraph:o,hoveredNode:a,setHoveredNode:c}=nt(ec(d=>d)),l=((e==null?void 0:e.node_type)||"")==="Topic"||!!e.name,u=((e==null?void 0:e.node_type)||"")==="Guest"||((e==null?void 0:e.node_type)||"")==="Person";Rt(()=>{if(o&&s.current){const d=hw.set((e==null?void 0:e.x)||0,(e==null?void 0:e.y)||0,(e==null?void 0:e.z)||0);s.current.position.copy(d)}}),E.useEffect(()=>function(){s.current&&s.current.clear()},[s]);const h=E.useMemo(()=>(a==null?void 0:a.ref_id)===(e==null?void 0:e.ref_id),[a==null?void 0:a.ref_id,e==null?void 0:e.ref_id]),f=(i==null?void 0:i.ref_id)===(e==null?void 0:e.ref_id);return l||f&&o||!f?M.jsx("group",{ref:s,position:n,children:M.jsx(dr,{center:!0,sprite:!0,zIndexRange:[0,0],children:l?M.jsxs(uw,{direction:"column",onClick:d=>{d.stopPropagation(),e&&r(e)},onPointerOut:d=>{d.stopPropagation()},onPointerOver:d=>{d.stopPropagation()},children:[M.jsx("div",{className:"badge-wrapper",children:M.jsx(tl,{type:(e==null?void 0:e.node_type)||""})}),pu(e==null?void 0:e.name,20)]}):M.jsxs(lw,{className:du(e==null?void 0:e.node_type,{selected:f}),color:t,fontColor:pe.white,fontSize:l?64:20,onClick:d=>{d.stopPropagation(),e&&r(e)},onPointerOut:d=>{d.stopPropagation()},onPointerOver:d=>{d.stopPropagation()},scale:h?1.05:1,selected:!1,size:f?68:40,type:(e==null?void 0:e.node_type)||"",children:[!u&&!l?M.jsx("div",{className:"badge-wrapper",children:M.jsx(tl,{type:(e==null?void 0:e.node_type)||""})}):null,e!=null&&e.name?e==null?void 0:e.name:M.jsx(Jf,{rounded:u,size:f?60:52,src:(e==null?void 0:e.image_url)||"audio_default.svg",type:e==null?void 0:e.node_type})]})})}):null},Wd=E.memo(()=>{const{simulation:n,showSelectionGraph:e,selectedNode:t,selectionGraphData:s}=nt(ec(o=>o)),i=Eo(),r=E.useMemo(()=>{const o=(n==null?void 0:n.nodes())||[];return(e?s.nodes:o).filter(u=>i.includes((u==null?void 0:u.ref_id)||"")||(t==null?void 0:t.ref_id)===(u==null?void 0:u.ref_id)).slice(0,Ux).map(u=>{const h=fu(u.node_type||"",!0),f=new X((u==null?void 0:u.x)||0,(u==null?void 0:u.y)||0,(u==null?void 0:u.z)||0),d=o.filter(m=>m.ref_id&&Lx(m,u)).map(m=>(m==null?void 0:m.ref_id)||"")||[];return M.jsx(dw,{color:h,position:f,relativeIds:d,userData:u},`node-badge-${u.ref_id}`)})},[n,e,s.nodes,i,t==null?void 0:t.ref_id]);return M.jsx(E.Fragment,{children:r.length?r:null},"node-badges")});Wd.displayName="RelevanceBadges";const cu=tf().stop(),mt={numDimensions:3,velocityDecay:.9,forceChargeStrength:-20,forceChargeMinDistance:10,forceChargeMaxDistance:8e3,forceLinkStrength:.04,forceCenterStrength:.85,disableCollide:!1,disableCenter:!1,disableLink:!1,disableCharge:!1,forceCollideRadiusMethod:n=>(n.edge_count||1)*6+200,forceLinkDistanceMethod:n=>{const e=n.source.node_type;let t=50;switch(e){case"topic":t=30;break;case"guest":t=30;break;case"clip":t=10;break;case"episode":t=15;break}return t*2/50}},fw=(n,e,{numDimensions:t=mt.numDimensions,velocityDecay:s=mt.velocityDecay,forceChargeStrength:i=mt.forceChargeStrength,forceChargeMinDistance:r=mt.forceChargeMinDistance,forceChargeMaxDistance:o=mt.forceChargeMaxDistance,forceLinkStrength:a=mt.forceLinkStrength,forceCenterStrength:c=mt.forceCenterStrength,forceLinkDistanceMethod:l=mt.forceLinkDistanceMethod,forceCollideRadiusMethod:u=mt.forceCollideRadiusMethod,disableCollide:h=mt.disableCollide,disableCenter:f=mt.disableCenter,disableLink:d=mt.disableLink,disableCharge:m=mt.disableCharge})=>(cu.alpha(1).stop().numDimensions(t).velocityDecay(s).force("collide",h?null:sf().radius(u).iterations(1)).force("center",f?null:nf().strength(c)).force("charge",m?null:rf().strength(i).distanceMin(r).distanceMax(o)).nodes(n).force("link",d?null:of(e).id(p=>p.ref_id).distance(l).strength(a)).alpha(1).restart(),cu),pw=({link:n,animated:e})=>{const t=E.useRef(null),s=Jt(),[i,r]=E.useState(new X(0,0,0)),[o,a]=E.useState(new X(0,0,0)),[c,l]=E.useState(8947848),u=nt(h=>h.selectionGraphData);return E.useEffect(()=>{var d,m,p,_,v,T;const h=(s==null?void 0:s.ref_id)||"",f=s&&(h===n.target||h===n.source);!n.onlyVisibleOnSelect||f?(r(new X(((d=n.sourcePosition)==null?void 0:d.x)||0,((m=n.sourcePosition)==null?void 0:m.y)||0,((p=n.sourcePosition)==null?void 0:p.z)||0)),a(new X(((_=n.targetPosition)==null?void 0:_.x)||0,((v=n.targetPosition)==null?void 0:v.y)||0,((T=n.targetPosition)==null?void 0:T.z)||0))):(r(new X(0,0,0)),a(new X(0,0,0))),l(f?n.color||af.children.segmentColor:s?5592405:8947848)},[s,n]),Rt(()=>{if(e&&t.current){const h=u.nodes.find(d=>d.ref_id===n.source),f=u.nodes.find(d=>d.ref_id===n.target);t.current.start.set((h==null?void 0:h.x)||0,(h==null?void 0:h.y)||0,(h==null?void 0:h.z)||0),t.current.end.set((f==null?void 0:f.x)||0,(f==null?void 0:f.y)||0,(f==null?void 0:f.z)||0)}}),M.jsx(M.Fragment,{children:M.jsx(Rp,{ref:t,color:"0xFFFFFF",end:o,start:i})})},mw=({links:n,simulation:e})=>{const t=E.useRef(null);return E.useEffect(()=>function(){t.current&&t.current.clear()},[t]),Rt(()=>{if(t.current){const s=e.nodes();t.current.children.forEach((r,o)=>{var u;const a=n[o],c=s.find(h=>a.source===h.ref_id),l=s.find(h=>a.target===h.ref_id);(u=r.position)==null||u.set((c.x+l.x)/2,(c.y+l.y)/2,(c.z+l.z)/2)})}}),n.length?M.jsx("group",{ref:t,children:n.map(s=>M.jsx("mesh",{children:M.jsx(dr,{center:!0,sprite:!0,children:M.jsxs(_w,{direction:"row",justify:"center",onClick:i=>{i.stopPropagation()},onPointerOut:i=>{i.stopPropagation()},onPointerOver:i=>{i.stopPropagation()},children:[M.jsx("span",{children:s.edge_type}),M.jsx(xs,{className:"icon",children:M.jsx(rp,{})})]})})},s.ref_id))}):null},_w=Le(xs)`
  text-align: center;

  outline-offset: 0px;
  background: rgba(0, 0, 0, 0.75);
  color: #eee;
  cursor: pointer;
  transition: font-size 0.4s, outline 0.4s;
  align-items: center;
  justify-content: center;
  font-family: Barlow;
  font-size: 12px;
  font-style: normal;
  font-weight: 700;
  text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);

  &:hover {
    outline-offset: 4px;
    span {
      opacity: 0.1;
    }

    .icon {
      display: flex;
    }
  }

  .icon {
    position: absolute;
    width: 24px;
    height: 24px;
    /* bottom: 100%; */
    display: none;
    color: #000;
    border-radius: 40px;
    justify-content: center;
    align-items: center;
    background: #ffffff;
    color: #000;
    border-radius: 100%;
    font-size: 16px;
    cursor: pointer;
    transition: opacity 0.4s;
    box-shadow: 0px 2px 12px rgba(0, 0, 0, 0.5);
  }

  .badge-wrapper {
    position: absolute;
    top: -7px;
    left: -14px;
  }
`,gw=["#fff","#9747FF","#00887A","#0098A6","#0288D1","#33691E","#465A65","#512DA7","#5C6BC0","#5D4038","#662C00","#689F39","#6B1B00","#750000","#78909C","#7E57C2","#8C6E63","#AA47BC","#BF360C","#C2175B","#EC407A","#EF6C00","#F5511E","#FF9696","#FFC064","#FFCD29","#FFEA60"];function vw(n){return n.replace(/[\u{1F600}-\u{1F64F}\u{1F300}-\u{1F5FF}\u{1F680}-\u{1F6FF}\u{1F700}-\u{1F77F}\u{1F780}-\u{1F7FF}\u{1F800}-\u{1F8FF}\u{1F900}-\u{1F9FF}\u{1FA00}-\u{1FA6F}\u{1FA70}-\u{1FAFF}\u{1FB00}-\u{1FBFF}\u{1FC00}-\u{1FCFF}\u{1FD00}-\u{1FDFF}\u{1FE00}-\u{1FEFF}\u{1FF00}-\u{1FFFF}\u{20000}-\u{2A6DF}\u{2A700}-\u{2B73F}\u{2B740}-\u{2B81F}\u{2B820}-\u{2CEAF}\u{2F800}-\u{2FA1F}]/gu,"")}function yw(n){const e=pu(n,30),t=e.split(" ");if(n.split(" ").length<=5)return e;const s=Math.ceil(t.length/3),i=s*2,r=t.slice(0,s).join(" "),o=t.slice(s,i).join(" "),a=t.slice(i).join(" ");return`${r}
${o}
${a}`}const Kc=E.memo(({node:n,hide:e})=>{const t=E.useRef(null),s=Jt(),i=cf(),o=Eo().includes((n==null?void 0:n.ref_id)||""),a=!!s&&(s==null?void 0:s.ref_id)===n.ref_id,c=!!i&&(i==null?void 0:i.ref_id)===n.ref_id,l=nt(v=>v.showSelectionGraph),[u]=ep(v=>[v.getPrimaryColorByType]),h=lf();Rt(({camera:v})=>{t!=null&&t.current&&t.current.quaternion.copy(v.quaternion)});const f=E.useMemo(()=>{let v=(n.edge_count||1)*20;l&&a?v=40:!a&&o&&(v=0);const T=v/Math.sqrt(n.name.length);return v=Math.max(T,20),Math.min(v,30)},[n.edge_count,n.name,a,o,l]),d=E.useMemo(()=>s&&!a||i&&!c?.2:1,[a,s,c,i]),p=u(n.node_type)??(gw[h.indexOf(n.node_type)]||pe.white),_=vw(String(n.name));return M.jsx(M.Fragment,{children:M.jsx(wf,{ref:t,anchorX:"center",anchorY:"middle",color:p,fillOpacity:d,scale:f,userData:n,visible:!e,...kf,children:yw(_)})})});Kc.displayName="TextNode";const Gd=E.memo(()=>{const[n,e]=E.useState(null),{dataInitial:t}=xn(l=>l),s=Jt(),i=E.useRef(null),r=Eo(),o=Sf(t==null?void 0:t.nodes.length),{selectionGraphData:a,setSelectionData:c}=nt(ec(l=>l));return E.useEffect(()=>{const l=structuredClone((t==null?void 0:t.nodes)||[]),u=structuredClone((t==null?void 0:t.links)||[]);if(o===l.length)return;const h=l.filter(f=>f.ref_id===(s==null?void 0:s.ref_id)||r.includes((f==null?void 0:f.ref_id)||"")).map(f=>{const d=f.ref_id===(s==null?void 0:s.ref_id)?{fx:0,fy:0,fz:0}:{};return{...f,x:0,y:0,z:0,...d}});if(h){const f=u.filter(d=>h.some(m=>m.ref_id===d.target)&&h.some(m=>m.ref_id===d.source));c({nodes:h,links:f})}},[t,s,r,c,o]),E.useEffect(()=>{if(n||!a.nodes.length)return;const l=structuredClone(a.links),u=fw(a.nodes,l,{numDimensions:2,forceLinkStrength:.01,forceCenterStrength:.85,forceChargeStrength:-20,velocityDecay:.9});e(u)},[a,n]),E.useEffect(()=>()=>{c({nodes:[],links:[]})},[c]),E.useEffect(()=>{n&&n.on("tick",()=>{i.current&&i.current.children.forEach((u,h)=>{const f=n.nodes()[h];f&&u.position.set(f.x,f.y,f.z)})})},[n]),console.log(a.nodes),M.jsxs(M.Fragment,{children:[M.jsx("group",{ref:i,name:"simulation-2d-group",children:a==null?void 0:a.nodes.map(l=>M.jsx("mesh",{children:l.name?M.jsx(Kc,{hide:!0,node:l},l.ref_id||l.id):M.jsx(Qc,{hide:!0,node:l},l.ref_id||l.id)},l.ref_id))}),M.jsx(Mp,{fog:!0,lineWidth:.9,children:(a==null?void 0:a.links).map((l,u)=>M.jsx(pw,{animated:!0,link:l},u.toString()))},`selection-links-${a==null?void 0:a.links.length}`),n&&M.jsx(mw,{links:a.links,simulation:n})]})});Gd.displayName="SelectionDataNodes";const xw=200,Yd=E.memo(()=>{const n=Jt(),e=Eo(),{selectionGraphData:t,showSelectionGraph:s,setHoveredNode:i,setIsHovering:r}=nt(m=>m),o=xn(m=>m.dataInitial),a=hr(m=>m.setTranscriptOpen),c=E.useCallback(m=>!!(s&&!t.nodes.find(p=>p.ref_id===m.ref_id)),[s,t]),l=E.useCallback(m=>{const p=m==null?void 0:m[0];p&&(a(!1),p.userData&&(c(p.userData)||nt.getState().setSelectedNode((p==null?void 0:p.userData)||null)))},[a,c]),u=E.useRef(null),h=E.useCallback(m=>{m.stopPropagation(),r(!1),i(null),u.current&&(clearTimeout(u.current),u.current=null)},[r,i]),f=E.useCallback(m=>{var v;const _=m.intersections.map(T=>T.object)[0];if((v=_==null?void 0:_.userData)!=null&&v.ref_id){const T=_.userData;c(T)||(m.stopPropagation(),r(!0),u.current=setTimeout(()=>{i(T)},xw))}},[i,c,r]),d=s&&!!n;return M.jsxs(Sp,{filter:m=>m.filter(p=>{var _;return!!((_=p.userData)!=null&&_.ref_id)}),onChange:l,onPointerOut:h,onPointerOver:f,children:[!1,M.jsx(Wd,{}),M.jsx("group",{name:"simulation-3d-group__nodes",children:o==null?void 0:o.nodes.map(m=>{const p=!!n&&(e.includes(m.ref_id)||n.ref_id===m.ref_id);return M.jsx("mesh",{children:m.name?M.jsx(Kc,{hide:d||p,node:m},m.ref_id||m.id):M.jsx(Qc,{hide:d,node:m},m.ref_id||m.id)},m.ref_id)})}),d&&M.jsx(Gd,{})]})});Yd.displayName="Cubes";const Tw={earthRef:null},ww=uu(n=>({...Tw,setEarthRef:e=>n({earthRef:e})})),kw=new X(0,0,0),Sw=()=>{const n=E.useRef(null),e=E.useRef(null),{graphStyle:t,showSelectionGraph:s}=nt(a=>a),i=ww(a=>a.setEarthRef),r=on("textures/earth/galaxy.png"),o=on("textures/earth/clouds.png");return Rt(({camera:a})=>{e.current&&e.current.position.copy(a.getWorldPosition(kw))}),E.useLayoutEffect(()=>{n.current&&i(n)},[i]),t!=="earth"||s?null:M.jsxs(M.Fragment,{children:[M.jsxs("mesh",{ref:n,userData:{type:"earth"},children:[M.jsx("sphereGeometry",{args:[zr,200,200]}),M.jsx(Cw,{})]}),M.jsxs("mesh",{children:[M.jsx("sphereGeometry",{args:[zr+2,200,200]}),M.jsx("meshStandardMaterial",{alphaMap:o,map:o,transparent:!0})]}),M.jsxs("mesh",{children:[M.jsx("sphereGeometry",{args:[zr*4,200,200]}),M.jsx("meshStandardMaterial",{map:r,opacity:.4,side:Mi,transparent:!0})]}),M.jsx("directionalLight",{ref:e,intensity:.9,position:[0,0,zr*3]})]})},Cw=()=>{const n=on("textures/earth/earth.jpeg"),e=on("textures/earth/bump.jpeg"),t=on("textures/earth/water.png"),s=E.useMemo(()=>new fr({map:n,bumpMap:e,aoMap:e,roughnessMap:e,metalnessMap:t,toneMapped:!0,roughness:35,metalness:0}),[n,e,t]);return M.jsx("meshStandardMaterial",{...s})},bw="C",Ew=256,Ow=256,Aw={g:"LottieFiles AE 0.1.20"},Mw=[{ty:0,nm:"I",sr:1,st:0,op:26,ip:0,hasMask:!1,ao:0,ks:{a:{a:0,k:[128,128,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[128,128,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],w:256,h:256,refId:"comp_0",ind:1},{ty:0,nm:"I",sr:1,st:26,op:52,ip:26,hasMask:!1,ao:0,ks:{a:{a:0,k:[128,128,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[128,128,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],w:256,h:256,refId:"comp_1",ind:2},{ty:0,nm:"I",sr:1,st:52,op:78,ip:52,hasMask:!1,ao:0,ks:{a:{a:0,k:[128,128,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[128,128,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],w:256,h:256,refId:"comp_2",ind:3},{ty:0,nm:"I",sr:1,st:78,op:108,ip:78,hasMask:!1,ao:0,ks:{a:{a:0,k:[128,128,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[128,128,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],w:256,h:256,refId:"comp_3",ind:4}],Dw="5.5.7",Rw=60,Pw=104,Iw=0,Nw=[{nm:"",id:"comp_0",layers:[{ty:4,nm:"I",sr:1,st:0,op:30,ip:0,hasMask:!1,ao:0,ks:{a:{a:0,k:[44.641,50,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[128,128,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],shapes:[{ty:"gr",nm:"T",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[0,20],[-34.641,0],[0,-20],[34.641,0]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[34.656,.016],[0,20],[-34.641,0],[.016,-19.984]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[44.641,30]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]},{ty:"gr",nm:"S",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.32,30],[-17.32,10],[-17.32,-30],[17.32,-10]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[51.962,10],[17.321,30],[17.321,-10],[51.962,-30]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[27.32,60]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]},{ty:"gr",nm:"F",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.321,10],[-17.321,30],[-17.321,-10],[17.321,-30]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-17.32,-9.984],[17.32,10],[17.32,-30],[-17.32,-50.016]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[61.962,60]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]},{ty:"gr",nm:"F",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.32,10],[-17.32,30],[-17.32,-10],[17.32,-30]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-17.32,30],[17.32,50],[17.305,10],[-17.32,-10]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[27.32,40]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]},{ty:"gr",nm:"S",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.321,30],[-17.321,10],[-17.321,-30],[17.321,-10]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-17.321,10],[-51.962,30],[-51.962,-10],[-17.321,-30]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[61.962,40]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]},{ty:"gr",nm:"T",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[0,20],[-34.641,0],[0,-20],[34.641,0]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[34.641,0],[0,20],[-34.641,0],[0,-20]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[44.641,70]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]}],ind:1}]},{nm:"",id:"comp_1",layers:[{ty:4,nm:"R",sr:1,st:0,op:30,ip:0,hasMask:!1,ao:0,ks:{a:{a:0,k:[0,0,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[128,128,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:0}},ef:[],shapes:[],ind:1},{ty:4,nm:"S",sr:1,st:-20,op:32,ip:13,hasMask:!1,ao:0,ks:{a:{a:0,k:[44.641,50,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[0,0,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],shapes:[{ty:"gr",nm:"S",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.32,30],[-17.32,10],[-17.32,-30],[17.32,-10]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.32,-10.016],[-17.32,-30],[17.32,-50],[51.961,-30]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[27.32,60]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]}],ind:2,parent:1},{ty:4,nm:"T",sr:1,st:-20,op:13,ip:0,hasMask:!1,ao:0,ks:{a:{a:0,k:[44.641,50,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[0,0,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],shapes:[{ty:"gr",nm:"T",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[0,20],[-34.641,0],[0,-20],[34.641,0]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[34.641,0],[.015,-20],[0,20],[34.641,40]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[44.641,30]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]}],ind:3,parent:1},{ty:4,nm:"S",sr:1,st:-20,op:13,ip:0,hasMask:!1,ao:0,ks:{a:{a:0,k:[44.641,50,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[0,0,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],shapes:[{ty:"gr",nm:"S",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.32,30],[-17.32,10],[-17.32,-30],[17.32,-10]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.32,-10.016],[-17.32,-30],[17.32,-50],[51.961,-30]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[27.32,60]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]}],ind:4,parent:1},{ty:4,nm:"F",sr:1,st:-20,op:33,ip:13,hasMask:!1,ao:0,ks:{a:{a:0,k:[44.641,50,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[0,0,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],shapes:[{ty:"gr",nm:"F",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.321,10],[-17.321,30],[-17.321,-10],[17.321,-30]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-17.324,30],[-17.34,-9.984],[17.336,-30.016],[17.336,10]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[61.962,60]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]}],ind:5,parent:1},{ty:4,nm:"T",sr:1,st:-20,op:35,ip:13,hasMask:!1,ao:0,ks:{a:{a:0,k:[44.641,50,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[0,0,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],shapes:[{ty:"gr",nm:"T",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[0,20],[-34.641,0],[0,-20],[34.641,0]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[34.641,0],[.015,-20],[0,20],[34.641,40]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[44.641,30]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]}],ind:6,parent:1},{ty:4,nm:"F",sr:1,st:-20,op:13,ip:0,hasMask:!1,ao:0,ks:{a:{a:0,k:[44.641,50,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[0,0,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],shapes:[{ty:"gr",nm:"F",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.321,10],[-17.321,30],[-17.321,-10],[17.321,-30]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-17.324,30],[-17.34,-9.984],[17.336,-30.016],[17.336,10]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[61.962,60]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]}],ind:7,parent:1},{ty:4,nm:"F",sr:1,st:-20,op:13,ip:0,hasMask:!1,ao:0,ks:{a:{a:0,k:[44.641,50,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[0,0,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],shapes:[{ty:"gr",nm:"F",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.32,10],[-17.32,30],[-17.32,-10],[17.32,-30]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-17.305,30],[-17.336,-9.984],[17.336,-30.016],[17.32,10]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[27.32,40]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]}],ind:8,parent:1},{ty:4,nm:"T",sr:1,st:-20,op:32,ip:13,hasMask:!1,ao:0,ks:{a:{a:0,k:[44.641,50,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[0,0,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],shapes:[{ty:"gr",nm:"T",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[0,20],[-34.641,0],[0,-20],[34.641,0]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[.016,-20.016],[-34.643,-40],[-34.641,.016],[0,20]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[44.641,70]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]}],ind:9,parent:1},{ty:4,nm:"S",sr:1,st:-20,op:31,ip:13,hasMask:!1,ao:0,ks:{a:{a:0,k:[44.641,50,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[0,0,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],shapes:[{ty:"gr",nm:"S",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.321,-10],[17.321,30],[-17.321,10],[-17.321,-30]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.321,30],[-17.305,50],[-51.961,30],[-17.321,10]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[61.962,40]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]}],ind:10,parent:1},{ty:4,nm:"F",sr:1,st:-20,op:34,ip:13,hasMask:!1,ao:0,ks:{a:{a:0,k:[44.641,50,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[0,0,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],shapes:[{ty:"gr",nm:"F",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.32,10],[-17.32,30],[-17.32,-10],[17.32,-30]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-17.305,30],[-17.336,-9.984],[17.336,-30.016],[17.32,10]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[27.32,40]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]}],ind:11,parent:1},{ty:4,nm:"S",sr:1,st:-20,op:13,ip:0,hasMask:!1,ao:0,ks:{a:{a:0,k:[44.641,50,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[0,0,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],shapes:[{ty:"gr",nm:"S",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.321,-10],[17.321,30],[-17.321,10],[-17.321,-30]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.321,30],[-17.305,50],[-51.961,30],[-17.321,10]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[61.962,40]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]}],ind:12,parent:1},{ty:4,nm:"T",sr:1,st:-20,op:13,ip:0,hasMask:!1,ao:0,ks:{a:{a:0,k:[44.641,50,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[0,0,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],shapes:[{ty:"gr",nm:"T",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[0,20],[-34.641,0],[0,-20],[34.641,0]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[.016,-20.016],[-34.643,-40],[-34.641,.016],[0,20]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[44.641,70]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]}],ind:13,parent:1}]},{nm:"",id:"comp_2",layers:[{ty:4,nm:"R",sr:1,st:0,op:30,ip:0,hasMask:!1,ao:0,ks:{a:{a:0,k:[0,0,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[128,128,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:0}},ef:[],shapes:[],ind:1},{ty:4,nm:"T",sr:1,st:0,op:30,ip:0,hasMask:!1,ao:0,ks:{a:{a:0,k:[44.641,50,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[0,0,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],shapes:[{ty:"gr",nm:"T",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[0,20],[-34.641,0],[0,-20],[34.641,0]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-34.656,.031],[.047,-19.969],[34.652,.031],[0,20]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[44.641,30]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]}],ind:2,parent:1},{ty:4,nm:"S",sr:1,st:0,op:13,ip:0,hasMask:!1,ao:0,ks:{a:{a:0,k:[44.641,50,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[0,0,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],shapes:[{ty:"gr",nm:"S",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.32,30],[-17.32,10],[-17.32,-30],[17.32,-10]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-17.32,10],[17.32,-9.984],[17.32,-50],[-17.32,-30]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[27.32,60]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]}],ind:3,parent:1},{ty:4,nm:"F",sr:1,st:0,op:30,ip:0,hasMask:!1,ao:0,ks:{a:{a:0,k:[44.641,50,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[0,0,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],shapes:[{ty:"gr",nm:"F",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.321,10],[-17.321,30],[-17.321,-10],[17.321,-30]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-17.321,30],[-51.962,10],[-51.962,-30],[-17.321,-10]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[61.962,60]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]}],ind:4,parent:1},{ty:4,nm:"S",sr:1,st:0,op:30,ip:13,hasMask:!1,ao:0,ks:{a:{a:0,k:[44.641,50,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[0,0,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],shapes:[{ty:"gr",nm:"S",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.32,30],[-17.32,10],[-17.32,-30],[17.32,-10]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-17.32,10],[17.32,-9.984],[17.32,-50],[-17.32,-30]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[27.32,60]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]}],ind:5,parent:1},{ty:4,nm:"F",sr:1,st:0,op:13,ip:0,hasMask:!1,ao:0,ks:{a:{a:0,k:[44.641,50,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[0,0,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],shapes:[{ty:"gr",nm:"F",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.32,10],[-17.32,30],[-17.32,-10],[17.32,-30]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[51.962,30],[17.321,10],[17.321,-30],[51.962,-10]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[27.32,40]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]}],ind:6,parent:1},{ty:4,nm:"S",sr:1,st:0,op:30,ip:0,hasMask:!1,ao:0,ks:{a:{a:0,k:[44.641,50,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[0,0,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],shapes:[{ty:"gr",nm:"S",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.321,30],[-17.321,10],[-17.321,-30],[17.321,-10]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-17.32,50],[17.32,30],[17.336,-10],[-17.336,10]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[61.962,40]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]}],ind:7,parent:1},{ty:4,nm:"F",sr:1,st:0,op:30,ip:13,hasMask:!1,ao:0,ks:{a:{a:0,k:[44.641,50,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[0,0,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],shapes:[{ty:"gr",nm:"F",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.32,10],[-17.32,30],[-17.32,-10],[17.32,-30]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[51.962,30],[17.321,10],[17.321,-30],[51.962,-10]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[27.32,40]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]}],ind:8,parent:1},{ty:4,nm:"T",sr:1,st:0,op:30,ip:0,hasMask:!1,ao:0,ks:{a:{a:0,k:[44.641,50,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[0,0,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],shapes:[{ty:"gr",nm:"T",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[0,20],[-34.641,0],[0,-20],[34.641,0]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-34.656,0],[.015,-20],[34.656,0],[.012,20.062]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[44.641,70]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]}],ind:9,parent:1}]},{nm:"",id:"comp_3",layers:[{ty:4,nm:"R",sr:1,st:0,op:30,ip:0,hasMask:!1,ao:0,ks:{a:{a:0,k:[0,0,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[128,128,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:0}},ef:[],shapes:[],ind:1},{ty:4,nm:"S",sr:1,st:0,op:32,ip:13,hasMask:!1,ao:0,ks:{a:{a:0,k:[44.641,50,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[0,0,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],shapes:[{ty:"gr",nm:"S",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.321,30],[-17.321,10],[-17.321,-30],[17.321,-10]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.336,-10],[-17.32,-30.016],[-51.961,-10],[-17.305,10]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[61.962,40]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]}],ind:2,parent:1},{ty:4,nm:"T",sr:1,st:0,op:32,ip:0,hasMask:!1,ao:0,ks:{a:{a:0,k:[44.641,50,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[0,0,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],shapes:[{ty:"gr",nm:"T",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[0,20],[-34.641,0],[0,-20],[34.641,0]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[.015,60.016],[-34.642,40],[-34.641,0],[0,20]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[44.641,30]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]}],ind:3,parent:1},{ty:4,nm:"S",sr:1,st:0,op:13,ip:0,hasMask:!1,ao:0,ks:{a:{a:0,k:[44.641,50,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[0,0,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],shapes:[{ty:"gr",nm:"S",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-17.32,10],[-17.32,-30],[17.32,-10],[17.32,30]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.312,-10],[-17.313,10],[17.332,30],[51.977,10]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[27.32,60]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]}],ind:4,parent:1},{ty:4,nm:"F",sr:1,st:0,op:32,ip:0,hasMask:!1,ao:0,ks:{a:{a:0,k:[44.641,50,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[0,0,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],shapes:[{ty:"gr",nm:"F",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.321,10],[-17.321,30],[-17.321,-10],[17.321,-30]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.336,-29.984],[17.348,10],[-17.305,30],[-17.305,-9.984]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[61.962,60]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]}],ind:5,parent:1},{ty:4,nm:"F",sr:1,st:0,op:13,ip:0,hasMask:!1,ao:0,ks:{a:{a:0,k:[44.641,50,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[0,0,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],shapes:[{ty:"gr",nm:"F",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.32,10],[-17.32,30],[-17.32,-10],[17.32,-30]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.336,-30],[17.32,10],[-17.32,30],[-17.336,-10]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[27.32,40]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]}],ind:6,parent:1},{ty:4,nm:"S",sr:1,st:0,op:13,ip:0,hasMask:!1,ao:0,ks:{a:{a:0,k:[44.641,50,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[0,0,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],shapes:[{ty:"gr",nm:"S",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.321,30],[-17.321,10],[-17.321,-30],[17.321,-10]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.336,-10],[-17.32,-30.016],[-51.961,-10],[-17.305,10]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[61.962,40]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]}],ind:7,parent:1},{ty:4,nm:"T",sr:1,st:0,op:32,ip:0,hasMask:!1,ao:0,ks:{a:{a:0,k:[44.641,50,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[0,0,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],shapes:[{ty:"gr",nm:"T",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[0,20],[-34.641,0],[0,-20],[34.641,0]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[34.641,0],[0,-20],[0,-60.016],[34.641,-40]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[44.641,70]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]}],ind:8,parent:1},{ty:4,nm:"S",sr:1,st:0,op:32,ip:13,hasMask:!1,ao:0,ks:{a:{a:0,k:[44.641,50,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[0,0,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],shapes:[{ty:"gr",nm:"S",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-17.32,10],[-17.32,-30],[17.32,-10],[17.32,30]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.312,-10],[-17.313,10],[17.332,30],[51.977,10]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[27.32,60]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]}],ind:9,parent:1},{ty:4,nm:"F",sr:1,st:0,op:32,ip:13,hasMask:!1,ao:0,ks:{a:{a:0,k:[44.641,50,0]},s:{a:0,k:[100,100,100]},sk:{a:0,k:0},p:{a:0,k:[0,0,0]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}},ef:[],shapes:[{ty:"gr",nm:"F",it:[{ty:"sh",nm:"P",d:1,ks:{a:1,k:[{o:{x:.8,y:0},i:{x:.2,y:1},s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.32,10],[-17.32,30],[-17.32,-10],[17.32,-30]]}],t:0},{s:[{c:!0,i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[17.336,-30],[17.32,10],[-17.32,30],[-17.336,-10]]}],t:26}]}},{ty:"st",nm:"S",lc:1,lj:2,ml:1,o:{a:0,k:100},w:{a:0,k:4},c:{a:0,k:[1,1,1]}},{ty:"tr",a:{a:0,k:[0,0]},s:{a:0,k:[100,100]},sk:{a:0,k:0},p:{a:0,k:[27.32,40]},r:{a:0,k:0},sa:{a:0,k:0},o:{a:0,k:100}}]}],ind:10,parent:1}]}],Fw={nm:bw,h:Ew,w:Ow,meta:Aw,layers:Mw,v:Dw,fr:Rw,op:Pw,ip:Iw,assets:Nw},Uw=({meshId:n})=>{const e=E.useRef(null);return E.useEffect(()=>{const t=document.getElementById(`lottie-animation-${n}`);return t&&(e.current=uf.loadAnimation({container:t,animationData:Fw,loop:!0,autoplay:!0})),()=>{e.current&&e.current.destroy()}},[n]),M.jsx("div",{id:`lottie-animation-${n}`,style:{width:"2em",height:"2em"}})},ya=()=>Math.floor(Math.random()*2001)-1e3,Lw=()=>M.jsx(M.Fragment,{children:["a","b","c"].map(n=>{const e=ya(),t=ya(),s=ya();return M.jsx("mesh",{position:[e,t,s],children:M.jsx(dr,{center:!0,sprite:!0,children:M.jsx(Bw,{children:M.jsx(Uw,{meshId:n})})})},n)})}),Bw=Le.div`
  border: 2px solid white;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 20px;
`;Object.values(Cf).map(n=>n);const Ai=n=>({close:{backgroundColor:"rgba(48, 51, 66, 1)",borderColor:"#fff",fontColor:"rgba(255, 255, 255, 1)"},focus:{backgroundColor:n?"rgba(255, 255, 255, 0.90);":"rgba(255, 255, 255, 0.90)",borderColor:n?"#FFDB58bb":"#fff",fontColor:"rgba(48, 51, 66, 1)"},menu:{backgroundColor:"#00000066",borderColor:n?"#ffffff66":"#5078f2",fontColor:n?"#ffffff66":"#fff"}}),zw=new X,Zd=E.memo(()=>{var k;const n=E.useRef(null),e=hr(x=>x.setSidebarOpen),[t,s]=$r.useState(null),{open:i}=Cr("editNodeName"),{open:r}=Cr("addEdgeToNode"),{open:o}=Cr("mergeToNode"),{open:a}=Cr("createBounty"),[c]=hu(x=>[x.isAdmin]),[l]=xn(x=>[x.addNewNode]),u=Jt(),{showSelectionGraph:h,selectionGraphData:f,setSelectedNode:d,setShowSelectionGraph:m}=nt(x=>x),p=cp(),_=E.useCallback(async()=>{try{if(u!=null&&u.ref_id){const x=await hf(u==null?void 0:u.ref_id,f.nodes.length||0);x&&l(x)}}catch(x){console.log(x)}},[l,u==null?void 0:u.ref_id,f.nodes.length]);Rt(()=>{v()});const v=E.useCallback(()=>{const x=h?f:p;if(n.current){const C=x==null?void 0:x.nodes.find(b=>b.ref_id===(u==null?void 0:u.ref_id));if(C){const b=zw.set(C==null?void 0:C.x,C==null?void 0:C.y,C==null?void 0:C.z);n.current.position.copy(b)}}},[u,h,f,p]),T=E.useMemo(()=>{const x=c?[{key:"control-key-1",colors:Ai(h).focus,icon:M.jsx(dp,{}),left:-80,className:"add",onClick:b=>{s(b.currentTarget)}},{key:"control-key-2",colors:Ai(h).focus,icon:M.jsx(hp,{}),left:-40,className:"edit",onClick:()=>{i()}}]:[],C=[{key:"control-key-4",colors:Ai(h).focus,icon:M.jsx(op,{}),left:0,className:"expand",onClick:()=>{const b=!h;m(b),b&&e(!0)}},{key:"control-key-5",colors:Ai(!0).close,icon:M.jsx(df,{}),left:40,className:"exit",onClick:()=>{_()}},{key:"control-key-6",colors:Ai(!0).close,icon:M.jsx(ap,{}),left:40,className:"exit",onClick:()=>{m(!1),d(null)}}];return[...x,...C].map((b,O)=>({...b,left:-80+O*40}))},[c,h,i,m,e,_,d]);if(!u)return null;const S=()=>{s(null)},y=!!t,g=y?"simple-popover":void 0,w=!!(u&&((k=u==null?void 0:u.node_type)==null?void 0:k.toLowerCase())==="function");return M.jsx("group",{ref:n,children:M.jsxs(dr,{center:!0,className:"control-panel",onClick:x=>x.stopPropagation(),onKeyDown:x=>x.stopPropagation(),onPointerDown:x=>x.stopPropagation(),onPointerOut:x=>x.stopPropagation(),onPointerOver:x=>x.stopPropagation(),onPointerUp:x=>x.stopPropagation(),sprite:!0,zIndexRange:[16777271,16777272],children:[T.map(x=>M.jsx(Vw,{backgroundColor:x.colors.backgroundColor,borderColor:x.colors.borderColor,className:x.className,fontColor:x.colors.fontColor,left:x.left,onClick:C=>{C.stopPropagation(),x.onClick(C)},children:x.icon},x.key)),w&&M.jsx(Hw,{left:2,onClick:()=>{a()},children:"Create Test"}),M.jsxs(jw,{anchorEl:t,anchorOrigin:{vertical:"bottom",horizontal:"right"},id:g,onClose:S,open:y,transformOrigin:{vertical:"top",horizontal:"right"},children:[M.jsxs(lu,{"data-testid":"merge",onClick:()=>{o(),S()},children:[M.jsx(lp,{"data-testid":"MergeIcon"})," Merge"]}),M.jsxs(lu,{"data-testid":"add_edge",onClick:()=>{r(),S()},children:[M.jsx(up,{"data-testid":"AddCircleIcon"})," Add edge"]})]})]})})});Zd.displayName="NodeControls";const Vw=Le.div`
  position: fixed;
  top: -60px;
  left: ${n=>-7+n.left}px;
  width: 24px;
  height: 24px;

  border-radius: 40px;
  display: flex;
  justify-content: center;
  align-items: center;
  background: ${n=>n.backgroundColor?n.backgroundColor:"#000000bb"};
  color: ${n=>n.fontColor?n.fontColor:"#ffffff"};
  border-radius: 100%;
  font-size: 16px;
  cursor: pointer;
  transition: opacity 0.4s;
  box-shadow: 0px 2px 12px rgba(0, 0, 0, 0.5);
`,lu=Le(xs).attrs({direction:"row",px:12,py:8})`
  display: flex;
  align-items: center;
  justify-content: start;
  gap: 12px;
  cursor: pointer;
  background: ${pe.BUTTON1};
  color: ${pe.white};

  &:hover {
    background: ${pe.BUTTON1_HOVER};
    color: ${pe.GRAY3};
  }
`,jw=Le(tp)`
  && {
    z-index: 9999;
  }
  .MuiPaper-root {
    min-width: 149px;
    color: ${pe.GRAY3};
    box-shadow: 0px 1px 6px 0px rgba(0, 0, 0, 0.2);
    border-radius: 6px;
    z-index: 1;
    font-family: Barlow;
    font-size: 14px;
    font-weight: 500;
  }
`,Hw=Le.div`
  position: fixed;
  top: 40px;
  left: ${n=>-53+n.left}px;
  width: 100px;
  padding: 6px;
  border-radius: 4px;
  display: flex;
  justify-content: center;
  align-items: center;
  background: ${pe.createTestButton};
  color: ${pe.black};
  font-size: 14px;
  font-family: Barlow;
  font-weight: 600;
  cursor: pointer;
  &:hover {
    transform: scale(1.05);
  }
`,$d=E.memo(()=>M.jsx(M.Fragment,{children:M.jsx(Zd,{})}));$d.displayName="NodeDetailsPanel";const qw=()=>{const{dataInitial:n,isLoadingNew:e,isFetching:t,dataNew:s,resetDataNew:i}=xn(d=>d),r=E.useRef(null),o=E.useRef([]),{setData:a,simulation:c,simulationCreate:l,simulationHelpers:u,graphStyle:h,setGraphRadius:f}=nt(d=>d);return E.useEffect(()=>{if(!s)return;const d=s.nodes||[],m=s.links||[],p=structuredClone(d),_=structuredClone(m);if(c){const v=ff.isEqual(s,n);u.addNodesAndLinks(p,_,v)}c||l(p,_),i()},[a,s,c,l,i,u,n]),E.useEffect(()=>{c&&u.setForces()},[h,u,c]),E.useEffect(()=>{c&&(c.on("tick",()=>{if(r.current){const d=r.current.getObjectByName("simulation-3d-group__nodes"),m=r.current.getObjectByName("simulation-3d-group__connections");d.children.forEach((p,_)=>{const v=c.nodes()[_];v&&p.position.set(v.x,v.y,v.z)}),m.children.forEach((p,_)=>{const v=n==null?void 0:n.links[_],T=p;if(v){const S=c.nodes().find(A=>A.ref_id===v.source),y=c.nodes().find(A=>A.ref_id===v.target),{x:g,y:w,z:k}=S,{x,y:C,z:b}=y;o.current[_]={sx:g,sy:w,sz:k,tx:x,ty:C,tz:b},T.geometry.setPositions([g,w,k,x,C,b]);const{material:O}=T;O.color=new hs("white"),O.transparent=!0,O.opacity=.1}})}}),c.on("end",()=>{const d=c.nodes().map(v=>new X(v.x,v.y,v.z)),m=new Qf().setFromPoints(d),p=new Kf;m.getBoundingSphere(p);const _=p.radius;f(_)}))},[n,c,f]),c?M.jsxs("group",{ref:r,children:[M.jsx(Yd,{}),M.jsx(Sw,{}),!1,(e||t)&&M.jsx(Lw,{}),h!=="earth"&&M.jsx(jd,{linksPositions:o.current}),M.jsx($d,{})]}):null},Ww=({fullSize:n=!0})=>{const e=hr(t=>t.sidebarIsOpen);return M.jsx(Gw,{align:"center",className:du({"sidebar-is-open":e&&!n}),justify:"center",children:M.jsx(fp,{color:pe.SECONDARY_BLUE,size:64})})},Gw=Le(xs)`
  position: absolute;
  left: 0;
  right: 0;
  bottom: 0;
  top: 0;
  background-color: ${pe.black};
  z-index: 1;
`,Yw=()=>M.jsx(dr,{children:M.jsx(yp,{})}),Zw=()=>{const{universeColor:n}=np("universe",{universeColor:pe.black}),e=Jt(),t=E.useMemo(()=>e!=null&&e.node_type?fu(e.node_type):Fx,[e]);return M.jsxs(M.Fragment,{children:[M.jsx("color",{args:[n],attach:"background"}),M.jsx(Of,{}),M.jsx(Wx,{}),M.jsxs(Fp,{children:[M.jsxs(_m,{autoClear:!1,multisampling:8,children:[M.jsx(xm,{darkness:.7,eskil:!1,offset:.05}),M.jsx(vm,{luminanceThreshold:1,mipmapBlur:!0,resolutionX:Oe.AUTO_SIZE,resolutionY:Oe.AUTO_SIZE}),M.jsx(ym,{blendFunction:ee.SCREEN,blur:!0,edgeStrength:4,hiddenEdgeColor:t,visibleEdgeColor:t})]}),M.jsx(qw,{})]})]})};let xa=null;const $w={aspect:window.innerWidth/window.innerHeight,far:3e4,near:1,position:[Pi.x,Pi.y,Pi.z]},Xw=()=>{const[n,e,t]=[Ns(a=>a.setIsUserScrollingOnHtmlPanel),Ns(a=>a.setIsUserScrolling),Ns(a=>a.setUserMovedCamera)],s=xn(a=>a.isFetching),i=hr(a=>a.universeQuestionIsOpen),r=E.useCallback(a=>{var u;const{target:c}=a,{offsetParent:l}=c;xa&&clearTimeout(xa),(u=l==null?void 0:l.classList)!=null&&u.contains("html-panel")&&l.clientHeight<l.scrollHeight&&n(!0),e(!0),t(!0),xa=setTimeout(()=>{e(!1),n(!1)},200)},[e,n,t]),o=E.useCallback(a=>pf(a,"threeState"),[]);return M.jsxs(Qw,{children:[M.jsx(E.Suspense,{fallback:null,children:M.jsxs(bf,{camera:$w,id:"universe-canvas",onCreated:o,onWheel:r,children:[mf&&M.jsx(Ef,{position:"bottom-right"}),M.jsxs(E.Suspense,{fallback:M.jsx(Yw,{}),children:[M.jsx(Pp,{}),M.jsx(Ip,{}),M.jsx(Np,{}),M.jsx(Zw,{})]})]})}),i&&M.jsx(Sm,{}),s&&M.jsx(Ww,{fullSize:!1}),M.jsx(sp,{})]})},Qw=Le(xs)`
  flex: 1 1 100%;
  position: relative;
`,Bk=E.memo(Xw);export{Bk as Universe};
