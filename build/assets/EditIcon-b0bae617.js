import{V as Ee,r as D,bt as sd,_ as co,aH as Ti,bh as Pl,bg as lo,bD as fr,bE as nd,bj as Fe,bF as id,al as As,bG as rd,bH as od,j as us,bd as ka,bI as Tt,bJ as Bn,bK as ad,bL as Jn,bM as fs,bN as cd,bO as ld,bP as ud,bQ as hd,bR as dd,bS as pr,bT as Jt,bU as fd,bV as X,bW as pd,bX as ys,bY as ta,bZ as Ra,bv as Dc,ap as md,b_ as Pr,b$ as _d,am as Nl,bx as Il,c0 as Fl,c1 as Ul,c2 as kc,c3 as gd,c4 as vd,aI as mr,H as sa,c5 as yd,$ as Td}from"./index-b17e6e7f.js";import{u as be,b as uo,e as Pa,h as xd,i as wd,j as Sd,m as bd,k as Cd}from"./constant-163649d8.js";import{_ as Ue,w as zt}from"./react-toastify.esm-ac6bd257.js";const er=new Ee,Na=new Ee,Ed=new Ee;function Od(n,e,t){const s=er.setFromMatrixPosition(n.matrixWorld);s.project(e);const i=t.width/2,r=t.height/2;return[s.x*i+i,-(s.y*r)+r]}function Ad(n,e){const t=er.setFromMatrixPosition(n.matrixWorld),s=Na.setFromMatrixPosition(e.matrixWorld),i=t.sub(s),r=e.getWorldDirection(Ed);return i.angleTo(r)>Math.PI/2}function Md(n,e,t,s){const i=er.setFromMatrixPosition(n.matrixWorld),r=i.clone();r.project(e),t.setFromCamera(r,e);const o=t.intersectObjects(s,!0);if(o.length){const a=o[0].distance;return i.distanceTo(t.ray.origin)<a}return!0}function Dd(n,e){if(e instanceof Pl)return e.zoom;if(e instanceof lo){const t=er.setFromMatrixPosition(n.matrixWorld),s=Na.setFromMatrixPosition(e.matrixWorld),i=e.fov*Math.PI/180,r=t.distanceTo(s);return 1/(2*Math.tan(i/2)*r)}else return 1}function kd(n,e,t){if(e instanceof lo||e instanceof Pl){const s=er.setFromMatrixPosition(n.matrixWorld),i=Na.setFromMatrixPosition(e.matrixWorld),r=s.distanceTo(i),o=(t[1]-t[0])/(e.far-e.near),a=t[1]-o*e.far;return Math.round(o*r+a)}}const na=n=>Math.abs(n)<1e-10?0:n;function Ll(n,e,t=""){let s="matrix3d(";for(let i=0;i!==16;i++)s+=na(e[i]*n.elements[i])+(i!==15?",":")");return t+s}const Rd=(n=>e=>Ll(e,n))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),Pd=(n=>(e,t)=>Ll(e,n(t),"translate(-50%,-50%)"))(n=>[1/n,1/n,1/n,1,-1/n,-1/n,-1/n,-1,1/n,1/n,1/n,1,1,1,1,1]);function Nd(n){return n&&typeof n=="object"&&"current"in n}const WT=D.forwardRef(({children:n,eps:e=.001,style:t,className:s,prepend:i,center:r,fullscreen:o,portal:a,distanceFactor:c,sprite:l=!1,transform:u=!1,occlude:h,onOcclude:d,castShadow:f,receiveShadow:m,material:p,geometry:_,zIndexRange:y=[16777271,0],calculatePosition:S=Od,as:b="div",wrapperClass:v,pointerEvents:g="auto",...T},x)=>{const{gl:w,camera:C,scene:E,size:O,raycaster:A,events:k,viewport:R}=be(),[P]=D.useState(()=>document.createElement(b)),F=D.useRef(),I=D.useRef(null),q=D.useRef(0),B=D.useRef([0,0]),V=D.useRef(null),H=D.useRef(null),L=(a==null?void 0:a.current)||k.connected||w.domElement.parentNode,se=D.useRef(null),ne=D.useRef(!1),W=D.useMemo(()=>h&&h!=="blending"||Array.isArray(h)&&h.length&&Nd(h[0]),[h]);D.useLayoutEffect(()=>{const Re=w.domElement;h&&h==="blending"?(Re.style.zIndex=`${Math.floor(y[0]/2)}`,Re.style.position="absolute",Re.style.pointerEvents="none"):(Re.style.zIndex=null,Re.style.position=null,Re.style.pointerEvents=null)},[h]),D.useLayoutEffect(()=>{if(I.current){const Re=F.current=sd(P);if(E.updateMatrixWorld(),u)P.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const ie=S(I.current,C,O);P.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${ie[0]}px,${ie[1]}px,0);transform-origin:0 0;`}return L&&(i?L.prepend(P):L.appendChild(P)),()=>{L&&L.removeChild(P),Re.unmount()}}},[L,u]),D.useLayoutEffect(()=>{v&&(P.className=v)},[v]);const ce=D.useMemo(()=>u?{position:"absolute",top:0,left:0,width:O.width,height:O.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:r?"translate3d(-50%,-50%,0)":"none",...o&&{top:-O.height/2,left:-O.width/2,width:O.width,height:O.height},...t},[t,r,o,O,u]),Ve=D.useMemo(()=>({position:"absolute",pointerEvents:g}),[g]);D.useLayoutEffect(()=>{if(ne.current=!1,u){var Re;(Re=F.current)==null||Re.render(D.createElement("div",{ref:V,style:ce},D.createElement("div",{ref:H,style:Ve},D.createElement("div",{ref:x,className:s,style:t,children:n}))))}else{var ie;(ie=F.current)==null||ie.render(D.createElement("div",{ref:x,style:ce,className:s,children:n}))}});const z=D.useRef(!0);uo(Re=>{if(I.current){C.updateMatrixWorld(),I.current.updateWorldMatrix(!0,!1);const ie=u?B.current:S(I.current,C,O);if(u||Math.abs(q.current-C.zoom)>e||Math.abs(B.current[0]-ie[0])>e||Math.abs(B.current[1]-ie[1])>e){const it=Ad(I.current,C);let kt=!1;W&&(h!=="blending"?kt=[E]:Array.isArray(h)&&(kt=h.map(fe=>fe.current)));const js=z.current;if(kt){const fe=Md(I.current,C,A,kt);z.current=fe&&!it}else z.current=!it;js!==z.current&&(d?d(!z.current):P.style.display=z.current?"block":"none");const U=Math.floor(y[0]/2),j=h?W?[y[0],U]:[U-1,0]:y;if(P.style.zIndex=`${kd(I.current,C,j)}`,u){const[fe,ge]=[O.width/2,O.height/2],ee=C.projectionMatrix.elements[5]*ge,{isOrthographicCamera:we,top:rt,left:Wt,bottom:Ys,right:ri}=C,ko=Rd(C.matrixWorldInverse),Ro=we?`scale(${ee})translate(${na(-(ri+Wt)/2)}px,${na((rt+Ys)/2)}px)`:`translateZ(${ee}px)`;let Zs=I.current.matrixWorld;l&&(Zs=C.matrixWorldInverse.clone().transpose().copyPosition(Zs).scale(I.current.scale),Zs.elements[3]=Zs.elements[7]=Zs.elements[11]=0,Zs.elements[15]=1),P.style.width=O.width+"px",P.style.height=O.height+"px",P.style.perspective=we?"":`${ee}px`,V.current&&H.current&&(V.current.style.transform=`${Ro}${ko}translate(${fe}px,${ge}px)`,H.current.style.transform=Pd(Zs,1/((c||10)/400)))}else{const fe=c===void 0?1:Dd(I.current,C)*c;P.style.transform=`translate3d(${ie[0]}px,${ie[1]}px,0) scale(${fe})`}B.current=ie,q.current=C.zoom}}if(!W&&se.current&&!ne.current)if(u){if(V.current){const ie=V.current.children[0];if(ie!=null&&ie.clientWidth&&ie!=null&&ie.clientHeight){const{isOrthographicCamera:it}=C;if(it||_)T.scale&&(Array.isArray(T.scale)?T.scale instanceof Ee?se.current.scale.copy(T.scale.clone().divideScalar(1)):se.current.scale.set(1/T.scale[0],1/T.scale[1],1/T.scale[2]):se.current.scale.setScalar(1/T.scale));else{const kt=(c||10)/400,js=ie.clientWidth*kt,U=ie.clientHeight*kt;se.current.scale.set(js,U,1)}ne.current=!0}}}else{const ie=P.children[0];if(ie!=null&&ie.clientWidth&&ie!=null&&ie.clientHeight){const it=1/R.factor,kt=ie.clientWidth*it,js=ie.clientHeight*it;se.current.scale.set(kt,js,1),ne.current=!0}se.current.lookAt(Re.camera.position)}});const qt=D.useMemo(()=>({vertexShader:u?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom" 
            is false. 
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;
            
            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[u]);return D.createElement("group",co({},T,{ref:I}),h&&!W&&D.createElement("mesh",{castShadow:f,receiveShadow:m,ref:se},_||D.createElement("planeGeometry",null),p||D.createElement("shaderMaterial",{side:Ti,vertexShader:qt.vertexShader,fragmentShader:qt.fragmentShader})))});function Id(n){let e;const t=new Set,s=(l,u)=>{const h=typeof l=="function"?l(e):l;if(h!==e){const d=e;e=u?h:Object.assign({},e,h),t.forEach(f=>f(e,d))}},i=()=>e,r=(l,u=i,h=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let d=u(e);function f(){const m=u(e);if(!h(d,m)){const p=d;l(d=m,p)}}return t.add(f),()=>t.delete(f)},c={setState:s,getState:i,subscribe:(l,u,h)=>u||h?r(l,u,h):(t.add(l),()=>t.delete(l)),destroy:()=>t.clear()};return e=n(s,i,c),c}const Fd=typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),Rc=Fd?D.useEffect:D.useLayoutEffect;function Ud(n){const e=typeof n=="function"?Id(n):n,t=(s=e.getState,i=Object.is)=>{const[,r]=D.useReducer(_=>_+1,0),o=e.getState(),a=D.useRef(o),c=D.useRef(s),l=D.useRef(i),u=D.useRef(!1),h=D.useRef();h.current===void 0&&(h.current=s(o));let d,f=!1;(a.current!==o||c.current!==s||l.current!==i||u.current)&&(d=s(o),f=!i(h.current,d)),Rc(()=>{f&&(h.current=d),a.current=o,c.current=s,l.current=i,u.current=!1});const m=D.useRef(o);Rc(()=>{const _=()=>{try{const S=e.getState(),b=c.current(S);l.current(h.current,b)||(a.current=S,h.current=b,r())}catch{u.current=!0,r()}},y=e.subscribe(_);return e.getState()!==m.current&&_(),y},[]);const p=f?d:h.current;return D.useDebugValue(p),p};return Object.assign(t,e),t[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const s=[t,e];return{next(){const i=s.length<=0;return{value:s.shift(),done:i}}}},t}let oi=0;const Ld=Ud(n=>(fr.onStart=(e,t,s)=>{n({active:!0,item:e,loaded:t,total:s,progress:(t-oi)/(s-oi)*100})},fr.onLoad=()=>{n({active:!1})},fr.onError=e=>n(t=>({errors:[...t.errors,e]})),fr.onProgress=(e,t,s)=>{t===s&&(oi=s),n({active:!0,item:e,loaded:t,total:s,progress:(t-oi)/(s-oi)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0})),Bd=n=>`Loading ${n.toFixed(2)}%`;function GT({containerStyles:n,innerStyles:e,barStyles:t,dataStyles:s,dataInterpolation:i=Bd,initialState:r=o=>o}){const{active:o,progress:a}=Ld(),c=D.useRef(0),l=D.useRef(0),u=D.useRef(null),[h,d]=D.useState(r(o));D.useEffect(()=>{let m;return o!==h&&(m=setTimeout(()=>d(o),300)),()=>clearTimeout(m)},[h,o]);const f=D.useCallback(()=>{u.current&&(c.current+=(a-c.current)/2,(c.current>.95*a||a===100)&&(c.current=a),u.current.innerText=i(c.current),c.current<a&&(l.current=requestAnimationFrame(f)))},[i,a]);return D.useEffect(()=>(f(),()=>cancelAnimationFrame(l.current)),[f]),h?D.createElement("div",{style:{..._r.container,opacity:o?1:0,...n}},D.createElement("div",null,D.createElement("div",{style:{..._r.inner,...e}},D.createElement("div",{style:{..._r.bar,transform:`scaleX(${a/100})`,...t}}),D.createElement("span",{ref:u,style:{..._r.data,...s}})))):null}const _r={container:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:"#171717",display:"flex",alignItems:"center",justifyContent:"center",transition:"opacity 300ms ease",zIndex:1e3},inner:{width:100,height:3,background:"#272727",textAlign:"center"},bar:{height:3,width:"100%",background:"white",transition:"transform 200ms",transformOrigin:"left center"},data:{display:"inline-block",position:"relative",fontVariantNumeric:"tabular-nums",marginTop:"0.8em",color:"#f0f0f0",fontSize:"0.6em",fontFamily:'-apple-system, BlinkMacSystemFont, "Inter", "Segoe UI", "Helvetica Neue", Helvetica, Arial, Roboto, Ubuntu, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',whiteSpace:"nowrap"}};let ai;function zd(){var n;if(ai!==void 0)return ai;try{let e;const t=document.createElement("canvas");return ai=!!(window.WebGL2RenderingContext&&(e=t.getContext("webgl2"))),e&&((n=e.getExtension("WEBGL_lose_context"))==null||n.loseContext()),ai}catch{return ai=!1}}const Po=new nd,No=new Ee,xn=new Ee,Rt=new Ee,ns=new Ee,Gt=new Ee,is=new Ee,rs=new Ee,ci=new Ee,li=new Ee,ui=new Ee,gr=new Ee,hi=new Ee,di=new Ee,fi=new Ee;class Vd{constructor(e,t,s){this.camera=e,this.scene=t,this.startPoint=new Ee,this.endPoint=new Ee,this.collection=[],this.deep=s||Number.MAX_VALUE}select(e,t){return this.startPoint=e||this.startPoint,this.endPoint=t||this.endPoint,this.collection=[],this.updateFrustum(this.startPoint,this.endPoint),this.searchChildInFrustum(Po,this.scene),this.collection}updateFrustum(e,t){if(e=e||this.startPoint,t=t||this.endPoint,e.x===t.x&&(t.x+=Number.EPSILON),e.y===t.y&&(t.y+=Number.EPSILON),this.camera.updateProjectionMatrix(),this.camera.updateMatrixWorld(),this.camera.isPerspectiveCamera){xn.copy(e),xn.x=Math.min(e.x,t.x),xn.y=Math.max(e.y,t.y),t.x=Math.max(e.x,t.x),t.y=Math.min(e.y,t.y),Rt.setFromMatrixPosition(this.camera.matrixWorld),ns.copy(xn),Gt.set(t.x,xn.y,0),is.copy(t),rs.set(xn.x,t.y,0),ns.unproject(this.camera),Gt.unproject(this.camera),is.unproject(this.camera),rs.unproject(this.camera),hi.copy(ns).sub(Rt),di.copy(Gt).sub(Rt),fi.copy(is).sub(Rt),hi.normalize(),di.normalize(),fi.normalize(),hi.multiplyScalar(this.deep),di.multiplyScalar(this.deep),fi.multiplyScalar(this.deep),hi.add(Rt),di.add(Rt),fi.add(Rt);var s=Po.planes;s[0].setFromCoplanarPoints(Rt,ns,Gt),s[1].setFromCoplanarPoints(Rt,Gt,is),s[2].setFromCoplanarPoints(is,rs,Rt),s[3].setFromCoplanarPoints(rs,ns,Rt),s[4].setFromCoplanarPoints(Gt,is,rs),s[5].setFromCoplanarPoints(fi,di,hi),s[5].normal.multiplyScalar(-1)}else if(this.camera.isOrthographicCamera){const i=Math.min(e.x,t.x),r=Math.max(e.y,t.y),o=Math.max(e.x,t.x),a=Math.min(e.y,t.y);ns.set(i,r,-1),Gt.set(o,r,-1),is.set(o,a,-1),rs.set(i,a,-1),ci.set(i,r,1),li.set(o,r,1),ui.set(o,a,1),gr.set(i,a,1),ns.unproject(this.camera),Gt.unproject(this.camera),is.unproject(this.camera),rs.unproject(this.camera),ci.unproject(this.camera),li.unproject(this.camera),ui.unproject(this.camera),gr.unproject(this.camera);var s=Po.planes;s[0].setFromCoplanarPoints(ns,ci,li),s[1].setFromCoplanarPoints(Gt,li,ui),s[2].setFromCoplanarPoints(ui,gr,rs),s[3].setFromCoplanarPoints(gr,ci,ns),s[4].setFromCoplanarPoints(Gt,is,rs),s[5].setFromCoplanarPoints(ui,li,ci),s[5].normal.multiplyScalar(-1)}else console.error("THREE.SelectionBox: Unsupported camera type.")}searchChildInFrustum(e,t){if((t.isMesh||t.isLine||t.isPoints)&&t.material!==void 0&&(t.geometry.boundingSphere===null&&t.geometry.computeBoundingSphere(),No.copy(t.geometry.boundingSphere.center),No.applyMatrix4(t.matrixWorld),e.containsPoint(No)&&this.collection.push(t)),t.children.length>0)for(let s=0;s<t.children.length;s++)this.searchChildInFrustum(e,t.children[s])}}function Hd(n,e){if(Object.is(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;const t=Object.keys(n);if(t.length!==Object.keys(e).length)return!1;for(let s=0;s<t.length;s++)if(!Object.prototype.hasOwnProperty.call(e,t[s])||!Object.is(n[t[s]],e[t[s]]))return!1;return!0}const qd=D.createContext([]);function jT({box:n,multiple:e,children:t,onChange:s,border:i="1px solid #55aaff",backgroundColor:r="rgba(75, 160, 255, 0.1)",filter:o=c=>c,...a}){const{setEvents:c,camera:l,raycaster:u,gl:h,controls:d,size:f,get:m}=be(),[p,_]=D.useState(!1),[y,S]=D.useReducer((T,{object:x,shift:w})=>x===void 0?[]:Array.isArray(x)?x:w?T.includes(x)?T.filter(C=>C!==x):[x,...T]:T[0]===x?[]:[x],[]);D.useEffect(()=>void(s==null?void 0:s(y)),[y]);const b=D.useCallback(T=>{T.stopPropagation(),S({object:o([T.object])[0],shift:e&&T.shiftKey})},[]),v=D.useCallback(T=>!p&&S({}),[p]),g=D.useRef(null);return D.useEffect(()=>{if(!n||!e)return;const T=new Vd(l,g.current),x=document.createElement("div");x.style.pointerEvents="none",x.style.border=i,x.style.backgroundColor=r,x.style.position="fixed";const w=new Fe,C=new Fe,E=new Fe,O=m().events.enabled,A=d==null?void 0:d.enabled;let k=!1;function R(L,se){const{offsetX:ne,offsetY:W}=L,{width:ce,height:Ve}=f;se.set(ne/ce*2-1,-(W/Ve)*2+1)}function P(L){var se;d&&(d.enabled=!1),c({enabled:!1}),k=!0,(se=h.domElement.parentElement)==null||se.appendChild(x),x.style.left=`${L.clientX}px`,x.style.top=`${L.clientY}px`,x.style.width="0px",x.style.height="0px",w.x=L.clientX,w.y=L.clientY}function F(L){E.x=Math.max(w.x,L.clientX),E.y=Math.max(w.y,L.clientY),C.x=Math.min(w.x,L.clientX),C.y=Math.min(w.y,L.clientY),x.style.left=`${C.x}px`,x.style.top=`${C.y}px`,x.style.width=`${E.x-C.x}px`,x.style.height=`${E.y-C.y}px`}function I(){if(k){var L;d&&(d.enabled=A),c({enabled:O}),k=!1,(L=x.parentElement)==null||L.removeChild(x)}}function q(L){L.shiftKey&&(P(L),R(L,T.startPoint))}let B=[];function V(L){if(k){F(L),R(L,T.endPoint);const se=T.select().sort(ne=>ne.uuid).filter(ne=>ne.isMesh);Hd(se,B)||(B=se,S({object:o(se)}))}}function H(L){k&&I()}return document.addEventListener("pointerdown",q,{passive:!0}),document.addEventListener("pointermove",V,{passive:!0,capture:!0}),document.addEventListener("pointerup",H,{passive:!0}),()=>{document.removeEventListener("pointerdown",q),document.removeEventListener("pointermove",V),document.removeEventListener("pointerup",H)}},[f.width,f.height,u,l,d,h]),D.createElement("group",co({ref:g,onClick:b,onPointerOver:()=>_(!0),onPointerOut:()=>_(!1),onPointerMissed:v},a),D.createElement(qd.Provider,{value:y},t))}/*!
 * camera-controls
 * https://github.com/yomotsu/camera-controls
 * (c) 2017 @yomotsu
 * Released under the MIT License.
 */const Z={LEFT:1,RIGHT:2,MIDDLE:4},M=Object.freeze({NONE:0,ROTATE:1,TRUCK:2,OFFSET:4,DOLLY:8,ZOOM:16,TOUCH_ROTATE:32,TOUCH_TRUCK:64,TOUCH_OFFSET:128,TOUCH_DOLLY:256,TOUCH_ZOOM:512,TOUCH_DOLLY_TRUCK:1024,TOUCH_DOLLY_OFFSET:2048,TOUCH_DOLLY_ROTATE:4096,TOUCH_ZOOM_TRUCK:8192,TOUCH_ZOOM_OFFSET:16384,TOUCH_ZOOM_ROTATE:32768}),wn={NONE:0,IN:1,OUT:-1};function Xs(n){return n.isPerspectiveCamera}function Es(n){return n.isOrthographicCamera}const Sn=Math.PI*2,Pc=Math.PI/2,Bl=1e-5,pi=Math.PI/180;function Pt(n,e,t){return Math.max(e,Math.min(t,n))}function ve(n,e=Bl){return Math.abs(n)<e}function ae(n,e,t=Bl){return ve(n-e,t)}function Nc(n,e){return Math.round(n/e)*e}function mi(n){return isFinite(n)?n:n<0?-Number.MAX_VALUE:Number.MAX_VALUE}function _i(n){return Math.abs(n)<Number.MAX_VALUE?n:n*(1/0)}function vr(n,e,t,s,i=1/0,r){s=Math.max(1e-4,s);const o=2/s,a=o*r,c=1/(1+a+.48*a*a+.235*a*a*a);let l=n-e;const u=e,h=i*s;l=Pt(l,-h,h),e=n-l;const d=(t.value+o*l)*r;t.value=(t.value-o*d)*c;let f=e+(l+d)*c;return u-n>0==f>u&&(f=u,t.value=(f-u)/r),f}function Ic(n,e,t,s,i=1/0,r,o){s=Math.max(1e-4,s);const a=2/s,c=a*r,l=1/(1+c+.48*c*c+.235*c*c*c);let u=e.x,h=e.y,d=e.z,f=n.x-u,m=n.y-h,p=n.z-d;const _=u,y=h,S=d,b=i*s,v=b*b,g=f*f+m*m+p*p;if(g>v){const P=Math.sqrt(g);f=f/P*b,m=m/P*b,p=p/P*b}u=n.x-f,h=n.y-m,d=n.z-p;const T=(t.x+a*f)*r,x=(t.y+a*m)*r,w=(t.z+a*p)*r;t.x=(t.x-a*T)*l,t.y=(t.y-a*x)*l,t.z=(t.z-a*w)*l,o.x=u+(f+T)*l,o.y=h+(m+x)*l,o.z=d+(p+w)*l;const C=_-n.x,E=y-n.y,O=S-n.z,A=o.x-_,k=o.y-y,R=o.z-S;return C*A+E*k+O*R>0&&(o.x=_,o.y=y,o.z=S,t.x=(o.x-_)/r,t.y=(o.y-y)/r,t.z=(o.z-S)/r),o}function Io(n,e){e.set(0,0),n.forEach(t=>{e.x+=t.clientX,e.y+=t.clientY}),e.x/=n.length,e.y/=n.length}function Fo(n,e){return Es(n)?(console.warn(`${e} is not supported in OrthographicCamera`),!0):!1}class Wd{constructor(){this._listeners={}}addEventListener(e,t){const s=this._listeners;s[e]===void 0&&(s[e]=[]),s[e].indexOf(t)===-1&&s[e].push(t)}hasEventListener(e,t){const s=this._listeners;return s[e]!==void 0&&s[e].indexOf(t)!==-1}removeEventListener(e,t){const i=this._listeners[e];if(i!==void 0){const r=i.indexOf(t);r!==-1&&i.splice(r,1)}}removeAllEventListeners(e){if(!e){this._listeners={};return}Array.isArray(this._listeners[e])&&(this._listeners[e].length=0)}dispatchEvent(e){const s=this._listeners[e.type];if(s!==void 0){e.target=this;const i=s.slice(0);for(let r=0,o=i.length;r<o;r++)i[r].call(this,e)}}}const Gd="2.7.3",yr=1/8,zl=typeof window<"u",jd=zl&&/Mac/.test(navigator.platform),Yd=!(zl&&"PointerEvent"in window);let Y,Fc,Tr,Uo,ot,Q,re,bn,gi,jt,Yt,$s,Uc,Lc,wt,vi,Cn,Bc,Lo,zc,Bo,zo,xr,Vo=class ia extends Wd{static install(e){Y=e.THREE,Fc=Object.freeze(new Y.Vector3(0,0,0)),Tr=Object.freeze(new Y.Vector3(0,1,0)),Uo=Object.freeze(new Y.Vector3(0,0,1)),ot=new Y.Vector2,Q=new Y.Vector3,re=new Y.Vector3,bn=new Y.Vector3,gi=new Y.Vector3,jt=new Y.Vector3,Yt=new Y.Vector3,$s=new Y.Vector3,Uc=new Y.Vector3,Lc=new Y.Vector3,wt=new Y.Spherical,vi=new Y.Spherical,Cn=new Y.Box3,Bc=new Y.Box3,Lo=new Y.Sphere,zc=new Y.Quaternion,Bo=new Y.Quaternion,zo=new Y.Matrix4,xr=new Y.Raycaster}static get ACTION(){return M}constructor(e,t){super(),this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.minDistance=Number.EPSILON,this.maxDistance=1/0,this.infinityDolly=!1,this.minZoom=.01,this.maxZoom=1/0,this.smoothTime=.25,this.draggingSmoothTime=.125,this.maxSpeed=1/0,this.azimuthRotateSpeed=1,this.polarRotateSpeed=1,this.dollySpeed=1,this.dollyDragInverted=!1,this.truckSpeed=2,this.dollyToCursor=!1,this.dragToOffset=!1,this.verticalDragToForward=!1,this.boundaryFriction=0,this.restThreshold=.01,this.colliderMeshes=[],this.cancel=()=>{},this._enabled=!0,this._state=M.NONE,this._viewport=null,this._changedDolly=0,this._changedZoom=0,this._hasRested=!0,this._boundaryEnclosesCamera=!1,this._needsUpdate=!0,this._updatedLastTime=!1,this._elementRect=new DOMRect,this._isDragging=!1,this._dragNeedsUpdate=!0,this._activePointers=[],this._lockedPointer=null,this._interactiveArea=new DOMRect(0,0,1,1),this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._isUserControllingOffset=!1,this._isUserControllingZoom=!1,this._lastDollyDirection=wn.NONE,this._thetaVelocity={value:0},this._phiVelocity={value:0},this._radiusVelocity={value:0},this._targetVelocity=new Y.Vector3,this._focalOffsetVelocity=new Y.Vector3,this._zoomVelocity={value:0},this._truckInternal=(v,g,T)=>{let x,w;if(Xs(this._camera)){const C=Q.copy(this._camera.position).sub(this._target),E=this._camera.getEffectiveFOV()*pi,O=C.length()*Math.tan(E*.5);x=this.truckSpeed*v*O/this._elementRect.height,w=this.truckSpeed*g*O/this._elementRect.height}else if(Es(this._camera)){const C=this._camera;x=v*(C.right-C.left)/C.zoom/this._elementRect.width,w=g*(C.top-C.bottom)/C.zoom/this._elementRect.height}else return;this.verticalDragToForward?(T?this.setFocalOffset(this._focalOffsetEnd.x+x,this._focalOffsetEnd.y,this._focalOffsetEnd.z,!0):this.truck(x,0,!0),this.forward(-w,!0)):T?this.setFocalOffset(this._focalOffsetEnd.x+x,this._focalOffsetEnd.y+w,this._focalOffsetEnd.z,!0):this.truck(x,w,!0)},this._rotateInternal=(v,g)=>{const T=Sn*this.azimuthRotateSpeed*v/this._elementRect.height,x=Sn*this.polarRotateSpeed*g/this._elementRect.height;this.rotate(T,x,!0)},this._dollyInternal=(v,g,T)=>{const x=Math.pow(.95,-v*this.dollySpeed),w=this._sphericalEnd.radius,C=this._sphericalEnd.radius*x,E=Pt(C,this.minDistance,this.maxDistance),O=E-C;this.infinityDolly&&this.dollyToCursor?this._dollyToNoClamp(C,!0):this.infinityDolly&&!this.dollyToCursor?(this.dollyInFixed(O,!0),this._dollyToNoClamp(E,!0)):this._dollyToNoClamp(E,!0),this.dollyToCursor&&(this._changedDolly+=(this.infinityDolly?C:E)-w,this._dollyControlCoord.set(g,T)),this._lastDollyDirection=Math.sign(-v)},this._zoomInternal=(v,g,T)=>{const x=Math.pow(.95,v*this.dollySpeed),w=this._zoom,C=this._zoom*x;this.zoomTo(C,!0),this.dollyToCursor&&(this._changedZoom+=C-w,this._dollyControlCoord.set(g,T))},typeof Y>"u"&&console.error("camera-controls: `THREE` is undefined. You must first run `CameraControls.install( { THREE: THREE } )`. Check the docs for further information."),this._camera=e,this._yAxisUpSpace=new Y.Quaternion().setFromUnitVectors(this._camera.up,Tr),this._yAxisUpSpaceInverse=this._yAxisUpSpace.clone().invert(),this._state=M.NONE,this._target=new Y.Vector3,this._targetEnd=this._target.clone(),this._focalOffset=new Y.Vector3,this._focalOffsetEnd=this._focalOffset.clone(),this._spherical=new Y.Spherical().setFromVector3(Q.copy(this._camera.position).applyQuaternion(this._yAxisUpSpace)),this._sphericalEnd=this._spherical.clone(),this._lastDistance=this._spherical.radius,this._zoom=this._camera.zoom,this._zoomEnd=this._zoom,this._lastZoom=this._zoom,this._nearPlaneCorners=[new Y.Vector3,new Y.Vector3,new Y.Vector3,new Y.Vector3],this._updateNearPlaneCorners(),this._boundary=new Y.Box3(new Y.Vector3(-1/0,-1/0,-1/0),new Y.Vector3(1/0,1/0,1/0)),this._cameraUp0=this._camera.up.clone(),this._target0=this._target.clone(),this._position0=this._camera.position.clone(),this._zoom0=this._zoom,this._focalOffset0=this._focalOffset.clone(),this._dollyControlCoord=new Y.Vector2,this.mouseButtons={left:M.ROTATE,middle:M.DOLLY,right:M.TRUCK,wheel:Xs(this._camera)?M.DOLLY:Es(this._camera)?M.ZOOM:M.NONE},this.touches={one:M.TOUCH_ROTATE,two:Xs(this._camera)?M.TOUCH_DOLLY_TRUCK:Es(this._camera)?M.TOUCH_ZOOM_TRUCK:M.NONE,three:M.TOUCH_TRUCK};const s=new Y.Vector2,i=new Y.Vector2,r=new Y.Vector2,o=v=>{if(!this._enabled||!this._domElement)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const x=this._domElement.getBoundingClientRect(),w=v.clientX/x.width,C=v.clientY/x.height;if(w<this._interactiveArea.left||w>this._interactiveArea.right||C<this._interactiveArea.top||C>this._interactiveArea.bottom)return}const g=v.pointerType!=="mouse"?null:(v.buttons&Z.LEFT)===Z.LEFT?Z.LEFT:(v.buttons&Z.MIDDLE)===Z.MIDDLE?Z.MIDDLE:(v.buttons&Z.RIGHT)===Z.RIGHT?Z.RIGHT:null;if(g!==null){const x=this._findPointerByMouseButton(g);x&&this._disposePointer(x)}if((v.buttons&Z.LEFT)===Z.LEFT&&this._lockedPointer)return;const T={pointerId:v.pointerId,clientX:v.clientX,clientY:v.clientY,deltaX:0,deltaY:0,mouseButton:g};this._activePointers.push(T),this._domElement.ownerDocument.removeEventListener("pointermove",c,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",u),this._domElement.ownerDocument.addEventListener("pointermove",c,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",u),this._isDragging=!0,p(v)},a=v=>{if(!this._enabled||!this._domElement||this._lockedPointer)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const x=this._domElement.getBoundingClientRect(),w=v.clientX/x.width,C=v.clientY/x.height;if(w<this._interactiveArea.left||w>this._interactiveArea.right||C<this._interactiveArea.top||C>this._interactiveArea.bottom)return}const g=(v.buttons&Z.LEFT)===Z.LEFT?Z.LEFT:(v.buttons&Z.MIDDLE)===Z.MIDDLE?Z.MIDDLE:(v.buttons&Z.RIGHT)===Z.RIGHT?Z.RIGHT:null;if(g!==null){const x=this._findPointerByMouseButton(g);x&&this._disposePointer(x)}const T={pointerId:1,clientX:v.clientX,clientY:v.clientY,deltaX:0,deltaY:0,mouseButton:(v.buttons&Z.LEFT)===Z.LEFT?Z.LEFT:(v.buttons&Z.MIDDLE)===Z.LEFT?Z.MIDDLE:(v.buttons&Z.RIGHT)===Z.LEFT?Z.RIGHT:null};this._activePointers.push(T),this._domElement.ownerDocument.removeEventListener("mousemove",l),this._domElement.ownerDocument.removeEventListener("mouseup",h),this._domElement.ownerDocument.addEventListener("mousemove",l),this._domElement.ownerDocument.addEventListener("mouseup",h),this._isDragging=!0,p(v)},c=v=>{v.cancelable&&v.preventDefault();const g=v.pointerId,T=this._lockedPointer||this._findPointerById(g);if(T){if(T.clientX=v.clientX,T.clientY=v.clientY,T.deltaX=v.movementX,T.deltaY=v.movementY,this._state=0,v.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else(!this._isDragging&&this._lockedPointer||this._isDragging&&(v.buttons&Z.LEFT)===Z.LEFT)&&(this._state=this._state|this.mouseButtons.left),this._isDragging&&(v.buttons&Z.MIDDLE)===Z.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),this._isDragging&&(v.buttons&Z.RIGHT)===Z.RIGHT&&(this._state=this._state|this.mouseButtons.right);_()}},l=v=>{const g=this._lockedPointer||this._findPointerById(1);g&&(g.clientX=v.clientX,g.clientY=v.clientY,g.deltaX=v.movementX,g.deltaY=v.movementY,this._state=0,(this._lockedPointer||(v.buttons&Z.LEFT)===Z.LEFT)&&(this._state=this._state|this.mouseButtons.left),(v.buttons&Z.MIDDLE)===Z.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(v.buttons&Z.RIGHT)===Z.RIGHT&&(this._state=this._state|this.mouseButtons.right),_())},u=v=>{const g=this._findPointerById(v.pointerId);if(!(g&&g===this._lockedPointer)){if(g&&this._disposePointer(g),v.pointerType==="touch")switch(this._activePointers.length){case 0:this._state=M.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else this._state=M.NONE;y()}},h=()=>{const v=this._findPointerById(1);v&&v===this._lockedPointer||(v&&this._disposePointer(v),this._state=M.NONE,y())};let d=-1;const f=v=>{if(!this._domElement||!this._enabled||this.mouseButtons.wheel===M.NONE)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const C=this._domElement.getBoundingClientRect(),E=v.clientX/C.width,O=v.clientY/C.height;if(E<this._interactiveArea.left||E>this._interactiveArea.right||O<this._interactiveArea.top||O>this._interactiveArea.bottom)return}if(v.preventDefault(),this.dollyToCursor||this.mouseButtons.wheel===M.ROTATE||this.mouseButtons.wheel===M.TRUCK){const C=performance.now();d-C<1e3&&this._getClientRect(this._elementRect),d=C}const g=jd?-1:-3,T=v.deltaMode===1?v.deltaY/g:v.deltaY/(g*10),x=this.dollyToCursor?(v.clientX-this._elementRect.x)/this._elementRect.width*2-1:0,w=this.dollyToCursor?(v.clientY-this._elementRect.y)/this._elementRect.height*-2+1:0;switch(this.mouseButtons.wheel){case M.ROTATE:{this._rotateInternal(v.deltaX,v.deltaY),this._isUserControllingRotate=!0;break}case M.TRUCK:{this._truckInternal(v.deltaX,v.deltaY,!1),this._isUserControllingTruck=!0;break}case M.OFFSET:{this._truckInternal(v.deltaX,v.deltaY,!0),this._isUserControllingOffset=!0;break}case M.DOLLY:{this._dollyInternal(-T,x,w),this._isUserControllingDolly=!0;break}case M.ZOOM:{this._zoomInternal(-T,x,w),this._isUserControllingZoom=!0;break}}this.dispatchEvent({type:"control"})},m=v=>{if(!(!this._domElement||!this._enabled)){if(this.mouseButtons.right===ia.ACTION.NONE){const g=v instanceof PointerEvent?v.pointerId:(v instanceof MouseEvent,0),T=this._findPointerById(g);T&&this._disposePointer(T),this._domElement.ownerDocument.removeEventListener("pointermove",c,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",u),this._domElement.ownerDocument.removeEventListener("mousemove",l),this._domElement.ownerDocument.removeEventListener("mouseup",h);return}v.preventDefault()}},p=v=>{if(!this._enabled)return;if(Io(this._activePointers,ot),this._getClientRect(this._elementRect),s.copy(ot),i.copy(ot),this._activePointers.length>=2){const T=ot.x-this._activePointers[1].clientX,x=ot.y-this._activePointers[1].clientY,w=Math.sqrt(T*T+x*x);r.set(0,w);const C=(this._activePointers[0].clientX+this._activePointers[1].clientX)*.5,E=(this._activePointers[0].clientY+this._activePointers[1].clientY)*.5;i.set(C,E)}if(this._state=0,!v)this._lockedPointer&&(this._state=this._state|this.mouseButtons.left);else if("pointerType"in v&&v.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else!this._lockedPointer&&(v.buttons&Z.LEFT)===Z.LEFT&&(this._state=this._state|this.mouseButtons.left),(v.buttons&Z.MIDDLE)===Z.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(v.buttons&Z.RIGHT)===Z.RIGHT&&(this._state=this._state|this.mouseButtons.right);((this._state&M.ROTATE)===M.ROTATE||(this._state&M.TOUCH_ROTATE)===M.TOUCH_ROTATE||(this._state&M.TOUCH_DOLLY_ROTATE)===M.TOUCH_DOLLY_ROTATE||(this._state&M.TOUCH_ZOOM_ROTATE)===M.TOUCH_ZOOM_ROTATE)&&(this._sphericalEnd.theta=this._spherical.theta,this._sphericalEnd.phi=this._spherical.phi,this._thetaVelocity.value=0,this._phiVelocity.value=0),((this._state&M.TRUCK)===M.TRUCK||(this._state&M.TOUCH_TRUCK)===M.TOUCH_TRUCK||(this._state&M.TOUCH_DOLLY_TRUCK)===M.TOUCH_DOLLY_TRUCK||(this._state&M.TOUCH_ZOOM_TRUCK)===M.TOUCH_ZOOM_TRUCK)&&(this._targetEnd.copy(this._target),this._targetVelocity.set(0,0,0)),((this._state&M.DOLLY)===M.DOLLY||(this._state&M.TOUCH_DOLLY)===M.TOUCH_DOLLY||(this._state&M.TOUCH_DOLLY_TRUCK)===M.TOUCH_DOLLY_TRUCK||(this._state&M.TOUCH_DOLLY_OFFSET)===M.TOUCH_DOLLY_OFFSET||(this._state&M.TOUCH_DOLLY_ROTATE)===M.TOUCH_DOLLY_ROTATE)&&(this._sphericalEnd.radius=this._spherical.radius,this._radiusVelocity.value=0),((this._state&M.ZOOM)===M.ZOOM||(this._state&M.TOUCH_ZOOM)===M.TOUCH_ZOOM||(this._state&M.TOUCH_ZOOM_TRUCK)===M.TOUCH_ZOOM_TRUCK||(this._state&M.TOUCH_ZOOM_OFFSET)===M.TOUCH_ZOOM_OFFSET||(this._state&M.TOUCH_ZOOM_ROTATE)===M.TOUCH_ZOOM_ROTATE)&&(this._zoomEnd=this._zoom,this._zoomVelocity.value=0),((this._state&M.OFFSET)===M.OFFSET||(this._state&M.TOUCH_OFFSET)===M.TOUCH_OFFSET||(this._state&M.TOUCH_DOLLY_OFFSET)===M.TOUCH_DOLLY_OFFSET||(this._state&M.TOUCH_ZOOM_OFFSET)===M.TOUCH_ZOOM_OFFSET)&&(this._focalOffsetEnd.copy(this._focalOffset),this._focalOffsetVelocity.set(0,0,0)),this.dispatchEvent({type:"controlstart"})},_=()=>{if(!this._enabled||!this._dragNeedsUpdate)return;this._dragNeedsUpdate=!1,Io(this._activePointers,ot);const g=this._domElement&&document.pointerLockElement===this._domElement?this._lockedPointer||this._activePointers[0]:null,T=g?-g.deltaX:i.x-ot.x,x=g?-g.deltaY:i.y-ot.y;if(i.copy(ot),((this._state&M.ROTATE)===M.ROTATE||(this._state&M.TOUCH_ROTATE)===M.TOUCH_ROTATE||(this._state&M.TOUCH_DOLLY_ROTATE)===M.TOUCH_DOLLY_ROTATE||(this._state&M.TOUCH_ZOOM_ROTATE)===M.TOUCH_ZOOM_ROTATE)&&(this._rotateInternal(T,x),this._isUserControllingRotate=!0),(this._state&M.DOLLY)===M.DOLLY||(this._state&M.ZOOM)===M.ZOOM){const w=this.dollyToCursor?(s.x-this._elementRect.x)/this._elementRect.width*2-1:0,C=this.dollyToCursor?(s.y-this._elementRect.y)/this._elementRect.height*-2+1:0,E=this.dollyDragInverted?-1:1;(this._state&M.DOLLY)===M.DOLLY?(this._dollyInternal(E*x*yr,w,C),this._isUserControllingDolly=!0):(this._zoomInternal(E*x*yr,w,C),this._isUserControllingZoom=!0)}if((this._state&M.TOUCH_DOLLY)===M.TOUCH_DOLLY||(this._state&M.TOUCH_ZOOM)===M.TOUCH_ZOOM||(this._state&M.TOUCH_DOLLY_TRUCK)===M.TOUCH_DOLLY_TRUCK||(this._state&M.TOUCH_ZOOM_TRUCK)===M.TOUCH_ZOOM_TRUCK||(this._state&M.TOUCH_DOLLY_OFFSET)===M.TOUCH_DOLLY_OFFSET||(this._state&M.TOUCH_ZOOM_OFFSET)===M.TOUCH_ZOOM_OFFSET||(this._state&M.TOUCH_DOLLY_ROTATE)===M.TOUCH_DOLLY_ROTATE||(this._state&M.TOUCH_ZOOM_ROTATE)===M.TOUCH_ZOOM_ROTATE){const w=ot.x-this._activePointers[1].clientX,C=ot.y-this._activePointers[1].clientY,E=Math.sqrt(w*w+C*C),O=r.y-E;r.set(0,E);const A=this.dollyToCursor?(i.x-this._elementRect.x)/this._elementRect.width*2-1:0,k=this.dollyToCursor?(i.y-this._elementRect.y)/this._elementRect.height*-2+1:0;(this._state&M.TOUCH_DOLLY)===M.TOUCH_DOLLY||(this._state&M.TOUCH_DOLLY_ROTATE)===M.TOUCH_DOLLY_ROTATE||(this._state&M.TOUCH_DOLLY_TRUCK)===M.TOUCH_DOLLY_TRUCK||(this._state&M.TOUCH_DOLLY_OFFSET)===M.TOUCH_DOLLY_OFFSET?(this._dollyInternal(O*yr,A,k),this._isUserControllingDolly=!0):(this._zoomInternal(O*yr,A,k),this._isUserControllingZoom=!0)}((this._state&M.TRUCK)===M.TRUCK||(this._state&M.TOUCH_TRUCK)===M.TOUCH_TRUCK||(this._state&M.TOUCH_DOLLY_TRUCK)===M.TOUCH_DOLLY_TRUCK||(this._state&M.TOUCH_ZOOM_TRUCK)===M.TOUCH_ZOOM_TRUCK)&&(this._truckInternal(T,x,!1),this._isUserControllingTruck=!0),((this._state&M.OFFSET)===M.OFFSET||(this._state&M.TOUCH_OFFSET)===M.TOUCH_OFFSET||(this._state&M.TOUCH_DOLLY_OFFSET)===M.TOUCH_DOLLY_OFFSET||(this._state&M.TOUCH_ZOOM_OFFSET)===M.TOUCH_ZOOM_OFFSET)&&(this._truckInternal(T,x,!0),this._isUserControllingOffset=!0),this.dispatchEvent({type:"control"})},y=()=>{Io(this._activePointers,ot),i.copy(ot),this._dragNeedsUpdate=!1,(this._activePointers.length===0||this._activePointers.length===1&&this._activePointers[0]===this._lockedPointer)&&(this._isDragging=!1),this._activePointers.length===0&&this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointermove",c,{passive:!1}),this._domElement.ownerDocument.removeEventListener("mousemove",l),this._domElement.ownerDocument.removeEventListener("pointerup",u),this._domElement.ownerDocument.removeEventListener("mouseup",h),this.dispatchEvent({type:"controlend"}))};this.lockPointer=()=>{!this._enabled||!this._domElement||(this.cancel(),this._lockedPointer={pointerId:-1,clientX:0,clientY:0,deltaX:0,deltaY:0,mouseButton:null},this._activePointers.push(this._lockedPointer),this._domElement.ownerDocument.removeEventListener("pointermove",c,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",u),this._domElement.requestPointerLock(),this._domElement.ownerDocument.addEventListener("pointerlockchange",S),this._domElement.ownerDocument.addEventListener("pointerlockerror",b),this._domElement.ownerDocument.addEventListener("pointermove",c,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",u),p())},this.unlockPointer=()=>{this._lockedPointer!==null&&(this._disposePointer(this._lockedPointer),this._lockedPointer=null),document.exitPointerLock(),this.cancel(),this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointerlockchange",S),this._domElement.ownerDocument.removeEventListener("pointerlockerror",b))};const S=()=>{this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement||this.unlockPointer()},b=()=>{this.unlockPointer()};this._addAllEventListeners=v=>{this._domElement=v,this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none",this._domElement.addEventListener("pointerdown",o),Yd&&this._domElement.addEventListener("mousedown",a),this._domElement.addEventListener("pointercancel",u),this._domElement.addEventListener("wheel",f,{passive:!1}),this._domElement.addEventListener("contextmenu",m)},this._removeAllEventListeners=()=>{this._domElement&&(this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect="",this._domElement.removeEventListener("pointerdown",o),this._domElement.removeEventListener("mousedown",a),this._domElement.removeEventListener("pointercancel",u),this._domElement.removeEventListener("wheel",f,{passive:!1}),this._domElement.removeEventListener("contextmenu",m),this._domElement.ownerDocument.removeEventListener("pointermove",c,{passive:!1}),this._domElement.ownerDocument.removeEventListener("mousemove",l),this._domElement.ownerDocument.removeEventListener("pointerup",u),this._domElement.ownerDocument.removeEventListener("mouseup",h),this._domElement.ownerDocument.removeEventListener("pointerlockchange",S),this._domElement.ownerDocument.removeEventListener("pointerlockerror",b))},this.cancel=()=>{this._state!==M.NONE&&(this._state=M.NONE,this._activePointers.length=0,y())},t&&this.connect(t),this.update(0)}get camera(){return this._camera}set camera(e){this._camera=e,this.updateCameraUp(),this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this._domElement&&(e?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect=""))}get active(){return!this._hasRested}get currentAction(){return this._state}get distance(){return this._spherical.radius}set distance(e){this._spherical.radius===e&&this._sphericalEnd.radius===e||(this._spherical.radius=e,this._sphericalEnd.radius=e,this._needsUpdate=!0)}get azimuthAngle(){return this._spherical.theta}set azimuthAngle(e){this._spherical.theta===e&&this._sphericalEnd.theta===e||(this._spherical.theta=e,this._sphericalEnd.theta=e,this._needsUpdate=!0)}get polarAngle(){return this._spherical.phi}set polarAngle(e){this._spherical.phi===e&&this._sphericalEnd.phi===e||(this._spherical.phi=e,this._sphericalEnd.phi=e,this._needsUpdate=!0)}get boundaryEnclosesCamera(){return this._boundaryEnclosesCamera}set boundaryEnclosesCamera(e){this._boundaryEnclosesCamera=e,this._needsUpdate=!0}set interactiveArea(e){this._interactiveArea.width=Pt(e.width,0,1),this._interactiveArea.height=Pt(e.height,0,1),this._interactiveArea.x=Pt(e.x,0,1-this._interactiveArea.width),this._interactiveArea.y=Pt(e.y,0,1-this._interactiveArea.height)}addEventListener(e,t){super.addEventListener(e,t)}removeEventListener(e,t){super.removeEventListener(e,t)}rotate(e,t,s=!1){return this.rotateTo(this._sphericalEnd.theta+e,this._sphericalEnd.phi+t,s)}rotateAzimuthTo(e,t=!1){return this.rotateTo(e,this._sphericalEnd.phi,t)}rotatePolarTo(e,t=!1){return this.rotateTo(this._sphericalEnd.theta,e,t)}rotateTo(e,t,s=!1){this._isUserControllingRotate=!1;const i=Pt(e,this.minAzimuthAngle,this.maxAzimuthAngle),r=Pt(t,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=i,this._sphericalEnd.phi=r,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,s||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);const o=!s||ae(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&ae(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(o)}dolly(e,t=!1){return this.dollyTo(this._sphericalEnd.radius-e,t)}dollyTo(e,t=!1){return this._isUserControllingDolly=!1,this._lastDollyDirection=wn.NONE,this._changedDolly=0,this._dollyToNoClamp(Pt(e,this.minDistance,this.maxDistance),t)}_dollyToNoClamp(e,t=!1){const s=this._sphericalEnd.radius;if(this.colliderMeshes.length>=1){const o=this._collisionTest(),a=ae(o,this._spherical.radius);if(!(s>e)&&a)return Promise.resolve();this._sphericalEnd.radius=Math.min(e,o)}else this._sphericalEnd.radius=e;this._needsUpdate=!0,t||(this._spherical.radius=this._sphericalEnd.radius);const r=!t||ae(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(r)}dollyInFixed(e,t=!1){this._targetEnd.add(this._getCameraDirection(gi).multiplyScalar(e)),t||this._target.copy(this._targetEnd);const s=!t||ae(this._target.x,this._targetEnd.x,this.restThreshold)&&ae(this._target.y,this._targetEnd.y,this.restThreshold)&&ae(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(s)}zoom(e,t=!1){return this.zoomTo(this._zoomEnd+e,t)}zoomTo(e,t=!1){this._isUserControllingZoom=!1,this._zoomEnd=Pt(e,this.minZoom,this.maxZoom),this._needsUpdate=!0,t||(this._zoom=this._zoomEnd);const s=!t||ae(this._zoom,this._zoomEnd,this.restThreshold);return this._changedZoom=0,this._createOnRestPromise(s)}pan(e,t,s=!1){return console.warn("`pan` has been renamed to `truck`"),this.truck(e,t,s)}truck(e,t,s=!1){this._camera.updateMatrix(),jt.setFromMatrixColumn(this._camera.matrix,0),Yt.setFromMatrixColumn(this._camera.matrix,1),jt.multiplyScalar(e),Yt.multiplyScalar(-t);const i=Q.copy(jt).add(Yt),r=re.copy(this._targetEnd).add(i);return this.moveTo(r.x,r.y,r.z,s)}forward(e,t=!1){Q.setFromMatrixColumn(this._camera.matrix,0),Q.crossVectors(this._camera.up,Q),Q.multiplyScalar(e);const s=re.copy(this._targetEnd).add(Q);return this.moveTo(s.x,s.y,s.z,t)}elevate(e,t=!1){return Q.copy(this._camera.up).multiplyScalar(e),this.moveTo(this._targetEnd.x+Q.x,this._targetEnd.y+Q.y,this._targetEnd.z+Q.z,t)}moveTo(e,t,s,i=!1){this._isUserControllingTruck=!1;const r=Q.set(e,t,s).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,r,this.boundaryFriction),this._needsUpdate=!0,i||this._target.copy(this._targetEnd);const o=!i||ae(this._target.x,this._targetEnd.x,this.restThreshold)&&ae(this._target.y,this._targetEnd.y,this.restThreshold)&&ae(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(o)}lookInDirectionOf(e,t,s,i=!1){const a=Q.set(e,t,s).sub(this._targetEnd).normalize().multiplyScalar(-this._sphericalEnd.radius);return this.setPosition(a.x,a.y,a.z,i)}fitToBox(e,t,{cover:s=!1,paddingLeft:i=0,paddingRight:r=0,paddingBottom:o=0,paddingTop:a=0}={}){const c=[],l=e.isBox3?Cn.copy(e):Cn.setFromObject(e);l.isEmpty()&&(console.warn("camera-controls: fitTo() cannot be used with an empty box. Aborting"),Promise.resolve());const u=Nc(this._sphericalEnd.theta,Pc),h=Nc(this._sphericalEnd.phi,Pc);c.push(this.rotateTo(u,h,t));const d=Q.setFromSpherical(this._sphericalEnd).normalize(),f=zc.setFromUnitVectors(d,Uo),m=ae(Math.abs(d.y),1);m&&f.multiply(Bo.setFromAxisAngle(Tr,u)),f.multiply(this._yAxisUpSpaceInverse);const p=Bc.makeEmpty();re.copy(l.min).applyQuaternion(f),p.expandByPoint(re),re.copy(l.min).setX(l.max.x).applyQuaternion(f),p.expandByPoint(re),re.copy(l.min).setY(l.max.y).applyQuaternion(f),p.expandByPoint(re),re.copy(l.max).setZ(l.min.z).applyQuaternion(f),p.expandByPoint(re),re.copy(l.min).setZ(l.max.z).applyQuaternion(f),p.expandByPoint(re),re.copy(l.max).setY(l.min.y).applyQuaternion(f),p.expandByPoint(re),re.copy(l.max).setX(l.min.x).applyQuaternion(f),p.expandByPoint(re),re.copy(l.max).applyQuaternion(f),p.expandByPoint(re),p.min.x-=i,p.min.y-=o,p.max.x+=r,p.max.y+=a,f.setFromUnitVectors(Uo,d),m&&f.premultiply(Bo.invert()),f.premultiply(this._yAxisUpSpace);const _=p.getSize(Q),y=p.getCenter(re).applyQuaternion(f);if(Xs(this._camera)){const S=this.getDistanceToFitBox(_.x,_.y,_.z,s);c.push(this.moveTo(y.x,y.y,y.z,t)),c.push(this.dollyTo(S,t)),c.push(this.setFocalOffset(0,0,0,t))}else if(Es(this._camera)){const S=this._camera,b=S.right-S.left,v=S.top-S.bottom,g=s?Math.max(b/_.x,v/_.y):Math.min(b/_.x,v/_.y);c.push(this.moveTo(y.x,y.y,y.z,t)),c.push(this.zoomTo(g,t)),c.push(this.setFocalOffset(0,0,0,t))}return Promise.all(c)}fitToSphere(e,t){const s=[],r=e instanceof Y.Sphere?Lo.copy(e):ia.createBoundingSphere(e,Lo);if(s.push(this.moveTo(r.center.x,r.center.y,r.center.z,t)),Xs(this._camera)){const o=this.getDistanceToFitSphere(r.radius);s.push(this.dollyTo(o,t))}else if(Es(this._camera)){const o=this._camera.right-this._camera.left,a=this._camera.top-this._camera.bottom,c=2*r.radius,l=Math.min(o/c,a/c);s.push(this.zoomTo(l,t))}return s.push(this.setFocalOffset(0,0,0,t)),Promise.all(s)}setLookAt(e,t,s,i,r,o,a=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=wn.NONE,this._changedDolly=0;const c=re.set(i,r,o),l=Q.set(e,t,s);this._targetEnd.copy(c),this._sphericalEnd.setFromVector3(l.sub(c).applyQuaternion(this._yAxisUpSpace)),this.normalizeRotations(),this._needsUpdate=!0,a||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const u=!a||ae(this._target.x,this._targetEnd.x,this.restThreshold)&&ae(this._target.y,this._targetEnd.y,this.restThreshold)&&ae(this._target.z,this._targetEnd.z,this.restThreshold)&&ae(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&ae(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&ae(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(u)}lerpLookAt(e,t,s,i,r,o,a,c,l,u,h,d,f,m=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=wn.NONE,this._changedDolly=0;const p=Q.set(i,r,o),_=re.set(e,t,s);wt.setFromVector3(_.sub(p).applyQuaternion(this._yAxisUpSpace));const y=bn.set(u,h,d),S=re.set(a,c,l);vi.setFromVector3(S.sub(y).applyQuaternion(this._yAxisUpSpace)),this._targetEnd.copy(p.lerp(y,f));const b=vi.theta-wt.theta,v=vi.phi-wt.phi,g=vi.radius-wt.radius;this._sphericalEnd.set(wt.radius+g*f,wt.phi+v*f,wt.theta+b*f),this.normalizeRotations(),this._needsUpdate=!0,m||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const T=!m||ae(this._target.x,this._targetEnd.x,this.restThreshold)&&ae(this._target.y,this._targetEnd.y,this.restThreshold)&&ae(this._target.z,this._targetEnd.z,this.restThreshold)&&ae(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&ae(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&ae(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(T)}setPosition(e,t,s,i=!1){return this.setLookAt(e,t,s,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,i)}setTarget(e,t,s,i=!1){const r=this.getPosition(Q),o=this.setLookAt(r.x,r.y,r.z,e,t,s,i);return this._sphericalEnd.phi=Pt(this._sphericalEnd.phi,this.minPolarAngle,this.maxPolarAngle),o}setFocalOffset(e,t,s,i=!1){this._isUserControllingOffset=!1,this._focalOffsetEnd.set(e,t,s),this._needsUpdate=!0,i||this._focalOffset.copy(this._focalOffsetEnd);const r=!i||ae(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&ae(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&ae(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(r)}setOrbitPoint(e,t,s){this._camera.updateMatrixWorld(),jt.setFromMatrixColumn(this._camera.matrixWorldInverse,0),Yt.setFromMatrixColumn(this._camera.matrixWorldInverse,1),$s.setFromMatrixColumn(this._camera.matrixWorldInverse,2);const i=Q.set(e,t,s),r=i.distanceTo(this._camera.position),o=i.sub(this._camera.position);jt.multiplyScalar(o.x),Yt.multiplyScalar(o.y),$s.multiplyScalar(o.z),Q.copy(jt).add(Yt).add($s),Q.z=Q.z+r,this.dollyTo(r,!1),this.setFocalOffset(-Q.x,Q.y,-Q.z,!1),this.moveTo(e,t,s,!1)}setBoundary(e){if(!e){this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),this._needsUpdate=!0;return}this._boundary.copy(e),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}setViewport(e,t,s,i){if(e===null){this._viewport=null;return}this._viewport=this._viewport||new Y.Vector4,typeof e=="number"?this._viewport.set(e,t,s,i):this._viewport.copy(e)}getDistanceToFitBox(e,t,s,i=!1){if(Fo(this._camera,"getDistanceToFitBox"))return this._spherical.radius;const r=e/t,o=this._camera.getEffectiveFOV()*pi,a=this._camera.aspect;return((i?r>a:r<a)?t:e/a)*.5/Math.tan(o*.5)+s*.5}getDistanceToFitSphere(e){if(Fo(this._camera,"getDistanceToFitSphere"))return this._spherical.radius;const t=this._camera.getEffectiveFOV()*pi,s=Math.atan(Math.tan(t*.5)*this._camera.aspect)*2,i=1<this._camera.aspect?t:s;return e/Math.sin(i*.5)}getTarget(e,t=!0){return(e&&e.isVector3?e:new Y.Vector3).copy(t?this._targetEnd:this._target)}getPosition(e,t=!0){return(e&&e.isVector3?e:new Y.Vector3).setFromSpherical(t?this._sphericalEnd:this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(t?this._targetEnd:this._target)}getSpherical(e,t=!0){return(e&&e instanceof Y.Spherical?e:new Y.Spherical).copy(t?this._sphericalEnd:this._spherical)}getFocalOffset(e,t=!0){return(e&&e.isVector3?e:new Y.Vector3).copy(t?this._focalOffsetEnd:this._focalOffset)}normalizeRotations(){this._sphericalEnd.theta=this._sphericalEnd.theta%Sn,this._sphericalEnd.theta<0&&(this._sphericalEnd.theta+=Sn),this._spherical.theta+=Sn*Math.round((this._sphericalEnd.theta-this._spherical.theta)/Sn)}reset(e=!1){if(!ae(this._camera.up.x,this._cameraUp0.x)||!ae(this._camera.up.y,this._cameraUp0.y)||!ae(this._camera.up.z,this._cameraUp0.z)){this._camera.up.copy(this._cameraUp0);const s=this.getPosition(Q);this.updateCameraUp(),this.setPosition(s.x,s.y,s.z)}const t=[this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,e),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,e),this.zoomTo(this._zoom0,e)];return Promise.all(t)}saveState(){this._cameraUp0.copy(this._camera.up),this.getTarget(this._target0),this.getPosition(this._position0),this._zoom0=this._zoom,this._focalOffset0.copy(this._focalOffset)}updateCameraUp(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,Tr),this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace).invert()}applyCameraUp(){const e=Q.subVectors(this._target,this._camera.position).normalize(),t=re.crossVectors(e,this._camera.up);this._camera.up.crossVectors(t,e).normalize(),this._camera.updateMatrixWorld();const s=this.getPosition(Q);this.updateCameraUp(),this.setPosition(s.x,s.y,s.z)}update(e){const t=this._sphericalEnd.theta-this._spherical.theta,s=this._sphericalEnd.phi-this._spherical.phi,i=this._sphericalEnd.radius-this._spherical.radius,r=Uc.subVectors(this._targetEnd,this._target),o=Lc.subVectors(this._focalOffsetEnd,this._focalOffset),a=this._zoomEnd-this._zoom;if(ve(t))this._thetaVelocity.value=0,this._spherical.theta=this._sphericalEnd.theta;else{const h=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.theta=vr(this._spherical.theta,this._sphericalEnd.theta,this._thetaVelocity,h,1/0,e),this._needsUpdate=!0}if(ve(s))this._phiVelocity.value=0,this._spherical.phi=this._sphericalEnd.phi;else{const h=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.phi=vr(this._spherical.phi,this._sphericalEnd.phi,this._phiVelocity,h,1/0,e),this._needsUpdate=!0}if(ve(i))this._radiusVelocity.value=0,this._spherical.radius=this._sphericalEnd.radius;else{const h=this._isUserControllingDolly?this.draggingSmoothTime:this.smoothTime;this._spherical.radius=vr(this._spherical.radius,this._sphericalEnd.radius,this._radiusVelocity,h,this.maxSpeed,e),this._needsUpdate=!0}if(ve(r.x)&&ve(r.y)&&ve(r.z))this._targetVelocity.set(0,0,0),this._target.copy(this._targetEnd);else{const h=this._isUserControllingTruck?this.draggingSmoothTime:this.smoothTime;Ic(this._target,this._targetEnd,this._targetVelocity,h,this.maxSpeed,e,this._target),this._needsUpdate=!0}if(ve(o.x)&&ve(o.y)&&ve(o.z))this._focalOffsetVelocity.set(0,0,0),this._focalOffset.copy(this._focalOffsetEnd);else{const h=this._isUserControllingOffset?this.draggingSmoothTime:this.smoothTime;Ic(this._focalOffset,this._focalOffsetEnd,this._focalOffsetVelocity,h,this.maxSpeed,e,this._focalOffset),this._needsUpdate=!0}if(ve(a))this._zoomVelocity.value=0,this._zoom=this._zoomEnd;else{const h=this._isUserControllingZoom?this.draggingSmoothTime:this.smoothTime;this._zoom=vr(this._zoom,this._zoomEnd,this._zoomVelocity,h,1/0,e)}if(this.dollyToCursor){if(Xs(this._camera)&&this._changedDolly!==0){const h=this._spherical.radius-this._lastDistance,d=this._camera,f=this._getCameraDirection(gi),m=Q.copy(f).cross(d.up).normalize();m.lengthSq()===0&&(m.x=1);const p=re.crossVectors(m,f),_=this._sphericalEnd.radius*Math.tan(d.getEffectiveFOV()*pi*.5),S=(this._sphericalEnd.radius-h-this._sphericalEnd.radius)/this._sphericalEnd.radius,b=bn.copy(this._targetEnd).add(m.multiplyScalar(this._dollyControlCoord.x*_*d.aspect)).add(p.multiplyScalar(this._dollyControlCoord.y*_)),v=Q.copy(this._targetEnd).lerp(b,S),g=this._lastDollyDirection===wn.IN&&this._spherical.radius<=this.minDistance,T=this._lastDollyDirection===wn.OUT&&this.maxDistance<=this._spherical.radius;if(this.infinityDolly&&(g||T)){this._sphericalEnd.radius-=h,this._spherical.radius-=h;const w=re.copy(f).multiplyScalar(-h);v.add(w)}this._boundary.clampPoint(v,v);const x=re.subVectors(v,this._targetEnd);this._targetEnd.copy(v),this._target.add(x),this._changedDolly-=h,ve(this._changedDolly)&&(this._changedDolly=0)}else if(Es(this._camera)&&this._changedZoom!==0){const h=this._zoom-this._lastZoom,d=this._camera,f=Q.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(d.near+d.far)/(d.near-d.far)).unproject(d),m=re.set(0,0,-1).applyQuaternion(d.quaternion),p=bn.copy(f).add(m.multiplyScalar(-f.dot(d.up))),y=-(this._zoom-h-this._zoom)/this._zoom,S=this._getCameraDirection(gi),b=this._targetEnd.dot(S),v=Q.copy(this._targetEnd).lerp(p,y),g=v.dot(S),T=S.multiplyScalar(g-b);v.sub(T),this._boundary.clampPoint(v,v);const x=re.subVectors(v,this._targetEnd);this._targetEnd.copy(v),this._target.add(x),this._changedZoom-=h,ve(this._changedZoom)&&(this._changedZoom=0)}}this._camera.zoom!==this._zoom&&(this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0),this._dragNeedsUpdate=!0;const c=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,c),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target),(!ve(this._focalOffset.x)||!ve(this._focalOffset.y)||!ve(this._focalOffset.z))&&(this._camera.updateMatrixWorld(),jt.setFromMatrixColumn(this._camera.matrix,0),Yt.setFromMatrixColumn(this._camera.matrix,1),$s.setFromMatrixColumn(this._camera.matrix,2),jt.multiplyScalar(this._focalOffset.x),Yt.multiplyScalar(-this._focalOffset.y),$s.multiplyScalar(this._focalOffset.z),Q.copy(jt).add(Yt).add($s),this._camera.position.add(Q)),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),Q.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);const u=this._needsUpdate;return u&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):u?(this.dispatchEvent({type:"update"}),ve(t,this.restThreshold)&&ve(s,this.restThreshold)&&ve(i,this.restThreshold)&&ve(r.x,this.restThreshold)&&ve(r.y,this.restThreshold)&&ve(r.z,this.restThreshold)&&ve(o.x,this.restThreshold)&&ve(o.y,this.restThreshold)&&ve(o.z,this.restThreshold)&&ve(a,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!u&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._lastDistance=this._spherical.radius,this._lastZoom=this._zoom,this._updatedLastTime=u,this._needsUpdate=!1,u}toJSON(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:mi(this.maxDistance),minZoom:this.minZoom,maxZoom:mi(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:mi(this.maxPolarAngle),minAzimuthAngle:mi(this.minAzimuthAngle),maxAzimuthAngle:mi(this.maxAzimuthAngle),smoothTime:this.smoothTime,draggingSmoothTime:this.draggingSmoothTime,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,verticalDragToForward:this.verticalDragToForward,target:this._targetEnd.toArray(),position:Q.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}fromJSON(e,t=!1){const s=JSON.parse(e);this.enabled=s.enabled,this.minDistance=s.minDistance,this.maxDistance=_i(s.maxDistance),this.minZoom=s.minZoom,this.maxZoom=_i(s.maxZoom),this.minPolarAngle=s.minPolarAngle,this.maxPolarAngle=_i(s.maxPolarAngle),this.minAzimuthAngle=_i(s.minAzimuthAngle),this.maxAzimuthAngle=_i(s.maxAzimuthAngle),this.smoothTime=s.smoothTime,this.draggingSmoothTime=s.draggingSmoothTime,this.dollySpeed=s.dollySpeed,this.truckSpeed=s.truckSpeed,this.dollyToCursor=s.dollyToCursor,this.verticalDragToForward=s.verticalDragToForward,this._target0.fromArray(s.target0),this._position0.fromArray(s.position0),this._zoom0=s.zoom0,this._focalOffset0.fromArray(s.focalOffset0),this.moveTo(s.target[0],s.target[1],s.target[2],t),wt.setFromVector3(Q.fromArray(s.position).sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(wt.theta,wt.phi,t),this.dollyTo(wt.radius,t),this.zoomTo(s.zoom,t),this.setFocalOffset(s.focalOffset[0],s.focalOffset[1],s.focalOffset[2],t),this._needsUpdate=!0}connect(e){if(this._domElement){console.warn("camera-controls is already connected.");return}e.setAttribute("data-camera-controls-version",Gd),this._addAllEventListeners(e),this._getClientRect(this._elementRect)}disconnect(){this.cancel(),this._removeAllEventListeners(),this._domElement&&(this._domElement.removeAttribute("data-camera-controls-version"),this._domElement=void 0)}dispose(){this.removeAllEventListeners(),this.disconnect()}_getTargetDirection(e){return e.setFromSpherical(this._spherical).divideScalar(this._spherical.radius).applyQuaternion(this._yAxisUpSpaceInverse)}_getCameraDirection(e){return this._getTargetDirection(e).negate()}_findPointerById(e){return this._activePointers.find(t=>t.pointerId===e)}_findPointerByMouseButton(e){return this._activePointers.find(t=>t.mouseButton===e)}_disposePointer(e){this._activePointers.splice(this._activePointers.indexOf(e),1)}_encloseToBoundary(e,t,s){const i=t.lengthSq();if(i===0)return e;const r=re.copy(t).add(e),a=this._boundary.clampPoint(r,bn).sub(r),c=a.lengthSq();if(c===0)return e.add(t);if(c===i)return e;if(s===0)return e.add(t).add(a);{const l=1+s*c/t.dot(a);return e.add(re.copy(t).multiplyScalar(l)).add(a.multiplyScalar(1-s))}}_updateNearPlaneCorners(){if(Xs(this._camera)){const e=this._camera,t=e.near,s=e.getEffectiveFOV()*pi,i=Math.tan(s*.5)*t,r=i*e.aspect;this._nearPlaneCorners[0].set(-r,-i,0),this._nearPlaneCorners[1].set(r,-i,0),this._nearPlaneCorners[2].set(r,i,0),this._nearPlaneCorners[3].set(-r,i,0)}else if(Es(this._camera)){const e=this._camera,t=1/e.zoom,s=e.left*t,i=e.right*t,r=e.top*t,o=e.bottom*t;this._nearPlaneCorners[0].set(s,r,0),this._nearPlaneCorners[1].set(i,r,0),this._nearPlaneCorners[2].set(i,o,0),this._nearPlaneCorners[3].set(s,o,0)}}_collisionTest(){let e=1/0;if(!(this.colliderMeshes.length>=1)||Fo(this._camera,"_collisionTest"))return e;const s=this._getTargetDirection(gi);zo.lookAt(Fc,s,this._camera.up);for(let i=0;i<4;i++){const r=re.copy(this._nearPlaneCorners[i]);r.applyMatrix4(zo);const o=bn.addVectors(this._target,r);xr.set(o,s),xr.far=this._spherical.radius+1;const a=xr.intersectObjects(this.colliderMeshes);a.length!==0&&a[0].distance<e&&(e=a[0].distance)}return e}_getClientRect(e){if(!this._domElement)return;const t=this._domElement.getBoundingClientRect();return e.x=t.left,e.y=t.top,this._viewport?(e.x+=this._viewport.x,e.y+=t.height-this._viewport.w-this._viewport.y,e.width=this._viewport.z,e.height=this._viewport.w):(e.width=t.width,e.height=t.height),e}_createOnRestPromise(e){return e?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise(t=>{const s=()=>{this.removeEventListener("rest",s),t()};this.addEventListener("rest",s)}))}_addAllEventListeners(e){}_removeAllEventListeners(){}get dampingFactor(){return console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead."),0}set dampingFactor(e){console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead.")}get draggingDampingFactor(){return console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead."),0}set draggingDampingFactor(e){console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead.")}static createBoundingSphere(e,t=new Y.Sphere){const s=t,i=s.center;Cn.makeEmpty(),e.traverseVisible(o=>{o.isMesh&&Cn.expandByObject(o)}),Cn.getCenter(i);let r=0;return e.traverseVisible(o=>{if(!o.isMesh)return;const a=o,c=a.geometry.clone();c.applyMatrix4(a.matrixWorld);const u=c.attributes.position;for(let h=0,d=u.count;h<d;h++)Q.fromBufferAttribute(u,h),r=Math.max(r,i.distanceToSquared(Q))}),s.radius=Math.sqrt(r),s}};const YT=D.forwardRef((n,e)=>{D.useMemo(()=>{Vo.install({THREE:id}),Pa({CameraControlsImpl:Vo})},[]);const{camera:t,domElement:s,makeDefault:i,onStart:r,onEnd:o,onChange:a,regress:c,...l}=n,u=be(g=>g.camera),h=be(g=>g.gl),d=be(g=>g.invalidate),f=be(g=>g.events),m=be(g=>g.setEvents),p=be(g=>g.set),_=be(g=>g.get),y=be(g=>g.performance),S=t||u,b=s||f.connected||h.domElement,v=D.useMemo(()=>new Vo(S),[S]);return uo((g,T)=>{v.enabled&&v.update(T)},-1),D.useEffect(()=>(v.connect(b),()=>void v.disconnect()),[b,v]),D.useEffect(()=>{const g=w=>{d(),c&&y.regress(),a&&a(w)},T=w=>{r&&r(w)},x=w=>{o&&o(w)};return v.addEventListener("update",g),v.addEventListener("controlstart",T),v.addEventListener("controlend",x),()=>{v.removeEventListener("update",g),v.removeEventListener("controlstart",T),v.removeEventListener("controlend",x)}},[v,r,o,d,m,c,a]),D.useEffect(()=>{if(i){const g=_().controls;return p({controls:v}),()=>p({controls:g})}},[i,v]),D.createElement("primitive",co({ref:e,object:v},l))}),Vl=D.createContext(null),ZT=D.forwardRef((n,e)=>{D.useMemo(()=>Pa({SegmentObject:Zd}),[]);const{limit:t=1e3,lineWidth:s=1,children:i,...r}=n,[o,a]=D.useState([]),[c]=D.useState(()=>new xd),[l]=D.useState(()=>new wd),[u]=D.useState(()=>new Sd),[h]=D.useState(()=>new Fe(512,512)),[d]=D.useState(()=>Array(t*6).fill(0)),[f]=D.useState(()=>Array(t*6).fill(0)),m=D.useMemo(()=>({subscribe:p=>(a(_=>[..._,p]),()=>a(_=>_.filter(y=>y.current!==p.current)))}),[]);return uo(()=>{for(let _=0;_<t;_++){var p;const y=(p=o[_])==null?void 0:p.current;y&&(d[_*6+0]=y.start.x,d[_*6+1]=y.start.y,d[_*6+2]=y.start.z,d[_*6+3]=y.end.x,d[_*6+4]=y.end.y,d[_*6+5]=y.end.z,f[_*6+0]=y.color.r,f[_*6+1]=y.color.g,f[_*6+2]=y.color.b,f[_*6+3]=y.color.r,f[_*6+4]=y.color.g,f[_*6+5]=y.color.b)}u.setColors(f),u.setPositions(d),c.computeLineDistances()}),D.createElement("primitive",{object:c,ref:e},D.createElement("primitive",{object:u,attach:"geometry"}),D.createElement("primitive",co({object:l,attach:"material",vertexColors:!0,resolution:h,linewidth:s},r)),D.createElement(Vl.Provider,{value:m},i))});class Zd{constructor(){this.color=new As("white"),this.start=new Ee(0,0,0),this.end=new Ee(0,0,0)}}const Vc=n=>n instanceof Ee?n:new Ee(...typeof n=="number"?[n,n,n]:n),XT=D.forwardRef(({color:n,start:e,end:t},s)=>{const i=D.useContext(Vl);if(!i)throw"Segment must used inside Segments component.";const r=D.useRef(null);return D.useLayoutEffect(()=>i.subscribe(r),[]),D.createElement("segmentObject",{ref:bd([r,s]),color:n,start:Vc(e),end:Vc(t)})});function $T({all:n,scene:e,camera:t}){const s=be(({gl:o})=>o),i=be(({camera:o})=>o),r=be(({scene:o})=>o);return D.useLayoutEffect(()=>{const o=[];n&&(e||r).traverse(l=>{l.visible===!1&&(o.push(l),l.visible=!0)}),s.compile(e||r,t||i);const a=new rd(128);new od(.01,1e5,a).update(s,e||r),a.dispose(),o.forEach(l=>l.visible=!1)},[]),null}function QT({pixelated:n}){const e=be(o=>o.gl),t=be(o=>o.internal.active),s=be(o=>o.performance.current),i=be(o=>o.viewport.initialDpr),r=be(o=>o.setDpr);return D.useEffect(()=>{const o=e.domElement;return()=>{t&&r(i),n&&o&&(o.style.imageRendering="auto")}},[]),D.useEffect(()=>{r(s*i),n&&e.domElement&&(e.domElement.style.imageRendering=s===1?"auto":"pixelated")},[s]),null}function KT(){const n=be(s=>s.get),e=be(s=>s.setEvents),t=be(s=>s.performance.current);return D.useEffect(()=>{const s=n().events.enabled;return()=>e({enabled:s})},[]),D.useEffect(()=>e({enabled:t===1}),[t]),null}const Ia=D.createContext(null);function JT({children:n,enabled:e=!0}){const[t,s]=D.useState([]),i=D.useMemo(()=>({selected:t,select:s,enabled:e}),[t,s,e]);return us.jsx(Ia.Provider,{value:i,children:n})}function ex({enabled:n=!1,children:e,...t}){const s=D.useRef(null),i=D.useContext(Ia);return D.useEffect(()=>{if(i&&n){let r=!1;const o=[];if(s.current.traverse(a=>{a.type==="Mesh"&&o.push(a),i.selected.indexOf(a)===-1&&(r=!0)}),r)return i.select(a=>[...a,...o]),()=>{i.select(a=>a.filter(c=>!o.includes(c)))}}},[n,e,i]),us.jsx("group",{ref:s,...t,children:e})}/**
 * postprocessing v6.33.4 build Sat Dec 02 2023
 * https://github.com/pmndrs/postprocessing
 * Copyright 2015-2023 Raoul van Rschen
 * @license Zlib
 */var Hl="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",K={SKIP:9,SET:30,ADD:0,ALPHA:1,AVERAGE:2,COLOR:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,DIVIDE:8,DST:9,EXCLUSION:10,HARD_LIGHT:11,HARD_MIX:12,HUE:13,INVERT:14,INVERT_RGB:15,LIGHTEN:16,LINEAR_BURN:17,LINEAR_DODGE:18,LINEAR_LIGHT:19,LUMINOSITY:20,MULTIPLY:21,NEGATION:22,NORMAL:23,OVERLAY:24,PIN_LIGHT:25,REFLECT:26,SATURATION:27,SCREEN:28,SOFT_LIGHT:29,SRC:30,SUBTRACT:31,VIVID_LIGHT:32},ql="",We="srgb",ho="srgb-linear",hs={NONE:0,DEPTH:1,CONVOLUTION:2},oe={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},fo={VERY_SMALL:0,SMALL:1,MEDIUM:2,LARGE:3,VERY_LARGE:4,HUGE:5},wr={DEFAULT:0,ESKIL:1},Wl=Number(Ra.replace(/\D+/g,"")),Gl=Wl>=152,Xd=new Map([[Fl,ho],[Ul,We]]),$d=new Map([[ho,Fl],[We,Ul]]);function zn(n){return n===null?null:Gl?n.outputColorSpace:Xd.get(n.outputEncoding)}function Rs(n,e){n!==null&&(Gl?n.colorSpace=e:n.encoding=$d.get(e))}function tr(n){return Wl<154?n.replace("colorspace_fragment","encodings_fragment"):n}var Qd=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;
#include <colorspace_fragment>
}`,Kd="uniform vec4 texelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize.xy*vec2(kernel)+texelSize.zw)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}",Jd=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],ef=class extends Jt{constructor(n=new kc){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new X(null),texelSize:new X(new kc),scale:new X(1),kernel:new X(0)},blending:ys,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Qd,vertexShader:Kd}),this.fragmentShader=tr(this.fragmentShader),this.setTexelSize(n.x,n.y),this.kernelSize=fo.MEDIUM}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.inputBuffer=n}get kernelSequence(){return Jd[this.kernelSize]}get scale(){return this.uniforms.scale.value}set scale(n){this.uniforms.scale.value=n}getScale(){return this.uniforms.scale.value}setScale(n){this.uniforms.scale.value=n}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(n){this.uniforms.kernel.value=n}setKernel(n){this.kernel=n}setTexelSize(n,e){this.uniforms.texelSize.value.set(n,e,n*.5,e*.5)}setSize(n,e){const t=1/n,s=1/e;this.uniforms.texelSize.value.set(t,s,t*.5,s*.5)}},tf=`#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;
#include <colorspace_fragment>
#include <dithering_fragment>
}`,jl=class extends Jt{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new X(null),opacity:new X(1)},blending:ys,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:tf,vertexShader:Hl}),this.fragmentShader=tr(this.fragmentShader)}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}getOpacity(n){return this.uniforms.opacity.value}setOpacity(n){this.uniforms.opacity.value=n}},sf=`#include <packing>
#include <clipping_planes_pars_fragment>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform float cameraNear;uniform float cameraFar;centroid varying float vViewZ;centroid varying vec4 vProjTexCoord;void main(){
#include <clipping_planes_fragment>
vec2 projTexCoord=(vProjTexCoord.xy/vProjTexCoord.w)*0.5+0.5;projTexCoord=clamp(projTexCoord,0.002,0.998);
#if DEPTH_PACKING == 3201
float fragCoordZ=unpackRGBAToDepth(texture2D(depthBuffer,projTexCoord));
#else
float fragCoordZ=texture2D(depthBuffer,projTexCoord).r;
#endif
#ifdef PERSPECTIVE_CAMERA
float viewZ=perspectiveDepthToViewZ(fragCoordZ,cameraNear,cameraFar);
#else
float viewZ=orthographicDepthToViewZ(fragCoordZ,cameraNear,cameraFar);
#endif
float depthTest=(-vViewZ>-viewZ)?1.0:0.0;gl_FragColor.rg=vec2(0.0,depthTest);}`,nf=`#include <common>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
varying float vViewZ;varying vec4 vProjTexCoord;void main(){
#include <skinbase_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <project_vertex>
vViewZ=mvPosition.z;vProjTexCoord=gl_Position;
#include <clipping_planes_vertex>
}`,rf=class extends Jt{constructor(n=null,e){super({name:"DepthComparisonMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new X(null),cameraNear:new X(.3),cameraFar:new X(1e3)},blending:ys,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:sf,vertexShader:nf}),this.depthBuffer=n,this.depthPacking=ta,this.copyCameraSettings(e)}set depthBuffer(n){this.uniforms.depthBuffer.value=n}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,e=ta){this.depthBuffer=n,this.depthPacking=e}adoptCameraSettings(n){this.copyCameraSettings(n)}copyCameraSettings(n){n&&(this.uniforms.cameraNear.value=n.near,this.uniforms.cameraFar.value=n.far,n instanceof lo?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},of=`#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
#ifdef DOWNSAMPLE_NORMALS
uniform lowp sampler2D normalBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}int findBestDepth(const in float samples[4]){float c=(samples[0]+samples[1]+samples[2]+samples[3])*0.25;float distances[4];distances[0]=abs(c-samples[0]);distances[1]=abs(c-samples[1]);distances[2]=abs(c-samples[2]);distances[3]=abs(c-samples[3]);float maxDistance=max(max(distances[0],distances[1]),max(distances[2],distances[3]));int remaining[3];int rejected[3];int i,j,k;for(i=0,j=0,k=0;i<4;++i){if(distances[i]<maxDistance){remaining[j++]=i;}else{rejected[k++]=i;}}for(;j<3;++j){remaining[j]=rejected[--k];}vec3 s=vec3(samples[remaining[0]],samples[remaining[1]],samples[remaining[2]]);c=(s.x+s.y+s.z)/3.0;distances[0]=abs(c-s.x);distances[1]=abs(c-s.y);distances[2]=abs(c-s.z);float minDistance=min(distances[0],min(distances[1],distances[2]));for(i=0;i<3;++i){if(distances[i]==minDistance){break;}}return remaining[i];}void main(){float d[4];d[0]=readDepth(vUv0);d[1]=readDepth(vUv1);d[2]=readDepth(vUv2);d[3]=readDepth(vUv3);int index=findBestDepth(d);
#ifdef DOWNSAMPLE_NORMALS
vec3 n[4];n[0]=texture2D(normalBuffer,vUv0).rgb;n[1]=texture2D(normalBuffer,vUv1).rgb;n[2]=texture2D(normalBuffer,vUv2).rgb;n[3]=texture2D(normalBuffer,vUv3).rgb;
#else
vec3 n[4];n[0]=vec3(0.0);n[1]=vec3(0.0);n[2]=vec3(0.0);n[3]=vec3(0.0);
#endif
gl_FragColor=vec4(n[index],d[index]);}`,af="uniform vec2 texelSize;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vUv0=uv;vUv1=vec2(uv.x,uv.y+texelSize.y);vUv2=vec2(uv.x+texelSize.x,uv.y);vUv3=uv+texelSize;gl_Position=vec4(position.xy,1.0,1.0);}",cf=class extends Jt{constructor(){super({name:"DepthDownsamplingMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new X(null),normalBuffer:new X(null),texelSize:new X(new Fe)},blending:ys,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:of,vertexShader:af})}set depthBuffer(n){this.uniforms.depthBuffer.value=n}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,e=Jn){this.depthBuffer=n,this.depthPacking=e}set normalBuffer(n){this.uniforms.normalBuffer.value=n,n!==null?this.defines.DOWNSAMPLE_NORMALS="1":delete this.defines.DOWNSAMPLE_NORMALS,this.needsUpdate=!0}setNormalBuffer(n){this.normalBuffer=n}setTexelSize(n,e){this.uniforms.texelSize.value.set(n,e)}setSize(n,e){this.uniforms.texelSize.value.set(1/n,1/e)}},lf=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#define WEIGHT_INNER 0.125
#define WEIGHT_OUTER 0.0555555
varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;float clampToBorder(const in vec2 uv){return float(uv.s>=0.0&&uv.s<=1.0&&uv.t>=0.0&&uv.t<=1.0);}void main(){vec4 c=vec4(0.0);vec4 w=WEIGHT_INNER*vec4(clampToBorder(vUv00),clampToBorder(vUv01),clampToBorder(vUv02),clampToBorder(vUv03));c+=w.x*texture2D(inputBuffer,vUv00);c+=w.y*texture2D(inputBuffer,vUv01);c+=w.z*texture2D(inputBuffer,vUv02);c+=w.w*texture2D(inputBuffer,vUv03);w=WEIGHT_OUTER*vec4(clampToBorder(vUv04),clampToBorder(vUv05),clampToBorder(vUv06),clampToBorder(vUv07));c+=w.x*texture2D(inputBuffer,vUv04);c+=w.y*texture2D(inputBuffer,vUv05);c+=w.z*texture2D(inputBuffer,vUv06);c+=w.w*texture2D(inputBuffer,vUv07);w=WEIGHT_OUTER*vec4(clampToBorder(vUv08),clampToBorder(vUv09),clampToBorder(vUv10),clampToBorder(vUv11));c+=w.x*texture2D(inputBuffer,vUv08);c+=w.y*texture2D(inputBuffer,vUv09);c+=w.z*texture2D(inputBuffer,vUv10);c+=w.w*texture2D(inputBuffer,vUv11);c+=WEIGHT_OUTER*texture2D(inputBuffer,vUv);gl_FragColor=c;
#include <colorspace_fragment>
}`,uf="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;void main(){vUv=position.xy*0.5+0.5;vUv00=vUv+texelSize*vec2(-1.0,1.0);vUv01=vUv+texelSize*vec2(1.0,1.0);vUv02=vUv+texelSize*vec2(-1.0,-1.0);vUv03=vUv+texelSize*vec2(1.0,-1.0);vUv04=vUv+texelSize*vec2(-2.0,2.0);vUv05=vUv+texelSize*vec2(0.0,2.0);vUv06=vUv+texelSize*vec2(2.0,2.0);vUv07=vUv+texelSize*vec2(-2.0,0.0);vUv08=vUv+texelSize*vec2(2.0,0.0);vUv09=vUv+texelSize*vec2(-2.0,-2.0);vUv10=vUv+texelSize*vec2(0.0,-2.0);vUv11=vUv+texelSize*vec2(2.0,-2.0);gl_Position=vec4(position.xy,1.0,1.0);}",hf=class extends Jt{constructor(){super({name:"DownsamplingMaterial",uniforms:{inputBuffer:new X(null),texelSize:new X(new Fe)},blending:ys,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:lf,vertexShader:uf}),this.fragmentShader=tr(this.fragmentShader)}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setSize(n,e){this.uniforms.texelSize.value.set(1/n,1/e)}},df=`#include <common>
#include <packing>
#include <dithering_pars_fragment>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#if DEPTH_PACKING == 3201
uniform lowp sampler2D depthBuffer;
#elif defined(GL_FRAGMENT_PRECISION_HIGH)
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#if THREE_REVISION >= 137
vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}vec3 RGBToHCV(const in vec3 RGB){vec4 P=mix(vec4(RGB.bg,-1.0,2.0/3.0),vec4(RGB.gb,0.0,-1.0/3.0),step(RGB.b,RGB.g));vec4 Q=mix(vec4(P.xyw,RGB.r),vec4(RGB.r,P.yzx),step(P.x,RGB.r));float C=Q.x-min(Q.w,Q.y);float H=abs((Q.w-Q.y)/(6.0*C+EPSILON)+Q.z);return vec3(H,C,Q.x);}vec3 RGBToHSL(const in vec3 RGB){vec3 HCV=RGBToHCV(RGB);float L=HCV.z-HCV.y*0.5;float S=HCV.y/(1.0-abs(L*2.0-1.0)+EPSILON);return vec3(HCV.x,S,L);}vec3 HueToRGB(const in float H){float R=abs(H*6.0-3.0)-1.0;float G=2.0-abs(H*6.0-2.0);float B=2.0-abs(H*6.0-4.0);return clamp(vec3(R,G,B),0.0,1.0);}vec3 HSLToRGB(const in vec3 HSL){vec3 RGB=HueToRGB(HSL.x);float C=(1.0-abs(2.0*HSL.z-1.0))*HSL.y;return(RGB-0.5)*C+HSL.z;}FRAGMENT_HEAD void main(){FRAGMENT_MAIN_UV vec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGE color0.a=clamp(color0.a,0.0,1.0);gl_FragColor=color0;
#ifdef ENCODE_OUTPUT
#include <colorspace_fragment>
#endif
#include <dithering_fragment>
}`,ff="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEAD void main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORT gl_Position=vec4(position.xy,1.0,1.0);}",pf=class extends Jt{constructor(n,e,t,s,i=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:Ra.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new X(null),depthBuffer:new X(null),resolution:new X(new Fe),texelSize:new X(new Fe),cameraNear:new X(.3),cameraFar:new X(1e3),aspect:new X(1),time:new X(0)},blending:ys,toneMapped:!1,depthWrite:!1,depthTest:!1,dithering:i}),n&&this.setShaderParts(n),e&&this.setDefines(e),t&&this.setUniforms(t),this.copyCameraSettings(s)}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(n){this.uniforms.depthBuffer.value=n}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,e=Jn){this.depthBuffer=n,this.depthPacking=e}setShaderData(n){this.setShaderParts(n.shaderParts),this.setDefines(n.defines),this.setUniforms(n.uniforms),this.setExtensions(n.extensions)}setShaderParts(n){return this.fragmentShader=df.replace(oe.FRAGMENT_HEAD,n.get(oe.FRAGMENT_HEAD)||"").replace(oe.FRAGMENT_MAIN_UV,n.get(oe.FRAGMENT_MAIN_UV)||"").replace(oe.FRAGMENT_MAIN_IMAGE,n.get(oe.FRAGMENT_MAIN_IMAGE)||""),this.vertexShader=ff.replace(oe.VERTEX_HEAD,n.get(oe.VERTEX_HEAD)||"").replace(oe.VERTEX_MAIN_SUPPORT,n.get(oe.VERTEX_MAIN_SUPPORT)||""),this.fragmentShader=tr(this.fragmentShader),this.needsUpdate=!0,this}setDefines(n){for(const e of n.entries())this.defines[e[0]]=e[1];return this.needsUpdate=!0,this}setUniforms(n){for(const e of n.entries())this.uniforms[e[0]]=e[1];return this}setExtensions(n){this.extensions={};for(const e of n)this.extensions[e]=!0;return this}get encodeOutput(){return this.defines.ENCODE_OUTPUT!==void 0}set encodeOutput(n){this.encodeOutput!==n&&(n?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(n){return this.encodeOutput}setOutputEncodingEnabled(n){this.encodeOutput=n}get time(){return this.uniforms.time.value}set time(n){this.uniforms.time.value=n}setDeltaTime(n){this.uniforms.time.value+=n}adoptCameraSettings(n){this.copyCameraSettings(n)}copyCameraSettings(n){n&&(this.uniforms.cameraNear.value=n.near,this.uniforms.cameraFar.value=n.far,n instanceof lo?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(n,e){const t=this.uniforms;t.resolution.value.set(n,e),t.texelSize.value.set(1/n,1/e),t.aspect.value=n/e}static get Section(){return oe}},mf=`#include <common>
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef RANGE
uniform vec2 range;
#elif defined(THRESHOLD)
uniform float threshold;uniform float smoothing;
#endif
varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);
#ifdef RANGE
float low=step(range.x,l);float high=step(l,range.y);l*=low*high;
#elif defined(THRESHOLD)
l=smoothstep(threshold,threshold+smoothing,l);
#endif
#ifdef COLOR
gl_FragColor=vec4(texel.rgb*l,l);
#else
gl_FragColor=vec4(l);
#endif
}`,_f=class extends Jt{constructor(n=!1,e=null){super({name:"LuminanceMaterial",defines:{THREE_REVISION:Ra.replace(/\D+/g,"")},uniforms:{inputBuffer:new X(null),threshold:new X(0),smoothing:new X(1),range:new X(null)},blending:ys,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:mf,vertexShader:Hl}),this.colorOutput=n,this.luminanceRange=e}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}get threshold(){return this.uniforms.threshold.value}set threshold(n){this.smoothing>0||n>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=n}getThreshold(){return this.threshold}setThreshold(n){this.threshold=n}get smoothing(){return this.uniforms.smoothing.value}set smoothing(n){this.threshold>0||n>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=n}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(n){this.smoothing=n}get useThreshold(){return this.threshold>0||this.smoothing>0}set useThreshold(n){}get colorOutput(){return this.defines.COLOR!==void 0}set colorOutput(n){n?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(n){return this.colorOutput}setColorOutputEnabled(n){this.colorOutput=n}get useRange(){return this.luminanceRange!==null}set useRange(n){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(n){n!==null?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=n,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(n){this.luminanceRange=n}},gf="uniform lowp sampler2D inputBuffer;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 c0=texture2D(inputBuffer,vUv0).rg;vec2 c1=texture2D(inputBuffer,vUv1).rg;vec2 c2=texture2D(inputBuffer,vUv2).rg;vec2 c3=texture2D(inputBuffer,vUv3).rg;float d0=(c0.x-c1.x)*0.5;float d1=(c2.x-c3.x)*0.5;float d=length(vec2(d0,d1));float a0=min(c0.y,c1.y);float a1=min(c2.y,c3.y);float visibilityFactor=min(a0,a1);gl_FragColor.rg=(1.0-visibilityFactor>0.001)?vec2(d,0.0):vec2(0.0,d);}",vf="uniform vec2 texelSize;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vUv0=vec2(uv.x+texelSize.x,uv.y);vUv1=vec2(uv.x-texelSize.x,uv.y);vUv2=vec2(uv.x,uv.y+texelSize.y);vUv3=vec2(uv.x,uv.y-texelSize.y);gl_Position=vec4(position.xy,1.0,1.0);}",yf=class extends Jt{constructor(n=new Fe){super({name:"OutlineMaterial",uniforms:{inputBuffer:new X(null),texelSize:new X(new Fe)},blending:ys,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:gf,vertexShader:vf}),this.uniforms.texelSize.value.set(n.x,n.y),this.uniforms.maskTexture=this.uniforms.inputBuffer}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}setTexelSize(n,e){this.uniforms.texelSize.value.set(n,e)}setSize(n,e){this.uniforms.texelSize.value.set(1/n,1/e)}},Tf=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;uniform mediump sampler2D supportBuffer;
#else
uniform lowp sampler2D inputBuffer;uniform lowp sampler2D supportBuffer;
#endif
uniform float radius;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vec4 c=vec4(0.0);c+=texture2D(inputBuffer,vUv0)*0.0625;c+=texture2D(inputBuffer,vUv1)*0.125;c+=texture2D(inputBuffer,vUv2)*0.0625;c+=texture2D(inputBuffer,vUv3)*0.125;c+=texture2D(inputBuffer,vUv)*0.25;c+=texture2D(inputBuffer,vUv4)*0.125;c+=texture2D(inputBuffer,vUv5)*0.0625;c+=texture2D(inputBuffer,vUv6)*0.125;c+=texture2D(inputBuffer,vUv7)*0.0625;vec4 baseColor=texture2D(supportBuffer,vUv);gl_FragColor=mix(baseColor,c,radius);
#include <colorspace_fragment>
}`,xf="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,1.0);vUv1=vUv+texelSize*vec2(0.0,1.0);vUv2=vUv+texelSize*vec2(1.0,1.0);vUv3=vUv+texelSize*vec2(-1.0,0.0);vUv4=vUv+texelSize*vec2(1.0,0.0);vUv5=vUv+texelSize*vec2(-1.0,-1.0);vUv6=vUv+texelSize*vec2(0.0,-1.0);vUv7=vUv+texelSize*vec2(1.0,-1.0);gl_Position=vec4(position.xy,1.0,1.0);}",wf=class extends Jt{constructor(){super({name:"UpsamplingMaterial",uniforms:{inputBuffer:new X(null),supportBuffer:new X(null),texelSize:new X(new Fe),radius:new X(.85)},blending:ys,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Tf,vertexShader:xf}),this.fragmentShader=tr(this.fragmentShader)}set inputBuffer(n){this.uniforms.inputBuffer.value=n}set supportBuffer(n){this.uniforms.supportBuffer.value=n}get radius(){return this.uniforms.radius.value}set radius(n){this.uniforms.radius.value=n}setSize(n,e){this.uniforms.texelSize.value.set(1/n,1/e)}},Sf=new gd,Ss=null;function bf(){if(Ss===null){const n=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),e=new Float32Array([0,0,2,0,0,2]);Ss=new vd,Ss.setAttribute!==void 0?(Ss.setAttribute("position",new mr(n,3)),Ss.setAttribute("uv",new mr(e,2))):(Ss.addAttribute("position",new mr(n,3)),Ss.addAttribute("uv",new mr(e,2)))}return Ss}var st=class Yl{constructor(e="Pass",t=new Dc,s=Sf){this.name=e,this.renderer=null,this.scene=t,this.camera=s,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(e){if(this.rtt===e){const t=this.fullscreenMaterial;t!==null&&(t.needsUpdate=!0),this.rtt=!e}}set mainScene(e){}set mainCamera(e){}setRenderer(e){this.renderer=e}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(e){let t=this.screen;t!==null?t.material=e:(t=new md(bf(),e),t.frustumCulled=!1,this.scene===null&&(this.scene=new Dc),this.scene.add(t),this.screen=t)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(e){this.fullscreenMaterial=e}getDepthTexture(){return null}setDepthTexture(e,t=Jn){}render(e,t,s,i,r){throw new Error("Render method not implemented!")}setSize(e,t){}initialize(e,t,s){}dispose(){for(const e of Object.keys(this)){const t=this[e];(t instanceof Tt||t instanceof Nl||t instanceof Il||t instanceof Yl)&&this[e].dispose()}}},Cf=class extends st{constructor(n,e=!0){super("CopyPass"),this.fullscreenMaterial=new jl,this.needsSwap=!1,this.renderTarget=n,n===void 0&&(this.renderTarget=new Tt(1,1,{minFilter:Pr,magFilter:Pr,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=e}get resize(){return this.autoResize}set resize(n){this.autoResize=n}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(n){this.autoResize=n}render(n,e,t,s,i){this.fullscreenMaterial.inputBuffer=e.texture,n.setRenderTarget(this.renderToScreen?null:this.renderTarget),n.render(this.scene,this.camera)}setSize(n,e){this.autoResize&&this.renderTarget.setSize(n,e)}initialize(n,e,t){t!==void 0&&(this.renderTarget.texture.type=t,t!==fs?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":zn(n)===We&&Rs(this.renderTarget.texture,We))}},Ef=class extends st{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(n,e,t,s,i){const r=n.state.buffers.stencil;r.setLocked(!1),r.setTest(!1)}},Hc=new As,Fa=class extends st{constructor(n=!0,e=!0,t=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=n,this.depth=e,this.stencil=t,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(n,e,t){this.color=n,this.depth=e,this.stencil=t}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(n){this.overrideClearColor=n}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(n){this.overrideClearAlpha=n}render(n,e,t,s,i){const r=this.overrideClearColor,o=this.overrideClearAlpha,a=n.getClearAlpha(),c=r!==null,l=o>=0;c?(n.getClearColor(Hc),n.setClearColor(r,l?o:a)):l&&n.setClearAlpha(o),n.setRenderTarget(this.renderToScreen?null:e),n.clear(this.color,this.depth,this.stencil),c?n.setClearColor(Hc,a):l&&n.setClearAlpha(a)}},po=class extends st{constructor(n,e,t=null){super("RenderPass",n,e),this.needsSwap=!1,this.clearPass=new Fa,this.overrideMaterialManager=t===null?null:new Wc(t),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}set mainScene(n){this.scene=n}set mainCamera(n){this.camera=n}get renderToScreen(){return super.renderToScreen}set renderToScreen(n){super.renderToScreen=n,this.clearPass.renderToScreen=n}get overrideMaterial(){const n=this.overrideMaterialManager;return n!==null?n.material:null}set overrideMaterial(n){const e=this.overrideMaterialManager;n!==null?e!==null?e.setMaterial(n):this.overrideMaterialManager=new Wc(n):e!==null&&(e.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(n){this.overrideMaterial=n}get clear(){return this.clearPass.enabled}set clear(n){this.clearPass.enabled=n}getSelection(){return this.selection}setSelection(n){this.selection=n}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(n){this.ignoreBackground=n}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(n){this.skipShadowMapUpdate=n}getClearPass(){return this.clearPass}render(n,e,t,s,i){const r=this.scene,o=this.camera,a=this.selection,c=o.layers.mask,l=r.background,u=n.shadowMap.autoUpdate,h=this.renderToScreen?null:e;a!==null&&o.layers.set(a.getLayer()),this.skipShadowMapUpdate&&(n.shadowMap.autoUpdate=!1),(this.ignoreBackground||this.clearPass.overrideClearColor!==null)&&(r.background=null),this.clearPass.enabled&&this.clearPass.render(n,e),n.setRenderTarget(h),this.overrideMaterialManager!==null?this.overrideMaterialManager.render(n,r,o):n.render(r,o),o.layers.mask=c,r.background=l,n.shadowMap.autoUpdate=u}},Of=class extends st{constructor(n,e,{renderTarget:t,resolutionScale:s=1,width:i=Le.AUTO_SIZE,height:r=Le.AUTO_SIZE,resolutionX:o=i,resolutionY:a=r}={}){super("DepthPass"),this.needsSwap=!1,this.renderPass=new po(n,e,new _d({depthPacking:ta}));const c=this.renderPass;c.skipShadowMapUpdate=!0,c.ignoreBackground=!0;const l=c.clearPass;l.overrideClearColor=new As(16777215),l.overrideClearAlpha=1,this.renderTarget=t,this.renderTarget===void 0&&(this.renderTarget=new Tt(1,1,{minFilter:Bn,magFilter:Bn}),this.renderTarget.texture.name="DepthPass.Target");const u=this.resolution=new Le(this,o,a,s);u.addEventListener("change",h=>this.setSize(u.baseWidth,u.baseHeight))}set mainScene(n){this.renderPass.mainScene=n}set mainCamera(n){this.renderPass.mainCamera=n}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}render(n,e,t,s,i){const r=this.renderToScreen?null:this.renderTarget;this.renderPass.render(n,r)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e),this.renderTarget.setSize(t.width,t.height)}},Af=class extends st{constructor({normalBuffer:n=null,resolutionScale:e=.5,width:t=Le.AUTO_SIZE,height:s=Le.AUTO_SIZE,resolutionX:i=t,resolutionY:r=s}={}){super("DepthDownsamplingPass");const o=new cf;o.normalBuffer=n,this.fullscreenMaterial=o,this.needsDepthTexture=!0,this.needsSwap=!1,this.renderTarget=new Tt(1,1,{minFilter:Bn,magFilter:Bn,depthBuffer:!1,type:ad}),this.renderTarget.texture.name="DepthDownsamplingPass.Target",this.renderTarget.texture.generateMipmaps=!1;const a=this.resolution=new Le(this,i,r,e);a.addEventListener("change",c=>this.setSize(a.baseWidth,a.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}setDepthTexture(n,e=Jn){this.fullscreenMaterial.depthBuffer=n,this.fullscreenMaterial.depthPacking=e}render(n,e,t,s,i){n.setRenderTarget(this.renderToScreen?null:this.renderTarget),n.render(this.scene,this.camera)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e),this.renderTarget.setSize(t.width,t.height),this.fullscreenMaterial.setSize(n,e)}initialize(n,e,t){const s=n.getContext();if(!(s.getExtension("EXT_color_buffer_float")||s.getExtension("EXT_color_buffer_half_float")))throw new Error("Rendering to float texture is not supported.")}};function qc(n,e,t){for(const s of e){const i="$1"+n+s.charAt(0).toUpperCase()+s.slice(1),r=new RegExp("([^\\.])(\\b"+s+"\\b)","g");for(const o of t.entries())o[1]!==null&&t.set(o[0],o[1].replace(r,i))}}function Mf(n,e,t){let s=e.getFragmentShader(),i=e.getVertexShader();const r=s!==void 0&&/mainImage/.test(s),o=s!==void 0&&/mainUv/.test(s);if(t.attributes|=e.getAttributes(),s===void 0)throw new Error(`Missing fragment shader (${e.name})`);if(o&&t.attributes&hs.CONVOLUTION)throw new Error(`Effects that transform UVs are incompatible with convolution effects (${e.name})`);if(!r&&!o)throw new Error(`Could not find mainImage or mainUv function (${e.name})`);{const a=/\w+\s+(\w+)\([\w\s,]*\)\s*{/g,c=t.shaderParts;let l=c.get(oe.FRAGMENT_HEAD)||"",u=c.get(oe.FRAGMENT_MAIN_UV)||"",h=c.get(oe.FRAGMENT_MAIN_IMAGE)||"",d=c.get(oe.VERTEX_HEAD)||"",f=c.get(oe.VERTEX_MAIN_SUPPORT)||"";const m=new Set,p=new Set;if(o&&(u+=`	${n}MainUv(UV);
`,t.uvTransformation=!0),i!==null&&/mainSupport/.test(i)){const S=/mainSupport *\([\w\s]*?uv\s*?\)/.test(i);f+=`	${n}MainSupport(`,f+=S?`vUv);
`:`);
`;for(const b of i.matchAll(/(?:varying\s+\w+\s+([\S\s]*?);)/g))for(const v of b[1].split(/\s*,\s*/))t.varyings.add(v),m.add(v),p.add(v);for(const b of i.matchAll(a))p.add(b[1])}for(const S of s.matchAll(a))p.add(S[1]);for(const S of e.defines.keys())p.add(S.replace(/\([\w\s,]*\)/g,""));for(const S of e.uniforms.keys())p.add(S);p.delete("while"),p.delete("for"),p.delete("if"),e.uniforms.forEach((S,b)=>t.uniforms.set(n+b.charAt(0).toUpperCase()+b.slice(1),S)),e.defines.forEach((S,b)=>t.defines.set(n+b.charAt(0).toUpperCase()+b.slice(1),S));const _=new Map([["fragment",s],["vertex",i]]);qc(n,p,t.defines),qc(n,p,_),s=_.get("fragment"),i=_.get("vertex");const y=e.blendMode;if(t.blendModes.set(y.blendFunction,y),r){e.inputColorSpace!==null&&e.inputColorSpace!==t.colorSpace&&(h+=e.inputColorSpace===We?`color0 = LinearTosRGB(color0);
	`:`color0 = sRGBToLinear(color0);
	`),e.outputColorSpace!==ql?t.colorSpace=e.outputColorSpace:e.inputColorSpace!==null&&(t.colorSpace=e.inputColorSpace);const S=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/;h+=`${n}MainImage(color0, UV, `,t.attributes&hs.DEPTH&&S.test(s)&&(h+="depth, ",t.readDepth=!0),h+=`color1);
	`;const b=n+"BlendOpacity";t.uniforms.set(b,y.opacity),h+=`color0 = blend${y.blendFunction}(color0, color1, ${b});

	`,l+=`uniform float ${b};

`}if(l+=s+`
`,i!==null&&(d+=i+`
`),c.set(oe.FRAGMENT_HEAD,l),c.set(oe.FRAGMENT_MAIN_UV,u),c.set(oe.FRAGMENT_MAIN_IMAGE,h),c.set(oe.VERTEX_HEAD,d),c.set(oe.VERTEX_MAIN_SUPPORT,f),e.extensions!==null)for(const S of e.extensions)t.extensions.add(S)}}var Df=class extends st{constructor(n,...e){super("EffectPass"),this.fullscreenMaterial=new pf(null,null,null,n),this.listener=t=>this.handleEvent(t),this.effects=[],this.setEffects(e),this.skipRendering=!1,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY,this.timeScale=1}set mainScene(n){for(const e of this.effects)e.mainScene=n}set mainCamera(n){this.fullscreenMaterial.copyCameraSettings(n);for(const e of this.effects)e.mainCamera=n}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(n){this.fullscreenMaterial.encodeOutput=n}get dithering(){return this.fullscreenMaterial.dithering}set dithering(n){const e=this.fullscreenMaterial;e.dithering=n,e.needsUpdate=!0}setEffects(n){for(const e of this.effects)e.removeEventListener("change",this.listener);this.effects=n.sort((e,t)=>t.attributes-e.attributes);for(const e of this.effects)e.addEventListener("change",this.listener)}updateMaterial(){const n=new Bf;let e=0;for(const o of this.effects)if(o.blendMode.blendFunction===K.DST)n.attributes|=o.getAttributes()&hs.DEPTH;else{if(n.attributes&o.getAttributes()&hs.CONVOLUTION)throw new Error(`Convolution effects cannot be merged (${o.name})`);Mf("e"+e++,o,n)}let t=n.shaderParts.get(oe.FRAGMENT_HEAD),s=n.shaderParts.get(oe.FRAGMENT_MAIN_IMAGE),i=n.shaderParts.get(oe.FRAGMENT_MAIN_UV);const r=/\bblend\b/g;for(const o of n.blendModes.values())t+=o.getShaderCode().replace(r,`blend${o.blendFunction}`)+`
`;n.attributes&hs.DEPTH?(n.readDepth&&(s=`float depth = readDepth(UV);

	`+s),this.needsDepthTexture=this.getDepthTexture()===null):this.needsDepthTexture=!1,n.colorSpace===We&&(s+=`color0 = sRGBToLinear(color0);
	`),n.uvTransformation?(i=`vec2 transformedUv = vUv;
`+i,n.defines.set("UV","transformedUv")):n.defines.set("UV","vUv"),n.shaderParts.set(oe.FRAGMENT_HEAD,t),n.shaderParts.set(oe.FRAGMENT_MAIN_IMAGE,s),n.shaderParts.set(oe.FRAGMENT_MAIN_UV,i);for(const[o,a]of n.shaderParts)a!==null&&n.shaderParts.set(o,a.trim().replace(/^#/,`
#`));this.skipRendering=e===0,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderData(n)}recompile(){this.updateMaterial()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(n,e=Jn){this.fullscreenMaterial.depthBuffer=n,this.fullscreenMaterial.depthPacking=e;for(const t of this.effects)t.setDepthTexture(n,e)}render(n,e,t,s,i){for(const r of this.effects)r.update(n,e,s);if(!this.skipRendering||this.renderToScreen){const r=this.fullscreenMaterial;r.inputBuffer=e.texture,r.time+=s*this.timeScale,n.setRenderTarget(this.renderToScreen?null:t),n.render(this.scene,this.camera)}}setSize(n,e){this.fullscreenMaterial.setSize(n,e);for(const t of this.effects)t.setSize(n,e)}initialize(n,e,t){this.renderer=n;for(const s of this.effects)s.initialize(n,e,t);this.updateMaterial(),t!==void 0&&t!==fs&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(const n of this.effects)n.removeEventListener("change",this.listener),n.dispose()}handleEvent(n){switch(n.type){case"change":this.recompile();break}}},Zl=class extends st{constructor({kernelSize:n=fo.MEDIUM,resolutionScale:e=.5,width:t=Le.AUTO_SIZE,height:s=Le.AUTO_SIZE,resolutionX:i=t,resolutionY:r=s}={}){super("KawaseBlurPass"),this.renderTargetA=new Tt(1,1,{depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";const o=this.resolution=new Le(this,i,r,e);o.addEventListener("change",a=>this.setSize(o.baseWidth,o.baseHeight)),this._blurMaterial=new ef,this._blurMaterial.kernelSize=n,this.copyMaterial=new jl}getResolution(){return this.resolution}get blurMaterial(){return this._blurMaterial}set blurMaterial(n){this._blurMaterial=n}get dithering(){return this.copyMaterial.dithering}set dithering(n){this.copyMaterial.dithering=n}get kernelSize(){return this.blurMaterial.kernelSize}set kernelSize(n){this.blurMaterial.kernelSize=n}get width(){return this.resolution.width}set width(n){this.resolution.preferredWidth=n}get height(){return this.resolution.height}set height(n){this.resolution.preferredHeight=n}get scale(){return this.blurMaterial.scale}set scale(n){this.blurMaterial.scale=n}getScale(){return this.blurMaterial.scale}setScale(n){this.blurMaterial.scale=n}getKernelSize(){return this.kernelSize}setKernelSize(n){this.kernelSize=n}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}render(n,e,t,s,i){const r=this.scene,o=this.camera,a=this.renderTargetA,c=this.renderTargetB,l=this.blurMaterial,u=l.kernelSequence;let h=e;this.fullscreenMaterial=l;for(let d=0,f=u.length;d<f;++d){const m=d&1?c:a;l.kernel=u[d],l.inputBuffer=h.texture,n.setRenderTarget(m),n.render(r,o),h=m}this.fullscreenMaterial=this.copyMaterial,this.copyMaterial.inputBuffer=h.texture,n.setRenderTarget(this.renderToScreen?null:t),n.render(r,o)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e);const s=t.width,i=t.height;this.renderTargetA.setSize(s,i),this.renderTargetB.setSize(s,i),this.blurMaterial.setSize(n,e)}initialize(n,e,t){t!==void 0&&(this.renderTargetA.texture.type=t,this.renderTargetB.texture.type=t,t!==fs?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.copyMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):zn(n)===We&&(Rs(this.renderTargetA.texture,We),Rs(this.renderTargetB.texture,We)))}static get AUTO_SIZE(){return Le.AUTO_SIZE}},kf=class extends st{constructor({renderTarget:n,luminanceRange:e,colorOutput:t,resolutionScale:s=1,width:i=Le.AUTO_SIZE,height:r=Le.AUTO_SIZE,resolutionX:o=i,resolutionY:a=r}={}){super("LuminancePass"),this.fullscreenMaterial=new _f(t,e),this.needsSwap=!1,this.renderTarget=n,this.renderTarget===void 0&&(this.renderTarget=new Tt(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target");const c=this.resolution=new Le(this,o,a,s);c.addEventListener("change",l=>this.setSize(c.baseWidth,c.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(n,e,t,s,i){const r=this.fullscreenMaterial;r.inputBuffer=e.texture,n.setRenderTarget(this.renderToScreen?null:this.renderTarget),n.render(this.scene,this.camera)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e),this.renderTarget.setSize(t.width,t.height)}initialize(n,e,t){t!==void 0&&t!==fs&&(this.renderTarget.texture.type=t,this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},Rf=class extends st{constructor(n,e){super("MaskPass",n,e),this.needsSwap=!1,this.clearPass=new Fa(!1,!1,!0),this.inverse=!1}set mainScene(n){this.scene=n}set mainCamera(n){this.camera=n}get inverted(){return this.inverse}set inverted(n){this.inverse=n}get clear(){return this.clearPass.enabled}set clear(n){this.clearPass.enabled=n}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(n){this.inverted=n}render(n,e,t,s,i){const r=n.getContext(),o=n.state.buffers,a=this.scene,c=this.camera,l=this.clearPass,u=this.inverted?0:1,h=1-u;o.color.setMask(!1),o.depth.setMask(!1),o.color.setLocked(!0),o.depth.setLocked(!0),o.stencil.setTest(!0),o.stencil.setOp(r.REPLACE,r.REPLACE,r.REPLACE),o.stencil.setFunc(r.ALWAYS,u,4294967295),o.stencil.setClear(h),o.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?l.render(n,null):(l.render(n,e),l.render(n,t))),this.renderToScreen?(n.setRenderTarget(null),n.render(a,c)):(n.setRenderTarget(e),n.render(a,c),n.setRenderTarget(t),n.render(a,c)),o.color.setLocked(!1),o.depth.setLocked(!1),o.stencil.setLocked(!1),o.stencil.setFunc(r.EQUAL,1,4294967295),o.stencil.setOp(r.KEEP,r.KEEP,r.KEEP),o.stencil.setLocked(!0)}},Pf=class extends st{constructor(){super("MipmapBlurPass"),this.needsSwap=!1,this.renderTarget=new Tt(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Upsampling.Mipmap0",this.downsamplingMipmaps=[],this.upsamplingMipmaps=[],this.downsamplingMaterial=new hf,this.upsamplingMaterial=new wf,this.resolution=new Fe}get texture(){return this.renderTarget.texture}get levels(){return this.downsamplingMipmaps.length}set levels(n){if(this.levels!==n){const e=this.renderTarget;this.dispose(),this.downsamplingMipmaps=[],this.upsamplingMipmaps=[];for(let t=0;t<n;++t){const s=e.clone();s.texture.name="Downsampling.Mipmap"+t,this.downsamplingMipmaps.push(s)}this.upsamplingMipmaps.push(e);for(let t=1,s=n-1;t<s;++t){const i=e.clone();i.texture.name="Upsampling.Mipmap"+t,this.upsamplingMipmaps.push(i)}this.setSize(this.resolution.x,this.resolution.y)}}get radius(){return this.upsamplingMaterial.radius}set radius(n){this.upsamplingMaterial.radius=n}render(n,e,t,s,i){const{scene:r,camera:o}=this,{downsamplingMaterial:a,upsamplingMaterial:c}=this,{downsamplingMipmaps:l,upsamplingMipmaps:u}=this;let h=e;this.fullscreenMaterial=a;for(let d=0,f=l.length;d<f;++d){const m=l[d];a.setSize(h.width,h.height),a.inputBuffer=h.texture,n.setRenderTarget(m),n.render(r,o),h=m}this.fullscreenMaterial=c;for(let d=u.length-1;d>=0;--d){const f=u[d];c.setSize(h.width,h.height),c.inputBuffer=h.texture,c.supportBuffer=l[d].texture,n.setRenderTarget(f),n.render(r,o),h=f}}setSize(n,e){const t=this.resolution;t.set(n,e);let s=t.width,i=t.height;for(let r=0,o=this.downsamplingMipmaps.length;r<o;++r)s=Math.round(s*.5),i=Math.round(i*.5),this.downsamplingMipmaps[r].setSize(s,i),r<this.upsamplingMipmaps.length&&this.upsamplingMipmaps[r].setSize(s,i)}initialize(n,e,t){if(t!==void 0){const s=this.downsamplingMipmaps.concat(this.upsamplingMipmaps);for(const i of s)i.texture.type=t;if(t!==fs)this.downsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.upsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1";else if(zn(n)===We)for(const i of s)Rs(i.texture,We)}}dispose(){super.dispose();for(const n of this.downsamplingMipmaps.concat(this.upsamplingMipmaps))n.dispose()}},Nf=class extends st{constructor(n,e,{renderTarget:t,resolutionScale:s=1,width:i=Le.AUTO_SIZE,height:r=Le.AUTO_SIZE,resolutionX:o=i,resolutionY:a=r}={}){super("NormalPass"),this.needsSwap=!1,this.renderPass=new po(n,e,new cd);const c=this.renderPass;c.ignoreBackground=!0,c.skipShadowMapUpdate=!0;const l=c.getClearPass();l.overrideClearColor=new As(7829503),l.overrideClearAlpha=1,this.renderTarget=t,this.renderTarget===void 0&&(this.renderTarget=new Tt(1,1,{minFilter:Bn,magFilter:Bn}),this.renderTarget.texture.name="NormalPass.Target");const u=this.resolution=new Le(this,o,a,s);u.addEventListener("change",h=>this.setSize(u.baseWidth,u.baseHeight))}set mainScene(n){this.renderPass.mainScene=n}set mainCamera(n){this.renderPass.mainCamera=n}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}render(n,e,t,s,i){const r=this.renderToScreen?null:this.renderTarget;this.renderPass.render(n,r,r)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e),this.renderTarget.setSize(t.width,t.height)}},If=class extends st{constructor(n,e="inputBuffer"){super("ShaderPass"),this.fullscreenMaterial=n,this.input=e}setInput(n){this.input=n}render(n,e,t,s,i){const r=this.fullscreenMaterial.uniforms;e!==null&&r!==void 0&&r[this.input]!==void 0&&(r[this.input].value=e.texture),n.setRenderTarget(this.renderToScreen?null:t),n.render(this.scene,this.camera)}initialize(n,e,t){t!==void 0&&t!==fs&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},Ho=1/1e3,Ff=1e3,Uf=class{constructor(){this.startTime=performance.now(),this.previousTime=0,this.currentTime=0,this._delta=0,this._elapsed=0,this._fixedDelta=1e3/60,this.timescale=1,this.useFixedDelta=!1,this._autoReset=!1}get autoReset(){return this._autoReset}set autoReset(n){typeof document<"u"&&document.hidden!==void 0&&(n?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this._autoReset=n)}get delta(){return this._delta*Ho}get fixedDelta(){return this._fixedDelta*Ho}set fixedDelta(n){this._fixedDelta=n*Ff}get elapsed(){return this._elapsed*Ho}update(n){this.useFixedDelta?this._delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=(n!==void 0?n:performance.now())-this.startTime,this._delta=this.currentTime-this.previousTime),this._delta*=this.timescale,this._elapsed+=this._delta}reset(){this._delta=0,this._elapsed=0,this.currentTime=performance.now()-this.startTime}handleEvent(n){document.hidden||(this.currentTime=performance.now()-this.startTime)}dispose(){this.autoReset=!1}},Lf=class{constructor(e=null,{depthBuffer:t=!0,stencilBuffer:s=!1,multisampling:i=0,frameBufferType:r}={}){this.renderer=null,this.inputBuffer=this.createBuffer(t,s,r,i),this.outputBuffer=this.inputBuffer.clone(),this.copyPass=new Cf,this.depthTexture=null,this.passes=[],this.timer=new Uf,this.autoRenderToScreen=!0,this.setRenderer(e)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(e){const t=this.inputBuffer,s=this.multisampling;s>0&&e>0?(this.inputBuffer.samples=e,this.outputBuffer.samples=e,this.inputBuffer.dispose(),this.outputBuffer.dispose()):s!==e&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),this.inputBuffer=this.createBuffer(t.depthBuffer,t.stencilBuffer,t.texture.type,e),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(e){if(this.renderer=e,e!==null){const t=e.getSize(new Fe),s=e.getContext().getContextAttributes().alpha,i=this.inputBuffer.texture.type;i===fs&&zn(e)===We&&(Rs(this.inputBuffer.texture,We),Rs(this.outputBuffer.texture,We),this.inputBuffer.dispose(),this.outputBuffer.dispose()),e.autoClear=!1,this.setSize(t.width,t.height);for(const r of this.passes)r.initialize(e,s,i)}}replaceRenderer(e,t=!0){const s=this.renderer,i=s.domElement.parentNode;return this.setRenderer(e),t&&i!==null&&(i.removeChild(s.domElement),i.appendChild(e.domElement)),s}createDepthTexture(){const e=this.depthTexture=new ld;return this.inputBuffer.depthTexture=e,this.inputBuffer.dispose(),this.inputBuffer.stencilBuffer?(e.format=ud,e.type=hd):e.type=dd,e}deleteDepthTexture(){if(this.depthTexture!==null){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(const e of this.passes)e.setDepthTexture(null)}}createBuffer(e,t,s,i){const r=this.renderer,o=r===null?new Fe:r.getDrawingBufferSize(new Fe),a={minFilter:Pr,magFilter:Pr,stencilBuffer:t,depthBuffer:e,type:s},c=new Tt(o.width,o.height,a);return i>0&&(c.ignoreDepthForMultisampleCopy=!1,c.samples=i),s===fs&&zn(r)===We&&Rs(c.texture,We),c.texture.name="EffectComposer.Buffer",c.texture.generateMipmaps=!1,c}setMainScene(e){for(const t of this.passes)t.mainScene=e}setMainCamera(e){for(const t of this.passes)t.mainCamera=e}addPass(e,t){const s=this.passes,i=this.renderer,r=i.getDrawingBufferSize(new Fe),o=i.getContext().getContextAttributes().alpha,a=this.inputBuffer.texture.type;if(e.setRenderer(i),e.setSize(r.width,r.height),e.initialize(i,o,a),this.autoRenderToScreen&&(s.length>0&&(s[s.length-1].renderToScreen=!1),e.renderToScreen&&(this.autoRenderToScreen=!1)),t!==void 0?s.splice(t,0,e):s.push(e),this.autoRenderToScreen&&(s[s.length-1].renderToScreen=!0),e.needsDepthTexture||this.depthTexture!==null)if(this.depthTexture===null){const c=this.createDepthTexture();for(e of s)e.setDepthTexture(c)}else e.setDepthTexture(this.depthTexture)}removePass(e){const t=this.passes,s=t.indexOf(e);if(s!==-1&&t.splice(s,1).length>0){if(this.depthTexture!==null){const o=(c,l)=>c||l.needsDepthTexture;t.reduce(o,!1)||(e.getDepthTexture()===this.depthTexture&&e.setDepthTexture(null),this.deleteDepthTexture())}this.autoRenderToScreen&&s===t.length&&(e.renderToScreen=!1,t.length>0&&(t[t.length-1].renderToScreen=!0))}}removeAllPasses(){const e=this.passes;this.deleteDepthTexture(),e.length>0&&(this.autoRenderToScreen&&(e[e.length-1].renderToScreen=!1),this.passes=[])}render(e){const t=this.renderer,s=this.copyPass;let i=this.inputBuffer,r=this.outputBuffer,o=!1,a,c,l;e===void 0&&(this.timer.update(),e=this.timer.delta);for(const u of this.passes)u.enabled&&(u.render(t,i,r,e,o),u.needsSwap&&(o&&(s.renderToScreen=u.renderToScreen,a=t.getContext(),c=t.state.buffers.stencil,c.setFunc(a.NOTEQUAL,1,4294967295),s.render(t,i,r,e,o),c.setFunc(a.EQUAL,1,4294967295)),l=i,i=r,r=l),u instanceof Rf?o=!0:u instanceof Ef&&(o=!1))}setSize(e,t,s){const i=this.renderer,r=i.getSize(new Fe);(e===void 0||t===void 0)&&(e=r.width,t=r.height),(r.width!==e||r.height!==t)&&i.setSize(e,t,s);const o=i.getDrawingBufferSize(new Fe);this.inputBuffer.setSize(o.width,o.height),this.outputBuffer.setSize(o.width,o.height);for(const a of this.passes)a.setSize(o.width,o.height)}reset(){const e=this.timer.autoReset;this.dispose(),this.autoRenderToScreen=!0,this.timer.autoReset=e}dispose(){for(const e of this.passes)e.dispose();this.passes=[],this.inputBuffer!==null&&this.inputBuffer.dispose(),this.outputBuffer!==null&&this.outputBuffer.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose()}},Bf=class{constructor(){this.shaderParts=new Map([[oe.FRAGMENT_HEAD,null],[oe.FRAGMENT_MAIN_UV,null],[oe.FRAGMENT_MAIN_IMAGE,null],[oe.VERTEX_HEAD,null],[oe.VERTEX_MAIN_SUPPORT,null]]),this.defines=new Map,this.uniforms=new Map,this.blendModes=new Map,this.extensions=new Set,this.attributes=hs.NONE,this.varyings=new Set,this.uvTransformation=!1,this.readDepth=!1,this.colorSpace=ho}},qo=!1,Wc=class{constructor(n=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(n),this.meshCount=0,this.replaceMaterial=e=>{if(e.isMesh){let t;if(e.material.flatShading)switch(e.material.side){case Ti:t=this.materialsFlatShadedDoubleSide;break;case pr:t=this.materialsFlatShadedBackSide;break;default:t=this.materialsFlatShaded;break}else switch(e.material.side){case Ti:t=this.materialsDoubleSide;break;case pr:t=this.materialsBackSide;break;default:t=this.materials;break}this.originalMaterials.set(e,e.material),e.isSkinnedMesh?e.material=t[2]:e.isInstancedMesh?e.material=t[1]:e.material=t[0],++this.meshCount}}}cloneMaterial(n){if(!(n instanceof Jt))return n.clone();const e=n.uniforms,t=new Map;for(const i in e){const r=e[i].value;r.isRenderTargetTexture&&(e[i].value=null,t.set(i,r))}const s=n.clone();for(const i of t)e[i[0]].value=i[1],s.uniforms[i[0]].value=i[1];return s}setMaterial(n){if(this.disposeMaterials(),this.material=n,n!==null){const e=this.materials=[this.cloneMaterial(n),this.cloneMaterial(n),this.cloneMaterial(n)];for(const t of e)t.uniforms=Object.assign({},n.uniforms),t.side=fd;e[2].skinning=!0,this.materialsBackSide=e.map(t=>{const s=this.cloneMaterial(t);return s.uniforms=Object.assign({},n.uniforms),s.side=pr,s}),this.materialsDoubleSide=e.map(t=>{const s=this.cloneMaterial(t);return s.uniforms=Object.assign({},n.uniforms),s.side=Ti,s}),this.materialsFlatShaded=e.map(t=>{const s=this.cloneMaterial(t);return s.uniforms=Object.assign({},n.uniforms),s.flatShading=!0,s}),this.materialsFlatShadedBackSide=e.map(t=>{const s=this.cloneMaterial(t);return s.uniforms=Object.assign({},n.uniforms),s.flatShading=!0,s.side=pr,s}),this.materialsFlatShadedDoubleSide=e.map(t=>{const s=this.cloneMaterial(t);return s.uniforms=Object.assign({},n.uniforms),s.flatShading=!0,s.side=Ti,s})}}render(n,e,t){const s=n.shadowMap.enabled;if(n.shadowMap.enabled=!1,qo){const i=this.originalMaterials;this.meshCount=0,e.traverse(this.replaceMaterial),n.render(e,t);for(const r of i)r[0].material=r[1];this.meshCount!==i.size&&i.clear()}else{const i=e.overrideMaterial;e.overrideMaterial=this.material,n.render(e,t),e.overrideMaterial=i}n.shadowMap.enabled=s}disposeMaterials(){if(this.material!==null){const n=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(const e of n)e.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return qo}static set workaroundEnabled(n){qo=n}},bs=-1,Le=class extends ka{constructor(n,e=bs,t=bs,s=1){super(),this.resizable=n,this.baseSize=new Fe(1,1),this.preferredSize=new Fe(e,t),this.target=this.preferredSize,this.s=s,this.effectiveSize=new Fe,this.addEventListener("change",()=>this.updateEffectiveSize()),this.updateEffectiveSize()}updateEffectiveSize(){const n=this.baseSize,e=this.preferredSize,t=this.effectiveSize,s=this.scale;e.width!==bs?t.width=e.width:e.height!==bs?t.width=Math.round(e.height*(n.width/Math.max(n.height,1))):t.width=Math.round(n.width*s),e.height!==bs?t.height=e.height:e.width!==bs?t.height=Math.round(e.width/Math.max(n.width/Math.max(n.height,1),1)):t.height=Math.round(n.height*s)}get width(){return this.effectiveSize.width}set width(n){this.preferredWidth=n}get height(){return this.effectiveSize.height}set height(n){this.preferredHeight=n}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(n){this.s!==n&&(this.s=n,this.preferredSize.setScalar(bs),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getScale(){return this.scale}setScale(n){this.scale=n}get baseWidth(){return this.baseSize.width}set baseWidth(n){this.baseSize.width!==n&&(this.baseSize.width=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseWidth(){return this.baseWidth}setBaseWidth(n){this.baseWidth=n}get baseHeight(){return this.baseSize.height}set baseHeight(n){this.baseSize.height!==n&&(this.baseSize.height=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(n){this.baseHeight=n}setBaseSize(n,e){(this.baseSize.width!==n||this.baseSize.height!==e)&&(this.baseSize.set(n,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}get preferredWidth(){return this.preferredSize.width}set preferredWidth(n){this.preferredSize.width!==n&&(this.preferredSize.width=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(n){this.preferredWidth=n}get preferredHeight(){return this.preferredSize.height}set preferredHeight(n){this.preferredSize.height!==n&&(this.preferredSize.height=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(n){this.preferredHeight=n}setPreferredSize(n,e){(this.preferredSize.width!==n||this.preferredSize.height!==e)&&(this.preferredSize.set(n,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}copy(n){this.s=n.scale,this.baseSize.set(n.baseWidth,n.baseHeight),this.preferredSize.set(n.preferredWidth,n.preferredHeight),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height)}static get AUTO_SIZE(){return bs}},zf=class extends Set{constructor(n,e=10){super(),this.l=e,this.exclusive=!1,n!==void 0&&this.set(n)}get layer(){return this.l}set layer(n){const e=this.l;for(const t of this)t.layers.disable(e),t.layers.enable(n);this.l=n}getLayer(){return this.layer}setLayer(n){this.layer=n}isExclusive(){return this.exclusive}setExclusive(n){this.exclusive=n}clear(){const n=this.layer;for(const e of this)e.layers.disable(n);return super.clear()}set(n){this.clear();for(const e of n)this.add(e);return this}indexOf(n){return this.has(n)?0:-1}add(n){return this.exclusive?n.layers.set(this.layer):n.layers.enable(this.layer),super.add(n)}delete(n){return this.has(n)&&n.layers.disable(this.layer),super.delete(n)}toggle(n){let e;return this.has(n)?(this.delete(n),e=!1):(this.add(n),e=!0),e}setVisible(n){for(const e of this)n?e.layers.enable(0):e.layers.disable(0);return this}},Vf="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y,opacity);}",Hf="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,min(y.a,opacity));}",qf="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y)*0.5,opacity);}",Wf="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.rg,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",Gf="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(step(0.0,y)*(1.0-min(vec4(1.0),(1.0-x)/y)),vec4(1.0),step(1.0,x));return mix(x,z,opacity);}",jf="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=step(0.0,x)*mix(min(vec4(1.0),x/max(1.0-y,1e-9)),vec4(1.0),step(1.0,y));return mix(x,z,opacity);}",Yf="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x,y),opacity);}",Zf="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,abs(x-y),opacity);}",Xf="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x/max(y,1e-12),opacity);}",$f="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y-2.0*x*y),opacity);}",Qf="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 a=min(x,1.0),b=min(y,1.0);vec4 z=mix(2.0*a*b,1.0-2.0*(1.0-a)*(1.0-b),step(0.5,y));return mix(x,z,opacity);}",Kf="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,step(1.0,x+y),opacity);}",Jf="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.r,xHSL.gb));return vec4(mix(x.rgb,z,opacity),y.a);}",ep="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-y,opacity);}",tp="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y*(1.0-x),opacity);}",sp="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x,y),opacity);}",np="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(y+x-1.0,0.0,1.0),opacity);}",ip="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x+y,1.0),opacity);}",rp="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(2.0*y+x-1.0,0.0,1.0),opacity);}",op="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.rg,yHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",ap="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x*y,opacity);}",cp="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-abs(1.0-x-y),opacity);}",lp="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,opacity);}",up="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(2.0*y*x,1.0-2.0*(1.0-y)*(1.0-x),step(0.5,x));return mix(x,z,opacity);}",hp="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 z=mix(mix(y2,x,step(0.5*x,y)),max(vec4(0.0),y2-1.0),step(x,(y2-1.0)));return mix(x,z,opacity);}",dp="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(min(x*x/max(1.0-y,1e-12),1.0),y,step(1.0,y));return mix(x,z,opacity);}",fp="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.r,yHSL.g,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",pp="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y-min(x*y,1.0),opacity);}",mp="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 w=step(0.5,y);vec4 z=mix(x-(1.0-y2)*x*(1.0-x),mix(x+(y2-1.0)*(sqrt(x)-x),x+(y2-1.0)*x*((16.0*x-12.0)*x+3.0),w*(1.0-step(0.25,x))),w);return mix(x,z,opacity);}",_p="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y;}",gp="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x+y-1.0,0.0),opacity);}",vp="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(max(1.0-min((1.0-x)/(2.0*y),1.0),0.0),min(x/(2.0*(1.0-y)),1.0),step(0.5,y));return mix(x,z,opacity);}",yp=new Map([[K.ADD,Vf],[K.ALPHA,Hf],[K.AVERAGE,qf],[K.COLOR,Wf],[K.COLOR_BURN,Gf],[K.COLOR_DODGE,jf],[K.DARKEN,Yf],[K.DIFFERENCE,Zf],[K.DIVIDE,Xf],[K.DST,null],[K.EXCLUSION,$f],[K.HARD_LIGHT,Qf],[K.HARD_MIX,Kf],[K.HUE,Jf],[K.INVERT,ep],[K.INVERT_RGB,tp],[K.LIGHTEN,sp],[K.LINEAR_BURN,np],[K.LINEAR_DODGE,ip],[K.LINEAR_LIGHT,rp],[K.LUMINOSITY,op],[K.MULTIPLY,ap],[K.NEGATION,cp],[K.NORMAL,lp],[K.OVERLAY,up],[K.PIN_LIGHT,hp],[K.REFLECT,dp],[K.SATURATION,fp],[K.SCREEN,pp],[K.SOFT_LIGHT,mp],[K.SRC,_p],[K.SUBTRACT,gp],[K.VIVID_LIGHT,vp]]),Tp=class extends ka{constructor(n,e=1){super(),this._blendFunction=n,this.opacity=new X(e)}getOpacity(){return this.opacity.value}setOpacity(n){this.opacity.value=n}get blendFunction(){return this._blendFunction}set blendFunction(n){this._blendFunction=n,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(n){this.blendFunction=n}getShaderCode(){return yp.get(this.blendFunction)}},Oi=class extends ka{constructor(e,t,{attributes:s=hs.NONE,blendFunction:i=K.NORMAL,defines:r=new Map,uniforms:o=new Map,extensions:a=null,vertexShader:c=null}={}){super(),this.name=e,this.renderer=null,this.attributes=s,this.fragmentShader=t,this.vertexShader=c,this.defines=r,this.uniforms=o,this.extensions=a,this.blendMode=new Tp(i),this.blendMode.addEventListener("change",l=>this.setChanged()),this._inputColorSpace=ho,this._outputColorSpace=ql}get inputColorSpace(){return this._inputColorSpace}set inputColorSpace(e){this._inputColorSpace=e,this.setChanged()}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e,this.setChanged()}set mainScene(e){}set mainCamera(e){}getName(){return this.name}setRenderer(e){this.renderer=e}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(e){this.attributes=e,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(e){this.fragmentShader=e,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(e){this.vertexShader=e,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(e,t=Jn){}update(e,t,s){}setSize(e,t){}initialize(e,t,s){}dispose(){for(const e of Object.keys(this)){const t=this[e];(t instanceof Tt||t instanceof Nl||t instanceof Il||t instanceof st)&&this[e].dispose()}}},xp=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 texel=texture2D(map,uv);outputColor=vec4(texel.rgb*intensity,texel.a);}`,wp=class extends Oi{constructor({blendFunction:n=K.SCREEN,luminanceThreshold:e=.9,luminanceSmoothing:t=.025,mipmapBlur:s=!1,intensity:i=1,radius:r=.85,levels:o=8,kernelSize:a=fo.LARGE,resolutionScale:c=.5,width:l=Le.AUTO_SIZE,height:u=Le.AUTO_SIZE,resolutionX:h=l,resolutionY:d=u}={}){super("BloomEffect",xp,{blendFunction:n,uniforms:new Map([["map",new X(null)],["intensity",new X(i)]])}),this.renderTarget=new Tt(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Bloom.Target",this.blurPass=new Zl({kernelSize:a}),this.luminancePass=new kf({colorOutput:!0}),this.luminanceMaterial.threshold=e,this.luminanceMaterial.smoothing=t,this.mipmapBlurPass=new Pf,this.mipmapBlurPass.enabled=s,this.mipmapBlurPass.radius=r,this.mipmapBlurPass.levels=o,this.uniforms.get("map").value=s?this.mipmapBlurPass.texture:this.renderTarget.texture;const f=this.resolution=new Le(this,h,d,c);f.addEventListener("change",m=>this.setSize(f.baseWidth,f.baseHeight))}get texture(){return this.mipmapBlurPass.enabled?this.mipmapBlurPass.texture:this.renderTarget.texture}getTexture(){return this.texture}getResolution(){return this.resolution}getBlurPass(){return this.blurPass}getLuminancePass(){return this.luminancePass}get luminanceMaterial(){return this.luminancePass.fullscreenMaterial}getLuminanceMaterial(){return this.luminancePass.fullscreenMaterial}get width(){return this.resolution.width}set width(n){this.resolution.preferredWidth=n}get height(){return this.resolution.height}set height(n){this.resolution.preferredHeight=n}get dithering(){return this.blurPass.dithering}set dithering(n){this.blurPass.dithering=n}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(n){this.blurPass.kernelSize=n}get distinction(){return console.warn(this.name,"distinction was removed"),1}set distinction(n){console.warn(this.name,"distinction was removed")}get intensity(){return this.uniforms.get("intensity").value}set intensity(n){this.uniforms.get("intensity").value=n}getIntensity(){return this.intensity}setIntensity(n){this.intensity=n}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}update(n,e,t){const s=this.renderTarget,i=this.luminancePass;i.enabled?(i.render(n,e),this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(n,i.renderTarget):this.blurPass.render(n,i.renderTarget,s)):this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(n,e):this.blurPass.render(n,e,s)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e),this.renderTarget.setSize(t.width,t.height),this.blurPass.resolution.copy(t),this.luminancePass.setSize(n,e),this.mipmapBlurPass.setSize(n,e)}initialize(n,e,t){this.blurPass.initialize(n,e,t),this.luminancePass.initialize(n,e,t),this.mipmapBlurPass.initialize(n,e,t),t!==void 0&&(this.renderTarget.texture.type=t,zn(n)===We&&Rs(this.renderTarget.texture,We))}},Sp=`uniform lowp sampler2D edgeTexture;uniform lowp sampler2D maskTexture;uniform vec3 visibleEdgeColor;uniform vec3 hiddenEdgeColor;uniform float pulse;uniform float edgeStrength;
#ifdef USE_PATTERN
uniform lowp sampler2D patternTexture;varying vec2 vUvPattern;
#endif
void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec2 edge=texture2D(edgeTexture,uv).rg;vec2 mask=texture2D(maskTexture,uv).rg;
#ifndef X_RAY
edge.y=0.0;
#endif
edge*=(edgeStrength*mask.x*pulse);vec3 color=edge.x*visibleEdgeColor+edge.y*hiddenEdgeColor;float visibilityFactor=0.0;
#ifdef USE_PATTERN
vec4 patternColor=texture2D(patternTexture,vUvPattern);
#ifdef X_RAY
float hiddenFactor=0.5;
#else
float hiddenFactor=0.0;
#endif
visibilityFactor=(1.0-mask.y>0.0)?1.0:hiddenFactor;visibilityFactor*=(1.0-mask.x)*patternColor.a;color+=visibilityFactor*patternColor.rgb;
#endif
float alpha=max(max(edge.x,edge.y),visibilityFactor);
#ifdef ALPHA
outputColor=vec4(color,alpha);
#else
outputColor=vec4(color,max(alpha,inputColor.a));
#endif
}`,bp="uniform float patternScale;varying vec2 vUvPattern;void mainSupport(const in vec2 uv){vUvPattern=uv*vec2(aspect,1.0)*patternScale;}",Cp=class extends Oi{constructor(n,e,{blendFunction:t=K.SCREEN,patternTexture:s=null,patternScale:i=1,edgeStrength:r=1,pulseSpeed:o=0,visibleEdgeColor:a=16777215,hiddenEdgeColor:c=2230538,kernelSize:l=fo.VERY_SMALL,blur:u=!1,xRay:h=!0,multisampling:d=0,resolutionScale:f=.5,width:m=Le.AUTO_SIZE,height:p=Le.AUTO_SIZE,resolutionX:_=m,resolutionY:y=p}={}){super("OutlineEffect",Sp,{uniforms:new Map([["maskTexture",new X(null)],["edgeTexture",new X(null)],["edgeStrength",new X(r)],["visibleEdgeColor",new X(new As(a))],["hiddenEdgeColor",new X(new As(c))],["pulse",new X(1)],["patternScale",new X(i)],["patternTexture",new X(null)]])}),this.blendMode.addEventListener("change",g=>{this.blendMode.blendFunction===K.ALPHA?this.defines.set("ALPHA","1"):this.defines.delete("ALPHA"),this.setChanged()}),this.blendMode.blendFunction=t,this.patternTexture=s,this.xRay=h,this.scene=n,this.camera=e,this.renderTargetMask=new Tt(1,1),this.renderTargetMask.samples=d,this.renderTargetMask.texture.name="Outline.Mask",this.uniforms.get("maskTexture").value=this.renderTargetMask.texture,this.renderTargetOutline=new Tt(1,1,{depthBuffer:!1}),this.renderTargetOutline.texture.name="Outline.Edges",this.uniforms.get("edgeTexture").value=this.renderTargetOutline.texture,this.clearPass=new Fa,this.clearPass.overrideClearColor=new As(0),this.clearPass.overrideClearAlpha=1,this.depthPass=new Of(n,e),this.maskPass=new po(n,e,new rf(this.depthPass.texture,e));const S=this.maskPass.clearPass;S.overrideClearColor=new As(16777215),S.overrideClearAlpha=1,this.blurPass=new Zl({resolutionScale:f,resolutionX:_,resolutionY:y,kernelSize:l}),this.blurPass.enabled=u;const b=this.blurPass.resolution;b.addEventListener("change",g=>this.setSize(b.baseWidth,b.baseHeight)),this.outlinePass=new If(new yf);const v=this.outlinePass.fullscreenMaterial;v.inputBuffer=this.renderTargetMask.texture,this.time=0,this.forceUpdate=!0,this.selection=new zf,this.selection.layer=10,this.pulseSpeed=o}set mainScene(n){this.scene=n,this.depthPass.mainScene=n,this.maskPass.mainScene=n}set mainCamera(n){this.camera=n,this.depthPass.mainCamera=n,this.maskPass.mainCamera=n,this.maskPass.overrideMaterial.copyCameraSettings(n)}get resolution(){return this.blurPass.resolution}getResolution(){return this.blurPass.getResolution()}get multisampling(){return this.renderTargetMask.samples}set multisampling(n){this.renderTargetMask.samples=n,this.renderTargetMask.dispose()}get patternScale(){return this.uniforms.get("patternScale").value}set patternScale(n){this.uniforms.get("patternScale").value=n}get edgeStrength(){return this.uniforms.get("edgeStrength").value}set edgeStrength(n){this.uniforms.get("edgeStrength").value=n}get visibleEdgeColor(){return this.uniforms.get("visibleEdgeColor").value}set visibleEdgeColor(n){this.uniforms.get("visibleEdgeColor").value=n}get hiddenEdgeColor(){return this.uniforms.get("hiddenEdgeColor").value}set hiddenEdgeColor(n){this.uniforms.get("hiddenEdgeColor").value=n}getBlurPass(){return this.blurPass}getSelection(){return this.selection}getPulseSpeed(){return this.pulseSpeed}setPulseSpeed(n){this.pulseSpeed=n}get width(){return this.resolution.width}set width(n){this.resolution.preferredWidth=n}get height(){return this.resolution.height}set height(n){this.resolution.preferredHeight=n}get selectionLayer(){return this.selection.layer}set selectionLayer(n){this.selection.layer=n}get dithering(){return this.blurPass.dithering}set dithering(n){this.blurPass.dithering=n}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(n){this.blurPass.kernelSize=n}get blur(){return this.blurPass.enabled}set blur(n){this.blurPass.enabled=n}get xRay(){return this.defines.has("X_RAY")}set xRay(n){this.xRay!==n&&(n?this.defines.set("X_RAY","1"):this.defines.delete("X_RAY"),this.setChanged())}isXRayEnabled(){return this.xRay}setXRayEnabled(n){this.xRay=n}get patternTexture(){return this.uniforms.get("patternTexture").value}set patternTexture(n){n!==null?(n.wrapS=n.wrapT=pd,this.defines.set("USE_PATTERN","1"),this.setVertexShader(bp)):(this.defines.delete("USE_PATTERN"),this.setVertexShader(null)),this.uniforms.get("patternTexture").value=n,this.setChanged()}setPatternTexture(n){this.patternTexture=n}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}setSelection(n){return this.selection.set(n),this}clearSelection(){return this.selection.clear(),this}selectObject(n){return this.selection.add(n),this}deselectObject(n){return this.selection.delete(n),this}update(n,e,t){const s=this.scene,i=this.camera,r=this.selection,a=this.uniforms.get("pulse"),c=s.background,l=i.layers.mask;(this.forceUpdate||r.size>0)&&(s.background=null,a.value=1,this.pulseSpeed>0&&(a.value=Math.cos(this.time*this.pulseSpeed*10)*.375+.625),this.time+=t,r.setVisible(!1),this.depthPass.render(n),r.setVisible(!0),i.layers.set(r.layer),this.maskPass.render(n,this.renderTargetMask),i.layers.mask=l,s.background=c,this.outlinePass.render(n,null,this.renderTargetOutline),this.blurPass.enabled&&this.blurPass.render(n,this.renderTargetOutline,this.renderTargetOutline)),this.forceUpdate=r.size>0}setSize(n,e){this.blurPass.setSize(n,e),this.renderTargetMask.setSize(n,e);const t=this.resolution;t.setBaseSize(n,e);const s=t.width,i=t.height;this.depthPass.setSize(s,i),this.renderTargetOutline.setSize(s,i),this.outlinePass.fullscreenMaterial.setSize(s,i)}initialize(n,e,t){this.blurPass.initialize(n,e,fs),t!==void 0&&(this.depthPass.initialize(n,e,t),this.maskPass.initialize(n,e,t),this.outlinePass.initialize(n,e,t))}},Ep=`uniform float offset;uniform float darkness;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){const vec2 center=vec2(0.5);vec3 color=inputColor.rgb;
#if VIGNETTE_TECHNIQUE == 0
float d=distance(uv,center);color*=smoothstep(0.8,offset*0.799,d*(darkness+offset));
#else
vec2 coord=(uv-center)*vec2(offset);color=mix(color,vec3(1.0-darkness),dot(coord,coord));
#endif
outputColor=vec4(color,inputColor.a);}`,Op=class extends Oi{constructor({blendFunction:n,technique:e=wr.DEFAULT,eskil:t=!1,offset:s=.5,darkness:i=.5}={}){super("VignetteEffect",Ep,{blendFunction:n,defines:new Map([["VIGNETTE_TECHNIQUE",e.toFixed(0)]]),uniforms:new Map([["offset",new X(s)],["darkness",new X(i)]])})}get technique(){return Number(this.defines.get("VIGNETTE_TECHNIQUE"))}set technique(n){this.technique!==n&&(this.defines.set("VIGNETTE_TECHNIQUE",n.toFixed(0)),this.setChanged())}get eskil(){return this.technique===wr.ESKIL}set eskil(n){this.technique=n?wr.ESKIL:wr.DEFAULT}getTechnique(){return this.technique}setTechnique(n){this.technique=n}get offset(){return this.uniforms.get("offset").value}set offset(n){this.uniforms.get("offset").value=n}getOffset(){return this.offset}setOffset(n){this.offset=n}get darkness(){return this.uniforms.get("darkness").value}set darkness(n){this.uniforms.get("darkness").value=n}getDarkness(){return this.darkness}setDarkness(n){this.darkness=n}};const Xl=D.createContext(null),Gc=n=>(n.getAttributes()&hs.CONVOLUTION)===hs.CONVOLUTION,nx=sa.memo(D.forwardRef(({children:n,camera:e,scene:t,resolutionScale:s,enabled:i=!0,renderPriority:r=1,autoClear:o=!0,depthBuffer:a,disableNormalPass:c,stencilBuffer:l,multisampling:u=8,frameBufferType:h=yd},d)=>{const{gl:f,scene:m,camera:p,size:_}=be(),y=t||m,S=e||p,[b,v,g]=D.useMemo(()=>{const C=zd(),E=new Lf(f,{depthBuffer:a,stencilBuffer:l,multisampling:u>0&&C?u:0,frameBufferType:h});E.addPass(new po(y,S));let O=null,A=null;return c||(A=new Nf(y,S),A.enabled=!1,E.addPass(A),s!==void 0&&C&&(O=new Af({normalBuffer:A.texture,resolutionScale:s}),O.enabled=!1,E.addPass(O))),[E,A,O]},[S,f,a,l,u,h,y,c,s]);D.useEffect(()=>b==null?void 0:b.setSize(_.width,_.height),[b,_]),uo((C,E)=>{if(i){const O=f.autoClear;f.autoClear=o,l&&!o&&f.clearStencil(),b.render(E),f.autoClear=O}},i?r:0);const T=D.useRef(null),x=Cd(T);D.useLayoutEffect(()=>{const C=[];if(T.current&&x.current&&b){const E=x.current.objects;for(let O=0;O<E.length;O++){const A=E[O];if(A instanceof Oi){const k=[A];if(!Gc(A)){let P=null;for(;(P=E[O+1])instanceof Oi&&!Gc(P);)k.push(P),O++}const R=new Df(S,...k);C.push(R)}else A instanceof st&&C.push(A)}for(const O of C)b==null||b.addPass(O);v&&(v.enabled=!0),g&&(g.enabled=!0)}return()=>{for(const E of C)b==null||b.removePass(E);v&&(v.enabled=!1),g&&(g.enabled=!1)}},[b,n,S,v,g,x]);const w=D.useMemo(()=>({composer:b,normalPass:v,downSamplingPass:g,resolutionScale:s,camera:S,scene:y}),[b,v,g,s,S,y]);return D.useImperativeHandle(d,()=>b,[b]),us.jsx(Xl.Provider,{value:w,children:us.jsx("group",{ref:T,children:n})})})),jc=n=>typeof n=="object"&&n!=null&&"current"in n?n.current:n;let Ap=0;const Yc=new WeakMap,$l=(n,e)=>sa.forwardRef(function({blendFunction:s=e==null?void 0:e.blendFunction,opacity:i=e==null?void 0:e.opacity,...r},o){let a=Yc.get(n);if(!a){const u=`@react-three/postprocessing/${n.name}-${Ap++}`;Pa({[u]:n}),Yc.set(n,a=u)}const c=be(u=>u.camera),l=sa.useMemo(()=>{var u,h;return[...(u=e==null?void 0:e.args)!=null?u:[],...(h=r.args)!=null?h:[{...e,...r}]]},[JSON.stringify(r)]);return us.jsx(a,{camera:c,"blendMode-blendFunction":s,"blendMode-opacity-value":i,...r,ref:o,args:l})}),ix=$l(wp,{blendFunction:K.ADD}),rx=D.forwardRef(function({selection:e=[],selectionLayer:t=10,blendFunction:s,patternTexture:i,edgeStrength:r,pulseSpeed:o,visibleEdgeColor:a,hiddenEdgeColor:c,width:l,height:u,kernelSize:h,blur:d,xRay:f,...m},p){const _=be(g=>g.invalidate),{scene:y,camera:S}=D.useContext(Xl),b=D.useMemo(()=>new Cp(y,S,{blendFunction:s,patternTexture:i,edgeStrength:r,pulseSpeed:o,visibleEdgeColor:a,hiddenEdgeColor:c,width:l,height:u,kernelSize:h,blur:d,xRay:f,...m}),[s,d,S,r,u,c,h,i,o,y,a,l,f]),v=D.useContext(Ia);return D.useEffect(()=>{if(!v&&e)return b.selection.set(Array.isArray(e)?e.map(jc):[jc(e)]),_(),()=>{b.selection.clear(),_()}},[b,e,v,_]),D.useEffect(()=>{b.selectionLayer=t,_()},[b,_,t]),D.useRef(),D.useEffect(()=>{var g;if(v&&v.enabled&&(g=v.selected)!=null&&g.length)return b.selection.set(v.selected),_(),()=>{b.selection.clear(),_()}},[v,b.selection,_]),D.useEffect(()=>()=>{b.dispose()},[b]),us.jsx("primitive",{ref:p,object:b})}),ox=$l(Op),Mp={isUserDragging:!1,isUserScrolling:!1,userMovedCamera:!1,isUserScrollingOnHtmlPanel:!1},ax=Td(n=>({...Mp,setIsUserDragging:e=>n({isUserDragging:e}),setIsUserScrolling:e=>n({isUserScrolling:e}),setUserMovedCamera:e=>n({userMovedCamera:e}),setIsUserScrollingOnHtmlPanel:e=>n({isUserScrollingOnHtmlPanel:e})}));function as(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function Ql(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.__proto__=e}/*!
 * GSAP 3.12.4
 * https://gsap.com
 *
 * @license Copyright 2008-2023, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license or for
 * Club GSAP members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var vt={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},Vn={duration:.5,overwrite:!1,delay:0},Ua,Xe,Me,Ct=1e8,me=1/Ct,ra=Math.PI*2,Dp=ra/4,kp=0,Kl=Math.sqrt,Rp=Math.cos,Pp=Math.sin,je=function(e){return typeof e=="string"},ke=function(e){return typeof e=="function"},ps=function(e){return typeof e=="number"},La=function(e){return typeof e>"u"},Qt=function(e){return typeof e=="object"},ct=function(e){return e!==!1},Ba=function(){return typeof window<"u"},Sr=function(e){return ke(e)||je(e)},Jl=typeof ArrayBuffer=="function"&&ArrayBuffer.isView||function(){},$e=Array.isArray,oa=/(?:-?\.?\d|\.)+/gi,eu=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,Mn=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,Wo=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,tu=/[+-]=-?[.\d]+/,su=/[^,'"\[\]\s]+/gi,Np=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,Oe,bt,aa,za,xt={},Nr={},nu,iu=function(e){return(Nr=un(e,xt))&&ft},Va=function(e,t){return console.warn("Invalid property",e,"set to",t,"Missing plugin? gsap.registerPlugin()")},Ai=function(e,t){return!t&&console.warn(e)},ru=function(e,t){return e&&(xt[e]=t)&&Nr&&(Nr[e]=t)||xt},Mi=function(){return 0},Ip={suppressEvents:!0,isStart:!0,kill:!1},Ar={suppressEvents:!0,kill:!1},Fp={suppressEvents:!0},Ha={},Ps=[],ca={},ou,mt={},Go={},Zc=30,Mr=[],qa="",Wa=function(e){var t=e[0],s,i;if(Qt(t)||ke(t)||(e=[e]),!(s=(t._gsap||{}).harness)){for(i=Mr.length;i--&&!Mr[i].targetTest(t););s=Mr[i]}for(i=e.length;i--;)e[i]&&(e[i]._gsap||(e[i]._gsap=new Du(e[i],s)))||e.splice(i,1);return e},nn=function(e){return e._gsap||Wa(Et(e))[0]._gsap},au=function(e,t,s){return(s=e[t])&&ke(s)?e[t]():La(s)&&e.getAttribute&&e.getAttribute(t)||s},lt=function(e,t){return(e=e.split(",")).forEach(t)||e},Ne=function(e){return Math.round(e*1e5)/1e5||0},qe=function(e){return Math.round(e*1e7)/1e7||0},Nn=function(e,t){var s=t.charAt(0),i=parseFloat(t.substr(2));return e=parseFloat(e),s==="+"?e+i:s==="-"?e-i:s==="*"?e*i:e/i},Up=function(e,t){for(var s=t.length,i=0;e.indexOf(t[i])<0&&++i<s;);return i<s},Ir=function(){var e=Ps.length,t=Ps.slice(0),s,i;for(ca={},Ps.length=0,s=0;s<e;s++)i=t[s],i&&i._lazy&&(i.render(i._lazy[0],i._lazy[1],!0)._lazy=0)},cu=function(e,t,s,i){Ps.length&&!Xe&&Ir(),e.render(t,s,i||Xe&&t<0&&(e._initted||e._startAt)),Ps.length&&!Xe&&Ir()},lu=function(e){var t=parseFloat(e);return(t||t===0)&&(e+"").match(su).length<2?t:je(e)?e.trim():e},uu=function(e){return e},Mt=function(e,t){for(var s in t)s in e||(e[s]=t[s]);return e},Lp=function(e){return function(t,s){for(var i in s)i in t||i==="duration"&&e||i==="ease"||(t[i]=s[i])}},un=function(e,t){for(var s in t)e[s]=t[s];return e},Xc=function n(e,t){for(var s in t)s!=="__proto__"&&s!=="constructor"&&s!=="prototype"&&(e[s]=Qt(t[s])?n(e[s]||(e[s]={}),t[s]):t[s]);return e},Fr=function(e,t){var s={},i;for(i in e)i in t||(s[i]=e[i]);return s},Si=function(e){var t=e.parent||Oe,s=e.keyframes?Lp($e(e.keyframes)):Mt;if(ct(e.inherit))for(;t;)s(e,t.vars.defaults),t=t.parent||t._dp;return e},Bp=function(e,t){for(var s=e.length,i=s===t.length;i&&s--&&e[s]===t[s];);return s<0},hu=function(e,t,s,i,r){s===void 0&&(s="_first"),i===void 0&&(i="_last");var o=e[i],a;if(r)for(a=t[r];o&&o[r]>a;)o=o._prev;return o?(t._next=o._next,o._next=t):(t._next=e[s],e[s]=t),t._next?t._next._prev=t:e[i]=t,t._prev=o,t.parent=t._dp=e,t},mo=function(e,t,s,i){s===void 0&&(s="_first"),i===void 0&&(i="_last");var r=t._prev,o=t._next;r?r._next=o:e[s]===t&&(e[s]=o),o?o._prev=r:e[i]===t&&(e[i]=r),t._next=t._prev=t.parent=null},Fs=function(e,t){e.parent&&(!t||e.parent.autoRemoveChildren)&&e.parent.remove&&e.parent.remove(e),e._act=0},rn=function(e,t){if(e&&(!t||t._end>e._dur||t._start<0))for(var s=e;s;)s._dirty=1,s=s.parent;return e},zp=function(e){for(var t=e.parent;t&&t.parent;)t._dirty=1,t.totalDuration(),t=t.parent;return e},la=function(e,t,s,i){return e._startAt&&(Xe?e._startAt.revert(Ar):e.vars.immediateRender&&!e.vars.autoRevert||e._startAt.render(t,!0,i))},Vp=function n(e){return!e||e._ts&&n(e.parent)},$c=function(e){return e._repeat?Hn(e._tTime,e=e.duration()+e._rDelay)*e:0},Hn=function(e,t){var s=Math.floor(e/=t);return e&&s===e?s-1:s},Ur=function(e,t){return(e-t._start)*t._ts+(t._ts>=0?0:t._dirty?t.totalDuration():t._tDur)},_o=function(e){return e._end=qe(e._start+(e._tDur/Math.abs(e._ts||e._rts||me)||0))},go=function(e,t){var s=e._dp;return s&&s.smoothChildTiming&&e._ts&&(e._start=qe(s._time-(e._ts>0?t/e._ts:((e._dirty?e.totalDuration():e._tDur)-t)/-e._ts)),_o(e),s._dirty||rn(s,e)),e},du=function(e,t){var s;if((t._time||!t._dur&&t._initted||t._start<e._time&&(t._dur||!t.add))&&(s=Ur(e.rawTime(),t),(!t._dur||sr(0,t.totalDuration(),s)-t._tTime>me)&&t.render(s,!0)),rn(e,t)._dp&&e._initted&&e._time>=e._dur&&e._ts){if(e._dur<e.duration())for(s=e;s._dp;)s.rawTime()>=0&&s.totalTime(s._tTime),s=s._dp;e._zTime=-me}},Zt=function(e,t,s,i){return t.parent&&Fs(t),t._start=qe((ps(s)?s:s||e!==Oe?St(e,s,t):e._time)+t._delay),t._end=qe(t._start+(t.totalDuration()/Math.abs(t.timeScale())||0)),hu(e,t,"_first","_last",e._sort?"_start":0),ua(t)||(e._recent=t),i||du(e,t),e._ts<0&&go(e,e._tTime),e},fu=function(e,t){return(xt.ScrollTrigger||Va("scrollTrigger",t))&&xt.ScrollTrigger.create(t,e)},pu=function(e,t,s,i,r){if(ja(e,t,r),!e._initted)return 1;if(!s&&e._pt&&!Xe&&(e._dur&&e.vars.lazy!==!1||!e._dur&&e.vars.lazy)&&ou!==_t.frame)return Ps.push(e),e._lazy=[r,i],1},Hp=function n(e){var t=e.parent;return t&&t._ts&&t._initted&&!t._lock&&(t.rawTime()<0||n(t))},ua=function(e){var t=e.data;return t==="isFromStart"||t==="isStart"},qp=function(e,t,s,i){var r=e.ratio,o=t<0||!t&&(!e._start&&Hp(e)&&!(!e._initted&&ua(e))||(e._ts<0||e._dp._ts<0)&&!ua(e))?0:1,a=e._rDelay,c=0,l,u,h;if(a&&e._repeat&&(c=sr(0,e._tDur,t),u=Hn(c,a),e._yoyo&&u&1&&(o=1-o),u!==Hn(e._tTime,a)&&(r=1-o,e.vars.repeatRefresh&&e._initted&&e.invalidate())),o!==r||Xe||i||e._zTime===me||!t&&e._zTime){if(!e._initted&&pu(e,t,i,s,c))return;for(h=e._zTime,e._zTime=t||(s?me:0),s||(s=t&&!h),e.ratio=o,e._from&&(o=1-o),e._time=0,e._tTime=c,l=e._pt;l;)l.r(o,l.d),l=l._next;t<0&&la(e,t,s,!0),e._onUpdate&&!s&&gt(e,"onUpdate"),c&&e._repeat&&!s&&e.parent&&gt(e,"onRepeat"),(t>=e._tDur||t<0)&&e.ratio===o&&(o&&Fs(e,1),!s&&!Xe&&(gt(e,o?"onComplete":"onReverseComplete",!0),e._prom&&e._prom()))}else e._zTime||(e._zTime=t)},Wp=function(e,t,s){var i;if(s>t)for(i=e._first;i&&i._start<=s;){if(i.data==="isPause"&&i._start>t)return i;i=i._next}else for(i=e._last;i&&i._start>=s;){if(i.data==="isPause"&&i._start<t)return i;i=i._prev}},qn=function(e,t,s,i){var r=e._repeat,o=qe(t)||0,a=e._tTime/e._tDur;return a&&!i&&(e._time*=o/e._dur),e._dur=o,e._tDur=r?r<0?1e10:qe(o*(r+1)+e._rDelay*r):o,a>0&&!i&&go(e,e._tTime=e._tDur*a),e.parent&&_o(e),s||rn(e.parent,e),e},Qc=function(e){return e instanceof et?rn(e):qn(e,e._dur)},Gp={_start:0,endTime:Mi,totalDuration:Mi},St=function n(e,t,s){var i=e.labels,r=e._recent||Gp,o=e.duration()>=Ct?r.endTime(!1):e._dur,a,c,l;return je(t)&&(isNaN(t)||t in i)?(c=t.charAt(0),l=t.substr(-1)==="%",a=t.indexOf("="),c==="<"||c===">"?(a>=0&&(t=t.replace(/=/,"")),(c==="<"?r._start:r.endTime(r._repeat>=0))+(parseFloat(t.substr(1))||0)*(l?(a<0?r:s).totalDuration()/100:1)):a<0?(t in i||(i[t]=o),i[t]):(c=parseFloat(t.charAt(a-1)+t.substr(a+1)),l&&s&&(c=c/100*($e(s)?s[0]:s).totalDuration()),a>1?n(e,t.substr(0,a-1),s)+c:o+c)):t==null?o:+t},bi=function(e,t,s){var i=ps(t[1]),r=(i?2:1)+(e<2?0:1),o=t[r],a,c;if(i&&(o.duration=t[1]),o.parent=s,e){for(a=o,c=s;c&&!("immediateRender"in a);)a=c.vars.defaults||{},c=ct(c.vars.inherit)&&c.parent;o.immediateRender=ct(a.immediateRender),e<2?o.runBackwards=1:o.startAt=t[r-1]}return new ze(t[0],o,t[r+1])},qs=function(e,t){return e||e===0?t(e):t},sr=function(e,t,s){return s<e?e:s>t?t:s},Ze=function(e,t){return!je(e)||!(t=Np.exec(e))?"":t[1]},jp=function(e,t,s){return qs(s,function(i){return sr(e,t,i)})},ha=[].slice,mu=function(e,t){return e&&Qt(e)&&"length"in e&&(!t&&!e.length||e.length-1 in e&&Qt(e[0]))&&!e.nodeType&&e!==bt},Yp=function(e,t,s){return s===void 0&&(s=[]),e.forEach(function(i){var r;return je(i)&&!t||mu(i,1)?(r=s).push.apply(r,Et(i)):s.push(i)})||s},Et=function(e,t,s){return Me&&!t&&Me.selector?Me.selector(e):je(e)&&!s&&(aa||!Wn())?ha.call((t||za).querySelectorAll(e),0):$e(e)?Yp(e,s):mu(e)?ha.call(e,0):e?[e]:[]},da=function(e){return e=Et(e)[0]||Ai("Invalid scope")||{},function(t){var s=e.current||e.nativeElement||e;return Et(t,s.querySelectorAll?s:s===e?Ai("Invalid scope")||za.createElement("div"):e)}},_u=function(e){return e.sort(function(){return .5-Math.random()})},gu=function(e){if(ke(e))return e;var t=Qt(e)?e:{each:e},s=on(t.ease),i=t.from||0,r=parseFloat(t.base)||0,o={},a=i>0&&i<1,c=isNaN(i)||a,l=t.axis,u=i,h=i;return je(i)?u=h={center:.5,edges:.5,end:1}[i]||0:!a&&c&&(u=i[0],h=i[1]),function(d,f,m){var p=(m||t).length,_=o[p],y,S,b,v,g,T,x,w,C;if(!_){if(C=t.grid==="auto"?0:(t.grid||[1,Ct])[1],!C){for(x=-Ct;x<(x=m[C++].getBoundingClientRect().left)&&C<p;);C<p&&C--}for(_=o[p]=[],y=c?Math.min(C,p)*u-.5:i%C,S=C===Ct?0:c?p*h/C-.5:i/C|0,x=0,w=Ct,T=0;T<p;T++)b=T%C-y,v=S-(T/C|0),_[T]=g=l?Math.abs(l==="y"?v:b):Kl(b*b+v*v),g>x&&(x=g),g<w&&(w=g);i==="random"&&_u(_),_.max=x-w,_.min=w,_.v=p=(parseFloat(t.amount)||parseFloat(t.each)*(C>p?p-1:l?l==="y"?p/C:C:Math.max(C,p/C))||0)*(i==="edges"?-1:1),_.b=p<0?r-p:r,_.u=Ze(t.amount||t.each)||0,s=s&&p<0?Ou(s):s}return p=(_[d]-_.min)/_.max||0,qe(_.b+(s?s(p):p)*_.v)+_.u}},fa=function(e){var t=Math.pow(10,((e+"").split(".")[1]||"").length);return function(s){var i=qe(Math.round(parseFloat(s)/e)*e*t);return(i-i%1)/t+(ps(s)?0:Ze(s))}},vu=function(e,t){var s=$e(e),i,r;return!s&&Qt(e)&&(i=s=e.radius||Ct,e.values?(e=Et(e.values),(r=!ps(e[0]))&&(i*=i)):e=fa(e.increment)),qs(t,s?ke(e)?function(o){return r=e(o),Math.abs(r-o)<=i?r:o}:function(o){for(var a=parseFloat(r?o.x:o),c=parseFloat(r?o.y:0),l=Ct,u=0,h=e.length,d,f;h--;)r?(d=e[h].x-a,f=e[h].y-c,d=d*d+f*f):d=Math.abs(e[h]-a),d<l&&(l=d,u=h);return u=!i||l<=i?e[u]:o,r||u===o||ps(o)?u:u+Ze(o)}:fa(e))},yu=function(e,t,s,i){return qs($e(e)?!t:s===!0?!!(s=0):!i,function(){return $e(e)?e[~~(Math.random()*e.length)]:(s=s||1e-5)&&(i=s<1?Math.pow(10,(s+"").length-2):1)&&Math.floor(Math.round((e-s/2+Math.random()*(t-e+s*.99))/s)*s*i)/i})},Zp=function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return function(i){return t.reduce(function(r,o){return o(r)},i)}},Xp=function(e,t){return function(s){return e(parseFloat(s))+(t||Ze(s))}},$p=function(e,t,s){return xu(e,t,0,1,s)},Tu=function(e,t,s){return qs(s,function(i){return e[~~t(i)]})},Qp=function n(e,t,s){var i=t-e;return $e(e)?Tu(e,n(0,e.length),t):qs(s,function(r){return(i+(r-e)%i)%i+e})},Kp=function n(e,t,s){var i=t-e,r=i*2;return $e(e)?Tu(e,n(0,e.length-1),t):qs(s,function(o){return o=(r+(o-e)%r)%r||0,e+(o>i?r-o:o)})},Di=function(e){for(var t=0,s="",i,r,o,a;~(i=e.indexOf("random(",t));)o=e.indexOf(")",i),a=e.charAt(i+7)==="[",r=e.substr(i+7,o-i-7).match(a?su:oa),s+=e.substr(t,i-t)+yu(a?r:+r[0],a?0:+r[1],+r[2]||1e-5),t=o+1;return s+e.substr(t,e.length-t)},xu=function(e,t,s,i,r){var o=t-e,a=i-s;return qs(r,function(c){return s+((c-e)/o*a||0)})},Jp=function n(e,t,s,i){var r=isNaN(e+t)?0:function(f){return(1-f)*e+f*t};if(!r){var o=je(e),a={},c,l,u,h,d;if(s===!0&&(i=1)&&(s=null),o)e={p:e},t={p:t};else if($e(e)&&!$e(t)){for(u=[],h=e.length,d=h-2,l=1;l<h;l++)u.push(n(e[l-1],e[l]));h--,r=function(m){m*=h;var p=Math.min(d,~~m);return u[p](m-p)},s=t}else i||(e=un($e(e)?[]:{},e));if(!u){for(c in t)Ga.call(a,e,c,"get",t[c]);r=function(m){return Xa(m,a)||(o?e.p:e)}}}return qs(s,r)},Kc=function(e,t,s){var i=e.labels,r=Ct,o,a,c;for(o in i)a=i[o]-t,a<0==!!s&&a&&r>(a=Math.abs(a))&&(c=o,r=a);return c},gt=function(e,t,s){var i=e.vars,r=i[t],o=Me,a=e._ctx,c,l,u;if(r)return c=i[t+"Params"],l=i.callbackScope||e,s&&Ps.length&&Ir(),a&&(Me=a),u=c?r.apply(l,c):r.call(l),Me=o,u},xi=function(e){return Fs(e),e.scrollTrigger&&e.scrollTrigger.kill(!!Xe),e.progress()<1&&gt(e,"onInterrupt"),e},Dn,wu=[],Su=function(e){if(Ba()&&e){e=!e.name&&e.default||e;var t=e.name,s=ke(e),i=t&&!s&&e.init?function(){this._props=[]}:e,r={init:Mi,render:Xa,add:Ga,kill:mm,modifier:pm,rawVars:0},o={targetTest:0,get:0,getSetter:Za,aliases:{},register:0};if(Wn(),e!==i){if(mt[t])return;Mt(i,Mt(Fr(e,r),o)),un(i.prototype,un(r,Fr(e,o))),mt[i.prop=t]=i,e.targetTest&&(Mr.push(i),Ha[t]=1),t=(t==="css"?"CSS":t.charAt(0).toUpperCase()+t.substr(1))+"Plugin"}ru(t,i),e.register&&e.register(ft,i,ut)}else e&&wu.push(e)},pe=255,wi={aqua:[0,pe,pe],lime:[0,pe,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,pe],navy:[0,0,128],white:[pe,pe,pe],olive:[128,128,0],yellow:[pe,pe,0],orange:[pe,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[pe,0,0],pink:[pe,192,203],cyan:[0,pe,pe],transparent:[pe,pe,pe,0]},jo=function(e,t,s){return e+=e<0?1:e>1?-1:0,(e*6<1?t+(s-t)*e*6:e<.5?s:e*3<2?t+(s-t)*(2/3-e)*6:t)*pe+.5|0},bu=function(e,t,s){var i=e?ps(e)?[e>>16,e>>8&pe,e&pe]:0:wi.black,r,o,a,c,l,u,h,d,f,m;if(!i){if(e.substr(-1)===","&&(e=e.substr(0,e.length-1)),wi[e])i=wi[e];else if(e.charAt(0)==="#"){if(e.length<6&&(r=e.charAt(1),o=e.charAt(2),a=e.charAt(3),e="#"+r+r+o+o+a+a+(e.length===5?e.charAt(4)+e.charAt(4):"")),e.length===9)return i=parseInt(e.substr(1,6),16),[i>>16,i>>8&pe,i&pe,parseInt(e.substr(7),16)/255];e=parseInt(e.substr(1),16),i=[e>>16,e>>8&pe,e&pe]}else if(e.substr(0,3)==="hsl"){if(i=m=e.match(oa),!t)c=+i[0]%360/360,l=+i[1]/100,u=+i[2]/100,o=u<=.5?u*(l+1):u+l-u*l,r=u*2-o,i.length>3&&(i[3]*=1),i[0]=jo(c+1/3,r,o),i[1]=jo(c,r,o),i[2]=jo(c-1/3,r,o);else if(~e.indexOf("="))return i=e.match(eu),s&&i.length<4&&(i[3]=1),i}else i=e.match(oa)||wi.transparent;i=i.map(Number)}return t&&!m&&(r=i[0]/pe,o=i[1]/pe,a=i[2]/pe,h=Math.max(r,o,a),d=Math.min(r,o,a),u=(h+d)/2,h===d?c=l=0:(f=h-d,l=u>.5?f/(2-h-d):f/(h+d),c=h===r?(o-a)/f+(o<a?6:0):h===o?(a-r)/f+2:(r-o)/f+4,c*=60),i[0]=~~(c+.5),i[1]=~~(l*100+.5),i[2]=~~(u*100+.5)),s&&i.length<4&&(i[3]=1),i},Cu=function(e){var t=[],s=[],i=-1;return e.split(Ns).forEach(function(r){var o=r.match(Mn)||[];t.push.apply(t,o),s.push(i+=o.length+1)}),t.c=s,t},Jc=function(e,t,s){var i="",r=(e+i).match(Ns),o=t?"hsla(":"rgba(",a=0,c,l,u,h;if(!r)return e;if(r=r.map(function(d){return(d=bu(d,t,1))&&o+(t?d[0]+","+d[1]+"%,"+d[2]+"%,"+d[3]:d.join(","))+")"}),s&&(u=Cu(e),c=s.c,c.join(i)!==u.c.join(i)))for(l=e.replace(Ns,"1").split(Mn),h=l.length-1;a<h;a++)i+=l[a]+(~c.indexOf(a)?r.shift()||o+"0,0,0,0)":(u.length?u:r.length?r:s).shift());if(!l)for(l=e.split(Ns),h=l.length-1;a<h;a++)i+=l[a]+r[a];return i+l[h]},Ns=function(){var n="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b",e;for(e in wi)n+="|"+e+"\\b";return new RegExp(n+")","gi")}(),em=/hsl[a]?\(/,Eu=function(e){var t=e.join(" "),s;if(Ns.lastIndex=0,Ns.test(t))return s=em.test(t),e[1]=Jc(e[1],s),e[0]=Jc(e[0],s,Cu(e[1])),!0},ki,_t=function(){var n=Date.now,e=500,t=33,s=n(),i=s,r=1e3/240,o=r,a=[],c,l,u,h,d,f,m=function p(_){var y=n()-i,S=_===!0,b,v,g,T;if(y>e&&(s+=y-t),i+=y,g=i-s,b=g-o,(b>0||S)&&(T=++h.frame,d=g-h.time*1e3,h.time=g=g/1e3,o+=b+(b>=r?4:r-b),v=1),S||(c=l(p)),v)for(f=0;f<a.length;f++)a[f](g,d,T,_)};return h={time:0,frame:0,tick:function(){m(!0)},deltaRatio:function(_){return d/(1e3/(_||60))},wake:function(){nu&&(!aa&&Ba()&&(bt=aa=window,za=bt.document||{},xt.gsap=ft,(bt.gsapVersions||(bt.gsapVersions=[])).push(ft.version),iu(Nr||bt.GreenSockGlobals||!bt.gsap&&bt||{}),u=bt.requestAnimationFrame,wu.forEach(Su)),c&&h.sleep(),l=u||function(_){return setTimeout(_,o-h.time*1e3+1|0)},ki=1,m(2))},sleep:function(){(u?bt.cancelAnimationFrame:clearTimeout)(c),ki=0,l=Mi},lagSmoothing:function(_,y){e=_||1/0,t=Math.min(y||33,e)},fps:function(_){r=1e3/(_||240),o=h.time*1e3+r},add:function(_,y,S){var b=y?function(v,g,T,x){_(v,g,T,x),h.remove(b)}:_;return h.remove(_),a[S?"unshift":"push"](b),Wn(),b},remove:function(_,y){~(y=a.indexOf(_))&&a.splice(y,1)&&f>=y&&f--},_listeners:a},h}(),Wn=function(){return!ki&&_t.wake()},te={},tm=/^[\d.\-M][\d.\-,\s]/,sm=/["']/g,nm=function(e){for(var t={},s=e.substr(1,e.length-3).split(":"),i=s[0],r=1,o=s.length,a,c,l;r<o;r++)c=s[r],a=r!==o-1?c.lastIndexOf(","):c.length,l=c.substr(0,a),t[i]=isNaN(l)?l.replace(sm,"").trim():+l,i=c.substr(a+1).trim();return t},im=function(e){var t=e.indexOf("(")+1,s=e.indexOf(")"),i=e.indexOf("(",t);return e.substring(t,~i&&i<s?e.indexOf(")",s+1):s)},rm=function(e){var t=(e+"").split("("),s=te[t[0]];return s&&t.length>1&&s.config?s.config.apply(null,~e.indexOf("{")?[nm(t[1])]:im(e).split(",").map(lu)):te._CE&&tm.test(e)?te._CE("",e):s},Ou=function(e){return function(t){return 1-e(1-t)}},Au=function n(e,t){for(var s=e._first,i;s;)s instanceof et?n(s,t):s.vars.yoyoEase&&(!s._yoyo||!s._repeat)&&s._yoyo!==t&&(s.timeline?n(s.timeline,t):(i=s._ease,s._ease=s._yEase,s._yEase=i,s._yoyo=t)),s=s._next},on=function(e,t){return e&&(ke(e)?e:te[e]||rm(e))||t},gn=function(e,t,s,i){s===void 0&&(s=function(c){return 1-t(1-c)}),i===void 0&&(i=function(c){return c<.5?t(c*2)/2:1-t((1-c)*2)/2});var r={easeIn:t,easeOut:s,easeInOut:i},o;return lt(e,function(a){te[a]=xt[a]=r,te[o=a.toLowerCase()]=s;for(var c in r)te[o+(c==="easeIn"?".in":c==="easeOut"?".out":".inOut")]=te[a+"."+c]=r[c]}),r},Mu=function(e){return function(t){return t<.5?(1-e(1-t*2))/2:.5+e((t-.5)*2)/2}},Yo=function n(e,t,s){var i=t>=1?t:1,r=(s||(e?.3:.45))/(t<1?t:1),o=r/ra*(Math.asin(1/i)||0),a=function(u){return u===1?1:i*Math.pow(2,-10*u)*Pp((u-o)*r)+1},c=e==="out"?a:e==="in"?function(l){return 1-a(1-l)}:Mu(a);return r=ra/r,c.config=function(l,u){return n(e,l,u)},c},Zo=function n(e,t){t===void 0&&(t=1.70158);var s=function(o){return o?--o*o*((t+1)*o+t)+1:0},i=e==="out"?s:e==="in"?function(r){return 1-s(1-r)}:Mu(s);return i.config=function(r){return n(e,r)},i};lt("Linear,Quad,Cubic,Quart,Quint,Strong",function(n,e){var t=e<5?e+1:e;gn(n+",Power"+(t-1),e?function(s){return Math.pow(s,t)}:function(s){return s},function(s){return 1-Math.pow(1-s,t)},function(s){return s<.5?Math.pow(s*2,t)/2:1-Math.pow((1-s)*2,t)/2})});te.Linear.easeNone=te.none=te.Linear.easeIn;gn("Elastic",Yo("in"),Yo("out"),Yo());(function(n,e){var t=1/e,s=2*t,i=2.5*t,r=function(a){return a<t?n*a*a:a<s?n*Math.pow(a-1.5/e,2)+.75:a<i?n*(a-=2.25/e)*a+.9375:n*Math.pow(a-2.625/e,2)+.984375};gn("Bounce",function(o){return 1-r(1-o)},r)})(7.5625,2.75);gn("Expo",function(n){return n?Math.pow(2,10*(n-1)):0});gn("Circ",function(n){return-(Kl(1-n*n)-1)});gn("Sine",function(n){return n===1?1:-Rp(n*Dp)+1});gn("Back",Zo("in"),Zo("out"),Zo());te.SteppedEase=te.steps=xt.SteppedEase={config:function(e,t){e===void 0&&(e=1);var s=1/e,i=e+(t?0:1),r=t?1:0,o=1-me;return function(a){return((i*sr(0,o,a)|0)+r)*s}}};Vn.ease=te["quad.out"];lt("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function(n){return qa+=n+","+n+"Params,"});var Du=function(e,t){this.id=kp++,e._gsap=this,this.target=e,this.harness=t,this.get=t?t.get:au,this.set=t?t.getSetter:Za},Ri=function(){function n(t){this.vars=t,this._delay=+t.delay||0,(this._repeat=t.repeat===1/0?-2:t.repeat||0)&&(this._rDelay=t.repeatDelay||0,this._yoyo=!!t.yoyo||!!t.yoyoEase),this._ts=1,qn(this,+t.duration,1,1),this.data=t.data,Me&&(this._ctx=Me,Me.data.push(this)),ki||_t.wake()}var e=n.prototype;return e.delay=function(s){return s||s===0?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+s-this._delay),this._delay=s,this):this._delay},e.duration=function(s){return arguments.length?this.totalDuration(this._repeat>0?s+(s+this._rDelay)*this._repeat:s):this.totalDuration()&&this._dur},e.totalDuration=function(s){return arguments.length?(this._dirty=0,qn(this,this._repeat<0?s:(s-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},e.totalTime=function(s,i){if(Wn(),!arguments.length)return this._tTime;var r=this._dp;if(r&&r.smoothChildTiming&&this._ts){for(go(this,s),!r._dp||r.parent||du(r,this);r&&r.parent;)r.parent._time!==r._start+(r._ts>=0?r._tTime/r._ts:(r.totalDuration()-r._tTime)/-r._ts)&&r.totalTime(r._tTime,!0),r=r.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&s<this._tDur||this._ts<0&&s>0||!this._tDur&&!s)&&Zt(this._dp,this,this._start-this._delay)}return(this._tTime!==s||!this._dur&&!i||this._initted&&Math.abs(this._zTime)===me||!s&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=s),cu(this,s,i)),this},e.time=function(s,i){return arguments.length?this.totalTime(Math.min(this.totalDuration(),s+$c(this))%(this._dur+this._rDelay)||(s?this._dur:0),i):this._time},e.totalProgress=function(s,i){return arguments.length?this.totalTime(this.totalDuration()*s,i):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.rawTime()>0?1:0},e.progress=function(s,i){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&!(this.iteration()&1)?1-s:s)+$c(this),i):this.duration()?Math.min(1,this._time/this._dur):this.rawTime()>0?1:0},e.iteration=function(s,i){var r=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(s-1)*r,i):this._repeat?Hn(this._tTime,r)+1:1},e.timeScale=function(s,i){if(!arguments.length)return this._rts===-me?0:this._rts;if(this._rts===s)return this;var r=this.parent&&this._ts?Ur(this.parent._time,this):this._tTime;return this._rts=+s||0,this._ts=this._ps||s===-me?0:this._rts,this.totalTime(sr(-Math.abs(this._delay),this._tDur,r),i!==!1),_o(this),zp(this)},e.paused=function(s){return arguments.length?(this._ps!==s&&(this._ps=s,s?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(Wn(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,this.progress()===1&&Math.abs(this._zTime)!==me&&(this._tTime-=me)))),this):this._ps},e.startTime=function(s){if(arguments.length){this._start=s;var i=this.parent||this._dp;return i&&(i._sort||!this.parent)&&Zt(i,this,s-this._delay),this}return this._start},e.endTime=function(s){return this._start+(ct(s)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},e.rawTime=function(s){var i=this.parent||this._dp;return i?s&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?Ur(i.rawTime(s),this):this._tTime:this._tTime},e.revert=function(s){s===void 0&&(s=Fp);var i=Xe;return Xe=s,(this._initted||this._startAt)&&(this.timeline&&this.timeline.revert(s),this.totalTime(-.01,s.suppressEvents)),this.data!=="nested"&&s.kill!==!1&&this.kill(),Xe=i,this},e.globalTime=function(s){for(var i=this,r=arguments.length?s:i.rawTime();i;)r=i._start+r/(Math.abs(i._ts)||1),i=i._dp;return!this.parent&&this._sat?this._sat.globalTime(s):r},e.repeat=function(s){return arguments.length?(this._repeat=s===1/0?-2:s,Qc(this)):this._repeat===-2?1/0:this._repeat},e.repeatDelay=function(s){if(arguments.length){var i=this._time;return this._rDelay=s,Qc(this),i?this.time(i):this}return this._rDelay},e.yoyo=function(s){return arguments.length?(this._yoyo=s,this):this._yoyo},e.seek=function(s,i){return this.totalTime(St(this,s),ct(i))},e.restart=function(s,i){return this.play().totalTime(s?-this._delay:0,ct(i))},e.play=function(s,i){return s!=null&&this.seek(s,i),this.reversed(!1).paused(!1)},e.reverse=function(s,i){return s!=null&&this.seek(s||this.totalDuration(),i),this.reversed(!0).paused(!1)},e.pause=function(s,i){return s!=null&&this.seek(s,i),this.paused(!0)},e.resume=function(){return this.paused(!1)},e.reversed=function(s){return arguments.length?(!!s!==this.reversed()&&this.timeScale(-this._rts||(s?-me:0)),this):this._rts<0},e.invalidate=function(){return this._initted=this._act=0,this._zTime=-me,this},e.isActive=function(){var s=this.parent||this._dp,i=this._start,r;return!!(!s||this._ts&&this._initted&&s.isActive()&&(r=s.rawTime(!0))>=i&&r<this.endTime(!0)-me)},e.eventCallback=function(s,i,r){var o=this.vars;return arguments.length>1?(i?(o[s]=i,r&&(o[s+"Params"]=r),s==="onUpdate"&&(this._onUpdate=i)):delete o[s],this):o[s]},e.then=function(s){var i=this;return new Promise(function(r){var o=ke(s)?s:uu,a=function(){var l=i.then;i.then=null,ke(o)&&(o=o(i))&&(o.then||o===i)&&(i.then=l),r(o),i.then=l};i._initted&&i.totalProgress()===1&&i._ts>=0||!i._tTime&&i._ts<0?a():i._prom=a})},e.kill=function(){xi(this)},n}();Mt(Ri.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-me,_prom:0,_ps:!1,_rts:1});var et=function(n){Ql(e,n);function e(s,i){var r;return s===void 0&&(s={}),r=n.call(this,s)||this,r.labels={},r.smoothChildTiming=!!s.smoothChildTiming,r.autoRemoveChildren=!!s.autoRemoveChildren,r._sort=ct(s.sortChildren),Oe&&Zt(s.parent||Oe,as(r),i),s.reversed&&r.reverse(),s.paused&&r.paused(!0),s.scrollTrigger&&fu(as(r),s.scrollTrigger),r}var t=e.prototype;return t.to=function(i,r,o){return bi(0,arguments,this),this},t.from=function(i,r,o){return bi(1,arguments,this),this},t.fromTo=function(i,r,o,a){return bi(2,arguments,this),this},t.set=function(i,r,o){return r.duration=0,r.parent=this,Si(r).repeatDelay||(r.repeat=0),r.immediateRender=!!r.immediateRender,new ze(i,r,St(this,o),1),this},t.call=function(i,r,o){return Zt(this,ze.delayedCall(0,i,r),o)},t.staggerTo=function(i,r,o,a,c,l,u){return o.duration=r,o.stagger=o.stagger||a,o.onComplete=l,o.onCompleteParams=u,o.parent=this,new ze(i,o,St(this,c)),this},t.staggerFrom=function(i,r,o,a,c,l,u){return o.runBackwards=1,Si(o).immediateRender=ct(o.immediateRender),this.staggerTo(i,r,o,a,c,l,u)},t.staggerFromTo=function(i,r,o,a,c,l,u,h){return a.startAt=o,Si(a).immediateRender=ct(a.immediateRender),this.staggerTo(i,r,a,c,l,u,h)},t.render=function(i,r,o){var a=this._time,c=this._dirty?this.totalDuration():this._tDur,l=this._dur,u=i<=0?0:qe(i),h=this._zTime<0!=i<0&&(this._initted||!l),d,f,m,p,_,y,S,b,v,g,T,x;if(this!==Oe&&u>c&&i>=0&&(u=c),u!==this._tTime||o||h){if(a!==this._time&&l&&(u+=this._time-a,i+=this._time-a),d=u,v=this._start,b=this._ts,y=!b,h&&(l||(a=this._zTime),(i||!r)&&(this._zTime=i)),this._repeat){if(T=this._yoyo,_=l+this._rDelay,this._repeat<-1&&i<0)return this.totalTime(_*100+i,r,o);if(d=qe(u%_),u===c?(p=this._repeat,d=l):(p=~~(u/_),p&&p===u/_&&(d=l,p--),d>l&&(d=l)),g=Hn(this._tTime,_),!a&&this._tTime&&g!==p&&this._tTime-g*_-this._dur<=0&&(g=p),T&&p&1&&(d=l-d,x=1),p!==g&&!this._lock){var w=T&&g&1,C=w===(T&&p&1);if(p<g&&(w=!w),a=w?0:u%l?l:u,this._lock=1,this.render(a||(x?0:qe(p*_)),r,!l)._lock=0,this._tTime=u,!r&&this.parent&&gt(this,"onRepeat"),this.vars.repeatRefresh&&!x&&(this.invalidate()._lock=1),a&&a!==this._time||y!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(l=this._dur,c=this._tDur,C&&(this._lock=2,a=w?l:-1e-4,this.render(a,!0),this.vars.repeatRefresh&&!x&&this.invalidate()),this._lock=0,!this._ts&&!y)return this;Au(this,x)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(S=Wp(this,qe(a),qe(d)),S&&(u-=d-(d=S._start))),this._tTime=u,this._time=d,this._act=!b,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=i,a=0),!a&&d&&!r&&!p&&(gt(this,"onStart"),this._tTime!==u))return this;if(d>=a&&i>=0)for(f=this._first;f;){if(m=f._next,(f._act||d>=f._start)&&f._ts&&S!==f){if(f.parent!==this)return this.render(i,r,o);if(f.render(f._ts>0?(d-f._start)*f._ts:(f._dirty?f.totalDuration():f._tDur)+(d-f._start)*f._ts,r,o),d!==this._time||!this._ts&&!y){S=0,m&&(u+=this._zTime=-me);break}}f=m}else{f=this._last;for(var E=i<0?i:d;f;){if(m=f._prev,(f._act||E<=f._end)&&f._ts&&S!==f){if(f.parent!==this)return this.render(i,r,o);if(f.render(f._ts>0?(E-f._start)*f._ts:(f._dirty?f.totalDuration():f._tDur)+(E-f._start)*f._ts,r,o||Xe&&(f._initted||f._startAt)),d!==this._time||!this._ts&&!y){S=0,m&&(u+=this._zTime=E?-me:me);break}}f=m}}if(S&&!r&&(this.pause(),S.render(d>=a?0:-me)._zTime=d>=a?1:-1,this._ts))return this._start=v,_o(this),this.render(i,r,o);this._onUpdate&&!r&&gt(this,"onUpdate",!0),(u===c&&this._tTime>=this.totalDuration()||!u&&a)&&(v===this._start||Math.abs(b)!==Math.abs(this._ts))&&(this._lock||((i||!l)&&(u===c&&this._ts>0||!u&&this._ts<0)&&Fs(this,1),!r&&!(i<0&&!a)&&(u||a||!c)&&(gt(this,u===c&&i>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(u<c&&this.timeScale()>0)&&this._prom())))}return this},t.add=function(i,r){var o=this;if(ps(r)||(r=St(this,r,i)),!(i instanceof Ri)){if($e(i))return i.forEach(function(a){return o.add(a,r)}),this;if(je(i))return this.addLabel(i,r);if(ke(i))i=ze.delayedCall(0,i);else return this}return this!==i?Zt(this,i,r):this},t.getChildren=function(i,r,o,a){i===void 0&&(i=!0),r===void 0&&(r=!0),o===void 0&&(o=!0),a===void 0&&(a=-Ct);for(var c=[],l=this._first;l;)l._start>=a&&(l instanceof ze?r&&c.push(l):(o&&c.push(l),i&&c.push.apply(c,l.getChildren(!0,r,o)))),l=l._next;return c},t.getById=function(i){for(var r=this.getChildren(1,1,1),o=r.length;o--;)if(r[o].vars.id===i)return r[o]},t.remove=function(i){return je(i)?this.removeLabel(i):ke(i)?this.killTweensOf(i):(mo(this,i),i===this._recent&&(this._recent=this._last),rn(this))},t.totalTime=function(i,r){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=qe(_t.time-(this._ts>0?i/this._ts:(this.totalDuration()-i)/-this._ts))),n.prototype.totalTime.call(this,i,r),this._forcing=0,this):this._tTime},t.addLabel=function(i,r){return this.labels[i]=St(this,r),this},t.removeLabel=function(i){return delete this.labels[i],this},t.addPause=function(i,r,o){var a=ze.delayedCall(0,r||Mi,o);return a.data="isPause",this._hasPause=1,Zt(this,a,St(this,i))},t.removePause=function(i){var r=this._first;for(i=St(this,i);r;)r._start===i&&r.data==="isPause"&&Fs(r),r=r._next},t.killTweensOf=function(i,r,o){for(var a=this.getTweensOf(i,o),c=a.length;c--;)Ms!==a[c]&&a[c].kill(i,r);return this},t.getTweensOf=function(i,r){for(var o=[],a=Et(i),c=this._first,l=ps(r),u;c;)c instanceof ze?Up(c._targets,a)&&(l?(!Ms||c._initted&&c._ts)&&c.globalTime(0)<=r&&c.globalTime(c.totalDuration())>r:!r||c.isActive())&&o.push(c):(u=c.getTweensOf(a,r)).length&&o.push.apply(o,u),c=c._next;return o},t.tweenTo=function(i,r){r=r||{};var o=this,a=St(o,i),c=r,l=c.startAt,u=c.onStart,h=c.onStartParams,d=c.immediateRender,f,m=ze.to(o,Mt({ease:r.ease||"none",lazy:!1,immediateRender:!1,time:a,overwrite:"auto",duration:r.duration||Math.abs((a-(l&&"time"in l?l.time:o._time))/o.timeScale())||me,onStart:function(){if(o.pause(),!f){var _=r.duration||Math.abs((a-(l&&"time"in l?l.time:o._time))/o.timeScale());m._dur!==_&&qn(m,_,0,1).render(m._time,!0,!0),f=1}u&&u.apply(m,h||[])}},r));return d?m.render(0):m},t.tweenFromTo=function(i,r,o){return this.tweenTo(r,Mt({startAt:{time:St(this,i)}},o))},t.recent=function(){return this._recent},t.nextLabel=function(i){return i===void 0&&(i=this._time),Kc(this,St(this,i))},t.previousLabel=function(i){return i===void 0&&(i=this._time),Kc(this,St(this,i),1)},t.currentLabel=function(i){return arguments.length?this.seek(i,!0):this.previousLabel(this._time+me)},t.shiftChildren=function(i,r,o){o===void 0&&(o=0);for(var a=this._first,c=this.labels,l;a;)a._start>=o&&(a._start+=i,a._end+=i),a=a._next;if(r)for(l in c)c[l]>=o&&(c[l]+=i);return rn(this)},t.invalidate=function(i){var r=this._first;for(this._lock=0;r;)r.invalidate(i),r=r._next;return n.prototype.invalidate.call(this,i)},t.clear=function(i){i===void 0&&(i=!0);for(var r=this._first,o;r;)o=r._next,this.remove(r),r=o;return this._dp&&(this._time=this._tTime=this._pTime=0),i&&(this.labels={}),rn(this)},t.totalDuration=function(i){var r=0,o=this,a=o._last,c=Ct,l,u,h;if(arguments.length)return o.timeScale((o._repeat<0?o.duration():o.totalDuration())/(o.reversed()?-i:i));if(o._dirty){for(h=o.parent;a;)l=a._prev,a._dirty&&a.totalDuration(),u=a._start,u>c&&o._sort&&a._ts&&!o._lock?(o._lock=1,Zt(o,a,u-a._delay,1)._lock=0):c=u,u<0&&a._ts&&(r-=u,(!h&&!o._dp||h&&h.smoothChildTiming)&&(o._start+=u/o._ts,o._time-=u,o._tTime-=u),o.shiftChildren(-u,!1,-1/0),c=0),a._end>r&&a._ts&&(r=a._end),a=l;qn(o,o===Oe&&o._time>r?o._time:r,1,1),o._dirty=0}return o._tDur},e.updateRoot=function(i){if(Oe._ts&&(cu(Oe,Ur(i,Oe)),ou=_t.frame),_t.frame>=Zc){Zc+=vt.autoSleep||120;var r=Oe._first;if((!r||!r._ts)&&vt.autoSleep&&_t._listeners.length<2){for(;r&&!r._ts;)r=r._next;r||_t.sleep()}}},e}(Ri);Mt(et.prototype,{_lock:0,_hasPause:0,_forcing:0});var om=function(e,t,s,i,r,o,a){var c=new ut(this._pt,e,t,0,1,Fu,null,r),l=0,u=0,h,d,f,m,p,_,y,S;for(c.b=s,c.e=i,s+="",i+="",(y=~i.indexOf("random("))&&(i=Di(i)),o&&(S=[s,i],o(S,e,t),s=S[0],i=S[1]),d=s.match(Wo)||[];h=Wo.exec(i);)m=h[0],p=i.substring(l,h.index),f?f=(f+1)%5:p.substr(-5)==="rgba("&&(f=1),m!==d[u++]&&(_=parseFloat(d[u-1])||0,c._pt={_next:c._pt,p:p||u===1?p:",",s:_,c:m.charAt(1)==="="?Nn(_,m)-_:parseFloat(m)-_,m:f&&f<4?Math.round:0},l=Wo.lastIndex);return c.c=l<i.length?i.substring(l,i.length):"",c.fp=a,(tu.test(i)||y)&&(c.e=0),this._pt=c,c},Ga=function(e,t,s,i,r,o,a,c,l,u){ke(i)&&(i=i(r||0,e,o));var h=e[t],d=s!=="get"?s:ke(h)?l?e[t.indexOf("set")||!ke(e["get"+t.substr(3)])?t:"get"+t.substr(3)](l):e[t]():h,f=ke(h)?l?hm:Nu:Ya,m;if(je(i)&&(~i.indexOf("random(")&&(i=Di(i)),i.charAt(1)==="="&&(m=Nn(d,i)+(Ze(d)||0),(m||m===0)&&(i=m))),!u||d!==i||pa)return!isNaN(d*i)&&i!==""?(m=new ut(this._pt,e,t,+d||0,i-(d||0),typeof h=="boolean"?fm:Iu,0,f),l&&(m.fp=l),a&&m.modifier(a,this,e),this._pt=m):(!h&&!(t in e)&&Va(t,i),om.call(this,e,t,d,i,f,c||vt.stringFilter,l))},am=function(e,t,s,i,r){if(ke(e)&&(e=Ci(e,r,t,s,i)),!Qt(e)||e.style&&e.nodeType||$e(e)||Jl(e))return je(e)?Ci(e,r,t,s,i):e;var o={},a;for(a in e)o[a]=Ci(e[a],r,t,s,i);return o},ku=function(e,t,s,i,r,o){var a,c,l,u;if(mt[e]&&(a=new mt[e]).init(r,a.rawVars?t[e]:am(t[e],i,r,o,s),s,i,o)!==!1&&(s._pt=c=new ut(s._pt,r,e,0,1,a.render,a,0,a.priority),s!==Dn))for(l=s._ptLookup[s._targets.indexOf(r)],u=a._props.length;u--;)l[a._props[u]]=c;return a},Ms,pa,ja=function n(e,t,s){var i=e.vars,r=i.ease,o=i.startAt,a=i.immediateRender,c=i.lazy,l=i.onUpdate,u=i.runBackwards,h=i.yoyoEase,d=i.keyframes,f=i.autoRevert,m=e._dur,p=e._startAt,_=e._targets,y=e.parent,S=y&&y.data==="nested"?y.vars.targets:_,b=e._overwrite==="auto"&&!Ua,v=e.timeline,g,T,x,w,C,E,O,A,k,R,P,F,I;if(v&&(!d||!r)&&(r="none"),e._ease=on(r,Vn.ease),e._yEase=h?Ou(on(h===!0?r:h,Vn.ease)):0,h&&e._yoyo&&!e._repeat&&(h=e._yEase,e._yEase=e._ease,e._ease=h),e._from=!v&&!!i.runBackwards,!v||d&&!i.stagger){if(A=_[0]?nn(_[0]).harness:0,F=A&&i[A.prop],g=Fr(i,Ha),p&&(p._zTime<0&&p.progress(1),t<0&&u&&a&&!f?p.render(-1,!0):p.revert(u&&m?Ar:Ip),p._lazy=0),o){if(Fs(e._startAt=ze.set(_,Mt({data:"isStart",overwrite:!1,parent:y,immediateRender:!0,lazy:!p&&ct(c),startAt:null,delay:0,onUpdate:l&&function(){return gt(e,"onUpdate")},stagger:0},o))),e._startAt._dp=0,e._startAt._sat=e,t<0&&(Xe||!a&&!f)&&e._startAt.revert(Ar),a&&m&&t<=0&&s<=0){t&&(e._zTime=t);return}}else if(u&&m&&!p){if(t&&(a=!1),x=Mt({overwrite:!1,data:"isFromStart",lazy:a&&!p&&ct(c),immediateRender:a,stagger:0,parent:y},g),F&&(x[A.prop]=F),Fs(e._startAt=ze.set(_,x)),e._startAt._dp=0,e._startAt._sat=e,t<0&&(Xe?e._startAt.revert(Ar):e._startAt.render(-1,!0)),e._zTime=t,!a)n(e._startAt,me,me);else if(!t)return}for(e._pt=e._ptCache=0,c=m&&ct(c)||c&&!m,T=0;T<_.length;T++){if(C=_[T],O=C._gsap||Wa(_)[T]._gsap,e._ptLookup[T]=R={},ca[O.id]&&Ps.length&&Ir(),P=S===_?T:S.indexOf(C),A&&(k=new A).init(C,F||g,e,P,S)!==!1&&(e._pt=w=new ut(e._pt,C,k.name,0,1,k.render,k,0,k.priority),k._props.forEach(function(q){R[q]=w}),k.priority&&(E=1)),!A||F)for(x in g)mt[x]&&(k=ku(x,g,e,P,C,S))?k.priority&&(E=1):R[x]=w=Ga.call(e,C,x,"get",g[x],P,S,0,i.stringFilter);e._op&&e._op[T]&&e.kill(C,e._op[T]),b&&e._pt&&(Ms=e,Oe.killTweensOf(C,R,e.globalTime(t)),I=!e.parent,Ms=0),e._pt&&c&&(ca[O.id]=1)}E&&Uu(e),e._onInit&&e._onInit(e)}e._onUpdate=l,e._initted=(!e._op||e._pt)&&!I,d&&t<=0&&v.render(Ct,!0,!0)},cm=function(e,t,s,i,r,o,a,c){var l=(e._pt&&e._ptCache||(e._ptCache={}))[t],u,h,d,f;if(!l)for(l=e._ptCache[t]=[],d=e._ptLookup,f=e._targets.length;f--;){if(u=d[f][t],u&&u.d&&u.d._pt)for(u=u.d._pt;u&&u.p!==t&&u.fp!==t;)u=u._next;if(!u)return pa=1,e.vars[t]="+=0",ja(e,a),pa=0,c?Ai(t+" not eligible for reset"):1;l.push(u)}for(f=l.length;f--;)h=l[f],u=h._pt||h,u.s=(i||i===0)&&!r?i:u.s+(i||0)+o*u.c,u.c=s-u.s,h.e&&(h.e=Ne(s)+Ze(h.e)),h.b&&(h.b=u.s+Ze(h.b))},lm=function(e,t){var s=e[0]?nn(e[0]).harness:0,i=s&&s.aliases,r,o,a,c;if(!i)return t;r=un({},t);for(o in i)if(o in r)for(c=i[o].split(","),a=c.length;a--;)r[c[a]]=r[o];return r},um=function(e,t,s,i){var r=t.ease||i||"power1.inOut",o,a;if($e(t))a=s[e]||(s[e]=[]),t.forEach(function(c,l){return a.push({t:l/(t.length-1)*100,v:c,e:r})});else for(o in t)a=s[o]||(s[o]=[]),o==="ease"||a.push({t:parseFloat(e),v:t[o],e:r})},Ci=function(e,t,s,i,r){return ke(e)?e.call(t,s,i,r):je(e)&&~e.indexOf("random(")?Di(e):e},Ru=qa+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",Pu={};lt(Ru+",id,stagger,delay,duration,paused,scrollTrigger",function(n){return Pu[n]=1});var ze=function(n){Ql(e,n);function e(s,i,r,o){var a;typeof i=="number"&&(r.duration=i,i=r,r=null),a=n.call(this,o?i:Si(i))||this;var c=a.vars,l=c.duration,u=c.delay,h=c.immediateRender,d=c.stagger,f=c.overwrite,m=c.keyframes,p=c.defaults,_=c.scrollTrigger,y=c.yoyoEase,S=i.parent||Oe,b=($e(s)||Jl(s)?ps(s[0]):"length"in i)?[s]:Et(s),v,g,T,x,w,C,E,O;if(a._targets=b.length?Wa(b):Ai("GSAP target "+s+" not found. https://gsap.com",!vt.nullTargetWarn)||[],a._ptLookup=[],a._overwrite=f,m||d||Sr(l)||Sr(u)){if(i=a.vars,v=a.timeline=new et({data:"nested",defaults:p||{},targets:S&&S.data==="nested"?S.vars.targets:b}),v.kill(),v.parent=v._dp=as(a),v._start=0,d||Sr(l)||Sr(u)){if(x=b.length,E=d&&gu(d),Qt(d))for(w in d)~Ru.indexOf(w)&&(O||(O={}),O[w]=d[w]);for(g=0;g<x;g++)T=Fr(i,Pu),T.stagger=0,y&&(T.yoyoEase=y),O&&un(T,O),C=b[g],T.duration=+Ci(l,as(a),g,C,b),T.delay=(+Ci(u,as(a),g,C,b)||0)-a._delay,!d&&x===1&&T.delay&&(a._delay=u=T.delay,a._start+=u,T.delay=0),v.to(C,T,E?E(g,C,b):0),v._ease=te.none;v.duration()?l=u=0:a.timeline=0}else if(m){Si(Mt(v.vars.defaults,{ease:"none"})),v._ease=on(m.ease||i.ease||"none");var A=0,k,R,P;if($e(m))m.forEach(function(F){return v.to(b,F,">")}),v.duration();else{T={};for(w in m)w==="ease"||w==="easeEach"||um(w,m[w],T,m.easeEach);for(w in T)for(k=T[w].sort(function(F,I){return F.t-I.t}),A=0,g=0;g<k.length;g++)R=k[g],P={ease:R.e,duration:(R.t-(g?k[g-1].t:0))/100*l},P[w]=R.v,v.to(b,P,A),A+=P.duration;v.duration()<l&&v.to({},{duration:l-v.duration()})}}l||a.duration(l=v.duration())}else a.timeline=0;return f===!0&&!Ua&&(Ms=as(a),Oe.killTweensOf(b),Ms=0),Zt(S,as(a),r),i.reversed&&a.reverse(),i.paused&&a.paused(!0),(h||!l&&!m&&a._start===qe(S._time)&&ct(h)&&Vp(as(a))&&S.data!=="nested")&&(a._tTime=-me,a.render(Math.max(0,-u)||0)),_&&fu(as(a),_),a}var t=e.prototype;return t.render=function(i,r,o){var a=this._time,c=this._tDur,l=this._dur,u=i<0,h=i>c-me&&!u?c:i<me?0:i,d,f,m,p,_,y,S,b,v;if(!l)qp(this,i,r,o);else if(h!==this._tTime||!i||o||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==u){if(d=h,b=this.timeline,this._repeat){if(p=l+this._rDelay,this._repeat<-1&&u)return this.totalTime(p*100+i,r,o);if(d=qe(h%p),h===c?(m=this._repeat,d=l):(m=~~(h/p),m&&m===qe(h/p)&&(d=l,m--),d>l&&(d=l)),y=this._yoyo&&m&1,y&&(v=this._yEase,d=l-d),_=Hn(this._tTime,p),d===a&&!o&&this._initted&&m===_)return this._tTime=h,this;m!==_&&(b&&this._yEase&&Au(b,y),this.vars.repeatRefresh&&!y&&!this._lock&&this._time!==l&&this._initted&&(this._lock=o=1,this.render(qe(p*m),!0).invalidate()._lock=0))}if(!this._initted){if(pu(this,u?i:d,o,r,h))return this._tTime=0,this;if(a!==this._time&&!(o&&this.vars.repeatRefresh&&m!==_))return this;if(l!==this._dur)return this.render(i,r,o)}if(this._tTime=h,this._time=d,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=S=(v||this._ease)(d/l),this._from&&(this.ratio=S=1-S),d&&!a&&!r&&!m&&(gt(this,"onStart"),this._tTime!==h))return this;for(f=this._pt;f;)f.r(S,f.d),f=f._next;b&&b.render(i<0?i:!d&&y?-me:b._dur*b._ease(d/this._dur),r,o)||this._startAt&&(this._zTime=i),this._onUpdate&&!r&&(u&&la(this,i,r,o),gt(this,"onUpdate")),this._repeat&&m!==_&&this.vars.onRepeat&&!r&&this.parent&&gt(this,"onRepeat"),(h===this._tDur||!h)&&this._tTime===h&&(u&&!this._onUpdate&&la(this,i,!0,!0),(i||!l)&&(h===this._tDur&&this._ts>0||!h&&this._ts<0)&&Fs(this,1),!r&&!(u&&!a)&&(h||a||y)&&(gt(this,h===c?"onComplete":"onReverseComplete",!0),this._prom&&!(h<c&&this.timeScale()>0)&&this._prom()))}return this},t.targets=function(){return this._targets},t.invalidate=function(i){return(!i||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(i),n.prototype.invalidate.call(this,i)},t.resetTo=function(i,r,o,a,c){ki||_t.wake(),this._ts||this.play();var l=Math.min(this._dur,(this._dp._time-this._start)*this._ts),u;return this._initted||ja(this,l),u=this._ease(l/this._dur),cm(this,i,r,o,a,u,l,c)?this.resetTo(i,r,o,a,1):(go(this,0),this.parent||hu(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},t.kill=function(i,r){if(r===void 0&&(r="all"),!i&&(!r||r==="all"))return this._lazy=this._pt=0,this.parent?xi(this):this;if(this.timeline){var o=this.timeline.totalDuration();return this.timeline.killTweensOf(i,r,Ms&&Ms.vars.overwrite!==!0)._first||xi(this),this.parent&&o!==this.timeline.totalDuration()&&qn(this,this._dur*this.timeline._tDur/o,0,1),this}var a=this._targets,c=i?Et(i):a,l=this._ptLookup,u=this._pt,h,d,f,m,p,_,y;if((!r||r==="all")&&Bp(a,c))return r==="all"&&(this._pt=0),xi(this);for(h=this._op=this._op||[],r!=="all"&&(je(r)&&(p={},lt(r,function(S){return p[S]=1}),r=p),r=lm(a,r)),y=a.length;y--;)if(~c.indexOf(a[y])){d=l[y],r==="all"?(h[y]=r,m=d,f={}):(f=h[y]=h[y]||{},m=r);for(p in m)_=d&&d[p],_&&((!("kill"in _.d)||_.d.kill(p)===!0)&&mo(this,_,"_pt"),delete d[p]),f!=="all"&&(f[p]=1)}return this._initted&&!this._pt&&u&&xi(this),this},e.to=function(i,r){return new e(i,r,arguments[2])},e.from=function(i,r){return bi(1,arguments)},e.delayedCall=function(i,r,o,a){return new e(r,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:i,onComplete:r,onReverseComplete:r,onCompleteParams:o,onReverseCompleteParams:o,callbackScope:a})},e.fromTo=function(i,r,o){return bi(2,arguments)},e.set=function(i,r){return r.duration=0,r.repeatDelay||(r.repeat=0),new e(i,r)},e.killTweensOf=function(i,r,o){return Oe.killTweensOf(i,r,o)},e}(Ri);Mt(ze.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0});lt("staggerTo,staggerFrom,staggerFromTo",function(n){ze[n]=function(){var e=new et,t=ha.call(arguments,0);return t.splice(n==="staggerFromTo"?5:4,0,0),e[n].apply(e,t)}});var Ya=function(e,t,s){return e[t]=s},Nu=function(e,t,s){return e[t](s)},hm=function(e,t,s,i){return e[t](i.fp,s)},dm=function(e,t,s){return e.setAttribute(t,s)},Za=function(e,t){return ke(e[t])?Nu:La(e[t])&&e.setAttribute?dm:Ya},Iu=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e6)/1e6,t)},fm=function(e,t){return t.set(t.t,t.p,!!(t.s+t.c*e),t)},Fu=function(e,t){var s=t._pt,i="";if(!e&&t.b)i=t.b;else if(e===1&&t.e)i=t.e;else{for(;s;)i=s.p+(s.m?s.m(s.s+s.c*e):Math.round((s.s+s.c*e)*1e4)/1e4)+i,s=s._next;i+=t.c}t.set(t.t,t.p,i,t)},Xa=function(e,t){for(var s=t._pt;s;)s.r(e,s.d),s=s._next},pm=function(e,t,s,i){for(var r=this._pt,o;r;)o=r._next,r.p===i&&r.modifier(e,t,s),r=o},mm=function(e){for(var t=this._pt,s,i;t;)i=t._next,t.p===e&&!t.op||t.op===e?mo(this,t,"_pt"):t.dep||(s=1),t=i;return!s},_m=function(e,t,s,i){i.mSet(e,t,i.m.call(i.tween,s,i.mt),i)},Uu=function(e){for(var t=e._pt,s,i,r,o;t;){for(s=t._next,i=r;i&&i.pr>t.pr;)i=i._next;(t._prev=i?i._prev:o)?t._prev._next=t:r=t,(t._next=i)?i._prev=t:o=t,t=s}e._pt=r},ut=function(){function n(t,s,i,r,o,a,c,l,u){this.t=s,this.s=r,this.c=o,this.p=i,this.r=a||Iu,this.d=c||this,this.set=l||Ya,this.pr=u||0,this._next=t,t&&(t._prev=this)}var e=n.prototype;return e.modifier=function(s,i,r){this.mSet=this.mSet||this.set,this.set=_m,this.m=s,this.mt=r,this.tween=i},n}();lt(qa+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",function(n){return Ha[n]=1});xt.TweenMax=xt.TweenLite=ze;xt.TimelineLite=xt.TimelineMax=et;Oe=new et({sortChildren:!1,defaults:Vn,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0});vt.stringFilter=Eu;var an=[],Dr={},gm=[],el=0,vm=0,Xo=function(e){return(Dr[e]||gm).map(function(t){return t()})},ma=function(){var e=Date.now(),t=[];e-el>2&&(Xo("matchMediaInit"),an.forEach(function(s){var i=s.queries,r=s.conditions,o,a,c,l;for(a in i)o=bt.matchMedia(i[a]).matches,o&&(c=1),o!==r[a]&&(r[a]=o,l=1);l&&(s.revert(),c&&t.push(s))}),Xo("matchMediaRevert"),t.forEach(function(s){return s.onMatch(s,function(i){return s.add(null,i)})}),el=e,Xo("matchMedia"))},Lu=function(){function n(t,s){this.selector=s&&da(s),this.data=[],this._r=[],this.isReverted=!1,this.id=vm++,t&&this.add(t)}var e=n.prototype;return e.add=function(s,i,r){ke(s)&&(r=i,i=s,s=ke);var o=this,a=function(){var l=Me,u=o.selector,h;return l&&l!==o&&l.data.push(o),r&&(o.selector=da(r)),Me=o,h=i.apply(o,arguments),ke(h)&&o._r.push(h),Me=l,o.selector=u,o.isReverted=!1,h};return o.last=a,s===ke?a(o,function(c){return o.add(null,c)}):s?o[s]=a:a},e.ignore=function(s){var i=Me;Me=null,s(this),Me=i},e.getTweens=function(){var s=[];return this.data.forEach(function(i){return i instanceof n?s.push.apply(s,i.getTweens()):i instanceof ze&&!(i.parent&&i.parent.data==="nested")&&s.push(i)}),s},e.clear=function(){this._r.length=this.data.length=0},e.kill=function(s,i){var r=this;if(s?function(){for(var a=r.getTweens(),c=r.data.length,l;c--;)l=r.data[c],l.data==="isFlip"&&(l.revert(),l.getChildren(!0,!0,!1).forEach(function(u){return a.splice(a.indexOf(u),1)}));for(a.map(function(u){return{g:u._dur||u._delay||u._sat&&!u._sat.vars.immediateRender?u.globalTime(0):-1/0,t:u}}).sort(function(u,h){return h.g-u.g||-1/0}).forEach(function(u){return u.t.revert(s)}),c=r.data.length;c--;)l=r.data[c],l instanceof et?l.data!=="nested"&&(l.scrollTrigger&&l.scrollTrigger.revert(),l.kill()):!(l instanceof ze)&&l.revert&&l.revert(s);r._r.forEach(function(u){return u(s,r)}),r.isReverted=!0}():this.data.forEach(function(a){return a.kill&&a.kill()}),this.clear(),i)for(var o=an.length;o--;)an[o].id===this.id&&an.splice(o,1)},e.revert=function(s){this.kill(s||{})},n}(),ym=function(){function n(t){this.contexts=[],this.scope=t}var e=n.prototype;return e.add=function(s,i,r){Qt(s)||(s={matches:s});var o=new Lu(0,r||this.scope),a=o.conditions={},c,l,u;Me&&!o.selector&&(o.selector=Me.selector),this.contexts.push(o),i=o.add("onMatch",i),o.queries=s;for(l in s)l==="all"?u=1:(c=bt.matchMedia(s[l]),c&&(an.indexOf(o)<0&&an.push(o),(a[l]=c.matches)&&(u=1),c.addListener?c.addListener(ma):c.addEventListener("change",ma)));return u&&i(o,function(h){return o.add(null,h)}),this},e.revert=function(s){this.kill(s||{})},e.kill=function(s){this.contexts.forEach(function(i){return i.kill(s,!0)})},n}(),Lr={registerPlugin:function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];t.forEach(function(i){return Su(i)})},timeline:function(e){return new et(e)},getTweensOf:function(e,t){return Oe.getTweensOf(e,t)},getProperty:function(e,t,s,i){je(e)&&(e=Et(e)[0]);var r=nn(e||{}).get,o=s?uu:lu;return s==="native"&&(s=""),e&&(t?o((mt[t]&&mt[t].get||r)(e,t,s,i)):function(a,c,l){return o((mt[a]&&mt[a].get||r)(e,a,c,l))})},quickSetter:function(e,t,s){if(e=Et(e),e.length>1){var i=e.map(function(u){return ft.quickSetter(u,t,s)}),r=i.length;return function(u){for(var h=r;h--;)i[h](u)}}e=e[0]||{};var o=mt[t],a=nn(e),c=a.harness&&(a.harness.aliases||{})[t]||t,l=o?function(u){var h=new o;Dn._pt=0,h.init(e,s?u+s:u,Dn,0,[e]),h.render(1,h),Dn._pt&&Xa(1,Dn)}:a.set(e,c);return o?l:function(u){return l(e,c,s?u+s:u,a,1)}},quickTo:function(e,t,s){var i,r=ft.to(e,un((i={},i[t]="+=0.1",i.paused=!0,i),s||{})),o=function(c,l,u){return r.resetTo(t,c,l,u)};return o.tween=r,o},isTweening:function(e){return Oe.getTweensOf(e,!0).length>0},defaults:function(e){return e&&e.ease&&(e.ease=on(e.ease,Vn.ease)),Xc(Vn,e||{})},config:function(e){return Xc(vt,e||{})},registerEffect:function(e){var t=e.name,s=e.effect,i=e.plugins,r=e.defaults,o=e.extendTimeline;(i||"").split(",").forEach(function(a){return a&&!mt[a]&&!xt[a]&&Ai(t+" effect requires "+a+" plugin.")}),Go[t]=function(a,c,l){return s(Et(a),Mt(c||{},r),l)},o&&(et.prototype[t]=function(a,c,l){return this.add(Go[t](a,Qt(c)?c:(l=c)&&{},this),l)})},registerEase:function(e,t){te[e]=on(t)},parseEase:function(e,t){return arguments.length?on(e,t):te},getById:function(e){return Oe.getById(e)},exportRoot:function(e,t){e===void 0&&(e={});var s=new et(e),i,r;for(s.smoothChildTiming=ct(e.smoothChildTiming),Oe.remove(s),s._dp=0,s._time=s._tTime=Oe._time,i=Oe._first;i;)r=i._next,(t||!(!i._dur&&i instanceof ze&&i.vars.onComplete===i._targets[0]))&&Zt(s,i,i._start-i._delay),i=r;return Zt(Oe,s,0),s},context:function(e,t){return e?new Lu(e,t):Me},matchMedia:function(e){return new ym(e)},matchMediaRefresh:function(){return an.forEach(function(e){var t=e.conditions,s,i;for(i in t)t[i]&&(t[i]=!1,s=1);s&&e.revert()})||ma()},addEventListener:function(e,t){var s=Dr[e]||(Dr[e]=[]);~s.indexOf(t)||s.push(t)},removeEventListener:function(e,t){var s=Dr[e],i=s&&s.indexOf(t);i>=0&&s.splice(i,1)},utils:{wrap:Qp,wrapYoyo:Kp,distribute:gu,random:yu,snap:vu,normalize:$p,getUnit:Ze,clamp:jp,splitColor:bu,toArray:Et,selector:da,mapRange:xu,pipe:Zp,unitize:Xp,interpolate:Jp,shuffle:_u},install:iu,effects:Go,ticker:_t,updateRoot:et.updateRoot,plugins:mt,globalTimeline:Oe,core:{PropTween:ut,globals:ru,Tween:ze,Timeline:et,Animation:Ri,getCache:nn,_removeLinkedListItem:mo,reverting:function(){return Xe},context:function(e){return e&&Me&&(Me.data.push(e),e._ctx=Me),Me},suppressOverwrites:function(e){return Ua=e}}};lt("to,from,fromTo,delayedCall,set,killTweensOf",function(n){return Lr[n]=ze[n]});_t.add(et.updateRoot);Dn=Lr.to({},{duration:0});var Tm=function(e,t){for(var s=e._pt;s&&s.p!==t&&s.op!==t&&s.fp!==t;)s=s._next;return s},xm=function(e,t){var s=e._targets,i,r,o;for(i in t)for(r=s.length;r--;)o=e._ptLookup[r][i],o&&(o=o.d)&&(o._pt&&(o=Tm(o,i)),o&&o.modifier&&o.modifier(t[i],e,s[r],i))},$o=function(e,t){return{name:e,rawVars:1,init:function(i,r,o){o._onInit=function(a){var c,l;if(je(r)&&(c={},lt(r,function(u){return c[u]=1}),r=c),t){c={};for(l in r)c[l]=t(r[l]);r=c}xm(a,r)}}}},ft=Lr.registerPlugin({name:"attr",init:function(e,t,s,i,r){var o,a,c;this.tween=s;for(o in t)c=e.getAttribute(o)||"",a=this.add(e,"setAttribute",(c||0)+"",t[o],i,r,0,0,o),a.op=o,a.b=c,this._props.push(o)},render:function(e,t){for(var s=t._pt;s;)Xe?s.set(s.t,s.p,s.b,s):s.r(e,s.d),s=s._next}},{name:"endArray",init:function(e,t){for(var s=t.length;s--;)this.add(e,s,e[s]||0,t[s],0,0,0,0,0,1)}},$o("roundProps",fa),$o("modifiers"),$o("snap",vu))||Lr;ze.version=et.version=ft.version="3.12.4";nu=1;Ba()&&Wn();te.Power0;te.Power1;te.Power2;te.Power3;te.Power4;te.Linear;te.Quad;te.Cubic;te.Quart;te.Quint;te.Strong;te.Elastic;te.Back;te.SteppedEase;te.Bounce;te.Sine;te.Expo;te.Circ;/*!
 * CSSPlugin 3.12.4
 * https://gsap.com
 *
 * Copyright 2008-2023, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license or for
 * Club GSAP members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var tl,Ds,In,$a,tn,sl,Qa,wm=function(){return typeof window<"u"},ms={},Js=180/Math.PI,Fn=Math.PI/180,En=Math.atan2,nl=1e8,Ka=/([A-Z])/g,Sm=/(left|right|width|margin|padding|x)/i,bm=/[\s,\(]\S/,Xt={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},_a=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},Cm=function(e,t){return t.set(t.t,t.p,e===1?t.e:Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},Em=function(e,t){return t.set(t.t,t.p,e?Math.round((t.s+t.c*e)*1e4)/1e4+t.u:t.b,t)},Om=function(e,t){var s=t.s+t.c*e;t.set(t.t,t.p,~~(s+(s<0?-.5:.5))+t.u,t)},Bu=function(e,t){return t.set(t.t,t.p,e?t.e:t.b,t)},zu=function(e,t){return t.set(t.t,t.p,e!==1?t.b:t.e,t)},Am=function(e,t,s){return e.style[t]=s},Mm=function(e,t,s){return e.style.setProperty(t,s)},Dm=function(e,t,s){return e._gsap[t]=s},km=function(e,t,s){return e._gsap.scaleX=e._gsap.scaleY=s},Rm=function(e,t,s,i,r){var o=e._gsap;o.scaleX=o.scaleY=s,o.renderTransform(r,o)},Pm=function(e,t,s,i,r){var o=e._gsap;o[t]=s,o.renderTransform(r,o)},Ae="transform",ht=Ae+"Origin",Nm=function n(e,t){var s=this,i=this.target,r=i.style,o=i._gsap;if(e in ms&&r){if(this.tfm=this.tfm||{},e!=="transform")e=Xt[e]||e,~e.indexOf(",")?e.split(",").forEach(function(a){return s.tfm[a]=ls(i,a)}):this.tfm[e]=o.x?o[e]:ls(i,e),e===ht&&(this.tfm.zOrigin=o.zOrigin);else return Xt.transform.split(",").forEach(function(a){return n.call(s,a,t)});if(this.props.indexOf(Ae)>=0)return;o.svg&&(this.svgo=i.getAttribute("data-svg-origin"),this.props.push(ht,t,"")),e=Ae}(r||t)&&this.props.push(e,t,r[e])},Vu=function(e){e.translate&&(e.removeProperty("translate"),e.removeProperty("scale"),e.removeProperty("rotate"))},Im=function(){var e=this.props,t=this.target,s=t.style,i=t._gsap,r,o;for(r=0;r<e.length;r+=3)e[r+1]?t[e[r]]=e[r+2]:e[r+2]?s[e[r]]=e[r+2]:s.removeProperty(e[r].substr(0,2)==="--"?e[r]:e[r].replace(Ka,"-$1").toLowerCase());if(this.tfm){for(o in this.tfm)i[o]=this.tfm[o];i.svg&&(i.renderTransform(),t.setAttribute("data-svg-origin",this.svgo||"")),r=Qa(),(!r||!r.isStart)&&!s[Ae]&&(Vu(s),i.zOrigin&&s[ht]&&(s[ht]+=" "+i.zOrigin+"px",i.zOrigin=0,i.renderTransform()),i.uncache=1)}},Hu=function(e,t){var s={target:e,props:[],revert:Im,save:Nm};return e._gsap||ft.core.getCache(e),t&&t.split(",").forEach(function(i){return s.save(i)}),s},qu,ga=function(e,t){var s=Ds.createElementNS?Ds.createElementNS((t||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),e):Ds.createElement(e);return s&&s.style?s:Ds.createElement(e)},$t=function n(e,t,s){var i=getComputedStyle(e);return i[t]||i.getPropertyValue(t.replace(Ka,"-$1").toLowerCase())||i.getPropertyValue(t)||!s&&n(e,Gn(t)||t,1)||""},il="O,Moz,ms,Ms,Webkit".split(","),Gn=function(e,t,s){var i=t||tn,r=i.style,o=5;if(e in r&&!s)return e;for(e=e.charAt(0).toUpperCase()+e.substr(1);o--&&!(il[o]+e in r););return o<0?null:(o===3?"ms":o>=0?il[o]:"")+e},va=function(){wm()&&window.document&&(tl=window,Ds=tl.document,In=Ds.documentElement,tn=ga("div")||{style:{}},ga("div"),Ae=Gn(Ae),ht=Ae+"Origin",tn.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",qu=!!Gn("perspective"),Qa=ft.core.reverting,$a=1)},Qo=function n(e){var t=ga("svg",this.ownerSVGElement&&this.ownerSVGElement.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),s=this.parentNode,i=this.nextSibling,r=this.style.cssText,o;if(In.appendChild(t),t.appendChild(this),this.style.display="block",e)try{o=this.getBBox(),this._gsapBBox=this.getBBox,this.getBBox=n}catch{}else this._gsapBBox&&(o=this._gsapBBox());return s&&(i?s.insertBefore(this,i):s.appendChild(this)),In.removeChild(t),this.style.cssText=r,o},rl=function(e,t){for(var s=t.length;s--;)if(e.hasAttribute(t[s]))return e.getAttribute(t[s])},Wu=function(e){var t;try{t=e.getBBox()}catch{t=Qo.call(e,!0)}return t&&(t.width||t.height)||e.getBBox===Qo||(t=Qo.call(e,!0)),t&&!t.width&&!t.x&&!t.y?{x:+rl(e,["x","cx","x1"])||0,y:+rl(e,["y","cy","y1"])||0,width:0,height:0}:t},Gu=function(e){return!!(e.getCTM&&(!e.parentNode||e.ownerSVGElement)&&Wu(e))},hn=function(e,t){if(t){var s=e.style,i;t in ms&&t!==ht&&(t=Ae),s.removeProperty?(i=t.substr(0,2),(i==="ms"||t.substr(0,6)==="webkit")&&(t="-"+t),s.removeProperty(i==="--"?t:t.replace(Ka,"-$1").toLowerCase())):s.removeAttribute(t)}},ks=function(e,t,s,i,r,o){var a=new ut(e._pt,t,s,0,1,o?zu:Bu);return e._pt=a,a.b=i,a.e=r,e._props.push(s),a},ol={deg:1,rad:1,turn:1},Fm={grid:1,flex:1},Us=function n(e,t,s,i){var r=parseFloat(s)||0,o=(s+"").trim().substr((r+"").length)||"px",a=tn.style,c=Sm.test(t),l=e.tagName.toLowerCase()==="svg",u=(l?"client":"offset")+(c?"Width":"Height"),h=100,d=i==="px",f=i==="%",m,p,_,y;if(i===o||!r||ol[i]||ol[o])return r;if(o!=="px"&&!d&&(r=n(e,t,s,"px")),y=e.getCTM&&Gu(e),(f||o==="%")&&(ms[t]||~t.indexOf("adius")))return m=y?e.getBBox()[c?"width":"height"]:e[u],Ne(f?r/m*h:r/100*m);if(a[c?"width":"height"]=h+(d?o:i),p=~t.indexOf("adius")||i==="em"&&e.appendChild&&!l?e:e.parentNode,y&&(p=(e.ownerSVGElement||{}).parentNode),(!p||p===Ds||!p.appendChild)&&(p=Ds.body),_=p._gsap,_&&f&&_.width&&c&&_.time===_t.time&&!_.uncache)return Ne(r/_.width*h);if(f&&(t==="height"||t==="width")){var S=e.style[t];e.style[t]=h+i,m=e[u],S?e.style[t]=S:hn(e,t)}else(f||o==="%")&&!Fm[$t(p,"display")]&&(a.position=$t(e,"position")),p===e&&(a.position="static"),p.appendChild(tn),m=tn[u],p.removeChild(tn),a.position="absolute";return c&&f&&(_=nn(p),_.time=_t.time,_.width=p[u]),Ne(d?m*r/h:m&&r?h/m*r:0)},ls=function(e,t,s,i){var r;return $a||va(),t in Xt&&t!=="transform"&&(t=Xt[t],~t.indexOf(",")&&(t=t.split(",")[0])),ms[t]&&t!=="transform"?(r=Ni(e,i),r=t!=="transformOrigin"?r[t]:r.svg?r.origin:zr($t(e,ht))+" "+r.zOrigin+"px"):(r=e.style[t],(!r||r==="auto"||i||~(r+"").indexOf("calc("))&&(r=Br[t]&&Br[t](e,t,s)||$t(e,t)||au(e,t)||(t==="opacity"?1:0))),s&&!~(r+"").trim().indexOf(" ")?Us(e,t,r,s)+s:r},Um=function(e,t,s,i){if(!s||s==="none"){var r=Gn(t,e,1),o=r&&$t(e,r,1);o&&o!==s?(t=r,s=o):t==="borderColor"&&(s=$t(e,"borderTopColor"))}var a=new ut(this._pt,e.style,t,0,1,Fu),c=0,l=0,u,h,d,f,m,p,_,y,S,b,v,g;if(a.b=s,a.e=i,s+="",i+="",i==="auto"&&(p=e.style[t],e.style[t]=i,i=$t(e,t)||i,p?e.style[t]=p:hn(e,t)),u=[s,i],Eu(u),s=u[0],i=u[1],d=s.match(Mn)||[],g=i.match(Mn)||[],g.length){for(;h=Mn.exec(i);)_=h[0],S=i.substring(c,h.index),m?m=(m+1)%5:(S.substr(-5)==="rgba("||S.substr(-5)==="hsla(")&&(m=1),_!==(p=d[l++]||"")&&(f=parseFloat(p)||0,v=p.substr((f+"").length),_.charAt(1)==="="&&(_=Nn(f,_)+v),y=parseFloat(_),b=_.substr((y+"").length),c=Mn.lastIndex-b.length,b||(b=b||vt.units[t]||v,c===i.length&&(i+=b,a.e+=b)),v!==b&&(f=Us(e,t,p,b)||0),a._pt={_next:a._pt,p:S||l===1?S:",",s:f,c:y-f,m:m&&m<4||t==="zIndex"?Math.round:0});a.c=c<i.length?i.substring(c,i.length):""}else a.r=t==="display"&&i==="none"?zu:Bu;return tu.test(i)&&(a.e=0),this._pt=a,a},al={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},Lm=function(e){var t=e.split(" "),s=t[0],i=t[1]||"50%";return(s==="top"||s==="bottom"||i==="left"||i==="right")&&(e=s,s=i,i=e),t[0]=al[s]||s,t[1]=al[i]||i,t.join(" ")},Bm=function(e,t){if(t.tween&&t.tween._time===t.tween._dur){var s=t.t,i=s.style,r=t.u,o=s._gsap,a,c,l;if(r==="all"||r===!0)i.cssText="",c=1;else for(r=r.split(","),l=r.length;--l>-1;)a=r[l],ms[a]&&(c=1,a=a==="transformOrigin"?ht:Ae),hn(s,a);c&&(hn(s,Ae),o&&(o.svg&&s.removeAttribute("transform"),Ni(s,1),o.uncache=1,Vu(i)))}},Br={clearProps:function(e,t,s,i,r){if(r.data!=="isFromStart"){var o=e._pt=new ut(e._pt,t,s,0,0,Bm);return o.u=i,o.pr=-10,o.tween=r,e._props.push(s),1}}},Pi=[1,0,0,1,0,0],ju={},Yu=function(e){return e==="matrix(1, 0, 0, 1, 0, 0)"||e==="none"||!e},cl=function(e){var t=$t(e,Ae);return Yu(t)?Pi:t.substr(7).match(eu).map(Ne)},Ja=function(e,t){var s=e._gsap||nn(e),i=e.style,r=cl(e),o,a,c,l;return s.svg&&e.getAttribute("transform")?(c=e.transform.baseVal.consolidate().matrix,r=[c.a,c.b,c.c,c.d,c.e,c.f],r.join(",")==="1,0,0,1,0,0"?Pi:r):(r===Pi&&!e.offsetParent&&e!==In&&!s.svg&&(c=i.display,i.display="block",o=e.parentNode,(!o||!e.offsetParent)&&(l=1,a=e.nextElementSibling,In.appendChild(e)),r=cl(e),c?i.display=c:hn(e,"display"),l&&(a?o.insertBefore(e,a):o?o.appendChild(e):In.removeChild(e))),t&&r.length>6?[r[0],r[1],r[4],r[5],r[12],r[13]]:r)},ya=function(e,t,s,i,r,o){var a=e._gsap,c=r||Ja(e,!0),l=a.xOrigin||0,u=a.yOrigin||0,h=a.xOffset||0,d=a.yOffset||0,f=c[0],m=c[1],p=c[2],_=c[3],y=c[4],S=c[5],b=t.split(" "),v=parseFloat(b[0])||0,g=parseFloat(b[1])||0,T,x,w,C;s?c!==Pi&&(x=f*_-m*p)&&(w=v*(_/x)+g*(-p/x)+(p*S-_*y)/x,C=v*(-m/x)+g*(f/x)-(f*S-m*y)/x,v=w,g=C):(T=Wu(e),v=T.x+(~b[0].indexOf("%")?v/100*T.width:v),g=T.y+(~(b[1]||b[0]).indexOf("%")?g/100*T.height:g)),i||i!==!1&&a.smooth?(y=v-l,S=g-u,a.xOffset=h+(y*f+S*p)-y,a.yOffset=d+(y*m+S*_)-S):a.xOffset=a.yOffset=0,a.xOrigin=v,a.yOrigin=g,a.smooth=!!i,a.origin=t,a.originIsAbsolute=!!s,e.style[ht]="0px 0px",o&&(ks(o,a,"xOrigin",l,v),ks(o,a,"yOrigin",u,g),ks(o,a,"xOffset",h,a.xOffset),ks(o,a,"yOffset",d,a.yOffset)),e.setAttribute("data-svg-origin",v+" "+g)},Ni=function(e,t){var s=e._gsap||new Du(e);if("x"in s&&!t&&!s.uncache)return s;var i=e.style,r=s.scaleX<0,o="px",a="deg",c=getComputedStyle(e),l=$t(e,ht)||"0",u,h,d,f,m,p,_,y,S,b,v,g,T,x,w,C,E,O,A,k,R,P,F,I,q,B,V,H,L,se,ne,W;return u=h=d=p=_=y=S=b=v=0,f=m=1,s.svg=!!(e.getCTM&&Gu(e)),c.translate&&((c.translate!=="none"||c.scale!=="none"||c.rotate!=="none")&&(i[Ae]=(c.translate!=="none"?"translate3d("+(c.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+(c.rotate!=="none"?"rotate("+c.rotate+") ":"")+(c.scale!=="none"?"scale("+c.scale.split(" ").join(",")+") ":"")+(c[Ae]!=="none"?c[Ae]:"")),i.scale=i.rotate=i.translate="none"),x=Ja(e,s.svg),s.svg&&(s.uncache?(q=e.getBBox(),l=s.xOrigin-q.x+"px "+(s.yOrigin-q.y)+"px",I=""):I=!t&&e.getAttribute("data-svg-origin"),ya(e,I||l,!!I||s.originIsAbsolute,s.smooth!==!1,x)),g=s.xOrigin||0,T=s.yOrigin||0,x!==Pi&&(O=x[0],A=x[1],k=x[2],R=x[3],u=P=x[4],h=F=x[5],x.length===6?(f=Math.sqrt(O*O+A*A),m=Math.sqrt(R*R+k*k),p=O||A?En(A,O)*Js:0,S=k||R?En(k,R)*Js+p:0,S&&(m*=Math.abs(Math.cos(S*Fn))),s.svg&&(u-=g-(g*O+T*k),h-=T-(g*A+T*R))):(W=x[6],se=x[7],V=x[8],H=x[9],L=x[10],ne=x[11],u=x[12],h=x[13],d=x[14],w=En(W,L),_=w*Js,w&&(C=Math.cos(-w),E=Math.sin(-w),I=P*C+V*E,q=F*C+H*E,B=W*C+L*E,V=P*-E+V*C,H=F*-E+H*C,L=W*-E+L*C,ne=se*-E+ne*C,P=I,F=q,W=B),w=En(-k,L),y=w*Js,w&&(C=Math.cos(-w),E=Math.sin(-w),I=O*C-V*E,q=A*C-H*E,B=k*C-L*E,ne=R*E+ne*C,O=I,A=q,k=B),w=En(A,O),p=w*Js,w&&(C=Math.cos(w),E=Math.sin(w),I=O*C+A*E,q=P*C+F*E,A=A*C-O*E,F=F*C-P*E,O=I,P=q),_&&Math.abs(_)+Math.abs(p)>359.9&&(_=p=0,y=180-y),f=Ne(Math.sqrt(O*O+A*A+k*k)),m=Ne(Math.sqrt(F*F+W*W)),w=En(P,F),S=Math.abs(w)>2e-4?w*Js:0,v=ne?1/(ne<0?-ne:ne):0),s.svg&&(I=e.getAttribute("transform"),s.forceCSS=e.setAttribute("transform","")||!Yu($t(e,Ae)),I&&e.setAttribute("transform",I))),Math.abs(S)>90&&Math.abs(S)<270&&(r?(f*=-1,S+=p<=0?180:-180,p+=p<=0?180:-180):(m*=-1,S+=S<=0?180:-180)),t=t||s.uncache,s.x=u-((s.xPercent=u&&(!t&&s.xPercent||(Math.round(e.offsetWidth/2)===Math.round(-u)?-50:0)))?e.offsetWidth*s.xPercent/100:0)+o,s.y=h-((s.yPercent=h&&(!t&&s.yPercent||(Math.round(e.offsetHeight/2)===Math.round(-h)?-50:0)))?e.offsetHeight*s.yPercent/100:0)+o,s.z=d+o,s.scaleX=Ne(f),s.scaleY=Ne(m),s.rotation=Ne(p)+a,s.rotationX=Ne(_)+a,s.rotationY=Ne(y)+a,s.skewX=S+a,s.skewY=b+a,s.transformPerspective=v+o,(s.zOrigin=parseFloat(l.split(" ")[2])||!t&&s.zOrigin||0)&&(i[ht]=zr(l)),s.xOffset=s.yOffset=0,s.force3D=vt.force3D,s.renderTransform=s.svg?Vm:qu?Zu:zm,s.uncache=0,s},zr=function(e){return(e=e.split(" "))[0]+" "+e[1]},Ko=function(e,t,s){var i=Ze(t);return Ne(parseFloat(t)+parseFloat(Us(e,"x",s+"px",i)))+i},zm=function(e,t){t.z="0px",t.rotationY=t.rotationX="0deg",t.force3D=0,Zu(e,t)},Qs="0deg",yi="0px",Ks=") ",Zu=function(e,t){var s=t||this,i=s.xPercent,r=s.yPercent,o=s.x,a=s.y,c=s.z,l=s.rotation,u=s.rotationY,h=s.rotationX,d=s.skewX,f=s.skewY,m=s.scaleX,p=s.scaleY,_=s.transformPerspective,y=s.force3D,S=s.target,b=s.zOrigin,v="",g=y==="auto"&&e&&e!==1||y===!0;if(b&&(h!==Qs||u!==Qs)){var T=parseFloat(u)*Fn,x=Math.sin(T),w=Math.cos(T),C;T=parseFloat(h)*Fn,C=Math.cos(T),o=Ko(S,o,x*C*-b),a=Ko(S,a,-Math.sin(T)*-b),c=Ko(S,c,w*C*-b+b)}_!==yi&&(v+="perspective("+_+Ks),(i||r)&&(v+="translate("+i+"%, "+r+"%) "),(g||o!==yi||a!==yi||c!==yi)&&(v+=c!==yi||g?"translate3d("+o+", "+a+", "+c+") ":"translate("+o+", "+a+Ks),l!==Qs&&(v+="rotate("+l+Ks),u!==Qs&&(v+="rotateY("+u+Ks),h!==Qs&&(v+="rotateX("+h+Ks),(d!==Qs||f!==Qs)&&(v+="skew("+d+", "+f+Ks),(m!==1||p!==1)&&(v+="scale("+m+", "+p+Ks),S.style[Ae]=v||"translate(0, 0)"},Vm=function(e,t){var s=t||this,i=s.xPercent,r=s.yPercent,o=s.x,a=s.y,c=s.rotation,l=s.skewX,u=s.skewY,h=s.scaleX,d=s.scaleY,f=s.target,m=s.xOrigin,p=s.yOrigin,_=s.xOffset,y=s.yOffset,S=s.forceCSS,b=parseFloat(o),v=parseFloat(a),g,T,x,w,C;c=parseFloat(c),l=parseFloat(l),u=parseFloat(u),u&&(u=parseFloat(u),l+=u,c+=u),c||l?(c*=Fn,l*=Fn,g=Math.cos(c)*h,T=Math.sin(c)*h,x=Math.sin(c-l)*-d,w=Math.cos(c-l)*d,l&&(u*=Fn,C=Math.tan(l-u),C=Math.sqrt(1+C*C),x*=C,w*=C,u&&(C=Math.tan(u),C=Math.sqrt(1+C*C),g*=C,T*=C)),g=Ne(g),T=Ne(T),x=Ne(x),w=Ne(w)):(g=h,w=d,T=x=0),(b&&!~(o+"").indexOf("px")||v&&!~(a+"").indexOf("px"))&&(b=Us(f,"x",o,"px"),v=Us(f,"y",a,"px")),(m||p||_||y)&&(b=Ne(b+m-(m*g+p*x)+_),v=Ne(v+p-(m*T+p*w)+y)),(i||r)&&(C=f.getBBox(),b=Ne(b+i/100*C.width),v=Ne(v+r/100*C.height)),C="matrix("+g+","+T+","+x+","+w+","+b+","+v+")",f.setAttribute("transform",C),S&&(f.style[Ae]=C)},Hm=function(e,t,s,i,r){var o=360,a=je(r),c=parseFloat(r)*(a&&~r.indexOf("rad")?Js:1),l=c-i,u=i+l+"deg",h,d;return a&&(h=r.split("_")[1],h==="short"&&(l%=o,l!==l%(o/2)&&(l+=l<0?o:-o)),h==="cw"&&l<0?l=(l+o*nl)%o-~~(l/o)*o:h==="ccw"&&l>0&&(l=(l-o*nl)%o-~~(l/o)*o)),e._pt=d=new ut(e._pt,t,s,i,l,Cm),d.e=u,d.u="deg",e._props.push(s),d},ll=function(e,t){for(var s in t)e[s]=t[s];return e},qm=function(e,t,s){var i=ll({},s._gsap),r="perspective,force3D,transformOrigin,svgOrigin",o=s.style,a,c,l,u,h,d,f,m;i.svg?(l=s.getAttribute("transform"),s.setAttribute("transform",""),o[Ae]=t,a=Ni(s,1),hn(s,Ae),s.setAttribute("transform",l)):(l=getComputedStyle(s)[Ae],o[Ae]=t,a=Ni(s,1),o[Ae]=l);for(c in ms)l=i[c],u=a[c],l!==u&&r.indexOf(c)<0&&(f=Ze(l),m=Ze(u),h=f!==m?Us(s,c,l,m):parseFloat(l),d=parseFloat(u),e._pt=new ut(e._pt,a,c,h,d-h,_a),e._pt.u=m||0,e._props.push(c));ll(a,i)};lt("padding,margin,Width,Radius",function(n,e){var t="Top",s="Right",i="Bottom",r="Left",o=(e<3?[t,s,i,r]:[t+r,t+s,i+s,i+r]).map(function(a){return e<2?n+a:"border"+a+n});Br[e>1?"border"+n:n]=function(a,c,l,u,h){var d,f;if(arguments.length<4)return d=o.map(function(m){return ls(a,m,l)}),f=d.join(" "),f.split(d[0]).length===5?d[0]:f;d=(u+"").split(" "),f={},o.forEach(function(m,p){return f[m]=d[p]=d[p]||d[(p-1)/2|0]}),a.init(c,f,h)}});var Xu={name:"css",register:va,targetTest:function(e){return e.style&&e.nodeType},init:function(e,t,s,i,r){var o=this._props,a=e.style,c=s.vars.startAt,l,u,h,d,f,m,p,_,y,S,b,v,g,T,x,w;$a||va(),this.styles=this.styles||Hu(e),w=this.styles.props,this.tween=s;for(p in t)if(p!=="autoRound"&&(u=t[p],!(mt[p]&&ku(p,t,s,i,e,r)))){if(f=typeof u,m=Br[p],f==="function"&&(u=u.call(s,i,e,r),f=typeof u),f==="string"&&~u.indexOf("random(")&&(u=Di(u)),m)m(this,e,p,u,s)&&(x=1);else if(p.substr(0,2)==="--")l=(getComputedStyle(e).getPropertyValue(p)+"").trim(),u+="",Ns.lastIndex=0,Ns.test(l)||(_=Ze(l),y=Ze(u)),y?_!==y&&(l=Us(e,p,l,y)+y):_&&(u+=_),this.add(a,"setProperty",l,u,i,r,0,0,p),o.push(p),w.push(p,0,a[p]);else if(f!=="undefined"){if(c&&p in c?(l=typeof c[p]=="function"?c[p].call(s,i,e,r):c[p],je(l)&&~l.indexOf("random(")&&(l=Di(l)),Ze(l+"")||l==="auto"||(l+=vt.units[p]||Ze(ls(e,p))||""),(l+"").charAt(1)==="="&&(l=ls(e,p))):l=ls(e,p),d=parseFloat(l),S=f==="string"&&u.charAt(1)==="="&&u.substr(0,2),S&&(u=u.substr(2)),h=parseFloat(u),p in Xt&&(p==="autoAlpha"&&(d===1&&ls(e,"visibility")==="hidden"&&h&&(d=0),w.push("visibility",0,a.visibility),ks(this,a,"visibility",d?"inherit":"hidden",h?"inherit":"hidden",!h)),p!=="scale"&&p!=="transform"&&(p=Xt[p],~p.indexOf(",")&&(p=p.split(",")[0]))),b=p in ms,b){if(this.styles.save(p),v||(g=e._gsap,g.renderTransform&&!t.parseTransform||Ni(e,t.parseTransform),T=t.smoothOrigin!==!1&&g.smooth,v=this._pt=new ut(this._pt,a,Ae,0,1,g.renderTransform,g,0,-1),v.dep=1),p==="scale")this._pt=new ut(this._pt,g,"scaleY",g.scaleY,(S?Nn(g.scaleY,S+h):h)-g.scaleY||0,_a),this._pt.u=0,o.push("scaleY",p),p+="X";else if(p==="transformOrigin"){w.push(ht,0,a[ht]),u=Lm(u),g.svg?ya(e,u,0,T,0,this):(y=parseFloat(u.split(" ")[2])||0,y!==g.zOrigin&&ks(this,g,"zOrigin",g.zOrigin,y),ks(this,a,p,zr(l),zr(u)));continue}else if(p==="svgOrigin"){ya(e,u,1,T,0,this);continue}else if(p in ju){Hm(this,g,p,d,S?Nn(d,S+u):u);continue}else if(p==="smoothOrigin"){ks(this,g,"smooth",g.smooth,u);continue}else if(p==="force3D"){g[p]=u;continue}else if(p==="transform"){qm(this,u,e);continue}}else p in a||(p=Gn(p)||p);if(b||(h||h===0)&&(d||d===0)&&!bm.test(u)&&p in a)_=(l+"").substr((d+"").length),h||(h=0),y=Ze(u)||(p in vt.units?vt.units[p]:_),_!==y&&(d=Us(e,p,l,y)),this._pt=new ut(this._pt,b?g:a,p,d,(S?Nn(d,S+h):h)-d,!b&&(y==="px"||p==="zIndex")&&t.autoRound!==!1?Om:_a),this._pt.u=y||0,_!==y&&y!=="%"&&(this._pt.b=l,this._pt.r=Em);else if(p in a)Um.call(this,e,p,l,S?S+u:u);else if(p in e)this.add(e,p,l||e[p],S?S+u:u,i,r);else if(p!=="parseTransform"){Va(p,u);continue}b||(p in a?w.push(p,0,a[p]):w.push(p,1,l||e[p])),o.push(p)}}x&&Uu(this)},render:function(e,t){if(t.tween._time||!Qa())for(var s=t._pt;s;)s.r(e,s.d),s=s._next;else t.styles.revert()},get:ls,aliases:Xt,getSetter:function(e,t,s){var i=Xt[t];return i&&i.indexOf(",")<0&&(t=i),t in ms&&t!==ht&&(e._gsap.x||ls(e,"x"))?s&&sl===s?t==="scale"?km:Dm:(sl=s||{})&&(t==="scale"?Rm:Pm):e.style&&!La(e.style[t])?Am:~t.indexOf("-")?Mm:Za(e,t)},core:{_removeProperty:hn,_getMatrix:Ja}};ft.utils.checkPrefix=Gn;ft.core.getStyleSaver=Hu;(function(n,e,t,s){var i=lt(n+","+e+","+t,function(r){ms[r]=1});lt(e,function(r){vt.units[r]="deg",ju[r]=1}),Xt[i[13]]=n+","+e,lt(s,function(r){var o=r.split(":");Xt[o[1]]=i[o[0]]})})("x,y,z,scale,scaleX,scaleY,xPercent,yPercent","rotation,rotationX,rotationY,skewX,skewY","transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective","0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY");lt("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function(n){vt.units[n]="px"});ft.registerPlugin(Xu);var Wm=ft.registerPlugin(Xu)||ft;Wm.core.Tween;const $u="14.8.49",ul=(n,e,t)=>({endTime:e,insertTime:t,type:"exponentialRampToValue",value:n}),hl=(n,e,t)=>({endTime:e,insertTime:t,type:"linearRampToValue",value:n}),Ta=(n,e)=>({startTime:e,type:"setValue",value:n}),Qu=(n,e,t)=>({duration:t,startTime:e,type:"setValueCurve",values:n}),Ku=(n,e,{startTime:t,target:s,timeConstant:i})=>s+(e-s)*Math.exp((t-n)/i),kn=n=>n.type==="exponentialRampToValue",Vr=n=>n.type==="linearRampToValue",Os=n=>kn(n)||Vr(n),ec=n=>n.type==="setValue",cs=n=>n.type==="setValueCurve",Hr=(n,e,t,s)=>{const i=n[e];return i===void 0?s:Os(i)||ec(i)?i.value:cs(i)?i.values[i.values.length-1]:Ku(t,Hr(n,e-1,i.startTime,s),i)},dl=(n,e,t,s,i)=>t===void 0?[s.insertTime,i]:Os(t)?[t.endTime,t.value]:ec(t)?[t.startTime,t.value]:cs(t)?[t.startTime+t.duration,t.values[t.values.length-1]]:[t.startTime,Hr(n,e-1,t.startTime,i)],xa=n=>n.type==="cancelAndHold",wa=n=>n.type==="cancelScheduledValues",Cs=n=>xa(n)||wa(n)?n.cancelTime:kn(n)||Vr(n)?n.endTime:n.startTime,fl=(n,e,t,{endTime:s,value:i})=>t===i?i:0<t&&0<i||t<0&&i<0?t*(i/t)**((n-e)/(s-e)):0,pl=(n,e,t,{endTime:s,value:i})=>t+(n-e)/(s-e)*(i-t),Gm=(n,e)=>{const t=Math.floor(e),s=Math.ceil(e);return t===s?n[t]:(1-(e-t))*n[t]+(1-(s-e))*n[s]},jm=(n,{duration:e,startTime:t,values:s})=>{const i=(n-t)/e*(s.length-1);return Gm(s,i)},br=n=>n.type==="setTarget";class Ym{constructor(e){this._automationEvents=[],this._currenTime=0,this._defaultValue=e}[Symbol.iterator](){return this._automationEvents[Symbol.iterator]()}add(e){const t=Cs(e);if(xa(e)||wa(e)){const s=this._automationEvents.findIndex(r=>wa(e)&&cs(r)?r.startTime+r.duration>=t:Cs(r)>=t),i=this._automationEvents[s];if(s!==-1&&(this._automationEvents=this._automationEvents.slice(0,s)),xa(e)){const r=this._automationEvents[this._automationEvents.length-1];if(i!==void 0&&Os(i)){if(r!==void 0&&br(r))throw new Error("The internal list is malformed.");const o=r===void 0?i.insertTime:cs(r)?r.startTime+r.duration:Cs(r),a=r===void 0?this._defaultValue:cs(r)?r.values[r.values.length-1]:r.value,c=kn(i)?fl(t,o,a,i):pl(t,o,a,i),l=kn(i)?ul(c,t,this._currenTime):hl(c,t,this._currenTime);this._automationEvents.push(l)}if(r!==void 0&&br(r)&&this._automationEvents.push(Ta(this.getValue(t),t)),r!==void 0&&cs(r)&&r.startTime+r.duration>t){const o=t-r.startTime,a=(r.values.length-1)/r.duration,c=Math.max(2,1+Math.ceil(o*a)),l=o/(c-1)*a,u=r.values.slice(0,c);if(l<1)for(let h=1;h<c;h+=1){const d=l*h%1;u[h]=r.values[h-1]*(1-d)+r.values[h]*d}this._automationEvents[this._automationEvents.length-1]=Qu(u,r.startTime,o)}}}else{const s=this._automationEvents.findIndex(o=>Cs(o)>t),i=s===-1?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[s-1];if(i!==void 0&&cs(i)&&Cs(i)+i.duration>t)return!1;const r=kn(e)?ul(e.value,e.endTime,this._currenTime):Vr(e)?hl(e.value,t,this._currenTime):e;if(s===-1)this._automationEvents.push(r);else{if(cs(e)&&t+e.duration>Cs(this._automationEvents[s]))return!1;this._automationEvents.splice(s,0,r)}}return!0}flush(e){const t=this._automationEvents.findIndex(s=>Cs(s)>e);if(t>1){const s=this._automationEvents.slice(t-1),i=s[0];br(i)&&s.unshift(Ta(Hr(this._automationEvents,t-2,i.startTime,this._defaultValue),i.startTime)),this._automationEvents=s}}getValue(e){if(this._automationEvents.length===0)return this._defaultValue;const t=this._automationEvents.findIndex(o=>Cs(o)>e),s=this._automationEvents[t],i=(t===-1?this._automationEvents.length:t)-1,r=this._automationEvents[i];if(r!==void 0&&br(r)&&(s===void 0||!Os(s)||s.insertTime>e))return Ku(e,Hr(this._automationEvents,i-1,r.startTime,this._defaultValue),r);if(r!==void 0&&ec(r)&&(s===void 0||!Os(s)))return r.value;if(r!==void 0&&cs(r)&&(s===void 0||!Os(s)||r.startTime+r.duration>e))return e<r.startTime+r.duration?jm(e,r):r.values[r.values.length-1];if(r!==void 0&&Os(r)&&(s===void 0||!Os(s)))return r.value;if(s!==void 0&&kn(s)){const[o,a]=dl(this._automationEvents,i,r,s,this._defaultValue);return fl(e,o,a,s)}if(s!==void 0&&Vr(s)){const[o,a]=dl(this._automationEvents,i,r,s,this._defaultValue);return pl(e,o,a,s)}return this._defaultValue}}const Zm=n=>({cancelTime:n,type:"cancelAndHold"}),Xm=n=>({cancelTime:n,type:"cancelScheduledValues"}),$m=(n,e)=>({endTime:e,type:"exponentialRampToValue",value:n}),Qm=(n,e)=>({endTime:e,type:"linearRampToValue",value:n}),Km=(n,e,t)=>({startTime:e,target:n,timeConstant:t,type:"setTarget"}),Jm=()=>new DOMException("","AbortError"),e_=n=>(e,t,[s,i,r],o)=>{n(e[i],[t,s,r],a=>a[0]===t&&a[1]===s,o)},t_=n=>(e,t,s)=>{const i=[];for(let r=0;r<s.numberOfInputs;r+=1)i.push(new Set);n.set(e,{activeInputs:i,outputs:new Set,passiveInputs:new WeakMap,renderer:t})},s_=n=>(e,t)=>{n.set(e,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:t})},jn=new WeakSet,Ju=new WeakMap,tc=new WeakMap,eh=new WeakMap,sc=new WeakMap,vo=new WeakMap,th=new WeakMap,Sa=new WeakMap,ba=new WeakMap,Ca=new WeakMap,sh={construct(){return sh}},n_=n=>{try{const e=new Proxy(n,sh);new e}catch{return!1}return!0},ml=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,_l=(n,e)=>{const t=[];let s=n.replace(/^[\s]+/,""),i=s.match(ml);for(;i!==null;){const r=i[1].slice(1,-1),o=i[0].replace(/([\s]+)?;?$/,"").replace(r,new URL(r,e).toString());t.push(o),s=s.slice(i[0].length).replace(/^[\s]+/,""),i=s.match(ml)}return[t.join(";"),s]},gl=n=>{if(n!==void 0&&!Array.isArray(n))throw new TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},vl=n=>{if(!n_(n))throw new TypeError("The given value for processorCtor should be a constructor.");if(n.prototype===null||typeof n.prototype!="object")throw new TypeError("The given value for processorCtor should have a prototype.")},i_=(n,e,t,s,i,r,o,a,c,l,u,h,d)=>{let f=0;return(m,p,_={credentials:"omit"})=>{const y=u.get(m);if(y!==void 0&&y.has(p))return Promise.resolve();const S=l.get(m);if(S!==void 0){const g=S.get(p);if(g!==void 0)return g}const b=r(m),v=b.audioWorklet===void 0?i(p).then(([g,T])=>{const[x,w]=_l(g,T),C=`${x};((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{${w}
})})(window,'_AWGS')`;return t(C)}).then(()=>{const g=d._AWGS.pop();if(g===void 0)throw new SyntaxError;s(b.currentTime,b.sampleRate,()=>g(class{},void 0,(T,x)=>{if(T.trim()==="")throw e();const w=ba.get(b);if(w!==void 0){if(w.has(T))throw e();vl(x),gl(x.parameterDescriptors),w.set(T,x)}else vl(x),gl(x.parameterDescriptors),ba.set(b,new Map([[T,x]]))},b.sampleRate,void 0,void 0))}):Promise.all([i(p),Promise.resolve(n(h,h))]).then(([[g,T],x])=>{const w=f+1;f=w;const[C,E]=_l(g,T),R=`${C};((AudioWorkletProcessor,registerProcessor)=>{${E}
})(${x?"AudioWorkletProcessor":"class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}"},(n,p)=>registerProcessor(n,class extends p{${x?"":"__c = (a) => a.forEach(e=>this.__b.add(e.buffer));"}process(i,o,p){${x?"":"i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));"}return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}));registerProcessor('__sac${w}',class extends AudioWorkletProcessor{process(){return !1}})`,P=new Blob([R],{type:"application/javascript; charset=utf-8"}),F=URL.createObjectURL(P);return b.audioWorklet.addModule(F,_).then(()=>{if(a(b))return b;const I=o(b);return I.audioWorklet.addModule(F,_).then(()=>I)}).then(I=>{if(c===null)throw new SyntaxError;try{new c(I,`__sac${w}`)}catch{throw new SyntaxError}}).finally(()=>URL.revokeObjectURL(F))});return S===void 0?l.set(m,new Map([[p,v]])):S.set(p,v),v.then(()=>{const g=u.get(m);g===void 0?u.set(m,new Set([p])):g.add(p)}).finally(()=>{const g=l.get(m);g!==void 0&&g.delete(p)}),v}},Lt=(n,e)=>{const t=n.get(e);if(t===void 0)throw new Error("A value with the given key could not be found.");return t},yo=(n,e)=>{const t=Array.from(n).filter(e);if(t.length>1)throw Error("More than one element was found.");if(t.length===0)throw Error("No element was found.");const[s]=t;return n.delete(s),s},nh=(n,e,t,s)=>{const i=Lt(n,e),r=yo(i,o=>o[0]===t&&o[1]===s);return i.size===0&&n.delete(e),r},nr=n=>Lt(th,n),Yn=n=>{if(jn.has(n))throw new Error("The AudioNode is already stored.");jn.add(n),nr(n).forEach(e=>e(!0))},ih=n=>"port"in n,ir=n=>{if(!jn.has(n))throw new Error("The AudioNode is not stored.");jn.delete(n),nr(n).forEach(e=>e(!1))},Ea=(n,e)=>{!ih(n)&&e.every(t=>t.size===0)&&ir(n)},r_=(n,e,t,s,i,r,o,a,c,l,u,h,d)=>{const f=new WeakMap;return(m,p,_,y,S)=>{const{activeInputs:b,passiveInputs:v}=r(p),{outputs:g}=r(m),T=a(m),x=w=>{const C=c(p),E=c(m);if(w){const O=nh(v,m,_,y);n(b,m,O,!1),!S&&!h(m)&&t(E,C,_,y),d(p)&&Yn(p)}else{const O=s(b,m,_,y);e(v,y,O,!1),!S&&!h(m)&&i(E,C,_,y);const A=o(p);if(A===0)u(p)&&Ea(p,b);else{const k=f.get(p);k!==void 0&&clearTimeout(k),f.set(p,setTimeout(()=>{u(p)&&Ea(p,b)},A*1e3))}}};return l(g,[p,_,y],w=>w[0]===p&&w[1]===_&&w[2]===y,!0)?(T.add(x),u(m)?n(b,m,[_,y,x],!0):e(v,y,[m,_,x],!0),!0):!1}},o_=n=>(e,t,[s,i,r],o)=>{const a=e.get(s);a===void 0?e.set(s,new Set([[i,t,r]])):n(a,[i,t,r],c=>c[0]===i&&c[1]===t,o)},a_=n=>(e,t)=>{const s=n(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});t.connect(s).connect(e.destination);const i=()=>{t.removeEventListener("ended",i),t.disconnect(s),s.disconnect()};t.addEventListener("ended",i)},c_=n=>(e,t)=>{n(e).add(t)},l_={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",fftSize:2048,maxDecibels:-30,minDecibels:-100,smoothingTimeConstant:.8},u_=(n,e,t,s,i,r)=>class extends n{constructor(a,c){const l=i(a),u={...l_,...c},h=s(l,u),d=r(l)?e():null;super(a,!1,h,d),this._nativeAnalyserNode=h}get fftSize(){return this._nativeAnalyserNode.fftSize}set fftSize(a){this._nativeAnalyserNode.fftSize=a}get frequencyBinCount(){return this._nativeAnalyserNode.frequencyBinCount}get maxDecibels(){return this._nativeAnalyserNode.maxDecibels}set maxDecibels(a){const c=this._nativeAnalyserNode.maxDecibels;if(this._nativeAnalyserNode.maxDecibels=a,!(a>this._nativeAnalyserNode.minDecibels))throw this._nativeAnalyserNode.maxDecibels=c,t()}get minDecibels(){return this._nativeAnalyserNode.minDecibels}set minDecibels(a){const c=this._nativeAnalyserNode.minDecibels;if(this._nativeAnalyserNode.minDecibels=a,!(this._nativeAnalyserNode.maxDecibels>a))throw this._nativeAnalyserNode.minDecibels=c,t()}get smoothingTimeConstant(){return this._nativeAnalyserNode.smoothingTimeConstant}set smoothingTimeConstant(a){this._nativeAnalyserNode.smoothingTimeConstant=a}getByteFrequencyData(a){this._nativeAnalyserNode.getByteFrequencyData(a)}getByteTimeDomainData(a){this._nativeAnalyserNode.getByteTimeDomainData(a)}getFloatFrequencyData(a){this._nativeAnalyserNode.getFloatFrequencyData(a)}getFloatTimeDomainData(a){this._nativeAnalyserNode.getFloatTimeDomainData(a)}},Ke=(n,e)=>n.context===e,h_=(n,e,t)=>()=>{const s=new WeakMap,i=async(r,o)=>{let a=e(r);if(!Ke(a,o)){const l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,fftSize:a.fftSize,maxDecibels:a.maxDecibels,minDecibels:a.minDecibels,smoothingTimeConstant:a.smoothingTimeConstant};a=n(o,l)}return s.set(o,a),await t(r,o,a),a};return{render(r,o){const a=s.get(o);return a!==void 0?Promise.resolve(a):i(r,o)}}},qr=n=>{try{n.copyToChannel(new Float32Array(1),0,-1)}catch{return!1}return!0},es=()=>new DOMException("","IndexSizeError"),nc=n=>{n.getChannelData=(e=>t=>{try{return e.call(n,t)}catch(s){throw s.code===12?es():s}})(n.getChannelData)},d_={numberOfChannels:1},f_=(n,e,t,s,i,r,o,a)=>{let c=null;return class rh{constructor(u){if(i===null)throw new Error("Missing the native OfflineAudioContext constructor.");const{length:h,numberOfChannels:d,sampleRate:f}={...d_,...u};c===null&&(c=new i(1,1,44100));const m=s!==null&&e(r,r)?new s({length:h,numberOfChannels:d,sampleRate:f}):c.createBuffer(d,h,f);if(m.numberOfChannels===0)throw t();return typeof m.copyFromChannel!="function"?(o(m),nc(m)):e(qr,()=>qr(m))||a(m),n.add(m),m}static[Symbol.hasInstance](u){return u!==null&&typeof u=="object"&&Object.getPrototypeOf(u)===rh.prototype||n.has(u)}}},at=-34028234663852886e22,Je=-at,ds=n=>jn.has(n),p_={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},m_=(n,e,t,s,i,r,o,a)=>class extends n{constructor(l,u){const h=r(l),d={...p_,...u},f=i(h,d),m=o(h),p=m?e():null;super(l,!1,f,p),this._audioBufferSourceNodeRenderer=p,this._isBufferNullified=!1,this._isBufferSet=d.buffer!==null,this._nativeAudioBufferSourceNode=f,this._onended=null,this._playbackRate=t(this,m,f.playbackRate,Je,at)}get buffer(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer}set buffer(l){if(this._nativeAudioBufferSourceNode.buffer=l,l!==null){if(this._isBufferSet)throw s();this._isBufferSet=!0}}get loop(){return this._nativeAudioBufferSourceNode.loop}set loop(l){this._nativeAudioBufferSourceNode.loop=l}get loopEnd(){return this._nativeAudioBufferSourceNode.loopEnd}set loopEnd(l){this._nativeAudioBufferSourceNode.loopEnd=l}get loopStart(){return this._nativeAudioBufferSourceNode.loopStart}set loopStart(l){this._nativeAudioBufferSourceNode.loopStart=l}get onended(){return this._onended}set onended(l){const u=typeof l=="function"?a(this,l):null;this._nativeAudioBufferSourceNode.onended=u;const h=this._nativeAudioBufferSourceNode.onended;this._onended=h!==null&&h===u?l:h}get playbackRate(){return this._playbackRate}start(l=0,u=0,h){if(this._nativeAudioBufferSourceNode.start(l,u,h),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.start=h===void 0?[l,u]:[l,u,h]),this.context.state!=="closed"){Yn(this);const d=()=>{this._nativeAudioBufferSourceNode.removeEventListener("ended",d),ds(this)&&ir(this)};this._nativeAudioBufferSourceNode.addEventListener("ended",d)}}stop(l=0){this._nativeAudioBufferSourceNode.stop(l),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.stop=l)}},__=(n,e,t,s,i)=>()=>{const r=new WeakMap;let o=null,a=null;const c=async(l,u)=>{let h=t(l);const d=Ke(h,u);if(!d){const f={buffer:h.buffer,channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,loop:h.loop,loopEnd:h.loopEnd,loopStart:h.loopStart,playbackRate:h.playbackRate.value};h=e(u,f),o!==null&&h.start(...o),a!==null&&h.stop(a)}return r.set(u,h),d?await n(u,l.playbackRate,h.playbackRate):await s(u,l.playbackRate,h.playbackRate),await i(l,u,h),h};return{set start(l){o=l},set stop(l){a=l},render(l,u){const h=r.get(u);return h!==void 0?Promise.resolve(h):c(l,u)}}},g_=n=>"playbackRate"in n,v_=n=>"frequency"in n&&"gain"in n,y_=n=>"offset"in n,T_=n=>!("frequency"in n)&&"gain"in n,x_=n=>"detune"in n&&"frequency"in n,w_=n=>"pan"in n,tt=n=>Lt(Ju,n),rr=n=>Lt(eh,n),Oa=(n,e)=>{const{activeInputs:t}=tt(n);t.forEach(i=>i.forEach(([r])=>{e.includes(n)||Oa(r,[...e,n])}));const s=g_(n)?[n.playbackRate]:ih(n)?Array.from(n.parameters.values()):v_(n)?[n.Q,n.detune,n.frequency,n.gain]:y_(n)?[n.offset]:T_(n)?[n.gain]:x_(n)?[n.detune,n.frequency]:w_(n)?[n.pan]:[];for(const i of s){const r=rr(i);r!==void 0&&r.activeInputs.forEach(([o])=>Oa(o,e))}ds(n)&&ir(n)},oh=n=>{Oa(n.destination,[])},S_=n=>n===void 0||typeof n=="number"||typeof n=="string"&&(n==="balanced"||n==="interactive"||n==="playback"),b_=(n,e,t,s,i,r,o,a,c)=>class extends n{constructor(u={}){if(c===null)throw new Error("Missing the native AudioContext constructor.");let h;try{h=new c(u)}catch(m){throw m.code===12&&m.message==="sampleRate is not in range"?t():m}if(h===null)throw s();if(!S_(u.latencyHint))throw new TypeError(`The provided value '${u.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(u.sampleRate!==void 0&&h.sampleRate!==u.sampleRate)throw t();super(h,2);const{latencyHint:d}=u,{sampleRate:f}=h;if(this._baseLatency=typeof h.baseLatency=="number"?h.baseLatency:d==="balanced"?512/f:d==="interactive"||d===void 0?256/f:d==="playback"?1024/f:Math.max(2,Math.min(128,Math.round(d*f/128)))*128/f,this._nativeAudioContext=h,c.name==="webkitAudioContext"?(this._nativeGainNode=h.createGain(),this._nativeOscillatorNode=h.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(h.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,h.state==="running"){this._state="suspended";const m=()=>{this._state==="suspended"&&(this._state=null),h.removeEventListener("statechange",m)};h.addEventListener("statechange",m)}}get baseLatency(){return this._baseLatency}get state(){return this._state!==null?this._state:this._nativeAudioContext.state}close(){return this.state==="closed"?this._nativeAudioContext.close().then(()=>{throw e()}):(this._state==="suspended"&&(this._state=null),this._nativeAudioContext.close().then(()=>{this._nativeGainNode!==null&&this._nativeOscillatorNode!==null&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),oh(this)}))}createMediaElementSource(u){return new i(this,{mediaElement:u})}createMediaStreamDestination(){return new r(this)}createMediaStreamSource(u){return new o(this,{mediaStream:u})}createMediaStreamTrackSource(u){return new a(this,{mediaStreamTrack:u})}resume(){return this._state==="suspended"?new Promise((u,h)=>{const d=()=>{this._nativeAudioContext.removeEventListener("statechange",d),this._nativeAudioContext.state==="running"?u():this.resume().then(u,h)};this._nativeAudioContext.addEventListener("statechange",d)}):this._nativeAudioContext.resume().catch(u=>{throw u===void 0||u.code===15?e():u})}suspend(){return this._nativeAudioContext.suspend().catch(u=>{throw u===void 0?e():u})}},C_=(n,e,t,s,i,r,o,a)=>class extends n{constructor(l,u){const h=r(l),d=o(h),f=i(h,u,d),m=d?e(a):null;super(l,!1,f,m),this._isNodeOfNativeOfflineAudioContext=d,this._nativeAudioDestinationNode=f}get channelCount(){return this._nativeAudioDestinationNode.channelCount}set channelCount(l){if(this._isNodeOfNativeOfflineAudioContext)throw s();if(l>this._nativeAudioDestinationNode.maxChannelCount)throw t();this._nativeAudioDestinationNode.channelCount=l}get channelCountMode(){return this._nativeAudioDestinationNode.channelCountMode}set channelCountMode(l){if(this._isNodeOfNativeOfflineAudioContext)throw s();this._nativeAudioDestinationNode.channelCountMode=l}get maxChannelCount(){return this._nativeAudioDestinationNode.maxChannelCount}},E_=n=>{const e=new WeakMap,t=async(s,i)=>{const r=i.destination;return e.set(i,r),await n(s,i,r),r};return{render(s,i){const r=e.get(i);return r!==void 0?Promise.resolve(r):t(s,i)}}},O_=(n,e,t,s,i,r,o,a)=>(c,l)=>{const u=l.listener,h=()=>{const g=new Float32Array(1),T=e(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),x=o(l);let w=!1,C=[0,0,-1,0,1,0],E=[0,0,0];const O=()=>{if(w)return;w=!0;const P=s(l,256,9,0);P.onaudioprocess=({inputBuffer:F})=>{const I=[r(F,g,0),r(F,g,1),r(F,g,2),r(F,g,3),r(F,g,4),r(F,g,5)];I.some((B,V)=>B!==C[V])&&(u.setOrientation(...I),C=I);const q=[r(F,g,6),r(F,g,7),r(F,g,8)];q.some((B,V)=>B!==E[V])&&(u.setPosition(...q),E=q)},T.connect(P)},A=P=>F=>{F!==C[P]&&(C[P]=F,u.setOrientation(...C))},k=P=>F=>{F!==E[P]&&(E[P]=F,u.setPosition(...E))},R=(P,F,I)=>{const q=t(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:F});q.connect(T,0,P),q.start(),Object.defineProperty(q.offset,"defaultValue",{get(){return F}});const B=n({context:c},x,q.offset,Je,at);return a(B,"value",V=>()=>V.call(B),V=>H=>{try{V.call(B,H)}catch(L){if(L.code!==9)throw L}O(),x&&I(H)}),B.cancelAndHoldAtTime=(V=>x?()=>{throw i()}:(...H)=>{const L=V.apply(B,H);return O(),L})(B.cancelAndHoldAtTime),B.cancelScheduledValues=(V=>x?()=>{throw i()}:(...H)=>{const L=V.apply(B,H);return O(),L})(B.cancelScheduledValues),B.exponentialRampToValueAtTime=(V=>x?()=>{throw i()}:(...H)=>{const L=V.apply(B,H);return O(),L})(B.exponentialRampToValueAtTime),B.linearRampToValueAtTime=(V=>x?()=>{throw i()}:(...H)=>{const L=V.apply(B,H);return O(),L})(B.linearRampToValueAtTime),B.setTargetAtTime=(V=>x?()=>{throw i()}:(...H)=>{const L=V.apply(B,H);return O(),L})(B.setTargetAtTime),B.setValueAtTime=(V=>x?()=>{throw i()}:(...H)=>{const L=V.apply(B,H);return O(),L})(B.setValueAtTime),B.setValueCurveAtTime=(V=>x?()=>{throw i()}:(...H)=>{const L=V.apply(B,H);return O(),L})(B.setValueCurveAtTime),B};return{forwardX:R(0,0,A(0)),forwardY:R(1,0,A(1)),forwardZ:R(2,-1,A(2)),positionX:R(6,0,k(0)),positionY:R(7,0,k(1)),positionZ:R(8,0,k(2)),upX:R(3,0,A(3)),upY:R(4,1,A(4)),upZ:R(5,0,A(5))}},{forwardX:d,forwardY:f,forwardZ:m,positionX:p,positionY:_,positionZ:y,upX:S,upY:b,upZ:v}=u.forwardX===void 0?h():u;return{get forwardX(){return d},get forwardY(){return f},get forwardZ(){return m},get positionX(){return p},get positionY(){return _},get positionZ(){return y},get upX(){return S},get upY(){return b},get upZ(){return v}}},Wr=n=>"context"in n,or=n=>Wr(n[0]),vn=(n,e,t,s)=>{for(const i of n)if(t(i)){if(s)return!1;throw Error("The set contains at least one similar element.")}return n.add(e),!0},yl=(n,e,[t,s],i)=>{vn(n,[e,t,s],r=>r[0]===e&&r[1]===t,i)},Tl=(n,[e,t,s],i)=>{const r=n.get(e);r===void 0?n.set(e,new Set([[t,s]])):vn(r,[t,s],o=>o[0]===t,i)},ei=n=>"inputs"in n,Gr=(n,e,t,s)=>{if(ei(e)){const i=e.inputs[s];return n.connect(i,t,0),[i,t,0]}return n.connect(e,t,s),[e,t,s]},ah=(n,e,t)=>{for(const s of n)if(s[0]===e&&s[1]===t)return n.delete(s),s;return null},A_=(n,e,t)=>yo(n,s=>s[0]===e&&s[1]===t),ch=(n,e)=>{if(!nr(n).delete(e))throw new Error("Missing the expected event listener.")},lh=(n,e,t)=>{const s=Lt(n,e),i=yo(s,r=>r[0]===t);return s.size===0&&n.delete(e),i},jr=(n,e,t,s)=>{ei(e)?n.disconnect(e.inputs[s],t,0):n.disconnect(e,t,s)},Se=n=>Lt(tc,n),Ii=n=>Lt(sc,n),dn=n=>Sa.has(n),kr=n=>!jn.has(n),xl=(n,e)=>new Promise(t=>{if(e!==null)t(!0);else{const s=n.createScriptProcessor(256,1,1),i=n.createGain(),r=n.createBuffer(1,2,44100),o=r.getChannelData(0);o[0]=1,o[1]=1;const a=n.createBufferSource();a.buffer=r,a.loop=!0,a.connect(s).connect(n.destination),a.connect(i),a.disconnect(i),s.onaudioprocess=c=>{const l=c.inputBuffer.getChannelData(0);Array.prototype.some.call(l,u=>u===1)?t(!0):t(!1),a.stop(),s.onaudioprocess=null,a.disconnect(s),s.disconnect(n.destination)},a.start()}}),Jo=(n,e)=>{const t=new Map;for(const s of n)for(const i of s){const r=t.get(i);t.set(i,r===void 0?1:r+1)}t.forEach((s,i)=>e(i,s))},Yr=n=>"context"in n,M_=n=>{const e=new Map;n.connect=(t=>(s,i=0,r=0)=>{const o=Yr(s)?t(s,i,r):t(s,i),a=e.get(s);return a===void 0?e.set(s,[{input:r,output:i}]):a.every(c=>c.input!==r||c.output!==i)&&a.push({input:r,output:i}),o})(n.connect.bind(n)),n.disconnect=(t=>(s,i,r)=>{if(t.apply(n),s===void 0)e.clear();else if(typeof s=="number")for(const[o,a]of e){const c=a.filter(l=>l.output!==s);c.length===0?e.delete(o):e.set(o,c)}else if(e.has(s))if(i===void 0)e.delete(s);else{const o=e.get(s);if(o!==void 0){const a=o.filter(c=>c.output!==i&&(c.input!==r||r===void 0));a.length===0?e.delete(s):e.set(s,a)}}for(const[o,a]of e)a.forEach(c=>{Yr(o)?n.connect(o,c.output,c.input):n.connect(o,c.output)})})(n.disconnect)},D_=(n,e,t,s)=>{const{activeInputs:i,passiveInputs:r}=rr(e),{outputs:o}=tt(n),a=nr(n),c=l=>{const u=Se(n),h=Ii(e);if(l){const d=lh(r,n,t);yl(i,n,d,!1),!s&&!dn(n)&&u.connect(h,t)}else{const d=A_(i,n,t);Tl(r,d,!1),!s&&!dn(n)&&u.disconnect(h,t)}};return vn(o,[e,t],l=>l[0]===e&&l[1]===t,!0)?(a.add(c),ds(n)?yl(i,n,[t,c],!0):Tl(r,[n,t,c],!0),!0):!1},k_=(n,e,t,s)=>{const{activeInputs:i,passiveInputs:r}=tt(e),o=ah(i[s],n,t);return o===null?[nh(r,n,t,s)[2],!1]:[o[2],!0]},R_=(n,e,t)=>{const{activeInputs:s,passiveInputs:i}=rr(e),r=ah(s,n,t);return r===null?[lh(i,n,t)[1],!1]:[r[2],!0]},ic=(n,e,t,s,i)=>{const[r,o]=k_(n,t,s,i);if(r!==null&&(ch(n,r),o&&!e&&!dn(n)&&jr(Se(n),Se(t),s,i)),ds(t)){const{activeInputs:a}=tt(t);Ea(t,a)}},rc=(n,e,t,s)=>{const[i,r]=R_(n,t,s);i!==null&&(ch(n,i),r&&!e&&!dn(n)&&Se(n).disconnect(Ii(t),s))},P_=(n,e)=>{const t=tt(n),s=[];for(const i of t.outputs)or(i)?ic(n,e,...i):rc(n,e,...i),s.push(i[0]);return t.outputs.clear(),s},N_=(n,e,t)=>{const s=tt(n),i=[];for(const r of s.outputs)r[1]===t&&(or(r)?ic(n,e,...r):rc(n,e,...r),i.push(r[0]),s.outputs.delete(r));return i},I_=(n,e,t,s,i)=>{const r=tt(n);return Array.from(r.outputs).filter(o=>o[0]===t&&(s===void 0||o[1]===s)&&(i===void 0||o[2]===i)).map(o=>(or(o)?ic(n,e,...o):rc(n,e,...o),r.outputs.delete(o),o[0]))},F_=(n,e,t,s,i,r,o,a,c,l,u,h,d,f,m,p)=>class extends l{constructor(y,S,b,v){super(b),this._context=y,this._nativeAudioNode=b;const g=u(y);h(g)&&t(xl,()=>xl(g,p))!==!0&&M_(b),tc.set(this,b),th.set(this,new Set),y.state!=="closed"&&S&&Yn(this),n(this,v,b)}get channelCount(){return this._nativeAudioNode.channelCount}set channelCount(y){this._nativeAudioNode.channelCount=y}get channelCountMode(){return this._nativeAudioNode.channelCountMode}set channelCountMode(y){this._nativeAudioNode.channelCountMode=y}get channelInterpretation(){return this._nativeAudioNode.channelInterpretation}set channelInterpretation(y){this._nativeAudioNode.channelInterpretation=y}get context(){return this._context}get numberOfInputs(){return this._nativeAudioNode.numberOfInputs}get numberOfOutputs(){return this._nativeAudioNode.numberOfOutputs}connect(y,S=0,b=0){if(S<0||S>=this._nativeAudioNode.numberOfOutputs)throw i();const v=u(this._context),g=m(v);if(d(y)||f(y))throw r();if(Wr(y)){const w=Se(y);try{const E=Gr(this._nativeAudioNode,w,S,b),O=kr(this);(g||O)&&this._nativeAudioNode.disconnect(...E),this.context.state!=="closed"&&!O&&kr(y)&&Yn(y)}catch(E){throw E.code===12?r():E}if(e(this,y,S,b,g)){const E=c([this],y);Jo(E,s(g))}return y}const T=Ii(y);if(T.name==="playbackRate"&&T.maxValue===1024)throw o();try{this._nativeAudioNode.connect(T,S),(g||kr(this))&&this._nativeAudioNode.disconnect(T,S)}catch(w){throw w.code===12?r():w}if(D_(this,y,S,g)){const w=c([this],y);Jo(w,s(g))}}disconnect(y,S,b){let v;const g=u(this._context),T=m(g);if(y===void 0)v=P_(this,T);else if(typeof y=="number"){if(y<0||y>=this.numberOfOutputs)throw i();v=N_(this,T,y)}else{if(S!==void 0&&(S<0||S>=this.numberOfOutputs)||Wr(y)&&b!==void 0&&(b<0||b>=y.numberOfInputs))throw i();if(v=I_(this,T,y,S,b),v.length===0)throw r()}for(const x of v){const w=c([this],x);Jo(w,a)}}},U_=(n,e,t,s,i,r,o,a,c,l,u,h,d)=>(f,m,p,_=null,y=null)=>{const S=p.value,b=new Ym(S),v=m?s(b):null,g={get defaultValue(){return S},get maxValue(){return _===null?p.maxValue:_},get minValue(){return y===null?p.minValue:y},get value(){return p.value},set value(T){p.value=T,g.setValueAtTime(T,f.context.currentTime)},cancelAndHoldAtTime(T){if(typeof p.cancelAndHoldAtTime=="function")v===null&&b.flush(f.context.currentTime),b.add(i(T)),p.cancelAndHoldAtTime(T);else{const x=Array.from(b).pop();v===null&&b.flush(f.context.currentTime),b.add(i(T));const w=Array.from(b).pop();p.cancelScheduledValues(T),x!==w&&w!==void 0&&(w.type==="exponentialRampToValue"?p.exponentialRampToValueAtTime(w.value,w.endTime):w.type==="linearRampToValue"?p.linearRampToValueAtTime(w.value,w.endTime):w.type==="setValue"?p.setValueAtTime(w.value,w.startTime):w.type==="setValueCurve"&&p.setValueCurveAtTime(w.values,w.startTime,w.duration))}return g},cancelScheduledValues(T){return v===null&&b.flush(f.context.currentTime),b.add(r(T)),p.cancelScheduledValues(T),g},exponentialRampToValueAtTime(T,x){if(T===0)throw new RangeError;if(!Number.isFinite(x)||x<0)throw new RangeError;const w=f.context.currentTime;return v===null&&b.flush(w),Array.from(b).length===0&&(b.add(l(S,w)),p.setValueAtTime(S,w)),b.add(o(T,x)),p.exponentialRampToValueAtTime(T,x),g},linearRampToValueAtTime(T,x){const w=f.context.currentTime;return v===null&&b.flush(w),Array.from(b).length===0&&(b.add(l(S,w)),p.setValueAtTime(S,w)),b.add(a(T,x)),p.linearRampToValueAtTime(T,x),g},setTargetAtTime(T,x,w){return v===null&&b.flush(f.context.currentTime),b.add(c(T,x,w)),p.setTargetAtTime(T,x,w),g},setValueAtTime(T,x){return v===null&&b.flush(f.context.currentTime),b.add(l(T,x)),p.setValueAtTime(T,x),g},setValueCurveAtTime(T,x,w){const C=T instanceof Float32Array?T:new Float32Array(T);if(h!==null&&h.name==="webkitAudioContext"){const E=x+w,O=f.context.sampleRate,A=Math.ceil(x*O),k=Math.floor(E*O),R=k-A,P=new Float32Array(R);for(let I=0;I<R;I+=1){const q=(C.length-1)/w*((A+I)/O-x),B=Math.floor(q),V=Math.ceil(q);P[I]=B===V?C[B]:(1-(q-B))*C[B]+(1-(V-q))*C[V]}v===null&&b.flush(f.context.currentTime),b.add(u(P,x,w)),p.setValueCurveAtTime(P,x,w);const F=k/O;F<E&&d(g,P[P.length-1],F),d(g,C[C.length-1],E)}else v===null&&b.flush(f.context.currentTime),b.add(u(C,x,w)),p.setValueCurveAtTime(C,x,w);return g}};return t.set(g,p),e.set(g,f),n(g,v),g},L_=n=>({replay(e){for(const t of n)if(t.type==="exponentialRampToValue"){const{endTime:s,value:i}=t;e.exponentialRampToValueAtTime(i,s)}else if(t.type==="linearRampToValue"){const{endTime:s,value:i}=t;e.linearRampToValueAtTime(i,s)}else if(t.type==="setTarget"){const{startTime:s,target:i,timeConstant:r}=t;e.setTargetAtTime(i,s,r)}else if(t.type==="setValue"){const{startTime:s,value:i}=t;e.setValueAtTime(i,s)}else if(t.type==="setValueCurve"){const{duration:s,startTime:i,values:r}=t;e.setValueCurveAtTime(r,i,s)}else throw new Error("Can't apply an unknown automation.")}});class uh{constructor(e){this._map=new Map(e)}get size(){return this._map.size}entries(){return this._map.entries()}forEach(e,t=null){return this._map.forEach((s,i)=>e.call(t,s,i,this))}get(e){return this._map.get(e)}has(e){return this._map.has(e)}keys(){return this._map.keys()}values(){return this._map.values()}}const B_={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,parameterData:{},processorOptions:{}},z_=(n,e,t,s,i,r,o,a,c,l,u,h,d,f)=>class extends e{constructor(p,_,y){var S;const b=a(p),v=c(b),g=u({...B_,...y});d(g);const T=ba.get(b),x=T==null?void 0:T.get(_),w=v||b.state!=="closed"?b:(S=o(b))!==null&&S!==void 0?S:b,C=i(w,v?null:p.baseLatency,l,_,x,g),E=v?s(_,g,x):null;super(p,!0,C,E);const O=[];C.parameters.forEach((k,R)=>{const P=t(this,v,k);O.push([R,P])}),this._nativeAudioWorkletNode=C,this._onprocessorerror=null,this._parameters=new uh(O),v&&n(b,this);const{activeInputs:A}=r(this);h(C,A)}get onprocessorerror(){return this._onprocessorerror}set onprocessorerror(p){const _=typeof p=="function"?f(this,p):null;this._nativeAudioWorkletNode.onprocessorerror=_;const y=this._nativeAudioWorkletNode.onprocessorerror;this._onprocessorerror=y!==null&&y===_?p:y}get parameters(){return this._parameters===null?this._nativeAudioWorkletNode.parameters:this._parameters}get port(){return this._nativeAudioWorkletNode.port}};function Zr(n,e,t,s,i){if(typeof n.copyFromChannel=="function")e[t].byteLength===0&&(e[t]=new Float32Array(128)),n.copyFromChannel(e[t],s,i);else{const r=n.getChannelData(s);if(e[t].byteLength===0)e[t]=r.slice(i,i+128);else{const o=new Float32Array(r.buffer,i*Float32Array.BYTES_PER_ELEMENT,128);e[t].set(o)}}}const hh=(n,e,t,s,i)=>{typeof n.copyToChannel=="function"?e[t].byteLength!==0&&n.copyToChannel(e[t],s,i):e[t].byteLength!==0&&n.getChannelData(s).set(e[t],i)},Xr=(n,e)=>{const t=[];for(let s=0;s<n;s+=1){const i=[],r=typeof e=="number"?e:e[s];for(let o=0;o<r;o+=1)i.push(new Float32Array(128));t.push(i)}return t},V_=(n,e)=>{const t=Lt(Ca,n),s=Se(e);return Lt(t,s)},H_=async(n,e,t,s,i,r,o)=>{const a=e===null?Math.ceil(n.context.length/128)*128:e.length,c=s.channelCount*s.numberOfInputs,l=i.reduce((_,y)=>_+y,0),u=l===0?null:t.createBuffer(l,a,t.sampleRate);if(r===void 0)throw new Error("Missing the processor constructor.");const h=tt(n),d=await V_(t,n),f=Xr(s.numberOfInputs,s.channelCount),m=Xr(s.numberOfOutputs,i),p=Array.from(n.parameters.keys()).reduce((_,y)=>({..._,[y]:new Float32Array(128)}),{});for(let _=0;_<a;_+=128){if(s.numberOfInputs>0&&e!==null)for(let y=0;y<s.numberOfInputs;y+=1)for(let S=0;S<s.channelCount;S+=1)Zr(e,f[y],S,S,_);r.parameterDescriptors!==void 0&&e!==null&&r.parameterDescriptors.forEach(({name:y},S)=>{Zr(e,p,y,c+S,_)});for(let y=0;y<s.numberOfInputs;y+=1)for(let S=0;S<i[y];S+=1)m[y][S].byteLength===0&&(m[y][S]=new Float32Array(128));try{const y=f.map((b,v)=>h.activeInputs[v].size===0?[]:b),S=o(_/t.sampleRate,t.sampleRate,()=>d.process(y,m,p));if(u!==null)for(let b=0,v=0;b<s.numberOfOutputs;b+=1){for(let g=0;g<i[b];g+=1)hh(u,m[b],g,v+g,_);v+=i[b]}if(!S)break}catch(y){n.dispatchEvent(new ErrorEvent("processorerror",{colno:y.colno,filename:y.filename,lineno:y.lineno,message:y.message}));break}}return u},q_=(n,e,t,s,i,r,o,a,c,l,u,h,d,f,m,p)=>(_,y,S)=>{const b=new WeakMap;let v=null;const g=async(T,x)=>{let w=u(T),C=null;const E=Ke(w,x),O=Array.isArray(y.outputChannelCount)?y.outputChannelCount:Array.from(y.outputChannelCount);if(h===null){const A=O.reduce((F,I)=>F+I,0),k=i(x,{channelCount:Math.max(1,A),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,A)}),R=[];for(let F=0;F<T.numberOfOutputs;F+=1)R.push(s(x,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:O[F]}));const P=o(x,{channelCount:y.channelCount,channelCountMode:y.channelCountMode,channelInterpretation:y.channelInterpretation,gain:1});P.connect=e.bind(null,R),P.disconnect=c.bind(null,R),C=[k,R,P]}else E||(w=new h(x,_));if(b.set(x,C===null?w:C[2]),C!==null){if(v===null){if(S===void 0)throw new Error("Missing the processor constructor.");if(d===null)throw new Error("Missing the native OfflineAudioContext constructor.");const I=T.channelCount*T.numberOfInputs,q=S.parameterDescriptors===void 0?0:S.parameterDescriptors.length,B=I+q;v=H_(T,B===0?null:await(async()=>{const H=new d(B,Math.ceil(T.context.length/128)*128,x.sampleRate),L=[],se=[];for(let ce=0;ce<y.numberOfInputs;ce+=1)L.push(o(H,{channelCount:y.channelCount,channelCountMode:y.channelCountMode,channelInterpretation:y.channelInterpretation,gain:1})),se.push(i(H,{channelCount:y.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:y.channelCount}));const ne=await Promise.all(Array.from(T.parameters.values()).map(async ce=>{const Ve=r(H,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:ce.value});return await f(H,ce,Ve.offset),Ve})),W=s(H,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,I+q)});for(let ce=0;ce<y.numberOfInputs;ce+=1){L[ce].connect(se[ce]);for(let Ve=0;Ve<y.channelCount;Ve+=1)se[ce].connect(W,Ve,ce*y.channelCount+Ve)}for(const[ce,Ve]of ne.entries())Ve.connect(W,0,I+ce),Ve.start(0);return W.connect(H.destination),await Promise.all(L.map(ce=>m(T,H,ce))),p(H)})(),x,y,O,S,l)}const A=await v,k=t(x,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),[R,P,F]=C;A!==null&&(k.buffer=A,k.start(0)),k.connect(R);for(let I=0,q=0;I<T.numberOfOutputs;I+=1){const B=P[I];for(let V=0;V<O[I];V+=1)R.connect(B,q+V,V);q+=O[I]}return F}if(E)for(const[A,k]of T.parameters.entries())await n(x,k,w.parameters.get(A));else for(const[A,k]of T.parameters.entries())await f(x,k,w.parameters.get(A));return await m(T,x,w),w};return{render(T,x){a(x,T);const w=b.get(x);return w!==void 0?Promise.resolve(w):g(T,x)}}},W_=(n,e,t,s,i,r,o,a,c,l,u,h,d,f,m,p,_,y,S,b)=>class extends m{constructor(g,T){super(g,T),this._nativeContext=g,this._audioWorklet=n===void 0?void 0:{addModule:(x,w)=>n(this,x,w)}}get audioWorklet(){return this._audioWorklet}createAnalyser(){return new e(this)}createBiquadFilter(){return new i(this)}createBuffer(g,T,x){return new t({length:T,numberOfChannels:g,sampleRate:x})}createBufferSource(){return new s(this)}createChannelMerger(g=6){return new r(this,{numberOfInputs:g})}createChannelSplitter(g=6){return new o(this,{numberOfOutputs:g})}createConstantSource(){return new a(this)}createConvolver(){return new c(this)}createDelay(g=1){return new u(this,{maxDelayTime:g})}createDynamicsCompressor(){return new h(this)}createGain(){return new d(this)}createIIRFilter(g,T){return new f(this,{feedback:T,feedforward:g})}createOscillator(){return new p(this)}createPanner(){return new _(this)}createPeriodicWave(g,T,x={disableNormalization:!1}){return new y(this,{...x,imag:T,real:g})}createStereoPanner(){return new S(this)}createWaveShaper(){return new b(this)}decodeAudioData(g,T,x){return l(this._nativeContext,g).then(w=>(typeof T=="function"&&T(w),w),w=>{throw typeof x=="function"&&x(w),w})}},G_={Q:1,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:350,gain:0,type:"lowpass"},j_=(n,e,t,s,i,r,o,a)=>class extends n{constructor(l,u){const h=r(l),d={...G_,...u},f=i(h,d),m=o(h),p=m?t():null;super(l,!1,f,p),this._Q=e(this,m,f.Q,Je,at),this._detune=e(this,m,f.detune,1200*Math.log2(Je),-1200*Math.log2(Je)),this._frequency=e(this,m,f.frequency,l.sampleRate/2,0),this._gain=e(this,m,f.gain,40*Math.log10(Je),at),this._nativeBiquadFilterNode=f,a(this,1)}get detune(){return this._detune}get frequency(){return this._frequency}get gain(){return this._gain}get Q(){return this._Q}get type(){return this._nativeBiquadFilterNode.type}set type(l){this._nativeBiquadFilterNode.type=l}getFrequencyResponse(l,u,h){try{this._nativeBiquadFilterNode.getFrequencyResponse(l,u,h)}catch(d){throw d.code===11?s():d}if(l.length!==u.length||u.length!==h.length)throw s()}},Y_=(n,e,t,s,i)=>()=>{const r=new WeakMap,o=async(a,c)=>{let l=t(a);const u=Ke(l,c);if(!u){const h={Q:l.Q.value,channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,detune:l.detune.value,frequency:l.frequency.value,gain:l.gain.value,type:l.type};l=e(c,h)}return r.set(c,l),u?(await n(c,a.Q,l.Q),await n(c,a.detune,l.detune),await n(c,a.frequency,l.frequency),await n(c,a.gain,l.gain)):(await s(c,a.Q,l.Q),await s(c,a.detune,l.detune),await s(c,a.frequency,l.frequency),await s(c,a.gain,l.gain)),await i(a,c,l),l};return{render(a,c){const l=r.get(c);return l!==void 0?Promise.resolve(l):o(a,c)}}},Z_=(n,e)=>(t,s)=>{const i=e.get(t);if(i!==void 0)return i;const r=n.get(t);if(r!==void 0)return r;try{const o=s();return o instanceof Promise?(n.set(t,o),o.catch(()=>!1).then(a=>(n.delete(t),e.set(t,a),a))):(e.set(t,o),o)}catch{return e.set(t,!1),!1}},X_={channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6},$_=(n,e,t,s,i)=>class extends n{constructor(o,a){const c=s(o),l={...X_,...a},u=t(c,l),h=i(c)?e():null;super(o,!1,u,h)}},Q_=(n,e,t)=>()=>{const s=new WeakMap,i=async(r,o)=>{let a=e(r);if(!Ke(a,o)){const l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,numberOfInputs:a.numberOfInputs};a=n(o,l)}return s.set(o,a),await t(r,o,a),a};return{render(r,o){const a=s.get(o);return a!==void 0?Promise.resolve(a):i(r,o)}}},K_={channelCount:6,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:6},J_=(n,e,t,s,i,r)=>class extends n{constructor(a,c){const l=s(a),u=r({...K_,...c}),h=t(l,u),d=i(l)?e():null;super(a,!1,h,d)}},eg=(n,e,t)=>()=>{const s=new WeakMap,i=async(r,o)=>{let a=e(r);if(!Ke(a,o)){const l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,numberOfOutputs:a.numberOfOutputs};a=n(o,l)}return s.set(o,a),await t(r,o,a),a};return{render(r,o){const a=s.get(o);return a!==void 0?Promise.resolve(a):i(r,o)}}},tg=n=>(e,t,s)=>n(t,e,s),sg=n=>(e,t,s=0,i=0)=>{const r=e[s];if(r===void 0)throw n();return Yr(t)?r.connect(t,0,i):r.connect(t,0)},ng=n=>(e,t)=>{const s=n(e,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),i=e.createBuffer(1,2,44100);return s.buffer=i,s.loop=!0,s.connect(t),s.start(),()=>{s.stop(),s.disconnect(t)}},ig={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",offset:1},rg=(n,e,t,s,i,r,o)=>class extends n{constructor(c,l){const u=i(c),h={...ig,...l},d=s(u,h),f=r(u),m=f?t():null;super(c,!1,d,m),this._constantSourceNodeRenderer=m,this._nativeConstantSourceNode=d,this._offset=e(this,f,d.offset,Je,at),this._onended=null}get offset(){return this._offset}get onended(){return this._onended}set onended(c){const l=typeof c=="function"?o(this,c):null;this._nativeConstantSourceNode.onended=l;const u=this._nativeConstantSourceNode.onended;this._onended=u!==null&&u===l?c:u}start(c=0){if(this._nativeConstantSourceNode.start(c),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.start=c),this.context.state!=="closed"){Yn(this);const l=()=>{this._nativeConstantSourceNode.removeEventListener("ended",l),ds(this)&&ir(this)};this._nativeConstantSourceNode.addEventListener("ended",l)}}stop(c=0){this._nativeConstantSourceNode.stop(c),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.stop=c)}},og=(n,e,t,s,i)=>()=>{const r=new WeakMap;let o=null,a=null;const c=async(l,u)=>{let h=t(l);const d=Ke(h,u);if(!d){const f={channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,offset:h.offset.value};h=e(u,f),o!==null&&h.start(o),a!==null&&h.stop(a)}return r.set(u,h),d?await n(u,l.offset,h.offset):await s(u,l.offset,h.offset),await i(l,u,h),h};return{set start(l){o=l},set stop(l){a=l},render(l,u){const h=r.get(u);return h!==void 0?Promise.resolve(h):c(l,u)}}},ag=n=>e=>(n[0]=e,n[0]),cg={buffer:null,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",disableNormalization:!1},lg=(n,e,t,s,i,r)=>class extends n{constructor(a,c){const l=s(a),u={...cg,...c},h=t(l,u),f=i(l)?e():null;super(a,!1,h,f),this._isBufferNullified=!1,this._nativeConvolverNode=h,u.buffer!==null&&r(this,u.buffer.duration)}get buffer(){return this._isBufferNullified?null:this._nativeConvolverNode.buffer}set buffer(a){if(this._nativeConvolverNode.buffer=a,a===null&&this._nativeConvolverNode.buffer!==null){const c=this._nativeConvolverNode.context;this._nativeConvolverNode.buffer=c.createBuffer(1,1,c.sampleRate),this._isBufferNullified=!0,r(this,0)}else this._isBufferNullified=!1,r(this,this._nativeConvolverNode.buffer===null?0:this._nativeConvolverNode.buffer.duration)}get normalize(){return this._nativeConvolverNode.normalize}set normalize(a){this._nativeConvolverNode.normalize=a}},ug=(n,e,t)=>()=>{const s=new WeakMap,i=async(r,o)=>{let a=e(r);if(!Ke(a,o)){const l={buffer:a.buffer,channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,disableNormalization:!a.normalize};a=n(o,l)}return s.set(o,a),ei(a)?await t(r,o,a.inputs[0]):await t(r,o,a),a};return{render(r,o){const a=s.get(o);return a!==void 0?Promise.resolve(a):i(r,o)}}},hg=(n,e)=>(t,s,i)=>{if(e===null)throw new Error("Missing the native OfflineAudioContext constructor.");try{return new e(t,s,i)}catch(r){throw r.name==="SyntaxError"?n():r}},dg=()=>new DOMException("","DataCloneError"),wl=n=>{const{port1:e,port2:t}=new MessageChannel;return new Promise(s=>{const i=()=>{t.onmessage=null,e.close(),t.close(),s()};t.onmessage=()=>i();try{e.postMessage(n,[n])}catch{}finally{i()}})},fg=(n,e,t,s,i,r,o,a,c,l,u)=>(h,d)=>{const f=o(h)?h:r(h);if(i.has(d)){const m=t();return Promise.reject(m)}try{i.add(d)}catch{}return e(c,()=>c(f))?f.decodeAudioData(d).then(m=>(wl(d).catch(()=>{}),e(a,()=>a(m))||u(m),n.add(m),m)):new Promise((m,p)=>{const _=async()=>{try{await wl(d)}catch{}},y=S=>{p(S),_()};try{f.decodeAudioData(d,S=>{typeof S.copyFromChannel!="function"&&(l(S),nc(S)),n.add(S),_().then(()=>m(S))},S=>{y(S===null?s():S)})}catch(S){y(S)}})},pg=(n,e,t,s,i,r,o,a)=>(c,l)=>{const u=e.get(c);if(u===void 0)throw new Error("Missing the expected cycle count.");const h=r(c.context),d=a(h);if(u===l){if(e.delete(c),!d&&o(c)){const f=s(c),{outputs:m}=t(c);for(const p of m)if(or(p)){const _=s(p[0]);n(f,_,p[1],p[2])}else{const _=i(p[0]);f.connect(_,p[1])}}}else e.set(c,u-l)},mg={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",delayTime:0,maxDelayTime:1},_g=(n,e,t,s,i,r,o)=>class extends n{constructor(c,l){const u=i(c),h={...mg,...l},d=s(u,h),f=r(u),m=f?t(h.maxDelayTime):null;super(c,!1,d,m),this._delayTime=e(this,f,d.delayTime),o(this,h.maxDelayTime)}get delayTime(){return this._delayTime}},gg=(n,e,t,s,i)=>r=>{const o=new WeakMap,a=async(c,l)=>{let u=t(c);const h=Ke(u,l);if(!h){const d={channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,delayTime:u.delayTime.value,maxDelayTime:r};u=e(l,d)}return o.set(l,u),h?await n(l,c.delayTime,u.delayTime):await s(l,c.delayTime,u.delayTime),await i(c,l,u),u};return{render(c,l){const u=o.get(l);return u!==void 0?Promise.resolve(u):a(c,l)}}},vg=n=>(e,t,s,i)=>n(e[i],r=>r[0]===t&&r[1]===s),yg=n=>(e,t)=>{n(e).delete(t)},Tg=n=>"delayTime"in n,xg=(n,e,t)=>function s(i,r){const o=Wr(r)?r:t(n,r);if(Tg(o))return[];if(i[0]===o)return[i];if(i.includes(o))return[];const{outputs:a}=e(o);return Array.from(a).map(c=>s([...i,o],c[0])).reduce((c,l)=>c.concat(l),[])},Cr=(n,e,t)=>{const s=e[t];if(s===void 0)throw n();return s},wg=n=>(e,t=void 0,s=void 0,i=0)=>t===void 0?e.forEach(r=>r.disconnect()):typeof t=="number"?Cr(n,e,t).disconnect():Yr(t)?s===void 0?e.forEach(r=>r.disconnect(t)):i===void 0?Cr(n,e,s).disconnect(t,0):Cr(n,e,s).disconnect(t,0,i):s===void 0?e.forEach(r=>r.disconnect(t)):Cr(n,e,s).disconnect(t,0),Sg={attack:.003,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",knee:30,ratio:12,release:.25,threshold:-24},bg=(n,e,t,s,i,r,o,a)=>class extends n{constructor(l,u){const h=r(l),d={...Sg,...u},f=s(h,d),m=o(h),p=m?t():null;super(l,!1,f,p),this._attack=e(this,m,f.attack),this._knee=e(this,m,f.knee),this._nativeDynamicsCompressorNode=f,this._ratio=e(this,m,f.ratio),this._release=e(this,m,f.release),this._threshold=e(this,m,f.threshold),a(this,.006)}get attack(){return this._attack}get channelCount(){return this._nativeDynamicsCompressorNode.channelCount}set channelCount(l){const u=this._nativeDynamicsCompressorNode.channelCount;if(this._nativeDynamicsCompressorNode.channelCount=l,l>2)throw this._nativeDynamicsCompressorNode.channelCount=u,i()}get channelCountMode(){return this._nativeDynamicsCompressorNode.channelCountMode}set channelCountMode(l){const u=this._nativeDynamicsCompressorNode.channelCountMode;if(this._nativeDynamicsCompressorNode.channelCountMode=l,l==="max")throw this._nativeDynamicsCompressorNode.channelCountMode=u,i()}get knee(){return this._knee}get ratio(){return this._ratio}get reduction(){return typeof this._nativeDynamicsCompressorNode.reduction.value=="number"?this._nativeDynamicsCompressorNode.reduction.value:this._nativeDynamicsCompressorNode.reduction}get release(){return this._release}get threshold(){return this._threshold}},Cg=(n,e,t,s,i)=>()=>{const r=new WeakMap,o=async(a,c)=>{let l=t(a);const u=Ke(l,c);if(!u){const h={attack:l.attack.value,channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,knee:l.knee.value,ratio:l.ratio.value,release:l.release.value,threshold:l.threshold.value};l=e(c,h)}return r.set(c,l),u?(await n(c,a.attack,l.attack),await n(c,a.knee,l.knee),await n(c,a.ratio,l.ratio),await n(c,a.release,l.release),await n(c,a.threshold,l.threshold)):(await s(c,a.attack,l.attack),await s(c,a.knee,l.knee),await s(c,a.ratio,l.ratio),await s(c,a.release,l.release),await s(c,a.threshold,l.threshold)),await i(a,c,l),l};return{render(a,c){const l=r.get(c);return l!==void 0?Promise.resolve(l):o(a,c)}}},Eg=()=>new DOMException("","EncodingError"),Og=n=>e=>new Promise((t,s)=>{if(n===null){s(new SyntaxError);return}const i=n.document.head;if(i===null)s(new SyntaxError);else{const r=n.document.createElement("script"),o=new Blob([e],{type:"application/javascript"}),a=URL.createObjectURL(o),c=n.onerror,l=()=>{n.onerror=c,URL.revokeObjectURL(a)};n.onerror=(u,h,d,f,m)=>{if(h===a||h===n.location.href&&d===1&&f===1)return l(),s(m),!1;if(c!==null)return c(u,h,d,f,m)},r.onerror=()=>{l(),s(new SyntaxError)},r.onload=()=>{l(),t()},r.src=a,r.type="module",i.appendChild(r)}}),Ag=n=>class{constructor(t){this._nativeEventTarget=t,this._listeners=new WeakMap}addEventListener(t,s,i){if(s!==null){let r=this._listeners.get(s);r===void 0&&(r=n(this,s),typeof s=="function"&&this._listeners.set(s,r)),this._nativeEventTarget.addEventListener(t,r,i)}}dispatchEvent(t){return this._nativeEventTarget.dispatchEvent(t)}removeEventListener(t,s,i){const r=s===null?void 0:this._listeners.get(s);this._nativeEventTarget.removeEventListener(t,r===void 0?null:r,i)}},Mg=n=>(e,t,s)=>{Object.defineProperties(n,{currentFrame:{configurable:!0,get(){return Math.round(e*t)}},currentTime:{configurable:!0,get(){return e}}});try{return s()}finally{n!==null&&(delete n.currentFrame,delete n.currentTime)}},Dg=n=>async e=>{try{const t=await fetch(e);if(t.ok)return[await t.text(),t.url]}catch{}throw n()},kg={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",gain:1},Rg=(n,e,t,s,i,r)=>class extends n{constructor(a,c){const l=i(a),u={...kg,...c},h=s(l,u),d=r(l),f=d?t():null;super(a,!1,h,f),this._gain=e(this,d,h.gain,Je,at)}get gain(){return this._gain}},Pg=(n,e,t,s,i)=>()=>{const r=new WeakMap,o=async(a,c)=>{let l=t(a);const u=Ke(l,c);if(!u){const h={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,gain:l.gain.value};l=e(c,h)}return r.set(c,l),u?await n(c,a.gain,l.gain):await s(c,a.gain,l.gain),await i(a,c,l),l};return{render(a,c){const l=r.get(c);return l!==void 0?Promise.resolve(l):o(a,c)}}},Ng=(n,e)=>t=>e(n,t),Ig=n=>e=>{const t=n(e);if(t.renderer===null)throw new Error("Missing the renderer of the given AudioNode in the audio graph.");return t.renderer},Fg=n=>e=>{var t;return(t=n.get(e))!==null&&t!==void 0?t:0},Ug=n=>e=>{const t=n(e);if(t.renderer===null)throw new Error("Missing the renderer of the given AudioParam in the audio graph.");return t.renderer},Lg=n=>e=>n.get(e),Ge=()=>new DOMException("","InvalidStateError"),Bg=n=>e=>{const t=n.get(e);if(t===void 0)throw Ge();return t},zg=(n,e)=>t=>{let s=n.get(t);if(s!==void 0)return s;if(e===null)throw new Error("Missing the native OfflineAudioContext constructor.");return s=new e(1,1,44100),n.set(t,s),s},Vg=n=>e=>{const t=n.get(e);if(t===void 0)throw new Error("The context has no set of AudioWorkletNodes.");return t},To=()=>new DOMException("","InvalidAccessError"),Hg=n=>{n.getFrequencyResponse=(e=>(t,s,i)=>{if(t.length!==s.length||s.length!==i.length)throw To();return e.call(n,t,s,i)})(n.getFrequencyResponse)},qg={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers"},Wg=(n,e,t,s,i,r)=>class extends n{constructor(a,c){const l=s(a),u=i(l),h={...qg,...c},d=e(l,u?null:a.baseLatency,h),f=u?t(h.feedback,h.feedforward):null;super(a,!1,d,f),Hg(d),this._nativeIIRFilterNode=d,r(this,1)}getFrequencyResponse(a,c,l){return this._nativeIIRFilterNode.getFrequencyResponse(a,c,l)}},dh=(n,e,t,s,i,r,o,a,c,l,u)=>{const h=l.length;let d=a;for(let f=0;f<h;f+=1){let m=t[0]*l[f];for(let p=1;p<i;p+=1){const _=d-p&c-1;m+=t[p]*r[_],m-=n[p]*o[_]}for(let p=i;p<s;p+=1)m+=t[p]*r[d-p&c-1];for(let p=i;p<e;p+=1)m-=n[p]*o[d-p&c-1];r[d]=l[f],o[d]=m,d=d+1&c-1,u[f]=m}return d},Gg=(n,e,t,s)=>{const i=t instanceof Float64Array?t:new Float64Array(t),r=s instanceof Float64Array?s:new Float64Array(s),o=i.length,a=r.length,c=Math.min(o,a);if(i[0]!==1){for(let m=0;m<o;m+=1)r[m]/=i[0];for(let m=1;m<a;m+=1)i[m]/=i[0]}const l=32,u=new Float32Array(l),h=new Float32Array(l),d=e.createBuffer(n.numberOfChannels,n.length,n.sampleRate),f=n.numberOfChannels;for(let m=0;m<f;m+=1){const p=n.getChannelData(m),_=d.getChannelData(m);u.fill(0),h.fill(0),dh(i,o,r,a,c,u,h,0,l,p,_)}return d},jg=(n,e,t,s,i)=>(r,o)=>{const a=new WeakMap;let c=null;const l=async(u,h)=>{let d=null,f=e(u);const m=Ke(f,h);if(h.createIIRFilter===void 0?d=n(h,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}):m||(f=h.createIIRFilter(o,r)),a.set(h,d===null?f:d),d!==null){if(c===null){if(t===null)throw new Error("Missing the native OfflineAudioContext constructor.");const _=new t(u.context.destination.channelCount,u.context.length,h.sampleRate);c=(async()=>{await s(u,_,_.destination);const y=await i(_);return Gg(y,h,r,o)})()}const p=await c;return d.buffer=p,d.start(0),d}return await s(u,h,f),f};return{render(u,h){const d=a.get(h);return d!==void 0?Promise.resolve(d):l(u,h)}}},Yg=(n,e,t,s,i,r)=>o=>(a,c)=>{const l=n.get(a);if(l===void 0){if(!o&&r(a)){const u=s(a),{outputs:h}=t(a);for(const d of h)if(or(d)){const f=s(d[0]);e(u,f,d[1],d[2])}else{const f=i(d[0]);u.disconnect(f,d[1])}}n.set(a,c)}else n.set(a,l+c)},Zg=(n,e)=>t=>{const s=n.get(t);return e(s)||e(t)},Xg=(n,e)=>t=>n.has(t)||e(t),$g=(n,e)=>t=>n.has(t)||e(t),Qg=(n,e)=>t=>{const s=n.get(t);return e(s)||e(t)},Kg=n=>e=>n!==null&&e instanceof n,Jg=n=>e=>n!==null&&typeof n.AudioNode=="function"&&e instanceof n.AudioNode,ev=n=>e=>n!==null&&typeof n.AudioParam=="function"&&e instanceof n.AudioParam,tv=(n,e)=>t=>n(t)||e(t),sv=n=>e=>n!==null&&e instanceof n,nv=n=>n!==null&&n.isSecureContext,iv=(n,e,t,s)=>class extends n{constructor(r,o){const a=t(r),c=e(a,o);if(s(a))throw TypeError();super(r,!0,c,null),this._nativeMediaElementAudioSourceNode=c}get mediaElement(){return this._nativeMediaElementAudioSourceNode.mediaElement}},rv={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"},ov=(n,e,t,s)=>class extends n{constructor(r,o){const a=t(r);if(s(a))throw new TypeError;const c={...rv,...o},l=e(a,c);super(r,!1,l,null),this._nativeMediaStreamAudioDestinationNode=l}get stream(){return this._nativeMediaStreamAudioDestinationNode.stream}},av=(n,e,t,s)=>class extends n{constructor(r,o){const a=t(r),c=e(a,o);if(s(a))throw new TypeError;super(r,!0,c,null),this._nativeMediaStreamAudioSourceNode=c}get mediaStream(){return this._nativeMediaStreamAudioSourceNode.mediaStream}},cv=(n,e,t)=>class extends n{constructor(i,r){const o=t(i),a=e(o,r);super(i,!0,a,null)}},lv=(n,e,t,s,i,r)=>class extends t{constructor(a,c){super(a),this._nativeContext=a,vo.set(this,a),s(a)&&i.set(a,new Set),this._destination=new n(this,c),this._listener=e(this,a),this._onstatechange=null}get currentTime(){return this._nativeContext.currentTime}get destination(){return this._destination}get listener(){return this._listener}get onstatechange(){return this._onstatechange}set onstatechange(a){const c=typeof a=="function"?r(this,a):null;this._nativeContext.onstatechange=c;const l=this._nativeContext.onstatechange;this._onstatechange=l!==null&&l===c?a:l}get sampleRate(){return this._nativeContext.sampleRate}get state(){return this._nativeContext.state}},Fi=n=>{const e=new Uint32Array([1179011410,40,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,4,0]);try{const t=n.decodeAudioData(e.buffer,()=>{});return t===void 0?!1:(t.catch(()=>{}),!0)}catch{}return!1},uv=(n,e)=>(t,s,i)=>{const r=new Set;return t.connect=(o=>(a,c=0,l=0)=>{const u=r.size===0;if(e(a))return o.call(t,a,c,l),n(r,[a,c,l],h=>h[0]===a&&h[1]===c&&h[2]===l,!0),u&&s(),a;o.call(t,a,c),n(r,[a,c],h=>h[0]===a&&h[1]===c,!0),u&&s()})(t.connect),t.disconnect=(o=>(a,c,l)=>{const u=r.size>0;if(a===void 0)o.apply(t),r.clear();else if(typeof a=="number"){o.call(t,a);for(const d of r)d[1]===a&&r.delete(d)}else{e(a)?o.call(t,a,c,l):o.call(t,a,c);for(const d of r)d[0]===a&&(c===void 0||d[1]===c)&&(l===void 0||d[2]===l)&&r.delete(d)}const h=r.size===0;u&&h&&i()})(t.disconnect),t},Ce=(n,e,t)=>{const s=e[t];s!==void 0&&s!==n[t]&&(n[t]=s)},He=(n,e)=>{Ce(n,e,"channelCount"),Ce(n,e,"channelCountMode"),Ce(n,e,"channelInterpretation")},Sl=n=>typeof n.getFloatTimeDomainData=="function",hv=n=>{n.getFloatTimeDomainData=e=>{const t=new Uint8Array(e.length);n.getByteTimeDomainData(t);const s=Math.max(t.length,n.fftSize);for(let i=0;i<s;i+=1)e[i]=(t[i]-128)*.0078125;return e}},dv=(n,e)=>(t,s)=>{const i=t.createAnalyser();if(He(i,s),!(s.maxDecibels>s.minDecibels))throw e();return Ce(i,s,"fftSize"),Ce(i,s,"maxDecibels"),Ce(i,s,"minDecibels"),Ce(i,s,"smoothingTimeConstant"),n(Sl,()=>Sl(i))||hv(i),i},fv=n=>n===null?null:n.hasOwnProperty("AudioBuffer")?n.AudioBuffer:null,De=(n,e,t)=>{const s=e[t];s!==void 0&&s!==n[t].value&&(n[t].value=s)},pv=n=>{n.start=(e=>{let t=!1;return(s=0,i=0,r)=>{if(t)throw Ge();e.call(n,s,i,r),t=!0}})(n.start)},oc=n=>{n.start=(e=>(t=0,s=0,i)=>{if(typeof i=="number"&&i<0||s<0||t<0)throw new RangeError("The parameters can't be negative.");e.call(n,t,s,i)})(n.start)},ac=n=>{n.stop=(e=>(t=0)=>{if(t<0)throw new RangeError("The parameter can't be negative.");e.call(n,t)})(n.stop)},mv=(n,e,t,s,i,r,o,a,c,l,u)=>(h,d)=>{const f=h.createBufferSource();return He(f,d),De(f,d,"playbackRate"),Ce(f,d,"buffer"),Ce(f,d,"loop"),Ce(f,d,"loopEnd"),Ce(f,d,"loopStart"),e(t,()=>t(h))||pv(f),e(s,()=>s(h))||c(f),e(i,()=>i(h))||l(f,h),e(r,()=>r(h))||oc(f),e(o,()=>o(h))||u(f,h),e(a,()=>a(h))||ac(f),n(h,f),f},_v=n=>n===null?null:n.hasOwnProperty("AudioContext")?n.AudioContext:n.hasOwnProperty("webkitAudioContext")?n.webkitAudioContext:null,gv=(n,e)=>(t,s,i)=>{const r=t.destination;if(r.channelCount!==s)try{r.channelCount=s}catch{}i&&r.channelCountMode!=="explicit"&&(r.channelCountMode="explicit"),r.maxChannelCount===0&&Object.defineProperty(r,"maxChannelCount",{value:s});const o=n(t,{channelCount:s,channelCountMode:r.channelCountMode,channelInterpretation:r.channelInterpretation,gain:1});return e(o,"channelCount",a=>()=>a.call(o),a=>c=>{a.call(o,c);try{r.channelCount=c}catch(l){if(c>r.maxChannelCount)throw l}}),e(o,"channelCountMode",a=>()=>a.call(o),a=>c=>{a.call(o,c),r.channelCountMode=c}),e(o,"channelInterpretation",a=>()=>a.call(o),a=>c=>{a.call(o,c),r.channelInterpretation=c}),Object.defineProperty(o,"maxChannelCount",{get:()=>r.maxChannelCount}),o.connect(r),o},vv=n=>n===null?null:n.hasOwnProperty("AudioWorkletNode")?n.AudioWorkletNode:null,yv=n=>{const{port1:e}=new MessageChannel;try{e.postMessage(n)}finally{e.close()}},Tv=(n,e,t,s,i)=>(r,o,a,c,l,u)=>{if(a!==null)try{const h=new a(r,c,u),d=new Map;let f=null;if(Object.defineProperties(h,{channelCount:{get:()=>u.channelCount,set:()=>{throw n()}},channelCountMode:{get:()=>"explicit",set:()=>{throw n()}},onprocessorerror:{get:()=>f,set:m=>{typeof f=="function"&&h.removeEventListener("processorerror",f),f=typeof m=="function"?m:null,typeof f=="function"&&h.addEventListener("processorerror",f)}}}),h.addEventListener=(m=>(...p)=>{if(p[0]==="processorerror"){const _=typeof p[1]=="function"?p[1]:typeof p[1]=="object"&&p[1]!==null&&typeof p[1].handleEvent=="function"?p[1].handleEvent:null;if(_!==null){const y=d.get(p[1]);y!==void 0?p[1]=y:(p[1]=S=>{S.type==="error"?(Object.defineProperties(S,{type:{value:"processorerror"}}),_(S)):_(new ErrorEvent(p[0],{...S}))},d.set(_,p[1]))}}return m.call(h,"error",p[1],p[2]),m.call(h,...p)})(h.addEventListener),h.removeEventListener=(m=>(...p)=>{if(p[0]==="processorerror"){const _=d.get(p[1]);_!==void 0&&(d.delete(p[1]),p[1]=_)}return m.call(h,"error",p[1],p[2]),m.call(h,p[0],p[1],p[2])})(h.removeEventListener),u.numberOfOutputs!==0){const m=t(r,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return h.connect(m).connect(r.destination),i(h,()=>m.disconnect(),()=>m.connect(r.destination))}return h}catch(h){throw h.code===11?s():h}if(l===void 0)throw s();return yv(u),e(r,o,l,u)},fh=(n,e)=>n===null?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2(n*e))))),xv=n=>new Promise((e,t)=>{const{port1:s,port2:i}=new MessageChannel;s.onmessage=({data:r})=>{s.close(),i.close(),e(r)},s.onmessageerror=({data:r})=>{s.close(),i.close(),t(r)},i.postMessage(n)}),wv=async(n,e)=>{const t=await xv(e);return new n(t)},Sv=(n,e,t,s)=>{let i=Ca.get(n);i===void 0&&(i=new WeakMap,Ca.set(n,i));const r=wv(t,s);return i.set(e,r),r},bv=(n,e,t,s,i,r,o,a,c,l,u,h,d)=>(f,m,p,_)=>{if(_.numberOfInputs===0&&_.numberOfOutputs===0)throw c();const y=Array.isArray(_.outputChannelCount)?_.outputChannelCount:Array.from(_.outputChannelCount);if(y.some(U=>U<1))throw c();if(y.length!==_.numberOfOutputs)throw e();if(_.channelCountMode!=="explicit")throw c();const S=_.channelCount*_.numberOfInputs,b=y.reduce((U,j)=>U+j,0),v=p.parameterDescriptors===void 0?0:p.parameterDescriptors.length;if(S+v>6||b>6)throw c();const g=new MessageChannel,T=[],x=[];for(let U=0;U<_.numberOfInputs;U+=1)T.push(o(f,{channelCount:_.channelCount,channelCountMode:_.channelCountMode,channelInterpretation:_.channelInterpretation,gain:1})),x.push(i(f,{channelCount:_.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:_.channelCount}));const w=[];if(p.parameterDescriptors!==void 0)for(const{defaultValue:U,maxValue:j,minValue:fe,name:ge}of p.parameterDescriptors){const ee=r(f,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:_.parameterData[ge]!==void 0?_.parameterData[ge]:U===void 0?0:U});Object.defineProperties(ee.offset,{defaultValue:{get:()=>U===void 0?0:U},maxValue:{get:()=>j===void 0?Je:j},minValue:{get:()=>fe===void 0?at:fe}}),w.push(ee)}const C=s(f,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,S+v)}),E=fh(m,f.sampleRate),O=a(f,E,S+v,Math.max(1,b)),A=i(f,{channelCount:Math.max(1,b),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,b)}),k=[];for(let U=0;U<_.numberOfOutputs;U+=1)k.push(s(f,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:y[U]}));for(let U=0;U<_.numberOfInputs;U+=1){T[U].connect(x[U]);for(let j=0;j<_.channelCount;j+=1)x[U].connect(C,j,U*_.channelCount+j)}const R=new uh(p.parameterDescriptors===void 0?[]:p.parameterDescriptors.map(({name:U},j)=>{const fe=w[j];return fe.connect(C,0,S+j),fe.start(0),[U,fe.offset]}));C.connect(O);let P=_.channelInterpretation,F=null;const I=_.numberOfOutputs===0?[O]:k,q={get bufferSize(){return E},get channelCount(){return _.channelCount},set channelCount(U){throw t()},get channelCountMode(){return _.channelCountMode},set channelCountMode(U){throw t()},get channelInterpretation(){return P},set channelInterpretation(U){for(const j of T)j.channelInterpretation=U;P=U},get context(){return O.context},get inputs(){return T},get numberOfInputs(){return _.numberOfInputs},get numberOfOutputs(){return _.numberOfOutputs},get onprocessorerror(){return F},set onprocessorerror(U){typeof F=="function"&&q.removeEventListener("processorerror",F),F=typeof U=="function"?U:null,typeof F=="function"&&q.addEventListener("processorerror",F)},get parameters(){return R},get port(){return g.port2},addEventListener(...U){return O.addEventListener(U[0],U[1],U[2])},connect:n.bind(null,I),disconnect:l.bind(null,I),dispatchEvent(...U){return O.dispatchEvent(U[0])},removeEventListener(...U){return O.removeEventListener(U[0],U[1],U[2])}},B=new Map;g.port1.addEventListener=(U=>(...j)=>{if(j[0]==="message"){const fe=typeof j[1]=="function"?j[1]:typeof j[1]=="object"&&j[1]!==null&&typeof j[1].handleEvent=="function"?j[1].handleEvent:null;if(fe!==null){const ge=B.get(j[1]);ge!==void 0?j[1]=ge:(j[1]=ee=>{u(f.currentTime,f.sampleRate,()=>fe(ee))},B.set(fe,j[1]))}}return U.call(g.port1,j[0],j[1],j[2])})(g.port1.addEventListener),g.port1.removeEventListener=(U=>(...j)=>{if(j[0]==="message"){const fe=B.get(j[1]);fe!==void 0&&(B.delete(j[1]),j[1]=fe)}return U.call(g.port1,j[0],j[1],j[2])})(g.port1.removeEventListener);let V=null;Object.defineProperty(g.port1,"onmessage",{get:()=>V,set:U=>{typeof V=="function"&&g.port1.removeEventListener("message",V),V=typeof U=="function"?U:null,typeof V=="function"&&(g.port1.addEventListener("message",V),g.port1.start())}}),p.prototype.port=g.port1;let H=null;Sv(f,q,p,_).then(U=>H=U);const se=Xr(_.numberOfInputs,_.channelCount),ne=Xr(_.numberOfOutputs,y),W=p.parameterDescriptors===void 0?[]:p.parameterDescriptors.reduce((U,{name:j})=>({...U,[j]:new Float32Array(128)}),{});let ce=!0;const Ve=()=>{_.numberOfOutputs>0&&O.disconnect(A);for(let U=0,j=0;U<_.numberOfOutputs;U+=1){const fe=k[U];for(let ge=0;ge<y[U];ge+=1)A.disconnect(fe,j+ge,ge);j+=y[U]}},z=new Map;O.onaudioprocess=({inputBuffer:U,outputBuffer:j})=>{if(H!==null){const fe=h(q);for(let ge=0;ge<E;ge+=128){for(let ee=0;ee<_.numberOfInputs;ee+=1)for(let we=0;we<_.channelCount;we+=1)Zr(U,se[ee],we,we,ge);p.parameterDescriptors!==void 0&&p.parameterDescriptors.forEach(({name:ee},we)=>{Zr(U,W,ee,S+we,ge)});for(let ee=0;ee<_.numberOfInputs;ee+=1)for(let we=0;we<y[ee];we+=1)ne[ee][we].byteLength===0&&(ne[ee][we]=new Float32Array(128));try{const ee=se.map((rt,Wt)=>{if(fe[Wt].size>0)return z.set(Wt,E/128),rt;const ri=z.get(Wt);return ri===void 0?[]:(rt.every(ko=>ko.every(Ro=>Ro===0))&&(ri===1?z.delete(Wt):z.set(Wt,ri-1)),rt)});ce=u(f.currentTime+ge/f.sampleRate,f.sampleRate,()=>H.process(ee,ne,W));for(let rt=0,Wt=0;rt<_.numberOfOutputs;rt+=1){for(let Ys=0;Ys<y[rt];Ys+=1)hh(j,ne[rt],Ys,Wt+Ys,ge);Wt+=y[rt]}}catch(ee){ce=!1,q.dispatchEvent(new ErrorEvent("processorerror",{colno:ee.colno,filename:ee.filename,lineno:ee.lineno,message:ee.message}))}if(!ce){for(let ee=0;ee<_.numberOfInputs;ee+=1){T[ee].disconnect(x[ee]);for(let we=0;we<_.channelCount;we+=1)x[ge].disconnect(C,we,ee*_.channelCount+we)}if(p.parameterDescriptors!==void 0){const ee=p.parameterDescriptors.length;for(let we=0;we<ee;we+=1){const rt=w[we];rt.disconnect(C,0,S+we),rt.stop()}}C.disconnect(O),O.onaudioprocess=null,qt?Ve():it();break}}}};let qt=!1;const Re=o(f,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),ie=()=>O.connect(Re).connect(f.destination),it=()=>{O.disconnect(Re),Re.disconnect()},kt=()=>{if(ce){it(),_.numberOfOutputs>0&&O.connect(A);for(let U=0,j=0;U<_.numberOfOutputs;U+=1){const fe=k[U];for(let ge=0;ge<y[U];ge+=1)A.connect(fe,j+ge,ge);j+=y[U]}}qt=!0},js=()=>{ce&&(ie(),Ve()),qt=!1};return ie(),d(q,kt,js)},ph=(n,e)=>{const t=n.createBiquadFilter();return He(t,e),De(t,e,"Q"),De(t,e,"detune"),De(t,e,"frequency"),De(t,e,"gain"),Ce(t,e,"type"),t},Cv=(n,e)=>(t,s)=>{const i=t.createChannelMerger(s.numberOfInputs);return n!==null&&n.name==="webkitAudioContext"&&e(t,i),He(i,s),i},Ev=n=>{const e=n.numberOfOutputs;Object.defineProperty(n,"channelCount",{get:()=>e,set:t=>{if(t!==e)throw Ge()}}),Object.defineProperty(n,"channelCountMode",{get:()=>"explicit",set:t=>{if(t!=="explicit")throw Ge()}}),Object.defineProperty(n,"channelInterpretation",{get:()=>"discrete",set:t=>{if(t!=="discrete")throw Ge()}})},ar=(n,e)=>{const t=n.createChannelSplitter(e.numberOfOutputs);return He(t,e),Ev(t),t},Ov=(n,e,t,s,i)=>(r,o)=>{if(r.createConstantSource===void 0)return t(r,o);const a=r.createConstantSource();return He(a,o),De(a,o,"offset"),e(s,()=>s(r))||oc(a),e(i,()=>i(r))||ac(a),n(r,a),a},ti=(n,e)=>(n.connect=e.connect.bind(e),n.disconnect=e.disconnect.bind(e),n),Av=(n,e,t,s)=>(i,{offset:r,...o})=>{const a=i.createBuffer(1,2,44100),c=e(i,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),l=t(i,{...o,gain:r}),u=a.getChannelData(0);u[0]=1,u[1]=1,c.buffer=a,c.loop=!0;const h={get bufferSize(){},get channelCount(){return l.channelCount},set channelCount(m){l.channelCount=m},get channelCountMode(){return l.channelCountMode},set channelCountMode(m){l.channelCountMode=m},get channelInterpretation(){return l.channelInterpretation},set channelInterpretation(m){l.channelInterpretation=m},get context(){return l.context},get inputs(){return[]},get numberOfInputs(){return c.numberOfInputs},get numberOfOutputs(){return l.numberOfOutputs},get offset(){return l.gain},get onended(){return c.onended},set onended(m){c.onended=m},addEventListener(...m){return c.addEventListener(m[0],m[1],m[2])},dispatchEvent(...m){return c.dispatchEvent(m[0])},removeEventListener(...m){return c.removeEventListener(m[0],m[1],m[2])},start(m=0){c.start.call(c,m)},stop(m=0){c.stop.call(c,m)}},d=()=>c.connect(l),f=()=>c.disconnect(l);return n(i,c),s(ti(h,l),d,f)},Mv=(n,e)=>(t,s)=>{const i=t.createConvolver();if(He(i,s),s.disableNormalization===i.normalize&&(i.normalize=!s.disableNormalization),Ce(i,s,"buffer"),s.channelCount>2||(e(i,"channelCount",r=>()=>r.call(i),r=>o=>{if(o>2)throw n();return r.call(i,o)}),s.channelCountMode==="max"))throw n();return e(i,"channelCountMode",r=>()=>r.call(i),r=>o=>{if(o==="max")throw n();return r.call(i,o)}),i},mh=(n,e)=>{const t=n.createDelay(e.maxDelayTime);return He(t,e),De(t,e,"delayTime"),t},Dv=n=>(e,t)=>{const s=e.createDynamicsCompressor();if(He(s,t),t.channelCount>2||t.channelCountMode==="max")throw n();return De(s,t,"attack"),De(s,t,"knee"),De(s,t,"ratio"),De(s,t,"release"),De(s,t,"threshold"),s},pt=(n,e)=>{const t=n.createGain();return He(t,e),De(t,e,"gain"),t},kv=n=>(e,t,s)=>{if(e.createIIRFilter===void 0)return n(e,t,s);const i=e.createIIRFilter(s.feedforward,s.feedback);return He(i,s),i};function Rv(n,e){const t=e[0]*e[0]+e[1]*e[1];return[(n[0]*e[0]+n[1]*e[1])/t,(n[1]*e[0]-n[0]*e[1])/t]}function Pv(n,e){return[n[0]*e[0]-n[1]*e[1],n[0]*e[1]+n[1]*e[0]]}function bl(n,e){let t=[0,0];for(let s=n.length-1;s>=0;s-=1)t=Pv(t,e),t[0]+=n[s];return t}const Nv=(n,e,t,s)=>(i,r,{channelCount:o,channelCountMode:a,channelInterpretation:c,feedback:l,feedforward:u})=>{const h=fh(r,i.sampleRate),d=l instanceof Float64Array?l:new Float64Array(l),f=u instanceof Float64Array?u:new Float64Array(u),m=d.length,p=f.length,_=Math.min(m,p);if(m===0||m>20)throw s();if(d[0]===0)throw e();if(p===0||p>20)throw s();if(f[0]===0)throw e();if(d[0]!==1){for(let w=0;w<p;w+=1)f[w]/=d[0];for(let w=1;w<m;w+=1)d[w]/=d[0]}const y=t(i,h,o,o);y.channelCount=o,y.channelCountMode=a,y.channelInterpretation=c;const S=32,b=[],v=[],g=[];for(let w=0;w<o;w+=1){b.push(0);const C=new Float32Array(S),E=new Float32Array(S);C.fill(0),E.fill(0),v.push(C),g.push(E)}y.onaudioprocess=w=>{const C=w.inputBuffer,E=w.outputBuffer,O=C.numberOfChannels;for(let A=0;A<O;A+=1){const k=C.getChannelData(A),R=E.getChannelData(A);b[A]=dh(d,m,f,p,_,v[A],g[A],b[A],S,k,R)}};const T=i.sampleRate/2;return ti({get bufferSize(){return h},get channelCount(){return y.channelCount},set channelCount(w){y.channelCount=w},get channelCountMode(){return y.channelCountMode},set channelCountMode(w){y.channelCountMode=w},get channelInterpretation(){return y.channelInterpretation},set channelInterpretation(w){y.channelInterpretation=w},get context(){return y.context},get inputs(){return[y]},get numberOfInputs(){return y.numberOfInputs},get numberOfOutputs(){return y.numberOfOutputs},addEventListener(...w){return y.addEventListener(w[0],w[1],w[2])},dispatchEvent(...w){return y.dispatchEvent(w[0])},getFrequencyResponse(w,C,E){if(w.length!==C.length||C.length!==E.length)throw n();const O=w.length;for(let A=0;A<O;A+=1){const k=-Math.PI*(w[A]/T),R=[Math.cos(k),Math.sin(k)],P=bl(f,R),F=bl(d,R),I=Rv(P,F);C[A]=Math.sqrt(I[0]*I[0]+I[1]*I[1]),E[A]=Math.atan2(I[1],I[0])}},removeEventListener(...w){return y.removeEventListener(w[0],w[1],w[2])}},y)},Iv=(n,e)=>n.createMediaElementSource(e.mediaElement),Fv=(n,e)=>{const t=n.createMediaStreamDestination();return He(t,e),t.numberOfOutputs===1&&Object.defineProperty(t,"numberOfOutputs",{get:()=>0}),t},Uv=(n,{mediaStream:e})=>{const t=e.getAudioTracks();t.sort((r,o)=>r.id<o.id?-1:r.id>o.id?1:0);const s=t.slice(0,1),i=n.createMediaStreamSource(new MediaStream(s));return Object.defineProperty(i,"mediaStream",{value:e}),i},Lv=(n,e)=>(t,{mediaStreamTrack:s})=>{if(typeof t.createMediaStreamTrackSource=="function")return t.createMediaStreamTrackSource(s);const i=new MediaStream([s]),r=t.createMediaStreamSource(i);if(s.kind!=="audio")throw n();if(e(t))throw new TypeError;return r},Bv=n=>n===null?null:n.hasOwnProperty("OfflineAudioContext")?n.OfflineAudioContext:n.hasOwnProperty("webkitOfflineAudioContext")?n.webkitOfflineAudioContext:null,zv=(n,e,t,s,i,r)=>(o,a)=>{const c=o.createOscillator();return He(c,a),De(c,a,"detune"),De(c,a,"frequency"),a.periodicWave!==void 0?c.setPeriodicWave(a.periodicWave):Ce(c,a,"type"),e(t,()=>t(o))||oc(c),e(s,()=>s(o))||r(c,o),e(i,()=>i(o))||ac(c),n(o,c),c},Vv=n=>(e,t)=>{const s=e.createPanner();return s.orientationX===void 0?n(e,t):(He(s,t),De(s,t,"orientationX"),De(s,t,"orientationY"),De(s,t,"orientationZ"),De(s,t,"positionX"),De(s,t,"positionY"),De(s,t,"positionZ"),Ce(s,t,"coneInnerAngle"),Ce(s,t,"coneOuterAngle"),Ce(s,t,"coneOuterGain"),Ce(s,t,"distanceModel"),Ce(s,t,"maxDistance"),Ce(s,t,"panningModel"),Ce(s,t,"refDistance"),Ce(s,t,"rolloffFactor"),s)},Hv=(n,e,t,s,i,r,o,a,c,l)=>(u,{coneInnerAngle:h,coneOuterAngle:d,coneOuterGain:f,distanceModel:m,maxDistance:p,orientationX:_,orientationY:y,orientationZ:S,panningModel:b,positionX:v,positionY:g,positionZ:T,refDistance:x,rolloffFactor:w,...C})=>{const E=u.createPanner();if(C.channelCount>2||C.channelCountMode==="max")throw o();He(E,C);const O={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},A=t(u,{...O,channelInterpretation:"speakers",numberOfInputs:6}),k=s(u,{...C,gain:1}),R=s(u,{...O,gain:1}),P=s(u,{...O,gain:0}),F=s(u,{...O,gain:0}),I=s(u,{...O,gain:0}),q=s(u,{...O,gain:0}),B=s(u,{...O,gain:0}),V=i(u,256,6,1),H=r(u,{...O,curve:new Float32Array([1,1]),oversample:"none"});let L=[_,y,S],se=[v,g,T];const ne=new Float32Array(1);V.onaudioprocess=({inputBuffer:z})=>{const qt=[c(z,ne,0),c(z,ne,1),c(z,ne,2)];qt.some((ie,it)=>ie!==L[it])&&(E.setOrientation(...qt),L=qt);const Re=[c(z,ne,3),c(z,ne,4),c(z,ne,5)];Re.some((ie,it)=>ie!==se[it])&&(E.setPosition(...Re),se=Re)},Object.defineProperty(P.gain,"defaultValue",{get:()=>0}),Object.defineProperty(F.gain,"defaultValue",{get:()=>0}),Object.defineProperty(I.gain,"defaultValue",{get:()=>0}),Object.defineProperty(q.gain,"defaultValue",{get:()=>0}),Object.defineProperty(B.gain,"defaultValue",{get:()=>0});const W={get bufferSize(){},get channelCount(){return E.channelCount},set channelCount(z){if(z>2)throw o();k.channelCount=z,E.channelCount=z},get channelCountMode(){return E.channelCountMode},set channelCountMode(z){if(z==="max")throw o();k.channelCountMode=z,E.channelCountMode=z},get channelInterpretation(){return E.channelInterpretation},set channelInterpretation(z){k.channelInterpretation=z,E.channelInterpretation=z},get coneInnerAngle(){return E.coneInnerAngle},set coneInnerAngle(z){E.coneInnerAngle=z},get coneOuterAngle(){return E.coneOuterAngle},set coneOuterAngle(z){E.coneOuterAngle=z},get coneOuterGain(){return E.coneOuterGain},set coneOuterGain(z){if(z<0||z>1)throw e();E.coneOuterGain=z},get context(){return E.context},get distanceModel(){return E.distanceModel},set distanceModel(z){E.distanceModel=z},get inputs(){return[k]},get maxDistance(){return E.maxDistance},set maxDistance(z){if(z<0)throw new RangeError;E.maxDistance=z},get numberOfInputs(){return E.numberOfInputs},get numberOfOutputs(){return E.numberOfOutputs},get orientationX(){return R.gain},get orientationY(){return P.gain},get orientationZ(){return F.gain},get panningModel(){return E.panningModel},set panningModel(z){E.panningModel=z},get positionX(){return I.gain},get positionY(){return q.gain},get positionZ(){return B.gain},get refDistance(){return E.refDistance},set refDistance(z){if(z<0)throw new RangeError;E.refDistance=z},get rolloffFactor(){return E.rolloffFactor},set rolloffFactor(z){if(z<0)throw new RangeError;E.rolloffFactor=z},addEventListener(...z){return k.addEventListener(z[0],z[1],z[2])},dispatchEvent(...z){return k.dispatchEvent(z[0])},removeEventListener(...z){return k.removeEventListener(z[0],z[1],z[2])}};h!==W.coneInnerAngle&&(W.coneInnerAngle=h),d!==W.coneOuterAngle&&(W.coneOuterAngle=d),f!==W.coneOuterGain&&(W.coneOuterGain=f),m!==W.distanceModel&&(W.distanceModel=m),p!==W.maxDistance&&(W.maxDistance=p),_!==W.orientationX.value&&(W.orientationX.value=_),y!==W.orientationY.value&&(W.orientationY.value=y),S!==W.orientationZ.value&&(W.orientationZ.value=S),b!==W.panningModel&&(W.panningModel=b),v!==W.positionX.value&&(W.positionX.value=v),g!==W.positionY.value&&(W.positionY.value=g),T!==W.positionZ.value&&(W.positionZ.value=T),x!==W.refDistance&&(W.refDistance=x),w!==W.rolloffFactor&&(W.rolloffFactor=w),(L[0]!==1||L[1]!==0||L[2]!==0)&&E.setOrientation(...L),(se[0]!==0||se[1]!==0||se[2]!==0)&&E.setPosition(...se);const ce=()=>{k.connect(E),n(k,H,0,0),H.connect(R).connect(A,0,0),H.connect(P).connect(A,0,1),H.connect(F).connect(A,0,2),H.connect(I).connect(A,0,3),H.connect(q).connect(A,0,4),H.connect(B).connect(A,0,5),A.connect(V).connect(u.destination)},Ve=()=>{k.disconnect(E),a(k,H,0,0),H.disconnect(R),R.disconnect(A),H.disconnect(P),P.disconnect(A),H.disconnect(F),F.disconnect(A),H.disconnect(I),I.disconnect(A),H.disconnect(q),q.disconnect(A),H.disconnect(B),B.disconnect(A),A.disconnect(V),V.disconnect(u.destination)};return l(ti(W,E),ce,Ve)},qv=n=>(e,{disableNormalization:t,imag:s,real:i})=>{const r=s instanceof Float32Array?s:new Float32Array(s),o=i instanceof Float32Array?i:new Float32Array(i),a=e.createPeriodicWave(o,r,{disableNormalization:t});if(Array.from(s).length<2)throw n();return a},cr=(n,e,t,s)=>n.createScriptProcessor(e,t,s),Wv=(n,e)=>(t,s)=>{const i=s.channelCountMode;if(i==="clamped-max")throw e();if(t.createStereoPanner===void 0)return n(t,s);const r=t.createStereoPanner();return He(r,s),De(r,s,"pan"),Object.defineProperty(r,"channelCountMode",{get:()=>i,set:o=>{if(o!==i)throw e()}}),r},Gv=(n,e,t,s,i,r)=>{const a=new Float32Array([1,1]),c=Math.PI/2,l={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},u={...l,oversample:"none"},h=(m,p,_,y)=>{const S=new Float32Array(16385),b=new Float32Array(16385);for(let C=0;C<16385;C+=1){const E=C/16384*c;S[C]=Math.cos(E),b[C]=Math.sin(E)}const v=t(m,{...l,gain:0}),g=s(m,{...u,curve:S}),T=s(m,{...u,curve:a}),x=t(m,{...l,gain:0}),w=s(m,{...u,curve:b});return{connectGraph(){p.connect(v),p.connect(T.inputs===void 0?T:T.inputs[0]),p.connect(x),T.connect(_),_.connect(g.inputs===void 0?g:g.inputs[0]),_.connect(w.inputs===void 0?w:w.inputs[0]),g.connect(v.gain),w.connect(x.gain),v.connect(y,0,0),x.connect(y,0,1)},disconnectGraph(){p.disconnect(v),p.disconnect(T.inputs===void 0?T:T.inputs[0]),p.disconnect(x),T.disconnect(_),_.disconnect(g.inputs===void 0?g:g.inputs[0]),_.disconnect(w.inputs===void 0?w:w.inputs[0]),g.disconnect(v.gain),w.disconnect(x.gain),v.disconnect(y,0,0),x.disconnect(y,0,1)}}},d=(m,p,_,y)=>{const S=new Float32Array(16385),b=new Float32Array(16385),v=new Float32Array(16385),g=new Float32Array(16385),T=Math.floor(16385/2);for(let I=0;I<16385;I+=1)if(I>T){const q=(I-T)/(16384-T)*c;S[I]=Math.cos(q),b[I]=Math.sin(q),v[I]=0,g[I]=1}else{const q=I/(16384-T)*c;S[I]=1,b[I]=0,v[I]=Math.cos(q),g[I]=Math.sin(q)}const x=e(m,{channelCount:2,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:2}),w=t(m,{...l,gain:0}),C=s(m,{...u,curve:S}),E=t(m,{...l,gain:0}),O=s(m,{...u,curve:b}),A=s(m,{...u,curve:a}),k=t(m,{...l,gain:0}),R=s(m,{...u,curve:v}),P=t(m,{...l,gain:0}),F=s(m,{...u,curve:g});return{connectGraph(){p.connect(x),p.connect(A.inputs===void 0?A:A.inputs[0]),x.connect(w,0),x.connect(E,0),x.connect(k,1),x.connect(P,1),A.connect(_),_.connect(C.inputs===void 0?C:C.inputs[0]),_.connect(O.inputs===void 0?O:O.inputs[0]),_.connect(R.inputs===void 0?R:R.inputs[0]),_.connect(F.inputs===void 0?F:F.inputs[0]),C.connect(w.gain),O.connect(E.gain),R.connect(k.gain),F.connect(P.gain),w.connect(y,0,0),k.connect(y,0,0),E.connect(y,0,1),P.connect(y,0,1)},disconnectGraph(){p.disconnect(x),p.disconnect(A.inputs===void 0?A:A.inputs[0]),x.disconnect(w,0),x.disconnect(E,0),x.disconnect(k,1),x.disconnect(P,1),A.disconnect(_),_.disconnect(C.inputs===void 0?C:C.inputs[0]),_.disconnect(O.inputs===void 0?O:O.inputs[0]),_.disconnect(R.inputs===void 0?R:R.inputs[0]),_.disconnect(F.inputs===void 0?F:F.inputs[0]),C.disconnect(w.gain),O.disconnect(E.gain),R.disconnect(k.gain),F.disconnect(P.gain),w.disconnect(y,0,0),k.disconnect(y,0,0),E.disconnect(y,0,1),P.disconnect(y,0,1)}}},f=(m,p,_,y,S)=>{if(p===1)return h(m,_,y,S);if(p===2)return d(m,_,y,S);throw i()};return(m,{channelCount:p,channelCountMode:_,pan:y,...S})=>{if(_==="max")throw i();const b=n(m,{...S,channelCount:1,channelCountMode:_,numberOfInputs:2}),v=t(m,{...S,channelCount:p,channelCountMode:_,gain:1}),g=t(m,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:y});let{connectGraph:T,disconnectGraph:x}=f(m,p,v,g,b);Object.defineProperty(g.gain,"defaultValue",{get:()=>0}),Object.defineProperty(g.gain,"maxValue",{get:()=>1}),Object.defineProperty(g.gain,"minValue",{get:()=>-1});const w={get bufferSize(){},get channelCount(){return v.channelCount},set channelCount(A){v.channelCount!==A&&(C&&x(),{connectGraph:T,disconnectGraph:x}=f(m,A,v,g,b),C&&T()),v.channelCount=A},get channelCountMode(){return v.channelCountMode},set channelCountMode(A){if(A==="clamped-max"||A==="max")throw i();v.channelCountMode=A},get channelInterpretation(){return v.channelInterpretation},set channelInterpretation(A){v.channelInterpretation=A},get context(){return v.context},get inputs(){return[v]},get numberOfInputs(){return v.numberOfInputs},get numberOfOutputs(){return v.numberOfOutputs},get pan(){return g.gain},addEventListener(...A){return v.addEventListener(A[0],A[1],A[2])},dispatchEvent(...A){return v.dispatchEvent(A[0])},removeEventListener(...A){return v.removeEventListener(A[0],A[1],A[2])}};let C=!1;const E=()=>{T(),C=!0},O=()=>{x(),C=!1};return r(ti(w,b),E,O)}},jv=(n,e,t,s,i,r,o)=>(a,c)=>{const l=a.createWaveShaper();if(r!==null&&r.name==="webkitAudioContext"&&a.createGain().gain.automationRate===void 0)return t(a,c);He(l,c);const u=c.curve===null||c.curve instanceof Float32Array?c.curve:new Float32Array(c.curve);if(u!==null&&u.length<2)throw e();Ce(l,{curve:u},"curve"),Ce(l,c,"oversample");let h=null,d=!1;return o(l,"curve",p=>()=>p.call(l),p=>_=>(p.call(l,_),d&&(s(_)&&h===null?h=n(a,l):!s(_)&&h!==null&&(h(),h=null)),_)),i(l,()=>{d=!0,s(l.curve)&&(h=n(a,l))},()=>{d=!1,h!==null&&(h(),h=null)})},Yv=(n,e,t,s,i)=>(r,{curve:o,oversample:a,...c})=>{const l=r.createWaveShaper(),u=r.createWaveShaper();He(l,c),He(u,c);const h=t(r,{...c,gain:1}),d=t(r,{...c,gain:-1}),f=t(r,{...c,gain:1}),m=t(r,{...c,gain:-1});let p=null,_=!1,y=null;const S={get bufferSize(){},get channelCount(){return l.channelCount},set channelCount(g){h.channelCount=g,d.channelCount=g,l.channelCount=g,f.channelCount=g,u.channelCount=g,m.channelCount=g},get channelCountMode(){return l.channelCountMode},set channelCountMode(g){h.channelCountMode=g,d.channelCountMode=g,l.channelCountMode=g,f.channelCountMode=g,u.channelCountMode=g,m.channelCountMode=g},get channelInterpretation(){return l.channelInterpretation},set channelInterpretation(g){h.channelInterpretation=g,d.channelInterpretation=g,l.channelInterpretation=g,f.channelInterpretation=g,u.channelInterpretation=g,m.channelInterpretation=g},get context(){return l.context},get curve(){return y},set curve(g){if(g!==null&&g.length<2)throw e();if(g===null)l.curve=g,u.curve=g;else{const T=g.length,x=new Float32Array(T+2-T%2),w=new Float32Array(T+2-T%2);x[0]=g[0],w[0]=-g[T-1];const C=Math.ceil((T+1)/2),E=(T+1)/2-1;for(let O=1;O<C;O+=1){const A=O/C*E,k=Math.floor(A),R=Math.ceil(A);x[O]=k===R?g[k]:(1-(A-k))*g[k]+(1-(R-A))*g[R],w[O]=k===R?-g[T-1-k]:-((1-(A-k))*g[T-1-k])-(1-(R-A))*g[T-1-R]}x[C]=T%2===1?g[C-1]:(g[C-2]+g[C-1])/2,l.curve=x,u.curve=w}y=g,_&&(s(y)&&p===null?p=n(r,h):p!==null&&(p(),p=null))},get inputs(){return[h]},get numberOfInputs(){return l.numberOfInputs},get numberOfOutputs(){return l.numberOfOutputs},get oversample(){return l.oversample},set oversample(g){l.oversample=g,u.oversample=g},addEventListener(...g){return h.addEventListener(g[0],g[1],g[2])},dispatchEvent(...g){return h.dispatchEvent(g[0])},removeEventListener(...g){return h.removeEventListener(g[0],g[1],g[2])}};o!==null&&(S.curve=o instanceof Float32Array?o:new Float32Array(o)),a!==S.oversample&&(S.oversample=a);const b=()=>{h.connect(l).connect(f),h.connect(d).connect(u).connect(m).connect(f),_=!0,s(y)&&(p=n(r,h))},v=()=>{h.disconnect(l),l.disconnect(f),h.disconnect(d),d.disconnect(u),u.disconnect(m),m.disconnect(f),_=!1,p!==null&&(p(),p=null)};return i(ti(S,f),b,v)},nt=()=>new DOMException("","NotSupportedError"),Zv={numberOfChannels:1},Xv=(n,e,t,s,i)=>class extends n{constructor(o,a,c){let l;if(typeof o=="number"&&a!==void 0&&c!==void 0)l={length:a,numberOfChannels:o,sampleRate:c};else if(typeof o=="object")l=o;else throw new Error("The given parameters are not valid.");const{length:u,numberOfChannels:h,sampleRate:d}={...Zv,...l},f=s(h,u,d);e(Fi,()=>Fi(f))||f.addEventListener("statechange",(()=>{let m=0;const p=_=>{this._state==="running"&&(m>0?(f.removeEventListener("statechange",p),_.stopImmediatePropagation(),this._waitForThePromiseToSettle(_)):m+=1)};return p})()),super(f,h),this._length=u,this._nativeOfflineAudioContext=f,this._state=null}get length(){return this._nativeOfflineAudioContext.length===void 0?this._length:this._nativeOfflineAudioContext.length}get state(){return this._state===null?this._nativeOfflineAudioContext.state:this._state}startRendering(){return this._state==="running"?Promise.reject(t()):(this._state="running",i(this.destination,this._nativeOfflineAudioContext).finally(()=>{this._state=null,oh(this)}))}_waitForThePromiseToSettle(o){this._state===null?this._nativeOfflineAudioContext.dispatchEvent(o):setTimeout(()=>this._waitForThePromiseToSettle(o))}},$v={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:440,periodicWave:void 0,type:"sine"},Qv=(n,e,t,s,i,r,o)=>class extends n{constructor(c,l){const u=i(c),h={...$v,...l},d=t(u,h),f=r(u),m=f?s():null,p=c.sampleRate/2;super(c,!1,d,m),this._detune=e(this,f,d.detune,153600,-153600),this._frequency=e(this,f,d.frequency,p,-p),this._nativeOscillatorNode=d,this._onended=null,this._oscillatorNodeRenderer=m,this._oscillatorNodeRenderer!==null&&h.periodicWave!==void 0&&(this._oscillatorNodeRenderer.periodicWave=h.periodicWave)}get detune(){return this._detune}get frequency(){return this._frequency}get onended(){return this._onended}set onended(c){const l=typeof c=="function"?o(this,c):null;this._nativeOscillatorNode.onended=l;const u=this._nativeOscillatorNode.onended;this._onended=u!==null&&u===l?c:u}get type(){return this._nativeOscillatorNode.type}set type(c){this._nativeOscillatorNode.type=c,this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=null)}setPeriodicWave(c){this._nativeOscillatorNode.setPeriodicWave(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=c)}start(c=0){if(this._nativeOscillatorNode.start(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.start=c),this.context.state!=="closed"){Yn(this);const l=()=>{this._nativeOscillatorNode.removeEventListener("ended",l),ds(this)&&ir(this)};this._nativeOscillatorNode.addEventListener("ended",l)}}stop(c=0){this._nativeOscillatorNode.stop(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.stop=c)}},Kv=(n,e,t,s,i)=>()=>{const r=new WeakMap;let o=null,a=null,c=null;const l=async(u,h)=>{let d=t(u);const f=Ke(d,h);if(!f){const m={channelCount:d.channelCount,channelCountMode:d.channelCountMode,channelInterpretation:d.channelInterpretation,detune:d.detune.value,frequency:d.frequency.value,periodicWave:o===null?void 0:o,type:d.type};d=e(h,m),a!==null&&d.start(a),c!==null&&d.stop(c)}return r.set(h,d),f?(await n(h,u.detune,d.detune),await n(h,u.frequency,d.frequency)):(await s(h,u.detune,d.detune),await s(h,u.frequency,d.frequency)),await i(u,h,d),d};return{set periodicWave(u){o=u},set start(u){a=u},set stop(u){c=u},render(u,h){const d=r.get(h);return d!==void 0?Promise.resolve(d):l(u,h)}}},Jv={channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:1,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1},e0=(n,e,t,s,i,r,o)=>class extends n{constructor(c,l){const u=i(c),h={...Jv,...l},d=t(u,h),f=r(u),m=f?s():null;super(c,!1,d,m),this._nativePannerNode=d,this._orientationX=e(this,f,d.orientationX,Je,at),this._orientationY=e(this,f,d.orientationY,Je,at),this._orientationZ=e(this,f,d.orientationZ,Je,at),this._positionX=e(this,f,d.positionX,Je,at),this._positionY=e(this,f,d.positionY,Je,at),this._positionZ=e(this,f,d.positionZ,Je,at),o(this,1)}get coneInnerAngle(){return this._nativePannerNode.coneInnerAngle}set coneInnerAngle(c){this._nativePannerNode.coneInnerAngle=c}get coneOuterAngle(){return this._nativePannerNode.coneOuterAngle}set coneOuterAngle(c){this._nativePannerNode.coneOuterAngle=c}get coneOuterGain(){return this._nativePannerNode.coneOuterGain}set coneOuterGain(c){this._nativePannerNode.coneOuterGain=c}get distanceModel(){return this._nativePannerNode.distanceModel}set distanceModel(c){this._nativePannerNode.distanceModel=c}get maxDistance(){return this._nativePannerNode.maxDistance}set maxDistance(c){this._nativePannerNode.maxDistance=c}get orientationX(){return this._orientationX}get orientationY(){return this._orientationY}get orientationZ(){return this._orientationZ}get panningModel(){return this._nativePannerNode.panningModel}set panningModel(c){this._nativePannerNode.panningModel=c}get positionX(){return this._positionX}get positionY(){return this._positionY}get positionZ(){return this._positionZ}get refDistance(){return this._nativePannerNode.refDistance}set refDistance(c){this._nativePannerNode.refDistance=c}get rolloffFactor(){return this._nativePannerNode.rolloffFactor}set rolloffFactor(c){this._nativePannerNode.rolloffFactor=c}},t0=(n,e,t,s,i,r,o,a,c,l)=>()=>{const u=new WeakMap;let h=null;const d=async(f,m)=>{let p=null,_=r(f);const y={channelCount:_.channelCount,channelCountMode:_.channelCountMode,channelInterpretation:_.channelInterpretation},S={...y,coneInnerAngle:_.coneInnerAngle,coneOuterAngle:_.coneOuterAngle,coneOuterGain:_.coneOuterGain,distanceModel:_.distanceModel,maxDistance:_.maxDistance,panningModel:_.panningModel,refDistance:_.refDistance,rolloffFactor:_.rolloffFactor},b=Ke(_,m);if("bufferSize"in _)p=s(m,{...y,gain:1});else if(!b){const v={...S,orientationX:_.orientationX.value,orientationY:_.orientationY.value,orientationZ:_.orientationZ.value,positionX:_.positionX.value,positionY:_.positionY.value,positionZ:_.positionZ.value};_=i(m,v)}if(u.set(m,p===null?_:p),p!==null){if(h===null){if(o===null)throw new Error("Missing the native OfflineAudioContext constructor.");const O=new o(6,f.context.length,m.sampleRate),A=e(O,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6});A.connect(O.destination),h=(async()=>{const k=await Promise.all([f.orientationX,f.orientationY,f.orientationZ,f.positionX,f.positionY,f.positionZ].map(async(R,P)=>{const F=t(O,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:P===0?1:0});return await a(O,R,F.offset),F}));for(let R=0;R<6;R+=1)k[R].connect(A,0,R),k[R].start(0);return l(O)})()}const v=await h,g=s(m,{...y,gain:1});await c(f,m,g);const T=[];for(let O=0;O<v.numberOfChannels;O+=1)T.push(v.getChannelData(O));let x=[T[0][0],T[1][0],T[2][0]],w=[T[3][0],T[4][0],T[5][0]],C=s(m,{...y,gain:1}),E=i(m,{...S,orientationX:x[0],orientationY:x[1],orientationZ:x[2],positionX:w[0],positionY:w[1],positionZ:w[2]});g.connect(C).connect(E.inputs[0]),E.connect(p);for(let O=128;O<v.length;O+=128){const A=[T[0][O],T[1][O],T[2][O]],k=[T[3][O],T[4][O],T[5][O]];if(A.some((R,P)=>R!==x[P])||k.some((R,P)=>R!==w[P])){x=A,w=k;const R=O/m.sampleRate;C.gain.setValueAtTime(0,R),C=s(m,{...y,gain:0}),E=i(m,{...S,orientationX:x[0],orientationY:x[1],orientationZ:x[2],positionX:w[0],positionY:w[1],positionZ:w[2]}),C.gain.setValueAtTime(1,R),g.connect(C).connect(E.inputs[0]),E.connect(p)}}return p}return b?(await n(m,f.orientationX,_.orientationX),await n(m,f.orientationY,_.orientationY),await n(m,f.orientationZ,_.orientationZ),await n(m,f.positionX,_.positionX),await n(m,f.positionY,_.positionY),await n(m,f.positionZ,_.positionZ)):(await a(m,f.orientationX,_.orientationX),await a(m,f.orientationY,_.orientationY),await a(m,f.orientationZ,_.orientationZ),await a(m,f.positionX,_.positionX),await a(m,f.positionY,_.positionY),await a(m,f.positionZ,_.positionZ)),ei(_)?await c(f,m,_.inputs[0]):await c(f,m,_),_};return{render(f,m){const p=u.get(m);return p!==void 0?Promise.resolve(p):d(f,m)}}},s0={disableNormalization:!1},n0=(n,e,t,s)=>class _h{constructor(r,o){const a=e(r),c=s({...s0,...o}),l=n(a,c);return t.add(l),l}static[Symbol.hasInstance](r){return r!==null&&typeof r=="object"&&Object.getPrototypeOf(r)===_h.prototype||t.has(r)}},i0=(n,e)=>(t,s,i)=>(n(s).replay(i),e(s,t,i)),r0=(n,e,t)=>async(s,i,r)=>{const o=n(s);await Promise.all(o.activeInputs.map((a,c)=>Array.from(a).map(async([l,u])=>{const d=await e(l).render(l,i),f=s.context.destination;!t(l)&&(s!==f||!t(s))&&d.connect(r,u,c)})).reduce((a,c)=>[...a,...c],[]))},o0=(n,e,t)=>async(s,i,r)=>{const o=e(s);await Promise.all(Array.from(o.activeInputs).map(async([a,c])=>{const u=await n(a).render(a,i);t(a)||u.connect(r,c)}))},a0=(n,e,t,s)=>i=>n(Fi,()=>Fi(i))?Promise.resolve(n(s,s)).then(r=>{if(!r){const o=t(i,512,0,1);i.oncomplete=()=>{o.onaudioprocess=null,o.disconnect()},o.onaudioprocess=()=>i.currentTime,o.connect(i.destination)}return i.startRendering()}):new Promise(r=>{const o=e(i,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});i.oncomplete=a=>{o.disconnect(),r(a.renderedBuffer)},o.connect(i.destination),i.startRendering()}),c0=n=>(e,t)=>{n.set(e,t)},l0=n=>(e,t)=>n.set(e,t),u0=(n,e,t,s,i,r,o,a)=>(c,l)=>t(c).render(c,l).then(()=>Promise.all(Array.from(s(l)).map(u=>t(u).render(u,l)))).then(()=>i(l)).then(u=>(typeof u.copyFromChannel!="function"?(o(u),nc(u)):e(r,()=>r(u))||a(u),n.add(u),u)),h0={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",pan:0},d0=(n,e,t,s,i,r)=>class extends n{constructor(a,c){const l=i(a),u={...h0,...c},h=t(l,u),d=r(l),f=d?s():null;super(a,!1,h,f),this._pan=e(this,d,h.pan)}get pan(){return this._pan}},f0=(n,e,t,s,i)=>()=>{const r=new WeakMap,o=async(a,c)=>{let l=t(a);const u=Ke(l,c);if(!u){const h={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,pan:l.pan.value};l=e(c,h)}return r.set(c,l),u?await n(c,a.pan,l.pan):await s(c,a.pan,l.pan),ei(l)?await i(a,c,l.inputs[0]):await i(a,c,l),l};return{render(a,c){const l=r.get(c);return l!==void 0?Promise.resolve(l):o(a,c)}}},p0=n=>()=>{if(n===null)return!1;try{new n({length:1,sampleRate:44100})}catch{return!1}return!0},m0=(n,e)=>async()=>{if(n===null)return!0;if(e===null)return!1;const t=new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),s=new e(1,128,44100),i=URL.createObjectURL(t);let r=!1,o=!1;try{await s.audioWorklet.addModule(i);const a=new n(s,"a",{numberOfOutputs:0}),c=s.createOscillator();a.port.onmessage=()=>r=!0,a.onprocessorerror=()=>o=!0,c.connect(a),c.start(0),await s.startRendering(),await new Promise(l=>setTimeout(l))}catch{}finally{URL.revokeObjectURL(i)}return r&&!o},_0=(n,e)=>()=>{if(e===null)return Promise.resolve(!1);const t=new e(1,1,44100),s=n(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise(i=>{t.oncomplete=()=>{s.disconnect(),i(t.currentTime!==0)},t.startRendering()})},g0=()=>new DOMException("","UnknownError"),v0={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",curve:null,oversample:"none"},y0=(n,e,t,s,i,r,o)=>class extends n{constructor(c,l){const u=i(c),h={...v0,...l},d=t(u,h),m=r(u)?s():null;super(c,!0,d,m),this._isCurveNullified=!1,this._nativeWaveShaperNode=d,o(this,1)}get curve(){return this._isCurveNullified?null:this._nativeWaveShaperNode.curve}set curve(c){if(c===null)this._isCurveNullified=!0,this._nativeWaveShaperNode.curve=new Float32Array([0,0]);else{if(c.length<2)throw e();this._isCurveNullified=!1,this._nativeWaveShaperNode.curve=c}}get oversample(){return this._nativeWaveShaperNode.oversample}set oversample(c){this._nativeWaveShaperNode.oversample=c}},T0=(n,e,t)=>()=>{const s=new WeakMap,i=async(r,o)=>{let a=e(r);if(!Ke(a,o)){const l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,curve:a.curve,oversample:a.oversample};a=n(o,l)}return s.set(o,a),ei(a)?await t(r,o,a.inputs[0]):await t(r,o,a),a};return{render(r,o){const a=s.get(o);return a!==void 0?Promise.resolve(a):i(r,o)}}},x0=()=>typeof window>"u"?null:window,w0=(n,e)=>t=>{t.copyFromChannel=(s,i,r=0)=>{const o=n(r),a=n(i);if(a>=t.numberOfChannels)throw e();const c=t.length,l=t.getChannelData(a),u=s.length;for(let h=o<0?-o:0;h+o<c&&h<u;h+=1)s[h]=l[h+o]},t.copyToChannel=(s,i,r=0)=>{const o=n(r),a=n(i);if(a>=t.numberOfChannels)throw e();const c=t.length,l=t.getChannelData(a),u=s.length;for(let h=o<0?-o:0;h+o<c&&h<u;h+=1)l[h+o]=s[h]}},S0=n=>e=>{e.copyFromChannel=(t=>(s,i,r=0)=>{const o=n(r),a=n(i);if(o<e.length)return t.call(e,s,a,o)})(e.copyFromChannel),e.copyToChannel=(t=>(s,i,r=0)=>{const o=n(r),a=n(i);if(o<e.length)return t.call(e,s,a,o)})(e.copyToChannel)},b0=n=>(e,t)=>{const s=t.createBuffer(1,1,44100);e.buffer===null&&(e.buffer=s),n(e,"buffer",i=>()=>{const r=i.call(e);return r===s?null:r},i=>r=>i.call(e,r===null?s:r))},C0=(n,e)=>(t,s)=>{s.channelCount=1,s.channelCountMode="explicit",Object.defineProperty(s,"channelCount",{get:()=>1,set:()=>{throw n()}}),Object.defineProperty(s,"channelCountMode",{get:()=>"explicit",set:()=>{throw n()}});const i=t.createBufferSource();e(s,()=>{const a=s.numberOfInputs;for(let c=0;c<a;c+=1)i.connect(s,0,c)},()=>i.disconnect(s))},gh=(n,e,t)=>n.copyFromChannel===void 0?n.getChannelData(t)[0]:(n.copyFromChannel(e,t),e[0]),vh=n=>{if(n===null)return!1;const e=n.length;return e%2!==0?n[Math.floor(e/2)]!==0:n[e/2-1]+n[e/2]!==0},lr=(n,e,t,s)=>{let i=n;for(;!i.hasOwnProperty(e);)i=Object.getPrototypeOf(i);const{get:r,set:o}=Object.getOwnPropertyDescriptor(i,e);Object.defineProperty(n,e,{get:t(r),set:s(o)})},E0=n=>({...n,outputChannelCount:n.outputChannelCount!==void 0?n.outputChannelCount:n.numberOfInputs===1&&n.numberOfOutputs===1?[n.channelCount]:Array.from({length:n.numberOfOutputs},()=>1)}),O0=n=>({...n,channelCount:n.numberOfOutputs}),A0=n=>{const{imag:e,real:t}=n;return e===void 0?t===void 0?{...n,imag:[0,0],real:[0,0]}:{...n,imag:Array.from(t,()=>0),real:t}:t===void 0?{...n,imag:e,real:Array.from(e,()=>0)}:{...n,imag:e,real:t}},yh=(n,e,t)=>{try{n.setValueAtTime(e,t)}catch(s){if(s.code!==9)throw s;yh(n,e,t+1e-7)}},M0=n=>{const e=n.createBufferSource();e.start();try{e.start()}catch{return!0}return!1},D0=n=>{const e=n.createBufferSource(),t=n.createBuffer(1,1,44100);e.buffer=t;try{e.start(0,1)}catch{return!1}return!0},k0=n=>{const e=n.createBufferSource();e.start();try{e.stop()}catch{return!1}return!0},cc=n=>{const e=n.createOscillator();try{e.start(-1)}catch(t){return t instanceof RangeError}return!1},Th=n=>{const e=n.createBuffer(1,1,44100),t=n.createBufferSource();t.buffer=e,t.start(),t.stop();try{return t.stop(),!0}catch{return!1}},lc=n=>{const e=n.createOscillator();try{e.stop(-1)}catch(t){return t instanceof RangeError}return!1},R0=n=>{const{port1:e,port2:t}=new MessageChannel;try{e.postMessage(n)}finally{e.close(),t.close()}},P0=n=>{n.start=(e=>(t=0,s=0,i)=>{const r=n.buffer,o=r===null?s:Math.min(r.duration,s);r!==null&&o>r.duration-.5/n.context.sampleRate?e.call(n,t,0,0):e.call(n,t,o,i)})(n.start)},xh=(n,e)=>{const t=e.createGain();n.connect(t);const s=(i=>()=>{i.call(n,t),n.removeEventListener("ended",s)})(n.disconnect);n.addEventListener("ended",s),ti(n,t),n.stop=(i=>{let r=!1;return(o=0)=>{if(r)try{i.call(n,o)}catch{t.gain.setValueAtTime(0,o)}else i.call(n,o),r=!0}})(n.stop)},si=(n,e)=>t=>{const s={value:n};return Object.defineProperties(t,{currentTarget:s,target:s}),typeof e=="function"?e.call(n,t):e.handleEvent.call(n,t)},N0=e_(vn),I0=o_(vn),F0=vg(yo),wh=new WeakMap,U0=Fg(wh),Vt=Z_(new Map,new WeakMap),Kt=x0(),Sh=dv(Vt,es),uc=Ig(tt),Ye=r0(tt,uc,dn),L0=h_(Sh,Se,Ye),Te=Bg(vo),Ts=Bv(Kt),de=sv(Ts),bh=new WeakMap,Ch=Ag(si),ur=_v(Kt),hc=Kg(ur),dc=Jg(Kt),Eh=ev(Kt),Ui=vv(Kt),Be=F_(t_(Ju),r_(N0,I0,Gr,F0,jr,tt,U0,nr,Se,vn,ds,dn,kr),Vt,Yg(Sa,jr,tt,Se,Ii,ds),es,To,nt,pg(Gr,Sa,tt,Se,Ii,Te,ds,de),xg(bh,tt,Lt),Ch,Te,hc,dc,Eh,de,Ui),B0=u_(Be,L0,es,Sh,Te,de),fc=new WeakSet,Cl=fv(Kt),Oh=ag(new Uint32Array(1)),pc=w0(Oh,es),mc=S0(Oh),Ah=f_(fc,Vt,nt,Cl,Ts,p0(Cl),pc,mc),xo=a_(pt),Mh=o0(uc,rr,dn),ts=tg(Mh),ni=mv(xo,Vt,M0,D0,k0,cc,Th,lc,P0,b0(lr),xh),ss=i0(Ug(rr),Mh),z0=__(ts,ni,Se,ss,Ye),Ht=U_(s_(eh),bh,sc,L_,Zm,Xm,$m,Qm,Km,Ta,Qu,ur,yh),V0=m_(Be,z0,Ht,Ge,ni,Te,de,si),H0=C_(Be,E_,es,Ge,gv(pt,lr),Te,de,Ye),q0=Y_(ts,ph,Se,ss,Ye),yn=l0(wh),W0=j_(Be,Ht,q0,To,ph,Te,de,yn),Ws=uv(vn,dc),G0=C0(Ge,Ws),Gs=Cv(ur,G0),j0=Q_(Gs,Se,Ye),Y0=$_(Be,j0,Gs,Te,de),Z0=eg(ar,Se,Ye),X0=J_(Be,Z0,ar,Te,de,O0),$0=Av(xo,ni,pt,Ws),ii=Ov(xo,Vt,$0,cc,lc),Q0=og(ts,ii,Se,ss,Ye),K0=rg(Be,Ht,Q0,ii,Te,de,si),Dh=Mv(nt,lr),J0=ug(Dh,Se,Ye),ey=lg(Be,J0,Dh,Te,de,yn),ty=gg(ts,mh,Se,ss,Ye),sy=_g(Be,Ht,ty,mh,Te,de,yn),kh=Dv(nt),ny=Cg(ts,kh,Se,ss,Ye),iy=bg(Be,Ht,ny,kh,nt,Te,de,yn),ry=Pg(ts,pt,Se,ss,Ye),oy=Rg(Be,Ht,ry,pt,Te,de),ay=Nv(To,Ge,cr,nt),wo=a0(Vt,pt,cr,_0(pt,Ts)),cy=jg(ni,Se,Ts,Ye,wo),ly=kv(ay),uy=Wg(Be,ly,cy,Te,de,yn),hy=O_(Ht,Gs,ii,cr,nt,gh,de,lr),Rh=new WeakMap,dy=lv(H0,hy,Ch,de,Rh,si),Ph=zv(xo,Vt,cc,Th,lc,xh),fy=Kv(ts,Ph,Se,ss,Ye),py=Qv(Be,Ht,Ph,fy,Te,de,si),Nh=ng(ni),my=Yv(Nh,Ge,pt,vh,Ws),So=jv(Nh,Ge,my,vh,Ws,ur,lr),_y=Hv(Gr,Ge,Gs,pt,cr,So,nt,jr,gh,Ws),Ih=Vv(_y),gy=t0(ts,Gs,ii,pt,Ih,Se,Ts,ss,Ye,wo),vy=e0(Be,Ht,Ih,gy,Te,de,yn),yy=qv(es),Ty=n0(yy,Te,new WeakSet,A0),xy=Gv(Gs,ar,pt,So,nt,Ws),Fh=Wv(xy,nt),wy=f0(ts,Fh,Se,ss,Ye),Sy=d0(Be,Ht,Fh,wy,Te,de),by=T0(So,Se,Ye),Cy=y0(Be,Ge,So,by,Te,de,yn),Uh=nv(Kt),_c=Mg(Kt),Lh=new WeakMap,Ey=zg(Lh,Ts),Oy=Uh?i_(Vt,nt,Og(Kt),_c,Dg(Jm),Te,Ey,de,Ui,new WeakMap,new WeakMap,m0(Ui,Ts),Kt):void 0,Ay=tv(hc,de),My=fg(fc,Vt,dg,Eg,new WeakSet,Te,Ay,qr,Fi,pc,mc),Bh=W_(Oy,B0,Ah,V0,W0,Y0,X0,K0,ey,My,sy,iy,oy,uy,dy,py,vy,Ty,Sy,Cy),Dy=iv(Be,Iv,Te,de),ky=ov(Be,Fv,Te,de),Ry=av(Be,Uv,Te,de),Py=Lv(Ge,de),Ny=cv(Be,Py,Te),Iy=b_(Bh,Ge,nt,g0,Dy,ky,Ry,Ny,ur),gc=Vg(Rh),Fy=c_(gc),zh=sg(es),Uy=yg(gc),Vh=wg(es),Hh=new WeakMap,Ly=Ng(Hh,Lt),By=bv(zh,es,Ge,Gs,ar,ii,pt,cr,nt,Vh,_c,Ly,Ws),zy=Tv(Ge,By,pt,nt,Ws),Vy=q_(ts,zh,ni,Gs,ar,ii,pt,Uy,Vh,_c,Se,Ui,Ts,ss,Ye,wo),Hy=Lg(Lh),qy=c0(Hh),El=Uh?z_(Fy,Be,Ht,Vy,zy,tt,Hy,Te,de,Ui,E0,qy,R0,si):void 0,Wy=hg(nt,Ts),Gy=u0(fc,Vt,uc,gc,wo,qr,pc,mc),jy=Xv(Bh,Vt,Ge,Wy,Gy),Yy=Zg(vo,hc),Zy=Xg(tc,dc),Xy=$g(sc,Eh),$y=Qg(vo,de);function yt(n){return typeof n>"u"}function J(n){return!yt(n)}function Qy(n){return typeof n=="function"}function Ls(n){return typeof n=="number"}function cn(n){return Object.prototype.toString.call(n)==="[object Object]"&&n.constructor===Object}function Ky(n){return typeof n=="boolean"}function Ut(n){return Array.isArray(n)}function _s(n){return typeof n=="string"}function Er(n){return _s(n)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(n)}function $(n,e){if(!n)throw new Error(e)}function Bt(n,e,t=1/0){if(!(e<=n&&n<=t))throw new RangeError(`Value must be within [${e}, ${t}], got: ${n}`)}function qh(n){!n.isOffline&&n.state!=="running"&&vc('The AudioContext is "suspended". Invoke Tone.start() from a user action to start the audio.')}let Wh=!1,Ol=!1;function Al(n){Wh=n}function Jy(n){yt(n)&&Wh&&!Ol&&(Ol=!0,vc("Events scheduled inside of scheduled callbacks should use the passed in scheduling time. See https://github.com/Tonejs/Tone.js/wiki/Accurate-Timing"))}let Gh=console;function eT(...n){Gh.log(...n)}function vc(...n){Gh.warn(...n)}function tT(n){return new Iy(n)}function sT(n,e,t){return new jy(n,e,t)}const ln=typeof self=="object"?self:null,nT=ln&&(ln.hasOwnProperty("AudioContext")||ln.hasOwnProperty("webkitAudioContext"));function iT(n,e,t){return $(J(El),"This node only works in a secure context (https or localhost)"),new El(n,e,t)}class rT{constructor(e,t,s,i){this._callback=e,this._type=t,this._minimumUpdateInterval=Math.max(128/(i||44100),.001),this.updateInterval=s,this._createClock()}_createWorker(){const e=new Blob([`
			// the initial timeout time
			let timeoutTime =  ${(this._updateInterval*1e3).toFixed(1)};
			// onmessage callback
			self.onmessage = function(msg){
				timeoutTime = parseInt(msg.data);
			};
			// the tick function which posts a message
			// and schedules a new tick
			function tick(){
				setTimeout(tick, timeoutTime);
				self.postMessage('tick');
			}
			// call tick initially
			tick();
			`],{type:"text/javascript"}),t=URL.createObjectURL(e),s=new Worker(t);s.onmessage=this._callback.bind(this),this._worker=s}_createTimeout(){this._timeout=setTimeout(()=>{this._createTimeout(),this._callback()},this._updateInterval*1e3)}_createClock(){if(this._type==="worker")try{this._createWorker()}catch{this._type="timeout",this._createClock()}else this._type==="timeout"&&this._createTimeout()}_disposeClock(){this._timeout&&clearTimeout(this._timeout),this._worker&&(this._worker.terminate(),this._worker.onmessage=null)}get updateInterval(){return this._updateInterval}set updateInterval(e){var t;this._updateInterval=Math.max(e,this._minimumUpdateInterval),this._type==="worker"&&((t=this._worker)===null||t===void 0||t.postMessage(this._updateInterval*1e3))}get type(){return this._type}set type(e){this._disposeClock(),this._type=e,this._createClock()}dispose(){this._disposeClock()}}function fn(n){return Xy(n)}function Is(n){return Zy(n)}function Rr(n){return $y(n)}function An(n){return Yy(n)}function oT(n){return n instanceof Ah}function aT(n,e){return n==="value"||fn(e)||Is(e)||oT(e)}function Un(n,...e){if(!e.length)return n;const t=e.shift();if(cn(n)&&cn(t))for(const s in t)aT(s,t[s])?n[s]=t[s]:cn(t[s])?(n[s]||Object.assign(n,{[s]:{}}),Un(n[s],t[s])):Object.assign(n,{[s]:t[s]});return Un(n,...e)}function cT(n,e){return n.length===e.length&&n.every((t,s)=>e[s]===t)}function N(n,e,t=[],s){const i={},r=Array.from(e);if(cn(r[0])&&s&&!Reflect.has(r[0],s)&&(Object.keys(r[0]).some(a=>Reflect.has(n,a))||(Un(i,{[s]:r[0]}),t.splice(t.indexOf(s),1),r.shift())),r.length===1&&cn(r[0]))Un(i,r[0]);else for(let o=0;o<t.length;o++)J(r[o])&&(i[t[o]]=r[o]);return Un(n,i)}function lT(n){return n.constructor.getDefaults()}function Ln(n,e){return yt(n)?e:n}function Rn(n,e){return e.forEach(t=>{Reflect.has(n,t)&&delete n[t]}),n}/**
 * Tone.js
 * @author Yotam Mann
 * @license http://opensource.org/licenses/MIT MIT License
 * @copyright 2014-2019 Yotam Mann
 */class xs{constructor(){this.debug=!1,this._wasDisposed=!1}static getDefaults(){return{}}log(...e){(this.debug||ln&&this.toString()===ln.TONE_DEBUG_CLASS)&&eT(this,...e)}dispose(){return this._wasDisposed=!0,this}get disposed(){return this._wasDisposed}toString(){return this.name}}xs.version=$u;const yc=1e-6;function Zn(n,e){return n>e+yc}function Aa(n,e){return Zn(n,e)||Nt(n,e)}function $r(n,e){return n+yc<e}function Nt(n,e){return Math.abs(n-e)<yc}function uT(n,e,t){return Math.max(Math.min(n,t),e)}class At extends xs{constructor(){super(),this.name="Timeline",this._timeline=[];const e=N(At.getDefaults(),arguments,["memory"]);this.memory=e.memory,this.increasing=e.increasing}static getDefaults(){return{memory:1/0,increasing:!1}}get length(){return this._timeline.length}add(e){if($(Reflect.has(e,"time"),"Timeline: events must have a time attribute"),e.time=e.time.valueOf(),this.increasing&&this.length){const t=this._timeline[this.length-1];$(Aa(e.time,t.time),"The time must be greater than or equal to the last scheduled time"),this._timeline.push(e)}else{const t=this._search(e.time);this._timeline.splice(t+1,0,e)}if(this.length>this.memory){const t=this.length-this.memory;this._timeline.splice(0,t)}return this}remove(e){const t=this._timeline.indexOf(e);return t!==-1&&this._timeline.splice(t,1),this}get(e,t="time"){const s=this._search(e,t);return s!==-1?this._timeline[s]:null}peek(){return this._timeline[0]}shift(){return this._timeline.shift()}getAfter(e,t="time"){const s=this._search(e,t);return s+1<this._timeline.length?this._timeline[s+1]:null}getBefore(e){const t=this._timeline.length;if(t>0&&this._timeline[t-1].time<e)return this._timeline[t-1];const s=this._search(e);return s-1>=0?this._timeline[s-1]:null}cancel(e){if(this._timeline.length>1){let t=this._search(e);if(t>=0)if(Nt(this._timeline[t].time,e)){for(let s=t;s>=0&&Nt(this._timeline[s].time,e);s--)t=s;this._timeline=this._timeline.slice(0,t)}else this._timeline=this._timeline.slice(0,t+1);else this._timeline=[]}else this._timeline.length===1&&Aa(this._timeline[0].time,e)&&(this._timeline=[]);return this}cancelBefore(e){const t=this._search(e);return t>=0&&(this._timeline=this._timeline.slice(t+1)),this}previousEvent(e){const t=this._timeline.indexOf(e);return t>0?this._timeline[t-1]:null}_search(e,t="time"){if(this._timeline.length===0)return-1;let s=0;const i=this._timeline.length;let r=i;if(i>0&&this._timeline[i-1][t]<=e)return i-1;for(;s<r;){let o=Math.floor(s+(r-s)/2);const a=this._timeline[o],c=this._timeline[o+1];if(Nt(a[t],e)){for(let l=o;l<this._timeline.length;l++){const u=this._timeline[l];if(Nt(u[t],e))o=l;else break}return o}else{if($r(a[t],e)&&Zn(c[t],e))return o;Zn(a[t],e)?r=o:s=o+1}}return-1}_iterate(e,t=0,s=this._timeline.length-1){this._timeline.slice(t,s+1).forEach(e)}forEach(e){return this._iterate(e),this}forEachBefore(e,t){const s=this._search(e);return s!==-1&&this._iterate(t,0,s),this}forEachAfter(e,t){const s=this._search(e);return this._iterate(t,s+1),this}forEachBetween(e,t,s){let i=this._search(e),r=this._search(t);return i!==-1&&r!==-1?(this._timeline[i].time!==e&&(i+=1),this._timeline[r].time===t&&(r-=1),this._iterate(s,i,r)):i===-1&&this._iterate(s,0,r),this}forEachFrom(e,t){let s=this._search(e);for(;s>=0&&this._timeline[s].time>=e;)s--;return this._iterate(t,s+1),this}forEachAtTime(e,t){const s=this._search(e);if(s!==-1&&Nt(this._timeline[s].time,e)){let i=s;for(let r=s;r>=0&&Nt(this._timeline[r].time,e);r--)i=r;this._iterate(r=>{t(r)},i,s)}return this}dispose(){return super.dispose(),this._timeline=[],this}}const jh=[];function bo(n){jh.push(n)}function hT(n){jh.forEach(e=>e(n))}const Yh=[];function Co(n){Yh.push(n)}function dT(n){Yh.forEach(e=>e(n))}class hr extends xs{constructor(){super(...arguments),this.name="Emitter"}on(e,t){return e.split(/\W+/).forEach(i=>{yt(this._events)&&(this._events={}),this._events.hasOwnProperty(i)||(this._events[i]=[]),this._events[i].push(t)}),this}once(e,t){const s=(...i)=>{t(...i),this.off(e,s)};return this.on(e,s),this}off(e,t){return e.split(/\W+/).forEach(i=>{if(yt(this._events)&&(this._events={}),this._events.hasOwnProperty(i))if(yt(t))this._events[i]=[];else{const r=this._events[i];for(let o=r.length-1;o>=0;o--)r[o]===t&&r.splice(o,1)}}),this}emit(e,...t){if(this._events&&this._events.hasOwnProperty(e)){const s=this._events[e].slice(0);for(let i=0,r=s.length;i<r;i++)s[i].apply(this,t)}return this}static mixin(e){["on","once","off","emit"].forEach(t=>{const s=Object.getOwnPropertyDescriptor(hr.prototype,t);Object.defineProperty(e.prototype,t,s)})}dispose(){return super.dispose(),this._events=void 0,this}}class Zh extends hr{constructor(){super(...arguments),this.isOffline=!1}toJSON(){return{}}}class dr extends Zh{constructor(){var e,t;super(),this.name="Context",this._constants=new Map,this._timeouts=new At,this._timeoutIds=0,this._initialized=!1,this._closeStarted=!1,this.isOffline=!1,this._workletPromise=null;const s=N(dr.getDefaults(),arguments,["context"]);s.context?(this._context=s.context,this._latencyHint=((e=arguments[0])===null||e===void 0?void 0:e.latencyHint)||""):(this._context=tT({latencyHint:s.latencyHint}),this._latencyHint=s.latencyHint),this._ticker=new rT(this.emit.bind(this,"tick"),s.clockSource,s.updateInterval,this._context.sampleRate),this.on("tick",this._timeoutLoop.bind(this)),this._context.onstatechange=()=>{this.emit("statechange",this.state)},this[!((t=arguments[0])===null||t===void 0)&&t.hasOwnProperty("updateInterval")?"_lookAhead":"lookAhead"]=s.lookAhead}static getDefaults(){return{clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.05}}initialize(){return this._initialized||(hT(this),this._initialized=!0),this}createAnalyser(){return this._context.createAnalyser()}createOscillator(){return this._context.createOscillator()}createBufferSource(){return this._context.createBufferSource()}createBiquadFilter(){return this._context.createBiquadFilter()}createBuffer(e,t,s){return this._context.createBuffer(e,t,s)}createChannelMerger(e){return this._context.createChannelMerger(e)}createChannelSplitter(e){return this._context.createChannelSplitter(e)}createConstantSource(){return this._context.createConstantSource()}createConvolver(){return this._context.createConvolver()}createDelay(e){return this._context.createDelay(e)}createDynamicsCompressor(){return this._context.createDynamicsCompressor()}createGain(){return this._context.createGain()}createIIRFilter(e,t){return this._context.createIIRFilter(e,t)}createPanner(){return this._context.createPanner()}createPeriodicWave(e,t,s){return this._context.createPeriodicWave(e,t,s)}createStereoPanner(){return this._context.createStereoPanner()}createWaveShaper(){return this._context.createWaveShaper()}createMediaStreamSource(e){return $(An(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamSource(e)}createMediaElementSource(e){return $(An(this._context),"Not available if OfflineAudioContext"),this._context.createMediaElementSource(e)}createMediaStreamDestination(){return $(An(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamDestination()}decodeAudioData(e){return this._context.decodeAudioData(e)}get currentTime(){return this._context.currentTime}get state(){return this._context.state}get sampleRate(){return this._context.sampleRate}get listener(){return this.initialize(),this._listener}set listener(e){$(!this._initialized,"The listener cannot be set after initialization."),this._listener=e}get transport(){return this.initialize(),this._transport}set transport(e){$(!this._initialized,"The transport cannot be set after initialization."),this._transport=e}get draw(){return this.initialize(),this._draw}set draw(e){$(!this._initialized,"Draw cannot be set after initialization."),this._draw=e}get destination(){return this.initialize(),this._destination}set destination(e){$(!this._initialized,"The destination cannot be set after initialization."),this._destination=e}createAudioWorkletNode(e,t){return iT(this.rawContext,e,t)}addAudioWorkletModule(e){return Ue(this,void 0,void 0,function*(){$(J(this.rawContext.audioWorklet),"AudioWorkletNode is only available in a secure context (https or localhost)"),this._workletPromise||(this._workletPromise=this.rawContext.audioWorklet.addModule(e)),yield this._workletPromise})}workletsAreReady(){return Ue(this,void 0,void 0,function*(){(yield this._workletPromise)?this._workletPromise:Promise.resolve()})}get updateInterval(){return this._ticker.updateInterval}set updateInterval(e){this._ticker.updateInterval=e}get clockSource(){return this._ticker.type}set clockSource(e){this._ticker.type=e}get lookAhead(){return this._lookAhead}set lookAhead(e){this._lookAhead=e,this.updateInterval=e?e/2:.01}get latencyHint(){return this._latencyHint}get rawContext(){return this._context}now(){return this._context.currentTime+this._lookAhead}immediate(){return this._context.currentTime}resume(){return An(this._context)?this._context.resume():Promise.resolve()}close(){return Ue(this,void 0,void 0,function*(){An(this._context)&&this.state!=="closed"&&!this._closeStarted&&(this._closeStarted=!0,yield this._context.close()),this._initialized&&dT(this)})}getConstant(e){if(this._constants.has(e))return this._constants.get(e);{const t=this._context.createBuffer(1,128,this._context.sampleRate),s=t.getChannelData(0);for(let r=0;r<s.length;r++)s[r]=e;const i=this._context.createBufferSource();return i.channelCount=1,i.channelCountMode="explicit",i.buffer=t,i.loop=!0,i.start(0),this._constants.set(e,i),i}}dispose(){return super.dispose(),this._ticker.dispose(),this._timeouts.dispose(),Object.keys(this._constants).map(e=>this._constants[e].disconnect()),this.close(),this}_timeoutLoop(){const e=this.now();let t=this._timeouts.peek();for(;this._timeouts.length&&t&&t.time<=e;)t.callback(),this._timeouts.shift(),t=this._timeouts.peek()}setTimeout(e,t){this._timeoutIds++;const s=this.now();return this._timeouts.add({callback:e,id:this._timeoutIds,time:s+t}),this._timeoutIds}clearTimeout(e){return this._timeouts.forEach(t=>{t.id===e&&this._timeouts.remove(t)}),this}clearInterval(e){return this.clearTimeout(e)}setInterval(e,t){const s=++this._timeoutIds,i=()=>{const r=this.now();this._timeouts.add({callback:()=>{e(),i()},id:s,time:r+t})};return i(),s}}class fT extends Zh{constructor(){super(...arguments),this.lookAhead=0,this.latencyHint=0,this.isOffline=!1}createAnalyser(){return{}}createOscillator(){return{}}createBufferSource(){return{}}createBiquadFilter(){return{}}createBuffer(e,t,s){return{}}createChannelMerger(e){return{}}createChannelSplitter(e){return{}}createConstantSource(){return{}}createConvolver(){return{}}createDelay(e){return{}}createDynamicsCompressor(){return{}}createGain(){return{}}createIIRFilter(e,t){return{}}createPanner(){return{}}createPeriodicWave(e,t,s){return{}}createStereoPanner(){return{}}createWaveShaper(){return{}}createMediaStreamSource(e){return{}}createMediaElementSource(e){return{}}createMediaStreamDestination(){return{}}decodeAudioData(e){return Promise.resolve({})}createAudioWorkletNode(e,t){return{}}get rawContext(){return{}}addAudioWorkletModule(e){return Ue(this,void 0,void 0,function*(){return Promise.resolve()})}resume(){return Promise.resolve()}setTimeout(e,t){return 0}clearTimeout(e){return this}setInterval(e,t){return 0}clearInterval(e){return this}getConstant(e){return{}}get currentTime(){return 0}get state(){return{}}get sampleRate(){return 0}get listener(){return{}}get transport(){return{}}get draw(){return{}}set draw(e){}get destination(){return{}}set destination(e){}now(){return 0}immediate(){return 0}}function xe(n,e){Ut(e)?e.forEach(t=>xe(n,t)):Object.defineProperty(n,e,{enumerable:!0,writable:!1})}function Tc(n,e){Ut(e)?e.forEach(t=>Tc(n,t)):Object.defineProperty(n,e,{writable:!0})}const le=()=>{};class ue extends xs{constructor(){super(),this.name="ToneAudioBuffer",this.onload=le;const e=N(ue.getDefaults(),arguments,["url","onload","onerror"]);this.reverse=e.reverse,this.onload=e.onload,_s(e.url)?this.load(e.url).catch(e.onerror):e.url&&this.set(e.url)}static getDefaults(){return{onerror:le,onload:le,reverse:!1}}get sampleRate(){return this._buffer?this._buffer.sampleRate:It().sampleRate}set(e){return e instanceof ue?e.loaded?this._buffer=e.get():e.onload=()=>{this.set(e),this.onload(this)}:this._buffer=e,this._reversed&&this._reverse(),this}get(){return this._buffer}load(e){return Ue(this,void 0,void 0,function*(){const t=ue.load(e).then(s=>{this.set(s),this.onload(this)});ue.downloads.push(t);try{yield t}finally{const s=ue.downloads.indexOf(t);ue.downloads.splice(s,1)}return this})}dispose(){return super.dispose(),this._buffer=void 0,this}fromArray(e){const t=Ut(e)&&e[0].length>0,s=t?e.length:1,i=t?e[0].length:e.length,r=It(),o=r.createBuffer(s,i,r.sampleRate),a=!t&&s===1?[e]:e;for(let c=0;c<s;c++)o.copyToChannel(a[c],c);return this._buffer=o,this}toMono(e){if(Ls(e))this.fromArray(this.toArray(e));else{let t=new Float32Array(this.length);const s=this.numberOfChannels;for(let i=0;i<s;i++){const r=this.toArray(i);for(let o=0;o<r.length;o++)t[o]+=r[o]}t=t.map(i=>i/s),this.fromArray(t)}return this}toArray(e){if(Ls(e))return this.getChannelData(e);if(this.numberOfChannels===1)return this.toArray(0);{const t=[];for(let s=0;s<this.numberOfChannels;s++)t[s]=this.getChannelData(s);return t}}getChannelData(e){return this._buffer?this._buffer.getChannelData(e):new Float32Array(0)}slice(e,t=this.duration){$(this.loaded,"Buffer is not loaded");const s=Math.floor(e*this.sampleRate),i=Math.floor(t*this.sampleRate);$(s<i,"The start time must be less than the end time");const r=i-s,o=It().createBuffer(this.numberOfChannels,r,this.sampleRate);for(let a=0;a<this.numberOfChannels;a++)o.copyToChannel(this.getChannelData(a).subarray(s,i),a);return new ue(o)}_reverse(){if(this.loaded)for(let e=0;e<this.numberOfChannels;e++)this.getChannelData(e).reverse();return this}get loaded(){return this.length>0}get duration(){return this._buffer?this._buffer.duration:0}get length(){return this._buffer?this._buffer.length:0}get numberOfChannels(){return this._buffer?this._buffer.numberOfChannels:0}get reverse(){return this._reversed}set reverse(e){this._reversed!==e&&(this._reversed=e,this._reverse())}static fromArray(e){return new ue().fromArray(e)}static fromUrl(e){return Ue(this,void 0,void 0,function*(){return yield new ue().load(e)})}static load(e){return Ue(this,void 0,void 0,function*(){const t=e.match(/\[([^\]\[]+\|.+)\]$/);if(t){const c=t[1].split("|");let l=c[0];for(const u of c)if(ue.supportsType(u)){l=u;break}e=e.replace(t[0],l)}const s=ue.baseUrl===""||ue.baseUrl.endsWith("/")?ue.baseUrl:ue.baseUrl+"/",i=document.createElement("a");i.href=s+e,i.pathname=(i.pathname+i.hash).split("/").map(encodeURIComponent).join("/");const r=yield fetch(i.href);if(!r.ok)throw new Error(`could not load url: ${e}`);const o=yield r.arrayBuffer();return yield It().decodeAudioData(o)})}static supportsType(e){const t=e.split("."),s=t[t.length-1];return document.createElement("audio").canPlayType("audio/"+s)!==""}static loaded(){return Ue(this,void 0,void 0,function*(){for(yield Promise.resolve();ue.downloads.length;)yield ue.downloads[0]})}}ue.baseUrl="";ue.downloads=[];class Eo extends dr{constructor(){super({clockSource:"offline",context:Rr(arguments[0])?arguments[0]:sT(arguments[0],arguments[1]*arguments[2],arguments[2]),lookAhead:0,updateInterval:Rr(arguments[0])?128/arguments[0].sampleRate:128/arguments[2]}),this.name="OfflineContext",this._currentTime=0,this.isOffline=!0,this._duration=Rr(arguments[0])?arguments[0].length/arguments[0].sampleRate:arguments[1]}now(){return this._currentTime}get currentTime(){return this._currentTime}_renderClock(e){return Ue(this,void 0,void 0,function*(){let t=0;for(;this._duration-this._currentTime>=0;){this.emit("tick"),this._currentTime+=128/this.sampleRate,t++;const s=Math.floor(this.sampleRate/128);e&&t%s===0&&(yield new Promise(i=>setTimeout(i,1)))}})}render(e=!0){return Ue(this,void 0,void 0,function*(){yield this.workletsAreReady(),yield this._renderClock(e);const t=yield this._context.startRendering();return new ue(t)})}close(){return Promise.resolve()}}const Xh=new fT;let sn=Xh;function It(){return sn===Xh&&nT&&pT(new dr),sn}function pT(n,e=!1){e&&sn.dispose(),An(n)?sn=new dr(n):Rr(n)?sn=new Eo(n):sn=n}function mT(){return sn.resume()}if(ln&&!ln.TONE_SILENCE_LOGGING){const e=` * Tone.js v${$u} * `;console.log(`%c${e}`,"background: #000; color: #fff")}function _T(n){return Math.pow(10,n/20)}function gT(n){return 20*(Math.log(n)/Math.LN10)}function $h(n){return Math.pow(2,n/12)}let Oo=440;function vT(){return Oo}function yT(n){Oo=n}function Ma(n){return Math.round(Qh(n))}function Qh(n){return 69+12*Math.log2(n/Oo)}function TT(n){return Oo*Math.pow(2,(n-69)/12)}class xc extends xs{constructor(e,t,s){super(),this.defaultUnits="s",this._val=t,this._units=s,this.context=e,this._expressions=this._getExpressions()}_getExpressions(){return{hz:{method:e=>this._frequencyToUnits(parseFloat(e)),regexp:/^(\d+(?:\.\d+)?)hz$/i},i:{method:e=>this._ticksToUnits(parseInt(e,10)),regexp:/^(\d+)i$/i},m:{method:e=>this._beatsToUnits(parseInt(e,10)*this._getTimeSignature()),regexp:/^(\d+)m$/i},n:{method:(e,t)=>{const s=parseInt(e,10),i=t==="."?1.5:1;return s===1?this._beatsToUnits(this._getTimeSignature())*i:this._beatsToUnits(4/s)*i},regexp:/^(\d+)n(\.?)$/i},number:{method:e=>this._expressions[this.defaultUnits].method.call(this,e),regexp:/^(\d+(?:\.\d+)?)$/},s:{method:e=>this._secondsToUnits(parseFloat(e)),regexp:/^(\d+(?:\.\d+)?)s$/},samples:{method:e=>parseInt(e,10)/this.context.sampleRate,regexp:/^(\d+)samples$/},t:{method:e=>{const t=parseInt(e,10);return this._beatsToUnits(8/(Math.floor(t)*3))},regexp:/^(\d+)t$/i},tr:{method:(e,t,s)=>{let i=0;return e&&e!=="0"&&(i+=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),t&&t!=="0"&&(i+=this._beatsToUnits(parseFloat(t))),s&&s!=="0"&&(i+=this._beatsToUnits(parseFloat(s)/4)),i},regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/}}}valueOf(){if(this._val instanceof xc&&this.fromType(this._val),yt(this._val))return this._noArg();if(_s(this._val)&&yt(this._units)){for(const e in this._expressions)if(this._expressions[e].regexp.test(this._val.trim())){this._units=e;break}}else if(cn(this._val)){let e=0;for(const t in this._val)if(J(this._val[t])){const s=this._val[t],i=new this.constructor(this.context,t).valueOf()*s;e+=i}return e}if(J(this._units)){const e=this._expressions[this._units],t=this._val.toString().trim().match(e.regexp);return t?e.method.apply(this,t.slice(1)):e.method.call(this,this._val)}else return _s(this._val)?parseFloat(this._val):this._val}_frequencyToUnits(e){return 1/e}_beatsToUnits(e){return 60/this._getBpm()*e}_secondsToUnits(e){return e}_ticksToUnits(e){return e*this._beatsToUnits(1)/this._getPPQ()}_noArg(){return this._now()}_getBpm(){return this.context.transport.bpm.value}_getTimeSignature(){return this.context.transport.timeSignature}_getPPQ(){return this.context.transport.PPQ}fromType(e){switch(this._units=void 0,this.defaultUnits){case"s":this._val=e.toSeconds();break;case"i":this._val=e.toTicks();break;case"hz":this._val=e.toFrequency();break;case"midi":this._val=e.toMidi();break}return this}toFrequency(){return 1/this.toSeconds()}toSamples(){return this.toSeconds()*this.context.sampleRate}toMilliseconds(){return this.toSeconds()*1e3}}class Ft extends xc{constructor(){super(...arguments),this.name="TimeClass"}_getExpressions(){return Object.assign(super._getExpressions(),{now:{method:e=>this._now()+new this.constructor(this.context,e).valueOf(),regexp:/^\+(.+)/},quantize:{method:e=>{const t=new Ft(this.context,e).valueOf();return this._secondsToUnits(this.context.transport.nextSubdivision(t))},regexp:/^@(.+)/}})}quantize(e,t=1){const s=new this.constructor(this.context,e).valueOf(),i=this.valueOf(),a=Math.round(i/s)*s-i;return i+a*t}toNotation(){const e=this.toSeconds(),t=["1m"];for(let r=1;r<9;r++){const o=Math.pow(2,r);t.push(o+"n."),t.push(o+"n"),t.push(o+"t")}t.push("0");let s=t[0],i=new Ft(this.context,t[0]).toSeconds();return t.forEach(r=>{const o=new Ft(this.context,r).toSeconds();Math.abs(o-e)<Math.abs(i-e)&&(s=r,i=o)}),s}toBarsBeatsSixteenths(){const e=this._beatsToUnits(1);let t=this.valueOf()/e;t=parseFloat(t.toFixed(4));const s=Math.floor(t/this._getTimeSignature());let i=t%1*4;t=Math.floor(t)%this._getTimeSignature();const r=i.toString();return r.length>3&&(i=parseFloat(parseFloat(r).toFixed(3))),[s,t,i].join(":")}toTicks(){const e=this._beatsToUnits(1);return this.valueOf()/e*this._getPPQ()}toSeconds(){return this.valueOf()}toMidi(){return Ma(this.toFrequency())}_now(){return this.context.now()}}class Ot extends Ft{constructor(){super(...arguments),this.name="Frequency",this.defaultUnits="hz"}static get A4(){return vT()}static set A4(e){yT(e)}_getExpressions(){return Object.assign({},super._getExpressions(),{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method(e){return this.defaultUnits==="midi"?e:Ot.mtof(e)}},note:{regexp:/^([a-g]{1}(?:b|#|##|x|bb|###|#x|x#|bbb)?)(-?[0-9]+)/i,method(e,t){const i=xT[e.toLowerCase()]+(parseInt(t,10)+1)*12;return this.defaultUnits==="midi"?i:Ot.mtof(i)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method(e,t,s){let i=1;return e&&e!=="0"&&(i*=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),t&&t!=="0"&&(i*=this._beatsToUnits(parseFloat(t))),s&&s!=="0"&&(i*=this._beatsToUnits(parseFloat(s)/4)),i}}})}transpose(e){return new Ot(this.context,this.valueOf()*$h(e))}harmonize(e){return e.map(t=>this.transpose(t))}toMidi(){return Ma(this.valueOf())}toNote(){const e=this.toFrequency(),t=Math.log2(e/Ot.A4);let s=Math.round(12*t)+57;const i=Math.floor(s/12);return i<0&&(s+=-12*i),wT[s%12]+i.toString()}toSeconds(){return 1/super.toSeconds()}toTicks(){const e=this._beatsToUnits(1),t=this.valueOf()/e;return Math.floor(t*this._getPPQ())}_noArg(){return 0}_frequencyToUnits(e){return e}_ticksToUnits(e){return 1/(e*60/(this._getBpm()*this._getPPQ()))}_beatsToUnits(e){return 1/super._beatsToUnits(e)}_secondsToUnits(e){return 1/e}static mtof(e){return TT(e)}static ftom(e){return Ma(e)}}const xT={cbbb:-3,cbb:-2,cb:-1,c:0,"c#":1,cx:2,"c##":2,"c###":3,"cx#":3,"c#x":3,dbbb:-1,dbb:0,db:1,d:2,"d#":3,dx:4,"d##":4,"d###":5,"dx#":5,"d#x":5,ebbb:1,ebb:2,eb:3,e:4,"e#":5,ex:6,"e##":6,"e###":7,"ex#":7,"e#x":7,fbbb:2,fbb:3,fb:4,f:5,"f#":6,fx:7,"f##":7,"f###":8,"fx#":8,"f#x":8,gbbb:4,gbb:5,gb:6,g:7,"g#":8,gx:9,"g##":9,"g###":10,"gx#":10,"g#x":10,abbb:6,abb:7,ab:8,a:9,"a#":10,ax:11,"a##":11,"a###":12,"ax#":12,"a#x":12,bbbb:8,bbb:9,bb:10,b:11,"b#":12,bx:13,"b##":13,"b###":14,"bx#":14,"b#x":14},wT=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];class Ei extends Ft{constructor(){super(...arguments),this.name="TransportTime"}_now(){return this.context.transport.seconds}}class dt extends xs{constructor(){super();const e=N(dt.getDefaults(),arguments,["context"]);this.defaultContext?this.context=this.defaultContext:this.context=e.context}static getDefaults(){return{context:It()}}now(){return this.context.currentTime+this.context.lookAhead}immediate(){return this.context.currentTime}get sampleTime(){return 1/this.context.sampleRate}get blockTime(){return 128/this.context.sampleRate}toSeconds(e){return Jy(e),new Ft(this.context,e).toSeconds()}toFrequency(e){return new Ot(this.context,e).toFrequency()}toTicks(e){return new Ei(this.context,e).toTicks()}_getPartialProperties(e){const t=this.get();return Object.keys(t).forEach(s=>{yt(e[s])&&delete t[s]}),t}get(){const e=lT(this);return Object.keys(e).forEach(t=>{if(Reflect.has(this,t)){const s=this[t];J(s)&&J(s.value)&&J(s.setValueAtTime)?e[t]=s.value:s instanceof dt?e[t]=s._getPartialProperties(e[t]):Ut(s)||Ls(s)||_s(s)||Ky(s)?e[t]=s:delete e[t]}}),e}set(e){return Object.keys(e).forEach(t=>{Reflect.has(this,t)&&J(this[t])&&(this[t]&&J(this[t].value)&&J(this[t].setValueAtTime)?this[t].value!==e[t]&&(this[t].value=e[t]):this[t]instanceof dt?this[t].set(e[t]):this[t]=e[t])}),this}}class wc extends At{constructor(e="stopped"){super(),this.name="StateTimeline",this._initial=e,this.setStateAtTime(this._initial,0)}getValueAtTime(e){const t=this.get(e);return t!==null?t.state:this._initial}setStateAtTime(e,t,s){return Bt(t,0),this.add(Object.assign({},s,{state:e,time:t})),this}getLastState(e,t){const s=this._search(t);for(let i=s;i>=0;i--){const r=this._timeline[i];if(r.state===e)return r}}getNextState(e,t){const s=this._search(t);if(s!==-1)for(let i=s;i<this._timeline.length;i++){const r=this._timeline[i];if(r.state===e)return r}}}class he extends dt{constructor(){super(N(he.getDefaults(),arguments,["param","units","convert"])),this.name="Param",this.overridden=!1,this._minOutput=1e-7;const e=N(he.getDefaults(),arguments,["param","units","convert"]);for($(J(e.param)&&(fn(e.param)||e.param instanceof he),"param must be an AudioParam");!fn(e.param);)e.param=e.param._param;this._swappable=J(e.swappable)?e.swappable:!1,this._swappable?(this.input=this.context.createGain(),this._param=e.param,this.input.connect(this._param)):this._param=this.input=e.param,this._events=new At(1e3),this._initialValue=this._param.defaultValue,this.units=e.units,this.convert=e.convert,this._minValue=e.minValue,this._maxValue=e.maxValue,J(e.value)&&e.value!==this._toType(this._initialValue)&&this.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(dt.getDefaults(),{convert:!0,units:"number"})}get value(){const e=this.now();return this.getValueAtTime(e)}set value(e){this.cancelScheduledValues(this.now()),this.setValueAtTime(e,this.now())}get minValue(){return J(this._minValue)?this._minValue:this.units==="time"||this.units==="frequency"||this.units==="normalRange"||this.units==="positive"||this.units==="transportTime"||this.units==="ticks"||this.units==="bpm"||this.units==="hertz"||this.units==="samples"?0:this.units==="audioRange"?-1:this.units==="decibels"?-1/0:this._param.minValue}get maxValue(){return J(this._maxValue)?this._maxValue:this.units==="normalRange"||this.units==="audioRange"?1:this._param.maxValue}_is(e,t){return this.units===t}_assertRange(e){return J(this.maxValue)&&J(this.minValue)&&Bt(e,this._fromType(this.minValue),this._fromType(this.maxValue)),e}_fromType(e){return this.convert&&!this.overridden?this._is(e,"time")?this.toSeconds(e):this._is(e,"decibels")?_T(e):this._is(e,"frequency")?this.toFrequency(e):e:this.overridden?0:e}_toType(e){return this.convert&&this.units==="decibels"?gT(e):e}setValueAtTime(e,t){const s=this.toSeconds(t),i=this._fromType(e);return $(isFinite(i)&&isFinite(s),`Invalid argument(s) to setValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._assertRange(i),this.log(this.units,"setValueAtTime",e,s),this._events.add({time:s,type:"setValueAtTime",value:i}),this._param.setValueAtTime(i,s),this}getValueAtTime(e){const t=Math.max(this.toSeconds(e),0),s=this._events.getAfter(t),i=this._events.get(t);let r=this._initialValue;if(i===null)r=this._initialValue;else if(i.type==="setTargetAtTime"&&(s===null||s.type==="setValueAtTime")){const o=this._events.getBefore(i.time);let a;o===null?a=this._initialValue:a=o.value,i.type==="setTargetAtTime"&&(r=this._exponentialApproach(i.time,a,i.value,i.constant,t))}else if(s===null)r=i.value;else if(s.type==="linearRampToValueAtTime"||s.type==="exponentialRampToValueAtTime"){let o=i.value;if(i.type==="setTargetAtTime"){const a=this._events.getBefore(i.time);a===null?o=this._initialValue:o=a.value}s.type==="linearRampToValueAtTime"?r=this._linearInterpolate(i.time,o,s.time,s.value,t):r=this._exponentialInterpolate(i.time,o,s.time,s.value,t)}else r=i.value;return this._toType(r)}setRampPoint(e){e=this.toSeconds(e);let t=this.getValueAtTime(e);return this.cancelAndHoldAtTime(e),this._fromType(t)===0&&(t=this._toType(this._minOutput)),this.setValueAtTime(t,e),this}linearRampToValueAtTime(e,t){const s=this._fromType(e),i=this.toSeconds(t);return $(isFinite(s)&&isFinite(i),`Invalid argument(s) to linearRampToValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._assertRange(s),this._events.add({time:i,type:"linearRampToValueAtTime",value:s}),this.log(this.units,"linearRampToValueAtTime",e,i),this._param.linearRampToValueAtTime(s,i),this}exponentialRampToValueAtTime(e,t){let s=this._fromType(e);s=Nt(s,0)?this._minOutput:s,this._assertRange(s);const i=this.toSeconds(t);return $(isFinite(s)&&isFinite(i),`Invalid argument(s) to exponentialRampToValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._events.add({time:i,type:"exponentialRampToValueAtTime",value:s}),this.log(this.units,"exponentialRampToValueAtTime",e,i),this._param.exponentialRampToValueAtTime(s,i),this}exponentialRampTo(e,t,s){return s=this.toSeconds(s),this.setRampPoint(s),this.exponentialRampToValueAtTime(e,s+this.toSeconds(t)),this}linearRampTo(e,t,s){return s=this.toSeconds(s),this.setRampPoint(s),this.linearRampToValueAtTime(e,s+this.toSeconds(t)),this}targetRampTo(e,t,s){return s=this.toSeconds(s),this.setRampPoint(s),this.exponentialApproachValueAtTime(e,s,t),this}exponentialApproachValueAtTime(e,t,s){t=this.toSeconds(t),s=this.toSeconds(s);const i=Math.log(s+1)/Math.log(200);return this.setTargetAtTime(e,t,i),this.cancelAndHoldAtTime(t+s*.9),this.linearRampToValueAtTime(e,t+s),this}setTargetAtTime(e,t,s){const i=this._fromType(e);$(isFinite(s)&&s>0,"timeConstant must be a number greater than 0");const r=this.toSeconds(t);return this._assertRange(i),$(isFinite(i)&&isFinite(r),`Invalid argument(s) to setTargetAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._events.add({constant:s,time:r,type:"setTargetAtTime",value:i}),this.log(this.units,"setTargetAtTime",e,r,s),this._param.setTargetAtTime(i,r,s),this}setValueCurveAtTime(e,t,s,i=1){s=this.toSeconds(s),t=this.toSeconds(t);const r=this._fromType(e[0])*i;this.setValueAtTime(this._toType(r),t);const o=s/(e.length-1);for(let a=1;a<e.length;a++){const c=this._fromType(e[a])*i;this.linearRampToValueAtTime(this._toType(c),t+a*o)}return this}cancelScheduledValues(e){const t=this.toSeconds(e);return $(isFinite(t),`Invalid argument to cancelScheduledValues: ${JSON.stringify(e)}`),this._events.cancel(t),this._param.cancelScheduledValues(t),this.log(this.units,"cancelScheduledValues",t),this}cancelAndHoldAtTime(e){const t=this.toSeconds(e),s=this._fromType(this.getValueAtTime(t));$(isFinite(t),`Invalid argument to cancelAndHoldAtTime: ${JSON.stringify(e)}`),this.log(this.units,"cancelAndHoldAtTime",t,"value="+s);const i=this._events.get(t),r=this._events.getAfter(t);return i&&Nt(i.time,t)?r?(this._param.cancelScheduledValues(r.time),this._events.cancel(r.time)):(this._param.cancelAndHoldAtTime(t),this._events.cancel(t+this.sampleTime)):r&&(this._param.cancelScheduledValues(r.time),this._events.cancel(r.time),r.type==="linearRampToValueAtTime"?this.linearRampToValueAtTime(this._toType(s),t):r.type==="exponentialRampToValueAtTime"&&this.exponentialRampToValueAtTime(this._toType(s),t)),this._events.add({time:t,type:"setValueAtTime",value:s}),this._param.setValueAtTime(s,t),this}rampTo(e,t=.1,s){return this.units==="frequency"||this.units==="bpm"||this.units==="decibels"?this.exponentialRampTo(e,t,s):this.linearRampTo(e,t,s),this}apply(e){const t=this.context.currentTime;e.setValueAtTime(this.getValueAtTime(t),t);const s=this._events.get(t);if(s&&s.type==="setTargetAtTime"){const i=this._events.getAfter(s.time),r=i?i.time:t+2,o=(r-t)/10;for(let a=t;a<r;a+=o)e.linearRampToValueAtTime(this.getValueAtTime(a),a)}return this._events.forEachAfter(this.context.currentTime,i=>{i.type==="cancelScheduledValues"?e.cancelScheduledValues(i.time):i.type==="setTargetAtTime"?e.setTargetAtTime(i.value,i.time,i.constant):e[i.type](i.value,i.time)}),this}setParam(e){$(this._swappable,"The Param must be assigned as 'swappable' in the constructor");const t=this.input;return t.disconnect(this._param),this.apply(e),this._param=e,t.connect(this._param),this}dispose(){return super.dispose(),this._events.dispose(),this}get defaultValue(){return this._toType(this._param.defaultValue)}_exponentialApproach(e,t,s,i,r){return s+(t-s)*Math.exp(-(r-e)/i)}_linearInterpolate(e,t,s,i,r){return t+(i-t)*((r-e)/(s-e))}_exponentialInterpolate(e,t,s,i,r){return t*Math.pow(i/t,(r-e)/(s-e))}}class G extends dt{constructor(){super(...arguments),this._internalChannels=[]}get numberOfInputs(){return J(this.input)?fn(this.input)||this.input instanceof he?1:this.input.numberOfInputs:0}get numberOfOutputs(){return J(this.output)?this.output.numberOfOutputs:0}_isAudioNode(e){return J(e)&&(e instanceof G||Is(e))}_getInternalNodes(){const e=this._internalChannels.slice(0);return this._isAudioNode(this.input)&&e.push(this.input),this._isAudioNode(this.output)&&this.input!==this.output&&e.push(this.output),e}_setChannelProperties(e){this._getInternalNodes().forEach(s=>{s.channelCount=e.channelCount,s.channelCountMode=e.channelCountMode,s.channelInterpretation=e.channelInterpretation})}_getChannelProperties(){const e=this._getInternalNodes();$(e.length>0,"ToneAudioNode does not have any internal nodes");const t=e[0];return{channelCount:t.channelCount,channelCountMode:t.channelCountMode,channelInterpretation:t.channelInterpretation}}get channelCount(){return this._getChannelProperties().channelCount}set channelCount(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelCount:e}))}get channelCountMode(){return this._getChannelProperties().channelCountMode}set channelCountMode(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelCountMode:e}))}get channelInterpretation(){return this._getChannelProperties().channelInterpretation}set channelInterpretation(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelInterpretation:e}))}connect(e,t=0,s=0){return Bs(this,e,t,s),this}toDestination(){return this.connect(this.context.destination),this}toMaster(){return vc("toMaster() has been renamed toDestination()"),this.toDestination()}disconnect(e,t=0,s=0){return ST(this,e,t,s),this}chain(...e){return Li(this,...e),this}fan(...e){return e.forEach(t=>this.connect(t)),this}dispose(){return super.dispose(),J(this.input)&&(this.input instanceof G?this.input.dispose():Is(this.input)&&this.input.disconnect()),J(this.output)&&(this.output instanceof G?this.output.dispose():Is(this.output)&&this.output.disconnect()),this._internalChannels=[],this}}function Li(...n){const e=n.shift();n.reduce((t,s)=>(t instanceof G?t.connect(s):Is(t)&&Bs(t,s),s),e)}function Bs(n,e,t=0,s=0){for($(J(n),"Cannot connect from undefined node"),$(J(e),"Cannot connect to undefined node"),(e instanceof G||Is(e))&&$(e.numberOfInputs>0,"Cannot connect to node with no inputs"),$(n.numberOfOutputs>0,"Cannot connect from node with no outputs");e instanceof G||e instanceof he;)J(e.input)&&(e=e.input);for(;n instanceof G;)J(n.output)&&(n=n.output);fn(e)?n.connect(e,t):n.connect(e,t,s)}function ST(n,e,t=0,s=0){if(J(e))for(;e instanceof G;)e=e.input;for(;!Is(n);)J(n.output)&&(n=n.output);fn(e)?n.disconnect(e,t):Is(e)?n.disconnect(e,t,s):n.disconnect()}class _e extends G{constructor(){super(N(_e.getDefaults(),arguments,["gain","units"])),this.name="Gain",this._gainNode=this.context.createGain(),this.input=this._gainNode,this.output=this._gainNode;const e=N(_e.getDefaults(),arguments,["gain","units"]);this.gain=new he({context:this.context,convert:e.convert,param:this._gainNode.gain,units:e.units,value:e.gain,minValue:e.minValue,maxValue:e.maxValue}),xe(this,"gain")}static getDefaults(){return Object.assign(G.getDefaults(),{convert:!0,gain:1,units:"gain"})}dispose(){return super.dispose(),this._gainNode.disconnect(),this.gain.dispose(),this}}class Xn extends G{constructor(e){super(e),this.onended=le,this._startTime=-1,this._stopTime=-1,this._timeout=-1,this.output=new _e({context:this.context,gain:0}),this._gainNode=this.output,this.getStateAtTime=function(t){const s=this.toSeconds(t);return this._startTime!==-1&&s>=this._startTime&&(this._stopTime===-1||s<=this._stopTime)?"started":"stopped"},this._fadeIn=e.fadeIn,this._fadeOut=e.fadeOut,this._curve=e.curve,this.onended=e.onended}static getDefaults(){return Object.assign(G.getDefaults(),{curve:"linear",fadeIn:0,fadeOut:0,onended:le})}_startGain(e,t=1){$(this._startTime===-1,"Source cannot be started more than once");const s=this.toSeconds(this._fadeIn);return this._startTime=e+s,this._startTime=Math.max(this._startTime,this.context.currentTime),s>0?(this._gainNode.gain.setValueAtTime(0,e),this._curve==="linear"?this._gainNode.gain.linearRampToValueAtTime(t,e+s):this._gainNode.gain.exponentialApproachValueAtTime(t,e,s)):this._gainNode.gain.setValueAtTime(t,e),this}stop(e){return this.log("stop",e),this._stopGain(this.toSeconds(e)),this}_stopGain(e){$(this._startTime!==-1,"'start' must be called before 'stop'"),this.cancelStop();const t=this.toSeconds(this._fadeOut);return this._stopTime=this.toSeconds(e)+t,this._stopTime=Math.max(this._stopTime,this.now()),t>0?this._curve==="linear"?this._gainNode.gain.linearRampTo(0,t,e):this._gainNode.gain.targetRampTo(0,t,e):(this._gainNode.gain.cancelAndHoldAtTime(e),this._gainNode.gain.setValueAtTime(0,e)),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout(()=>{const s=this._curve==="exponential"?t*2:0;this._stopSource(this.now()+s),this._onended()},this._stopTime-this.context.currentTime),this}_onended(){if(this.onended!==le&&(this.onended(this),this.onended=le,!this.context.isOffline)){const e=()=>this.dispose();typeof window.requestIdleCallback<"u"?window.requestIdleCallback(e):setTimeout(e,1e3)}}get state(){return this.getStateAtTime(this.now())}cancelStop(){return this.log("cancelStop"),$(this._startTime!==-1,"Source is not started"),this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this.context.clearTimeout(this._timeout),this._stopTime=-1,this}dispose(){return super.dispose(),this._gainNode.dispose(),this.onended=le,this}}class Qr extends Xn{constructor(){super(N(Qr.getDefaults(),arguments,["offset"])),this.name="ToneConstantSource",this._source=this.context.createConstantSource();const e=N(Qr.getDefaults(),arguments,["offset"]);Bs(this._source,this._gainNode),this.offset=new he({context:this.context,convert:e.convert,param:this._source.offset,units:e.units,value:e.offset,minValue:e.minValue,maxValue:e.maxValue})}static getDefaults(){return Object.assign(Xn.getDefaults(),{convert:!0,offset:1,units:"number"})}start(e){const t=this.toSeconds(e);return this.log("start",t),this._startGain(t),this._source.start(t),this}_stopSource(e){this._source.stop(e)}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._source.disconnect(),this.offset.dispose(),this}}class ye extends G{constructor(){super(N(ye.getDefaults(),arguments,["value","units"])),this.name="Signal",this.override=!0;const e=N(ye.getDefaults(),arguments,["value","units"]);this.output=this._constantSource=new Qr({context:this.context,convert:e.convert,offset:e.value,units:e.units,minValue:e.minValue,maxValue:e.maxValue}),this._constantSource.start(0),this.input=this._param=this._constantSource.offset}static getDefaults(){return Object.assign(G.getDefaults(),{convert:!0,units:"number",value:0})}connect(e,t=0,s=0){return Sc(this,e,t,s),this}dispose(){return super.dispose(),this._param.dispose(),this._constantSource.dispose(),this}setValueAtTime(e,t){return this._param.setValueAtTime(e,t),this}getValueAtTime(e){return this._param.getValueAtTime(e)}setRampPoint(e){return this._param.setRampPoint(e),this}linearRampToValueAtTime(e,t){return this._param.linearRampToValueAtTime(e,t),this}exponentialRampToValueAtTime(e,t){return this._param.exponentialRampToValueAtTime(e,t),this}exponentialRampTo(e,t,s){return this._param.exponentialRampTo(e,t,s),this}linearRampTo(e,t,s){return this._param.linearRampTo(e,t,s),this}targetRampTo(e,t,s){return this._param.targetRampTo(e,t,s),this}exponentialApproachValueAtTime(e,t,s){return this._param.exponentialApproachValueAtTime(e,t,s),this}setTargetAtTime(e,t,s){return this._param.setTargetAtTime(e,t,s),this}setValueCurveAtTime(e,t,s,i){return this._param.setValueCurveAtTime(e,t,s,i),this}cancelScheduledValues(e){return this._param.cancelScheduledValues(e),this}cancelAndHoldAtTime(e){return this._param.cancelAndHoldAtTime(e),this}rampTo(e,t,s){return this._param.rampTo(e,t,s),this}get value(){return this._param.value}set value(e){this._param.value=e}get convert(){return this._param.convert}set convert(e){this._param.convert=e}get units(){return this._param.units}get overridden(){return this._param.overridden}set overridden(e){this._param.overridden=e}get maxValue(){return this._param.maxValue}get minValue(){return this._param.minValue}apply(e){return this._param.apply(e),this}}function Sc(n,e,t,s){(e instanceof he||fn(e)||e instanceof ye&&e.override)&&(e.cancelScheduledValues(0),e.setValueAtTime(0,0),e instanceof ye&&(e.overridden=!0)),Bs(n,e,t,s)}class Kr extends he{constructor(){super(N(Kr.getDefaults(),arguments,["value"])),this.name="TickParam",this._events=new At(1/0),this._multiplier=1;const e=N(Kr.getDefaults(),arguments,["value"]);this._multiplier=e.multiplier,this._events.cancel(0),this._events.add({ticks:0,time:0,type:"setValueAtTime",value:this._fromType(e.value)}),this.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(he.getDefaults(),{multiplier:1,units:"hertz",value:1})}setTargetAtTime(e,t,s){t=this.toSeconds(t),this.setRampPoint(t);const i=this._fromType(e),r=this._events.get(t),o=Math.round(Math.max(1/s,1));for(let a=0;a<=o;a++){const c=s*a+t,l=this._exponentialApproach(r.time,r.value,i,s,c);this.linearRampToValueAtTime(this._toType(l),c)}return this}setValueAtTime(e,t){const s=this.toSeconds(t);super.setValueAtTime(e,t);const i=this._events.get(s),r=this._events.previousEvent(i),o=this._getTicksUntilEvent(r,s);return i.ticks=Math.max(o,0),this}linearRampToValueAtTime(e,t){const s=this.toSeconds(t);super.linearRampToValueAtTime(e,t);const i=this._events.get(s),r=this._events.previousEvent(i),o=this._getTicksUntilEvent(r,s);return i.ticks=Math.max(o,0),this}exponentialRampToValueAtTime(e,t){t=this.toSeconds(t);const s=this._fromType(e),i=this._events.get(t),r=Math.round(Math.max((t-i.time)*10,1)),o=(t-i.time)/r;for(let a=0;a<=r;a++){const c=o*a+i.time,l=this._exponentialInterpolate(i.time,i.value,t,s,c);this.linearRampToValueAtTime(this._toType(l),c)}return this}_getTicksUntilEvent(e,t){if(e===null)e={ticks:0,time:0,type:"setValueAtTime",value:0};else if(yt(e.ticks)){const o=this._events.previousEvent(e);e.ticks=this._getTicksUntilEvent(o,e.time)}const s=this._fromType(this.getValueAtTime(e.time));let i=this._fromType(this.getValueAtTime(t));const r=this._events.get(t);return r&&r.time===t&&r.type==="setValueAtTime"&&(i=this._fromType(this.getValueAtTime(t-this.sampleTime))),.5*(t-e.time)*(s+i)+e.ticks}getTicksAtTime(e){const t=this.toSeconds(e),s=this._events.get(t);return Math.max(this._getTicksUntilEvent(s,t),0)}getDurationOfTicks(e,t){const s=this.toSeconds(t),i=this.getTicksAtTime(t);return this.getTimeOfTick(i+e)-s}getTimeOfTick(e){const t=this._events.get(e,"ticks"),s=this._events.getAfter(e,"ticks");if(t&&t.ticks===e)return t.time;if(t&&s&&s.type==="linearRampToValueAtTime"&&t.value!==s.value){const i=this._fromType(this.getValueAtTime(t.time)),o=(this._fromType(this.getValueAtTime(s.time))-i)/(s.time-t.time),a=Math.sqrt(Math.pow(i,2)-2*o*(t.ticks-e)),c=(-i+a)/o,l=(-i-a)/o;return(c>0?c:l)+t.time}else return t?t.value===0?1/0:t.time+(e-t.ticks)/t.value:e/this._initialValue}ticksToTime(e,t){return this.getDurationOfTicks(e,t)}timeToTicks(e,t){const s=this.toSeconds(t),i=this.toSeconds(e),r=this.getTicksAtTime(s);return this.getTicksAtTime(s+i)-r}_fromType(e){return this.units==="bpm"&&this.multiplier?1/(60/e/this.multiplier):super._fromType(e)}_toType(e){return this.units==="bpm"&&this.multiplier?e/this.multiplier*60:super._toType(e)}get multiplier(){return this._multiplier}set multiplier(e){const t=this.value;this._multiplier=e,this.cancelScheduledValues(0),this.setValueAtTime(t,0)}}class Jr extends ye{constructor(){super(N(Jr.getDefaults(),arguments,["value"])),this.name="TickSignal";const e=N(Jr.getDefaults(),arguments,["value"]);this.input=this._param=new Kr({context:this.context,convert:e.convert,multiplier:e.multiplier,param:this._constantSource.offset,units:e.units,value:e.value})}static getDefaults(){return Object.assign(ye.getDefaults(),{multiplier:1,units:"hertz",value:1})}ticksToTime(e,t){return this._param.ticksToTime(e,t)}timeToTicks(e,t){return this._param.timeToTicks(e,t)}getTimeOfTick(e){return this._param.getTimeOfTick(e)}getDurationOfTicks(e,t){return this._param.getDurationOfTicks(e,t)}getTicksAtTime(e){return this._param.getTicksAtTime(e)}get multiplier(){return this._param.multiplier}set multiplier(e){this._param.multiplier=e}dispose(){return super.dispose(),this._param.dispose(),this}}class eo extends dt{constructor(){super(N(eo.getDefaults(),arguments,["frequency"])),this.name="TickSource",this._state=new wc,this._tickOffset=new At,this._ticksAtTime=new At,this._secondsAtTime=new At;const e=N(eo.getDefaults(),arguments,["frequency"]);this.frequency=new Jr({context:this.context,units:e.units,value:e.frequency}),xe(this,"frequency"),this._state.setStateAtTime("stopped",0),this.setTicksAtTime(0,0)}static getDefaults(){return Object.assign({frequency:1,units:"hertz"},dt.getDefaults())}get state(){return this.getStateAtTime(this.now())}start(e,t){const s=this.toSeconds(e);return this._state.getValueAtTime(s)!=="started"&&(this._state.setStateAtTime("started",s),J(t)&&this.setTicksAtTime(t,s),this._ticksAtTime.cancel(s),this._secondsAtTime.cancel(s)),this}stop(e){const t=this.toSeconds(e);if(this._state.getValueAtTime(t)==="stopped"){const s=this._state.get(t);s&&s.time>0&&(this._tickOffset.cancel(s.time),this._state.cancel(s.time))}return this._state.cancel(t),this._state.setStateAtTime("stopped",t),this.setTicksAtTime(0,t),this._ticksAtTime.cancel(t),this._secondsAtTime.cancel(t),this}pause(e){const t=this.toSeconds(e);return this._state.getValueAtTime(t)==="started"&&(this._state.setStateAtTime("paused",t),this._ticksAtTime.cancel(t),this._secondsAtTime.cancel(t)),this}cancel(e){return e=this.toSeconds(e),this._state.cancel(e),this._tickOffset.cancel(e),this._ticksAtTime.cancel(e),this._secondsAtTime.cancel(e),this}getTicksAtTime(e){const t=this.toSeconds(e),s=this._state.getLastState("stopped",t),i=this._ticksAtTime.get(t),r={state:"paused",time:t};this._state.add(r);let o=i||s,a=i?i.ticks:0,c=null;return this._state.forEachBetween(o.time,t+this.sampleTime,l=>{let u=o.time;const h=this._tickOffset.get(l.time);h&&h.time>=o.time&&(a=h.ticks,u=h.time),o.state==="started"&&l.state!=="started"&&(a+=this.frequency.getTicksAtTime(l.time)-this.frequency.getTicksAtTime(u),l.time!=r.time&&(c={state:l.state,time:l.time,ticks:a})),o=l}),this._state.remove(r),c&&this._ticksAtTime.add(c),a}get ticks(){return this.getTicksAtTime(this.now())}set ticks(e){this.setTicksAtTime(e,this.now())}get seconds(){return this.getSecondsAtTime(this.now())}set seconds(e){const t=this.now(),s=this.frequency.timeToTicks(e,t);this.setTicksAtTime(s,t)}getSecondsAtTime(e){e=this.toSeconds(e);const t=this._state.getLastState("stopped",e),s={state:"paused",time:e};this._state.add(s);const i=this._secondsAtTime.get(e);let r=i||t,o=i?i.seconds:0,a=null;return this._state.forEachBetween(r.time,e+this.sampleTime,c=>{let l=r.time;const u=this._tickOffset.get(c.time);u&&u.time>=r.time&&(o=u.seconds,l=u.time),r.state==="started"&&c.state!=="started"&&(o+=c.time-l,c.time!=s.time&&(a={state:c.state,time:c.time,seconds:o})),r=c}),this._state.remove(s),a&&this._secondsAtTime.add(a),o}setTicksAtTime(e,t){return t=this.toSeconds(t),this._tickOffset.cancel(t),this._tickOffset.add({seconds:this.frequency.getDurationOfTicks(e,t),ticks:e,time:t}),this._ticksAtTime.cancel(t),this._secondsAtTime.cancel(t),this}getStateAtTime(e){return e=this.toSeconds(e),this._state.getValueAtTime(e)}getTimeOfTick(e,t=this.now()){const s=this._tickOffset.get(t),i=this._state.get(t),r=Math.max(s.time,i.time),o=this.frequency.getTicksAtTime(r)+e-s.ticks;return this.frequency.getTimeOfTick(o)}forEachTickBetween(e,t,s){let i=this._state.get(e);this._state.forEachBetween(e,t,o=>{i&&i.state==="started"&&o.state!=="started"&&this.forEachTickBetween(Math.max(i.time,e),o.time-this.sampleTime,s),i=o});let r=null;if(i&&i.state==="started"){const o=Math.max(i.time,e),a=this.frequency.getTicksAtTime(o),c=this.frequency.getTicksAtTime(i.time),l=a-c;let u=Math.ceil(l)-l;u=Nt(u,1)?0:u;let h=this.frequency.getTimeOfTick(a+u);for(;h<t;){try{s(h,Math.round(this.getTicksAtTime(h)))}catch(d){r=d;break}h+=this.frequency.getDurationOfTicks(1,h)}}if(r)throw r;return this}dispose(){return super.dispose(),this._state.dispose(),this._tickOffset.dispose(),this._ticksAtTime.dispose(),this._secondsAtTime.dispose(),this.frequency.dispose(),this}}class Bi extends dt{constructor(){super(N(Bi.getDefaults(),arguments,["callback","frequency"])),this.name="Clock",this.callback=le,this._lastUpdate=0,this._state=new wc("stopped"),this._boundLoop=this._loop.bind(this);const e=N(Bi.getDefaults(),arguments,["callback","frequency"]);this.callback=e.callback,this._tickSource=new eo({context:this.context,frequency:e.frequency,units:e.units}),this._lastUpdate=0,this.frequency=this._tickSource.frequency,xe(this,"frequency"),this._state.setStateAtTime("stopped",0),this.context.on("tick",this._boundLoop)}static getDefaults(){return Object.assign(dt.getDefaults(),{callback:le,frequency:1,units:"hertz"})}get state(){return this._state.getValueAtTime(this.now())}start(e,t){qh(this.context);const s=this.toSeconds(e);return this.log("start",s),this._state.getValueAtTime(s)!=="started"&&(this._state.setStateAtTime("started",s),this._tickSource.start(s,t),s<this._lastUpdate&&this.emit("start",s,t)),this}stop(e){const t=this.toSeconds(e);return this.log("stop",t),this._state.cancel(t),this._state.setStateAtTime("stopped",t),this._tickSource.stop(t),t<this._lastUpdate&&this.emit("stop",t),this}pause(e){const t=this.toSeconds(e);return this._state.getValueAtTime(t)==="started"&&(this._state.setStateAtTime("paused",t),this._tickSource.pause(t),t<this._lastUpdate&&this.emit("pause",t)),this}get ticks(){return Math.ceil(this.getTicksAtTime(this.now()))}set ticks(e){this._tickSource.ticks=e}get seconds(){return this._tickSource.seconds}set seconds(e){this._tickSource.seconds=e}getSecondsAtTime(e){return this._tickSource.getSecondsAtTime(e)}setTicksAtTime(e,t){return this._tickSource.setTicksAtTime(e,t),this}getTimeOfTick(e,t=this.now()){return this._tickSource.getTimeOfTick(e,t)}getTicksAtTime(e){return this._tickSource.getTicksAtTime(e)}nextTickTime(e,t){const s=this.toSeconds(t),i=this.getTicksAtTime(s);return this._tickSource.getTimeOfTick(i+e,s)}_loop(){const e=this._lastUpdate,t=this.now();this._lastUpdate=t,this.log("loop",e,t),e!==t&&(this._state.forEachBetween(e,t,s=>{switch(s.state){case"started":const i=this._tickSource.getTicksAtTime(s.time);this.emit("start",s.time,i);break;case"stopped":s.time!==0&&this.emit("stop",s.time);break;case"paused":this.emit("pause",s.time);break}}),this._tickSource.forEachTickBetween(e,t,(s,i)=>{this.callback(s,i)}))}getStateAtTime(e){const t=this.toSeconds(e);return this._state.getValueAtTime(t)}dispose(){return super.dispose(),this.context.off("tick",this._boundLoop),this._tickSource.dispose(),this._state.dispose(),this}}hr.mixin(Bi);class bc extends xs{constructor(){super(),this.name="ToneAudioBuffers",this._buffers=new Map,this._loadingCount=0;const e=N(bc.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");this.baseUrl=e.baseUrl,Object.keys(e.urls).forEach(t=>{this._loadingCount++;const s=e.urls[t];this.add(t,s,this._bufferLoaded.bind(this,e.onload),e.onerror)})}static getDefaults(){return{baseUrl:"",onerror:le,onload:le,urls:{}}}has(e){return this._buffers.has(e.toString())}get(e){return $(this.has(e),`ToneAudioBuffers has no buffer named: ${e}`),this._buffers.get(e.toString())}_bufferLoaded(e){this._loadingCount--,this._loadingCount===0&&e&&e()}get loaded(){return Array.from(this._buffers).every(([e,t])=>t.loaded)}add(e,t,s=le,i=le){return _s(t)?(this.baseUrl&&t.trim().substring(0,11).toLowerCase()==="data:audio/"&&(this.baseUrl=""),this._buffers.set(e.toString(),new ue(this.baseUrl+t,s,i))):this._buffers.set(e.toString(),new ue(t,s,i)),this}dispose(){return super.dispose(),this._buffers.forEach(e=>e.dispose()),this._buffers.clear(),this}}class Pn extends Ei{constructor(){super(...arguments),this.name="Ticks",this.defaultUnits="i"}_now(){return this.context.transport.ticks}_beatsToUnits(e){return this._getPPQ()*e}_secondsToUnits(e){return Math.floor(e/(60/this._getBpm())*this._getPPQ())}_ticksToUnits(e){return e}toTicks(){return this.valueOf()}toSeconds(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())}}class bT extends dt{constructor(){super(...arguments),this.name="Draw",this.expiration=.25,this.anticipation=.008,this._events=new At,this._boundDrawLoop=this._drawLoop.bind(this),this._animationFrame=-1}schedule(e,t){return this._events.add({callback:e,time:this.toSeconds(t)}),this._events.length===1&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop)),this}cancel(e){return this._events.cancel(this.toSeconds(e)),this}_drawLoop(){const e=this.context.currentTime;for(;this._events.length&&this._events.peek().time-this.anticipation<=e;){const t=this._events.shift();t&&e-t.time<=this.expiration&&t.callback()}this._events.length>0&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop))}dispose(){return super.dispose(),this._events.dispose(),cancelAnimationFrame(this._animationFrame),this}}bo(n=>{n.draw=new bT({context:n})});Co(n=>{n.draw.dispose()});class CT extends xs{constructor(){super(...arguments),this.name="IntervalTimeline",this._root=null,this._length=0}add(e){$(J(e.time),"Events must have a time property"),$(J(e.duration),"Events must have a duration parameter"),e.time=e.time.valueOf();let t=new ET(e.time,e.time+e.duration,e);for(this._root===null?this._root=t:this._root.insert(t),this._length++;t!==null;)t.updateHeight(),t.updateMax(),this._rebalance(t),t=t.parent;return this}remove(e){if(this._root!==null){const t=[];this._root.search(e.time,t);for(const s of t)if(s.event===e){this._removeNode(s),this._length--;break}}return this}get length(){return this._length}cancel(e){return this.forEachFrom(e,t=>this.remove(t)),this}_setRoot(e){this._root=e,this._root!==null&&(this._root.parent=null)}_replaceNodeInParent(e,t){e.parent!==null?(e.isLeftChild()?e.parent.left=t:e.parent.right=t,this._rebalance(e.parent)):this._setRoot(t)}_removeNode(e){if(e.left===null&&e.right===null)this._replaceNodeInParent(e,null);else if(e.right===null)this._replaceNodeInParent(e,e.left);else if(e.left===null)this._replaceNodeInParent(e,e.right);else{const t=e.getBalance();let s,i=null;if(t>0)if(e.left.right===null)s=e.left,s.right=e.right,i=s;else{for(s=e.left.right;s.right!==null;)s=s.right;s.parent&&(s.parent.right=s.left,i=s.parent,s.left=e.left,s.right=e.right)}else if(e.right.left===null)s=e.right,s.left=e.left,i=s;else{for(s=e.right.left;s.left!==null;)s=s.left;s.parent&&(s.parent.left=s.right,i=s.parent,s.left=e.left,s.right=e.right)}e.parent!==null?e.isLeftChild()?e.parent.left=s:e.parent.right=s:this._setRoot(s),i&&this._rebalance(i)}e.dispose()}_rotateLeft(e){const t=e.parent,s=e.isLeftChild(),i=e.right;i&&(e.right=i.left,i.left=e),t!==null?s?t.left=i:t.right=i:this._setRoot(i)}_rotateRight(e){const t=e.parent,s=e.isLeftChild(),i=e.left;i&&(e.left=i.right,i.right=e),t!==null?s?t.left=i:t.right=i:this._setRoot(i)}_rebalance(e){const t=e.getBalance();t>1&&e.left?e.left.getBalance()<0?this._rotateLeft(e.left):this._rotateRight(e):t<-1&&e.right&&(e.right.getBalance()>0?this._rotateRight(e.right):this._rotateLeft(e))}get(e){if(this._root!==null){const t=[];if(this._root.search(e,t),t.length>0){let s=t[0];for(let i=1;i<t.length;i++)t[i].low>s.low&&(s=t[i]);return s.event}}return null}forEach(e){if(this._root!==null){const t=[];this._root.traverse(s=>t.push(s)),t.forEach(s=>{s.event&&e(s.event)})}return this}forEachAtTime(e,t){if(this._root!==null){const s=[];this._root.search(e,s),s.forEach(i=>{i.event&&t(i.event)})}return this}forEachFrom(e,t){if(this._root!==null){const s=[];this._root.searchAfter(e,s),s.forEach(i=>{i.event&&t(i.event)})}return this}dispose(){return super.dispose(),this._root!==null&&this._root.traverse(e=>e.dispose()),this._root=null,this}}class ET{constructor(e,t,s){this._left=null,this._right=null,this.parent=null,this.height=0,this.event=s,this.low=e,this.high=t,this.max=this.high}insert(e){e.low<=this.low?this.left===null?this.left=e:this.left.insert(e):this.right===null?this.right=e:this.right.insert(e)}search(e,t){e>this.max||(this.left!==null&&this.left.search(e,t),this.low<=e&&this.high>e&&t.push(this),!(this.low>e)&&this.right!==null&&this.right.search(e,t))}searchAfter(e,t){this.low>=e&&(t.push(this),this.left!==null&&this.left.searchAfter(e,t)),this.right!==null&&this.right.searchAfter(e,t)}traverse(e){e(this),this.left!==null&&this.left.traverse(e),this.right!==null&&this.right.traverse(e)}updateHeight(){this.left!==null&&this.right!==null?this.height=Math.max(this.left.height,this.right.height)+1:this.right!==null?this.height=this.right.height+1:this.left!==null?this.height=this.left.height+1:this.height=0}updateMax(){this.max=this.high,this.left!==null&&(this.max=Math.max(this.max,this.left.max)),this.right!==null&&(this.max=Math.max(this.max,this.right.max))}getBalance(){let e=0;return this.left!==null&&this.right!==null?e=this.left.height-this.right.height:this.left!==null?e=this.left.height+1:this.right!==null&&(e=-(this.right.height+1)),e}isLeftChild(){return this.parent!==null&&this.parent.left===this}get left(){return this._left}set left(e){this._left=e,e!==null&&(e.parent=this),this.updateHeight(),this.updateMax()}get right(){return this._right}set right(e){this._right=e,e!==null&&(e.parent=this),this.updateHeight(),this.updateMax()}dispose(){this.parent=null,this._left=null,this._right=null,this.event=null}}class zs extends G{constructor(){super(N(zs.getDefaults(),arguments,["volume"])),this.name="Volume";const e=N(zs.getDefaults(),arguments,["volume"]);this.input=this.output=new _e({context:this.context,gain:e.volume,units:"decibels"}),this.volume=this.output.gain,xe(this,"volume"),this._unmutedVolume=e.volume,this.mute=e.mute}static getDefaults(){return Object.assign(G.getDefaults(),{mute:!1,volume:0})}get mute(){return this.volume.value===-1/0}set mute(e){!this.mute&&e?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!e&&(this.volume.value=this._unmutedVolume)}dispose(){return super.dispose(),this.input.dispose(),this.volume.dispose(),this}}let OT=class Da extends G{constructor(){super(N(Da.getDefaults(),arguments)),this.name="Destination",this.input=new zs({context:this.context}),this.output=new _e({context:this.context}),this.volume=this.input.volume;const e=N(Da.getDefaults(),arguments);Li(this.input,this.output,this.context.rawContext.destination),this.mute=e.mute,this._internalChannels=[this.input,this.context.rawContext.destination,this.output]}static getDefaults(){return Object.assign(G.getDefaults(),{mute:!1,volume:0})}get mute(){return this.input.mute}set mute(e){this.input.mute=e}chain(...e){return this.input.disconnect(),e.unshift(this.input),e.push(this.output),Li(...e),this}get maxChannelCount(){return this.context.rawContext.destination.maxChannelCount}dispose(){return super.dispose(),this.volume.dispose(),this}};bo(n=>{n.destination=new OT({context:n})});Co(n=>{n.destination.dispose()});class AT extends xs{constructor(e){super(),this.name="TimelineValue",this._timeline=new At({memory:10}),this._initialValue=e}set(e,t){return this._timeline.add({value:e,time:t}),this}get(e){const t=this._timeline.get(e);return t?t.value:this._initialValue}}class gs extends G{constructor(){super(Object.assign(N(gs.getDefaults(),arguments,["context"])))}connect(e,t=0,s=0){return Sc(this,e,t,s),this}}class pn extends gs{constructor(){super(Object.assign(N(pn.getDefaults(),arguments,["mapping","length"]))),this.name="WaveShaper",this._shaper=this.context.createWaveShaper(),this.input=this._shaper,this.output=this._shaper;const e=N(pn.getDefaults(),arguments,["mapping","length"]);Ut(e.mapping)||e.mapping instanceof Float32Array?this.curve=Float32Array.from(e.mapping):Qy(e.mapping)&&this.setMap(e.mapping,e.length)}static getDefaults(){return Object.assign(ye.getDefaults(),{length:1024})}setMap(e,t=1024){const s=new Float32Array(t);for(let i=0,r=t;i<r;i++){const o=i/(r-1)*2-1;s[i]=e(o,i)}return this.curve=s,this}get curve(){return this._shaper.curve}set curve(e){this._shaper.curve=e}get oversample(){return this._shaper.oversample}set oversample(e){const t=["none","2x","4x"].some(s=>s.includes(e));$(t,"oversampling must be either 'none', '2x', or '4x'"),this._shaper.oversample=e}dispose(){return super.dispose(),this._shaper.disconnect(),this}}class zi extends gs{constructor(){super(Object.assign(N(zi.getDefaults(),arguments,["value"]))),this.name="Pow";const e=N(zi.getDefaults(),arguments,["value"]);this._exponentScaler=this.input=this.output=new pn({context:this.context,mapping:this._expFunc(e.value),length:8192}),this._exponent=e.value}static getDefaults(){return Object.assign(gs.getDefaults(),{value:1})}_expFunc(e){return t=>Math.pow(Math.abs(t),e)}get value(){return this._exponent}set value(e){this._exponent=e,this._exponentScaler.setMap(this._expFunc(this._exponent))}dispose(){return super.dispose(),this._exponentScaler.dispose(),this}}class Vs{constructor(e,t){this.id=Vs._eventId++,this._remainderTime=0;const s=Object.assign(Vs.getDefaults(),t);this.transport=e,this.callback=s.callback,this._once=s.once,this.time=Math.floor(s.time),this._remainderTime=s.time-this.time}static getDefaults(){return{callback:le,once:!1,time:0}}get floatTime(){return this.time+this._remainderTime}invoke(e){if(this.callback){const t=this.transport.bpm.getDurationOfTicks(1,e);this.callback(e+this._remainderTime*t),this._once&&this.transport.clear(this.id)}}dispose(){return this.callback=void 0,this}}Vs._eventId=0;class Cc extends Vs{constructor(e,t){super(e,t),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this);const s=Object.assign(Cc.getDefaults(),t);this.duration=s.duration,this._interval=s.interval,this._nextTick=s.time,this.transport.on("start",this._boundRestart),this.transport.on("loopStart",this._boundRestart),this.transport.on("ticks",this._boundRestart),this.context=this.transport.context,this._restart()}static getDefaults(){return Object.assign({},Vs.getDefaults(),{duration:1/0,interval:1,once:!1})}invoke(e){this._createEvents(e),super.invoke(e)}_createEvent(){return $r(this._nextTick,this.floatTime+this.duration)?this.transport.scheduleOnce(this.invoke.bind(this),new Pn(this.context,this._nextTick).toSeconds()):-1}_createEvents(e){$r(this._nextTick+this._interval,this.floatTime+this.duration)&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new Pn(this.context,this._nextTick).toSeconds()))}_restart(e){this.transport.clear(this._currentId),this.transport.clear(this._nextId),this._nextTick=this.floatTime;const t=this.transport.getTicksAtTime(e);Zn(t,this.time)&&(this._nextTick=this.floatTime+Math.ceil((t-this.floatTime)/this._interval)*this._interval),this._currentId=this._createEvent(),this._nextTick+=this._interval,this._nextId=this._createEvent()}dispose(){return super.dispose(),this.transport.clear(this._currentId),this.transport.clear(this._nextId),this.transport.off("start",this._boundRestart),this.transport.off("loopStart",this._boundRestart),this.transport.off("ticks",this._boundRestart),this}}class Vi extends dt{constructor(){super(N(Vi.getDefaults(),arguments)),this.name="Transport",this._loop=new AT(!1),this._loopStart=0,this._loopEnd=0,this._scheduledEvents={},this._timeline=new At,this._repeatedEvents=new CT,this._syncedSignals=[],this._swingAmount=0;const e=N(Vi.getDefaults(),arguments);this._ppq=e.ppq,this._clock=new Bi({callback:this._processTick.bind(this),context:this.context,frequency:0,units:"bpm"}),this._bindClockEvents(),this.bpm=this._clock.frequency,this._clock.frequency.multiplier=e.ppq,this.bpm.setValueAtTime(e.bpm,0),xe(this,"bpm"),this._timeSignature=e.timeSignature,this._swingTicks=e.ppq/2}static getDefaults(){return Object.assign(dt.getDefaults(),{bpm:120,loopEnd:"4m",loopStart:0,ppq:192,swing:0,swingSubdivision:"8n",timeSignature:4})}_processTick(e,t){if(this._loop.get(e)&&t>=this._loopEnd&&(this.emit("loopEnd",e),this._clock.setTicksAtTime(this._loopStart,e),t=this._loopStart,this.emit("loopStart",e,this._clock.getSecondsAtTime(e)),this.emit("loop",e)),this._swingAmount>0&&t%this._ppq!==0&&t%(this._swingTicks*2)!==0){const s=t%(this._swingTicks*2)/(this._swingTicks*2),i=Math.sin(s*Math.PI)*this._swingAmount;e+=new Pn(this.context,this._swingTicks*2/3).toSeconds()*i}Al(!0),this._timeline.forEachAtTime(t,s=>s.invoke(e)),Al(!1)}schedule(e,t){const s=new Vs(this,{callback:e,time:new Ei(this.context,t).toTicks()});return this._addEvent(s,this._timeline)}scheduleRepeat(e,t,s,i=1/0){const r=new Cc(this,{callback:e,duration:new Ft(this.context,i).toTicks(),interval:new Ft(this.context,t).toTicks(),time:new Ei(this.context,s).toTicks()});return this._addEvent(r,this._repeatedEvents)}scheduleOnce(e,t){const s=new Vs(this,{callback:e,once:!0,time:new Ei(this.context,t).toTicks()});return this._addEvent(s,this._timeline)}clear(e){if(this._scheduledEvents.hasOwnProperty(e)){const t=this._scheduledEvents[e.toString()];t.timeline.remove(t.event),t.event.dispose(),delete this._scheduledEvents[e.toString()]}return this}_addEvent(e,t){return this._scheduledEvents[e.id.toString()]={event:e,timeline:t},t.add(e),e.id}cancel(e=0){const t=this.toTicks(e);return this._timeline.forEachFrom(t,s=>this.clear(s.id)),this._repeatedEvents.forEachFrom(t,s=>this.clear(s.id)),this}_bindClockEvents(){this._clock.on("start",(e,t)=>{t=new Pn(this.context,t).toSeconds(),this.emit("start",e,t)}),this._clock.on("stop",e=>{this.emit("stop",e)}),this._clock.on("pause",e=>{this.emit("pause",e)})}get state(){return this._clock.getStateAtTime(this.now())}start(e,t){this.context.resume();let s;return J(t)&&(s=this.toTicks(t)),this._clock.start(e,s),this}stop(e){return this._clock.stop(e),this}pause(e){return this._clock.pause(e),this}toggle(e){return e=this.toSeconds(e),this._clock.getStateAtTime(e)!=="started"?this.start(e):this.stop(e),this}get timeSignature(){return this._timeSignature}set timeSignature(e){Ut(e)&&(e=e[0]/e[1]*4),this._timeSignature=e}get loopStart(){return new Ft(this.context,this._loopStart,"i").toSeconds()}set loopStart(e){this._loopStart=this.toTicks(e)}get loopEnd(){return new Ft(this.context,this._loopEnd,"i").toSeconds()}set loopEnd(e){this._loopEnd=this.toTicks(e)}get loop(){return this._loop.get(this.now())}set loop(e){this._loop.set(e,this.now())}setLoopPoints(e,t){return this.loopStart=e,this.loopEnd=t,this}get swing(){return this._swingAmount}set swing(e){this._swingAmount=e}get swingSubdivision(){return new Pn(this.context,this._swingTicks).toNotation()}set swingSubdivision(e){this._swingTicks=this.toTicks(e)}get position(){const e=this.now(),t=this._clock.getTicksAtTime(e);return new Pn(this.context,t).toBarsBeatsSixteenths()}set position(e){const t=this.toTicks(e);this.ticks=t}get seconds(){return this._clock.seconds}set seconds(e){const t=this.now(),s=this._clock.frequency.timeToTicks(e,t);this.ticks=s}get progress(){if(this.loop){const e=this.now();return(this._clock.getTicksAtTime(e)-this._loopStart)/(this._loopEnd-this._loopStart)}else return 0}get ticks(){return this._clock.ticks}set ticks(e){if(this._clock.ticks!==e){const t=this.now();if(this.state==="started"){const s=this._clock.getTicksAtTime(t),i=this._clock.frequency.getDurationOfTicks(Math.ceil(s)-s,t),r=t+i;this.emit("stop",r),this._clock.setTicksAtTime(e,r),this.emit("start",r,this._clock.getSecondsAtTime(r))}else this.emit("ticks",t),this._clock.setTicksAtTime(e,t)}}getTicksAtTime(e){return this._clock.getTicksAtTime(e)}getSecondsAtTime(e){return this._clock.getSecondsAtTime(e)}get PPQ(){return this._clock.frequency.multiplier}set PPQ(e){this._clock.frequency.multiplier=e}nextSubdivision(e){if(e=this.toTicks(e),this.state!=="started")return 0;{const t=this.now(),s=this.getTicksAtTime(t),i=e-s%e;return this._clock.nextTickTime(i,t)}}syncSignal(e,t){const s=this.now();let i=this.bpm,r=1/(60/i.getValueAtTime(s)/this.PPQ),o=[];if(e.units==="time"){const c=.015625/r,l=new _e(c),u=new zi(-1),h=new _e(c);i.chain(l,u,h),i=h,r=1/r,o=[l,u,h]}t||(e.getValueAtTime(s)!==0?t=e.getValueAtTime(s)/r:t=0);const a=new _e(t);return i.connect(a),a.connect(e._param),o.push(a),this._syncedSignals.push({initial:e.value,nodes:o,signal:e}),e.value=0,this}unsyncSignal(e){for(let t=this._syncedSignals.length-1;t>=0;t--){const s=this._syncedSignals[t];s.signal===e&&(s.nodes.forEach(i=>i.dispose()),s.signal.value=s.initial,this._syncedSignals.splice(t,1))}return this}dispose(){return super.dispose(),this._clock.dispose(),Tc(this,"bpm"),this._timeline.dispose(),this._repeatedEvents.dispose(),this}}hr.mixin(Vi);bo(n=>{n.transport=new Vi({context:n})});Co(n=>{n.transport.dispose()});class Qe extends G{constructor(e){super(e),this.input=void 0,this._state=new wc("stopped"),this._synced=!1,this._scheduled=[],this._syncedStart=le,this._syncedStop=le,this._state.memory=100,this._state.increasing=!0,this._volume=this.output=new zs({context:this.context,mute:e.mute,volume:e.volume}),this.volume=this._volume.volume,xe(this,"volume"),this.onstop=e.onstop}static getDefaults(){return Object.assign(G.getDefaults(),{mute:!1,onstop:le,volume:0})}get state(){return this._synced?this.context.transport.state==="started"?this._state.getValueAtTime(this.context.transport.seconds):"stopped":this._state.getValueAtTime(this.now())}get mute(){return this._volume.mute}set mute(e){this._volume.mute=e}_clampToCurrentTime(e){return this._synced?e:Math.max(e,this.context.currentTime)}start(e,t,s){let i=yt(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(i=this._clampToCurrentTime(i),!this._synced&&this._state.getValueAtTime(i)==="started")$(Zn(i,this._state.get(i).time),"Start time must be strictly greater than previous start time"),this._state.cancel(i),this._state.setStateAtTime("started",i),this.log("restart",i),this.restart(i,t,s);else if(this.log("start",i),this._state.setStateAtTime("started",i),this._synced){const r=this._state.get(i);r&&(r.offset=this.toSeconds(Ln(t,0)),r.duration=s?this.toSeconds(s):void 0);const o=this.context.transport.schedule(a=>{this._start(a,t,s)},i);this._scheduled.push(o),this.context.transport.state==="started"&&this.context.transport.getSecondsAtTime(this.immediate())>i&&this._syncedStart(this.now(),this.context.transport.seconds)}else qh(this.context),this._start(i,t,s);return this}stop(e){let t=yt(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(t=this._clampToCurrentTime(t),this._state.getValueAtTime(t)==="started"||J(this._state.getNextState("started",t))){if(this.log("stop",t),!this._synced)this._stop(t);else{const s=this.context.transport.schedule(this._stop.bind(this),t);this._scheduled.push(s)}this._state.cancel(t),this._state.setStateAtTime("stopped",t)}return this}restart(e,t,s){return e=this.toSeconds(e),this._state.getValueAtTime(e)==="started"&&(this._state.cancel(e),this._restart(e,t,s)),this}sync(){return this._synced||(this._synced=!0,this._syncedStart=(e,t)=>{if(Zn(t,0)){const s=this._state.get(t);if(s&&s.state==="started"&&s.time!==t){const i=t-this.toSeconds(s.time);let r;s.duration&&(r=this.toSeconds(s.duration)-i),this._start(e,this.toSeconds(s.offset)+i,r)}}},this._syncedStop=e=>{const t=this.context.transport.getSecondsAtTime(Math.max(e-this.sampleTime,0));this._state.getValueAtTime(t)==="started"&&this._stop(e)},this.context.transport.on("start",this._syncedStart),this.context.transport.on("loopStart",this._syncedStart),this.context.transport.on("stop",this._syncedStop),this.context.transport.on("pause",this._syncedStop),this.context.transport.on("loopEnd",this._syncedStop)),this}unsync(){return this._synced&&(this.context.transport.off("stop",this._syncedStop),this.context.transport.off("pause",this._syncedStop),this.context.transport.off("loopEnd",this._syncedStop),this.context.transport.off("start",this._syncedStart),this.context.transport.off("loopStart",this._syncedStart)),this._synced=!1,this._scheduled.forEach(e=>this.context.transport.clear(e)),this._scheduled=[],this._state.cancel(0),this._stop(0),this}dispose(){return super.dispose(),this.onstop=le,this.unsync(),this._volume.dispose(),this._state.dispose(),this}}class $n extends Xn{constructor(){super(N($n.getDefaults(),arguments,["url","onload"])),this.name="ToneBufferSource",this._source=this.context.createBufferSource(),this._internalChannels=[this._source],this._sourceStarted=!1,this._sourceStopped=!1;const e=N($n.getDefaults(),arguments,["url","onload"]);Bs(this._source,this._gainNode),this._source.onended=()=>this._stopSource(),this.playbackRate=new he({context:this.context,param:this._source.playbackRate,units:"positive",value:e.playbackRate}),this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this._buffer=new ue(e.url,e.onload,e.onerror),this._internalChannels.push(this._source)}static getDefaults(){return Object.assign(Xn.getDefaults(),{url:new ue,loop:!1,loopEnd:0,loopStart:0,onload:le,onerror:le,playbackRate:1})}get fadeIn(){return this._fadeIn}set fadeIn(e){this._fadeIn=e}get fadeOut(){return this._fadeOut}set fadeOut(e){this._fadeOut=e}get curve(){return this._curve}set curve(e){this._curve=e}start(e,t,s,i=1){$(this.buffer.loaded,"buffer is either not set or not loaded");const r=this.toSeconds(e);this._startGain(r,i),this.loop?t=Ln(t,this.loopStart):t=Ln(t,0);let o=Math.max(this.toSeconds(t),0);if(this.loop){const a=this.toSeconds(this.loopEnd)||this.buffer.duration,c=this.toSeconds(this.loopStart),l=a-c;Aa(o,a)&&(o=(o-c)%l+c),Nt(o,this.buffer.duration)&&(o=0)}if(this._source.buffer=this.buffer.get(),this._source.loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,$r(o,this.buffer.duration)&&(this._sourceStarted=!0,this._source.start(r,o)),J(s)){let a=this.toSeconds(s);a=Math.max(a,0),this.stop(r+a)}return this}_stopSource(e){!this._sourceStopped&&this._sourceStarted&&(this._sourceStopped=!0,this._source.stop(this.toSeconds(e)),this._onended())}get loopStart(){return this._source.loopStart}set loopStart(e){this._source.loopStart=this.toSeconds(e)}get loopEnd(){return this._source.loopEnd}set loopEnd(e){this._source.loopEnd=this.toSeconds(e)}get buffer(){return this._buffer}set buffer(e){this._buffer.set(e)}get loop(){return this._source.loop}set loop(e){this._source.loop=e,this._sourceStarted&&this.cancelStop()}dispose(){return super.dispose(),this._source.onended=null,this._source.disconnect(),this._buffer.dispose(),this.playbackRate.dispose(),this}}class Hi extends Qe{constructor(){super(N(Hi.getDefaults(),arguments,["type"])),this.name="Noise",this._source=null;const e=N(Hi.getDefaults(),arguments,["type"]);this._playbackRate=e.playbackRate,this.type=e.type,this._fadeIn=e.fadeIn,this._fadeOut=e.fadeOut}static getDefaults(){return Object.assign(Qe.getDefaults(),{fadeIn:0,fadeOut:0,playbackRate:1,type:"white"})}get type(){return this._type}set type(e){if($(e in Ml,"Noise: invalid type: "+e),this._type!==e&&(this._type=e,this.state==="started")){const t=this.now();this._stop(t),this._start(t)}}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e,this._source&&(this._source.playbackRate.value=e)}_start(e){const t=Ml[this._type];this._source=new $n({url:t,context:this.context,fadeIn:this._fadeIn,fadeOut:this._fadeOut,loop:!0,onended:()=>this.onstop(this),playbackRate:this._playbackRate}).connect(this.output),this._source.start(this.toSeconds(e),Math.random()*(t.duration-.001))}_stop(e){this._source&&(this._source.stop(this.toSeconds(e)),this._source=null)}get fadeIn(){return this._fadeIn}set fadeIn(e){this._fadeIn=e,this._source&&(this._source.fadeIn=this._fadeIn)}get fadeOut(){return this._fadeOut}set fadeOut(e){this._fadeOut=e,this._source&&(this._source.fadeOut=this._fadeOut)}_restart(e){this._stop(e),this._start(e)}dispose(){return super.dispose(),this._source&&this._source.disconnect(),this}}const On=44100*5,ea=2,os={brown:null,pink:null,white:null},Ml={get brown(){if(!os.brown){const n=[];for(let e=0;e<ea;e++){const t=new Float32Array(On);n[e]=t;let s=0;for(let i=0;i<On;i++){const r=Math.random()*2-1;t[i]=(s+.02*r)/1.02,s=t[i],t[i]*=3.5}}os.brown=new ue().fromArray(n)}return os.brown},get pink(){if(!os.pink){const n=[];for(let e=0;e<ea;e++){const t=new Float32Array(On);n[e]=t;let s,i,r,o,a,c,l;s=i=r=o=a=c=l=0;for(let u=0;u<On;u++){const h=Math.random()*2-1;s=.99886*s+h*.0555179,i=.99332*i+h*.0750759,r=.969*r+h*.153852,o=.8665*o+h*.3104856,a=.55*a+h*.5329522,c=-.7616*c-h*.016898,t[u]=s+i+r+o+a+c+l+h*.5362,t[u]*=.11,l=h*.115926}}os.pink=new ue().fromArray(n)}return os.pink},get white(){if(!os.white){const n=[];for(let e=0;e<ea;e++){const t=new Float32Array(On);n[e]=t;for(let s=0;s<On;s++)t[s]=Math.random()*2-1}os.white=new ue().fromArray(n)}return os.white}};function Tn(n,e){return Ue(this,void 0,void 0,function*(){const t=e/n.context.sampleRate,s=new Eo(1,t,n.context.sampleRate);return new n.constructor(Object.assign(n.get(),{frequency:2/t,detune:0,context:s})).toDestination().start(0),(yield s.render()).getChannelData(0)})}class to extends Xn{constructor(){super(N(to.getDefaults(),arguments,["frequency","type"])),this.name="ToneOscillatorNode",this._oscillator=this.context.createOscillator(),this._internalChannels=[this._oscillator];const e=N(to.getDefaults(),arguments,["frequency","type"]);Bs(this._oscillator,this._gainNode),this.type=e.type,this.frequency=new he({context:this.context,param:this._oscillator.frequency,units:"frequency",value:e.frequency}),this.detune=new he({context:this.context,param:this._oscillator.detune,units:"cents",value:e.detune}),xe(this,["frequency","detune"])}static getDefaults(){return Object.assign(Xn.getDefaults(),{detune:0,frequency:440,type:"sine"})}start(e){const t=this.toSeconds(e);return this.log("start",t),this._startGain(t),this._oscillator.start(t),this}_stopSource(e){this._oscillator.stop(e)}setPeriodicWave(e){return this._oscillator.setPeriodicWave(e),this}get type(){return this._oscillator.type}set type(e){this._oscillator.type=e}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._oscillator.disconnect(),this.frequency.dispose(),this.detune.dispose(),this}}class Ie extends Qe{constructor(){super(N(Ie.getDefaults(),arguments,["frequency","type"])),this.name="Oscillator",this._oscillator=null;const e=N(Ie.getDefaults(),arguments,["frequency","type"]);this.frequency=new ye({context:this.context,units:"frequency",value:e.frequency}),xe(this,"frequency"),this.detune=new ye({context:this.context,units:"cents",value:e.detune}),xe(this,"detune"),this._partials=e.partials,this._partialCount=e.partialCount,this._type=e.type,e.partialCount&&e.type!=="custom"&&(this._type=this.baseType+e.partialCount.toString()),this.phase=e.phase}static getDefaults(){return Object.assign(Qe.getDefaults(),{detune:0,frequency:440,partialCount:0,partials:[],phase:0,type:"sine"})}_start(e){const t=this.toSeconds(e),s=new to({context:this.context,onended:()=>this.onstop(this)});this._oscillator=s,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(t)}_stop(e){const t=this.toSeconds(e);this._oscillator&&this._oscillator.stop(t)}_restart(e){const t=this.toSeconds(e);return this.log("restart",t),this._oscillator&&this._oscillator.cancelStop(),this._state.cancel(t),this}syncFrequency(){return this.context.transport.syncSignal(this.frequency),this}unsyncFrequency(){return this.context.transport.unsyncSignal(this.frequency),this}_getCachedPeriodicWave(){if(this._type==="custom")return Ie._periodicWaveCache.find(t=>t.phase===this._phase&&cT(t.partials,this._partials));{const e=Ie._periodicWaveCache.find(t=>t.type===this._type&&t.phase===this._phase);return this._partialCount=e?e.partialCount:this._partialCount,e}}get type(){return this._type}set type(e){this._type=e;const t=["sine","square","sawtooth","triangle"].indexOf(e)!==-1;if(this._phase===0&&t)this._wave=void 0,this._partialCount=0,this._oscillator!==null&&(this._oscillator.type=e);else{const s=this._getCachedPeriodicWave();if(J(s)){const{partials:i,wave:r}=s;this._wave=r,this._partials=i,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave)}else{const[i,r]=this._getRealImaginary(e,this._phase),o=this.context.createPeriodicWave(i,r);this._wave=o,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave),Ie._periodicWaveCache.push({imag:r,partialCount:this._partialCount,partials:this._partials,phase:this._phase,real:i,type:this._type,wave:this._wave}),Ie._periodicWaveCache.length>100&&Ie._periodicWaveCache.shift()}}}get baseType(){return this._type.replace(this.partialCount.toString(),"")}set baseType(e){this.partialCount&&this._type!=="custom"&&e!=="custom"?this.type=e+this.partialCount:this.type=e}get partialCount(){return this._partialCount}set partialCount(e){Bt(e,0);let t=this._type;const s=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(this._type);if(s&&(t=s[1]),this._type!=="custom")e===0?this.type=t:this.type=t+e.toString();else{const i=new Float32Array(e);this._partials.forEach((r,o)=>i[o]=r),this._partials=Array.from(i),this.type=this._type}}_getRealImaginary(e,t){let i=2048;const r=new Float32Array(i),o=new Float32Array(i);let a=1;if(e==="custom"){if(a=this._partials.length+1,this._partialCount=this._partials.length,i=a,this._partials.length===0)return[r,o]}else{const c=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(e);c?(a=parseInt(c[2],10)+1,this._partialCount=parseInt(c[2],10),e=c[1],a=Math.max(a,2),i=a):this._partialCount=0,this._partials=[]}for(let c=1;c<i;++c){const l=2/(c*Math.PI);let u;switch(e){case"sine":u=c<=a?1:0,this._partials[c-1]=u;break;case"square":u=c&1?2*l:0,this._partials[c-1]=u;break;case"sawtooth":u=l*(c&1?1:-1),this._partials[c-1]=u;break;case"triangle":c&1?u=2*(l*l)*(c-1>>1&1?-1:1):u=0,this._partials[c-1]=u;break;case"custom":u=this._partials[c-1];break;default:throw new TypeError("Oscillator: invalid type: "+e)}u!==0?(r[c]=-u*Math.sin(t*c),o[c]=u*Math.cos(t*c)):(r[c]=0,o[c]=0)}return[r,o]}_inverseFFT(e,t,s){let i=0;const r=e.length;for(let o=0;o<r;o++)i+=e[o]*Math.cos(o*s)+t[o]*Math.sin(o*s);return i}getInitialValue(){const[e,t]=this._getRealImaginary(this._type,0);let s=0;const i=Math.PI*2,r=32;for(let o=0;o<r;o++)s=Math.max(this._inverseFFT(e,t,o/r*i),s);return uT(-this._inverseFFT(e,t,this._phase)/s,-1,1)}get partials(){return this._partials.slice(0,this.partialCount)}set partials(e){this._partials=e,this._partialCount=this._partials.length,e.length&&(this.type="custom")}get phase(){return this._phase*(180/Math.PI)}set phase(e){this._phase=e*Math.PI/180,this.type=this._type}asArray(e=1024){return Ue(this,void 0,void 0,function*(){return Tn(this,e)})}dispose(){return super.dispose(),this._oscillator!==null&&this._oscillator.dispose(),this._wave=void 0,this.frequency.dispose(),this.detune.dispose(),this}}Ie._periodicWaveCache=[];class MT extends gs{constructor(){super(...arguments),this.name="AudioToGain",this._norm=new pn({context:this.context,mapping:e=>(e+1)/2}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class Hs extends ye{constructor(){super(Object.assign(N(Hs.getDefaults(),arguments,["value"]))),this.name="Multiply",this.override=!1;const e=N(Hs.getDefaults(),arguments,["value"]);this._mult=this.input=this.output=new _e({context:this.context,minValue:e.minValue,maxValue:e.maxValue}),this.factor=this._param=this._mult.gain,this.factor.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(ye.getDefaults(),{value:0})}dispose(){return super.dispose(),this._mult.dispose(),this}}class qi extends Qe{constructor(){super(N(qi.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="AMOscillator",this._modulationScale=new MT({context:this.context}),this._modulationNode=new _e({context:this.context});const e=N(qi.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new Ie({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase,type:e.type}),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this._modulator=new Ie({context:this.context,phase:e.phase,type:e.modulationType}),this.harmonicity=new Hs({context:this.context,units:"positive",value:e.harmonicity}),this.frequency.chain(this.harmonicity,this._modulator.frequency),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),xe(this,["frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(Ie.getDefaults(),{harmonicity:1,modulationType:"square"})}_start(e){this._modulator.start(e),this._carrier.start(e)}_stop(e){this._modulator.stop(e),this._carrier.stop(e)}_restart(e){this._modulator.restart(e),this._carrier.restart(e)}get type(){return this._carrier.type}set type(e){this._carrier.type=e}get baseType(){return this._carrier.baseType}set baseType(e){this._carrier.baseType=e}get partialCount(){return this._carrier.partialCount}set partialCount(e){this._carrier.partialCount=e}get modulationType(){return this._modulator.type}set modulationType(e){this._modulator.type=e}get phase(){return this._carrier.phase}set phase(e){this._carrier.phase=e,this._modulator.phase=e}get partials(){return this._carrier.partials}set partials(e){this._carrier.partials=e}asArray(e=1024){return Ue(this,void 0,void 0,function*(){return Tn(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this._modulationScale.dispose(),this}}class Wi extends Qe{constructor(){super(N(Wi.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="FMOscillator",this._modulationNode=new _e({context:this.context,gain:0});const e=N(Wi.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new Ie({context:this.context,detune:e.detune,frequency:0,onstop:()=>this.onstop(this),phase:e.phase,type:e.type}),this.detune=this._carrier.detune,this.frequency=new ye({context:this.context,units:"frequency",value:e.frequency}),this._modulator=new Ie({context:this.context,phase:e.phase,type:e.modulationType}),this.harmonicity=new Hs({context:this.context,units:"positive",value:e.harmonicity}),this.modulationIndex=new Hs({context:this.context,units:"positive",value:e.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),xe(this,["modulationIndex","frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(Ie.getDefaults(),{harmonicity:1,modulationIndex:2,modulationType:"square"})}_start(e){this._modulator.start(e),this._carrier.start(e)}_stop(e){this._modulator.stop(e),this._carrier.stop(e)}_restart(e){return this._modulator.restart(e),this._carrier.restart(e),this}get type(){return this._carrier.type}set type(e){this._carrier.type=e}get baseType(){return this._carrier.baseType}set baseType(e){this._carrier.baseType=e}get partialCount(){return this._carrier.partialCount}set partialCount(e){this._carrier.partialCount=e}get modulationType(){return this._modulator.type}set modulationType(e){this._modulator.type=e}get phase(){return this._carrier.phase}set phase(e){this._carrier.phase=e,this._modulator.phase=e}get partials(){return this._carrier.partials}set partials(e){this._carrier.partials=e}asArray(e=1024){return Ue(this,void 0,void 0,function*(){return Tn(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this.modulationIndex.dispose(),this}}class Qn extends Qe{constructor(){super(N(Qn.getDefaults(),arguments,["frequency","width"])),this.name="PulseOscillator",this._widthGate=new _e({context:this.context,gain:0}),this._thresh=new pn({context:this.context,mapping:t=>t<=0?-1:1});const e=N(Qn.getDefaults(),arguments,["frequency","width"]);this.width=new ye({context:this.context,units:"audioRange",value:e.width}),this._triangle=new Ie({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase,type:"triangle"}),this.frequency=this._triangle.frequency,this.detune=this._triangle.detune,this._triangle.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),xe(this,["width","frequency","detune"])}static getDefaults(){return Object.assign(Qe.getDefaults(),{detune:0,frequency:440,phase:0,type:"pulse",width:.2})}_start(e){e=this.toSeconds(e),this._triangle.start(e),this._widthGate.gain.setValueAtTime(1,e)}_stop(e){e=this.toSeconds(e),this._triangle.stop(e),this._widthGate.gain.cancelScheduledValues(e),this._widthGate.gain.setValueAtTime(0,e)}_restart(e){this._triangle.restart(e),this._widthGate.gain.cancelScheduledValues(e),this._widthGate.gain.setValueAtTime(1,e)}get phase(){return this._triangle.phase}set phase(e){this._triangle.phase=e}get type(){return"pulse"}get baseType(){return"pulse"}get partials(){return[]}get partialCount(){return 0}set carrierType(e){this._triangle.type=e}asArray(e=1024){return Ue(this,void 0,void 0,function*(){return Tn(this,e)})}dispose(){return super.dispose(),this._triangle.dispose(),this.width.dispose(),this._widthGate.dispose(),this._thresh.dispose(),this}}class Gi extends Qe{constructor(){super(N(Gi.getDefaults(),arguments,["frequency","type","spread"])),this.name="FatOscillator",this._oscillators=[];const e=N(Gi.getDefaults(),arguments,["frequency","type","spread"]);this.frequency=new ye({context:this.context,units:"frequency",value:e.frequency}),this.detune=new ye({context:this.context,units:"cents",value:e.detune}),this._spread=e.spread,this._type=e.type,this._phase=e.phase,this._partials=e.partials,this._partialCount=e.partialCount,this.count=e.count,xe(this,["frequency","detune"])}static getDefaults(){return Object.assign(Ie.getDefaults(),{count:3,spread:20,type:"sawtooth"})}_start(e){e=this.toSeconds(e),this._forEach(t=>t.start(e))}_stop(e){e=this.toSeconds(e),this._forEach(t=>t.stop(e))}_restart(e){this._forEach(t=>t.restart(e))}_forEach(e){for(let t=0;t<this._oscillators.length;t++)e(this._oscillators[t],t)}get type(){return this._type}set type(e){this._type=e,this._forEach(t=>t.type=e)}get spread(){return this._spread}set spread(e){if(this._spread=e,this._oscillators.length>1){const t=-e/2,s=e/(this._oscillators.length-1);this._forEach((i,r)=>i.detune.value=t+s*r)}}get count(){return this._oscillators.length}set count(e){if(Bt(e,1),this._oscillators.length!==e){this._forEach(t=>t.dispose()),this._oscillators=[];for(let t=0;t<e;t++){const s=new Ie({context:this.context,volume:-6-e*1.1,type:this._type,phase:this._phase+t/e*360,partialCount:this._partialCount,onstop:t===0?()=>this.onstop(this):le});this.type==="custom"&&(s.partials=this._partials),this.frequency.connect(s.frequency),this.detune.connect(s.detune),s.detune.overridden=!1,s.connect(this.output),this._oscillators[t]=s}this.spread=this._spread,this.state==="started"&&this._forEach(t=>t.start())}}get phase(){return this._phase}set phase(e){this._phase=e,this._forEach((t,s)=>t.phase=this._phase+s/this.count*360)}get baseType(){return this._oscillators[0].baseType}set baseType(e){this._forEach(t=>t.baseType=e),this._type=this._oscillators[0].type}get partials(){return this._oscillators[0].partials}set partials(e){this._partials=e,this._partialCount=this._partials.length,e.length&&(this._type="custom",this._forEach(t=>t.partials=e))}get partialCount(){return this._oscillators[0].partialCount}set partialCount(e){this._partialCount=e,this._forEach(t=>t.partialCount=e),this._type=this._oscillators[0].type}asArray(e=1024){return Ue(this,void 0,void 0,function*(){return Tn(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this._forEach(e=>e.dispose()),this}}class ji extends Qe{constructor(){super(N(ji.getDefaults(),arguments,["frequency","modulationFrequency"])),this.name="PWMOscillator",this.sourceType="pwm",this._scale=new Hs({context:this.context,value:2});const e=N(ji.getDefaults(),arguments,["frequency","modulationFrequency"]);this._pulse=new Qn({context:this.context,frequency:e.modulationFrequency}),this._pulse.carrierType="sine",this.modulationFrequency=this._pulse.frequency,this._modulator=new Ie({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase}),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),xe(this,["modulationFrequency","frequency","detune"])}static getDefaults(){return Object.assign(Qe.getDefaults(),{detune:0,frequency:440,modulationFrequency:.4,phase:0,type:"pwm"})}_start(e){e=this.toSeconds(e),this._modulator.start(e),this._pulse.start(e)}_stop(e){e=this.toSeconds(e),this._modulator.stop(e),this._pulse.stop(e)}_restart(e){this._modulator.restart(e),this._pulse.restart(e)}get type(){return"pwm"}get baseType(){return"pwm"}get partials(){return[]}get partialCount(){return 0}get phase(){return this._modulator.phase}set phase(e){this._modulator.phase=e}asArray(e=1024){return Ue(this,void 0,void 0,function*(){return Tn(this,e)})}dispose(){return super.dispose(),this._pulse.dispose(),this._scale.dispose(),this._modulator.dispose(),this}}const Dl={am:qi,fat:Gi,fm:Wi,oscillator:Ie,pulse:Qn,pwm:ji};class mn extends Qe{constructor(){super(N(mn.getDefaults(),arguments,["frequency","type"])),this.name="OmniOscillator";const e=N(mn.getDefaults(),arguments,["frequency","type"]);this.frequency=new ye({context:this.context,units:"frequency",value:e.frequency}),this.detune=new ye({context:this.context,units:"cents",value:e.detune}),xe(this,["frequency","detune"]),this.set(e)}static getDefaults(){return Object.assign(Ie.getDefaults(),Wi.getDefaults(),qi.getDefaults(),Gi.getDefaults(),Qn.getDefaults(),ji.getDefaults())}_start(e){this._oscillator.start(e)}_stop(e){this._oscillator.stop(e)}_restart(e){return this._oscillator.restart(e),this}get type(){let e="";return["am","fm","fat"].some(t=>this._sourceType===t)&&(e=this._sourceType),e+this._oscillator.type}set type(e){e.substr(0,2)==="fm"?(this._createNewOscillator("fm"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(2)):e.substr(0,2)==="am"?(this._createNewOscillator("am"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(2)):e.substr(0,3)==="fat"?(this._createNewOscillator("fat"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(3)):e==="pwm"?(this._createNewOscillator("pwm"),this._oscillator=this._oscillator):e==="pulse"?this._createNewOscillator("pulse"):(this._createNewOscillator("oscillator"),this._oscillator=this._oscillator,this._oscillator.type=e)}get partials(){return this._oscillator.partials}set partials(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&(this._oscillator.partials=e)}get partialCount(){return this._oscillator.partialCount}set partialCount(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&(this._oscillator.partialCount=e)}set(e){return Reflect.has(e,"type")&&e.type&&(this.type=e.type),super.set(e),this}_createNewOscillator(e){if(e!==this._sourceType){this._sourceType=e;const t=Dl[e],s=this.now();if(this._oscillator){const i=this._oscillator;i.stop(s),this.context.setTimeout(()=>i.dispose(),this.blockTime)}this._oscillator=new t({context:this.context}),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this._oscillator.onstop=()=>this.onstop(this),this.state==="started"&&this._oscillator.start(s)}}get phase(){return this._oscillator.phase}set phase(e){this._oscillator.phase=e}get sourceType(){return this._sourceType}set sourceType(e){let t="sine";this._oscillator.type!=="pwm"&&this._oscillator.type!=="pulse"&&(t=this._oscillator.type),e==="fm"?this.type="fm"+t:e==="am"?this.type="am"+t:e==="fat"?this.type="fat"+t:e==="oscillator"?this.type=t:e==="pulse"?this.type="pulse":e==="pwm"&&(this.type="pwm")}_getOscType(e,t){return e instanceof Dl[t]}get baseType(){return this._oscillator.baseType}set baseType(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&e!=="pulse"&&e!=="pwm"&&(this._oscillator.baseType=e)}get width(){if(this._getOscType(this._oscillator,"pulse"))return this._oscillator.width}get count(){if(this._getOscType(this._oscillator,"fat"))return this._oscillator.count}set count(e){this._getOscType(this._oscillator,"fat")&&Ls(e)&&(this._oscillator.count=e)}get spread(){if(this._getOscType(this._oscillator,"fat"))return this._oscillator.spread}set spread(e){this._getOscType(this._oscillator,"fat")&&Ls(e)&&(this._oscillator.spread=e)}get modulationType(){if(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))return this._oscillator.modulationType}set modulationType(e){(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))&&_s(e)&&(this._oscillator.modulationType=e)}get modulationIndex(){if(this._getOscType(this._oscillator,"fm"))return this._oscillator.modulationIndex}get harmonicity(){if(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))return this._oscillator.harmonicity}get modulationFrequency(){if(this._getOscType(this._oscillator,"pwm"))return this._oscillator.modulationFrequency}asArray(e=1024){return Ue(this,void 0,void 0,function*(){return Tn(this,e)})}dispose(){return super.dispose(),this.detune.dispose(),this.frequency.dispose(),this._oscillator.dispose(),this}}class Ec extends ye{constructor(){super(Object.assign(N(Ec.getDefaults(),arguments,["value"]))),this.override=!1,this.name="Add",this._sum=new _e({context:this.context}),this.input=this._sum,this.output=this._sum,this.addend=this._param,Li(this._constantSource,this._sum)}static getDefaults(){return Object.assign(ye.getDefaults(),{value:0})}dispose(){return super.dispose(),this._sum.dispose(),this}}class so extends gs{constructor(){super(Object.assign(N(so.getDefaults(),arguments,["min","max"]))),this.name="Scale";const e=N(so.getDefaults(),arguments,["min","max"]);this._mult=this.input=new Hs({context:this.context,value:e.max-e.min}),this._add=this.output=new Ec({context:this.context,value:e.min}),this._min=e.min,this._max=e.max,this.input.connect(this.output)}static getDefaults(){return Object.assign(gs.getDefaults(),{max:1,min:0})}get min(){return this._min}set min(e){this._min=e,this._setRange()}get max(){return this._max}set max(e){this._max=e,this._setRange()}_setRange(){this._add.value=this._min,this._mult.value=this._max-this._min}dispose(){return super.dispose(),this._add.dispose(),this._mult.dispose(),this}}function Kh(n,e=1/0){const t=new WeakMap;return function(s,i){Reflect.defineProperty(s,i,{configurable:!0,enumerable:!0,get:function(){return t.get(this)},set:function(r){Bt(r,n,e),t.set(this,r)}})}}function ws(n,e=1/0){const t=new WeakMap;return function(s,i){Reflect.defineProperty(s,i,{configurable:!0,enumerable:!0,get:function(){return t.get(this)},set:function(r){Bt(this.toSeconds(r),n,e),t.set(this,r)}})}}class Yi extends Qe{constructor(){super(N(Yi.getDefaults(),arguments,["url","onload"])),this.name="Player",this._activeSources=new Set;const e=N(Yi.getDefaults(),arguments,["url","onload"]);this._buffer=new ue({onload:this._onload.bind(this,e.onload),onerror:e.onerror,reverse:e.reverse,url:e.url}),this.autostart=e.autostart,this._loop=e.loop,this._loopStart=e.loopStart,this._loopEnd=e.loopEnd,this._playbackRate=e.playbackRate,this.fadeIn=e.fadeIn,this.fadeOut=e.fadeOut}static getDefaults(){return Object.assign(Qe.getDefaults(),{autostart:!1,fadeIn:0,fadeOut:0,loop:!1,loopEnd:0,loopStart:0,onload:le,onerror:le,playbackRate:1,reverse:!1})}load(e){return Ue(this,void 0,void 0,function*(){return yield this._buffer.load(e),this._onload(),this})}_onload(e=le){e(),this.autostart&&this.start()}_onSourceEnd(e){this.onstop(this),this._activeSources.delete(e),this._activeSources.size===0&&!this._synced&&this._state.getValueAtTime(this.now())==="started"&&(this._state.cancel(this.now()),this._state.setStateAtTime("stopped",this.now()))}start(e,t,s){return super.start(e,t,s),this}_start(e,t,s){this._loop?t=Ln(t,this._loopStart):t=Ln(t,0);const i=this.toSeconds(t),r=s;s=Ln(s,Math.max(this._buffer.duration-i,0));let o=this.toSeconds(s);o=o/this._playbackRate,e=this.toSeconds(e);const a=new $n({url:this._buffer,context:this.context,fadeIn:this.fadeIn,fadeOut:this.fadeOut,loop:this._loop,loopEnd:this._loopEnd,loopStart:this._loopStart,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate}).connect(this.output);!this._loop&&!this._synced&&(this._state.cancel(e+o),this._state.setStateAtTime("stopped",e+o,{implicitEnd:!0})),this._activeSources.add(a),this._loop&&yt(r)?a.start(e,i):a.start(e,i,o-this.toSeconds(this.fadeOut))}_stop(e){const t=this.toSeconds(e);this._activeSources.forEach(s=>s.stop(t))}restart(e,t,s){return super.restart(e,t,s),this}_restart(e,t,s){var i;(i=[...this._activeSources].pop())===null||i===void 0||i.stop(e),this._start(e,t,s)}seek(e,t){const s=this.toSeconds(t);if(this._state.getValueAtTime(s)==="started"){const i=this.toSeconds(e);this._stop(s),this._start(s,i)}return this}setLoopPoints(e,t){return this.loopStart=e,this.loopEnd=t,this}get loopStart(){return this._loopStart}set loopStart(e){this._loopStart=e,this.buffer.loaded&&Bt(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach(t=>{t.loopStart=e})}get loopEnd(){return this._loopEnd}set loopEnd(e){this._loopEnd=e,this.buffer.loaded&&Bt(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach(t=>{t.loopEnd=e})}get buffer(){return this._buffer}set buffer(e){this._buffer.set(e)}get loop(){return this._loop}set loop(e){if(this._loop!==e&&(this._loop=e,this._activeSources.forEach(t=>{t.loop=e}),e)){const t=this._state.getNextState("stopped",this.now());t&&this._state.cancel(t.time)}}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e;const t=this.now(),s=this._state.getNextState("stopped",t);s&&s.implicitEnd&&(this._state.cancel(s.time),this._activeSources.forEach(i=>i.cancelStop())),this._activeSources.forEach(i=>{i.playbackRate.setValueAtTime(e,t)})}get reverse(){return this._buffer.reverse}set reverse(e){this._buffer.reverse=e}get loaded(){return this._buffer.loaded}dispose(){return super.dispose(),this._activeSources.forEach(e=>e.dispose()),this._activeSources.clear(),this._buffer.dispose(),this}}zt([ws(0)],Yi.prototype,"fadeIn",void 0);zt([ws(0)],Yi.prototype,"fadeOut",void 0);class DT extends gs{constructor(){super(...arguments),this.name="GainToAudio",this._norm=new pn({context:this.context,mapping:e=>Math.abs(e)*2-1}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class Dt extends G{constructor(){super(N(Dt.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="Envelope",this._sig=new ye({context:this.context,value:0}),this.output=this._sig,this.input=void 0;const e=N(Dt.getDefaults(),arguments,["attack","decay","sustain","release"]);this.attack=e.attack,this.decay=e.decay,this.sustain=e.sustain,this.release=e.release,this.attackCurve=e.attackCurve,this.releaseCurve=e.releaseCurve,this.decayCurve=e.decayCurve}static getDefaults(){return Object.assign(G.getDefaults(),{attack:.01,attackCurve:"linear",decay:.1,decayCurve:"exponential",release:1,releaseCurve:"exponential",sustain:.5})}get value(){return this.getValueAtTime(this.now())}_getCurve(e,t){if(_s(e))return e;{let s;for(s in Or)if(Or[s][t]===e)return s;return e}}_setCurve(e,t,s){if(_s(s)&&Reflect.has(Or,s)){const i=Or[s];cn(i)?e!=="_decayCurve"&&(this[e]=i[t]):this[e]=i}else if(Ut(s)&&e!=="_decayCurve")this[e]=s;else throw new Error("Envelope: invalid curve: "+s)}get attackCurve(){return this._getCurve(this._attackCurve,"In")}set attackCurve(e){this._setCurve("_attackCurve","In",e)}get releaseCurve(){return this._getCurve(this._releaseCurve,"Out")}set releaseCurve(e){this._setCurve("_releaseCurve","Out",e)}get decayCurve(){return this._getCurve(this._decayCurve,"Out")}set decayCurve(e){this._setCurve("_decayCurve","Out",e)}triggerAttack(e,t=1){this.log("triggerAttack",e,t),e=this.toSeconds(e);let i=this.toSeconds(this.attack);const r=this.toSeconds(this.decay),o=this.getValueAtTime(e);if(o>0){const a=1/i;i=(1-o)/a}if(i<this.sampleTime)this._sig.cancelScheduledValues(e),this._sig.setValueAtTime(t,e);else if(this._attackCurve==="linear")this._sig.linearRampTo(t,i,e);else if(this._attackCurve==="exponential")this._sig.targetRampTo(t,i,e);else{this._sig.cancelAndHoldAtTime(e);let a=this._attackCurve;for(let c=1;c<a.length;c++)if(a[c-1]<=o&&o<=a[c]){a=this._attackCurve.slice(c),a[0]=o;break}this._sig.setValueCurveAtTime(a,e,i,t)}if(r&&this.sustain<1){const a=t*this.sustain,c=e+i;this.log("decay",c),this._decayCurve==="linear"?this._sig.linearRampToValueAtTime(a,r+c):this._sig.exponentialApproachValueAtTime(a,c,r)}return this}triggerRelease(e){this.log("triggerRelease",e),e=this.toSeconds(e);const t=this.getValueAtTime(e);if(t>0){const s=this.toSeconds(this.release);s<this.sampleTime?this._sig.setValueAtTime(0,e):this._releaseCurve==="linear"?this._sig.linearRampTo(0,s,e):this._releaseCurve==="exponential"?this._sig.targetRampTo(0,s,e):($(Ut(this._releaseCurve),"releaseCurve must be either 'linear', 'exponential' or an array"),this._sig.cancelAndHoldAtTime(e),this._sig.setValueCurveAtTime(this._releaseCurve,e,s,t))}return this}getValueAtTime(e){return this._sig.getValueAtTime(e)}triggerAttackRelease(e,t,s=1){return t=this.toSeconds(t),this.triggerAttack(t,s),this.triggerRelease(t+this.toSeconds(e)),this}cancel(e){return this._sig.cancelScheduledValues(this.toSeconds(e)),this}connect(e,t=0,s=0){return Sc(this,e,t,s),this}asArray(e=1024){return Ue(this,void 0,void 0,function*(){const t=e/this.context.sampleRate,s=new Eo(1,t,this.context.sampleRate),i=this.toSeconds(this.attack)+this.toSeconds(this.decay),r=i+this.toSeconds(this.release),o=r*.1,a=r+o,c=new this.constructor(Object.assign(this.get(),{attack:t*this.toSeconds(this.attack)/a,decay:t*this.toSeconds(this.decay)/a,release:t*this.toSeconds(this.release)/a,context:s}));return c._sig.toDestination(),c.triggerAttackRelease(t*(i+o)/a,0),(yield s.render()).getChannelData(0)})}dispose(){return super.dispose(),this._sig.dispose(),this}}zt([ws(0)],Dt.prototype,"attack",void 0);zt([ws(0)],Dt.prototype,"decay",void 0);zt([Kh(0,1)],Dt.prototype,"sustain",void 0);zt([ws(0)],Dt.prototype,"release",void 0);const Or=(()=>{let e,t;const s=[];for(e=0;e<128;e++)s[e]=Math.sin(e/(128-1)*(Math.PI/2));const i=[],r=6.4;for(e=0;e<128-1;e++){t=e/(128-1);const d=Math.sin(t*(Math.PI*2)*r-Math.PI/2)+1;i[e]=d/10+t*.83}i[128-1]=1;const o=[],a=5;for(e=0;e<128;e++)o[e]=Math.ceil(e/(128-1)*a)/a;const c=[];for(e=0;e<128;e++)t=e/(128-1),c[e]=.5*(1-Math.cos(Math.PI*t));const l=[];for(e=0;e<128;e++){t=e/(128-1);const d=Math.pow(t,3)*4+.2,f=Math.cos(d*Math.PI*2*t);l[e]=Math.abs(f*(1-t))}function u(d){const f=new Array(d.length);for(let m=0;m<d.length;m++)f[m]=1-d[m];return f}function h(d){return d.slice(0).reverse()}return{bounce:{In:u(l),Out:l},cosine:{In:s,Out:h(s)},exponential:"exponential",linear:"linear",ripple:{In:i,Out:u(i)},sine:{In:c,Out:u(c)},step:{In:o,Out:u(o)}}})();class _n extends G{constructor(){super(N(_n.getDefaults(),arguments)),this._scheduledEvents=[],this._synced=!1,this._original_triggerAttack=this.triggerAttack,this._original_triggerRelease=this.triggerRelease,this._syncedRelease=t=>this._original_triggerRelease(t);const e=N(_n.getDefaults(),arguments);this._volume=this.output=new zs({context:this.context,volume:e.volume}),this.volume=this._volume.volume,xe(this,"volume")}static getDefaults(){return Object.assign(G.getDefaults(),{volume:0})}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0),this.context.transport.on("stop",this._syncedRelease),this.context.transport.on("pause",this._syncedRelease),this.context.transport.on("loopEnd",this._syncedRelease)),this}_syncState(){let e=!1;return this._synced||(this._synced=!0,e=!0),e}_syncMethod(e,t){const s=this["_original_"+e]=this[e];this[e]=(...i)=>{const r=i[t],o=this.context.transport.schedule(a=>{i[t]=a,s.apply(this,i)},r);this._scheduledEvents.push(o)}}unsync(){return this._scheduledEvents.forEach(e=>this.context.transport.clear(e)),this._scheduledEvents=[],this._synced&&(this._synced=!1,this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease,this.context.transport.off("stop",this._syncedRelease),this.context.transport.off("pause",this._syncedRelease),this.context.transport.off("loopEnd",this._syncedRelease)),this}triggerAttackRelease(e,t,s,i){const r=this.toSeconds(s),o=this.toSeconds(t);return this.triggerAttack(e,r,i),this.triggerRelease(r+o),this}dispose(){return super.dispose(),this._volume.dispose(),this.unsync(),this._scheduledEvents=[],this}}class vs extends _n{constructor(){super(N(vs.getDefaults(),arguments));const e=N(vs.getDefaults(),arguments);this.portamento=e.portamento,this.onsilence=e.onsilence}static getDefaults(){return Object.assign(_n.getDefaults(),{detune:0,onsilence:le,portamento:0})}triggerAttack(e,t,s=1){this.log("triggerAttack",e,t,s);const i=this.toSeconds(t);return this._triggerEnvelopeAttack(i,s),this.setNote(e,i),this}triggerRelease(e){this.log("triggerRelease",e);const t=this.toSeconds(e);return this._triggerEnvelopeRelease(t),this}setNote(e,t){const s=this.toSeconds(t),i=e instanceof Ot?e.toFrequency():e;if(this.portamento>0&&this.getLevelAtTime(s)>.05){const r=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(i,r,s)}else this.frequency.setValueAtTime(i,s);return this}}zt([ws(0)],vs.prototype,"portamento",void 0);class Ao extends Dt{constructor(){super(N(Ao.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="AmplitudeEnvelope",this._gainNode=new _e({context:this.context,gain:0}),this.output=this._gainNode,this.input=this._gainNode,this._sig.connect(this._gainNode.gain),this.output=this._gainNode,this.input=this._gainNode}dispose(){return super.dispose(),this._gainNode.dispose(),this}}class Zi extends vs{constructor(){super(N(Zi.getDefaults(),arguments)),this.name="Synth";const e=N(Zi.getDefaults(),arguments);this.oscillator=new mn(Object.assign({context:this.context,detune:e.detune,onstop:()=>this.onsilence(this)},e.oscillator)),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new Ao(Object.assign({context:this.context},e.envelope)),this.oscillator.chain(this.envelope,this.output),xe(this,["oscillator","frequency","detune","envelope"])}static getDefaults(){return Object.assign(vs.getDefaults(),{envelope:Object.assign(Rn(Dt.getDefaults(),Object.keys(G.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.3}),oscillator:Object.assign(Rn(mn.getDefaults(),[...Object.keys(Qe.getDefaults()),"frequency","detune"]),{type:"triangle"})})}_triggerEnvelopeAttack(e,t){if(this.envelope.triggerAttack(e,t),this.oscillator.start(e),this.envelope.sustain===0){const s=this.toSeconds(this.envelope.attack),i=this.toSeconds(this.envelope.decay);this.oscillator.stop(e+s+i)}}_triggerEnvelopeRelease(e){this.envelope.triggerRelease(e),this.oscillator.stop(e+this.toSeconds(this.envelope.release))}getLevelAtTime(e){return e=this.toSeconds(e),this.envelope.getValueAtTime(e)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this}}class Xi extends G{constructor(){super(N(Xi.getDefaults(),arguments,["frequency","type"])),this.name="BiquadFilter";const e=N(Xi.getDefaults(),arguments,["frequency","type"]);this._filter=this.context.createBiquadFilter(),this.input=this.output=this._filter,this.Q=new he({context:this.context,units:"number",value:e.Q,param:this._filter.Q}),this.frequency=new he({context:this.context,units:"frequency",value:e.frequency,param:this._filter.frequency}),this.detune=new he({context:this.context,units:"cents",value:e.detune,param:this._filter.detune}),this.gain=new he({context:this.context,units:"decibels",convert:!1,value:e.gain,param:this._filter.gain}),this.type=e.type}static getDefaults(){return Object.assign(G.getDefaults(),{Q:1,type:"lowpass",frequency:350,detune:0,gain:0})}get type(){return this._filter.type}set type(e){$(["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(e)!==-1,`Invalid filter type: ${e}`),this._filter.type=e}getFrequencyResponse(e=128){const t=new Float32Array(e);for(let o=0;o<e;o++){const c=Math.pow(o/e,2)*(2e4-20)+20;t[o]=c}const s=new Float32Array(e),i=new Float32Array(e),r=this.context.createBiquadFilter();return r.type=this.type,r.Q.value=this.Q.value,r.frequency.value=this.frequency.value,r.gain.value=this.gain.value,r.getFrequencyResponse(t,s,i),s}dispose(){return super.dispose(),this._filter.disconnect(),this.Q.dispose(),this.frequency.dispose(),this.gain.dispose(),this.detune.dispose(),this}}class Kn extends G{constructor(){super(N(Kn.getDefaults(),arguments,["frequency","type","rolloff"])),this.name="Filter",this.input=new _e({context:this.context}),this.output=new _e({context:this.context}),this._filters=[];const e=N(Kn.getDefaults(),arguments,["frequency","type","rolloff"]);this._filters=[],this.Q=new ye({context:this.context,units:"positive",value:e.Q}),this.frequency=new ye({context:this.context,units:"frequency",value:e.frequency}),this.detune=new ye({context:this.context,units:"cents",value:e.detune}),this.gain=new ye({context:this.context,units:"decibels",convert:!1,value:e.gain}),this._type=e.type,this.rolloff=e.rolloff,xe(this,["detune","frequency","gain","Q"])}static getDefaults(){return Object.assign(G.getDefaults(),{Q:1,detune:0,frequency:350,gain:0,rolloff:-12,type:"lowpass"})}get type(){return this._type}set type(e){$(["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(e)!==-1,`Invalid filter type: ${e}`),this._type=e,this._filters.forEach(s=>s.type=e)}get rolloff(){return this._rolloff}set rolloff(e){const t=Ls(e)?e:parseInt(e,10),s=[-12,-24,-48,-96];let i=s.indexOf(t);$(i!==-1,`rolloff can only be ${s.join(", ")}`),i+=1,this._rolloff=t,this.input.disconnect(),this._filters.forEach(r=>r.disconnect()),this._filters=new Array(i);for(let r=0;r<i;r++){const o=new Xi({context:this.context});o.type=this._type,this.frequency.connect(o.frequency),this.detune.connect(o.detune),this.Q.connect(o.Q),this.gain.connect(o.gain),this._filters[r]=o}this._internalChannels=this._filters,Li(this.input,...this._internalChannels,this.output)}getFrequencyResponse(e=128){const t=new Xi({frequency:this.frequency.value,gain:this.gain.value,Q:this.Q.value,type:this._type,detune:this.detune.value}),s=new Float32Array(e).map(()=>1);return this._filters.forEach(()=>{t.getFrequencyResponse(e).forEach((r,o)=>s[o]*=r)}),t.dispose(),s}dispose(){return super.dispose(),this._filters.forEach(e=>{e.dispose()}),Tc(this,["detune","frequency","gain","Q"]),this.frequency.dispose(),this.Q.dispose(),this.detune.dispose(),this.gain.dispose(),this}}class $i extends Dt{constructor(){super(N($i.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="FrequencyEnvelope";const e=N($i.getDefaults(),arguments,["attack","decay","sustain","release"]);this._octaves=e.octaves,this._baseFrequency=this.toFrequency(e.baseFrequency),this._exponent=this.input=new zi({context:this.context,value:e.exponent}),this._scale=this.output=new so({context:this.context,min:this._baseFrequency,max:this._baseFrequency*Math.pow(2,this._octaves)}),this._sig.chain(this._exponent,this._scale)}static getDefaults(){return Object.assign(Dt.getDefaults(),{baseFrequency:200,exponent:1,octaves:4})}get baseFrequency(){return this._baseFrequency}set baseFrequency(e){const t=this.toFrequency(e);Bt(t,0),this._baseFrequency=t,this._scale.min=this._baseFrequency,this.octaves=this._octaves}get octaves(){return this._octaves}set octaves(e){this._octaves=e,this._scale.max=this._baseFrequency*Math.pow(2,e)}get exponent(){return this._exponent.value}set exponent(e){this._exponent.value=e}dispose(){return super.dispose(),this._exponent.dispose(),this._scale.dispose(),this}}class Qi extends vs{constructor(){super(N(Qi.getDefaults(),arguments)),this.name="MonoSynth";const e=N(Qi.getDefaults(),arguments);this.oscillator=new mn(Object.assign(e.oscillator,{context:this.context,detune:e.detune,onstop:()=>this.onsilence(this)})),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.filter=new Kn(Object.assign(e.filter,{context:this.context})),this.filterEnvelope=new $i(Object.assign(e.filterEnvelope,{context:this.context})),this.envelope=new Ao(Object.assign(e.envelope,{context:this.context})),this.oscillator.chain(this.filter,this.envelope,this.output),this.filterEnvelope.connect(this.filter.frequency),xe(this,["oscillator","frequency","detune","filter","filterEnvelope","envelope"])}static getDefaults(){return Object.assign(vs.getDefaults(),{envelope:Object.assign(Rn(Dt.getDefaults(),Object.keys(G.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.9}),filter:Object.assign(Rn(Kn.getDefaults(),Object.keys(G.getDefaults())),{Q:1,rolloff:-12,type:"lowpass"}),filterEnvelope:Object.assign(Rn($i.getDefaults(),Object.keys(G.getDefaults())),{attack:.6,baseFrequency:200,decay:.2,exponent:2,octaves:3,release:2,sustain:.5}),oscillator:Object.assign(Rn(mn.getDefaults(),Object.keys(Qe.getDefaults())),{type:"sawtooth"})})}_triggerEnvelopeAttack(e,t=1){if(this.envelope.triggerAttack(e,t),this.filterEnvelope.triggerAttack(e),this.oscillator.start(e),this.envelope.sustain===0){const s=this.toSeconds(this.envelope.attack),i=this.toSeconds(this.envelope.decay);this.oscillator.stop(e+s+i)}}_triggerEnvelopeRelease(e){this.envelope.triggerRelease(e),this.filterEnvelope.triggerRelease(e),this.oscillator.stop(e+this.toSeconds(this.envelope.release))}getLevelAtTime(e){return e=this.toSeconds(e),this.envelope.getValueAtTime(e)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this.filterEnvelope.dispose(),this.filter.dispose(),this}}class Ki extends Zi{constructor(){super(N(Ki.getDefaults(),arguments)),this.name="MembraneSynth",this.portamento=0;const e=N(Ki.getDefaults(),arguments);this.pitchDecay=e.pitchDecay,this.octaves=e.octaves,xe(this,["oscillator","envelope"])}static getDefaults(){return Un(vs.getDefaults(),Zi.getDefaults(),{envelope:{attack:.001,attackCurve:"exponential",decay:.4,release:1.4,sustain:.01},octaves:10,oscillator:{type:"sine"},pitchDecay:.05})}setNote(e,t){const s=this.toSeconds(t),i=this.toFrequency(e instanceof Ot?e.toFrequency():e),r=i*this.octaves;return this.oscillator.frequency.setValueAtTime(r,s),this.oscillator.frequency.exponentialRampToValueAtTime(i,s+this.toSeconds(this.pitchDecay)),this}dispose(){return super.dispose(),this}}zt([Kh(0)],Ki.prototype,"octaves",void 0);zt([ws(0)],Ki.prototype,"pitchDecay",void 0);const Jh=new Set;function Oc(n){Jh.add(n)}function ed(n,e){const t=`registerProcessor("${n}", ${e})`;Jh.add(t)}const kT=`
	/**
	 * The base AudioWorkletProcessor for use in Tone.js. Works with the [[ToneAudioWorklet]]. 
	 */
	class ToneAudioWorkletProcessor extends AudioWorkletProcessor {

		constructor(options) {
			
			super(options);
			/**
			 * If the processor was disposed or not. Keep alive until it's disposed.
			 */
			this.disposed = false;
		   	/** 
			 * The number of samples in the processing block
			 */
			this.blockSize = 128;
			/**
			 * the sample rate
			 */
			this.sampleRate = sampleRate;

			this.port.onmessage = (event) => {
				// when it receives a dispose 
				if (event.data === "dispose") {
					this.disposed = true;
				}
			};
		}
	}
`;Oc(kT);const RT=`
	/**
	 * Abstract class for a single input/output processor. 
	 * has a 'generate' function which processes one sample at a time
	 */
	class SingleIOProcessor extends ToneAudioWorkletProcessor {

		constructor(options) {
			super(Object.assign(options, {
				numberOfInputs: 1,
				numberOfOutputs: 1
			}));
			/**
			 * Holds the name of the parameter and a single value of that
			 * parameter at the current sample
			 * @type { [name: string]: number }
			 */
			this.params = {}
		}

		/**
		 * Generate an output sample from the input sample and parameters
		 * @abstract
		 * @param input number
		 * @param channel number
		 * @param parameters { [name: string]: number }
		 * @returns number
		 */
		generate(){}

		/**
		 * Update the private params object with the 
		 * values of the parameters at the given index
		 * @param parameters { [name: string]: Float32Array },
		 * @param index number
		 */
		updateParams(parameters, index) {
			for (const paramName in parameters) {
				const param = parameters[paramName];
				if (param.length > 1) {
					this.params[paramName] = parameters[paramName][index];
				} else {
					this.params[paramName] = parameters[paramName][0];
				}
			}
		}

		/**
		 * Process a single frame of the audio
		 * @param inputs Float32Array[][]
		 * @param outputs Float32Array[][]
		 */
		process(inputs, outputs, parameters) {
			const input = inputs[0];
			const output = outputs[0];
			// get the parameter values
			const channelCount = Math.max(input && input.length || 0, output.length);
			for (let sample = 0; sample < this.blockSize; sample++) {
				this.updateParams(parameters, sample);
				for (let channel = 0; channel < channelCount; channel++) {
					const inputSample = input && input.length ? input[channel][sample] : 0;
					output[channel][sample] = this.generate(inputSample, channel, this.params);
				}
			}
			return !this.disposed;
		}
	};
`;Oc(RT);const PT=`
	/**
	 * A multichannel buffer for use within an AudioWorkletProcessor as a delay line
	 */
	class DelayLine {
		
		constructor(size, channels) {
			this.buffer = [];
			this.writeHead = []
			this.size = size;

			// create the empty channels
			for (let i = 0; i < channels; i++) {
				this.buffer[i] = new Float32Array(this.size);
				this.writeHead[i] = 0;
			}
		}

		/**
		 * Push a value onto the end
		 * @param channel number
		 * @param value number
		 */
		push(channel, value) {
			this.writeHead[channel] += 1;
			if (this.writeHead[channel] > this.size) {
				this.writeHead[channel] = 0;
			}
			this.buffer[channel][this.writeHead[channel]] = value;
		}

		/**
		 * Get the recorded value of the channel given the delay
		 * @param channel number
		 * @param delay number delay samples
		 */
		get(channel, delay) {
			let readHead = this.writeHead[channel] - Math.floor(delay);
			if (readHead < 0) {
				readHead += this.size;
			}
			return this.buffer[channel][readHead];
		}
	}
`;Oc(PT);const NT="feedback-comb-filter",IT=`
	class FeedbackCombFilterWorklet extends SingleIOProcessor {

		constructor(options) {
			super(options);
			this.delayLine = new DelayLine(this.sampleRate, options.channelCount || 2);
		}

		static get parameterDescriptors() {
			return [{
				name: "delayTime",
				defaultValue: 0.1,
				minValue: 0,
				maxValue: 1,
				automationRate: "k-rate"
			}, {
				name: "feedback",
				defaultValue: 0.5,
				minValue: 0,
				maxValue: 0.9999,
				automationRate: "k-rate"
			}];
		}

		generate(input, channel, parameters) {
			const delayedSample = this.delayLine.get(channel, parameters.delayTime * this.sampleRate);
			this.delayLine.push(channel, input + delayedSample * parameters.feedback);
			return delayedSample;
		}
	}
`;ed(NT,IT);class Ji extends _n{constructor(){super(N(Ji.getDefaults(),arguments,["urls","onload","baseUrl"],"urls")),this.name="Sampler",this._activeSources=new Map;const e=N(Ji.getDefaults(),arguments,["urls","onload","baseUrl"],"urls"),t={};Object.keys(e.urls).forEach(s=>{const i=parseInt(s,10);if($(Er(s)||Ls(i)&&isFinite(i),`url key is neither a note or midi pitch: ${s}`),Er(s)){const r=new Ot(this.context,s).toMidi();t[r]=e.urls[s]}else Ls(i)&&isFinite(i)&&(t[i]=e.urls[i])}),this._buffers=new bc({urls:t,onload:e.onload,baseUrl:e.baseUrl,onerror:e.onerror}),this.attack=e.attack,this.release=e.release,this.curve=e.curve,this._buffers.loaded&&Promise.resolve().then(e.onload)}static getDefaults(){return Object.assign(_n.getDefaults(),{attack:0,baseUrl:"",curve:"exponential",onload:le,onerror:le,release:.1,urls:{}})}_findClosest(e){let s=0;for(;s<96;){if(this._buffers.has(e+s))return-s;if(this._buffers.has(e-s))return s;s++}throw new Error(`No available buffers for note: ${e}`)}triggerAttack(e,t,s=1){return this.log("triggerAttack",e,t,s),Array.isArray(e)||(e=[e]),e.forEach(i=>{const r=Qh(new Ot(this.context,i).toFrequency()),o=Math.round(r),a=r-o,c=this._findClosest(o),l=o-c,u=this._buffers.get(l),h=$h(c+a),d=new $n({url:u,context:this.context,curve:this.curve,fadeIn:this.attack,fadeOut:this.release,playbackRate:h}).connect(this.output);d.start(t,0,u.duration/h,s),Ut(this._activeSources.get(o))||this._activeSources.set(o,[]),this._activeSources.get(o).push(d),d.onended=()=>{if(this._activeSources&&this._activeSources.has(o)){const f=this._activeSources.get(o),m=f.indexOf(d);m!==-1&&f.splice(m,1)}}}),this}triggerRelease(e,t){return this.log("triggerRelease",e,t),Array.isArray(e)||(e=[e]),e.forEach(s=>{const i=new Ot(this.context,s).toMidi();if(this._activeSources.has(i)&&this._activeSources.get(i).length){const r=this._activeSources.get(i);t=this.toSeconds(t),r.forEach(o=>{o.stop(t)}),this._activeSources.set(i,[])}}),this}releaseAll(e){const t=this.toSeconds(e);return this._activeSources.forEach(s=>{for(;s.length;)s.shift().stop(t)}),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}triggerAttackRelease(e,t,s,i=1){const r=this.toSeconds(s);return this.triggerAttack(e,r,i),Ut(t)?($(Ut(e),"notes must be an array when duration is array"),e.forEach((o,a)=>{const c=t[Math.min(a,t.length-1)];this.triggerRelease(o,r+this.toSeconds(c))})):this.triggerRelease(e,r+this.toSeconds(t)),this}add(e,t,s){if($(Er(e)||isFinite(e),`note must be a pitch or midi: ${e}`),Er(e)){const i=new Ot(this.context,e).toMidi();this._buffers.add(i,t,s)}else this._buffers.add(e,t,s);return this}get loaded(){return this._buffers.loaded}dispose(){return super.dispose(),this._buffers.dispose(),this._activeSources.forEach(e=>{e.forEach(t=>t.dispose())}),this._activeSources.clear(),this}}zt([ws(0)],Ji.prototype,"attack",void 0);zt([ws(0)],Ji.prototype,"release",void 0);class no extends G{constructor(){super(Object.assign(N(no.getDefaults(),arguments,["fade"]))),this.name="CrossFade",this._panner=this.context.createStereoPanner(),this._split=this.context.createChannelSplitter(2),this._g2a=new DT({context:this.context}),this.a=new _e({context:this.context,gain:0}),this.b=new _e({context:this.context,gain:0}),this.output=new _e({context:this.context}),this._internalChannels=[this.a,this.b];const e=N(no.getDefaults(),arguments,["fade"]);this.fade=new ye({context:this.context,units:"normalRange",value:e.fade}),xe(this,"fade"),this.context.getConstant(1).connect(this._panner),this._panner.connect(this._split),this._panner.channelCount=1,this._panner.channelCountMode="explicit",Bs(this._split,this.a.gain,0),Bs(this._split,this.b.gain,1),this.fade.chain(this._g2a,this._panner.pan),this.a.connect(this.output),this.b.connect(this.output)}static getDefaults(){return Object.assign(G.getDefaults(),{fade:.5})}dispose(){return super.dispose(),this.a.dispose(),this.b.dispose(),this.output.dispose(),this.fade.dispose(),this._g2a.dispose(),this._panner.disconnect(),this._split.disconnect(),this}}class kl extends G{constructor(e){super(e),this.name="Effect",this._dryWet=new no({context:this.context}),this.wet=this._dryWet.fade,this.effectSend=new _e({context:this.context}),this.effectReturn=new _e({context:this.context}),this.input=new _e({context:this.context}),this.output=this._dryWet,this.input.fan(this._dryWet.a,this.effectSend),this.effectReturn.connect(this._dryWet.b),this.wet.setValueAtTime(e.wet,0),this._internalChannels=[this.effectReturn,this.effectSend],xe(this,"wet")}static getDefaults(){return Object.assign(G.getDefaults(),{wet:1})}connectEffect(e){return this._internalChannels.push(e),this.effectSend.chain(e,this.effectReturn),this}dispose(){return super.dispose(),this._dryWet.dispose(),this.effectSend.dispose(),this.effectReturn.dispose(),this.wet.dispose(),this}}class io extends G{constructor(){super(Object.assign(N(io.getDefaults(),arguments,["pan"]))),this.name="Panner",this._panner=this.context.createStereoPanner(),this.input=this._panner,this.output=this._panner;const e=N(io.getDefaults(),arguments,["pan"]);this.pan=new he({context:this.context,param:this._panner.pan,value:e.pan,minValue:-1,maxValue:1}),this._panner.channelCount=e.channelCount,this._panner.channelCountMode="explicit",xe(this,"pan")}static getDefaults(){return Object.assign(G.getDefaults(),{pan:0,channelCount:1})}dispose(){return super.dispose(),this._panner.disconnect(),this.pan.dispose(),this}}const FT="bit-crusher",UT=`
	class BitCrusherWorklet extends SingleIOProcessor {

		static get parameterDescriptors() {
			return [{
				name: "bits",
				defaultValue: 12,
				minValue: 1,
				maxValue: 16,
				automationRate: 'k-rate'
			}];
		}

		generate(input, _channel, parameters) {
			const step = Math.pow(0.5, parameters.bits - 1);
			const val = step * Math.floor(input / step + 0.5);
			return val;
		}
	}
`;ed(FT,UT);class ro extends G{constructor(){super(N(ro.getDefaults(),arguments,["channels"])),this.name="Merge";const e=N(ro.getDefaults(),arguments,["channels"]);this._merger=this.output=this.input=this.context.createChannelMerger(e.channels)}static getDefaults(){return Object.assign(G.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._merger.disconnect(),this}}class oo extends kl{constructor(){super(N(oo.getDefaults(),arguments,["decay"])),this.name="Reverb",this._convolver=this.context.createConvolver(),this.ready=Promise.resolve();const e=N(oo.getDefaults(),arguments,["decay"]);this._decay=e.decay,this._preDelay=e.preDelay,this.generate(),this.connectEffect(this._convolver)}static getDefaults(){return Object.assign(kl.getDefaults(),{decay:1.5,preDelay:.01})}get decay(){return this._decay}set decay(e){e=this.toSeconds(e),Bt(e,.001),this._decay=e,this.generate()}get preDelay(){return this._preDelay}set preDelay(e){e=this.toSeconds(e),Bt(e,0),this._preDelay=e,this.generate()}generate(){return Ue(this,void 0,void 0,function*(){const e=this.ready,t=new Eo(2,this._decay+this._preDelay,this.context.sampleRate),s=new Hi({context:t}),i=new Hi({context:t}),r=new ro({context:t});s.connect(r,0,0),i.connect(r,0,1);const o=new _e({context:t}).toDestination();r.connect(o),s.start(0),i.start(0),o.gain.setValueAtTime(0,0),o.gain.setValueAtTime(1,this._preDelay),o.gain.exponentialApproachValueAtTime(0,this._preDelay,this.decay);const a=t.render();return this.ready=a.then(le),yield e,this._convolver.buffer=(yield a).get(),this})}dispose(){return super.dispose(),this._convolver.disconnect(),this}}class Pe extends G{constructor(){super(N(Pe.getDefaults(),arguments,["solo"])),this.name="Solo";const e=N(Pe.getDefaults(),arguments,["solo"]);this.input=this.output=new _e({context:this.context}),Pe._allSolos.has(this.context)||Pe._allSolos.set(this.context,new Set),Pe._allSolos.get(this.context).add(this),this.solo=e.solo}static getDefaults(){return Object.assign(G.getDefaults(),{solo:!1})}get solo(){return this._isSoloed()}set solo(e){e?this._addSolo():this._removeSolo(),Pe._allSolos.get(this.context).forEach(t=>t._updateSolo())}get muted(){return this.input.gain.value===0}_addSolo(){Pe._soloed.has(this.context)||Pe._soloed.set(this.context,new Set),Pe._soloed.get(this.context).add(this)}_removeSolo(){Pe._soloed.has(this.context)&&Pe._soloed.get(this.context).delete(this)}_isSoloed(){return Pe._soloed.has(this.context)&&Pe._soloed.get(this.context).has(this)}_noSolos(){return!Pe._soloed.has(this.context)||Pe._soloed.has(this.context)&&Pe._soloed.get(this.context).size===0}_updateSolo(){this._isSoloed()?this.input.gain.value=1:this._noSolos()?this.input.gain.value=1:this.input.gain.value=0}dispose(){return super.dispose(),Pe._allSolos.get(this.context).delete(this),this._removeSolo(),this}}Pe._allSolos=new Map;Pe._soloed=new Map;class ao extends G{constructor(){super(N(ao.getDefaults(),arguments,["pan","volume"])),this.name="PanVol";const e=N(ao.getDefaults(),arguments,["pan","volume"]);this._panner=this.input=new io({context:this.context,pan:e.pan,channelCount:e.channelCount}),this.pan=this._panner.pan,this._volume=this.output=new zs({context:this.context,volume:e.volume}),this.volume=this._volume.volume,this._panner.connect(this._volume),this.mute=e.mute,xe(this,["pan","volume"])}static getDefaults(){return Object.assign(G.getDefaults(),{mute:!1,pan:0,volume:0,channelCount:1})}get mute(){return this._volume.mute}set mute(e){this._volume.mute=e}dispose(){return super.dispose(),this._panner.dispose(),this.pan.dispose(),this._volume.dispose(),this.volume.dispose(),this}}class en extends G{constructor(){super(N(en.getDefaults(),arguments,["volume","pan"])),this.name="Channel";const e=N(en.getDefaults(),arguments,["volume","pan"]);this._solo=this.input=new Pe({solo:e.solo,context:this.context}),this._panVol=this.output=new ao({context:this.context,pan:e.pan,volume:e.volume,mute:e.mute,channelCount:e.channelCount}),this.pan=this._panVol.pan,this.volume=this._panVol.volume,this._solo.connect(this._panVol),xe(this,["pan","volume"])}static getDefaults(){return Object.assign(G.getDefaults(),{pan:0,volume:0,mute:!1,solo:!1,channelCount:1})}get solo(){return this._solo.solo}set solo(e){this._solo.solo=e}get muted(){return this._solo.muted||this.mute}get mute(){return this._panVol.mute}set mute(e){this._panVol.mute=e}_getBus(e){return en.buses.has(e)||en.buses.set(e,new _e({context:this.context})),en.buses.get(e)}send(e,t=0){const s=this._getBus(e),i=new _e({context:this.context,units:"decibels",gain:t});return this.connect(i),i.connect(s),i}receive(e){return this._getBus(e).connect(this),this}dispose(){return super.dispose(),this._panVol.dispose(),this.pan.dispose(),this.volume.dispose(),this._solo.dispose(),this}}en.buses=new Map;class LT extends G{constructor(){super(...arguments),this.name="Listener",this.positionX=new he({context:this.context,param:this.context.rawContext.listener.positionX}),this.positionY=new he({context:this.context,param:this.context.rawContext.listener.positionY}),this.positionZ=new he({context:this.context,param:this.context.rawContext.listener.positionZ}),this.forwardX=new he({context:this.context,param:this.context.rawContext.listener.forwardX}),this.forwardY=new he({context:this.context,param:this.context.rawContext.listener.forwardY}),this.forwardZ=new he({context:this.context,param:this.context.rawContext.listener.forwardZ}),this.upX=new he({context:this.context,param:this.context.rawContext.listener.upX}),this.upY=new he({context:this.context,param:this.context.rawContext.listener.upY}),this.upZ=new he({context:this.context,param:this.context.rawContext.listener.upZ})}static getDefaults(){return Object.assign(G.getDefaults(),{positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:-1,upX:0,upY:1,upZ:0})}dispose(){return super.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this.forwardX.dispose(),this.forwardY.dispose(),this.forwardZ.dispose(),this.upX.dispose(),this.upY.dispose(),this.upZ.dispose(),this}}bo(n=>{n.listener=new LT({context:n})});Co(n=>{n.listener.dispose()});It().transport;const Ac=It().destination;It().destination;It().listener;It().draw;It();const Mc=new Kn(900,"highpass"),td=new zs(-6);td.chain(Mc,Ac);const BT=new oo(3).connect(td),Mo=new Qi({envelope:{attack:0,decay:.9,sustain:.2,release:.1}});Mo.oscillator.type="triangle2";Mo.volume.value=-6;Mo.chain(Mc,Ac);const Do=new Qi({envelope:{attack:.4,decay:.9,sustain:.7,release:.6}}).connect(BT);Do.oscillator.type="triangle";Do.volume.value=-6;Do.chain(Mc,Ac);function zT(){return Math.floor((Math.random()-.5)*20)}let Rl=!1;const Fx=async(n=0)=>{Rl||(await mT(),Rl=!0);try{if(n>2e3)Do.triggerAttackRelease(60,.3);else if(n>1e3){let e=310;e+=zT(),Mo.triggerAttackRelease(e,.001)}}catch(e){console.warn(e)}},Ux=n=>us.jsx("svg",{width:"1em",height:"1em",viewBox:"0 0 20 20",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:us.jsx("g",{id:"Type=Edit, Size=20x20",children:us.jsx("path",{id:"icon","fill-rule":"evenodd","clip-rule":"evenodd",d:"M14.9243 3.3359L9.06461 9.19559C8.97523 9.28497 8.9036 9.39048 8.85353 9.50654L7.99772 11.49C7.89015 11.7394 8.14272 11.9919 8.39203 11.8843L10.3755 11.0285C10.4916 10.9785 10.5971 10.9068 10.6865 10.8175L16.5462 4.95777C16.994 4.50991 16.994 3.78377 16.5462 3.3359C16.0983 2.88804 15.3722 2.88804 14.9243 3.3359ZM14.5297 10.7363C14.5297 10.3876 14.8127 10.1047 15.1615 10.1047C15.5116 10.1047 15.7933 10.3889 15.7933 10.7363L15.7222 14.1051C15.7222 15.1499 14.8954 16 13.8506 16H5.87166C4.85054 16 4 15.1499 4 14.0814V6.0806C4 5.05918 4.85054 4.2091 5.87166 4.2091L9.68606 4.20936C10.0362 4.20936 10.3178 4.49228 10.3178 4.841C10.3178 5.18972 10.0349 5.47264 9.68606 5.47264H5.89535C5.54735 5.47264 5.26357 5.75609 5.26357 6.10428V14.1051C5.26357 14.4533 5.54735 14.7367 5.89535 14.7367H13.898C14.246 14.7367 14.5297 14.4533 14.5297 14.1051V10.7363Z",fill:"currentColor"})})});export{QT as A,ix as B,YT as C,Ux as E,WT as H,GT as L,rx as O,$T as P,Le as R,ex as S,ox as V,XT as a,ZT as b,jT as c,KT as d,JT as e,nx as f,Wm as g,K as h,Fx as p,ax as u};
